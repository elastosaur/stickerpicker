import{l as p,ay as E,j as o,r as t,k as S,az as R,a7 as j}from"./components-DuRBtGp8-CgeLxIBe.js";p.info("Element Call popout dev");const w=E.createRoot(document.getElementById("root"));let r=null;window.isSecureContext?navigator.mediaDevices||(r=new Error("Your browser does not support WebRTC.")):r=new Error(`This app cannot run in an insecure context. To fix this, access the app via a local loopback address, or serve it over HTTPS.
https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts`);if(r!==null)throw w.render(r.message),r;const y=j,d=new URLSearchParams(document.location.search),c=d.get("mediaType"),u=d.get("participantId");d.get("displayName");const b=()=>{const[s,f]=t.useState(),[h,m]=t.useState(),[g,k]=t.useState(window.innerHeight),[i,x]=t.useState();if(!window.opener)return o.jsx("p",{children:" No parent window; this only works when opened from an existing call! "});const v=t.useRef(null);t.useEffect(()=>{const e=new window.opener.BroadcastChannel("popout-token-request");return v.current=e,e.onmessage=n=>{if(p.info("event received",n),n.data.type!=="popout_token")return;const a=n.data.sfuConfig;i.connect(a.url,a.jwt).then(x)},e.postMessage({type:"popout_token_request"}),()=>{e.close()}},[]),t.useEffect(()=>{let e=0;return s===void 0&&(e=window.setTimeout(()=>{const n=i?.remoteParticipants.get(u);m(n);const a=n?.getTrackPublication(c);f(a)},1e3)),()=>{e!=0&&window.clearTimeout(e)}},[c,u,i,s]);const l=t.useCallback(()=>{k(window.innerHeight)},[]);if(t.useEffect(()=>{const e=S(l);return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[l]),s===void 0)return o.jsx("p",{children:" loading.... "});const T={participant:h,publication:s,source:c};return o.jsxs(R,{room:i,token:accessToken,serverUrl:livekitUrl,video:!1,audio:!1,children:[o.jsx(y,{muted:!0,autoPlay:!0,trackRef:T,height:g}),";"]})};w.render(o.jsx(t.StrictMode,{children:o.jsx(t.Suspense,{fallback:o.jsx("p",{children:"Connecting..."}),children:o.jsx(b,{})})}));
//# sourceMappingURL=popout-C-vdvorm.js.map
