import{l as w,ay as R,j as o,r as t,u as S,k as j,az as y,a7 as b}from"./components-DuRBtGp8-CgeLxIBe.js";w.info("Element Call popout dev");const f=R.createRoot(document.getElementById("root"));let r=null;window.isSecureContext?navigator.mediaDevices||(r=new Error("Your browser does not support WebRTC.")):r=new Error(`This app cannot run in an insecure context. To fix this, access the app via a local loopback address, or serve it over HTTPS.
https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts`);if(r!==null)throw f.render(r.message),r;const C=b,d=new URLSearchParams(document.location.search),c=d.get("mediaType"),p=d.get("participantId");d.get("displayName");const z=()=>{const[s,m]=t.useState(),[h,g]=t.useState(),[k,x]=t.useState(window.innerHeight),[a,v]=t.useState();if(!window.opener)return o.jsx("p",{children:" No parent window; this only works when opened from an existing call! "});const T=t.useRef(null);t.useEffect(()=>{const e=new window.opener.BroadcastChannel("popout-token-request");return T.current=e,e.onmessage=n=>{if(w.info("event received",n),n.data.type!=="popout_token")return;const i=n.data.sfuConfig;let u=new S;u.connect(i.url,i.jwt).then(()=>v(u))},e.postMessage({type:"popout_token_request"}),()=>{e.close()}},[]),t.useEffect(()=>{let e=0;return s===void 0&&(e=window.setTimeout(()=>{const n=a?.remoteParticipants.get(p);g(n);const i=n?.getTrackPublication(c);m(i)},1e3)),()=>{e!=0&&window.clearTimeout(e)}},[c,p,a,s]);const l=t.useCallback(()=>{x(window.innerHeight)},[]);if(t.useEffect(()=>{const e=j(l);return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[l]),s===void 0)return o.jsx("p",{children:" loading.... "});const E={participant:h,publication:s,source:c};return o.jsxs(y,{room:a,token:accessToken,serverUrl:livekitUrl,video:!1,audio:!1,children:[o.jsx(C,{muted:!0,autoPlay:!0,trackRef:E,height:k}),";"]})};f.render(o.jsx(t.StrictMode,{children:o.jsx(t.Suspense,{fallback:o.jsx("p",{children:"Connecting..."}),children:o.jsx(z,{})})}));
//# sourceMappingURL=popout-CR6bi0uQ.js.map
