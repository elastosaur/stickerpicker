const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-Rt5Cjb-1.js","./matrix-sdk-crypto-wasm-BsWSMcLv.js","./polyfill-force-CfSzzRWs.js","./decimal-CeJ0lJls.js","./polyfill-force-DAqvsE0e.js"])))=>i.map(i=>d[i]);
function tve(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in t)){const s=Object.getOwnPropertyDescriptor(r,i);s&&Object.defineProperty(t,i,s.get?s:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();function Dl(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function Cot(t){if(Object.prototype.hasOwnProperty.call(t,"__esModule"))return t;var e=t.default;if(typeof e=="function"){var n=function r(){var i=!1;try{i=this instanceof r}catch{}return i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}),n}var $I={exports:{}},M0={};var e$;function nve(){if(e$)return M0;e$=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function n(r,i,s){var o=null;if(s!==void 0&&(o=""+s),i.key!==void 0&&(o=""+i.key),"key"in i){s={};for(var a in i)a!=="key"&&(s[a]=i[a])}else s=i;return i=s.ref,{$$typeof:t,type:r,key:o,ref:i!==void 0?i:null,props:s}}return M0.Fragment=e,M0.jsx=n,M0.jsxs=n,M0}var t$;function rve(){return t$||(t$=1,$I.exports=nve()),$I.exports}var S=rve();function n$(t,e,n,r,i,s,o){try{var a=t[s](o),c=a.value}catch(l){return void n(l)}a.done?e(c):Promise.resolve(c).then(r,i)}function B(t){return function(){var e=this,n=arguments;return new Promise(function(r,i){var s=t.apply(e,n);function o(c){n$(s,r,i,o,a,"next",c)}function a(c){n$(s,r,i,o,a,"throw",c)}o(void 0)})}}function Eb(t){"@babel/helpers - typeof";return Eb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Eb(t)}function ive(t,e){if(Eb(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(Eb(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function sve(t){var e=ive(t,"string");return Eb(e)=="symbol"?e:e+""}function M(t,e,n){return(e=sve(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const ove="l",ave="rn",cve={0:"O",1:"l","֭":"֖","֮":"֘","֨":"֙","֤":"֚","᪴":"ۛ","⃛":"ۛ","ؙ":"̓","ࣳ":"̓","̓":"̓","̕":"̓","ُ":"̓","ٝ":"̔","֜":"́","֝":"́","ؘ":"́","݇":"́","́":"́","॔":"́","َ":"́","̀":"̀","॓":"̀","̌":"̆","꙼":"̆","٘":"̆","ٚ":"̆","ͮ":"̆","ۨ":"̆̇","̐":"̆̇","ँ":"̆̇","ঁ":"̆̇","ઁ":"̆̇","ଁ":"̆̇","ఀ":"̆̇","ಁ":"̆̇","ഁ":"̆̇","𑒿":"̆̇","᳐":"̂","̑":"̂","ٛ":"̂","߮":"̂","꛰":"̂","֯":"̊","۟":"̊","៓":"̊","゚":"̊","ْ":"̊","ஂ":"̊","ံ":"̊","ំ":"̊","𑌀":"̊","ํ":"̊","ໍ":"̊","ͦ":"̊","ⷪ":"̊","࣫":"̈","߳":"̈","ً":"̋","ࣰ":"̋","͂":"̃","ٓ":"̃","ׄ":"̇","۬":"̇","݀":"̇","࣪":"̇","݁":"̇","͘":"̇","ֹ":"̇","ֺ":"̇","ׂ":"̇","ׁ":"̇","߭":"̇","ं":"̇","ਂ":"̇","ં":"̇","்":"̇","̷":"̸","᪷":"̨","̢":"̨","ͅ":"̨","᳒":"̄","̅":"̄","ٙ":"̄","߫":"̄","꛱":"̄","᳚":"̎","ٗ":"̒","͗":"͐","ࣿ":"͐","ࣸ":"͐","ऀ":"͒","᳭":"̖","᳜":"̩","ٖ":"̩","᳕":"̫","͇":"̳","ࣹ":"͔","ࣺ":"͕","゛":"ﾞ","゜":"ﾟ","̶":"̵","〬":"̉","ׅ":"̣","࣭":"̣","᳝":"̣","ִ":"̣","ٜ":"̣","़":"̣","়":"̣","਼":"̣","઼":"̣","଼":"̣","𑇊":"̣","𑓃":"̣","𐨺":"̣","࣮":"̤","᳞":"̤","༷":"̥","〭":"̥","̧":"̦","̡":"̦","̹":"̦","᳙":"̭","᳘":"̮","॒":"̱","̠":"̱","ࣱ":"ٌ","ࣨ":"ٌ","ࣥ":"ٌ",ﱞ:"ﹲّ","ࣲ":"ٍ",ﱟ:"ﹴّ",ﳲ:"ﹷّ",ﱠ:"ﹶّ",ﳳ:"ﹹّ",ﱡ:"ﹸّ","ؚ":"ِ","̗":"ِ",ﳴ:"ﹻّ",ﱢ:"ﹺّ",ﱣ:"ﹼٰ","ٟ":"ٕ","̍":"ٰ","݂":"ܼ","ਃ":"ঃ","ః":"ঃ","ಃ":"ঃ","ഃ":"ঃ","ඃ":"ঃ","း":"ঃ","𑓁":"ঃ","់":"่","່":"่","້":"้","໊":"๊","໋":"๋","꙯":"⃩","\u2028":" ","\u2029":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" "," ":" ","ߺ":"_","﹍":"_","﹎":"_","﹏":"_","‐":"-","‑":"-","‒":"-","–":"-","﹘":"-","۔":"-","⁃":"-","˗":"-","−":"-","➖":"-","Ⲻ":"-","⨩":"-̓","⸚":"-̈","﬩":"-̇","∸":"-̇","⨪":"-̣","꓾":"-.","～":"〜","؍":",","٫":",","‚":",","¸":",","ꓹ":",","⸲":"،","٬":"،",";":";","⸵":"؛","ः":":","ઃ":":","：":":","։":":","܃":":","܄":":","᛬":":","︰":":","᠃":":","᠉":":","⁚":":","׃":":","˸":":","꞉":":","∶":":",ː:":","ꓽ":":","⩴":"::=","⧴":":→","！":"!",ǃ:"!","ⵑ":"!","‼":"!!","⁉":"!?",ʔ:"?","Ɂ":"?","ॽ":"?",Ꭾ:"?","ꛫ":"?","⁈":"?!","⁇":"??","⸮":"؟","𝅭":".","․":".","܁":".","܂":".","꘎":".","𐩐":".","٠":".","۰":".","ꓸ":".","ꓻ":".,","‥":"..","ꓺ":"..","…":"...","꛴":"꛳꛳","・":"·","･":"·","᛫":"·","·":"·","⸱":"·","𐄁":"·","•":"·","‧":"·","∙":"·","⋅":"·","ꞏ":"·",ᐧ:"·","⋯":"···","ⵈ":"···",ᑄ:"·<","⋗":"·>",ᐷ:"·>",ᑀ:"·>",ᔯ:"·4",ᑾ:"·b",ᒀ:"·ḃ",ᑺ:"·d",ᒘ:"·J",ᒶ:"·L",ᑶ:"·P",ᑗ:"·U",ᐺ:"·V",ᐼ:"·Ʌ",ᒮ:"·Γ",ᐎ:"·Δ",ᑙ:"·Ո",ᐌ:"·ᐁ",ᐐ:"·ᐄ",ᐒ:"·ᐅ",ᐔ:"·ᐆ",ᐗ:"·ᐊ",ᐙ:"·ᐋ",ᐾ:"·ᐲ",ᑂ:"·ᐴ",ᑆ:"·ᐹ",ᑛ:"·ᑏ",ᑔ:"·ᑐ",ᑝ:"·ᑐ",ᑟ:"·ᑑ",ᑡ:"·ᑕ",ᑣ:"·ᑖ",ᑴ:"·ᑫ",ᑸ:"·ᑮ",ᑼ:"·ᑰ",ᒒ:"·ᒉ",ᒔ:"·ᒋ",ᒖ:"·ᒌ",ᒚ:"·ᒎ",ᒜ:"·ᒐ",ᒞ:"·ᒑ",ᒬ:"·ᒣ",ᒰ:"·ᒦ",ᒲ:"·ᒧ",ᒴ:"·ᒨ",ᒸ:"·ᒫ",ᓉ:"·ᓀ","ᣆ":"·ᓂ","ᣈ":"·ᓃ","ᣊ":"·ᓄ","ᣌ":"·ᓅ",ᓋ:"·ᓇ",ᓍ:"·ᓈ",ᓜ:"·ᓓ",ᓞ:"·ᓕ",ᓠ:"·ᓖ",ᓢ:"·ᓗ",ᓤ:"·ᓘ",ᓦ:"·ᓚ",ᓨ:"·ᓛ",ᓶ:"·ᓭ",ᓸ:"·ᓯ",ᓺ:"·ᓰ",ᓼ:"·ᓱ",ᓾ:"·ᓲ",ᔀ:"·ᓴ",ᔂ:"·ᓵ",ᔗ:"·ᔐ",ᔙ:"·ᔑ",ᔛ:"·ᔒ",ᔝ:"·ᔓ",ᔟ:"·ᔔ",ᔡ:"·ᔕ",ᔣ:"·ᔖ",ᔱ:"·ᔨ",ᔳ:"·ᔩ",ᔵ:"·ᔪ",ᔷ:"·ᔫ",ᔹ:"·ᔭ",ᔻ:"·ᔮ","ᣎ":"·ᕃ","ᣏ":"·ᕆ","ᣐ":"·ᕇ","ᣑ":"·ᕈ","ᣒ":"·ᕉ","ᣓ":"·ᕋ",ᕎ:"·ᕌ",ᕛ:"·ᕚ",ᕨ:"·ᕧ","ᢳ":"·ᢱ","ᢶ":"·ᢴ","ᢹ":"·ᢸ","ᣂ":"·ᣀ","꠰":"।","॥":"।।","᰼":"᰻᰻","။":"၊၊","᪩":"᪨᪨","᪫":"᪪᪨","᭟":"᭞᭞","𐩗":"𐩖𐩖","𑑌":"𑑋𑑋","𑙂":"𑙁𑙁","𑱂":"𑱁𑱁","᱿":"᱾᱾","՝":"'","＇":"'","‘":"'","’":"'","‛":"'","′":"'","‵":"'","՚":"'","׳":"'","`":"'","`":"'","｀":"'","´":"'","΄":"'","´":"'","᾽":"'","᾿":"'","῾":"'","ʹ":"'","ʹ":"'","ˈ":"'","ˊ":"'","ˋ":"'","˴":"'",ʻ:"'",ʽ:"'",ʼ:"'",ʾ:"'","ꞌ":"'",י:"'","ߴ":"'","ߵ":"'",ᑊ:"'",ᛌ:"'","𖽑":"'","𖽒":"'","᳓":"''",'"':"''","＂":"''","“":"''","”":"''","‟":"''","″":"''","‶":"''","〃":"''","״":"''","˝":"''","ʺ":"''","˶":"''",ˮ:"''",ײ:"''","‴":"'''","‷":"'''","⁗":"''''",Ɓ:"'B",Ɗ:"'D",ŉ:"'n",Ƥ:"'P",Ƭ:"'T",Ƴ:"'Y","［":"(","❨":"(","❲":"(","〔":"(","﴾":"(","⸨":"((","㈠":"(ー)","⑵":"(2)","⒇":"(2O)","⑶":"(3)","⑷":"(4)","⑸":"(5)","⑹":"(6)","⑺":"(7)","⑻":"(8)","⑼":"(9)","⒜":"(a)","🄐":"(A)","⒝":"(b)","🄑":"(B)","⒞":"(c)","🄒":"(C)","⒟":"(d)","🄓":"(D)","⒠":"(e)","🄔":"(E)","⒡":"(f)","🄕":"(F)","⒢":"(g)","🄖":"(G)","⒣":"(h)","🄗":"(H)","⒤":"(i)","⒥":"(j)","🄙":"(J)","⒦":"(k)","🄚":"(K)","⑴":"(l)","🄘":"(l)","⒧":"(l)","🄛":"(L)","⑿":"(l2)","⒀":"(l3)","⒁":"(l4)","⒂":"(l5)","⒃":"(l6)","⒄":"(l7)","⒅":"(l8)","⒆":"(l9)","⑾":"(ll)","⑽":"(lO)","🄜":"(M)","⒩":"(n)","🄝":"(N)","⒪":"(o)","🄞":"(O)","⒫":"(p)","🄟":"(P)","⒬":"(q)","🄠":"(Q)","⒭":"(r)","🄡":"(R)","⒨":"(rn)","⒮":"(s)","🄢":"(S)","🄪":"(S)","⒯":"(t)","🄣":"(T)","⒰":"(u)","🄤":"(U)","⒱":"(v)","🄥":"(V)","⒲":"(w)","🄦":"(W)","⒳":"(x)","🄧":"(X)","⒴":"(y)","🄨":"(Y)","⒵":"(z)","🄩":"(Z)","㈀":"(ᄀ)","㈎":"(가)","㈁":"(ᄂ)","㈏":"(나)","㈂":"(ᄃ)","㈐":"(다)","㈃":"(ᄅ)","㈑":"(라)","㈄":"(ᄆ)","㈒":"(마)","㈅":"(ᄇ)","㈓":"(바)","㈆":"(ᄉ)","㈔":"(사)","㈇":"(ᄋ)","㈕":"(아)","㈝":"(오전)","㈞":"(오후)","㈈":"(ᄌ)","㈖":"(자)","㈜":"(주)","㈉":"(ᄎ)","㈗":"(차)","㈊":"(ᄏ)","㈘":"(카)","㈋":"(ᄐ)","㈙":"(타)","㈌":"(ᄑ)","㈚":"(파)","㈍":"(ᄒ)","㈛":"(하)","㈦":"(七)","㈢":"(三)","🉁":"(三)","㈨":"(九)","㈡":"(二)","🉂":"(二)","㈤":"(五)","㈹":"(代)","㈽":"(企)","㉁":"(休)","㈧":"(八)","㈥":"(六)","㈸":"(労)","🉇":"(勝)","㈩":"(十)","㈿":"(協)","㈴":"(名)","㈺":"(呼)","㈣":"(四)","㈯":"(土)","㈻":"(学)","🉃":"(安)","🉅":"(打)","🉈":"(敗)","㈰":"(日)","㈪":"(月)","㈲":"(有)","㈭":"(木)","🉀":"(本)","㈱":"(株)","㈬":"(水)","㈫":"(火)","🉄":"(点)","㈵":"(特)","🉆":"(盗)","㈼":"(監)","㈳":"(社)","㈷":"(祝)","㉀":"(祭)","㉂":"(自)","㉃":"(至)","㈶":"(財)","㈾":"(資)","㈮":"(金)","］":")","❩":")","❳":")","〕":")","﴿":")","⸩":"))","❴":"{","𝄔":"{","❵":"}","〚":"⟦","〛":"⟧","⟨":"❬","〈":"❬","〈":"❬","㇛":"❬",く:"❬","𡿨":"❬","⟩":"❭","〉":"❭","〉":"❭","＾":"︿","⸿":"¶","⁎":"*","٭":"*","∗":"*","𐌟":"*","᜵":"/","⁁":"/","∕":"/","⁄":"/","╱":"/","⟋":"/","⧸":"/","𝈺":"/","㇓":"/",〳:"/","Ⳇ":"/",ノ:"/",丿:"/","⼃":"/","⧶":"/̄","⫽":"//","⫻":"///","＼":"\\","﹨":"\\","∖":"\\","⟍":"\\","⧵":"\\","⧹":"\\","𝈏":"\\","𝈻":"\\","㇔":"\\",丶:"\\","⼂":"\\","⳹":"\\\\","⑊":"\\\\","⟈":"\\ᑕ","ꝸ":"&","૰":"॰","𑂻":"॰","𑇇":"॰","⚬":"॰","𑇛":"꣼","៙":"๏","៕":"๚","៚":"๛","༌":"་","༎":"།།","˄":"^","ˆ":"^","꙾":"ˇ","˘":"ˇ","‾":"ˉ","﹉":"ˉ","﹊":"ˉ","﹋":"ˉ","﹌":"ˉ","¯":"ˉ","￣":"ˉ","▔":"ˉ",ъ:"ˉb","ꙑ":"ˉbi","͵":"ˏ","˻":"˪","꜖":"˪","꜔":"˫","。":"˳","⸰":"°","˚":"°","∘":"°","○":"°","◦":"°","⍜":"°̲","⍤":"°̈","℃":"°C","℉":"°F","௵":"௳","༛":"༚༚","༟":"༚༝","࿎":"༝༚","༞":"༝༝","Ⓒ":"©","Ⓡ":"®","Ⓟ":"℗","𝈛":"⅄","⯬":"↞","⯭":"↟","⯮":"↠","⯯":"↡","↵":"↲","⥥":"⇃⇂","⥯":"⇃ᛚ","𝛛":"∂","𝜕":"∂","𝝏":"∂","𝞉":"∂","𝟃":"∂","𞣌":"∂","𞣍":"∂̵",ð:"∂̵","⌀":"∅","𝛁":"∇","𝛻":"∇","𝜵":"∇","𝝯":"∇","𝞩":"∇","𑢨":"∇","⍢":"∇̈","⍫":"∇̴","█":"∎","■":"∎","⨿":"∐","᛭":"+","➕":"+","𐊛":"+","⨣":"+̂","⨢":"+̊","⨤":"+̃","∔":"+̇","⨥":"+̣","⨦":"+̰","⨧":"+₂","➗":"÷","‹":"<","❮":"<","˂":"<","𝈶":"<",ᐸ:"<",ᚲ:"<","⋖":"<·","Ⲵ":"<·",ᑅ:"<·","≪":"<<","⋘":"<<<","᐀":"=","⹀":"=","゠":"=","꓿":"=","≚":"=̆","≙":"=̂","≗":"=̊","≐":"=̇","≑":"=̣̇","⩮":"=⃰","⩵":"==","⩶":"===","≞":"=ͫ","›":">","❯":">","˃":">","𝈷":">",ᐳ:">","𖼿":">",ᑁ:">·","⪥":"><","≫":">>","⨠":">>","⋙":">>>","⁓":"~","˜":"~","῀":"~","∼":"~","⍨":"~̈","⸞":"~̇","⩪":"~̇","⸟":"~̣","𞣈":"∠","⋀":"∧","∯":"∮∮","∰":"∮∮∮","⸫":"∴","⸪":"∵","⸬":"∷","𑇞":"≈","♎":"≏","🝞":"≏","≣":"≡","⨃":"⊍","⨄":"⊎","𝈸":"⊏","𝈹":"⊐","⨅":"⊓","⨆":"⊔","⨂":"⊗","⍟":"⊛","🝱":"⊠","🝕":"⊡","◁":"⊲","▷":"⊳","⍣":"⋆̈","︴":"⌇","◠":"⌒","⨽":"⌙","⌥":"⌤","⧇":"⌻","◎":"⌾","⦾":"⌾","⧅":"⍂","⦰":"⍉","⏃":"⍋","⏂":"⍎","⏁":"⍕","⏆":"⍭","☸":"⎈","︵":"⏜","︶":"⏝","︷":"⏞","︸":"⏟","︹":"⏠","︺":"⏡","▱":"⏥","⏼":"⏻","︱":"│","｜":"│","┃":"│","┏":"┌","┣":"├","▐":"▌","▗":"▖","▝":"▘","☐":"□","￭":"▪","▸":"▶","►":"▶","⳩":"☧","🜊":"☩","🌒":"☽","🌙":"☽","⏾":"☾","🌘":"☾","⧙":"⦚","🜺":"⧟","⨾":"⨟","𐆠":"⳨","♩":"𝅘𝅥","♪":"𝅘𝅥𝅮","⓪":"🄍","↺":"🄎","˙":"ॱ","ൎ":"ॱ","－":"ー","—":"ー","―":"ー","─":"ー","━":"ー","㇐":"ー","ꟷ":"ー",ᅳ:"ー",ㅡ:"ー",一:"ー","⼀":"ー",ᆖ:"ーー","ힹ":"ーᅡ","ힺ":"ーᅥ","ힻ":"ーᅥ丨","ힼ":"ーᅩ",ᆕ:"ーᅮ",ᅴ:"ー丨",ㅢ:"ー丨",ᆗ:"ー丨ᅮ","🄏":"$⃠","₤":"£","〒":"₸","〶":"₸","᭜":"᭐","꧆":"꧐","𑓑":"১","೧":"౧","ၥ":"၁","①":"➀","⑩":"➉","⏨":"₁₀","𝟐":"2","𝟚":"2","𝟤":"2","𝟮":"2","𝟸":"2","🯲":"2","Ꝛ":"2",Ƨ:"2",Ϩ:"2","Ꙅ":"2",ᒿ:"2","ꛯ":"2","ꧏ":"٢","۲":"٢","૨":"२","𑓒":"২","೨":"౨","②":"➁",ƻ:"2̵","🄃":"2,","⒉":"2.","㏵":"22日","㍮":"22点","㏶":"23日","㍯":"23点","㏷":"24日","㍰":"24点","㏸":"25日","㏹":"26日","㏺":"27日","㏻":"28日","㏼":"29日","㏴":"2l日","㍭":"2l点","⒛":"2O.","㏳":"2O日","㍬":"2O点","෩":"෨ා","෯":"෨ී","㏡":"2日","㋁":"2月","㍚":"2点","𝈆":"3","𝟑":"3","𝟛":"3","𝟥":"3","𝟯":"3","𝟹":"3","🯳":"3","Ɜ":"3",Ȝ:"3",Ʒ:"3","Ꝫ":"3","Ⳍ":"3",З:"3",Ӡ:"3","𖼻":"3","𑣊":"3","۳":"٣","𞣉":"٣","૩":"३","③":"➂",Ҙ:"3̦","🄄":"3,","⒊":"3.","㏾":"3l日","㏽":"3O日","㏢":"3日","㋂":"3月","㍛":"3点","𝟒":"4","𝟜":"4","𝟦":"4","𝟰":"4","𝟺":"4","🯴":"4",Ꮞ:"4","𑢯":"4","۴":"٤","૪":"४","④":"➃","🄅":"4,","⒋":"4.",ᔰ:"4·","㏣":"4日","㋃":"4月","㍜":"4点","𝟓":"5","𝟝":"5","𝟧":"5","𝟱":"5","𝟻":"5","🯵":"5",Ƽ:"5","𑢻":"5","⑤":"➄","🄆":"5,","⒌":"5.","㏤":"5日","㋄":"5月","㍝":"5点","𝟔":"6","𝟞":"6","𝟨":"6","𝟲":"6","𝟼":"6","🯶":"6","Ⳓ":"6",б:"6",Ꮾ:"6","𑣕":"6","۶":"٦","𑓖":"৬","⑥":"➅","🄇":"6,","⒍":"6.","㏥":"6日","㋅":"6月","㍞":"6点","𝈒":"7","𝟕":"7","𝟟":"7","𝟩":"7","𝟳":"7","𝟽":"7","🯷":"7","𐓒":"7","𑣆":"7","⑦":"➆","🄈":"7,","⒎":"7.","㏦":"7日","㋆":"7月","㍟":"7点","ଃ":"8","৪":"8","੪":"8","𞣋":"8","𝟖":"8","𝟠":"8","𝟪":"8","𝟴":"8","𝟾":"8","🯸":"8",ȣ:"8",Ȣ:"8","𐌚":"8","૮":"८","⑧":"➇","🄉":"8,","⒏":"8.","㏧":"8日","㋇":"8月","㍠":"8点","੧":"9","୨":"9","৭":"9","൭":"9","𝟗":"9","𝟡":"9","𝟫":"9","𝟵":"9","𝟿":"9","🯹":"9","Ꝯ":"9","Ⳋ":"9","𑣌":"9","𑢬":"9","𑣖":"9","१":"٩","𑣤":"٩","۹":"٩","೯":"౯","⑨":"➈","🄊":"9,","⒐":"9.","㏨":"9日","㋈":"9月","㍡":"9点","⍺":"a",ａ:"a","𝐚":"a","𝑎":"a","𝒂":"a","𝒶":"a","𝓪":"a","𝔞":"a","𝕒":"a","𝖆":"a","𝖺":"a","𝗮":"a","𝘢":"a","𝙖":"a","𝚊":"a",ɑ:"a",α:"a","𝛂":"a","𝛼":"a","𝜶":"a","𝝰":"a","𝞪":"a",а:"a","ⷶ":"ͣ",Ａ:"A","𝐀":"A","𝐴":"A","𝑨":"A","𝒜":"A","𝓐":"A","𝔄":"A","𝔸":"A","𝕬":"A","𝖠":"A","𝗔":"A","𝘈":"A","𝘼":"A","𝙰":"A",Α:"A","𝚨":"A","𝛢":"A","𝜜":"A","𝝖":"A","𝞐":"A",А:"A",Ꭺ:"A",ᗅ:"A","ꓮ":"A","𖽀":"A","𐊠":"A","⍶":"a̲",ǎ:"ă",Ǎ:"Ă",ȧ:"å",Ȧ:"Å",ẚ:"ả","℀":"a/c","℁":"a/s","ꜳ":"aa","Ꜳ":"AA",æ:"ae",ӕ:"ae",Æ:"AE",Ӕ:"AE","ꜵ":"ao","Ꜵ":"AO","🜇":"AR","ꜷ":"au","Ꜷ":"AU","ꜹ":"av","ꜻ":"av","Ꜹ":"AV","Ꜻ":"AV","ꜽ":"ay","Ꜽ":"AY","ꭺ":"ᴀ","∀":"Ɐ","𝈗":"Ɐ",ᗄ:"Ɐ","ꓯ":"Ɐ","𐐟":"Ɒ","𝐛":"b","𝑏":"b","𝒃":"b","𝒷":"b","𝓫":"b","𝔟":"b","𝕓":"b","𝖇":"b","𝖻":"b","𝗯":"b","𝘣":"b","𝙗":"b","𝚋":"b",Ƅ:"b",Ь:"b",Ꮟ:"b",ᑲ:"b",ᖯ:"b",Ｂ:"B",ℬ:"B","𝐁":"B","𝐵":"B","𝑩":"B","𝓑":"B","𝔅":"B","𝔹":"B","𝕭":"B","𝖡":"B","𝗕":"B","𝘉":"B","𝘽":"B","𝙱":"B","Ꞵ":"B",Β:"B","𝚩":"B","𝛣":"B","𝜝":"B","𝝗":"B","𝞑":"B",В:"B",Ᏼ:"B",ᗷ:"B","ꓐ":"B","𐊂":"B","𐊡":"B","𐌁":"B",ɓ:"b̔",ᑳ:"ḃ",ƃ:"b̄",Ƃ:"b̄",Б:"b̄",ƀ:"b̵",ҍ:"b̵",Ҍ:"b̵",ѣ:"b̵",Ѣ:"b̵",ᑿ:"b·",ᒁ:"ḃ·",ᒈ:"b'",Ы:"bl",в:"ʙ","ᏼ":"ʙ",ｃ:"c","ⅽ":"c","𝐜":"c","𝑐":"c","𝒄":"c","𝒸":"c","𝓬":"c","𝔠":"c","𝕔":"c","𝖈":"c","𝖼":"c","𝗰":"c","𝘤":"c","𝙘":"c","𝚌":"c","ᴄ":"c",ϲ:"c","ⲥ":"c",с:"c","ꮯ":"c","𐐽":"c","ⷭ":"ͨ","🝌":"C","𑣲":"C","𑣩":"C",Ｃ:"C","Ⅽ":"C",ℂ:"C",ℭ:"C","𝐂":"C","𝐶":"C","𝑪":"C","𝒞":"C","𝓒":"C","𝕮":"C","𝖢":"C","𝗖":"C","𝘊":"C","𝘾":"C","𝙲":"C","Ϲ":"C","Ⲥ":"C",С:"C",Ꮯ:"C","ꓚ":"C","𐊢":"C","𐌂":"C","𐐕":"C","𐔜":"C","¢":"c̸","ȼ":"c̸","₡":"C⃫","🅮":"C⃠",ç:"c̦",ҫ:"c̦",Ç:"C̦",Ҫ:"C̦",Ƈ:"C'","℅":"c/o","℆":"c/u","🅭":"㏄	⃝","⋴":"ꞓ",ɛ:"ꞓ",ε:"ꞓ","ϵ":"ꞓ","𝛆":"ꞓ","𝛜":"ꞓ","𝜀":"ꞓ","𝜖":"ꞓ","𝜺":"ꞓ","𝝐":"ꞓ","𝝴":"ꞓ","𝞊":"ꞓ","𝞮":"ꞓ","𝟄":"ꞓ","ⲉ":"ꞓ",є:"ꞓ","ԑ":"ꞓ","ꮛ":"ꞓ","𑣎":"ꞓ","𐐩":"ꞓ","€":"Ꞓ","Ⲉ":"Ꞓ",Є:"Ꞓ","⍷":"ꞓ̲","ͽ":"ꜿ","Ͽ":"Ꜿ","ⅾ":"d","ⅆ":"d","𝐝":"d","𝑑":"d","𝒅":"d","𝒹":"d","𝓭":"d","𝔡":"d","𝕕":"d","𝖉":"d","𝖽":"d","𝗱":"d","𝘥":"d","𝙙":"d","𝚍":"d","ԁ":"d",Ꮷ:"d",ᑯ:"d","ꓒ":"d","Ⅾ":"D","ⅅ":"D","𝐃":"D","𝐷":"D","𝑫":"D","𝒟":"D","𝓓":"D","𝔇":"D","𝔻":"D","𝕯":"D","𝖣":"D","𝗗":"D","𝘋":"D","𝘿":"D","𝙳":"D",Ꭰ:"D",ᗞ:"D",ᗪ:"D","ꓓ":"D",ɗ:"d̔",ɖ:"d̨",ƌ:"d̄",đ:"d̵",Đ:"D̵",Ð:"D̵",Ɖ:"D̵","₫":"ḏ̵","ꝺ":"Ꝺ",ᑻ:"d·",ᒇ:"d'",ʤ:"dȝ",ǳ:"dz",ʣ:"dz",ǲ:"Dz",Ǳ:"DZ",ǆ:"dž",ǅ:"Dž",Ǆ:"DŽ",ʥ:"dʑ","ꭰ":"ᴅ","⸹":"ẟ",δ:"ẟ","𝛅":"ẟ","𝛿":"ẟ","𝜹":"ẟ","𝝳":"ẟ","𝞭":"ẟ",ծ:"ẟ",ᕷ:"ẟ","℮":"e",ｅ:"e",ℯ:"e","ⅇ":"e","𝐞":"e","𝑒":"e","𝒆":"e","𝓮":"e","𝔢":"e","𝕖":"e","𝖊":"e","𝖾":"e","𝗲":"e","𝘦":"e","𝙚":"e","𝚎":"e","ꬲ":"e",е:"e",ҽ:"e","ⷷ":"ͤ","⋿":"E",Ｅ:"E",ℰ:"E","𝐄":"E","𝐸":"E","𝑬":"E","𝓔":"E","𝔈":"E","𝔼":"E","𝕰":"E","𝖤":"E","𝗘":"E","𝘌":"E","𝙀":"E","𝙴":"E",Ε:"E","𝚬":"E","𝛦":"E","𝜠":"E","𝝚":"E","𝞔":"E",Е:"E","ⴹ":"E",Ꭼ:"E","ꓰ":"E","𑢦":"E","𑢮":"E","𐊆":"E",ě:"ĕ",Ě:"Ĕ","ɇ":"e̸","Ɇ":"E̸",ҿ:"ę","ꭼ":"ᴇ",ə:"ǝ",ә:"ǝ","∃":"Ǝ","ⴺ":"Ǝ","ꓱ":"Ǝ",ɚ:"ǝ˞","ᴔ":"ǝo","ꭁ":"ǝo̸","ꭂ":"ǝo̵",Ә:"Ə","𝈡":"Ɛ",ℇ:"Ɛ","Ԑ":"Ɛ",Ꮛ:"Ɛ","𖼭":"Ɛ","𐐁":"Ɛ","ᶟ":"ᵋ","ᴈ":"ɜ",з:"ɜ",ҙ:"ɜ̦","𐑂":"ɞ","ꞝ":"ʚ","𐐪":"ʚ","𝐟":"f","𝑓":"f","𝒇":"f","𝒻":"f","𝓯":"f","𝔣":"f","𝕗":"f","𝖋":"f","𝖿":"f","𝗳":"f","𝘧":"f","𝙛":"f","𝚏":"f","ꬵ":"f","ꞙ":"f",ſ:"f","ẝ":"f",ք:"f","𝈓":"F",ℱ:"F","𝐅":"F","𝐹":"F","𝑭":"F","𝓕":"F","𝔉":"F","𝔽":"F","𝕱":"F","𝖥":"F","𝗙":"F","𝘍":"F","𝙁":"F","𝙵":"F","Ꞙ":"F",Ϝ:"F","𝟊":"F",ᖴ:"F","ꓝ":"F","𑣂":"F","𑢢":"F","𐊇":"F","𐊥":"F","𐔥":"F",ƒ:"f̦",Ƒ:"F̦","ᵮ":"f̴","℻":"FAX",ﬀ:"ff",ﬃ:"ffi",ﬄ:"ffl",ﬁ:"fi",ﬂ:"fl",ʩ:"fŋ",ᖵ:"Ⅎ","ꓞ":"Ⅎ","𝈰":"ꟻ",ᖷ:"ꟻ",ｇ:"g",ℊ:"g","𝐠":"g","𝑔":"g","𝒈":"g","𝓰":"g","𝔤":"g","𝕘":"g","𝖌":"g","𝗀":"g","𝗴":"g","𝘨":"g","𝙜":"g","𝚐":"g",ɡ:"g","ᶃ":"g",ƍ:"g",ց:"g","𝐆":"G","𝐺":"G","𝑮":"G","𝒢":"G","𝓖":"G","𝔊":"G","𝔾":"G","𝕲":"G","𝖦":"G","𝗚":"G","𝘎":"G","𝙂":"G","𝙶":"G","Ԍ":"G",Ꮐ:"G",Ᏻ:"G","ꓖ":"G","ᶢ":"ᵍ",ɠ:"g̔",ǧ:"ğ",Ǧ:"Ğ",ǵ:"ģ",ǥ:"g̵",Ǥ:"G̵",Ɠ:"G'","ԍ":"ɢ","ꮐ":"ɢ","ᏻ":"ɢ",ｈ:"h",ℎ:"h","𝐡":"h","𝒉":"h","𝒽":"h","𝓱":"h","𝔥":"h","𝕙":"h","𝖍":"h","𝗁":"h","𝗵":"h","𝘩":"h","𝙝":"h","𝚑":"h",һ:"h",հ:"h",Ꮒ:"h",Ｈ:"H",ℋ:"H",ℌ:"H",ℍ:"H","𝐇":"H","𝐻":"H","𝑯":"H","𝓗":"H","𝕳":"H","𝖧":"H","𝗛":"H","𝘏":"H","𝙃":"H","𝙷":"H",Η:"H","𝚮":"H","𝛨":"H","𝜢":"H","𝝜":"H","𝞖":"H","Ⲏ":"H",Н:"H",Ꮋ:"H",ᕼ:"H","ꓧ":"H","𐋏":"H","ᵸ":"ᴴ",ɦ:"h̔","ꚕ":"h̔",Ᏺ:"h̔","Ⱨ":"H̩",Ң:"H̩",ħ:"h̵",ℏ:"h̵",ћ:"h̵",Ħ:"H̵","Ӊ":"H̦",Ӈ:"H̦",н:"ʜ","ꮋ":"ʜ",ң:"ʜ̩","ӊ":"ʜ̦",ӈ:"ʜ̦","Ԋ":"Ƕ","ꮀ":"ⱶ","Ͱ":"Ⱶ",Ꭸ:"Ⱶ",Ꮀ:"Ⱶ","ꚱ":"Ⱶ","ꞕ":"ꜧ","˛":"i","⍳":"i",ｉ:"i","ⅰ":"i",ℹ:"i","ⅈ":"i","𝐢":"i","𝑖":"i","𝒊":"i","𝒾":"i","𝓲":"i","𝔦":"i","𝕚":"i","𝖎":"i","𝗂":"i","𝗶":"i","𝘪":"i","𝙞":"i","𝚒":"i",ı:"i","𝚤":"i",ɪ:"i",ɩ:"i",ι:"i",ι:"i",ͺ:"i","𝛊":"i","𝜄":"i","𝜾":"i","𝝸":"i","𝞲":"i",і:"i","ꙇ":"i","ӏ":"i","ꭵ":"i",Ꭵ:"i","𑣃":"i","ⓛ":"Ⓘ","⍸":"i̲",ǐ:"ĭ",Ǐ:"Ĭ",ɨ:"i̵","ᵻ":"i̵","ᵼ":"i̵","ⅱ":"ii","ⅲ":"iii",ĳ:"ij","ⅳ":"iv","ⅸ":"ix",ｊ:"j","ⅉ":"j","𝐣":"j","𝑗":"j","𝒋":"j","𝒿":"j","𝓳":"j","𝔧":"j","𝕛":"j","𝖏":"j","𝗃":"j","𝗷":"j","𝘫":"j","𝙟":"j","𝚓":"j",ϳ:"j",ј:"j",Ｊ:"J","𝐉":"J","𝐽":"J","𝑱":"J","𝒥":"J","𝓙":"J","𝔍":"J","𝕁":"J","𝕵":"J","𝖩":"J","𝗝":"J","𝘑":"J","𝙅":"J","𝙹":"J","Ʝ":"J","Ϳ":"J",Ј:"J",Ꭻ:"J",ᒍ:"J","ꓙ":"J","ɉ":"j̵","Ɉ":"J̵",ᒙ:"J·","𝚥":"ȷ",յ:"ȷ","ꭻ":"ᴊ","𝐤":"k","𝑘":"k","𝒌":"k","𝓀":"k","𝓴":"k","𝔨":"k","𝕜":"k","𝖐":"k","𝗄":"k","𝗸":"k","𝘬":"k","𝙠":"k","𝚔":"k",K:"K",Ｋ:"K","𝐊":"K","𝐾":"K","𝑲":"K","𝒦":"K","𝓚":"K","𝔎":"K","𝕂":"K","𝕶":"K","𝖪":"K","𝗞":"K","𝘒":"K","𝙆":"K","𝙺":"K",Κ:"K","𝚱":"K","𝛫":"K","𝜥":"K","𝝟":"K","𝞙":"K","Ⲕ":"K",К:"K",Ꮶ:"K",ᛕ:"K","ꓗ":"K","𐔘":"K",ƙ:"k̔","Ⱪ":"K̩",Қ:"K̩","₭":"K̵","Ꝁ":"K̵",Ҟ:"K̵",Ƙ:"K'","׀":"l","|":"l","∣":"l","⏽":"l","￨":"l","١":"l","۱":"l","𐌠":"l","𞣇":"l","𝟏":"l","𝟙":"l","𝟣":"l","𝟭":"l","𝟷":"l","🯱":"l",I:ove,Ｉ:"l","Ⅰ":"l",ℐ:"l",ℑ:"l","𝐈":"l","𝐼":"l","𝑰":"l","𝓘":"l","𝕀":"l","𝕴":"l","𝖨":"l","𝗜":"l","𝘐":"l","𝙄":"l","𝙸":"l",Ɩ:"l",ｌ:"l","ⅼ":"l",ℓ:"l","𝐥":"l","𝑙":"l","𝒍":"l","𝓁":"l","𝓵":"l","𝔩":"l","𝕝":"l","𝖑":"l","𝗅":"l","𝗹":"l","𝘭":"l","𝙡":"l","𝚕":"l",ǀ:"l",Ι:"l","𝚰":"l","𝛪":"l","𝜤":"l","𝝞":"l","𝞘":"l","Ⲓ":"l",І:"l",Ӏ:"l",ו:"l",ן:"l",ا:"l","𞸀":"l","𞺀":"l",ﺎ:"l",ﺍ:"l","ߊ":"l","ⵏ":"l",ᛁ:"l","ꓲ":"l","𖼨":"l","𐊊":"l","𐌉":"l","𝈪":"L","Ⅼ":"L",ℒ:"L","𝐋":"L","𝐿":"L","𝑳":"L","𝓛":"L","𝔏":"L","𝕃":"L","𝕷":"L","𝖫":"L","𝗟":"L","𝘓":"L","𝙇":"L","𝙻":"L","Ⳑ":"L",Ꮮ:"L",ᒪ:"L","ꓡ":"L","𖼖":"L","𑢣":"L","𑢲":"L","𐐛":"L","𐔦":"L",ﴼ:"l̋",ﴽ:"l̋",ł:"l̸",Ł:"L̸",ɭ:"l̨",Ɨ:"l̵",ƚ:"l̵",ɫ:"l̴",إ:"lٕ",ﺈ:"lٕ",ﺇ:"lٕ",ٳ:"lٕ",ŀ:"l·",Ŀ:"l·",ᒷ:"l·","🄂":"l,","⒈":"l.",ױ:"l'","⒓":"l2.","㏫":"l2日","㋋":"l2月","㍤":"l2点","⒔":"l3.","㏬":"l3日","㍥":"l3点","⒕":"l4.","㏭":"l4日","㍦":"l4点","⒖":"l5.","㏮":"l5日","㍧":"l5点","⒗":"l6.","㏯":"l6日","㍨":"l6点","⒘":"l7.","㏰":"l7日","㍩":"l7点","⒙":"l8.","㏱":"l8日","㍪":"l8点","⒚":"l9.","㏲":"l9日","㍫":"l9点",ǉ:"lj",Ĳ:"lJ",ǈ:"Lj",Ǉ:"LJ","‖":"ll","∥":"ll","Ⅱ":"ll",ǁ:"ll",װ:"ll","𐆙":"l̵l̵","⒒":"ll.","Ⅲ":"lll","𐆘":"l̵l̵S̵","㏪":"ll日","㋊":"ll月","㍣":"ll点",Ю:"lO","⒑":"lO.","㏩":"lO日","㋉":"lO月","㍢":"lO点",ʪ:"ls","₶":"lt","Ⅳ":"lV","Ⅸ":"lX",ɮ:"lȝ",ʫ:"lz",أ:"lٴ",ﺄ:"lٴ",ﺃ:"lٴ",ٲ:"lٴ",ٵ:"lٴ",ﷳ:"lكبر",ﷲ:"lللّٰo","㏠":"l日","㋀":"l月","㍙":"l点","ⳑ":"ʟ","ꮮ":"ʟ","𐑃":"ʟ",Ｍ:"M","Ⅿ":"M",ℳ:"M","𝐌":"M","𝑀":"M","𝑴":"M","𝓜":"M","𝔐":"M","𝕄":"M","𝕸":"M","𝖬":"M","𝗠":"M","𝘔":"M","𝙈":"M","𝙼":"M",Μ:"M","𝚳":"M","𝛭":"M","𝜧":"M","𝝡":"M","𝞛":"M","Ϻ":"M","Ⲙ":"M",М:"M",Ꮇ:"M",ᗰ:"M",ᛖ:"M","ꓟ":"M","𐊰":"M","𐌑":"M","Ӎ":"M̦","🝫":"MB","ⷨ":"ᷟ","𝐧":"n","𝑛":"n","𝒏":"n","𝓃":"n","𝓷":"n","𝔫":"n","𝕟":"n","𝖓":"n","𝗇":"n","𝗻":"n","𝘯":"n","𝙣":"n","𝚗":"n",ո:"n",ռ:"n",Ｎ:"N",ℕ:"N","𝐍":"N","𝑁":"N","𝑵":"N","𝒩":"N","𝓝":"N","𝔑":"N","𝕹":"N","𝖭":"N","𝗡":"N","𝘕":"N","𝙉":"N","𝙽":"N",Ν:"N","𝚴":"N","𝛮":"N","𝜨":"N","𝝢":"N","𝞜":"N","Ⲛ":"N","ꓠ":"N","𐔓":"N","𐆎":"N̊",ɳ:"n̨",ƞ:"n̩",η:"n̩","𝛈":"n̩","𝜂":"n̩","𝜼":"n̩","𝝶":"n̩","𝞰":"n̩",Ɲ:"N̦","ᵰ":"n̴",ǌ:"nj",ǋ:"Nj",Ǌ:"NJ","№":"No","ͷ":"ᴎ",и:"ᴎ","𐑍":"ᴎ",ņ:"ɲ","ం":"o","ಂ":"o","ം":"o","ං":"o","०":"o","੦":"o","૦":"o","௦":"o","౦":"o","೦":"o","൦":"o","๐":"o","໐":"o","၀":"o","٥":"o","۵":"o",ｏ:"o",ℴ:"o","𝐨":"o","𝑜":"o","𝒐":"o","𝓸":"o","𝔬":"o","𝕠":"o","𝖔":"o","𝗈":"o","𝗼":"o","𝘰":"o","𝙤":"o","𝚘":"o","ᴏ":"o","ᴑ":"o","ꬽ":"o",ο:"o","𝛐":"o","𝜊":"o","𝝄":"o","𝝾":"o","𝞸":"o",σ:"o","𝛔":"o","𝜎":"o","𝝈":"o","𝞂":"o","𝞼":"o","ⲟ":"o",о:"o","ჿ":"o",օ:"o",ס:"o",ه:"o","𞸤":"o","𞹤":"o","𞺄":"o",ﻫ:"o",ﻬ:"o",ﻪ:"o",ﻩ:"o",ھ:"o",ﮬ:"o",ﮭ:"o",ﮫ:"o",ﮪ:"o",ہ:"o",ﮨ:"o",ﮩ:"o",ﮧ:"o",ﮦ:"o",ە:"o",ഠ:"o",ဝ:"o","𐓪":"o","𑣈":"o","𑣗":"o","𐐬":"o","߀":"O","০":"O","୦":"O","〇":"O","𑓐":"O","𑣠":"O","𝟎":"O","𝟘":"O","𝟢":"O","𝟬":"O","𝟶":"O","🯰":"O",Ｏ:"O","𝐎":"O","𝑂":"O","𝑶":"O","𝒪":"O","𝓞":"O","𝔒":"O","𝕆":"O","𝕺":"O","𝖮":"O","𝗢":"O","𝘖":"O","𝙊":"O","𝙾":"O",Ο:"O","𝚶":"O","𝛰":"O","𝜪":"O","𝝤":"O","𝞞":"O","Ⲟ":"O",О:"O",Օ:"O","ⵔ":"O",ዐ:"O",ଠ:"O","𐓂":"O","ꓳ":"O","𑢵":"O","𐊒":"O","𐊫":"O","𐐄":"O","𐔖":"O","⁰":"º","ᵒ":"º",ǒ:"ŏ",Ǒ:"Ŏ","ۿ":"ô",Ő:"Ö",ø:"o̸","ꬾ":"o̸",Ø:"O̸","ⵁ":"O̸",Ǿ:"Ó̸",ɵ:"o̵","ꝋ":"o̵",ө:"o̵",ѳ:"o̵","ꮎ":"o̵","ꮻ":"o̵","⊖":"O̵","⊝":"O̵","⍬":"O̵","𝈚":"O̵","🜔":"O̵",Ɵ:"O̵","Ꝋ":"O̵",θ:"O̵",ϑ:"O̵","𝛉":"O̵","𝛝":"O̵","𝜃":"O̵","𝜗":"O̵","𝜽":"O̵","𝝑":"O̵","𝝷":"O̵","𝞋":"O̵","𝞱":"O̵","𝟅":"O̵",Θ:"O̵","ϴ":"O̵","𝚯":"O̵","𝚹":"O̵","𝛩":"O̵","𝛳":"O̵","𝜣":"O̵","𝜭":"O̵","𝝝":"O̵","𝝧":"O̵","𝞗":"O̵","𝞡":"O̵",Ө:"O̵",Ѳ:"O̵","ⴱ":"O̵",Ꮎ:"O̵",Ꮻ:"O̵","ꭴ":"ơ",ﳙ:"oٰ","🄁":"O,","🄀":"O.",ơ:"o'",Ơ:"O'",Ꭴ:"O'","%":"º/₀","٪":"º/₀","⁒":"º/₀","‰":"º/₀₀","؉":"º/₀₀","‱":"º/₀₀₀","؊":"º/₀₀₀",œ:"oe",Œ:"OE",ɶ:"oᴇ","∞":"oo","ꝏ":"oo","ꚙ":"oo","Ꝏ":"OO","Ꚙ":"OO",ﳗ:"oج",ﱑ:"oج",ﳘ:"oم",ﱒ:"oم",ﶓ:"oمج",ﶔ:"oمم",ﱓ:"oى",ﱔ:"oى","ൟ":"oരo",တ:"oာ","㍘":"O点","ↄ":"ɔ","ᴐ":"ɔ","ͻ":"ɔ","𐑋":"ɔ","Ↄ":"Ɔ","Ͻ":"Ɔ","ꓛ":"Ɔ","𐐣":"Ɔ","ꬿ":"ɔ̸","ꭢ":"ɔe","𐐿":"ɷ","⍴":"p",ｐ:"p","𝐩":"p","𝑝":"p","𝒑":"p","𝓅":"p","𝓹":"p","𝔭":"p","𝕡":"p","𝖕":"p","𝗉":"p","𝗽":"p","𝘱":"p","𝙥":"p","𝚙":"p",ρ:"p",ϱ:"p","𝛒":"p","𝛠":"p","𝜌":"p","𝜚":"p","𝝆":"p","𝝔":"p","𝞀":"p","𝞎":"p","𝞺":"p","𝟈":"p","ⲣ":"p",р:"p",Ｐ:"P",ℙ:"P","𝐏":"P","𝑃":"P","𝑷":"P","𝒫":"P","𝓟":"P","𝔓":"P","𝕻":"P","𝖯":"P","𝗣":"P","𝘗":"P","𝙋":"P","𝙿":"P",Ρ:"P","𝚸":"P","𝛲":"P","𝜬":"P","𝝦":"P","𝞠":"P","Ⲣ":"P",Р:"P",Ꮲ:"P",ᑭ:"P","ꓑ":"P","𐊕":"P",ƥ:"p̔","ᵽ":"p̵",ᑷ:"p·",ᒆ:"P'","ᴩ":"ᴘ","ꮲ":"ᴘ",φ:"ɸ",ϕ:"ɸ","𝛗":"ɸ","𝛟":"ɸ","𝜑":"ɸ","𝜙":"ɸ","𝝋":"ɸ","𝝓":"ɸ","𝞅":"ɸ","𝞍":"ɸ","𝞿":"ɸ","𝟇":"ɸ","ⲫ":"ɸ",ф:"ɸ","𝐪":"q","𝑞":"q","𝒒":"q","𝓆":"q","𝓺":"q","𝔮":"q","𝕢":"q","𝖖":"q","𝗊":"q","𝗾":"q","𝘲":"q","𝙦":"q","𝚚":"q","ԛ":"q",գ:"q",զ:"q",ℚ:"Q","𝐐":"Q","𝑄":"Q","𝑸":"Q","𝒬":"Q","𝓠":"Q","𝔔":"Q","𝕼":"Q","𝖰":"Q","𝗤":"Q","𝘘":"Q","𝙌":"Q","𝚀":"Q","ⵕ":"Q",ʠ:"q̔","🜀":"QE","ᶐ":"ɋ","ᴋ":"ĸ",κ:"ĸ",ϰ:"ĸ","𝛋":"ĸ","𝛞":"ĸ","𝜅":"ĸ","𝜘":"ĸ","𝜿":"ĸ","𝝒":"ĸ","𝝹":"ĸ","𝞌":"ĸ","𝞳":"ĸ","𝟆":"ĸ","ⲕ":"ĸ",к:"ĸ","ꮶ":"ĸ",қ:"ĸ̩",ҟ:"ĸ̵","𝐫":"r","𝑟":"r","𝒓":"r","𝓇":"r","𝓻":"r","𝔯":"r","𝕣":"r","𝖗":"r","𝗋":"r","𝗿":"r","𝘳":"r","𝙧":"r","𝚛":"r","ꭇ":"r","ꭈ":"r","ᴦ":"r","ⲅ":"r",г:"r","ꮁ":"r","𝈖":"R",ℛ:"R",ℜ:"R",ℝ:"R","𝐑":"R","𝑅":"R","𝑹":"R","𝓡":"R","𝕽":"R","𝖱":"R","𝗥":"R","𝘙":"R","𝙍":"R","𝚁":"R",Ʀ:"R",Ꭱ:"R",Ꮢ:"R","𐒴":"R",ᖇ:"R","ꓣ":"R","𖼵":"R",ɽ:"r̨",ɼ:"r̩","ɍ":"r̵",ғ:"r̵","ᵲ":"r̴",ґ:"r'","𑣣":"rn",m:ave,"ⅿ":"rn","𝐦":"rn","𝑚":"rn","𝒎":"rn","𝓂":"rn","𝓶":"rn","𝔪":"rn","𝕞":"rn","𝖒":"rn","𝗆":"rn","𝗺":"rn","𝘮":"rn","𝙢":"rn","𝚖":"rn","𑜀":"rn","₥":"rn̸",ɱ:"rn̦","ᵯ":"rn̴","₨":"Rs","ꭱ":"ʀ","ꮢ":"ʀ",я:"ᴙ","ᵳ":"ɾ̴","℩":"ɿ",ｓ:"s","𝐬":"s","𝑠":"s","𝒔":"s","𝓈":"s","𝓼":"s","𝔰":"s","𝕤":"s","𝖘":"s","𝗌":"s","𝘀":"s","𝘴":"s","𝙨":"s","𝚜":"s","ꜱ":"s",ƽ:"s",ѕ:"s","ꮪ":"s","𑣁":"s","𐑈":"s",Ｓ:"S","𝐒":"S","𝑆":"S","𝑺":"S","𝒮":"S","𝓢":"S","𝔖":"S","𝕊":"S","𝕾":"S","𝖲":"S","𝗦":"S","𝘚":"S","𝙎":"S","𝚂":"S",Ѕ:"S",Տ:"S",Ꮥ:"S",Ꮪ:"S","ꓢ":"S","𖼺":"S","𐊖":"S","𐐠":"S",ʂ:"s̨","ᵴ":"s̴","ꞵ":"ß",β:"ß",ϐ:"ß","𝛃":"ß","𝛽":"ß","𝜷":"ß","𝝱":"ß","𝞫":"ß",Ᏸ:"ß","🝜":"sss",ﬆ:"st","∫":"ʃ","ꭍ":"ʃ","∑":"Ʃ","⅀":"Ʃ",Σ:"Ʃ","𝚺":"Ʃ","𝛴":"Ʃ","𝜮":"Ʃ","𝝨":"Ʃ","𝞢":"Ʃ","ⵉ":"Ʃ","∬":"ʃʃ","∭":"ʃʃʃ","⨌":"ʃʃʃʃ","𝐭":"t","𝑡":"t","𝒕":"t","𝓉":"t","𝓽":"t","𝔱":"t","𝕥":"t","𝖙":"t","𝗍":"t","𝘁":"t","𝘵":"t","𝙩":"t","𝚝":"t","⊤":"T","⟙":"T","🝨":"T",Ｔ:"T","𝐓":"T","𝑇":"T","𝑻":"T","𝒯":"T","𝓣":"T","𝔗":"T","𝕋":"T","𝕿":"T","𝖳":"T","𝗧":"T","𝘛":"T","𝙏":"T","𝚃":"T",Τ:"T","𝚻":"T","𝛵":"T","𝜯":"T","𝝩":"T","𝞣":"T","Ⲧ":"T",Т:"T",Ꭲ:"T","ꓔ":"T","𖼊":"T","𑢼":"T","𐊗":"T","𐊱":"T","𐌕":"T",ƭ:"t̔","⍡":"T̈","Ⱦ":"T̸",Ț:"Ţ",Ʈ:"T̨",Ҭ:"T̩","₮":"T⃫",ŧ:"t̵",Ŧ:"T̵","ᵵ":"t̴",Ⴀ:"Ꞇ","Ꜩ":"T3",ʨ:"tɕ","℡":"TEL","ꝷ":"tf",ʦ:"ts",ʧ:"tʃ","ꜩ":"tȝ",τ:"ᴛ","𝛕":"ᴛ","𝜏":"ᴛ","𝝉":"ᴛ","𝞃":"ᴛ","𝞽":"ᴛ",т:"ᴛ","ꭲ":"ᴛ",ҭ:"ᴛ̩",ţ:"ƫ",ț:"ƫ",Ꮏ:"ƫ","𝐮":"u","𝑢":"u","𝒖":"u","𝓊":"u","𝓾":"u","𝔲":"u","𝕦":"u","𝖚":"u","𝗎":"u","𝘂":"u","𝘶":"u","𝙪":"u","𝚞":"u","ꞟ":"u","ᴜ":"u","ꭎ":"u","ꭒ":"u",ʋ:"u",υ:"u","𝛖":"u","𝜐":"u","𝝊":"u","𝞄":"u","𝞾":"u",ս:"u","𐓶":"u","𑣘":"u","∪":"U","⋃":"U","𝐔":"U","𝑈":"U","𝑼":"U","𝒰":"U","𝓤":"U","𝔘":"U","𝕌":"U","𝖀":"U","𝖴":"U","𝗨":"U","𝘜":"U","𝙐":"U","𝚄":"U",Ս:"U",ሀ:"U","𐓎":"U",ᑌ:"U","ꓴ":"U","𖽂":"U","𑢸":"U",ǔ:"ŭ",Ǔ:"Ŭ","ᵾ":"u̵","ꮜ":"u̵","Ʉ":"U̵",Ꮜ:"U̵",ᑘ:"U·",ᑧ:"U'","ᵫ":"ue","ꭣ":"uo",ṃ:"ꭑ",պ:"ɰ",ሣ:"ɰ","℧":"Ʊ",ᘮ:"Ʊ",ᘴ:"Ʊ","ᵿ":"ʊ̵","∨":"v","⋁":"v",ｖ:"v","ⅴ":"v","𝐯":"v","𝑣":"v","𝒗":"v","𝓋":"v","𝓿":"v","𝔳":"v","𝕧":"v","𝖛":"v","𝗏":"v","𝘃":"v","𝘷":"v","𝙫":"v","𝚟":"v","ᴠ":"v",ν:"v","𝛎":"v","𝜈":"v","𝝂":"v","𝝼":"v","𝞶":"v",ѵ:"v",ט:"v","𑜆":"v","ꮩ":"v","𑣀":"v","𝈍":"V","٧":"V","۷":"V","Ⅴ":"V","𝐕":"V","𝑉":"V","𝑽":"V","𝒱":"V","𝓥":"V","𝔙":"V","𝕍":"V","𝖁":"V","𝖵":"V","𝗩":"V","𝘝":"V","𝙑":"V","𝚅":"V",Ѵ:"V","ⴸ":"V",Ꮩ:"V",ᐯ:"V","ꛟ":"V","ꓦ":"V","𖼈":"V","𑢠":"V","𐔝":"V","𐆗":"V̵",ᐻ:"V·","🝬":"VB","ⅵ":"vi","ⅶ":"vii","ⅷ":"viii","Ⅵ":"Vl","Ⅶ":"Vll","Ⅷ":"Vlll","🜈":"Vᷤ","ᴧ":"ʌ","𐓘":"ʌ","٨":"Ʌ","۸":"Ʌ",Λ:"Ʌ","𝚲":"Ʌ","𝛬":"Ʌ","𝜦":"Ʌ","𝝠":"Ʌ","𝞚":"Ʌ",Л:"Ʌ","ⴷ":"Ʌ","𐒰":"Ʌ",ᐱ:"Ʌ","ꛎ":"Ʌ","ꓥ":"Ʌ","𖼽":"Ʌ","𐊍":"Ʌ","Ӆ":"Ʌ̦",ᐽ:"Ʌ·",ɯ:"w","𝐰":"w","𝑤":"w","𝒘":"w","𝓌":"w","𝔀":"w","𝔴":"w","𝕨":"w","𝖜":"w","𝗐":"w","𝘄":"w","𝘸":"w","𝙬":"w","𝚠":"w","ᴡ":"w",ѡ:"w","ԝ":"w",ա:"w","𑜊":"w","𑜎":"w","𑜏":"w","ꮃ":"w","𑣯":"W","𑣦":"W","𝐖":"W","𝑊":"W","𝑾":"W","𝒲":"W","𝓦":"W","𝔚":"W","𝕎":"W","𝖂":"W","𝖶":"W","𝗪":"W","𝘞":"W","𝙒":"W","𝚆":"W","Ԝ":"W",Ꮃ:"W",Ꮤ:"W","ꓪ":"W",ѽ:"w҆҇","𑓅":"ẇ","₩":"W̵","ꝡ":"w̦","ᴍ":"ʍ",м:"ʍ","ꮇ":"ʍ","ӎ":"ʍ̦","᙮":"x","×":"x","⤫":"x","⤬":"x","⨯":"x",ｘ:"x","ⅹ":"x","𝐱":"x","𝑥":"x","𝒙":"x","𝓍":"x","𝔁":"x","𝔵":"x","𝕩":"x","𝖝":"x","𝗑":"x","𝘅":"x","𝘹":"x","𝙭":"x","𝚡":"x",х:"x",ᕁ:"x",ᕽ:"x","ⷯ":"ͯ","᙭":"X","╳":"X","𐌢":"X","𑣬":"X",Ｘ:"X","Ⅹ":"X","𝐗":"X","𝑋":"X","𝑿":"X","𝒳":"X","𝓧":"X","𝔛":"X","𝕏":"X","𝖃":"X","𝖷":"X","𝗫":"X","𝘟":"X","𝙓":"X","𝚇":"X","Ꭓ":"X",Χ:"X","𝚾":"X","𝛸":"X","𝜲":"X","𝝬":"X","𝞦":"X","Ⲭ":"X",Х:"X","ⵝ":"X",ᚷ:"X","ꓫ":"X","𐊐":"X","𐊴":"X","𐌗":"X","𐔧":"X","⨰":"ẋ",Ҳ:"X̩","𐆖":"X̵","ⅺ":"xi","ⅻ":"xii","Ⅺ":"Xl","Ⅻ":"Xll",ɣ:"y","ᶌ":"y",ｙ:"y","𝐲":"y","𝑦":"y","𝒚":"y","𝓎":"y","𝔂":"y","𝔶":"y","𝕪":"y","𝖞":"y","𝗒":"y","𝘆":"y","𝘺":"y","𝙮":"y","𝚢":"y",ʏ:"y","ỿ":"y","ꭚ":"y",γ:"y","ℽ":"y","𝛄":"y","𝛾":"y","𝜸":"y","𝝲":"y","𝞬":"y",у:"y",ү:"y",ყ:"y","𑣜":"y",Ｙ:"Y","𝐘":"Y","𝑌":"Y","𝒀":"Y","𝒴":"Y","𝓨":"Y","𝔜":"Y","𝕐":"Y","𝖄":"Y","𝖸":"Y","𝗬":"Y","𝘠":"Y","𝙔":"Y","𝚈":"Y",Υ:"Y",ϒ:"Y","𝚼":"Y","𝛶":"Y","𝜰":"Y","𝝪":"Y","𝞤":"Y","Ⲩ":"Y",У:"Y",Ү:"Y",Ꭹ:"Y",Ꮍ:"Y","ꓬ":"Y","𖽃":"Y","𑢤":"Y","𐊲":"Y",ƴ:"y̔","ɏ":"y̵",ұ:"y̵","¥":"Y̵","Ɏ":"Y̵",Ұ:"Y̵",ʒ:"ȝ","ꝫ":"ȝ","ⳍ":"ȝ",ӡ:"ȝ",ჳ:"ȝ","𝐳":"z","𝑧":"z","𝒛":"z","𝓏":"z","𝔃":"z","𝔷":"z","𝕫":"z","𝖟":"z","𝗓":"z","𝘇":"z","𝘻":"z","𝙯":"z","𝚣":"z","ᴢ":"z","ꮓ":"z","𑣄":"z","𐋵":"Z","𑣥":"Z",Ｚ:"Z",ℤ:"Z",ℨ:"Z","𝐙":"Z","𝑍":"Z","𝒁":"Z","𝒵":"Z","𝓩":"Z","𝖅":"Z","𝖹":"Z","𝗭":"Z","𝘡":"Z","𝙕":"Z","𝚉":"Z",Ζ:"Z","𝚭":"Z","𝛧":"Z","𝜡":"Z","𝝛":"Z","𝞕":"Z",Ꮓ:"Z","ꓜ":"Z","𑢩":"Z",ʐ:"z̨",ƶ:"z̵",Ƶ:"Z̵",ȥ:"z̦",Ȥ:"Z̦","ᵶ":"z̴",ƿ:"þ","ϸ":"þ","Ϸ":"Þ","𐓄":"Þ","⁹":"ꝰ","ᴤ":"ƨ",ϩ:"ƨ","ꙅ":"ƨ",ь:"ƅ","ꮟ":"ƅ",ы:"ƅi","ꭾ":"ɂ",ˤ:"ˁ","ꛍ":"ʡ","⊙":"ʘ","☉":"ʘ","⨀":"ʘ","Ꙩ":"ʘ","ⵙ":"ʘ","𐓃":"ʘ","ℾ":"Γ","𝚪":"Γ","𝛤":"Γ","𝜞":"Γ","𝝘":"Γ","𝞒":"Γ","Ⲅ":"Γ",Г:"Γ",Ꮁ:"Γ",ᒥ:"Γ","𖼇":"Γ",Ғ:"Γ̵",ᒯ:"Γ·",Ґ:"Γ'","∆":"Δ","△":"Δ","🜂":"Δ","𝚫":"Δ","𝛥":"Δ","𝜟":"Δ","𝝙":"Δ","𝞓":"Δ","Ⲇ":"Δ","ⵠ":"Δ",ᐃ:"Δ","𖼚":"Δ","𐊅":"Δ","𐊣":"Δ","⍙":"Δ̲",ᐏ:"Δ·",ᐬ:"Δᐠ","𝟋":"ϝ","𝛇":"ζ","𝜁":"ζ","𝜻":"ζ","𝝵":"ζ","𝞯":"ζ","ⳤ":"ϗ","𝛌":"λ","𝜆":"λ","𝝀":"λ","𝝺":"λ","𝞴":"λ","Ⲗ":"λ","𐓛":"λ",µ:"μ","𝛍":"μ","𝜇":"μ","𝝁":"μ","𝝻":"μ","𝞵":"μ","𝛏":"ξ","𝜉":"ξ","𝝃":"ξ","𝝽":"ξ","𝞷":"ξ","𝚵":"Ξ","𝛯":"Ξ","𝜩":"Ξ","𝝣":"Ξ","𝞝":"Ξ",ϖ:"π","ℼ":"π","𝛑":"π","𝛡":"π","𝜋":"π","𝜛":"π","𝝅":"π","𝝕":"π","𝝿":"π","𝞏":"π","𝞹":"π","𝟉":"π","ᴨ":"π",п:"π","∏":"Π","ℿ":"Π","𝚷":"Π","𝛱":"Π","𝜫":"Π","𝝥":"Π","𝞟":"Π","Ⲡ":"Π",П:"Π","ꛛ":"Π","𐊭":"Ϙ","𐌒":"Ϙ",ϛ:"ς","𝛓":"ς","𝜍":"ς","𝝇":"ς","𝞁":"ς","𝞻":"ς","𝚽":"Φ","𝛷":"Φ","𝜱":"Φ","𝝫":"Φ","𝞥":"Φ","Ⲫ":"Φ",Ф:"Φ",Փ:"Φ",ቀ:"Φ","ᛰ":"Φ","𐊳":"Φ","ꭓ":"χ","ꭕ":"χ","𝛘":"χ","𝜒":"χ","𝝌":"χ","𝞆":"χ","𝟀":"χ","ⲭ":"χ","𝛙":"ψ","𝜓":"ψ","𝝍":"ψ","𝞇":"ψ","𝟁":"ψ",ѱ:"ψ","𐓹":"ψ","𝚿":"Ψ","𝛹":"Ψ","𝜳":"Ψ","𝝭":"Ψ","𝞧":"Ψ","Ⲯ":"Ψ",Ѱ:"Ψ","𐓑":"Ψ",ᛘ:"Ψ","𐊵":"Ψ","⍵":"ω","ꞷ":"ω","𝛚":"ω","𝜔":"ω","𝝎":"ω","𝞈":"ω","𝟂":"ω","ⲱ":"ω","ꙍ":"ω",Ω:"Ω","𝛀":"Ω","𝛺":"Ω","𝜴":"Ω","𝝮":"Ω","𝞨":"Ω",ᘯ:"Ω",ᘵ:"Ω","𐊶":"Ω","⍹":"ω̲",ώ:"ῴ","☰":"Ⲷ","Ⳝ":"Ϭ",җ:"ж̩",Җ:"Ж̩","𝈋":"И","Ͷ":"И","ꚡ":"И","𐐥":"И",Й:"Ѝ","Ҋ":"Ѝ̦",ѝ:"й","ҋ":"й̦","𐒼":"Ӄ","ᴫ":"л","ӆ":"л̦","ꭠ":"љ","𐓫":"ꙩ","ᷮ":"ⷬ","𐓍":"Ћ","𝈂":"Ӿ","𝈢":"Ѡ",Ꮗ:"Ѡ",ᗯ:"Ѡ",Ѽ:"Ѡ҆҇","ᣭ":"Ѡ·","Ꞷ":"Ꙍ",ӌ:"ҷ",Ӌ:"Ҷ",Ҿ:"Ҽ̨","ⲽ":"ш","Ⲽ":"Ш","Ꙑ":"Ъl","℈":"Э","🜁":"Ꙙ","𖼜":"Ꙙ","ꦒ":"ⰿ",և:"եւ",ኔ:"ձ",ﬔ:"մե",ﬕ:"մի",ﬗ:"մխ",ﬓ:"մն","∩":"Ո","⋂":"Ո","𝉅":"Ո",በ:"Ո",ᑎ:"Ո","ꓵ":"Ո",ᑚ:"Ո·",ᑨ:"Ո'",ﬖ:"վն","₽":"Ք","˓":"ՙ",ʿ:"ՙ",ℵ:"א",ﬡ:"א",אָ:"אַ",אּ:"אַ",ﭏ:"אל",ℶ:"ב",ℷ:"ג",ℸ:"ד",ﬢ:"ד",ﬣ:"ה",יּ:"יִ",ﬤ:"כ",ﬥ:"ל",ﬦ:"ם",ﬠ:"ע",ﬧ:"ר",שׂ:"שׁ",שּ:"שׁ",שּׂ:"שּׁ",ﬨ:"ת",ﺀ:"ء","۽":"ء͈",ﺂ:"آ",ﺁ:"آ",ﭑ:"ٱ",ﭐ:"ٱ","𞸁":"ب","𞸡":"ب","𞹡":"ب","𞺁":"ب","𞺡":"ب",ﺑ:"ب",ﺒ:"ب",ﺐ:"ب",ﺏ:"ب","ݑ":"بۛ","ࢶ":"بۢ","ࢡ":"بٔ",ﲠ:"بo",ﳢ:"بo",ﲜ:"بج",ﰅ:"بج",ﲝ:"بح",ﰆ:"بح",ﷂ:"بحى",ﲞ:"بخ",ﰇ:"بخ",ﳒ:"بخ",ﱋ:"بخ",ﶞ:"بخى",ﱪ:"بر",ﱫ:"بز",ﲟ:"بم",ﳡ:"بم",ﱬ:"بم",ﰈ:"بم",ﱭ:"بن",ﱮ:"بى",ﰉ:"بى",ﱯ:"بى",ﰊ:"بى",ﭔ:"ٻ",ﭕ:"ٻ",ﭓ:"ٻ",ﭒ:"ٻ",ې:"ٻ",ﯦ:"ٻ",ﯧ:"ٻ",ﯥ:"ٻ",ﯤ:"ٻ",ﭜ:"ڀ",ﭝ:"ڀ",ﭛ:"ڀ",ﭚ:"ڀ","ࢩ":"ݔ","ݧ":"ݔ","⍥":"ة",ö:"ة",ﺔ:"ة",ﺓ:"ة",ۃ:"ة","𞸕":"ت","𞸵":"ت","𞹵":"ت","𞺕":"ت","𞺵":"ت",ﺗ:"ت",ﺘ:"ت",ﺖ:"ت",ﺕ:"ت",ﲥ:"تo",ﳤ:"تo",ﲡ:"تج",ﰋ:"تج",ﵐ:"تجم",ﶠ:"تجى",ﶟ:"تجى",ﲢ:"تح",ﰌ:"تح",ﵒ:"تحج",ﵑ:"تحج",ﵓ:"تحم",ﲣ:"تخ",ﰍ:"تخ",ﵔ:"تخم",ﶢ:"تخى",ﶡ:"تخى",ﱰ:"تر",ﱱ:"تز",ﲤ:"تم",ﳣ:"تم",ﱲ:"تم",ﰎ:"تم",ﵕ:"تمج",ﵖ:"تمح",ﵗ:"تمخ",ﶤ:"تمى",ﶣ:"تمى",ﱳ:"تن",ﱴ:"تى",ﰏ:"تى",ﱵ:"تى",ﰐ:"تى",ﭠ:"ٺ",ﭡ:"ٺ",ﭟ:"ٺ",ﭞ:"ٺ",ﭤ:"ٿ",ﭥ:"ٿ",ﭣ:"ٿ",ﭢ:"ٿ","𞸂":"ج","𞸢":"ج","𞹂":"ج","𞹢":"ج","𞺂":"ج","𞺢":"ج",ﺟ:"ج",ﺠ:"ج",ﺞ:"ج",ﺝ:"ج",ﲧ:"جح",ﰕ:"جح",ﶦ:"جحى",ﶾ:"جحى",ﷻ:"جل جلlلo",ﲨ:"جم",ﰖ:"جم",ﵙ:"جمح",ﵘ:"جمح",ﶧ:"جمى",ﶥ:"جمى",ﴝ:"جى",ﴁ:"جى",ﴞ:"جى",ﴂ:"جى",ﭸ:"ڃ",ﭹ:"ڃ",ﭷ:"ڃ",ﭶ:"ڃ",ﭴ:"ڄ",ﭵ:"ڄ",ﭳ:"ڄ",ﭲ:"ڄ",ﭼ:"چ",ﭽ:"چ",ﭻ:"چ",ﭺ:"چ",ﮀ:"ڇ",ﮁ:"ڇ",ﭿ:"ڇ",ﭾ:"ڇ","𞸇":"ح","𞸧":"ح","𞹇":"ح","𞹧":"ح","𞺇":"ح","𞺧":"ح",ﺣ:"ح",ﺤ:"ح",ﺢ:"ح",ﺡ:"ح",څ:"حۛ",ځ:"حٔ","ݲ":"حٔ",ﲩ:"حج",ﰗ:"حج",ﶿ:"حجى",ﲪ:"حم",ﰘ:"حم",ﵛ:"حمى",ﵚ:"حمى",ﴛ:"حى",ﳿ:"حى",ﴜ:"حى",ﴀ:"حى","𞸗":"خ","𞸷":"خ","𞹗":"خ","𞹷":"خ","𞺗":"خ","𞺷":"خ",ﺧ:"خ",ﺨ:"خ",ﺦ:"خ",ﺥ:"خ",ﲫ:"خج",ﰙ:"خج",ﰚ:"خح",ﲬ:"خم",ﰛ:"خم",ﴟ:"خى",ﴃ:"خى",ﴠ:"خى",ﴄ:"خى","𐋡":"د","𞸃":"د","𞺃":"د","𞺣":"د",ﺪ:"د",ﺩ:"د",ڈ:"دؕ",ﮉ:"دؕ",ﮈ:"دؕ",ڎ:"دۛ",ﮇ:"دۛ",ﮆ:"دۛ","ۮ":"د̂","ࢮ":"د̤̣","𞸘":"ذ","𞺘":"ذ","𞺸":"ذ",ﺬ:"ذ",ﺫ:"ذ",ﱛ:"ذٰ",ڋ:"ڊؕ",ﮅ:"ڌ",ﮄ:"ڌ",ﮃ:"ڍ",ﮂ:"ڍ","𞸓":"ر","𞺓":"ر","𞺳":"ر",ﺮ:"ر",ﺭ:"ر",ڑ:"رؕ",ﮍ:"رؕ",ﮌ:"رؕ",ژ:"رۛ",ﮋ:"رۛ",ﮊ:"رۛ",ڒ:"ر̆","ࢹ":"ر̆̇","ۯ":"ر̂","ݬ":"رٔ",ﱜ:"رٰ",ﷶ:"رسول","﷼":"رىlل","𞸆":"ز","𞺆":"ز","𞺦":"ز",ﺰ:"ز",ﺯ:"ز","ࢲ":"ز̂","ݱ":"ڗؕ","𞸎":"س","𞸮":"س","𞹎":"س","𞹮":"س","𞺎":"س","𞺮":"س",ﺳ:"س",ﺴ:"س",ﺲ:"س",ﺱ:"س",ش:"سۛ","𞸔":"سۛ","𞸴":"سۛ","𞹔":"سۛ","𞹴":"سۛ","𞺔":"سۛ","𞺴":"سۛ",ﺷ:"سۛ",ﺸ:"سۛ",ﺶ:"سۛ",ﺵ:"سۛ","ݾ":"س̂",ﴱ:"سo",ﳨ:"سo",ﴲ:"سۛo",ﳪ:"سۛo",ﲭ:"سج",ﴴ:"سج",ﰜ:"سج",ﴭ:"سۛج",ﴷ:"سۛج",ﴥ:"سۛج",ﴉ:"سۛج",ﵝ:"سجح",ﵞ:"سجى",ﵩ:"سۛجى",ﲮ:"سح",ﴵ:"سح",ﰝ:"سح",ﴮ:"سۛح",ﴸ:"سۛح",ﴦ:"سۛح",ﴊ:"سۛح",ﵜ:"سحج",ﵨ:"سۛحم",ﵧ:"سۛحم",ﶪ:"سۛحى",ﲯ:"سخ",ﴶ:"سخ",ﰞ:"سخ",ﴯ:"سۛخ",ﴹ:"سۛخ",ﴧ:"سۛخ",ﴋ:"سۛخ",ﶨ:"سخى",ﷆ:"سخى",ﴪ:"سر",ﴎ:"سر",ﴩ:"سۛر",ﴍ:"سۛر",ﲰ:"سم",ﳧ:"سم",ﰟ:"سم",ﴰ:"سۛم",ﳩ:"سۛم",ﴨ:"سۛم",ﴌ:"سۛم",ﵡ:"سمج",ﵠ:"سمح",ﵟ:"سمح",ﵫ:"سۛمخ",ﵪ:"سۛمخ",ﵣ:"سمم",ﵢ:"سمم",ﵭ:"سۛمم",ﵬ:"سۛمم",ﴗ:"سى",ﳻ:"سى",ﴘ:"سى",ﳼ:"سى",ﴙ:"سۛى",ﳽ:"سۛى",ﴚ:"سۛى",ﳾ:"سۛى","𐋲":"ص","𞸑":"ص","𞸱":"ص","𞹑":"ص","𞹱":"ص","𞺑":"ص","𞺱":"ص",ﺻ:"ص",ﺼ:"ص",ﺺ:"ص",ﺹ:"ص",ڞ:"صۛ","ࢯ":"ص̤̣",ﲱ:"صح",ﰠ:"صح",ﵥ:"صحح",ﵤ:"صحح",ﶩ:"صحى",ﲲ:"صخ",ﴫ:"صر",ﴏ:"صر",ﷵ:"صلعم",ﷹ:"صلى",ﷰ:"صلى",ﷺ:"صلى lللo علىo وسلم",ﲳ:"صم",ﰡ:"صم",ﷅ:"صمم",ﵦ:"صمم",ﴡ:"صى",ﴅ:"صى",ﴢ:"صى",ﴆ:"صى","𞸙":"ض","𞸹":"ض","𞹙":"ض","𞹹":"ض","𞺙":"ض","𞺹":"ض",ﺿ:"ض",ﻀ:"ض",ﺾ:"ض",ﺽ:"ض",ﲴ:"ضج",ﰢ:"ضج",ﲵ:"ضح",ﰣ:"ضح",ﵮ:"ضحى",ﶫ:"ضحى",ﲶ:"ضخ",ﰤ:"ضخ",ﵰ:"ضخم",ﵯ:"ضخم",ﴬ:"ضر",ﴐ:"ضر",ﲷ:"ضم",ﰥ:"ضم",ﴣ:"ضى",ﴇ:"ضى",ﴤ:"ضى",ﴈ:"ضى","𐋨":"ط","𞸈":"ط","𞹨":"ط","𞺈":"ط","𞺨":"ط",ﻃ:"ط",ﻄ:"ط",ﻂ:"ط",ﻁ:"ط",ڟ:"طۛ",ﲸ:"طح",ﰦ:"طح",ﴳ:"طم",ﴺ:"طم",ﰧ:"طم",ﵲ:"طمح",ﵱ:"طمح",ﵳ:"طمم",ﵴ:"طمى",ﴑ:"طى",ﳵ:"طى",ﴒ:"طى",ﳶ:"طى","𞸚":"ظ","𞹺":"ظ","𞺚":"ظ","𞺺":"ظ",ﻇ:"ظ",ﻈ:"ظ",ﻆ:"ظ",ﻅ:"ظ",ﲹ:"ظم",ﴻ:"ظم",ﰨ:"ظم","؏":"ع","𞸏":"ع","𞸯":"ع","𞹏":"ع","𞹯":"ع","𞺏":"ع","𞺯":"ع",ﻋ:"ع",ﻌ:"ع",ﻊ:"ع",ﻉ:"ع",ﲺ:"عج",ﰩ:"عج",ﷄ:"عجم",ﵵ:"عجم",ﷷ:"علىo",ﲻ:"عم",ﰪ:"عم",ﵷ:"عمم",ﵶ:"عمم",ﵸ:"عمى",ﶶ:"عمى",ﴓ:"عى",ﳷ:"عى",ﴔ:"عى",ﳸ:"عى","𞸛":"غ","𞸻":"غ","𞹛":"غ","𞹻":"غ","𞺛":"غ","𞺻":"غ",ﻏ:"غ",ﻐ:"غ",ﻎ:"غ",ﻍ:"غ",ﲼ:"غج",ﰫ:"غج",ﲽ:"غم",ﰬ:"غم",ﵹ:"غمم",ﵻ:"غمى",ﵺ:"غمى",ﴕ:"غى",ﳹ:"غى",ﴖ:"غى",ﳺ:"غى","𞸐":"ف","𞸰":"ف","𞹰":"ف","𞺐":"ف","𞺰":"ف",ﻓ:"ف",ﻔ:"ف",ﻒ:"ف",ﻑ:"ف",ڧ:"ف",ﲾ:"فج",ﰭ:"فج",ﲿ:"فح",ﰮ:"فح",ﳀ:"فخ",ﰯ:"فخ",ﵽ:"فخم",ﵼ:"فخم",ﳁ:"فم",ﰰ:"فم",ﷁ:"فمى",ﱼ:"فى",ﰱ:"فى",ﱽ:"فى",ﰲ:"فى","𞸞":"ڡ","𞹾":"ڡ","ࢻ":"ڡ","ٯ":"ڡ","𞸟":"ڡ","𞹟":"ڡ","ࢼ":"ڡ",ڤ:"ڡۛ",ﭬ:"ڡۛ",ﭭ:"ڡۛ",ﭫ:"ڡۛ",ﭪ:"ڡۛ",ڨ:"ڡۛ","ࢤ":"ڢۛ",ﭰ:"ڦ",ﭱ:"ڦ",ﭯ:"ڦ",ﭮ:"ڦ","𞸒":"ق","𞸲":"ق","𞹒":"ق","𞹲":"ق","𞺒":"ق","𞺲":"ق",ﻗ:"ق",ﻘ:"ق",ﻖ:"ق",ﻕ:"ق",ﳂ:"قح",ﰳ:"قح",ﷱ:"قلى",ﳃ:"قم",ﰴ:"قم",ﶴ:"قمح",ﵾ:"قمح",ﵿ:"قمم",ﶲ:"قمى",ﱾ:"قى",ﰵ:"قى",ﱿ:"قى",ﰶ:"قى","𞸊":"ك","𞸪":"ك","𞹪":"ك",ﻛ:"ك",ﻜ:"ك",ﻚ:"ك",ﻙ:"ك",ک:"ك",ﮐ:"ك",ﮑ:"ك",ﮏ:"ك",ﮎ:"ك",ڪ:"ك",ڭ:"كۛ",ﯕ:"كۛ",ﯖ:"كۛ",ﯔ:"كۛ",ﯓ:"كۛ","ݣ":"كۛ",ﲀ:"كl",ﰷ:"كl",ﳄ:"كج",ﰸ:"كج",ﳅ:"كح",ﰹ:"كح",ﳆ:"كخ",ﰺ:"كخ",ﳇ:"كل",ﳫ:"كل",ﲁ:"كل",ﰻ:"كل",ﳈ:"كم",ﳬ:"كم",ﲂ:"كم",ﰼ:"كم",ﷃ:"كمم",ﶻ:"كمم",ﶷ:"كمى",ﲃ:"كى",ﰽ:"كى",ﲄ:"كى",ﰾ:"كى","ݢ":"ڬ",ﮔ:"گ",ﮕ:"گ",ﮓ:"گ",ﮒ:"گ","ࢰ":"گ",ڴ:"گۛ",ﮜ:"ڱ",ﮝ:"ڱ",ﮛ:"ڱ",ﮚ:"ڱ",ﮘ:"ڳ",ﮙ:"ڳ",ﮗ:"ڳ",ﮖ:"ڳ","𞸋":"ل","𞸫":"ل","𞹋":"ل","𞺋":"ل","𞺫":"ل",ﻟ:"ل",ﻠ:"ل",ﻞ:"ل",ﻝ:"ل",ڷ:"لۛ",ڵ:"ل̆",ﻼ:"لl",ﻻ:"لl",ﻺ:"لlٕ",ﻹ:"لlٕ",ﻸ:"لlٴ",ﻷ:"لlٴ",ﳍ:"لo",ﻶ:"لآ",ﻵ:"لآ",ﳉ:"لج",ﰿ:"لج",ﶃ:"لجج",ﶄ:"لجج",ﶺ:"لجم",ﶼ:"لجم",ﶬ:"لجى",ﳊ:"لح",ﱀ:"لح",ﶵ:"لحم",ﶀ:"لحم",ﶂ:"لحى",ﶁ:"لحى",ﳋ:"لخ",ﱁ:"لخ",ﶆ:"لخم",ﶅ:"لخم",ﳌ:"لم",ﳭ:"لم",ﲅ:"لم",ﱂ:"لم",ﶈ:"لمح",ﶇ:"لمح",ﶭ:"لمى",ﲆ:"لى",ﱃ:"لى",ﲇ:"لى",ﱄ:"لى","𞸌":"م","𞸬":"م","𞹬":"م","𞺌":"م","𞺬":"م",ﻣ:"م",ﻤ:"م",ﻢ:"م",ﻡ:"م","ࢧ":"مۛ","۾":"م͈",ﲈ:"مl",ﳎ:"مج",ﱅ:"مج",ﶌ:"مجح",ﶒ:"مجخ",ﶍ:"مجم",ﷀ:"مجى",ﳏ:"مح",ﱆ:"مح",ﶉ:"محج",ﶊ:"محم",ﷴ:"محمد",ﶋ:"محى",ﳐ:"مخ",ﱇ:"مخ",ﶎ:"مخج",ﶏ:"مخم",ﶹ:"مخى",ﳑ:"مم",ﲉ:"مم",ﱈ:"مم",ﶱ:"ممى",ﱉ:"مى",ﱊ:"مى","𞸍":"ن","𞸭":"ن","𞹍":"ن","𞹭":"ن","𞺍":"ن","𞺭":"ن",ﻧ:"ن",ﻨ:"ن",ﻦ:"ن",ﻥ:"ن","ݨ":"نؕ","ݩ":"ن̆",ﳖ:"نo",ﳯ:"نo",ﶸ:"نجح",ﶽ:"نجح",ﶘ:"نجم",ﶗ:"نجم",ﶙ:"نجى",ﷇ:"نجى",ﳓ:"نح",ﱌ:"نح",ﶕ:"نحم",ﶖ:"نحى",ﶳ:"نحى",ﳔ:"نخ",ﱍ:"نخ",ﲊ:"نر",ﲋ:"نز",ﳕ:"نم",ﳮ:"نم",ﲌ:"نم",ﱎ:"نم",ﶛ:"نمى",ﶚ:"نمى",ﲍ:"نن",ﲎ:"نى",ﱏ:"نى",ﲏ:"نى",ﱐ:"نى",ۂ:"ۀ",ﮥ:"ۀ",ﮤ:"ۀ","𐋤":"و","𞸅":"و","𞺅":"و","𞺥":"و",ﻮ:"و",ﻭ:"و","ࢱ":"و",ۋ:"وۛ",ﯟ:"وۛ",ﯞ:"وۛ",ۇ:"و̓",ﯘ:"و̓",ﯗ:"و̓",ۆ:"و̆",ﯚ:"و̆",ﯙ:"و̆",ۉ:"و̂",ﯣ:"و̂",ﯢ:"و̂",ۈ:"وٰ",ﯜ:"وٰ",ﯛ:"وٰ",ؤ:"وٴ",ﺆ:"وٴ",ﺅ:"وٴ",ٶ:"وٴ",ٷ:"و̓ٴ",ﯝ:"و̓ٴ",ﷸ:"وسلم",ﯡ:"ۅ",ﯠ:"ۅ","ٮ":"ى","𞸜":"ى","𞹼":"ى",ں:"ى","𞸝":"ى","𞹝":"ى",ﮟ:"ى",ﮞ:"ى","ࢽ":"ى",ﯨ:"ى",ﯩ:"ى",ﻰ:"ى",ﻯ:"ى",ي:"ى","𞸉":"ى","𞸩":"ى","𞹉":"ى","𞹩":"ى","𞺉":"ى","𞺩":"ى",ﻳ:"ى",ﻴ:"ى",ﻲ:"ى",ﻱ:"ى",ی:"ى",ﯾ:"ى",ﯿ:"ى",ﯽ:"ى",ﯼ:"ى",ے:"ى",ﮯ:"ى",ﮮ:"ى",ٹ:"ىؕ",ﭨ:"ىؕ",ﭩ:"ىؕ",ﭧ:"ىؕ",ﭦ:"ىؕ",ڻ:"ىؕ",ﮢ:"ىؕ",ﮣ:"ىؕ",ﮡ:"ىؕ",ﮠ:"ىؕ",پ:"ىۛ",ﭘ:"ىۛ",ﭙ:"ىۛ",ﭗ:"ىۛ",ﭖ:"ىۛ",ث:"ىۛ","𞸖":"ىۛ","𞸶":"ىۛ","𞹶":"ىۛ","𞺖":"ىۛ","𞺶":"ىۛ",ﺛ:"ىۛ",ﺜ:"ىۛ",ﺚ:"ىۛ",ﺙ:"ىۛ",ڽ:"ىۛ",ۑ:"ىۛ","ؿ":"ىۛ","ࢷ":"ىۛۢ","ݖ":"ى̆",ێ:"ى̆","ࢺ":"ى̆̇","ؽ":"ى̂","ࢨ":"ىٔ",ﲐ:"ىٰ",ﱝ:"ىٰ",ﳞ:"ىo",ﳱ:"ىo",ﳦ:"ىۛo",ئ:"ىٴ",ﺋ:"ىٴ",ﺌ:"ىٴ",ﺊ:"ىٴ",ﺉ:"ىٴ",ٸ:"ىٴ",ﯫ:"ىٴl",ﯪ:"ىٴl",ﲛ:"ىٴo",ﳠ:"ىٴo",ﯭ:"ىٴo",ﯬ:"ىٴo",ﯸ:"ىٴٻ",ﯷ:"ىٴٻ",ﯶ:"ىٴٻ",ﲗ:"ىٴج",ﰀ:"ىٴج",ﲘ:"ىٴح",ﰁ:"ىٴح",ﲙ:"ىٴخ",ﱤ:"ىٴر",ﱥ:"ىٴز",ﲚ:"ىٴم",ﳟ:"ىٴم",ﱦ:"ىٴم",ﰂ:"ىٴم",ﱧ:"ىٴن",ﯯ:"ىٴو",ﯮ:"ىٴو",ﯱ:"ىٴو̓",ﯰ:"ىٴو̓",ﯳ:"ىٴو̆",ﯲ:"ىٴو̆",ﯵ:"ىٴوٰ",ﯴ:"ىٴوٰ",ﯻ:"ىٴى",ﯺ:"ىٴى",ﱨ:"ىٴى",ﯹ:"ىٴى",ﰃ:"ىٴى",ﱩ:"ىٴى",ﰄ:"ىٴى",ﳚ:"ىج",ﱕ:"ىج",ﰑ:"ىۛج",ﶯ:"ىجى",ﳛ:"ىح",ﱖ:"ىح",ﶮ:"ىحى",ﳜ:"ىخ",ﱗ:"ىخ",ﲑ:"ىر",ﱶ:"ىۛر",ﲒ:"ىز",ﱷ:"ىۛز",ﳝ:"ىم",ﳰ:"ىم",ﲓ:"ىم",ﱘ:"ىم",ﲦ:"ىۛم",ﳥ:"ىۛم",ﱸ:"ىۛم",ﰒ:"ىۛم",ﶝ:"ىمم",ﶜ:"ىمم",ﶰ:"ىمى",ﲔ:"ىن",ﱹ:"ىۛن",ﲕ:"ىى",ﱙ:"ىى",ﲖ:"ىى",ﱚ:"ىى",ﱺ:"ىۛى",ﰓ:"ىۛى",ﱻ:"ىۛى",ﰔ:"ىۛى",ﮱ:"ۓ",ﮰ:"ۓ","𐊸":"ⵀ","⁞":"ⵂ","⸽":"ⵂ","⦙":"ⵂ","︙":"ⵗ","⁝":"ⵗ","⋮":"ⵗ",Մ:"ሆ",Ռ:"ቡ",Ի:"ኮ",Պ:"ጣ",आ:"अा",ऒ:"अाॆ",ओ:"अाे",औ:"अाै","ऄ":"अॆ",ऑ:"अॉ",ऍ:"एॅ",ऎ:"एॆ",ऐ:"एे",ई:"र्इ",ઽ:"ऽ","𑇜":"ꣻ","𑇋":"ऺ","ુ":"ु","ૂ":"ू","ੋ":"ॆ","੍":"्","્":"्",আ:"অা",ৠ:"ঋৃ",ৡ:"ঋৃ","𑒒":"ঘ","𑒔":"চ","𑒖":"জ","𑒘":"ঞ","𑒙":"ট","𑒛":"ড","𑒪":"ণ","𑒞":"ত","𑒟":"থ","𑒠":"দ","𑒡":"ধ","𑒢":"ন","𑒣":"প","𑒩":"ব","𑒧":"ম","𑒨":"য","𑒫":"র","𑒝":"ল","𑒭":"ষ","𑒮":"স","𑓄":"ঽ","𑒰":"া","𑒱":"ি","𑒹":"ে","𑒼":"ো","𑒾":"ৌ","𑓂":"্","𑒽":"ৗ",ਉ:"ੳੁ",ਊ:"ੳੂ",ਆ:"ਅਾ",ਐ:"ਅੈ",ਔ:"ਅੌ",ਇ:"ੲਿ",ਈ:"ੲੀ",ਏ:"ੲੇ",આ:"અા",ઑ:"અાૅ",ઓ:"અાે",ઔ:"અાૈ",ઍ:"અૅ",એ:"અે",ઐ:"અૈ",ଆ:"ଅା","௮":"அ",ர:"ஈ","ா":"ஈ","௫":"ஈு","௨":"உ",ഉ:"உ",ஊ:"உள",ഊ:"உൗ","௭":"எ","௷":"எவ",ஜ:"ஐ",ജ:"ஐ","௧":"க","௪":"ச","௬":"சு","௲":"சூ","ഺ":"டி",ണ:"ண","௺":"நீ","௴":"மீ","௰":"ய",ഴ:"ழ","ௗ":"ள","ை":"ன",ശ:"ஶ","௸":"ஷ","ി":"ி","ീ":"ி","ொ":"ெஈ","ௌ":"ெள","ோ":"ேஈ",ಅ:"అ",ಆ:"ఆ",ಇ:"ఇ",ౠ:"ఋా",ౡ:"ఌా",ಒ:"ఒ",ఔ:"ఒౌ",ಔ:"ఒౌ",ఓ:"ఒౕ",ಓ:"ఒౕ",ಜ:"జ",ಞ:"ఞ",ఢ:"డ̣",ಣ:"ణ",థ:"ధּ",భ:"బ̣",ಯ:"య",ఠ:"రּ",ಱ:"ఱ",ಲ:"ల",ష:"వ̣",హ:"వా",మ:"వు","ూ":"ుా","ౄ":"ృా",ೡ:"ಌಾ",ഈ:"ഇൗ",ഐ:"എെ",ഓ:"ഒാ",ഔ:"ഒൗ",ൡ:"ഞ","൫":"ദ്ര","൹":"നു",ഌ:"നു",ങ:"നു","൯":"ന്","ൻ":"ന്","൬":"ന്ന","൚":"ന്മ",റ:"ര","൪":"ര്","ർ":"ര്","൮":"വ്ര","൶":"ഹ്മ","ൂ":"ു","ൃ":"ു","ൈ":"െെ","෪":"ජ","෫":"ද","𑐓":"𑐴𑑂𑐒","𑐙":"𑐴𑑂𑐘","𑐤":"𑐴𑑂𑐣","𑐪":"𑐴𑑂𑐩","𑐭":"𑐴𑑂𑐬","𑐯":"𑐴𑑂𑐮","𑗘":"𑖂","𑗙":"𑖂","𑗚":"𑖃","𑗛":"𑖄","𑗜":"𑖲","𑗝":"𑖳",ฃ:"ข",ด:"ค",ต:"ค",ม:"ฆ",ຈ:"จ",ซ:"ช",ฏ:"ฎ",ท:"ฑ",ບ:"บ",ປ:"ป",ຝ:"ฝ",ພ:"พ",ຟ:"ฟ",ฦ:"ภ",ຍ:"ย","។":"ฯ",ๅ:"า",ำ:"̊า","ិ":"ิ","ី":"ี","ឹ":"ึ","ឺ":"ื","ຸ":"ุ","ູ":"ู",แ:"เเ",ໜ:"ຫນ",ໝ:"ຫມ",ຳ:"̊າ","༂":"འུྂཿ","༃":"འུྂ༔",ཪ:"ར",ༀ:"ཨོཾ","ཷ":"ྲཱྀ","ཹ":"ླཱྀ","𑲲":"𑲪","ႁ":"ဂှ",က:"ဂာ","ၰ":"ဃှ","ၦ":"ပှ",ဟ:"ပာ","ၯ":"ပာှ","ၾ":"ၽှ",ဩ:"သြ",ဪ:"သြော်","႞":"ႃ̊",ឣ:"អ","᧐":"ᦞ","᧑":"ᦱ","᪀":"ᩅ","᪐":"ᩅ","꩓":"ꨁ","꩖":"ꨣ","᭒":"ᬍ","᭓":"ᬑ","᭘":"ᬨ","ꦣ":"ꦝ",ᢖ:"ᡜ",ᡕ:"ᠵ",ῶ:"Ꮿ",ᐍ:"ᐁ·",ᐫ:"ᐁᐠ",ᐑ:"ᐄ·",ᐓ:"ᐅ·",ᐭ:"ᐅᐠ",ᐕ:"ᐆ·",ᐘ:"ᐊ·",ᐮ:"ᐊᐠ",ᐚ:"ᐋ·","ᣝ":"ᐞᣟ",ᓑ:"ᐡ",ᕀ:"ᐩ",ᐿ:"ᐲ·",ᑃ:"ᐴ·","⍩":"ᐵ",ᑇ:"ᐹ·",ᑜ:"ᑏ·","⸧":"ᑐ","⊃":"ᑐ",ᑞ:"ᑐ·",ᑩ:"ᑐ'","⟉":"ᑐ/","⫗":"ᑐᑕ",ᑠ:"ᑑ·","⸦":"ᑕ","⊂":"ᑕ",ᑢ:"ᑕ·",ᑪ:"ᑕ'",ᑤ:"ᑖ·",ᑵ:"ᑫ·",ᒅ:"ᑫ'",ᑹ:"ᑮ·",ᑽ:"ᑰ·",ᘃ:"ᒉ",ᒓ:"ᒉ·",ᒕ:"ᒋ·",ᒗ:"ᒌ·",ᒛ:"ᒎ·",ᘂ:"ᒐ",ᒝ:"ᒐ·",ᒟ:"ᒑ·",ᒭ:"ᒣ·",ᒱ:"ᒦ·",ᒳ:"ᒧ·",ᒵ:"ᒨ·",ᒹ:"ᒫ·",ᓊ:"ᓀ·","ᣇ":"ᓂ·","ᣉ":"ᓃ·","ᣋ":"ᓄ·","ᣍ":"ᓅ·",ᓌ:"ᓇ·",ᓎ:"ᓈ·",ᘄ:"ᓓ",ᓝ:"ᓓ·",ᓟ:"ᓕ·",ᓡ:"ᓖ·",ᓣ:"ᓗ·",ᓥ:"ᓘ·",ᘇ:"ᓚ",ᓧ:"ᓚ·",ᓩ:"ᓛ·",ᓷ:"ᓭ·",ᓹ:"ᓯ·",ᓻ:"ᓰ·",ᓽ:"ᓱ·",ᓿ:"ᓲ·",ᔁ:"ᓴ·",ᔃ:"ᓵ·",ᔌ:"ᔋ<",ᔎ:"ᔋb",ᔍ:"ᔋᑕ",ᔏ:"ᔋᒐ",ᔘ:"ᔐ·",ᔚ:"ᔑ·",ᔜ:"ᔒ·",ᔞ:"ᔓ·",ᔠ:"ᔔ·",ᔢ:"ᔕ·",ᔤ:"ᔖ·",ᔲ:"ᔨ·",ᔴ:"ᔩ·",ᔶ:"ᔪ·",ᔸ:"ᔫ·",ᔺ:"ᔭ·",ᔼ:"ᔮ·",ᘢ:"ᕃ","ᣠ":"ᕃ·",ᘣ:"ᕆ",ᘤ:"ᕊ",ᕏ:"ᕌ·",ᖃ:"ᕐb",ᖄ:"ᕐḃ",ᖁ:"ᕐd",ᕿ:"ᕐP",ᙯ:"ᕐᑫ",ᕾ:"ᕐᑬ",ᖀ:"ᕐᑮ",ᖂ:"ᕐᑰ",ᖅ:"ᕐᒃ",ᕜ:"ᕚ·","ᣣ":"ᕞ·","ᣤ":"ᕦ·",ᕩ:"ᕧ·","ᣥ":"ᕫ·","ᣨ":"ᖆ·",ᖑ:"ᖕJ",ᙰ:"ᖕᒉ",ᖎ:"ᖕᒊ",ᖏ:"ᖕᒋ",ᖐ:"ᖕᒌ",ᖒ:"ᖕᒎ",ᖓ:"ᖕᒐ",ᖔ:"ᖕᒑ",ᙳ:"ᖖJ",ᙱ:"ᖖᒋ",ᙲ:"ᖖᒌ",ᙴ:"ᖖᒎ",ᙵ:"ᖖᒐ",ᙶ:"ᖖᒑ","ᣪ":"ᖗ·","ᙷ":"ᖧ·","ᙸ":"ᖨ·","ᙹ":"ᖩ·","ᙺ":"ᖪ·","ᙻ":"ᖫ·","ᙼ":"ᖬ·","ᙽ":"ᖭ·","⪫":"ᗒ","⪪":"ᗕ","ꓷ":"ᗡ","ᣰ":"ᗴ·","ᣲ":"ᘛ·","ᶻ":"ᙆ","ꓭ":"ᙠ","ᶺ":"ᣔ","ᴾ":"ᣖ","ᣜ":"ᣟᐞ",ˡ:"ᣳ",ʳ:"ᣴ",ˢ:"ᣵ","ᣛ":"ᣵ","ꚰ":"ᚹ",ᛡ:"ᚼ","⍿":"ᚽ",ᛂ:"ᚽ","𝈿":"ᛋ","↑":"ᛏ","↿":"ᛐ","⥮":"ᛐ⇂","⥣":"ᛐᛚ","ⵣ":"ᛯ","↾":"ᛚ","⨡":"ᛚ","⋄":"ᛜ","◇":"ᛜ","◊":"ᛜ","♢":"ᛜ","🝔":"ᛜ","𑢷":"ᛜ","𐊔":"ᛜ","⍚":"ᛜ̲","⋈":"ᛞ","⨝":"ᛞ","𐓐":"ᛦ","↕":"ᛨ","𐳼":"𐲂","𐳺":"𐲥",ㄱ:"ᄀ",ᆨ:"ᄀ",ᄁ:"ᄀᄀ",ㄲ:"ᄀᄀ",ᆩ:"ᄀᄀ","ᇺ":"ᄀᄂ","ᅚ":"ᄀᄃ",ᇃ:"ᄀᄅ","ᇻ":"ᄀᄇ",ᆪ:"ᄀᄉ",ㄳ:"ᄀᄉ",ᇄ:"ᄀᄉᄀ","ᇼ":"ᄀᄎ","ᇽ":"ᄀᄏ","ᇾ":"ᄀᄒ",ㄴ:"ᄂ",ᆫ:"ᄂ",ᄓ:"ᄂᄀ",ᇅ:"ᄂᄀ",ᄔ:"ᄂᄂ",ㅥ:"ᄂᄂ","ᇿ":"ᄂᄂ",ᄕ:"ᄂᄃ",ㅦ:"ᄂᄃ",ᇆ:"ᄂᄃ","ퟋ":"ᄂᄅ",ᄖ:"ᄂᄇ","ᅛ":"ᄂᄉ",ᇇ:"ᄂᄉ",ㅧ:"ᄂᄉ","ᅜ":"ᄂᄌ",ᆬ:"ᄂᄌ",ㄵ:"ᄂᄌ","ퟌ":"ᄂᄎ",ᇉ:"ᄂᄐ","ᅝ":"ᄂᄒ",ᆭ:"ᄂᄒ",ㄶ:"ᄂᄒ",ᇈ:"ᄂᅀ",ㅨ:"ᄂᅀ",ㄷ:"ᄃ",ᆮ:"ᄃ",ᄗ:"ᄃᄀ",ᇊ:"ᄃᄀ",ᄄ:"ᄃᄃ",ㄸ:"ᄃᄃ","ퟍ":"ᄃᄃ","ퟎ":"ᄃᄃᄇ","ᅞ":"ᄃᄅ",ᇋ:"ᄃᄅ","ꥠ":"ᄃᄆ","ꥡ":"ᄃᄇ","ퟏ":"ᄃᄇ","ꥢ":"ᄃᄉ","ퟐ":"ᄃᄉ","ퟑ":"ᄃᄉᄀ","ꥣ":"ᄃᄌ","ퟒ":"ᄃᄌ","ퟓ":"ᄃᄎ","ퟔ":"ᄃᄐ",ㄹ:"ᄅ",ᆯ:"ᄅ","ꥤ":"ᄅᄀ",ᆰ:"ᄅᄀ",ㄺ:"ᄅᄀ","ꥥ":"ᄅᄀᄀ","ퟕ":"ᄅᄀᄀ",ᇌ:"ᄅᄀᄉ",ㅩ:"ᄅᄀᄉ","ퟖ":"ᄅᄀᄒ",ᄘ:"ᄅᄂ",ᇍ:"ᄅᄂ","ꥦ":"ᄅᄃ",ᇎ:"ᄅᄃ",ㅪ:"ᄅᄃ","ꥧ":"ᄅᄃᄃ",ᇏ:"ᄅᄃᄒ",ᄙ:"ᄅᄅ",ᇐ:"ᄅᄅ","ퟗ":"ᄅᄅᄏ","ꥨ":"ᄅᄆ",ᆱ:"ᄅᄆ",ㄻ:"ᄅᄆ",ᇑ:"ᄅᄆᄀ",ᇒ:"ᄅᄆᄉ","ퟘ":"ᄅᄆᄒ","ꥩ":"ᄅᄇ",ᆲ:"ᄅᄇ",ㄼ:"ᄅᄇ","ퟙ":"ᄅᄇᄃ","ꥪ":"ᄅᄇᄇ",ᇓ:"ᄅᄇᄉ",ㅫ:"ᄅᄇᄉ","ꥫ":"ᄅᄇᄋ",ᇕ:"ᄅᄇᄋ","ퟚ":"ᄅᄇᄑ",ᇔ:"ᄅᄇᄒ","ꥬ":"ᄅᄉ",ᆳ:"ᄅᄉ",ㄽ:"ᄅᄉ",ᇖ:"ᄅᄉᄉ",ᄛ:"ᄅᄋ","ퟝ":"ᄅᄋ","ꥭ":"ᄅᄌ","ꥮ":"ᄅᄏ",ᇘ:"ᄅᄏ",ᆴ:"ᄅᄐ",ㄾ:"ᄅᄐ",ᆵ:"ᄅᄑ",ㄿ:"ᄅᄑ",ᄚ:"ᄅᄒ",ㅀ:"ᄅᄒ",ᄻ:"ᄅᄒ",ᆶ:"ᄅᄒ","ퟲ":"ᄅᄒ",ᇗ:"ᄅᅀ",ㅬ:"ᄅᅀ","ퟛ":"ᄅᅌ",ᇙ:"ᄅᅙ",ㅭ:"ᄅᅙ","ퟜ":"ᄅᅙᄒ",ㅁ:"ᄆ",ᆷ:"ᄆ","ꥯ":"ᄆᄀ",ᇚ:"ᄆᄀ","ퟞ":"ᄆᄂ","ퟟ":"ᄆᄂᄂ","ꥰ":"ᄆᄃ",ᇛ:"ᄆᄅ","ퟠ":"ᄆᄆ",ᄜ:"ᄆᄇ",ㅮ:"ᄆᄇ",ᇜ:"ᄆᄇ","ퟡ":"ᄆᄇᄉ","ꥱ":"ᄆᄉ",ᇝ:"ᄆᄉ",ㅯ:"ᄆᄉ",ᇞ:"ᄆᄉᄉ",ᄝ:"ᄆᄋ",ㅱ:"ᄆᄋ",ᇢ:"ᄆᄋ","ퟢ":"ᄆᄌ",ᇠ:"ᄆᄎ",ᇡ:"ᄆᄒ",ᇟ:"ᄆᅀ",ㅰ:"ᄆᅀ",ㅂ:"ᄇ",ᆸ:"ᄇ",ᄞ:"ᄇᄀ",ㅲ:"ᄇᄀ",ᄟ:"ᄇᄂ",ᄠ:"ᄇᄃ",ㅳ:"ᄇᄃ","ퟣ":"ᄇᄃ",ᇣ:"ᄇᄅ","ퟤ":"ᄇᄅᄑ","ퟥ":"ᄇᄆ",ᄈ:"ᄇᄇ",ㅃ:"ᄇᄇ","ퟦ":"ᄇᄇ",ᄬ:"ᄇᄇᄋ",ㅹ:"ᄇᄇᄋ",ᄡ:"ᄇᄉ",ㅄ:"ᄇᄉ",ᆹ:"ᄇᄉ",ᄢ:"ᄇᄉᄀ",ㅴ:"ᄇᄉᄀ",ᄣ:"ᄇᄉᄃ",ㅵ:"ᄇᄉᄃ","ퟧ":"ᄇᄉᄃ",ᄤ:"ᄇᄉᄇ",ᄥ:"ᄇᄉᄉ",ᄦ:"ᄇᄉᄌ","ꥲ":"ᄇᄉᄐ",ᄫ:"ᄇᄋ",ㅸ:"ᄇᄋ",ᇦ:"ᄇᄋ",ᄧ:"ᄇᄌ",ㅶ:"ᄇᄌ","ퟨ":"ᄇᄌ",ᄨ:"ᄇᄎ","ퟩ":"ᄇᄎ","ꥳ":"ᄇᄏ",ᄩ:"ᄇᄐ",ㅷ:"ᄇᄐ",ᄪ:"ᄇᄑ",ᇤ:"ᄇᄑ","ꥴ":"ᄇᄒ",ᇥ:"ᄇᄒ",ㅅ:"ᄉ",ᆺ:"ᄉ",ᄭ:"ᄉᄀ",ㅺ:"ᄉᄀ",ᇧ:"ᄉᄀ",ᄮ:"ᄉᄂ",ㅻ:"ᄉᄂ",ᄯ:"ᄉᄃ",ㅼ:"ᄉᄃ",ᇨ:"ᄉᄃ",ᄰ:"ᄉᄅ",ᇩ:"ᄉᄅ",ᄱ:"ᄉᄆ","ퟪ":"ᄉᄆ",ᄲ:"ᄉᄇ",ㅽ:"ᄉᄇ",ᇪ:"ᄉᄇ",ᄳ:"ᄉᄇᄀ","ퟫ":"ᄉᄇᄋ",ᄊ:"ᄉᄉ",ㅆ:"ᄉᄉ",ᆻ:"ᄉᄉ","ퟬ":"ᄉᄉᄀ","ퟭ":"ᄉᄉᄃ","ꥵ":"ᄉᄉᄇ",ᄴ:"ᄉᄉᄉ",ᄵ:"ᄉᄋ",ᄶ:"ᄉᄌ",ㅾ:"ᄉᄌ","ퟯ":"ᄉᄌ",ᄷ:"ᄉᄎ","ퟰ":"ᄉᄎ",ᄸ:"ᄉᄏ",ᄹ:"ᄉᄐ","ퟱ":"ᄉᄐ",ᄺ:"ᄉᄑ","ퟮ":"ᄉᅀ",ㅇ:"ᄋ",ᆼ:"ᄋ",ᅁ:"ᄋᄀ",ᇬ:"ᄋᄀ",ᇭ:"ᄋᄀᄀ",ᅂ:"ᄋᄃ","ꥶ":"ᄋᄅ",ᅃ:"ᄋᄆ",ᅄ:"ᄋᄇ",ᅅ:"ᄋᄉ",ᇱ:"ᄋᄉ",ㆂ:"ᄋᄉ",ᅇ:"ᄋᄋ",ㆀ:"ᄋᄋ",ᇮ:"ᄋᄋ",ᅈ:"ᄋᄌ",ᅉ:"ᄋᄎ",ᇯ:"ᄋᄏ",ᅊ:"ᄋᄐ",ᅋ:"ᄋᄑ","ꥷ":"ᄋᄒ",ᅆ:"ᄋᅀ",ᇲ:"ᄋᅀ",ㆃ:"ᄋᅀ",ㅈ:"ᄌ",ᆽ:"ᄌ","ퟷ":"ᄌᄇ","ퟸ":"ᄌᄇᄇ",ᅍ:"ᄌᄋ",ᄍ:"ᄌᄌ",ㅉ:"ᄌᄌ","ퟹ":"ᄌᄌ","ꥸ":"ᄌᄌᄒ",ㅊ:"ᄎ",ᆾ:"ᄎ",ᅒ:"ᄎᄏ",ᅓ:"ᄎᄒ",ㅋ:"ᄏ",ᆿ:"ᄏ",ㅌ:"ᄐ",ᇀ:"ᄐ","ꥹ":"ᄐᄐ",ㅍ:"ᄑ",ᇁ:"ᄑ",ᅖ:"ᄑᄇ",ᇳ:"ᄑᄇ","ퟺ":"ᄑᄉ",ᅗ:"ᄑᄋ",ㆄ:"ᄑᄋ",ᇴ:"ᄑᄋ","ퟻ":"ᄑᄐ","ꥺ":"ᄑᄒ",ㅎ:"ᄒ",ᇂ:"ᄒ",ᇵ:"ᄒᄂ",ᇶ:"ᄒᄅ",ᇷ:"ᄒᄆ",ᇸ:"ᄒᄇ","ꥻ":"ᄒᄉ",ᅘ:"ᄒᄒ",ㆅ:"ᄒᄒ",ᄽ:"ᄼᄼ",ᄿ:"ᄾᄾ",ㅿ:"ᅀ",ᇫ:"ᅀ","ퟳ":"ᅀᄇ","ퟴ":"ᅀᄇᄋ",ㆁ:"ᅌ",ᇰ:"ᅌ","ퟵ":"ᅌᄆ","ퟶ":"ᅌᄒ",ᅏ:"ᅎᅎ",ᅑ:"ᅐᅐ",ㆆ:"ᅙ",ᇹ:"ᅙ","ꥼ":"ᅙᅙ",ㅤ:"ᅠ",ㅏ:"ᅡ","ᆣ":"ᅡー",ᅶ:"ᅡᅩ",ᅷ:"ᅡᅮ",ᅢ:"ᅡ丨",ㅐ:"ᅡ丨",ㅑ:"ᅣ",ᅸ:"ᅣᅩ",ᅹ:"ᅣᅭ","ᆤ":"ᅣᅮ",ᅤ:"ᅣ丨",ㅒ:"ᅣ丨",ㅓ:"ᅥ",ᅼ:"ᅥー",ᅺ:"ᅥᅩ",ᅻ:"ᅥᅮ",ᅦ:"ᅥ丨",ㅔ:"ᅥ丨",ㅕ:"ᅧ","ᆥ":"ᅧᅣ",ᅽ:"ᅧᅩ",ᅾ:"ᅧᅮ",ᅨ:"ᅧ丨",ㅖ:"ᅧ丨",ㅗ:"ᅩ",ᅪ:"ᅩᅡ",ㅘ:"ᅩᅡ",ᅫ:"ᅩᅡ丨",ㅙ:"ᅩᅡ丨","ᆦ":"ᅩᅣ","ᆧ":"ᅩᅣ丨",ᅿ:"ᅩᅥ",ᆀ:"ᅩᅥ丨","ힰ":"ᅩᅧ",ᆁ:"ᅩᅧ丨",ᆂ:"ᅩᅩ","ힱ":"ᅩᅩ丨",ᆃ:"ᅩᅮ",ᅬ:"ᅩ丨",ㅚ:"ᅩ丨",ㅛ:"ᅭ","ힲ":"ᅭᅡ","ힳ":"ᅭᅡ丨",ᆄ:"ᅭᅣ",ㆇ:"ᅭᅣ",ᆆ:"ᅭᅣ",ᆅ:"ᅭᅣ丨",ㆈ:"ᅭᅣ丨","ힴ":"ᅭᅥ",ᆇ:"ᅭᅩ",ᆈ:"ᅭ丨",ㆉ:"ᅭ丨",ㅜ:"ᅮ",ᆉ:"ᅮᅡ",ᆊ:"ᅮᅡ丨",ᅯ:"ᅮᅥ",ㅝ:"ᅮᅥ",ᆋ:"ᅮᅥー",ᅰ:"ᅮᅥ丨",ㅞ:"ᅮᅥ丨","ힵ":"ᅮᅧ",ᆌ:"ᅮᅧ丨",ᆍ:"ᅮᅮ",ᅱ:"ᅮ丨",ㅟ:"ᅮ丨","ힶ":"ᅮ丨丨",ㅠ:"ᅲ",ᆎ:"ᅲᅡ","ힷ":"ᅲᅡ丨",ᆏ:"ᅲᅥ",ᆐ:"ᅲᅥ丨",ᆑ:"ᅲᅧ",ㆊ:"ᅲᅧ",ᆒ:"ᅲᅧ丨",ㆋ:"ᅲᅧ丨","ힸ":"ᅲᅩ",ᆓ:"ᅲᅮ",ᆔ:"ᅲ丨",ㆌ:"ᅲ丨",ㆍ:"ᆞ","ퟅ":"ᆞᅡ",ᆟ:"ᆞᅥ","ퟆ":"ᆞᅥ丨",ᆠ:"ᆞᅮ",ᆢ:"ᆞᆞ",ᆡ:"ᆞ丨",ㆎ:"ᆞ丨",ヘ:"へ","⍁":"〼","⧄":"〼","꒞":"ꁊ","꒬":"ꁐ","꒜":"ꃀ","꒨":"ꄲ","꒿":"ꉙ","꒾":"ꊱ","꒔":"ꋍ","꓀":"ꎫ","꓂":"ꎵ","꒺":"ꎿ","꒰":"ꏂ","꒧":"ꑘ","⊥":"ꓕ","⟂":"ꓕ","𝈜":"ꓕ","Ʇ":"ꓕ","Ꞟ":"ꓤ","⅁":"ꓨ","⅂":"ꓶ","𝈕":"ꓶ","𝈫":"ꓶ","𖼦":"ꓶ","𐐑":"ꓶ","⅃":"𖼀","𑫦":"𑫥𑫯","𑫨":"𑫥𑫥","𑫩":"𑫥𑫥𑫯","𑫪":"𑫥𑫥𑫰","𑫧":"𑫥𑫰","𑫴":"𑫳𑫯","𑫶":"𑫳𑫳","𑫷":"𑫳𑫳𑫯","𑫸":"𑫳𑫳𑫰","𑫵":"𑫳𑫰","𑫬":"𑫫𑫯","𑫭":"𑫫𑫫","𑫮":"𑫫𑫫𑫯","⊕":"𐊨","⨁":"𐊨","🜨":"𐊨","Ꚛ":"𐊨","▽":"𐊼","𝈔":"𐊼","🜄":"𐊼","⧖":"𐋀","ꞛ":"𐐺","Ꞛ":"𐐒","𐒠":"𐒆","𐏑":"𐎂","𐏓":"𐎓","𒀸":"𐎚","☥":"𐦞","𓋹":"𐦞","〹":"卄",不:"不","丽":"丽","並":"並","⎜":"丨","⎟":"丨","⎢":"丨","⎥":"丨","⎪":"丨","⎮":"丨","㇑":"丨",ᅵ:"丨",ㅣ:"丨","⼁":"丨",ᆜ:"丨ー",ᆘ:"丨ᅡ",ᆙ:"丨ᅣ","ힽ":"丨ᅣᅩ","ힾ":"丨ᅣ丨","ힿ":"丨ᅧ","ퟀ":"丨ᅧ丨",ᆚ:"丨ᅩ","ퟁ":"丨ᅩ丨","ퟂ":"丨ᅭ",ᆛ:"丨ᅮ","ퟃ":"丨ᅲ",ᆝ:"丨ᆞ","ퟄ":"丨丨",串:"串","丸":"丸",丹:"丹","乁":"乁","㇠":"乙","⼄":"乙","㇟":"乚","⺃":"乚","㇖":"乛","⺂":"乛","⻲":"亀",亂:"亂","㇚":"亅","⼅":"亅",了:"了",ニ:"二","⼆":"二","𠄢":"𠄢","⼇":"亠",亮:"亮","⼈":"人",イ:"亻","⺅":"亻",什:"什","仌":"仌",令:"令","你":"你",倂:"併","倂":"併","侀":"侀",來:"來",例:"例","侮":"侮","侮":"侮","侻":"侻",便:"便",值:"値",倫:"倫","偺":"偺","備":"備","像":"像",僚:"僚","僧":"僧","僧":"僧","㒞":"㒞","⼉":"儿",兀:"兀","⺎":"兀","充":"充","免":"免","免":"免","兔":"兔","兤":"兤","⼊":"入","內":"內","全":"全",兩:"兩",ハ:"八","⼋":"八",六:"六","具":"具","𠔜":"𠔜","𠔥":"𠔥","冀":"冀","㒹":"㒹","⼌":"冂","再":"再","𠕋":"𠕋","冒":"冒","冕":"冕","㒻":"㒻","最":"最","⼍":"冖","冗":"冗","冤":"冤","⼎":"冫","冬":"冬","况":"况","况":"况",冷:"冷",凉:"凉",凌:"凌",凜:"凜",凞:"凞","⼏":"几","𠘺":"𠘺","凵":"凵","⼐":"凵","⼑":"刀","⺉":"刂","刃":"刃",切:"切","切":"切",列:"列",利:"利","㓟":"㓟",刺:"刺","刻":"刻","剆":"剆","割":"割","剷":"剷",劉:"劉","𠠄":"𠠄",カ:"力",力:"力","⼒":"力",劣:"劣","㔕":"㔕","劳":"劳","勇":"勇","勇":"勇","勉":"勉","勉":"勉",勒:"勒",勞:"勞","勤":"勤","勤":"勤",勵:"勵","⼓":"勹","勺":"勺","勺":"勺","包":"包","匆":"匆","𠣞":"𠣞","⼔":"匕",北:"北","北":"北","⼕":"匚","⼖":"匸",匿:"匿","⼗":"十","〸":"十","〺":"卅","卉":"卉","࿖":"卍","࿕":"卐","卑":"卑","卑":"卑","博":"博",ト:"卜","⼘":"卜","⼙":"卩","⺋":"㔾","即":"即",卵:"卵","卽":"卽","卿":"卿","卿":"卿","卿":"卿","⼚":"厂","𠨬":"𠨬","⼛":"厶",參:"參","⼜":"又","及":"及","叟":"叟","𠭣":"𠭣",ロ:"口","⼝":"口",囗:"口","⼞":"口",句:"句","叫":"叫","叱":"叱","吆":"吆",吏:"吏",吝:"吝","吸":"吸",呂:"呂","呈":"呈","周":"周","咞":"咞","咢":"咢",咽:"咽",䎛:"㖈","哶":"哶","唐":"唐","啓":"啓",啟:"啓","啕":"啕","啣":"啣","善":"善","善":"善",喇:"喇","喙":"喙","喙":"喙","喝":"喝","喝":"喝","喫":"喫","喳":"喳",嗀:"嗀","嗂":"嗂","嗢":"嗢","嘆":"嘆","嘆":"嘆","噑":"噑","噴":"噴","器":"器",囹:"囹","圖":"圖","圗":"圗","⼟":"土",士:"土","⼠":"土","型":"型","城":"城",㦳:"㘽","埴":"埴","堍":"堍","報":"報","堲":"堲","塀":"塀",塚:"塚","塚":"塚",塞:"塞",填:"塡",壿:"墫","墬":"墬","墳":"墳",壘:"壘",壟:"壟","𡓤":"𡓤","壮":"壮","売":"売","壷":"壷","⼡":"夂","夆":"夆","⼢":"夊",タ:"夕","⼣":"夕","多":"多","夢":"夢","⼤":"大","奄":"奄",奈:"奈",契:"契","奔":"奔","奢":"奢",女:"女","⼥":"女","𡚨":"𡚨","𡛪":"𡛪","姘":"姘","姬":"姬","娛":"娛","娧":"娧","婢":"婢","婦":"婦",嬀:"媯","㛮":"㛮","㛼":"㛼","媵":"媵","嬈":"嬈","嬨":"嬨","嬾":"嬾","嬾":"嬾","⼦":"子","⼧":"宀",宅:"宅","𡧈":"𡧈","寃":"寃","寘":"寘",寧:"寧",寧:"寧","寧":"寧",寮:"寮","寳":"寳","𡬘":"𡬘","⼨":"寸","寿":"寿","将":"将","⼩":"小","尢":"尢","⺐":"尢","⼪":"尢","⺏":"尣","㞁":"㞁","⼫":"尸",尿:"尿","屠":"屠",屢:"屢","層":"層",履:"履","屮":"屮","屮":"屮","⼬":"屮","𡴋":"𡴋","⼭":"山","峀":"峀","岍":"岍","𡷤":"𡷤","𡷦":"𡷦",崙:"崙","嵃":"嵃",嵐:"嵐","嵫":"嵫","嵮":"嵮","嵼":"嵼","嶲":"嶲",嶺:"嶺","⼮":"巛","巢":"巢",エ:"工","⼯":"工","⼰":"己","⺒":"巳","㠯":"㠯","巽":"巽","⼱":"巾",帲:"帡","帨":"帨","帽":"帽","幩":"幩","㡢":"㡢","𢆃":"𢆃","⼲":"干",年:"年","𢆟":"𢆟","⺓":"幺","⼳":"幺","⼴":"广",度:"度","㡼":"㡼","庰":"庰","庳":"庳","庶":"庶",廊:"廊","廊":"廊",廉:"廉","廒":"廒",廓:"廓","廙":"廙",廬:"廬","⼵":"廴","廾":"廾","⼶":"廾","𢌱":"𢌱","𢌱":"𢌱",弄:"弄","⼷":"弋","⼸":"弓","弢":"弢","弢":"弢","⼹":"彐","⺔":"彑","当":"当","㣇":"㣇","⼺":"彡","形":"形","彩":"彩","彫":"彫","⼻":"彳",律:"律","㣣":"㣣","徚":"徚",復:"復","徭":"徭","⼼":"心","⺖":"忄","⺗":"㣺","忍":"忍","志":"志",念:"念","忹":"忹",怒:"怒",怜:"怜","恵":"恵","㤜":"㤜","㤺":"㤺","悁":"悁","悔":"悔","悔":"悔","惇":"惇","惘":"惘",惡:"惡","𢛔":"𢛔","愈":"愈","慨":"慨",慄:"慄","慈":"慈","慌":"慌","慌":"慌","慎":"慎","慎":"慎","慠":"慠","慺":"慺","憎":"憎","憎":"憎","憎":"憎",憐:"憐","憤":"憤","憯":"憯","憲":"憲","𢡄":"𢡄","𢡊":"𢡊","懞":"懞","懲":"懲","懲":"懲","懲":"懲",懶:"懶","懶":"懶",戀:"戀","⼽":"戈","成":"成","戛":"戛",戮:"戮","戴":"戴","⼾":"戶",戸:"戶","⼿":"手","⺘":"扌","扝":"扝","抱":"抱",拉:"拉",拏:"拏",拓:"拓","拔":"拔","拼":"拼",拾:"拾","𢬌":"𢬌","挽":"挽","捐":"捐","捨":"捨",捻:"捻","掃":"掃",掠:"掠","掩":"掩","揄":"揄","揤":"揤","摒":"摒","𢯱":"𢯱","搜":"搜","搢":"搢","揅":"揅","摩":"摩","摷":"摷","摾":"摾","㨮":"㨮",搉:"㩁",撚:"撚","撝":"撝",擄:"擄","㩬":"㩬","⽀":"支","⽁":"攴","⺙":"攵","敏":"敏","敏":"敏","敖":"敖","敬":"敬",數:"數","𣀊":"𣀊","⽂":"文","⻫":"斉","⽃":"斗",料:"料","⽄":"斤","⽅":"方",旅:"旅","⽆":"无","⺛":"旡","既":"既","旣":"旣","⽇":"日",易:"易",曶:"㫚","㫤":"㫤","晉":"晉",晩:"晚",晴:"晴","晴":"晴","暑":"暑","暑":"暑",暈:"暈","㬈":"㬈","暜":"暜",暴:"暴",曆:"曆","㬙":"㬙","𣊸":"𣊸","⽈":"曰",更:"更","書":"書","⽉":"月","𣍟":"𣍟",肦:"朌",胐:"朏",胊:"朐",脁:"朓",胶:"㬵",朗:"朗","朗":"朗","朗":"朗",脧:"朘","望":"望","望":"望",幐:"㬺",䐠:"㬻","𣎓":"𣎓",膧:"朣","𣎜":"𣎜","⽊":"木",李:"李","杓":"杓","杖":"杖","杞":"杞","𣏃":"𣏃",柿:"杮",杻:"杻","枅":"枅",林:"林","㭉":"㭉","𣏕":"𣏕",柳:"柳","柺":"柺",栗:"栗","栟":"栟","桒":"桒","𣑭":"𣑭",梁:"梁","梅":"梅","梅":"梅","梎":"梎",梨:"梨","椔":"椔","楂":"楂","㮝":"㮝","㮝":"㮝",槩:"㮣",樧:"榝","榣":"榣","槪":"槪",樂:"樂",樂:"樂",樂:"樂",樓:"樓","𣚣":"𣚣","檨":"檨",櫓:"櫓","櫛":"櫛",欄:"欄","㰘":"㰘","⽋":"欠","次":"次","𣢧":"𣢧","歔":"歔","㱎":"㱎","⽌":"止","⻭":"歯","歲":"歲",歷:"歷","歹":"歹","⽍":"歹","⺞":"歺","殟":"殟",殮:"殮","⽎":"殳",殺:"殺","殺":"殺","殺":"殺","殻":"殻","𣪍":"𣪍","⽏":"毋","⺟":"母","𣫺":"𣫺","⽐":"比","⽑":"毛","⽒":"氏","⺠":"民","⽓":"气","⽔":"水","⺡":"氵","⺢":"氺","汎":"汎","汧":"汧",沈:"沈","沿":"沿",泌:"泌","泍":"泍",泥:"泥","𣲼":"𣲼",洛:"洛",洞:"洞","洴":"洴","派":"派",流:"流","流":"流","流":"流","洖":"洖","浩":"浩",浪:"浪","海":"海","海":"海","浸":"浸","涅":"涅","𣴞":"𣴞",淋:"淋",淚:"淚",淪:"淪","淹":"淹","渚":"渚","港":"港","湮":"湮",潙:"溈","滋":"滋","滋":"滋",溜:"溜",溺:"溺","滇":"滇",滑:"滑","滛":"滛","㴳":"㴳",漏:"漏","漢":"漢","漢":"漢",漣:"漣","𣻑":"𣻑","潮":"潮","𣽞":"𣽞","𣾎":"𣾎","濆":"濆",濫:"濫",濾:"濾","瀛":"瀛","瀞":"瀞","瀞":"瀞","瀹":"瀹","灊":"灊","㶖":"㶖","⽕":"火","⺣":"灬","灰":"灰","灷":"灷","災":"災",炙:"炙","炭":"炭",烈:"烈",烙:"烙","煮":"煮","煮":"煮","𤉣":"𤉣","煅":"煅",煉:"煉","𤋮":"𤋮","熜":"熜",燎:"燎",燐:"燐","𤎫":"𤎫",爐:"爐",爛:"爛","爨":"爨","⽖":"爪","爫":"爫","⺤":"爫","爵":"爵","爵":"爵","⽗":"父","⽘":"爻","⺦":"丬","⽙":"爿","⽚":"片","牐":"牐","⽛":"牙","𤘈":"𤘈","⽜":"牛",牢:"牢","犀":"犀","犕":"犕","⽝":"犬","⺨":"犭","犯":"犯",狀:"狀","𤜵":"𤜵",狼:"狼",猪:"猪","猪":"猪","𤠔":"𤠔",獵:"獵","獺":"獺","⽞":"玄",率:"率",率:"率","⽟":"玉","王":"王","㺬":"㺬","玥":"玥",玲:"玲","㺸":"㺸","㺸":"㺸",珞:"珞",琉:"琉",理:"理","琢":"琢","瑇":"瑇","瑜":"瑜",瑩:"瑩","瑱":"瑱","瑱":"瑱","璅":"璅",璉:"璉",璘:"璘","瓊":"瓊","⽠":"瓜","⽡":"瓦","㼛":"㼛","甆":"甆","⽢":"甘","⽣":"生","甤":"甤","⽤":"用","⽥":"田","画":"画","甾":"甾","𤰶":"𤰶",留:"留",略:"略",異:"異","異":"異","𤲒":"𤲒","⽦":"疋","⽧":"疒",痢:"痢","瘐":"瘐","瘟":"瘟","瘝":"瘝",療:"療",癩:"癩","⽨":"癶","⽩":"白","𤾡":"𤾡","𤾸":"𤾸","⽪":"皮","⽫":"皿","𥁄":"𥁄","㿼":"㿼",益:"益","益":"益","盛":"盛",盧:"盧","䀈":"䀈","⽬":"目","直":"直","直":"直","𥃲":"𥃲","𥃳":"𥃳",省:"省","䀘":"䀘","𥄙":"𥄙","眞":"眞","真":"真","真":"真","𥄳":"𥄳","着":"着","睊":"睊","睊":"睊","鿃":"䀹","䀹":"䀹","䀹":"䀹",晣:"䀿","䁆":"䁆","瞋":"瞋","𥉉":"𥉉","瞧":"瞧","⽭":"矛","⽮":"矢","⽯":"石","䂖":"䂖","𥐝":"𥐝",硏:"研","硎":"硎",硫:"硫",碌:"碌","碌":"碌","碑":"碑",磊:"磊","磌":"磌","磌":"磌",磻:"磻","䃣":"䃣",礪:"礪","⽰":"示","⺭":"礻",礼:"礼","社":"社","祈":"祈","祉":"祉","𥘦":"𥘦","祐":"祐","祖":"祖","祖":"祖","祝":"祝",神:"神",祥:"祥","視":"視","視":"視",祿:"祿","𥚚":"𥚚","禍":"禍","禎":"禎",福:"福","福":"福","𥛅":"𥛅",禮:"禮","⽱":"禸","⽲":"禾",秊:"秊","䄯":"䄯","秫":"秫",稜:"稜","穊":"穊","穀":"穀","穀":"穀","穏":"穏","⽳":"穴","突":"突","𥥼":"𥥼","窱":"窱",立:"立","⽴":"立","⻯":"竜","𥪧":"𥪧","𥪧":"𥪧","竮":"竮","⽵":"竹",笠:"笠","節":"節","節":"節","䈂":"䈂","𥮫":"𥮫","篆":"篆","䈧":"䈧","築":"築","𥲀":"𥲀","𥳐":"𥳐",簾:"簾",籠:"籠","⽶":"米","类":"类",粒:"粒",精:"精","糒":"糒",糖:"糖","糨":"糨","䊠":"䊠","糣":"糣",糧:"糧","⽷":"糸","⺯":"糹","𥾆":"𥾆","紀":"紀",紐:"紐",索:"索",累:"累",絶:"絕","絣":"絣","絛":"絛",綠:"綠",綾:"綾","緇":"緇",練:"練","練":"練","練":"練","縂":"縂","䌁":"䌁","縉":"縉",縷:"縷","繁":"繁","繅":"繅","𦇚":"𦇚","䌴":"䌴","⽸":"缶","𦈨":"𦈨","缾":"缾","𦉇":"𦉇","⽹":"网","⺫":"罒","⺲":"罒","⺱":"罓","䍙":"䍙","署":"署","𦋙":"𦋙",罹:"罹","罺":"罺",羅:"羅","𦌾":"𦌾","⽺":"羊","羕":"羕",羚:"羚",羽:"羽","⽻":"羽","翺":"翺",老:"老","⽼":"老","⺹":"耂","者":"者","者":"者","者":"者","⽽":"而","𦓚":"𦓚","⽾":"耒","𦔣":"𦔣","⽿":"耳",聆:"聆","聠":"聠","𦖨":"𦖨",聯:"聯","聰":"聰",聾:"聾","⾀":"聿","⺺":"肀","⾁":"肉",肋:"肋","肭":"肭","育":"育","䏕":"䏕","䏙":"䏙",腁:"胼","脃":"脃","脾":"脾","䐋":"䐋","朡":"朡","𦞧":"𦞧","𦞵":"𦞵",朦:"䑃",臘:"臘","⾂":"臣",臨:"臨","⾃":"自","臭":"臭","⾄":"至","⾅":"臼","舁":"舁","舁":"舁","舄":"舄","⾆":"舌","舘":"舘","⾇":"舛","⾈":"舟","䑫":"䑫","⾉":"艮",良:"良","⾊":"色","⾋":"艸","艹":"艹","艹":"艹","⺾":"艹","⺿":"艹","⻀":"艹","芋":"芋","芑":"芑","芝":"芝","花":"花","芳":"芳","芽":"芽",若:"若","若":"若","苦":"苦","𦬼":"𦬼",茶:"茶","荒":"荒","荣":"荣","茝":"茝","茣":"茣","莽":"莽","荓":"荓",菉:"菉","菊":"菊","菌":"菌","菜":"菜","菧":"菧","華":"華",菱:"菱","著":"著","著":"著","𦰶":"𦰶","莭":"莭",落:"落",葉:"葉",蔿:"蒍","𦳕":"𦳕","𦵫":"𦵫",蓮:"蓮","蓱":"蓱","蓳":"蓳",蓼:"蓼","蔖":"蔖","䔫":"䔫","蕤":"蕤","𦼬":"𦼬",藍:"藍","䕝":"䕝","𦾱":"𦾱","䕡":"䕡",藺:"藺",蘆:"蘆","䕫":"䕫",蘒:"蘒",蘭:"蘭","𧃒":"𧃒",虁:"蘷",蘿:"蘿","⾌":"虍","⻁":"虎","虐":"虐",虜:"虜","虜":"虜","虧":"虧","虩":"虩","⾍":"虫","蚩":"蚩","蚈":"蚈","蛢":"蛢","蜎":"蜎","蜨":"蜨","蝫":"蝫","蟡":"蟡","蝹":"蝹","蝹":"蝹","螆":"螆","䗗":"䗗","𧏊":"𧏊",螺:"螺","蠁":"蠁","䗹":"䗹",蠟:"蠟","⾎":"血",行:"行","⾏":"行","衠":"衠","衣":"衣","⾐":"衣","⻂":"衤",裂:"裂","𧙧":"𧙧",裏:"裏","裗":"裗","裞":"裞",裡:"裡",裸:"裸","裺":"裺","䘵":"䘵","褐":"褐","襁":"襁",襤:"襤","⾑":"襾","⻄":"西","⻃":"覀","覆":"覆",見:"見","⾒":"見","𧢮":"𧢮","⻅":"见","⾓":"角","⾔":"言","𧥦":"𧥦",詽:"訮",訞:"䚶","䚾":"䚾","䛇":"䛇","誠":"誠",說:"說",說:"說","調":"調","請":"請",諒:"諒",論:"論","諭":"諭","諭":"諭",諸:"諸","諸":"諸",諾:"諾","諾":"諾","謁":"謁","謁":"謁","謹":"謹","謹":"謹",識:"識",讀:"讀",讏:"讆","變":"變","變":"變","⻈":"讠","⾕":"谷","⾖":"豆",豈:"豈","豕":"豕","⾗":"豕",豣:"豜","⾘":"豸","𧲨":"𧲨","⾙":"貝","貫":"貫","賁":"賁",賂:"賂",賈:"賈","賓":"賓","贈":"贈","贈":"贈","贛":"贛","⻉":"贝","⾚":"赤","⾛":"走","起":"起",趆:"赿","𧻓":"𧻓","𧼯":"𧼯","⾜":"足","跋":"跋","趼":"趼",跺:"跥",路:"路","跰":"跰",躛:"躗","⾝":"身",車:"車","⾞":"車","軔":"軔",輧:"軿",輦:"輦",輪:"輪","輸":"輸","輸":"輸",輻:"輻",轢:"轢","⻋":"车","⾟":"辛","辞":"辞",辰:"辰","⾠":"辰","⾡":"辵","辶":"辶","⻌":"辶","⻍":"辶","巡":"巡",連:"連",逸:"逸","逸":"逸","遲":"遲",遼:"遼","𨗒":"𨗒","𨗭":"𨗭",邏:"邏","⾢":"邑","邔":"邔",郎:"郎",郞:"郎","郞":"郎","郱":"郱",都:"都","𨜮":"𨜮","鄑":"鄑","鄛":"鄛","⾣":"酉",酪:"酪","醙":"醙",醴:"醴","⾤":"釆",里:"里","⾥":"里",量:"量",金:"金","⾦":"金",鈴:"鈴","鈸":"鈸","鉶":"鉶","鋗":"鋗","鋘":"鋘","鉼":"鉼",錄:"錄",鍊:"鍊",鎮:"鎭","鏹":"鏹","鐕":"鐕","𨯺":"𨯺","⻐":"钅","⻑":"長","⾧":"長","⻒":"镸","⻓":"长","⾨":"門","開":"開","䦕":"䦕",閭:"閭","閷":"閷","𨵷":"𨵷","⻔":"门","⾩":"阜","⻏":"阝","⻖":"阝",阮:"阮",陋:"陋",降:"降",陵:"陵",陸:"陸","陼":"陼",隆:"隆",隣:"隣","䧦":"䧦","⾪":"隶","隷":"隷",隸:"隷",隸:"隷","⾫":"隹","雃":"雃",離:"離","難":"難","難":"難","⾬":"雨",零:"零",雷:"雷","霣":"霣","𩅅":"𩅅",露:"露",靈:"靈","⾭":"靑","⻘":"青",靖:"靖","靖":"靖","𩇟":"𩇟","⾮":"非","⾯":"面","𩈚":"𩈚","⾰":"革","䩮":"䩮","䩶":"䩶","⾱":"韋","韛":"韛","韠":"韠","⻙":"韦","⾲":"韭","𩐊":"𩐊","⾳":"音","響":"響","響":"響","⾴":"頁","䪲":"䪲","頋":"頋","頋":"頋","頋":"頋",領:"領","頩":"頩","𩒖":"𩒖","頻":"頻","頻":"頻",類:"類","⻚":"页","⾵":"風","𩖶":"𩖶","⻛":"风","⾶":"飛","⻜":"飞","⻝":"食","⾷":"食","⻟":"飠","飢":"飢",飯:"飯",飼:"飼","䬳":"䬳",館:"館","餩":"餩","⻠":"饣","⾸":"首","⾹":"香","馧":"馧","⾺":"馬","駂":"駂",駱:"駱","駾":"駾",驪:"驪","⻢":"马","⾻":"骨","䯎":"䯎","⾼":"高","⾽":"髟","𩬰":"𩬰","鬒":"鬒","鬒":"鬒","⾾":"鬥","⾿":"鬯","⿀":"鬲","⿁":"鬼","⻤":"鬼","⿂":"魚",魯:"魯","鱀":"鱀",鱗:"鱗","⻥":"鱼","⿃":"鳥","鳽":"鳽","䳎":"䳎","鵧":"鵧","䳭":"䳭","𪃎":"𪃎",鶴:"鶴","𪄅":"𪄅","䳸":"䳸",鷺:"鷺","𪈎":"𪈎",鸞:"鸞",鹃:"鹂","⿄":"鹵",鹿:"鹿","⿅":"鹿","𪊑":"𪊑",麗:"麗",麟:"麟","⿆":"麥","⻨":"麦","麻":"麻","⿇":"麻","𪎒":"𪎒","⿈":"黃","⻩":"黄","⿉":"黍",黎:"黎","䵖":"䵖","⿊":"黑",黒:"黑","墨":"墨","黹":"黹","⿋":"黹","⿌":"黽","鼅":"鼅","黾":"黾","⿍":"鼎","鼏":"鼏","⿎":"鼓","鼖":"鼖","⿏":"鼠","鼻":"鼻","⿐":"鼻","齃":"齃","⿑":"齊","⻬":"齐","⿒":"齒","𪘀":"𪘀","⻮":"齿",龍:"龍","⿓":"龍","龎":"龎","⻰":"龙",龜:"龜",龜:"龜","龜":"龜","⿔":"龜","⻳":"龟","⿕":"龠"};var BI,r$;function lve(){if(r$)return BI;r$=1;var t=cve;function e(s){return s.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}var n=RegExp(Object.keys(t).map(e).join("|"),"g");function r(s){return t[s]}function i(s){return s.replace(n,r)}return BI=i,BI}var uve=lve();const dve=Dl(uve),fve=Object.prototype.toString,hve=t=>fve.call(t)==="[object Error]",pve=new Set(["network error","Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed","fetch failed","terminated"," A network error occurred.","Network connection lost"]);function mve(t){if(!(t&&hve(t)&&t.name==="TypeError"&&typeof t.message=="string"))return!1;const{message:n,stack:r}=t;return n==="Load failed"?r===void 0||"__sentry_captured__"in t:n.startsWith("error sending request for url")?!0:pve.has(n)}function gve(t){if(typeof t=="number"){if(t<0)throw new TypeError("Expected `retries` to be a non-negative number.");if(Number.isNaN(t))throw new TypeError("Expected `retries` to be a valid number or Infinity, got NaN.")}else if(t!==void 0)throw new TypeError("Expected `retries` to be a number or Infinity.")}function V2(t,e,{min:n=0,allowInfinity:r=!1}={}){if(e!==void 0){if(typeof e!="number"||Number.isNaN(e))throw new TypeError(`Expected \`${t}\` to be a number${r?" or Infinity":""}.`);if(!r&&!Number.isFinite(e))throw new TypeError(`Expected \`${t}\` to be a finite number.`);if(e<n)throw new TypeError(`Expected \`${t}\` to be ≥ ${n}.`)}}class qX extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}const vve=(t,e,n)=>{const r=n.retries-(e-1);return Object.freeze({error:t,attemptNumber:e,retriesLeft:r})};function yve(t,e){const n=e.randomize?Math.random()+1:1;let r=Math.round(n*Math.max(e.minTimeout,1)*e.factor**(t-1));return r=Math.min(r,e.maxTimeout),r}async function bve(t,e,n,r,i){let s=t;if(s instanceof Error||(s=new TypeError(`Non-error was thrown: "${s}". You should only throw errors.`)),s instanceof qX)throw s.originalError;if(s instanceof TypeError&&!mve(s))throw s;const o=vve(s,e,n);await n.onFailedAttempt(o);const a=Date.now();if(a-r>=i||e>=n.retries+1||!await n.shouldRetry(o))throw s;const c=yve(e,n),l=i-(a-r);if(l<=0)throw s;const d=Math.min(c,l);d>0&&await new Promise((h,m)=>{const g=()=>{clearTimeout(y),n.signal?.removeEventListener("abort",g),m(n.signal.reason)},y=setTimeout(()=>{n.signal?.removeEventListener("abort",g),h()},d);n.unref&&y.unref?.(),n.signal?.addEventListener("abort",g,{once:!0})}),n.signal?.throwIfAborted()}async function _ve(t,e={}){if(e={...e},gve(e.retries),Object.hasOwn(e,"forever"))throw new Error("The `forever` option is no longer supported. For many use-cases, you can set `retries: Infinity` instead.");e.retries??=10,e.factor??=2,e.minTimeout??=1e3,e.maxTimeout??=Number.POSITIVE_INFINITY,e.randomize??=!1,e.onFailedAttempt??=()=>{},e.shouldRetry??=()=>!0,V2("factor",e.factor,{min:0,allowInfinity:!1}),V2("minTimeout",e.minTimeout,{min:0,allowInfinity:!1}),V2("maxTimeout",e.maxTimeout,{min:0,allowInfinity:!0});const n=e.maxRetryTime??Number.POSITIVE_INFINITY;V2("maxRetryTime",n,{min:0,allowInfinity:!0}),e.factor>0||(e.factor=1),e.signal?.throwIfAborted();let r=0;const i=Date.now(),s=n;for(;r<e.retries+1;){r++;try{e.signal?.throwIfAborted();const o=await t(r);return e.signal?.throwIfAborted(),o}catch(o){await bve(o,r,e,i,s)}}throw new Error("Retry attempts exhausted without throwing an error.")}let uy=class{constructor(e,n){if(this.stable=e,this.unstable=n,!this.unstable&&!this.stable)throw new Error("One of stable or unstable values must be supplied")}get name(){return this.stable?this.stable:this.unstable}get altName(){return this.stable?this.unstable:null}get names(){var e=[this.name],n=this.altName;return n&&e.push(n),e}matches(e){return this.name===e||this.altName===e}findIn(e){var n=void 0;return this.name&&(n=e?.[this.name]),!n&&this.altName&&(n=e?.[this.altName]),n}includedIn(e){var n=!1;return this.name&&(n=e.includes(this.name)),!n&&this.altName&&(n=e.includes(this.altName)),n}};class pT extends uy{constructor(){super(...arguments),M(this,"preferUnstable",!1)}setPreferUnstable(e){this.preferUnstable=e}get name(){return this.stable&&!this.preferUnstable?this.stable:this.unstable}}class Kr extends uy{constructor(e,n){if(super(e,n),!this.unstable)throw new Error("Unstable value must be supplied")}get name(){return this.unstable}get altName(){return this.stable}}var Tv=(function(t){return t.Self="m.self",t.Pin="m.pin",t})({}),L_=new Kr("m.asset","org.matrix.msc3488.asset"),oh=new Kr("m.ts","org.matrix.msc3488.ts"),M_=new Kr("m.location","org.matrix.msc3488.location"),xs=(function(t){return t.Read="m.read",t.FullyRead="m.fully_read",t.ReadPrivate="m.read.private",t})({}),O_="main";function i$(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function s$(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?i$(Object(n),!0).forEach(function(r){M(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):i$(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var HI=new Map;function qI(t){return t instanceof String&&(t=t.toString()),HI.has(t)||HI.set(t,t),HI.get(t)}function oA(t,e){var n=e??new URLSearchParams,r=function(a){s!=null&&(Array.isArray(s)?s.forEach(c=>{n.append(a,String(c))}):n.append(a,String(s)))};for(var[i,s]of Object.entries(t))r(i);return n}function o$(t,e,n){var r=s$(s$({},n),{},{[e]:n[t]});return delete r[t],r}function Oe(t,e){for(var n in e)if(e.hasOwnProperty(n)){var r=e[n];r!=null&&(t=t.replace(n,encodeURIComponent(r)))}return t}function bC(t,e,n){var r;if(n){for(r=t.length-1;r>=0;r--)if(e(t[r],r,t))return t.splice(r,1),!0}else for(r=0;r<t.length;r++)if(e(t[r],r,t))return t.splice(r,1),!0;return!1}function VX(t,e){for(var n of e)if(!t.hasOwnProperty(n))throw new Error("Missing required key: "+n)}function P_(t){return JSON.parse(JSON.stringify(t))}function Ip(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="number"&&isNaN(t)&&isNaN(e))return!0;if(t===null||e===null)return t===e;if(t.constructor.name!=="Object"&&t.constructor.name!=="RegExp"&&t.constructor.name!=="Date"&&t.constructor.name!=="Array"||t.prototype!==e.prototype)return!1;if(t instanceof RegExp||t instanceof Date)return t.toString()===e.toString();if(Array.isArray(t)){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!Ip(t[n],e[n]))return!1}else{for(var r in e)if(e.hasOwnProperty(r)!==t.hasOwnProperty(r))return!1;for(var i in t)if(e.hasOwnProperty(i)!==t.hasOwnProperty(i)||!Ip(t[i],e[i]))return!1}return!0}function aA(t){if(typeof t!="object"||t==null||Array.isArray(t))return t;var e=[];for(var[n,r]of Object.entries(t))e.push([n,aA(r)]);return e.sort((i,s)=>uE(i[0],s[0])),e}function a$(t){return typeof t=="number"&&isFinite(t)}function kf(t){return typeof t=="string"?dve(t.normalize("NFD").replace(wve,"")):""}function _C(t){return typeof t=="string"?t.replace(/[\u202d-\u202e]/g,""):""}function Sve(t){return kf(t.toLowerCase()).replace(/[\\'!"#$%&()*+,\-./:;<=>?@[\]^_`{|}~\u2000-\u206f\u2e00-\u2e7f]/g,"").toLowerCase()}var wve=/[\u2000-\u200F\u202A-\u202F\u0300-\u036F\uFEFF\u061C\u2800\u2062-\u2063\s]/g;function KX(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function GX(t){return KX(t).replace(/\\\*/g,".*").replace(/\?/g,".")}function VI(t){return t!=null&&t.endsWith("/")?t.slice(0,-1):t}function Yp(t,e){return new Promise(n=>{setTimeout(n,t,e)})}function Rot(t,e,n){return cA.apply(this,arguments)}function cA(){return cA=B(function*(t,e,n){var r=Date.now();try{return yield n()}finally{var i=Date.now();t.debug("[Perf]: ".concat(e," took ").concat(i-r,"ms"))}}),cA.apply(this,arguments)}function Eve(t,e,n){var r=Date.now();try{return n()}finally{var i=Date.now();t.debug("[Perf]: ".concat(e," took ").concat(i-r,"ms"))}}function zX(t){return t==null}function c$(t,e){return lA.apply(this,arguments)}function lA(){return lA=B(function*(t,e){for(var n of t)yield e(yield n)}),lA.apply(this,arguments)}function ig(t){return Promise.resolve(t())}function Cve(t,e){return _ve(n=>t(n),{retries:1/0,shouldRetry:e?n=>{var{error:r}=n;return e(r)}:void 0,factor:2,minTimeout:3e3,maxTimeout:15e3})}var qf=(()=>{for(var t="",e=32;e<=126;e++)t+=String.fromCharCode(e);return t})();function l$(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:qf;return t.padEnd(e,n[0])}function Cb(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:qf,n=BigInt(e.length);if(t<=n){var r;return(r=e[Number(t)-1])!==null&&r!==void 0?r:""}var i=t/n,s=Number(t%n)-1;return s<0&&(i-=BigInt(Math.abs(s)),s=Number(n)-1),Cb(i,e)+e[s]}function SC(t){for(var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:qf,n=BigInt(e.length),r=BigInt(0),i=t.length-1,s=BigInt(0);i>=0;i--,s++){var o=t.charCodeAt(i)-e.charCodeAt(0);r+=BigInt(1+o)*n**s}return r}function Tve(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:qf,r=Math.max(t.length,e.length),i=SC(l$(t,r,n),n),s=SC(l$(e,r,n),n),o=(i+s)/BigInt(2);return o===i||o==s?Cb(o,n)+n[0]:Cb(o,n)}function O0(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:qf;return Cb(SC(t,e)+BigInt(1),e)}function u$(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:qf;return Cb(SC(t,e)-BigInt(1),e)}function uE(t,e){return t<e?-1:t>e?1:0}function WX(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;for(var[r,i]of Object.entries(e)){if(t[r]instanceof Object&&i){WX(t[r],i);continue}if(i!=null||!n){wC(t,r,i);continue}}return t}function d$(t){var e;return(e=oh.findIn(t.getContent()))!==null&&e!==void 0?e:-1}function Rve(t,e){return d$(e)-d$(t)}function qO(t){return[xs.Read,xs.ReadPrivate].includes(t)}function f$(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:(o,a)=>o===a;if(t.size!==e.size)return!1;for(var[r,i]of t){var s=e.get(r);if(s===void 0||!n(i,s))return!1}return!0}function YX(t){return t instanceof Map?up(t):Array.isArray(t)?t.map(e=>YX(e)):t}function up(t){var e=new Map;for(var[n,r]of t)e.set(n,YX(r));return Object.fromEntries(e.entries())}function $1(t){return t==="__proto__"||t==="prototype"||t==="constructor"}function wC(t,e,n){if($1(e))throw new Error("Trying to modify prototype or constructor");t[e]=n}function wc(t){return!($1(t.room_id)||$1(t.sender)||$1(t.event_id))}class Hu extends Map{constructor(e){super(),this.createDefault=e}getOrCreate(e){return this.has(e)||this.set(e,this.createDefault()),this.get(e)}}var uA="migrationState",Rv=(function(t){return t[t.NOT_STARTED=0]="NOT_STARTED",t[t.INITIAL_DATA_MIGRATED=1]="INITIAL_DATA_MIGRATED",t[t.OLM_SESSIONS_MIGRATED=2]="OLM_SESSIONS_MIGRATED",t[t.MEGOLM_SESSIONS_MIGRATED=3]="MEGOLM_SESSIONS_MIGRATED",t[t.ROOM_SETTINGS_MIGRATED=4]="ROOM_SETTINGS_MIGRATED",t[t.INITIAL_OWN_KEY_QUERY_DONE=5]="INITIAL_OWN_KEY_QUERY_DONE",t})({}),kv=50;function h$(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function p$(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?h$(Object(n),!0).forEach(function(r){M(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):h$(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function K2(t,e){return encodeURIComponent(t)+"/"+encodeURIComponent(e)}function kve(t){var e=t.split("/"),n=decodeURIComponent(e[0]),r=decodeURIComponent(e[1]);return{senderKey:n,sessionId:r}}class mT{constructor(){M(this,"migrationState",Rv.NOT_STARTED),M(this,"account",null),M(this,"crossSigningKeys",null),M(this,"privateKeys",{}),M(this,"sessions",{}),M(this,"inboundGroupSessions",{}),M(this,"inboundGroupSessionsWithheld",{}),M(this,"rooms",{}),M(this,"sessionsNeedingBackup",{})}containsData(){var e=this;return B(function*(){return e.account!==null})()}startup(){var e=this;return B(function*(){return e})()}deleteAllData(){return Promise.resolve()}getMigrationState(){var e=this;return B(function*(){return e.migrationState})()}setMigrationState(e){var n=this;return B(function*(){n.migrationState=e})()}getAccount(e,n){n(this.account)}storeAccount(e,n){this.account=n}getCrossSigningKeys(e,n){n(this.crossSigningKeys)}getSecretStorePrivateKey(e,n,r){var i=this.privateKeys[r];n(i||null)}storeSecretStorePrivateKey(e,n,r){this.privateKeys[n]=r}countEndToEndSessions(e,n){var r=0;for(var i of Object.values(this.sessions))r+=Object.keys(i).length;n(r)}getEndToEndSession(e,n,r,i){var s=this.sessions[e]||{};i(s[n]||null)}getEndToEndSessions(e,n,r){r(this.sessions[e]||{})}storeEndToEndSession(e,n,r,i){var s=this.sessions[e];s===void 0&&(s={},this.sessions[e]=s),wC(s,n,r)}getEndToEndSessionsBatch(){var e=this;return B(function*(){var n=[];for(var r of Object.values(e.sessions))for(var i of Object.values(r))if(n.push(i),n.length>=kv)return n;return n.length===0?null:n})()}deleteEndToEndSessionsBatch(e){var n=this;return B(function*(){for(var{deviceKey:r,sessionId:i}of e){var s=n.sessions[r]||{};delete s[i],Object.keys(s).length===0&&delete n.sessions[r]}})()}getEndToEndInboundGroupSession(e,n,r,i){var s=K2(e,n);i(this.inboundGroupSessions[s]||null,this.inboundGroupSessionsWithheld[s]||null)}storeEndToEndInboundGroupSession(e,n,r,i){var s=K2(e,n);this.inboundGroupSessions[s]=r}countEndToEndInboundGroupSessions(){var e=this;return B(function*(){return Object.keys(e.inboundGroupSessions).length})()}getEndToEndInboundGroupSessionsBatch(){var e=this;return B(function*(){var n=[];for(var[r,i]of Object.entries(e.inboundGroupSessions))if(n.push(p$(p$({},kve(r)),{},{sessionData:i,needsBackup:r in e.sessionsNeedingBackup})),n.length>=kv)return n;return n.length===0?null:n})()}deleteEndToEndInboundGroupSessionsBatch(e){var n=this;return B(function*(){for(var{senderKey:r,sessionId:i}of e){var s=K2(r,i);delete n.inboundGroupSessions[s]}})()}getEndToEndRooms(e,n){n(this.rooms)}markSessionsNeedingBackup(e){for(var n of e){var r=K2(n.senderKey,n.sessionId);this.sessionsNeedingBackup[r]=!0}return Promise.resolve()}doTxn(e,n,r){return Promise.resolve(r(null))}}var Ive=/^(?:(?:\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})|(?:\[[\dA-Fa-f:.]{2,45}])|(?:[A-Za-z\d\-.]{1,255}))(?::\d{1,5})?$/;function xve(t){var e=Ive.exec(t);return e?.[0]===t}var Ave=/^[\w-]+$/;function Lve(t){var e=Ave.exec(t);return e?.[0]===t}function gT(t,e,n,r,i){var s=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1,o=arguments.length>6?arguments[6]:void 0,a=arguments.length>7?arguments[7]:void 0;if(typeof e!="string"||!e)return"";if(!e.startsWith("mxc://"))return s?e:"";var[c,l,...d]=e.slice(6).split("/");if(d.length>0||!xve(c)||!Lve(l))return"";a&&(o=!0);var h,m=!!n||!!r||!!i,g=m?"thumbnail":"download";a?h="/_matrix/client/v1/media/".concat(g):h="/_matrix/media/v3/".concat(g);var y=new URL("".concat(h,"/").concat(c,"/").concat(l),t);return n&&y.searchParams.set("width",Math.round(n).toString()),r&&y.searchParams.set("height",Math.round(r).toString()),i&&y.searchParams.set("method",i),typeof o=="boolean"&&y.searchParams.set("allow_redirect",JSON.stringify(o)),y.href}var dE={exports:{}},Mve=dE.exports,m$;function Ove(){return m$||(m$=1,(function(t){(function(e,n){t.exports?t.exports=n():e.log=n()})(Mve,function(){var e=function(){},n="undefined",r=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"],s={},o=null;function a(v,E){var w=v[E];if(typeof w.bind=="function")return w.bind(v);try{return Function.prototype.bind.call(w,v)}catch{return function(){return Function.prototype.apply.apply(w,[v,arguments])}}}function c(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(v){return v==="debug"&&(v="log"),typeof console===n?!1:v==="trace"&&r?c:console[v]!==void 0?a(console,v):console.log!==void 0?a(console,"log"):e}function d(){for(var v=this.getLevel(),E=0;E<i.length;E++){var w=i[E];this[w]=E<v?e:this.methodFactory(w,v,this.name)}if(this.log=this.debug,typeof console===n&&v<this.levels.SILENT)return"No console available for logging"}function h(v){return function(){typeof console!==n&&(d.call(this),this[v].apply(this,arguments))}}function m(v,E,w){return l(v)||h.apply(this,arguments)}function g(v,E){var w=this,R,x,C,k="loglevel";typeof v=="string"?k+=":"+v:typeof v=="symbol"&&(k=void 0);function T(j){var H=(i[j]||"silent").toUpperCase();if(!(typeof window===n||!k)){try{window.localStorage[k]=H;return}catch{}try{window.document.cookie=encodeURIComponent(k)+"="+H+";"}catch{}}}function L(){var j;if(!(typeof window===n||!k)){try{j=window.localStorage[k]}catch{}if(typeof j===n)try{var H=window.document.cookie,z=encodeURIComponent(k),Y=H.indexOf(z+"=");Y!==-1&&(j=/^([^;]+)/.exec(H.slice(Y+z.length+1))[1])}catch{}return w.levels[j]===void 0&&(j=void 0),j}}function O(){if(!(typeof window===n||!k)){try{window.localStorage.removeItem(k)}catch{}try{window.document.cookie=encodeURIComponent(k)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function P(j){var H=j;if(typeof H=="string"&&w.levels[H.toUpperCase()]!==void 0&&(H=w.levels[H.toUpperCase()]),typeof H=="number"&&H>=0&&H<=w.levels.SILENT)return H;throw new TypeError("log.setLevel() called with invalid level: "+j)}w.name=v,w.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},w.methodFactory=E||m,w.getLevel=function(){return C??x??R},w.setLevel=function(j,H){return C=P(j),H!==!1&&T(C),d.call(w)},w.setDefaultLevel=function(j){x=P(j),L()||w.setLevel(j,!1)},w.resetLevel=function(){C=null,O(),d.call(w)},w.enableAll=function(j){w.setLevel(w.levels.TRACE,j)},w.disableAll=function(j){w.setLevel(w.levels.SILENT,j)},w.rebuild=function(){if(o!==w&&(R=P(o.getLevel())),d.call(w),o===w)for(var j in s)s[j].rebuild()},R=P(o?o.getLevel():"WARN");var D=L();D!=null&&(C=P(D)),d.call(w)}o=new g,o.getLogger=function(E){if(typeof E!="symbol"&&typeof E!="string"||E==="")throw new TypeError("You must supply a name when creating a logger.");var w=s[E];return w||(w=s[E]=new g(E,o.methodFactory)),w};var y=typeof window!==n?window.log:void 0;return o.noConflict=function(){return typeof window!==n&&window.log===o&&(window.log=y),o},o.getLoggers=function(){return s},o.default=o,o})})(dE)),dE.exports}var Pve=Ove();const dA=Dl(Pve);var Dve="matrix";dA.methodFactory=function(t,e,n){return function(){for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];this.prefix&&i.unshift(this.prefix);var o=t==="error"||t==="warn"||t==="trace"||t==="info"||t==="debug";return o?console[t](...i):console.log(...i)}};function XX(t){var e=Dve+(t===void 0?"":"-".concat(t)),n=dA.getLogger(e);return n.getChild===void 0&&(n.prefix=t,n.getChild=r=>{var i=XX((t??"")+r);return i.methodFactory=n.methodFactory,i.rebuild(),i},n.setLevel(dA.levels.DEBUG,!1)),n}var N=XX();class kot{constructor(e,n){this.parent=e,M(this,"name",void 0),this.name=n+":"}trace(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];this.parent.trace(this.name,...n)}debug(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];this.parent.debug(this.name,...n)}info(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];this.parent.info(this.name,...n)}warn(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];this.parent.warn(this.name,...n)}error(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];this.parent.error(this.name,...n)}}class VO{constructor(e){this.debugInstance=e}trace(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];this.debugWithPrefix("[TRACE]",...n)}debug(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];this.debugWithPrefix("[DEBUG]",...n)}info(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];this.debugWithPrefix("[INFO]",...n)}warn(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];this.debugWithPrefix("[WARN]",...n)}error(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];this.debugWithPrefix("[ERROR]",...n)}getChild(e){return new VO(this.debugInstance.extend(e))}debugWithPrefix(e){for(var n,r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];if(i.length===0)n="";else if(i[0]instanceof Error){var o=i.shift();n=o.stack||o.message}else typeof i[0]=="string"?n=i.shift():n="%O";this.debugInstance(e+" "+n,...i)}}var G2={exports:{}},g$;function Nve(){if(g$)return G2.exports;g$=1;var t=typeof Reflect=="object"?Reflect:null,e=t&&typeof t.apply=="function"?t.apply:function(k,T,L){return Function.prototype.apply.call(k,T,L)},n;t&&typeof t.ownKeys=="function"?n=t.ownKeys:Object.getOwnPropertySymbols?n=function(k){return Object.getOwnPropertyNames(k).concat(Object.getOwnPropertySymbols(k))}:n=function(k){return Object.getOwnPropertyNames(k)};function r(C){console&&console.warn&&console.warn(C)}var i=Number.isNaN||function(k){return k!==k};function s(){s.init.call(this)}G2.exports=s,G2.exports.once=w,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function a(C){if(typeof C!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof C)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(C){if(typeof C!="number"||C<0||i(C))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+C+".");o=C}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(k){if(typeof k!="number"||k<0||i(k))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+k+".");return this._maxListeners=k,this};function c(C){return C._maxListeners===void 0?s.defaultMaxListeners:C._maxListeners}s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(k){for(var T=[],L=1;L<arguments.length;L++)T.push(arguments[L]);var O=k==="error",P=this._events;if(P!==void 0)O=O&&P.error===void 0;else if(!O)return!1;if(O){var D;if(T.length>0&&(D=T[0]),D instanceof Error)throw D;var j=new Error("Unhandled error."+(D?" ("+D.message+")":""));throw j.context=D,j}var H=P[k];if(H===void 0)return!1;if(typeof H=="function")e(H,this,T);else for(var z=H.length,Y=y(H,z),L=0;L<z;++L)e(Y[L],this,T);return!0};function l(C,k,T,L){var O,P,D;if(a(T),P=C._events,P===void 0?(P=C._events=Object.create(null),C._eventsCount=0):(P.newListener!==void 0&&(C.emit("newListener",k,T.listener?T.listener:T),P=C._events),D=P[k]),D===void 0)D=P[k]=T,++C._eventsCount;else if(typeof D=="function"?D=P[k]=L?[T,D]:[D,T]:L?D.unshift(T):D.push(T),O=c(C),O>0&&D.length>O&&!D.warned){D.warned=!0;var j=new Error("Possible EventEmitter memory leak detected. "+D.length+" "+String(k)+" listeners added. Use emitter.setMaxListeners() to increase limit");j.name="MaxListenersExceededWarning",j.emitter=C,j.type=k,j.count=D.length,r(j)}return C}s.prototype.addListener=function(k,T){return l(this,k,T,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(k,T){return l(this,k,T,!0)};function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(C,k,T){var L={fired:!1,wrapFn:void 0,target:C,type:k,listener:T},O=d.bind(L);return O.listener=T,L.wrapFn=O,O}s.prototype.once=function(k,T){return a(T),this.on(k,h(this,k,T)),this},s.prototype.prependOnceListener=function(k,T){return a(T),this.prependListener(k,h(this,k,T)),this},s.prototype.removeListener=function(k,T){var L,O,P,D,j;if(a(T),O=this._events,O===void 0)return this;if(L=O[k],L===void 0)return this;if(L===T||L.listener===T)--this._eventsCount===0?this._events=Object.create(null):(delete O[k],O.removeListener&&this.emit("removeListener",k,L.listener||T));else if(typeof L!="function"){for(P=-1,D=L.length-1;D>=0;D--)if(L[D]===T||L[D].listener===T){j=L[D].listener,P=D;break}if(P<0)return this;P===0?L.shift():v(L,P),L.length===1&&(O[k]=L[0]),O.removeListener!==void 0&&this.emit("removeListener",k,j||T)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(k){var T,L,O;if(L=this._events,L===void 0)return this;if(L.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):L[k]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete L[k]),this;if(arguments.length===0){var P=Object.keys(L),D;for(O=0;O<P.length;++O)D=P[O],D!=="removeListener"&&this.removeAllListeners(D);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(T=L[k],typeof T=="function")this.removeListener(k,T);else if(T!==void 0)for(O=T.length-1;O>=0;O--)this.removeListener(k,T[O]);return this};function m(C,k,T){var L=C._events;if(L===void 0)return[];var O=L[k];return O===void 0?[]:typeof O=="function"?T?[O.listener||O]:[O]:T?E(O):y(O,O.length)}s.prototype.listeners=function(k){return m(this,k,!0)},s.prototype.rawListeners=function(k){return m(this,k,!1)},s.listenerCount=function(C,k){return typeof C.listenerCount=="function"?C.listenerCount(k):g.call(C,k)},s.prototype.listenerCount=g;function g(C){var k=this._events;if(k!==void 0){var T=k[C];if(typeof T=="function")return 1;if(T!==void 0)return T.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function y(C,k){for(var T=new Array(k),L=0;L<k;++L)T[L]=C[L];return T}function v(C,k){for(;k+1<C.length;k++)C[k]=C[k+1];C.pop()}function E(C){for(var k=new Array(C.length),T=0;T<k.length;++T)k[T]=C[T].listener||C[T];return k}function w(C,k){return new Promise(function(T,L){function O(D){C.removeListener(k,P),L(D)}function P(){typeof C.removeListener=="function"&&C.removeListener("error",O),T([].slice.call(arguments))}x(C,k,P,{once:!0}),k!=="error"&&R(C,O,{once:!0})})}function R(C,k,T){typeof C.on=="function"&&x(C,"error",k,T)}function x(C,k,T,L){if(typeof C.on=="function")L.once?C.once(k,T):C.on(k,T);else if(typeof C.addEventListener=="function")C.addEventListener(k,function O(P){L.once&&C.removeEventListener(k,O),T(P)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof C)}return G2.exports}var vT=Nve();const JX=Dl(vT);var QX=(function(t){return t.NewListener="newListener",t.RemoveListener="removeListener",t.Error="error",t})({});class Gn extends vT.EventEmitter{addListener(e,n){return super.addListener(e,n)}emit(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return super.emit(e,...r)}emitPromised(e){var n=arguments,r=this;return B(function*(){for(var i=n.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=n[o];var a=r.listeners(e);return Promise.allSettled(a.map(c=>c(...s))).then(()=>a.length>0)})()}listenerCount(e){return super.listenerCount(e)}listeners(e){return super.listeners(e)}off(e,n){return super.off(e,n)}on(e,n){return super.on(e,n)}once(e,n){return super.once(e,n)}prependListener(e,n){return super.prependListener(e,n)}prependOnceListener(e,n){return super.prependOnceListener(e,n)}removeAllListeners(e){return e===void 0?super.removeAllListeners():super.removeAllListeners(e)}removeListener(e,n){return super.removeListener(e,n)}rawListeners(e){return super.rawListeners(e)}}var ee=(function(t){return t.RoomCanonicalAlias="m.room.canonical_alias",t.RoomCreate="m.room.create",t.RoomJoinRules="m.room.join_rules",t.RoomMember="m.room.member",t.RoomThirdPartyInvite="m.room.third_party_invite",t.RoomPowerLevels="m.room.power_levels",t.RoomName="m.room.name",t.RoomTopic="m.room.topic",t.RoomAvatar="m.room.avatar",t.RoomPinnedEvents="m.room.pinned_events",t.RoomEncryption="m.room.encryption",t.RoomHistoryVisibility="m.room.history_visibility",t.RoomGuestAccess="m.room.guest_access",t.RoomServerAcl="m.room.server_acl",t.RoomTombstone="m.room.tombstone",t.RoomPredecessor="org.matrix.msc3946.room_predecessor",t.PolicyRuleUser="m.policy.rule.user",t.PolicyRuleRoom="m.policy.rule.room",t.PolicyRuleServer="m.policy.rule.server",t.SpaceChild="m.space.child",t.SpaceParent="m.space.parent",t.RoomRedaction="m.room.redaction",t.RoomMessage="m.room.message",t.RoomMessageEncrypted="m.room.encrypted",t.Sticker="m.sticker",t.CallInvite="m.call.invite",t.CallCandidates="m.call.candidates",t.CallAnswer="m.call.answer",t.CallHangup="m.call.hangup",t.CallReject="m.call.reject",t.CallSelectAnswer="m.call.select_answer",t.CallNegotiate="m.call.negotiate",t.CallSDPStreamMetadataChanged="m.call.sdp_stream_metadata_changed",t.CallSDPStreamMetadataChangedPrefix="org.matrix.call.sdp_stream_metadata_changed",t.CallReplaces="m.call.replaces",t.CallAssertedIdentity="m.call.asserted_identity",t.CallAssertedIdentityPrefix="org.matrix.call.asserted_identity",t.CallEncryptionKeysPrefix="io.element.call.encryption_keys",t.KeyVerificationRequest="m.key.verification.request",t.KeyVerificationStart="m.key.verification.start",t.KeyVerificationCancel="m.key.verification.cancel",t.KeyVerificationMac="m.key.verification.mac",t.KeyVerificationDone="m.key.verification.done",t.KeyVerificationKey="m.key.verification.key",t.KeyVerificationAccept="m.key.verification.accept",t.KeyVerificationReady="m.key.verification.ready",t.RoomMessageFeedback="m.room.message.feedback",t.Reaction="m.reaction",t.PollStart="org.matrix.msc3381.poll.start",t.Typing="m.typing",t.Receipt="m.receipt",t.Presence="m.presence",t.FullyRead="m.fully_read",t.Tag="m.tag",t.SpaceOrder="org.matrix.msc3230.space_order",t.PushRules="m.push_rules",t.Direct="m.direct",t.IgnoredUserList="m.ignored_user_list",t.InvitePermissionConfig="m.invite_permission_config",t.RoomKey="m.room_key",t.RoomKeyRequest="m.room_key_request",t.ForwardedRoomKey="m.forwarded_room_key",t.Dummy="m.dummy",t.SecretRequest="m.secret.request",t.SecretSend="m.secret.send",t.GroupCallPrefix="org.matrix.msc3401.call",t.GroupCallMemberPrefix="org.matrix.msc3401.call.member",t.RTCMembership="org.matrix.msc4143.rtc.member",t.CallNotify="org.matrix.msc4075.call.notify",t.RTCNotification="org.matrix.msc4075.rtc.notification",t.RTCDecline="org.matrix.msc4310.rtc.decline",t.RoomPolicy="org.matrix.msc4284.policy",t})({}),vn=(function(t){return t.Annotation="m.annotation",t.Replace="m.replace",t.Reference="m.reference",t.Thread="m.thread",t})({}),Nl=(function(t){return t.Text="m.text",t.Emote="m.emote",t.Notice="m.notice",t.Image="m.image",t.File="m.file",t.Audio="m.audio",t.Location="m.location",t.Video="m.video",t.KeyVerificationRequest="m.key.verification.request",t})({}),EC="type",Yg=(function(t){return t.Space="m.space",t.UnstableCall="org.matrix.msc3417.call",t.ElementVideo="io.element.video",t})({}),yT="org.matrix.msgid",fA=new Kr("m.room.purpose","org.matrix.msc3088.purpose"),hA=new Kr("m.enabled","org.matrix.msc3088.enabled"),pA=new Kr("m.data_tree","org.matrix.msc3089.data_tree"),ZX=new Kr("m.leaf","org.matrix.msc3089.leaf"),xu=new Kr("m.branch","org.matrix.msc3089.branch"),eJ=new Kr("m.room.marker","org.matrix.msc2716.marker"),mA=new Kr("with_rel_types","org.matrix.msc3912.with_relations"),tJ=new Kr("io.element.functional_members","io.element.functional_members"),dp=new Kr("m.visibility","org.matrix.msc3531.visibility"),gA=new Kr("enabled","org.matrix.msc3881.enabled"),Uve=new Kr("device_id","org.matrix.msc3881.device_id"),nJ=new Kr("m.local_notification_settings","org.matrix.msc3890.local_notification_settings"),CC=new Kr("thread_id","org.matrix.msc4023.thread_id"),rJ=new uy("membership","io.element.msc4115.membership"),Ke=(function(t){return t.Ban="ban",t.Invite="invite",t.Join="join",t.Knock="knock",t.Leave="leave",t})({}),ao=(function(t){return t.Membership="RoomMember.membership",t.Name="RoomMember.name",t.PowerLevel="RoomMember.powerLevel",t.Typing="RoomMember.typing",t})({});class Tb extends Gn{constructor(e,n){super(),this.roomId=e,this.userId=n,M(this,"_isOutOfBand",!1),M(this,"modified",-1),M(this,"requestedProfileInfo",!1),M(this,"typing",!1),M(this,"name",void 0),M(this,"rawDisplayName",void 0),M(this,"powerLevel",0),M(this,"user",void 0),M(this,"membership",void 0),M(this,"disambiguate",!1),M(this,"events",{}),this.name=n,this.rawDisplayName=n,this.updateModifiedTime()}markOutOfBand(){this._isOutOfBand=!0}isOutOfBand(){return this._isOutOfBand}setMembershipEvent(e,n){var r,i,s=(r=e.getDirectionalContent().displayname)!==null&&r!==void 0?r:"";if(e.getType()===ee.RoomMember){this._isOutOfBand=!1,this.events.member=e;var o=this.membership;this.membership=e.getDirectionalContent().membership,this.membership===void 0&&N.trace("membership event with membership undefined (forwardLooking: ".concat(e.forwardLooking,")!"),e.getContent(),"prevcontent is ",e.getPrevContent()),this.disambiguate=Fve(this.userId,s,n);var a=this.name;this.name=$ve(this.userId,s,this.disambiguate),this.rawDisplayName=_C((i=e.getDirectionalContent().displayname)!==null&&i!==void 0?i:""),(!this.rawDisplayName||!kf(this.rawDisplayName))&&(this.rawDisplayName=this.userId),o!==this.membership&&(this.updateModifiedTime(),this.emit(ao.Membership,e,this,o)),a!==this.name&&(this.updateModifiedTime(),this.emit(ao.Name,e,this,a))}}setPowerLevel(e,n){var r=this.powerLevel;this.powerLevel=e,r!==this.powerLevel&&(this.updateModifiedTime(),this.emit(ao.PowerLevel,n,this))}setTypingEvent(e){if(e.getType()==="m.typing"){var n=this.typing;this.typing=!1;var r=e.getContent().user_ids;Array.isArray(r)&&(r.indexOf(this.userId)!==-1&&(this.typing=!0),n!==this.typing&&(this.updateModifiedTime(),this.emit(ao.Typing,e,this)))}}updateModifiedTime(){this.modified=Date.now()}getLastModifiedTime(){return this.modified}isKicked(){return this.membership===Ke.Leave&&this.events.member!==void 0&&this.events.member.getSender()!==this.events.member.getStateKey()}getDMInviter(){if(this.events.member){var e=this.events.member,n=e.getContent(),r=e.getSender();if(n.membership===Ke.Join&&(n=e.getPrevContent(),r=e.getUnsigned().prev_sender),n.membership===Ke.Invite&&n.is_direct)return r}}getAvatarUrl(e,n,r,i){var s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,o=arguments.length>5?arguments[5]:void 0,a=arguments.length>6&&arguments[6]!==void 0?arguments[6]:!1,c=this.getMxcAvatarUrl();if(!c&&!s)return null;var l=gT(e,c,n,r,i,o,void 0,a);return l||null}getMxcAvatarUrl(){if(this.events.member)return this.events.member.getDirectionalContent().avatar_url;if(this.user)return this.user.avatarUrl}}var KO=/@.+:.+/,jve=/[\u200E\u200F\u202A-\u202F]/;function Fve(t,e,n){if(!e||e===t||!n)return!1;var r=kf(e);if(!r)return!1;if(KO.test(r)||jve.test(e))return!0;var i=n.getUserIdsWithDisplayName(e);return!!i.some(s=>s!==t)}function $ve(t,e,n){return!e||e===t?t:n?_C(e)+" ("+t+")":kf(e)?_C(e):t}var KI={},P0={},D0={},v$;function iJ(){if(v$)return D0;v$=1,Object.defineProperty(D0,"__esModule",{value:!0}),D0.NamespacedMap=void 0;function t(c,l){var d=typeof Symbol<"u"&&c[Symbol.iterator]||c["@@iterator"];if(!d){if(Array.isArray(c)||(d=e(c))||l){d&&(c=d);var h=0,m=function(){};return{s:m,n:function(){return h>=c.length?{done:!0}:{done:!1,value:c[h++]}},e:function(w){throw w},f:m}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var g=!0,y=!1,v;return{s:function(){d=d.call(c)},n:function(){var w=d.next();return g=w.done,w},e:function(w){y=!0,v=w},f:function(){try{!g&&d.return!=null&&d.return()}finally{if(y)throw v}}}}function e(c,l){if(c){if(typeof c=="string")return n(c,l);var d=Object.prototype.toString.call(c).slice(8,-1);if(d==="Object"&&c.constructor&&(d=c.constructor.name),d==="Map"||d==="Set")return Array.from(c);if(d==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(d))return n(c,l)}}function n(c,l){(l==null||l>c.length)&&(l=c.length);for(var d=0,h=new Array(l);d<l;d++)h[d]=c[d];return h}function r(c,l){if(!(c instanceof l))throw new TypeError("Cannot call a class as a function")}function i(c,l){for(var d=0;d<l.length;d++){var h=l[d];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(c,h.key,h)}}function s(c,l,d){return l&&i(c.prototype,l),Object.defineProperty(c,"prototype",{writable:!1}),c}function o(c,l,d){return l in c?Object.defineProperty(c,l,{value:d,enumerable:!0,configurable:!0,writable:!0}):c[l]=d,c}var a=(function(){function c(l){if(r(this,c),o(this,"internalMap",new Map),l){var d=t(l),h;try{for(d.s();!(h=d.n()).done;){var m=h.value;this.set(m[0],m[1])}}catch(g){d.e(g)}finally{d.f()}}}return s(c,[{key:"get",value:function(d){return d.name&&this.internalMap.has(d.name)?this.internalMap.get(d.name):d.altName&&this.internalMap.has(d.altName)?this.internalMap.get(d.altName):null}},{key:"set",value:function(d,h){d.name&&this.internalMap.set(d.name,h),d.altName&&this.internalMap.set(d.altName,h)}},{key:"has",value:function(d){return!!this.get(d)}},{key:"delete",value:function(d){d.name&&this.internalMap.delete(d.name),d.altName&&this.internalMap.delete(d.altName)}},{key:"hasNamespaced",value:function(d){return this.internalMap.has(d)}},{key:"getNamespaced",value:function(d){return this.internalMap.get(d)}}]),c})();return D0.NamespacedMap=a,D0}var N0={},y$;function dy(){if(y$)return N0;y$=1;function t(y){"@babel/helpers - typeof";return t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(v){return typeof v}:function(v){return v&&typeof Symbol=="function"&&v.constructor===Symbol&&v!==Symbol.prototype?"symbol":typeof v},t(y)}Object.defineProperty(N0,"__esModule",{value:!0}),N0.InvalidEventError=void 0;function e(y,v,E){return Object.defineProperty(y,"prototype",{writable:!1}),y}function n(y,v){if(!(y instanceof v))throw new TypeError("Cannot call a class as a function")}function r(y,v){if(typeof v!="function"&&v!==null)throw new TypeError("Super expression must either be null or a function");y.prototype=Object.create(v&&v.prototype,{constructor:{value:y,writable:!0,configurable:!0}}),Object.defineProperty(y,"prototype",{writable:!1}),v&&h(y,v)}function i(y){var v=l();return function(){var w=m(y),R;if(v){var x=m(this).constructor;R=Reflect.construct(w,arguments,x)}else R=w.apply(this,arguments);return s(this,R)}}function s(y,v){if(v&&(t(v)==="object"||typeof v=="function"))return v;if(v!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return o(y)}function o(y){if(y===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return y}function a(y){var v=typeof Map=="function"?new Map:void 0;return a=function(w){if(w===null||!d(w))return w;if(typeof w!="function")throw new TypeError("Super expression must either be null or a function");if(typeof v<"u"){if(v.has(w))return v.get(w);v.set(w,R)}function R(){return c(w,arguments,m(this).constructor)}return R.prototype=Object.create(w.prototype,{constructor:{value:R,enumerable:!1,writable:!0,configurable:!0}}),h(R,w)},a(y)}function c(y,v,E){return l()?c=Reflect.construct:c=function(R,x,C){var k=[null];k.push.apply(k,x);var T=Function.bind.apply(R,k),L=new T;return C&&h(L,C.prototype),L},c.apply(null,arguments)}function l(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function d(y){return Function.toString.call(y).indexOf("[native code]")!==-1}function h(y,v){return h=Object.setPrototypeOf||function(w,R){return w.__proto__=R,w},h(y,v)}function m(y){return m=Object.setPrototypeOf?Object.getPrototypeOf:function(E){return E.__proto__||Object.getPrototypeOf(E)},m(y)}var g=(function(y){r(E,y);var v=i(E);function E(w){return n(this,E),v.call(this,w)}return e(E)})(a(Error));return N0.InvalidEventError=g,N0}var sg={},U0={},j0={},b$;function D_(){if(b$)return j0;b$=1,Object.defineProperty(j0,"__esModule",{value:!0}),j0.ExtensibleEvent=void 0;function t(i,s){if(!(i instanceof s))throw new TypeError("Cannot call a class as a function")}function e(i,s){for(var o=0;o<s.length;o++){var a=s[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(i,a.key,a)}}function n(i,s,o){return s&&e(i.prototype,s),Object.defineProperty(i,"prototype",{writable:!1}),i}var r=(function(){function i(s){t(this,i),this.wireFormat=s}return n(i,[{key:"wireContent",get:function(){return this.wireFormat.content}}]),i})();return j0.ExtensibleEvent=r,j0}var F0={},_$;function sJ(){if(_$)return F0;_$=1,Object.defineProperty(F0,"__esModule",{value:!0}),F0.isOptionalAString=t,F0.isProvided=e;function t(n){return e(n)&&typeof n=="string"}function e(n){return n!=null}return F0}var No={},$h={},S$;function fy(){if(S$)return $h;S$=1;function t(g){"@babel/helpers - typeof";return t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(y){return typeof y}:function(y){return y&&typeof Symbol=="function"&&y.constructor===Symbol&&y!==Symbol.prototype?"symbol":typeof y},t(g)}Object.defineProperty($h,"__esModule",{value:!0}),$h.UnstableValue=$h.NamespacedValue=void 0;function e(g,y){if(typeof y!="function"&&y!==null)throw new TypeError("Super expression must either be null or a function");g.prototype=Object.create(y&&y.prototype,{constructor:{value:g,writable:!0,configurable:!0}}),Object.defineProperty(g,"prototype",{writable:!1}),y&&n(g,y)}function n(g,y){return n=Object.setPrototypeOf||function(E,w){return E.__proto__=w,E},n(g,y)}function r(g){var y=o();return function(){var E=a(g),w;if(y){var R=a(this).constructor;w=Reflect.construct(E,arguments,R)}else w=E.apply(this,arguments);return i(this,w)}}function i(g,y){if(y&&(t(y)==="object"||typeof y=="function"))return y;if(y!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return s(g)}function s(g){if(g===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return g}function o(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function a(g){return a=Object.setPrototypeOf?Object.getPrototypeOf:function(v){return v.__proto__||Object.getPrototypeOf(v)},a(g)}function c(g,y){if(!(g instanceof y))throw new TypeError("Cannot call a class as a function")}function l(g,y){for(var v=0;v<y.length;v++){var E=y[v];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(g,E.key,E)}}function d(g,y,v){return y&&l(g.prototype,y),Object.defineProperty(g,"prototype",{writable:!1}),g}var h=(function(){function g(y,v){if(c(this,g),this.stable=y,this.unstable=v,!this.unstable&&!this.stable)throw new Error("One of stable or unstable values must be supplied")}return d(g,[{key:"name",get:function(){return this.stable?this.stable:this.unstable}},{key:"altName",get:function(){return this.stable?this.unstable:null}},{key:"matches",value:function(v){return!!this.name&&this.name===v||!!this.altName&&this.altName===v}},{key:"findIn",value:function(v){var E;return this.name&&(E=v?.[this.name]),!E&&this.altName&&(E=v?.[this.altName]),E}},{key:"includedIn",value:function(v){var E=!1;return this.name&&(E=v.includes(this.name)),!E&&this.altName&&(E=v.includes(this.altName)),E}}]),g})();$h.NamespacedValue=h;var m=(function(g){e(v,g);var y=r(v);function v(E,w){var R;if(c(this,v),R=y.call(this,E,w),!R.unstable)throw new Error("Unstable value must be supplied");return R}return d(v,[{key:"name",get:function(){return this.unstable}},{key:"altName",get:function(){return this.stable}}]),v})(h);return $h.UnstableValue=m,$h}var w$;function Ul(){if(w$)return No;w$=1,Object.defineProperty(No,"__esModule",{value:!0}),No.M_TEXT=No.M_NOTICE=No.M_MESSAGE=No.M_HTML=No.M_EMOTE=void 0;var t=fy(),e=new t.UnstableValue("m.message","org.matrix.msc1767.message");No.M_MESSAGE=e;var n=new t.UnstableValue("m.text","org.matrix.msc1767.text");No.M_TEXT=n;var r=new t.UnstableValue("m.html","org.matrix.msc1767.html");No.M_HTML=r;var i=new t.UnstableValue("m.emote","org.matrix.msc1767.emote");No.M_EMOTE=i;var s=new t.UnstableValue("m.notice","org.matrix.msc1767.notice");return No.M_NOTICE=s,No}var z2={},E$;function Xp(){if(E$)return z2;E$=1,Object.defineProperty(z2,"__esModule",{value:!0}),z2.isEventTypeSame=t;function t(e,n){if(typeof e=="string")return typeof n=="string"?n===e:n.matches(e);if(typeof n=="string")return e.matches(n);var r=n,i=e;return r.matches(i.name)||r.matches(i.altName)}return z2}var C$;function Jp(){if(C$)return U0;C$=1;function t(C){"@babel/helpers - typeof";return t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(k){return typeof k}:function(k){return k&&typeof Symbol=="function"&&k.constructor===Symbol&&k!==Symbol.prototype?"symbol":typeof k},t(C)}Object.defineProperty(U0,"__esModule",{value:!0}),U0.MessageEvent=void 0;var e=D_(),n=sJ(),r=dy(),i=Ul(),s=Xp();function o(C,k){var T=Object.keys(C);if(Object.getOwnPropertySymbols){var L=Object.getOwnPropertySymbols(C);k&&(L=L.filter(function(O){return Object.getOwnPropertyDescriptor(C,O).enumerable})),T.push.apply(T,L)}return T}function a(C){for(var k=1;k<arguments.length;k++){var T=arguments[k]!=null?arguments[k]:{};k%2?o(Object(T),!0).forEach(function(L){R(C,L,T[L])}):Object.getOwnPropertyDescriptors?Object.defineProperties(C,Object.getOwnPropertyDescriptors(T)):o(Object(T)).forEach(function(L){Object.defineProperty(C,L,Object.getOwnPropertyDescriptor(T,L))})}return C}function c(C,k){if(!(C instanceof k))throw new TypeError("Cannot call a class as a function")}function l(C,k){for(var T=0;T<k.length;T++){var L=k[T];L.enumerable=L.enumerable||!1,L.configurable=!0,"value"in L&&(L.writable=!0),Object.defineProperty(C,L.key,L)}}function d(C,k,T){return k&&l(C.prototype,k),T&&l(C,T),Object.defineProperty(C,"prototype",{writable:!1}),C}function h(C,k){if(typeof k!="function"&&k!==null)throw new TypeError("Super expression must either be null or a function");C.prototype=Object.create(k&&k.prototype,{constructor:{value:C,writable:!0,configurable:!0}}),Object.defineProperty(C,"prototype",{writable:!1}),k&&m(C,k)}function m(C,k){return m=Object.setPrototypeOf||function(L,O){return L.__proto__=O,L},m(C,k)}function g(C){var k=E();return function(){var L=w(C),O;if(k){var P=w(this).constructor;O=Reflect.construct(L,arguments,P)}else O=L.apply(this,arguments);return y(this,O)}}function y(C,k){if(k&&(t(k)==="object"||typeof k=="function"))return k;if(k!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return v(C)}function v(C){if(C===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return C}function E(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function w(C){return w=Object.setPrototypeOf?Object.getPrototypeOf:function(T){return T.__proto__||Object.getPrototypeOf(T)},w(C)}function R(C,k,T){return k in C?Object.defineProperty(C,k,{value:T,enumerable:!0,configurable:!0,writable:!0}):C[k]=T,C}var x=(function(C){h(T,C);var k=g(T);function T(L){var O;c(this,T),O=k.call(this,L),R(v(O),"text",void 0),R(v(O),"html",void 0),R(v(O),"renderings",void 0);var P=i.M_MESSAGE.findIn(O.wireContent),D=i.M_TEXT.findIn(O.wireContent),j=i.M_HTML.findIn(O.wireContent);if((0,n.isProvided)(P)){if(!Array.isArray(P))throw new r.InvalidEventError("m.message contents must be an array");var H=P.find(function(Y){return!(0,n.isProvided)(Y.mimetype)||Y.mimetype==="text/plain"}),z=P.find(function(Y){return Y.mimetype==="text/html"});if(!H)throw new r.InvalidEventError("m.message is missing a plain text representation");O.text=H.body,O.html=z?.body,O.renderings=P}else if((0,n.isOptionalAString)(D))O.text=D,O.html=j,O.renderings=[{body:D,mimetype:"text/plain"}],O.html&&O.renderings.push({body:O.html,mimetype:"text/html"});else throw new r.InvalidEventError("Missing textual representation for event");return O}return d(T,[{key:"isEmote",get:function(){return i.M_EMOTE.matches(this.wireFormat.type)||(0,n.isProvided)(i.M_EMOTE.findIn(this.wireFormat.content))}},{key:"isNotice",get:function(){return i.M_NOTICE.matches(this.wireFormat.type)||(0,n.isProvided)(i.M_NOTICE.findIn(this.wireFormat.content))}},{key:"isEquivalentTo",value:function(O){return(0,s.isEventTypeSame)(O,i.M_MESSAGE)}},{key:"serializeMMessageOnly",value:function(){var O=R({},i.M_MESSAGE.name,this.renderings);if(this.renderings.length===1){var P=this.renderings[0].mimetype;(P===void 0||P==="text/plain")&&(O=R({},i.M_TEXT.name,this.renderings[0].body))}return O}},{key:"serialize",value:function(){var O;return{type:"m.room.message",content:a(a({},this.serializeMMessageOnly()),{},{body:this.text,msgtype:"m.text",format:this.html?"org.matrix.custom.html":void 0,formatted_body:(O=this.html)!==null&&O!==void 0?O:void 0})}}}],[{key:"from",value:function(O,P){var D;return new T({type:i.M_MESSAGE.name,content:(D={},R(D,i.M_TEXT.name,O),R(D,i.M_HTML.name,P),D)})}}]),T})(e.ExtensibleEvent);return U0.MessageEvent=x,U0}var $0={},T$;function GO(){if(T$)return $0;T$=1;function t(R){"@babel/helpers - typeof";return t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(x){return typeof x}:function(x){return x&&typeof Symbol=="function"&&x.constructor===Symbol&&x!==Symbol.prototype?"symbol":typeof x},t(R)}Object.defineProperty($0,"__esModule",{value:!0}),$0.NoticeEvent=void 0;var e=Jp(),n=Ul(),r=Xp();function i(R,x,C){return x in R?Object.defineProperty(R,x,{value:C,enumerable:!0,configurable:!0,writable:!0}):R[x]=C,R}function s(R,x){if(!(R instanceof x))throw new TypeError("Cannot call a class as a function")}function o(R,x){for(var C=0;C<x.length;C++){var k=x[C];k.enumerable=k.enumerable||!1,k.configurable=!0,"value"in k&&(k.writable=!0),Object.defineProperty(R,k.key,k)}}function a(R,x,C){return x&&o(R.prototype,x),C&&o(R,C),Object.defineProperty(R,"prototype",{writable:!1}),R}function c(){return typeof Reflect<"u"&&Reflect.get?c=Reflect.get:c=function(x,C,k){var T=l(x,C);if(T){var L=Object.getOwnPropertyDescriptor(T,C);return L.get?L.get.call(arguments.length<3?x:k):L.value}},c.apply(this,arguments)}function l(R,x){for(;!Object.prototype.hasOwnProperty.call(R,x)&&(R=E(R),R!==null););return R}function d(R,x){if(typeof x!="function"&&x!==null)throw new TypeError("Super expression must either be null or a function");R.prototype=Object.create(x&&x.prototype,{constructor:{value:R,writable:!0,configurable:!0}}),Object.defineProperty(R,"prototype",{writable:!1}),x&&h(R,x)}function h(R,x){return h=Object.setPrototypeOf||function(k,T){return k.__proto__=T,k},h(R,x)}function m(R){var x=v();return function(){var k=E(R),T;if(x){var L=E(this).constructor;T=Reflect.construct(k,arguments,L)}else T=k.apply(this,arguments);return g(this,T)}}function g(R,x){if(x&&(t(x)==="object"||typeof x=="function"))return x;if(x!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return y(R)}function y(R){if(R===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return R}function v(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function E(R){return E=Object.setPrototypeOf?Object.getPrototypeOf:function(C){return C.__proto__||Object.getPrototypeOf(C)},E(R)}var w=(function(R){d(C,R);var x=m(C);function C(k){return s(this,C),x.call(this,k)}return a(C,[{key:"isNotice",get:function(){return!0}},{key:"isEquivalentTo",value:function(T){return(0,r.isEventTypeSame)(T,n.M_NOTICE)||c(E(C.prototype),"isEquivalentTo",this).call(this,T)}},{key:"serialize",value:function(){var T=c(E(C.prototype),"serialize",this).call(this);return T.content.msgtype="m.notice",T}}],[{key:"from",value:function(T,L){var O;return new C({type:n.M_NOTICE.name,content:(O={},i(O,n.M_TEXT.name,T),i(O,n.M_HTML.name,L),O)})}}]),C})(e.MessageEvent);return $0.NoticeEvent=w,$0}var B0={},R$;function zO(){if(R$)return B0;R$=1;function t(R){"@babel/helpers - typeof";return t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(x){return typeof x}:function(x){return x&&typeof Symbol=="function"&&x.constructor===Symbol&&x!==Symbol.prototype?"symbol":typeof x},t(R)}Object.defineProperty(B0,"__esModule",{value:!0}),B0.EmoteEvent=void 0;var e=Jp(),n=Ul(),r=Xp();function i(R,x,C){return x in R?Object.defineProperty(R,x,{value:C,enumerable:!0,configurable:!0,writable:!0}):R[x]=C,R}function s(R,x){if(!(R instanceof x))throw new TypeError("Cannot call a class as a function")}function o(R,x){for(var C=0;C<x.length;C++){var k=x[C];k.enumerable=k.enumerable||!1,k.configurable=!0,"value"in k&&(k.writable=!0),Object.defineProperty(R,k.key,k)}}function a(R,x,C){return x&&o(R.prototype,x),C&&o(R,C),Object.defineProperty(R,"prototype",{writable:!1}),R}function c(){return typeof Reflect<"u"&&Reflect.get?c=Reflect.get:c=function(x,C,k){var T=l(x,C);if(T){var L=Object.getOwnPropertyDescriptor(T,C);return L.get?L.get.call(arguments.length<3?x:k):L.value}},c.apply(this,arguments)}function l(R,x){for(;!Object.prototype.hasOwnProperty.call(R,x)&&(R=E(R),R!==null););return R}function d(R,x){if(typeof x!="function"&&x!==null)throw new TypeError("Super expression must either be null or a function");R.prototype=Object.create(x&&x.prototype,{constructor:{value:R,writable:!0,configurable:!0}}),Object.defineProperty(R,"prototype",{writable:!1}),x&&h(R,x)}function h(R,x){return h=Object.setPrototypeOf||function(k,T){return k.__proto__=T,k},h(R,x)}function m(R){var x=v();return function(){var k=E(R),T;if(x){var L=E(this).constructor;T=Reflect.construct(k,arguments,L)}else T=k.apply(this,arguments);return g(this,T)}}function g(R,x){if(x&&(t(x)==="object"||typeof x=="function"))return x;if(x!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return y(R)}function y(R){if(R===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return R}function v(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function E(R){return E=Object.setPrototypeOf?Object.getPrototypeOf:function(C){return C.__proto__||Object.getPrototypeOf(C)},E(R)}var w=(function(R){d(C,R);var x=m(C);function C(k){return s(this,C),x.call(this,k)}return a(C,[{key:"isEmote",get:function(){return!0}},{key:"isEquivalentTo",value:function(T){return(0,r.isEventTypeSame)(T,n.M_EMOTE)||c(E(C.prototype),"isEquivalentTo",this).call(this,T)}},{key:"serialize",value:function(){var T=c(E(C.prototype),"serialize",this).call(this);return T.content.msgtype="m.emote",T}}],[{key:"from",value:function(T,L){var O;return new C({type:n.M_EMOTE.name,content:(O={},i(O,n.M_TEXT.name,T),i(O,n.M_HTML.name,L),O)})}}]),C})(e.MessageEvent);return B0.EmoteEvent=w,B0}var k$;function oJ(){if(k$)return sg;k$=1,Object.defineProperty(sg,"__esModule",{value:!0}),sg.LEGACY_M_ROOM_MESSAGE=void 0,sg.parseMRoomMessage=l;var t=Jp(),e=GO(),n=zO(),r=fy(),i=Ul();function s(d,h){var m=Object.keys(d);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(d);h&&(g=g.filter(function(y){return Object.getOwnPropertyDescriptor(d,y).enumerable})),m.push.apply(m,g)}return m}function o(d){for(var h=1;h<arguments.length;h++){var m=arguments[h]!=null?arguments[h]:{};h%2?s(Object(m),!0).forEach(function(g){a(d,g,m[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(d,Object.getOwnPropertyDescriptors(m)):s(Object(m)).forEach(function(g){Object.defineProperty(d,g,Object.getOwnPropertyDescriptor(m,g))})}return d}function a(d,h,m){return h in d?Object.defineProperty(d,h,{value:m,enumerable:!0,configurable:!0,writable:!0}):d[h]=m,d}var c=new r.NamespacedValue("m.room.message");sg.LEGACY_M_ROOM_MESSAGE=c;function l(d){var h,m,g;if(i.M_MESSAGE.findIn(d.content)||i.M_TEXT.findIn(d.content))return new t.MessageEvent(d);var y=(h=d.content)===null||h===void 0?void 0:h.msgtype,v=(m=d.content)===null||m===void 0?void 0:m.body,E=((g=d.content)===null||g===void 0?void 0:g.format)==="org.matrix.custom.html"?d.content.formatted_body:null;if(y==="m.text"){var w;return new t.MessageEvent(o(o({},d),{},{content:o(o({},d.content),{},(w={},a(w,i.M_TEXT.name,v),a(w,i.M_HTML.name,E),w))}))}else if(y==="m.notice"){var R;return new e.NoticeEvent(o(o({},d),{},{content:o(o({},d.content),{},(R={},a(R,i.M_TEXT.name,v),a(R,i.M_HTML.name,E),R))}))}else if(y==="m.emote"){var x;return new n.EmoteEvent(o(o({},d),{},{content:o(o({},d.content),{},(x={},a(x,i.M_TEXT.name,v),a(x,i.M_HTML.name,E),x))}))}else return null}return sg}var W2={},I$;function aJ(){if(I$)return W2;I$=1,Object.defineProperty(W2,"__esModule",{value:!0}),W2.parseMMessage=i;var t=Jp(),e=Ul(),n=zO(),r=GO();function i(s){return e.M_EMOTE.matches(s.type)?new n.EmoteEvent(s):e.M_NOTICE.matches(s.type)?new r.NoticeEvent(s):new t.MessageEvent(s)}return W2}var Uo={},x$;function hy(){if(x$)return Uo;x$=1,Object.defineProperty(Uo,"__esModule",{value:!0}),Uo.M_POLL_START=Uo.M_POLL_RESPONSE=Uo.M_POLL_KIND_UNDISCLOSED=Uo.M_POLL_KIND_DISCLOSED=Uo.M_POLL_END=void 0;var t=fy(),e=new t.UnstableValue("m.poll.disclosed","org.matrix.msc3381.poll.disclosed");Uo.M_POLL_KIND_DISCLOSED=e;var n=new t.UnstableValue("m.poll.undisclosed","org.matrix.msc3381.poll.undisclosed");Uo.M_POLL_KIND_UNDISCLOSED=n;var r=new t.UnstableValue("m.poll.start","org.matrix.msc3381.poll.start");Uo.M_POLL_START=r;var i=new t.UnstableValue("m.poll.response","org.matrix.msc3381.poll.response");Uo.M_POLL_RESPONSE=i;var s=new t.UnstableValue("m.poll.end","org.matrix.msc3381.poll.end");return Uo.M_POLL_END=s,Uo}var Y2={},Bh={},A$;function cJ(){if(A$)return Bh;A$=1;function t(W){"@babel/helpers - typeof";return t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(F){return typeof F}:function(F){return F&&typeof Symbol=="function"&&F.constructor===Symbol&&F!==Symbol.prototype?"symbol":typeof F},t(W)}Object.defineProperty(Bh,"__esModule",{value:!0}),Bh.PollStartEvent=Bh.PollAnswerSubevent=void 0;var e=hy(),n=Jp(),r=Ul(),i=dy(),s=fy(),o=Xp(),a=D_();function c(W){return m(W)||h(W)||d(W)||l()}function l(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function d(W,F){if(W){if(typeof W=="string")return g(W,F);var $=Object.prototype.toString.call(W).slice(8,-1);if($==="Object"&&W.constructor&&($=W.constructor.name),$==="Map"||$==="Set")return Array.from(W);if($==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test($))return g(W,F)}}function h(W){if(typeof Symbol<"u"&&W[Symbol.iterator]!=null||W["@@iterator"]!=null)return Array.from(W)}function m(W){if(Array.isArray(W))return g(W)}function g(W,F){(F==null||F>W.length)&&(F=W.length);for(var $=0,V=new Array(F);$<F;$++)V[$]=W[$];return V}function y(W,F){var $=Object.keys(W);if(Object.getOwnPropertySymbols){var V=Object.getOwnPropertySymbols(W);F&&(V=V.filter(function(G){return Object.getOwnPropertyDescriptor(W,G).enumerable})),$.push.apply($,V)}return $}function v(W){for(var F=1;F<arguments.length;F++){var $=arguments[F]!=null?arguments[F]:{};F%2?y(Object($),!0).forEach(function(V){D(W,V,$[V])}):Object.getOwnPropertyDescriptors?Object.defineProperties(W,Object.getOwnPropertyDescriptors($)):y(Object($)).forEach(function(V){Object.defineProperty(W,V,Object.getOwnPropertyDescriptor($,V))})}return W}function E(W,F){if(!(W instanceof F))throw new TypeError("Cannot call a class as a function")}function w(W,F){for(var $=0;$<F.length;$++){var V=F[$];V.enumerable=V.enumerable||!1,V.configurable=!0,"value"in V&&(V.writable=!0),Object.defineProperty(W,V.key,V)}}function R(W,F,$){return F&&w(W.prototype,F),$&&w(W,$),Object.defineProperty(W,"prototype",{writable:!1}),W}function x(W,F){if(typeof F!="function"&&F!==null)throw new TypeError("Super expression must either be null or a function");W.prototype=Object.create(F&&F.prototype,{constructor:{value:W,writable:!0,configurable:!0}}),Object.defineProperty(W,"prototype",{writable:!1}),F&&C(W,F)}function C(W,F){return C=Object.setPrototypeOf||function(V,G){return V.__proto__=G,V},C(W,F)}function k(W){var F=O();return function(){var V=P(W),G;if(F){var Z=P(this).constructor;G=Reflect.construct(V,arguments,Z)}else G=V.apply(this,arguments);return T(this,G)}}function T(W,F){if(F&&(t(F)==="object"||typeof F=="function"))return F;if(F!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return L(W)}function L(W){if(W===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return W}function O(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function P(W){return P=Object.setPrototypeOf?Object.getPrototypeOf:function($){return $.__proto__||Object.getPrototypeOf($)},P(W)}function D(W,F,$){return F in W?Object.defineProperty(W,F,{value:$,enumerable:!0,configurable:!0,writable:!0}):W[F]=$,W}var j=(function(W){x($,W);var F=k($);function $(V){var G;E(this,$),G=F.call(this,V),D(L(G),"id",void 0);var Z=V.content.id;if(!Z||typeof Z!="string")throw new i.InvalidEventError("Answer ID must be a non-empty string");return G.id=Z,G}return R($,[{key:"serialize",value:function(){return{type:"org.matrix.sdk.poll.answer",content:v({id:this.id},this.serializeMMessageOnly())}}}],[{key:"from",value:function(G,Z){return new $({type:"org.matrix.sdk.poll.answer",content:D({id:G},r.M_TEXT.name,Z)})}}]),$})(n.MessageEvent);Bh.PollAnswerSubevent=j;var H=(function(W){x($,W);var F=k($);function $(V){var G;E(this,$),G=F.call(this,V),D(L(G),"question",void 0),D(L(G),"kind",void 0),D(L(G),"rawKind",void 0),D(L(G),"maxSelections",void 0),D(L(G),"answers",void 0);var Z=e.M_POLL_START.findIn(G.wireContent);if(!Z.question)throw new i.InvalidEventError("A question is required");if(G.question=new n.MessageEvent({type:"org.matrix.sdk.poll.question",content:Z.question}),G.rawKind=Z.kind,e.M_POLL_KIND_DISCLOSED.matches(G.rawKind)?G.kind=e.M_POLL_KIND_DISCLOSED:G.kind=e.M_POLL_KIND_UNDISCLOSED,G.maxSelections=Number.isFinite(Z.max_selections)&&Z.max_selections>0?Z.max_selections:1,!Array.isArray(Z.answers))throw new i.InvalidEventError("Poll answers must be an array");var q=Z.answers.slice(0,20).map(function(J){return new j({type:"org.matrix.sdk.poll.answer",content:J})});if(q.length<=0)throw new i.InvalidEventError("No answers available");return G.answers=q,G}return R($,[{key:"isEquivalentTo",value:function(G){return(0,o.isEventTypeSame)(G,e.M_POLL_START)}},{key:"serialize",value:function(){var G;return{type:e.M_POLL_START.name,content:(G={},D(G,e.M_POLL_START.name,{question:this.question.serialize().content,kind:this.rawKind,max_selections:this.maxSelections,answers:this.answers.map(function(Z){return Z.serialize().content})}),D(G,r.M_TEXT.name,"".concat(this.question.text,`
`).concat(this.answers.map(function(Z,q){return"".concat(q+1,". ").concat(Z.text)}).join(`
`))),G)}}}],[{key:"from",value:function(G,Z,q){var J,ue=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;return new $({type:e.M_POLL_START.name,content:(J={},D(J,r.M_TEXT.name,G),D(J,e.M_POLL_START.name,{question:D({},r.M_TEXT.name,G),kind:q instanceof s.NamespacedValue?q.name:q,max_selections:ue,answers:Z.map(function(ge){return D({id:Y()},r.M_TEXT.name,ge)})}),J)})}}]),$})(a.ExtensibleEvent);Bh.PollStartEvent=H;var z="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";function Y(){return c(Array(16)).map(function(){return z.charAt(Math.floor(Math.random()*z.length))}).join("")}return Bh}var H0={},q0={},L$;function WO(){if(L$)return q0;L$=1,Object.defineProperty(q0,"__esModule",{value:!0}),q0.REFERENCE_RELATION=void 0;var t=fy(),e=new t.NamespacedValue("m.reference");return q0.REFERENCE_RELATION=e,q0}var M$;function lJ(){if(M$)return H0;M$=1;function t(R){"@babel/helpers - typeof";return t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(x){return typeof x}:function(x){return x&&typeof Symbol=="function"&&x.constructor===Symbol&&x!==Symbol.prototype?"symbol":typeof x},t(R)}Object.defineProperty(H0,"__esModule",{value:!0}),H0.PollResponseEvent=void 0;var e=D_(),n=hy(),r=dy(),i=WO(),s=Xp();function o(R,x){if(!(R instanceof x))throw new TypeError("Cannot call a class as a function")}function a(R,x){for(var C=0;C<x.length;C++){var k=x[C];k.enumerable=k.enumerable||!1,k.configurable=!0,"value"in k&&(k.writable=!0),Object.defineProperty(R,k.key,k)}}function c(R,x,C){return x&&a(R.prototype,x),C&&a(R,C),Object.defineProperty(R,"prototype",{writable:!1}),R}function l(R,x){if(typeof x!="function"&&x!==null)throw new TypeError("Super expression must either be null or a function");R.prototype=Object.create(x&&x.prototype,{constructor:{value:R,writable:!0,configurable:!0}}),Object.defineProperty(R,"prototype",{writable:!1}),x&&d(R,x)}function d(R,x){return d=Object.setPrototypeOf||function(k,T){return k.__proto__=T,k},d(R,x)}function h(R){var x=y();return function(){var k=v(R),T;if(x){var L=v(this).constructor;T=Reflect.construct(k,arguments,L)}else T=k.apply(this,arguments);return m(this,T)}}function m(R,x){if(x&&(t(x)==="object"||typeof x=="function"))return x;if(x!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return g(R)}function g(R){if(R===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return R}function y(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function v(R){return v=Object.setPrototypeOf?Object.getPrototypeOf:function(C){return C.__proto__||Object.getPrototypeOf(C)},v(R)}function E(R,x,C){return x in R?Object.defineProperty(R,x,{value:C,enumerable:!0,configurable:!0,writable:!0}):R[x]=C,R}var w=(function(R){l(C,R);var x=h(C);function C(k){var T;o(this,C),T=x.call(this,k),E(g(T),"internalAnswerIds",void 0),E(g(T),"internalSpoiled",void 0),E(g(T),"pollEventId",void 0);var L=T.wireContent["m.relates_to"];if(!i.REFERENCE_RELATION.matches(L?.rel_type)||typeof L?.event_id!="string")throw new r.InvalidEventError("Relationship must be a reference to an event");return T.pollEventId=L.event_id,T.validateAgainst(null),T}return c(C,[{key:"answerIds",get:function(){return this.internalAnswerIds}},{key:"spoiled",get:function(){return this.internalSpoiled}},{key:"validateAgainst",value:function(T){var L=n.M_POLL_RESPONSE.findIn(this.wireContent);if(!Array.isArray(L?.answers)){this.internalSpoiled=!0,this.internalAnswerIds=[];return}var O=L.answers;if(O.some(function(P){return typeof P!="string"})||O.length===0){this.internalSpoiled=!0,this.internalAnswerIds=[];return}if(T){if(O.some(function(P){return!T.answers.some(function(D){return D.id===P})})){this.internalSpoiled=!0,this.internalAnswerIds=[];return}O=O.slice(0,T.maxSelections)}this.internalAnswerIds=O,this.internalSpoiled=!1}},{key:"isEquivalentTo",value:function(T){return(0,s.isEventTypeSame)(T,n.M_POLL_RESPONSE)}},{key:"serialize",value:function(){return{type:n.M_POLL_RESPONSE.name,content:E({"m.relates_to":{rel_type:i.REFERENCE_RELATION.name,event_id:this.pollEventId}},n.M_POLL_RESPONSE.name,{answers:this.spoiled?void 0:this.answerIds})}}}],[{key:"from",value:function(T,L){return new C({type:n.M_POLL_RESPONSE.name,content:E({"m.relates_to":{rel_type:i.REFERENCE_RELATION.name,event_id:L}},n.M_POLL_RESPONSE.name,{answers:T})})}}]),C})(e.ExtensibleEvent);return H0.PollResponseEvent=w,H0}var V0={},O$;function uJ(){if(O$)return V0;O$=1;function t(T){"@babel/helpers - typeof";return t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(L){return typeof L}:function(L){return L&&typeof Symbol=="function"&&L.constructor===Symbol&&L!==Symbol.prototype?"symbol":typeof L},t(T)}Object.defineProperty(V0,"__esModule",{value:!0}),V0.PollEndEvent=void 0;var e=hy(),n=dy(),r=WO(),i=Jp(),s=Ul(),o=Xp(),a=D_();function c(T,L){var O=Object.keys(T);if(Object.getOwnPropertySymbols){var P=Object.getOwnPropertySymbols(T);L&&(P=P.filter(function(D){return Object.getOwnPropertyDescriptor(T,D).enumerable})),O.push.apply(O,P)}return O}function l(T){for(var L=1;L<arguments.length;L++){var O=arguments[L]!=null?arguments[L]:{};L%2?c(Object(O),!0).forEach(function(P){C(T,P,O[P])}):Object.getOwnPropertyDescriptors?Object.defineProperties(T,Object.getOwnPropertyDescriptors(O)):c(Object(O)).forEach(function(P){Object.defineProperty(T,P,Object.getOwnPropertyDescriptor(O,P))})}return T}function d(T,L){if(!(T instanceof L))throw new TypeError("Cannot call a class as a function")}function h(T,L){for(var O=0;O<L.length;O++){var P=L[O];P.enumerable=P.enumerable||!1,P.configurable=!0,"value"in P&&(P.writable=!0),Object.defineProperty(T,P.key,P)}}function m(T,L,O){return L&&h(T.prototype,L),O&&h(T,O),Object.defineProperty(T,"prototype",{writable:!1}),T}function g(T,L){if(typeof L!="function"&&L!==null)throw new TypeError("Super expression must either be null or a function");T.prototype=Object.create(L&&L.prototype,{constructor:{value:T,writable:!0,configurable:!0}}),Object.defineProperty(T,"prototype",{writable:!1}),L&&y(T,L)}function y(T,L){return y=Object.setPrototypeOf||function(P,D){return P.__proto__=D,P},y(T,L)}function v(T){var L=R();return function(){var P=x(T),D;if(L){var j=x(this).constructor;D=Reflect.construct(P,arguments,j)}else D=P.apply(this,arguments);return E(this,D)}}function E(T,L){if(L&&(t(L)==="object"||typeof L=="function"))return L;if(L!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return w(T)}function w(T){if(T===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return T}function R(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function x(T){return x=Object.setPrototypeOf?Object.getPrototypeOf:function(O){return O.__proto__||Object.getPrototypeOf(O)},x(T)}function C(T,L,O){return L in T?Object.defineProperty(T,L,{value:O,enumerable:!0,configurable:!0,writable:!0}):T[L]=O,T}var k=(function(T){g(O,T);var L=v(O);function O(P){var D;d(this,O),D=L.call(this,P),C(w(D),"pollEventId",void 0),C(w(D),"closingMessage",void 0);var j=D.wireContent["m.relates_to"];if(!r.REFERENCE_RELATION.matches(j?.rel_type)||typeof j?.event_id!="string")throw new n.InvalidEventError("Relationship must be a reference to an event");return D.pollEventId=j.event_id,D.closingMessage=new i.MessageEvent(D.wireFormat),D}return m(O,[{key:"isEquivalentTo",value:function(D){return(0,o.isEventTypeSame)(D,e.M_POLL_END)}},{key:"serialize",value:function(){return{type:e.M_POLL_END.name,content:l(C({"m.relates_to":{rel_type:r.REFERENCE_RELATION.name,event_id:this.pollEventId}},e.M_POLL_END.name,{}),this.closingMessage.serialize().content)}}}],[{key:"from",value:function(D,j){var H;return new O({type:e.M_POLL_END.name,content:(H={"m.relates_to":{rel_type:r.REFERENCE_RELATION.name,event_id:D}},C(H,e.M_POLL_END.name,{}),C(H,s.M_TEXT.name,j),H)})}}]),O})(a.ExtensibleEvent);return V0.PollEndEvent=k,V0}var P$;function dJ(){if(P$)return Y2;P$=1,Object.defineProperty(Y2,"__esModule",{value:!0}),Y2.parseMPoll=i;var t=hy(),e=cJ(),n=lJ(),r=uJ();function i(s){return t.M_POLL_START.matches(s.type)?new e.PollStartEvent(s):t.M_POLL_RESPONSE.matches(s.type)?new n.PollResponseEvent(s):t.M_POLL_END.matches(s.type)?new r.PollEndEvent(s):null}return Y2}var D$;function Bve(){if(D$)return P0;D$=1,Object.defineProperty(P0,"__esModule",{value:!0}),P0.ExtensibleEvents=void 0;var t=iJ(),e=dy(),n=oJ(),r=aJ(),i=Ul(),s=hy(),o=dJ();function a(v,E){var w=typeof Symbol<"u"&&v[Symbol.iterator]||v["@@iterator"];if(!w){if(Array.isArray(v)||(w=c(v))||E){w&&(v=w);var R=0,x=function(){};return{s:x,n:function(){return R>=v.length?{done:!0}:{done:!1,value:v[R++]}},e:function(O){throw O},f:x}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var C=!0,k=!1,T;return{s:function(){w=w.call(v)},n:function(){var O=w.next();return C=O.done,O},e:function(O){k=!0,T=O},f:function(){try{!C&&w.return!=null&&w.return()}finally{if(k)throw T}}}}function c(v,E){if(v){if(typeof v=="string")return l(v,E);var w=Object.prototype.toString.call(v).slice(8,-1);if(w==="Object"&&v.constructor&&(w=v.constructor.name),w==="Map"||w==="Set")return Array.from(v);if(w==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(w))return l(v,E)}}function l(v,E){(E==null||E>v.length)&&(E=v.length);for(var w=0,R=new Array(E);w<E;w++)R[w]=v[w];return R}function d(v,E){if(!(v instanceof E))throw new TypeError("Cannot call a class as a function")}function h(v,E){for(var w=0;w<E.length;w++){var R=E[w];R.enumerable=R.enumerable||!1,R.configurable=!0,"value"in R&&(R.writable=!0),Object.defineProperty(v,R.key,R)}}function m(v,E,w){return E&&h(v.prototype,E),w&&h(v,w),Object.defineProperty(v,"prototype",{writable:!1}),v}function g(v,E,w){return E in v?Object.defineProperty(v,E,{value:w,enumerable:!0,configurable:!0,writable:!0}):v[E]=w,v}var y=(function(){function v(){d(this,v),g(this,"interpreters",new t.NamespacedMap([[n.LEGACY_M_ROOM_MESSAGE,n.parseMRoomMessage],[i.M_MESSAGE,r.parseMMessage],[i.M_EMOTE,r.parseMMessage],[i.M_NOTICE,r.parseMMessage],[s.M_POLL_START,o.parseMPoll],[s.M_POLL_RESPONSE,o.parseMPoll],[s.M_POLL_END,o.parseMPoll]])),g(this,"_unknownInterpretOrder",[i.M_MESSAGE])}return m(v,[{key:"unknownInterpretOrder",get:function(){var w;return(w=this._unknownInterpretOrder)!==null&&w!==void 0?w:[]},set:function(w){this._unknownInterpretOrder=w}},{key:"registerInterpreter",value:function(w,R){this.interpreters.set(w,R)}},{key:"parse",value:function(w){try{if(this.interpreters.hasNamespaced(w.type))return this.interpreters.getNamespaced(w.type)(w);var R=a(this.unknownInterpretOrder),x;try{for(R.s();!(x=R.n()).done;){var C=x.value;if(this.interpreters.has(C)){var k=this.interpreters.get(C)(w);if(k)return k}}}catch(T){R.e(T)}finally{R.f()}return null}catch(T){if(T instanceof e.InvalidEventError)return null;throw T}}}],[{key:"defaultInstance",get:function(){return v._defaultInstance}},{key:"unknownInterpretOrder",get:function(){return v.defaultInstance.unknownInterpretOrder},set:function(w){v.defaultInstance.unknownInterpretOrder=w}},{key:"registerInterpreter",value:function(w,R){v.defaultInstance.registerInterpreter(w,R)}},{key:"parse",value:function(w){return v.defaultInstance.parse(w)}}]),v})();return P0.ExtensibleEvents=y,g(y,"_defaultInstance",new y),P0}var GI={},N$;function Hve(){return N$||(N$=1,Object.defineProperty(GI,"__esModule",{value:!0})),GI}var Hh={},U$;function qve(){if(U$)return Hh;U$=1,Object.defineProperty(Hh,"__esModule",{value:!0}),Hh.LegacyMsgType=void 0,Hh.isEventLike=n;var t=Ul(),e;Hh.LegacyMsgType=e,(function(r){r.Text="m.text",r.Notice="m.notice",r.Emote="m.emote"})(e||(Hh.LegacyMsgType=e={}));function n(r,i){var s=r.content;return i===e.Text?t.M_MESSAGE.matches(r.type)||r.type==="m.room.message"&&s?.msgtype==="m.text":i===e.Emote?t.M_EMOTE.matches(r.type)||r.type==="m.room.message"&&s?.msgtype==="m.emote":i===e.Notice?t.M_NOTICE.matches(r.type)||r.type==="m.room.message"&&s?.msgtype==="m.notice":!1}return Hh}var j$;function Vve(){return j$||(j$=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=Bve();Object.keys(e).forEach(function(T){T==="default"||T==="__esModule"||T in t&&t[T]===e[T]||Object.defineProperty(t,T,{enumerable:!0,get:function(){return e[T]}})});var n=Hve();Object.keys(n).forEach(function(T){T==="default"||T==="__esModule"||T in t&&t[T]===n[T]||Object.defineProperty(t,T,{enumerable:!0,get:function(){return n[T]}})});var r=dy();Object.keys(r).forEach(function(T){T==="default"||T==="__esModule"||T in t&&t[T]===r[T]||Object.defineProperty(t,T,{enumerable:!0,get:function(){return r[T]}})});var i=fy();Object.keys(i).forEach(function(T){T==="default"||T==="__esModule"||T in t&&t[T]===i[T]||Object.defineProperty(t,T,{enumerable:!0,get:function(){return i[T]}})});var s=iJ();Object.keys(s).forEach(function(T){T==="default"||T==="__esModule"||T in t&&t[T]===s[T]||Object.defineProperty(t,T,{enumerable:!0,get:function(){return s[T]}})});var o=sJ();Object.keys(o).forEach(function(T){T==="default"||T==="__esModule"||T in t&&t[T]===o[T]||Object.defineProperty(t,T,{enumerable:!0,get:function(){return o[T]}})});var a=qve();Object.keys(a).forEach(function(T){T==="default"||T==="__esModule"||T in t&&t[T]===a[T]||Object.defineProperty(t,T,{enumerable:!0,get:function(){return a[T]}})});var c=Xp();Object.keys(c).forEach(function(T){T==="default"||T==="__esModule"||T in t&&t[T]===c[T]||Object.defineProperty(t,T,{enumerable:!0,get:function(){return c[T]}})});var l=oJ();Object.keys(l).forEach(function(T){T==="default"||T==="__esModule"||T in t&&t[T]===l[T]||Object.defineProperty(t,T,{enumerable:!0,get:function(){return l[T]}})});var d=aJ();Object.keys(d).forEach(function(T){T==="default"||T==="__esModule"||T in t&&t[T]===d[T]||Object.defineProperty(t,T,{enumerable:!0,get:function(){return d[T]}})});var h=dJ();Object.keys(h).forEach(function(T){T==="default"||T==="__esModule"||T in t&&t[T]===h[T]||Object.defineProperty(t,T,{enumerable:!0,get:function(){return h[T]}})});var m=WO();Object.keys(m).forEach(function(T){T==="default"||T==="__esModule"||T in t&&t[T]===m[T]||Object.defineProperty(t,T,{enumerable:!0,get:function(){return m[T]}})});var g=D_();Object.keys(g).forEach(function(T){T==="default"||T==="__esModule"||T in t&&t[T]===g[T]||Object.defineProperty(t,T,{enumerable:!0,get:function(){return g[T]}})});var y=Ul();Object.keys(y).forEach(function(T){T==="default"||T==="__esModule"||T in t&&t[T]===y[T]||Object.defineProperty(t,T,{enumerable:!0,get:function(){return y[T]}})});var v=Jp();Object.keys(v).forEach(function(T){T==="default"||T==="__esModule"||T in t&&t[T]===v[T]||Object.defineProperty(t,T,{enumerable:!0,get:function(){return v[T]}})});var E=zO();Object.keys(E).forEach(function(T){T==="default"||T==="__esModule"||T in t&&t[T]===E[T]||Object.defineProperty(t,T,{enumerable:!0,get:function(){return E[T]}})});var w=GO();Object.keys(w).forEach(function(T){T==="default"||T==="__esModule"||T in t&&t[T]===w[T]||Object.defineProperty(t,T,{enumerable:!0,get:function(){return w[T]}})});var R=hy();Object.keys(R).forEach(function(T){T==="default"||T==="__esModule"||T in t&&t[T]===R[T]||Object.defineProperty(t,T,{enumerable:!0,get:function(){return R[T]}})});var x=cJ();Object.keys(x).forEach(function(T){T==="default"||T==="__esModule"||T in t&&t[T]===x[T]||Object.defineProperty(t,T,{enumerable:!0,get:function(){return x[T]}})});var C=lJ();Object.keys(C).forEach(function(T){T==="default"||T==="__esModule"||T in t&&t[T]===C[T]||Object.defineProperty(t,T,{enumerable:!0,get:function(){return C[T]}})});var k=uJ();Object.keys(k).forEach(function(T){T==="default"||T==="__esModule"||T in t&&t[T]===k[T]||Object.defineProperty(t,T,{enumerable:!0,get:function(){return k[T]}})})})(KI)),KI}var Eo=Vve();const Kve="modulepreload",Gve=function(t,e){return new URL(t,e).href},F$={},Rb=function(e,n,r){let i=Promise.resolve();if(n&&n.length>0){let l=function(d){return Promise.all(d.map(h=>Promise.resolve(h).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};const o=document.getElementsByTagName("link"),a=document.querySelector("meta[property=csp-nonce]"),c=a?.nonce||a?.getAttribute("nonce");i=l(n.map(d=>{if(d=Gve(d,r),d in F$)return;F$[d]=!0;const h=d.endsWith(".css"),m=h?'[rel="stylesheet"]':"";if(r)for(let y=o.length-1;y>=0;y--){const v=o[y];if(v.href===d&&(!h||v.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${d}"]${m}`))return;const g=document.createElement("link");if(g.rel=h?"stylesheet":Kve,h||(g.as="script"),g.crossOrigin="",g.href=d,c&&g.setAttribute("nonce",c),document.head.appendChild(g),h)return new Promise((y,v)=>{g.addEventListener("load",y),g.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${d}`)))})}))}function s(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return i.then(o=>{for(const a of o||[])a.status==="rejected"&&s(a.reason);return e().catch(s)})};function zve(t,e){if(t==null)return{};var n={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(e.includes(r))continue;n[r]=t[r]}return n}function Wve(t,e){if(t==null)return{};var n,r,i=zve(t,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(r=0;r<s.length;r++)n=s[r],e.includes(n)||{}.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}var Yi=(function(t){return t.DisplayName="User.displayName",t.AvatarUrl="User.avatarUrl",t.Presence="User.presence",t.CurrentlyActive="User.currentlyActive",t.LastPresenceTs="User.lastPresenceTs",t})({});class qu extends Gn{constructor(e){super(),this.userId=e,M(this,"modified",-1),M(this,"displayName",void 0),M(this,"rawDisplayName",void 0),M(this,"avatarUrl",void 0),M(this,"presenceStatusMsg",void 0),M(this,"presence","offline"),M(this,"lastActiveAgo",0),M(this,"lastPresenceTs",0),M(this,"currentlyActive",!1),M(this,"events",{}),this.displayName=e,this.rawDisplayName=e,this.updateModifiedTime()}static createUser(e,n){var r=new qu(e);return n.reEmitter.reEmit(r,[Yi.AvatarUrl,Yi.DisplayName,Yi.Presence,Yi.CurrentlyActive,Yi.LastPresenceTs]),r}setPresenceEvent(e){if(e.getType()==="m.presence"){var n=this.events.presence===null;this.events.presence=e;var r=[];(e.getContent().presence!==this.presence||n)&&r.push(Yi.Presence),e.getContent().avatar_url&&e.getContent().avatar_url!==this.avatarUrl&&r.push(Yi.AvatarUrl),e.getContent().displayname&&e.getContent().displayname!==this.displayName&&r.push(Yi.DisplayName),e.getContent().currently_active!==void 0&&e.getContent().currently_active!==this.currentlyActive&&r.push(Yi.CurrentlyActive),this.presence=e.getContent().presence,r.push(Yi.LastPresenceTs),e.getContent().status_msg&&(this.presenceStatusMsg=e.getContent().status_msg),e.getContent().displayname&&(this.displayName=e.getContent().displayname),e.getContent().avatar_url&&(this.avatarUrl=e.getContent().avatar_url),this.lastActiveAgo=e.getContent().last_active_ago,this.lastPresenceTs=Date.now(),this.currentlyActive=e.getContent().currently_active,this.updateModifiedTime();for(var i of r)this.emit(i,e,this)}}setDisplayName(e){var n=this.displayName;this.displayName=e,e!==n&&this.updateModifiedTime()}setRawDisplayName(e){this.rawDisplayName=e}setAvatarUrl(e){var n=this.avatarUrl;this.avatarUrl=e,e!==n&&this.updateModifiedTime()}updateModifiedTime(){this.modified=Date.now()}getLastModifiedTime(){return this.modified}getLastActiveTs(){return this.lastPresenceTs-this.lastActiveAgo}}var Tt=(function(t){return t.Backward="b",t.Forward="f",t})({});class Ue{static setEventMetadata(e,n,r){e.setMetadata(n,r)}constructor(e){var n,r;this.eventTimelineSet=e,M(this,"roomId",void 0),M(this,"name",void 0),M(this,"events",[]),M(this,"baseIndex",0),M(this,"startState",void 0),M(this,"endState",void 0),M(this,"startToken",null),M(this,"endToken",null),M(this,"prevTimeline",null),M(this,"nextTimeline",null),M(this,"paginationRequests",{[Tt.Backward]:null,[Tt.Forward]:null}),this.roomId=(n=(r=e.room)===null||r===void 0?void 0:r.roomId)!==null&&n!==void 0?n:null,this.roomId&&(this.startState=new jb(this.roomId),this.endState=new jb(this.roomId)),this.paginationRequests={b:null,f:null},this.name=this.roomId+":"+new Date().toISOString()}initialiseState(e){var n,r,{timelineWasEmpty:i}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.events.length>0)throw new Error("Cannot initialise state after events are added");(n=this.startState)===null||n===void 0||n.setStateEvents(e,{timelineWasEmpty:i}),(r=this.endState)===null||r===void 0||r.setStateEvents(e,{timelineWasEmpty:i})}forkLive(e){var n=this.getState(e),r=new Ue(this.eventTimelineSet);return r.startState=n?.clone(),r.endState=n,this.endState=n?.clone(),r}fork(e){var n=this.getState(e),r=new Ue(this.eventTimelineSet);return r.startState=n?.clone(),r.endState=n?.clone(),r}getRoomId(){return this.roomId}getFilter(){return this.eventTimelineSet.getFilter()}getTimelineSet(){return this.eventTimelineSet}getBaseIndex(){return this.baseIndex}getEvents(){return this.events}getState(e){if(e==Ue.BACKWARDS)return this.startState;if(e==Ue.FORWARDS)return this.endState;throw new Error("Invalid direction '"+e+"'")}getPaginationToken(e){return this.roomId?this.getState(e).paginationToken:e===Tt.Backward?this.startToken:this.endToken}setPaginationToken(e,n){this.roomId?this.getState(n).paginationToken=e:n===Tt.Backward?this.startToken=e:this.endToken=e}getNeighbouringTimeline(e){if(e==Ue.BACKWARDS)return this.prevTimeline;if(e==Ue.FORWARDS)return this.nextTimeline;throw new Error("Invalid direction '"+e+"'")}setNeighbouringTimeline(e,n){if(this.getNeighbouringTimeline(n))throw new Error("timeline already has a neighbouring timeline - cannot reset neighbour (direction: "+n+")");if(n==Ue.BACKWARDS)this.prevTimeline=e;else if(n==Ue.FORWARDS)this.nextTimeline=e;else throw new Error("Invalid direction '"+n+"'");this.setPaginationToken(null,n)}addEvent(e,n){var{toStartOfTimeline:r,roomState:i,timelineWasEmpty:s,addToState:o}=n;i||(i=r?this.startState:this.endState);var a=this.getTimelineSet();if(a.room&&(Ue.setEventMetadata(e,i,r),o&&e.isState()&&a.room.getUnfilteredTimelineSet()===a)){var c;(c=i)===null||c===void 0||c.setStateEvents([e],{timelineWasEmpty:s}),(!e.sender||e.getType()===ee.RoomMember&&!r)&&Ue.setEventMetadata(e,i,r)}var l;r?l=0:l=this.events.length,this.events.splice(l,0,e),r&&this.baseIndex++}insertEvent(e,n,r,i){var s=this.getTimelineSet();s.room&&(Ue.setEventMetadata(e,r,!1),i&&e.isState()&&s.room.getUnfilteredTimelineSet()===s&&(r.setStateEvents([e],{}),(!e.sender||e.getType()===ee.RoomMember)&&Ue.setEventMetadata(e,r,!1))),this.events.splice(n,0,e)}removeEvent(e){for(var n=this.events.length-1;n>=0;n--){var r=this.events[n];if(r.getId()==e)return this.events.splice(n,1),n<this.baseIndex&&this.baseIndex--,r}return null}toString(){return this.name}}M(Ue,"BACKWARDS",Tt.Backward);M(Ue,"FORWARDS",Tt.Forward);var fE=(function(t){return t.Add="Relations.add",t.Remove="Relations.remove",t.Redaction="Relations.redaction",t})({}),Yve=function(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];return[n,...r].includes(e)};class YO extends Gn{constructor(e,n,r,i){var s;super(),s=this,this.relationType=e,this.eventType=n,this.altEventTypes=i,M(this,"relationEventIds",new Set),M(this,"relations",new Set),M(this,"annotationsByKey",{}),M(this,"annotationsBySender",{}),M(this,"sortedAnnotationsByKey",[]),M(this,"targetEvent",null),M(this,"creationEmitted",!1),M(this,"client",void 0),M(this,"onEventStatus",(o,a)=>{if(!o.isSending()){o.removeListener(Zt.Status,this.onEventStatus);return}a===lt.CANCELLED&&(o.removeListener(Zt.Status,this.onEventStatus),this.removeEvent(o))}),M(this,"onBeforeRedaction",(function(){var o=B(function*(a){if(s.relations.has(a)){if(s.relations.delete(a),s.relationType===vn.Annotation)s.removeAnnotationFromAggregation(a);else if(s.relationType===vn.Replace&&s.targetEvent&&!s.targetEvent.isState()){var c=yield s.getLastReplacement();s.targetEvent.makeReplaced(c)}a.removeListener(Zt.BeforeRedaction,s.onBeforeRedaction),s.emit(fE.Redaction,a)}});return function(a){return o.apply(this,arguments)}})()),this.client=r instanceof _T?r.client:r}addEvent(e){var n=this;return B(function*(){if(!n.relationEventIds.has(e.getId())){var r=e.getRelation();if(!r){N.error("Event must have relation info");return}var i=r.rel_type,s=e.getType();if(n.relationType!==i||!Yve(s,n.eventType,n.altEventTypes)){N.error("Event relation info doesn't match this container");return}if(e.isSending()&&e.on(Zt.Status,n.onEventStatus),n.relations.add(e),n.relationEventIds.add(e.getId()),n.relationType===vn.Annotation)n.addAnnotationToAggregation(e);else if(n.relationType===vn.Replace&&n.targetEvent&&!n.targetEvent.isState()){var o=yield n.getLastReplacement();n.targetEvent.makeReplaced(o)}e.on(Zt.BeforeRedaction,n.onBeforeRedaction),n.emit(fE.Add,e),n.maybeEmitCreated()}})()}removeEvent(e){var n=this;return B(function*(){if(n.relations.has(e)){if(n.relations.delete(e),n.relationType===vn.Annotation)n.removeAnnotationFromAggregation(e);else if(n.relationType===vn.Replace&&n.targetEvent&&!n.targetEvent.isState()){var r=yield n.getLastReplacement();n.targetEvent.makeReplaced(r)}n.emit(fE.Remove,e)}})()}getRelations(){return[...this.relations]}addAnnotationToAggregation(e){var n,{key:r}=(n=e.getRelation())!==null&&n!==void 0?n:{};if(r){var i=this.annotationsByKey[r];i||(i=this.annotationsByKey[r]=new Set,this.sortedAnnotationsByKey.push([r,i])),i.add(e),this.sortedAnnotationsByKey.sort((a,c)=>{var l=a[1],d=c[1];return d.size-l.size});var s=e.getSender(),o=this.annotationsBySender[s];o||(o=this.annotationsBySender[s]=new Set),o.add(e)}}removeAnnotationFromAggregation(e){var n,{key:r}=(n=e.getRelation())!==null&&n!==void 0?n:{};if(r){var i=this.annotationsByKey[r];i&&(i.delete(e),this.sortedAnnotationsByKey.sort((a,c)=>{var l=a[1],d=c[1];return d.size-l.size}));var s=e.getSender(),o=this.annotationsBySender[s];o&&o.delete(e)}}getSortedAnnotationsByKey(){return this.relationType!==vn.Annotation?null:this.sortedAnnotationsByKey}getAnnotationsBySender(){return this.relationType!==vn.Annotation?null:this.annotationsBySender}getLastReplacement(){var e=this;return B(function*(){if(e.relationType!==vn.Replace||!e.targetEvent)return null;var n=e.targetEvent.getServerAggregatedRelation(vn.Replace),r=n?.origin_server_ts,i=e.getRelations().reduce((s,o)=>o.getSender()!==e.targetEvent.getSender()||r&&r>o.getTs()||s&&s.getTs()>o.getTs()?s:o,null);return i!=null&&i.shouldAttemptDecryption()&&e.client.getCrypto()?yield i.attemptDecryption(e.client.getCrypto()):i!=null&&i.isBeingDecrypted()&&(yield i.getDecryptionPromise()),i})()}setTargetEvent(e){var n=this;return B(function*(){if(!n.targetEvent){if(n.targetEvent=e,n.relationType===vn.Replace&&!n.targetEvent.isState()){var r=yield n.getLastReplacement();r&&n.targetEvent.makeReplaced(r)}n.maybeEmitCreated()}})()}maybeEmitCreated(){this.creationEmitted||!this.targetEvent||!this.relations.size||(this.creationEmitted=!0,this.targetEvent.emit(Zt.RelationsCreated,this.relationType,this.eventType))}}class fJ{constructor(e,n){this.client=e,this.room=n,M(this,"relations",new Map)}getChildEventsForEvent(e,n,r){var i;return(i=this.relations.get(e))===null||i===void 0||(i=i.get(n))===null||i===void 0?void 0:i.get(r)}getAllChildEventsForEvent(e){var n,r=(n=this.relations.get(e))!==null&&n!==void 0?n:new Map,i=[];for(var s of r.values())for(var o of s.values())i.push(...o.getRelations());return i}aggregateParentEvent(e){var n=this.relations.get(e.getId());if(n)for(var r of n.values())for(var i of r.values())i.setTargetEvent(e)}aggregateChildEvent(e,n){if(!(e.isRedacted()||e.status===lt.CANCELLED)){var r=e.getRelation();if(r){var i=()=>{if(e.isDecryptionFailure()){e.once(Zt.Decrypted,i);return}this.aggregateChildEvent(e,n)};if(e.isBeingDecrypted()||e.shouldAttemptDecryption()){e.once(Zt.Decrypted,i);return}var{event_id:s,rel_type:o}=r,a=e.getType(),c=this.relations.get(s);c||(c=new Map,this.relations.set(s,c));var l=c.get(o);l||(l=new Map,c.set(o,l));var d=l.get(a);if(!d){var h,m,g;d=new YO(o,a,this.client),l.set(a,d);var y=(h=this.room)!==null&&h!==void 0?h:n?.room,v=(m=(g=n?.findEventById(s))!==null&&g!==void 0?g:y?.findEventById(s))!==null&&m!==void 0?m:y?.getPendingEvent(s);v&&d.setTargetEvent(v)}d.addEvent(e)}}}}var xg;xg=N.log.bind(N);var B1=(function(t){return t.Ignore="ignore",t.Replace="replace",t})({});class Dg extends Gn{constructor(e){var n,r,i,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0,c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:null;super(),this.room=e,this.thread=a,this.threadListType=c,M(this,"relations",void 0),M(this,"timelineSupport",void 0),M(this,"displayPendingEvents",void 0),M(this,"liveTimeline",void 0),M(this,"timelines",void 0),M(this,"_eventIdToTimeline",new Map),M(this,"filter",void 0),this.timelineSupport=!!s.timelineSupport,this.liveTimeline=new Ue(this),this.displayPendingEvents=s.pendingEvents!==!1,this.timelines=[this.liveTimeline],this._eventIdToTimeline=new Map,this.filter=s.filter,this.relations=(n=(r=this.room)===null||r===void 0?void 0:r.relations)!==null&&n!==void 0?n:new fJ((i=e?.client)!==null&&i!==void 0?i:o)}getTimelines(){return this.timelines}getFilter(){return this.filter}setFilter(e){this.filter=e}getPendingEvents(){return!this.room||!this.displayPendingEvents?[]:this.room.getPendingEvents()}getLiveTimeline(){return this.liveTimeline}setLiveTimeline(e){this.liveTimeline=e}eventIdToTimeline(e){return this._eventIdToTimeline.get(e)}replaceEventId(e,n){var r=this._eventIdToTimeline.get(e);r&&(this._eventIdToTimeline.delete(e),this._eventIdToTimeline.set(n,r))}resetLiveTimeline(e,n){var r=!this.timelineSupport||!n,i=this.liveTimeline,s=r?i.forkLive(Ue.FORWARDS):i.fork(Ue.FORWARDS);r?(this.timelines=[s],this._eventIdToTimeline=new Map):this.timelines.push(s),n&&i.setPaginationToken(n,Ue.FORWARDS),s.setPaginationToken(e??null,Ue.BACKWARDS),this.liveTimeline=s,this.emit(Me.TimelineReset,this.room,this,r)}getTimelineForEvent(e){if(e==null)return null;var n=this._eventIdToTimeline.get(e);return n===void 0?null:n}findEventById(e){var n=this.getTimelineForEvent(e);if(n)return n.getEvents().find(function(r){return r.getId()==e})}addTimeline(){if(!this.timelineSupport)throw new Error("timeline support is disabled. Set the 'timelineSupport' parameter to true when creating MatrixClient to enable it.");var e=new Ue(this);return this.timelines.push(e),e}addEventsToTimeline(e,n,r,i,s){if(!i)throw new Error("'timeline' not specified for EventTimelineSet.addEventsToTimeline");if(!n&&i==this.liveTimeline)throw new Error("EventTimelineSet.addEventsToTimeline cannot be used for adding events to the live timeline - use Room.addLiveEvents instead");if(!(this.filter&&(e=this.filter.filterRoomTimeline(e),!e.length))){var o=n?Ue.BACKWARDS:Ue.FORWARDS,a=n?Ue.FORWARDS:Ue.BACKWARDS,c=!1,l=!1;for(var d of e){var h=d.getId(),m=this._eventIdToTimeline.get(h);if(!m){this.addEventToTimeline(d,i,{toStartOfTimeline:n,addToState:r}),l=!0,c=!0;continue}if(l=!1,m==i){xg("Event "+h+" already in timeline "+i);continue}var g=i.getNeighbouringTimeline(o);if(g){m==g?xg("Event "+h+" in neighbouring timeline - switching to "+m):xg("Event "+h+" already in a different timeline "+m),i=m;continue}N.info("Already have timeline for "+h+" - joining timeline "+i+" to "+m);var y=m===this.liveTimeline,v=i===this.liveTimeline,E=o===Ue.BACKWARDS&&y,w=o===Ue.FORWARDS&&v;if(E||w){E&&N.warn("Refusing to set a preceding existingTimeLine on our timeline as the existingTimeLine is live ("+m+")"),w&&N.warn("Refusing to set our preceding timeline on a existingTimeLine as our timeline is live ("+i+")");continue}i.setNeighbouringTimeline(m,o),m.setNeighbouringTimeline(i,a),i=m,c=!0}if(l||!c){if(o===Ue.FORWARDS&&i===this.liveTimeline){N.warn({lastEventWasNew:l,didUpdate:c}),N.warn("Refusing to set forwards pagination token of live timeline "+"".concat(i," to ").concat(s));return}i.setPaginationToken(s??null,o)}}}addLiveEvent(e,n){var{duplicateStrategy:r,fromCache:i,roomState:s,timelineWasEmpty:o,addToState:a}=n;if(this.filter){var c=this.filter.filterRoomTimeline([e]);if(!c.length)return}var l=this._eventIdToTimeline.get(e.getId());if(l){if(r===B1.Replace){xg("EventTimelineSet.addLiveEvent: replacing duplicate event "+e.getId());for(var d=l.getEvents(),h=0;h<d.length;h++)if(d[h].getId()===e.getId()){s||(s=l.getState(Ue.FORWARDS)),Ue.setEventMetadata(e,s,!1),d[h]=e;break}}else xg("EventTimelineSet.addLiveEvent: ignoring duplicate event "+e.getId());return}this.addEventToTimeline(e,this.liveTimeline,{toStartOfTimeline:!1,fromCache:i,roomState:s,timelineWasEmpty:o,addToState:a})}addEventToTimeline(e,n,r){var{toStartOfTimeline:i,fromCache:s=!1,roomState:o,timelineWasEmpty:a,addToState:c}=r;if(n.getTimelineSet()!==this){var l;throw new Error("EventTimelineSet.addEventToTimeline: Timeline=".concat(n.toString(),` does not belong " +
                "in timelineSet(threadId=`).concat((l=this.thread)===null||l===void 0?void 0:l.id,")"))}var d=e.getId();if(this.relations.aggregateParentEvent(e),this.relations.aggregateChildEvent(e,this),this.room&&!this.canContain(e)){var h,m="event=".concat(d);e.threadRootId&&(m+="(belongs to thread=".concat(e.threadRootId,")")),N.warn("EventTimelineSet.addEventToTimeline: Ignoring ".concat(m," that does not belong ")+"in timeline=".concat(n.toString()," timelineSet(threadId=").concat((h=this.thread)===null||h===void 0?void 0:h.id,")"));return}n.addEvent(e,{toStartOfTimeline:i,roomState:o,timelineWasEmpty:a,addToState:c}),this._eventIdToTimeline.set(d,n);var g={timeline:n,liveEvent:!i&&n==this.liveTimeline&&!s};this.emit(Me.Timeline,e,this.room,!!i,!1,g)}insertEventIntoTimeline(e,n,r,i){if(n.getTimelineSet()!==this){var s;throw new Error("EventTimelineSet.insertEventIntoTimeline: Timeline=".concat(n.toString(),` does not belong " +
                "in timelineSet(threadId=`).concat((s=this.thread)===null||s===void 0?void 0:s.id,")"))}var o=e.getId();if(this.relations.aggregateParentEvent(e),this.relations.aggregateChildEvent(e,this),this.room&&!this.canContain(e)){var a,c="event=".concat(o);e.threadRootId&&(c+="(belongs to thread=".concat(e.threadRootId,")")),N.warn("EventTimelineSet.insertEventIntoTimeline: Ignoring ".concat(c," that does not belong ")+"in timeline=".concat(n.toString()," timelineSet(threadId=").concat((a=this.thread)===null||a===void 0?void 0:a.id,")"));return}var l=e.relationEventId;if(!l){this.addEventToTimeline(e,n,{toStartOfTimeline:!1,fromCache:!1,timelineWasEmpty:!1,roomState:r,addToState:i});return}for(var d=this.findEventById(l),h=n.getEvents(),m=d!==void 0?h.indexOf(d):0,g=m;g<h.length;g++){var y=h[g];if(y.getTs()>e.getTs())break}n.insertEvent(e,g,r,i),this._eventIdToTimeline.set(o,n);var v={timeline:n,liveEvent:!1};this.emit(Me.Timeline,e,this.room,!1,!1,v)}handleRemoteEcho(e,n,r){var i=this._eventIdToTimeline.get(n);i?(this._eventIdToTimeline.delete(n),this._eventIdToTimeline.set(r,i)):(!this.filter||this.filter.filterRoomTimeline([e]).length)&&this.addEventToTimeline(e,this.liveTimeline,{toStartOfTimeline:!1,addToState:!1})}removeEvent(e){var n=this._eventIdToTimeline.get(e);if(!n)return null;var r=n.removeEvent(e);if(r){this._eventIdToTimeline.delete(e);var i={timeline:n};this.emit(Me.Timeline,r,this.room,void 0,!0,i)}return r}compareEventOrdering(e,n){if(e==n)return 0;var r=this._eventIdToTimeline.get(e),i=this._eventIdToTimeline.get(n);if(r===void 0||i===void 0)return null;if(r===i){for(var s=void 0,o=void 0,a=r.getEvents(),c=0;c<a.length&&(s===void 0||o===void 0);c++){var l=a[c].getId();l==e&&(s=c),l==n&&(o=c)}var d=s-o;return d<0?-1:d>0?1:0}for(var h=r;h;){if(h===i)return-1;h=h.getNeighbouringTimeline(Ue.FORWARDS)}for(h=r;h;){if(h===i)return 1;h=h.getNeighbouringTimeline(Ue.BACKWARDS)}return null}canContain(e){if(!this.room)throw new Error("Cannot call `EventTimelineSet::canContain without a `room` set. Set the room when creating the EventTimelineSet to call this method.");var{threadId:n,shouldLiveInRoom:r,shouldLiveInThread:i}=this.room.eventShouldLiveIn(e);if(this.thread)return this.thread.id===n;if(!r&&!i){var s;N.warn("EventTimelineSet:canContain event encountered which cannot be added to any timeline roomId=".concat((s=this.room)===null||s===void 0?void 0:s.roomId," eventId=").concat(e.getId()," threadId=").concat(e.threadRootId))}return r}}var lt=(function(t){return t.NOT_SENT="not_sent",t.ENCRYPTING="encrypting",t.SENDING="sending",t.QUEUED="queued",t.SENT="sent",t.CANCELLED="cancelled",t})({});class hJ{constructor(e,n){this.roomId=e}}class pJ{constructor(e){this.target=e,M(this,"reEmitters",new WeakMap)}reEmit(e,n){var r=this,i=this.reEmitters.get(e);i||(i=new Map,this.reEmitters.set(e,i));var s=function(c){if(i.has(c))return 1;var l=function(){if(!(c==="error"&&r.target.listenerCount("error")===0)){for(var h=arguments.length,m=new Array(h),g=0;g<h;g++)m[g]=arguments[g];r.target.emit(c,...m,e)}};e.on(c,l),i.set(c,l)};for(var o of n)s(o)}stopReEmitting(e,n){var r=this.reEmitters.get(e);if(r){for(var i of n)e.off(i,r.get(i)),r.delete(i);r.size===0&&this.reEmitters.delete(e)}}}class py extends pJ{constructor(e){super(e)}reEmit(e,n){super.reEmit(e,n)}stopReEmitting(e,n){super.stopReEmitting(e,n)}}var kb=new pT("unread_thread_notifications","org.matrix.msc3773.unread_thread_notifications");function Xve(t,e){if(e.endsWith("*")){var n=e.slice(0,-1);return t.slice(0,n.length)===n}else return t===e}class $${constructor(e,n){this.filterJson=e,this.userId=n}check(e){var n,r,i=((n=e.getUnsigned())===null||n===void 0?void 0:n["m.relations"])||{},s=Object.keys(i),o=[];return this.userId&&i!==null&&i!==void 0&&(r=i[Rn.name])!==null&&r!==void 0&&r.current_user_participated&&o.push(this.userId),this.checkFields(e.getRoomId(),e.getSender(),e.getType(),e.getContent()?e.getContent().url!==void 0:!1,s,o)}toJSON(){return Object.fromEntries(Object.entries({types:this.filterJson.types,not_types:this.filterJson.not_types,rooms:this.filterJson.rooms,not_rooms:this.filterJson.not_rooms,senders:this.filterJson.senders,not_senders:this.filterJson.not_senders,contains_url:this.filterJson.contains_url,[Zg.name]:this.filterJson[Zg.name],[ev.name]:this.filterJson[ev.name]}).filter(e=>{var[n,r]=e;return r}))}checkFields(e,n,r,i,s,o){var a={rooms:function(w){return e===w},senders:function(w){return n===w},types:function(w){return Xve(r,w)}};for(var c in a){var l=a[c],d="not_"+c,h=this.filterJson[d];if(h!=null&&h.some(l))return!1;var m=this.filterJson[c];if(m&&!m.some(l))return!1}var g=this.filterJson.contains_url;if(g!==void 0&&g!==i)return!1;var y=this.filterJson[ev.name];if(y!==void 0&&!this.arrayMatchesFilter(y,s))return!1;var v=this.filterJson[Zg.name];return!(v!==void 0&&!this.arrayMatchesFilter(v,o))}arrayMatchesFilter(e,n){return n.length>0&&e.every(r=>n.includes(r))}filter(e){return e.filter(this.check,this)}limit(){return this.filterJson.limit!==void 0?this.filterJson.limit:10}}function B$(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function og(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?B$(Object(n),!0).forEach(function(r){M(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):B$(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function zI(t,e,n){for(var r=e.split("."),i=t,s=0;s<r.length-1;s++)i[r[s]]||(i[r[s]]={}),i=i[r[s]];i[r[r.length-1]]=n}class zo{static fromJson(e,n,r){var i=new zo(e,n);return i.setDefinition(r),i}constructor(e,n){this.userId=e,this.filterId=n,M(this,"definition",{}),M(this,"roomFilter",void 0),M(this,"roomTimelineFilter",void 0)}getFilterId(){return this.filterId}getDefinition(){return this.definition}setDefinition(e){this.definition=e;var n=e.room,r={};n&&(n.rooms&&(r.rooms=n.rooms),n.rooms&&(r.not_rooms=n.not_rooms)),this.roomFilter=new $$(r,this.userId),this.roomTimelineFilter=new $$(n?.timeline||{},this.userId)}getRoomTimelineFilterComponent(){return this.roomTimelineFilter}filterRoomTimeline(e){return this.roomFilter&&(e=this.roomFilter.filter(e)),this.roomTimelineFilter&&(e=this.roomTimelineFilter.filter(e)),e}setTimelineLimit(e){zI(this.definition,"room.timeline.limit",e)}setUnreadThreadNotifications(e){var n,r;this.definition=og(og({},this.definition),{},{room:og(og({},(n=this.definition)===null||n===void 0?void 0:n.room),{},{timeline:og(og({},(r=this.definition)===null||r===void 0||(r=r.room)===null||r===void 0?void 0:r.timeline),{},{[kb.name]:e})})})}setLazyLoadMembers(e){zI(this.definition,"room.state.lazy_load_members",e)}setIncludeLeaveRooms(e){zI(this.definition,"room.include_leave",e)}}M(zo,"LAZY_LOADING_MESSAGES_FILTER",{lazy_load_members:!0});function TC(t){return t!=null}var Jve=new Eo.UnstableValue("m.message","org.matrix.msc1767.message"),XO=new Eo.UnstableValue("m.text","org.matrix.msc1767.text"),Qve=new Eo.UnstableValue("m.html","org.matrix.msc1767.html"),mJ=new Eo.NamespacedValue("m.reference");function Zve(t,e){if(typeof t=="string")return typeof e=="string"?e===t:e.matches(t);if(typeof e=="string")return t.matches(e);var n=e,r=t;return n.matches(r.name)||TC(r.altName)&&n.matches(r.altName)}var JO=new uy("m.topic");function H$(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function eye(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?H$(Object(n),!0).forEach(function(r){M(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):H$(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function gJ(t,e){return{msgtype:Nl.Text,format:"org.matrix.custom.html",body:t,formatted_body:e}}function vJ(t,e){return{msgtype:Nl.Notice,format:"org.matrix.custom.html",body:t,formatted_body:e}}function yJ(t,e){return{msgtype:Nl.Emote,format:"org.matrix.custom.html",body:t,formatted_body:e}}function bJ(t){return{msgtype:Nl.Text,body:t}}function _J(t){return{msgtype:Nl.Notice,body:t}}function SJ(t){return{msgtype:Nl.Emote,body:t}}var wJ=(t,e,n,r)=>{var i="at ".concat(new Date(n).toISOString()),s=e===Tv.Self?"User":void 0,o=r?'"'.concat(r,'"'):void 0;return[s,"Location",o,t,i].filter(Boolean).join(" ")},EJ=(t,e,n,r,i)=>{var s=t??wJ(e,i||Tv.Self,n,r),o=n?{[oh.name]:n}:{};return eye({msgtype:Nl.Location,body:s,geo_uri:e,[M_.name]:{description:r,uri:e},[L_.name]:{type:i||Tv.Self},[XO.name]:s},o)},tye=t=>{var e,n,r=M_.findIn(t),i=L_.findIn(t),s=oh.findIn(t),o=XO.findIn(t),a=(e=r?.uri)!==null&&e!==void 0?e:t?.geo_uri,c=r?.description,l=(n=i?.type)!==null&&n!==void 0?n:Tv.Self,d=o??t.body;return EJ(d,a,s??void 0,c,l)},CJ=(t,e)=>{var n=[];return TC(e)&&n.push({body:e,mimetype:"text/html"}),TC(t)&&n.push({body:t,mimetype:"text/plain"}),{topic:t,[JO.name]:{"m.text":n}}},nye=t=>{var e,n,r,i,s=JO.findIn(t),o=Array.isArray(s)?s:s?.["m.text"];if(!Array.isArray(o)){var a;return{text:(a=t.topic)!==null&&a!==void 0?a:void 0}}var c=(e=(n=o==null||(r=o.find(d=>!TC(d.mimetype)||d.mimetype==="text/plain"))===null||r===void 0?void 0:r.body)!==null&&n!==void 0?n:t.topic)!==null&&e!==void 0?e:void 0,l=o==null||(i=o.find(d=>d.mimetype==="text/html"))===null||i===void 0?void 0:i.body;return{text:c,html:l}},rye=(t,e,n,r,i)=>({description:n,timeout:t,live:e,[oh.name]:i||Date.now(),[L_.name]:{type:r??Tv.Self}}),TJ=t=>{var e,{description:n,timeout:r,live:i}=t,s=(e=oh.findIn(t))!==null&&e!==void 0?e:void 0,o=L_.findIn(t);return{description:n,timeout:r,live:i,assetType:o?.type,timestamp:s}},iye=(t,e,n,r)=>({[M_.name]:{description:r,uri:t},[oh.name]:e,"m.relates_to":{rel_type:mJ.name,event_id:n}}),vA=t=>{var e,n=M_.findIn(t),r=(e=oh.findIn(t))!==null&&e!==void 0?e:void 0;return{description:n?.description,uri:n?.uri,timestamp:r}};const sye=Object.freeze(Object.defineProperty({__proto__:null,getTextForLocationEvent:wJ,makeBeaconContent:iye,makeBeaconInfoContent:rye,makeEmoteMessage:SJ,makeHtmlEmote:yJ,makeHtmlMessage:gJ,makeHtmlNotice:vJ,makeLocationContent:EJ,makeNotice:_J,makeTextMessage:bJ,makeTopicContent:CJ,parseBeaconContent:vA,parseBeaconInfoContent:TJ,parseLocationEvent:tye,parseTopicContent:nye},Symbol.toStringTag,{value:"Module"}));var Qn=(function(t){return t.New="Beacon.new",t.Update="Beacon.update",t.LivenessChange="Beacon.LivenessChange",t.Destroy="Beacon.Destroy",t.LocationUpdate="Beacon.LocationUpdate",t})({}),yA=(t,e,n)=>n>=t&&t+e>=n,RC=t=>"".concat(t.getRoomId(),"_").concat(t.getStateKey());class RJ extends Gn{constructor(e){super(),this.rootEvent=e,M(this,"roomId",void 0),M(this,"_beaconInfo",void 0),M(this,"_isLive",void 0),M(this,"livenessWatchTimeout",void 0),M(this,"_latestLocationEvent",void 0),M(this,"clearLatestLocation",()=>{this._latestLocationEvent=void 0,this.emit(Qn.LocationUpdate,this.latestLocationState)}),this.roomId=this.rootEvent.getRoomId(),this.setBeaconInfo(this.rootEvent)}get isLive(){return!!this._isLive}get identifier(){return RC(this.rootEvent)}get beaconInfoId(){return this.rootEvent.getId()}get beaconInfoOwner(){return this.rootEvent.getStateKey()}get beaconInfoEventType(){return this.rootEvent.getType()}get beaconInfo(){return this._beaconInfo}get latestLocationState(){return this._latestLocationEvent&&vA(this._latestLocationEvent.getContent())}get latestLocationEvent(){return this._latestLocationEvent}update(e){if(RC(e)!==this.identifier)throw new Error("Invalid updating event");e.getTs()<this.rootEvent.getTs()||(this.rootEvent=e,this.setBeaconInfo(this.rootEvent),this.emit(Qn.Update,e,this),this.clearLatestLocation())}destroy(){this.livenessWatchTimeout&&clearTimeout(this.livenessWatchTimeout),this._isLive=!1,this.emit(Qn.Destroy,this.identifier)}monitorLiveness(){if(this.livenessWatchTimeout&&clearTimeout(this.livenessWatchTimeout),this.checkLiveness(),!!this.beaconInfo)if(this.isLive){var e=this.beaconInfo.timestamp+this.beaconInfo.timeout-Date.now();e>1&&(this.livenessWatchTimeout=setTimeout(()=>{this.monitorLiveness()},e))}else this.beaconInfo.timestamp>Date.now()&&(this.livenessWatchTimeout=setTimeout(()=>{this.monitorLiveness()},this.beaconInfo.timestamp-Date.now()))}addLocations(e){var n;if(this.isLive){var r=e.filter(s=>{var o=s.getContent(),a=vA(o);if(!a.uri||!a.timestamp)return!1;var{timestamp:c}=a;return this._beaconInfo.timestamp&&yA(this._beaconInfo.timestamp,this._beaconInfo.timeout,c)&&(!this.latestLocationState||c>this.latestLocationState.timestamp)}),i=(n=r.sort(Rve))===null||n===void 0?void 0:n[0];i&&(this._latestLocationEvent=i,this.emit(Qn.LocationUpdate,this.latestLocationState))}}setBeaconInfo(e){this._beaconInfo=TJ(e.getContent()),this.checkLiveness()}checkLiveness(){var e=this.isLive;if(this.beaconInfo){var n=this.beaconInfo.timestamp>Date.now()?this.beaconInfo.timestamp-36e4:this.beaconInfo.timestamp;this._isLive=!!this._beaconInfo.live&&!!n&&yA(n,this._beaconInfo.timeout,Date.now()),e!==this.isLive&&this.emit(Qn.LivenessChange,this.isLive,this)}}}function q$(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function oye(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?q$(Object(n),!0).forEach(function(r){M(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):q$(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function kJ(t,e,n){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return new es({content:{[e.getId()]:{[n]:{[t]:oye({ts:e.getTs()},!r&&{thread_id:Mv(e)})}}},type:ee.Receipt,room_id:e.getRoomId()})}var ag=0,cg=1;class IJ extends Gn{constructor(){super(...arguments),M(this,"receipts",new Hu(()=>new Map)),M(this,"receiptCacheByEventId",new Map)}getReadReceiptForUserId(e){var n,r,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:xs.Read,[o,a]=(n=(r=this.receipts.get(s))===null||r===void 0?void 0:r.get(e))!==null&&n!==void 0?n:[null,null];return i?o:a??o}compareReceipts(e,n){var r;return(r=this.getUnfilteredTimelineSet().compareEventOrdering(e.eventId,n.eventId))!==null&&r!==void 0?r:e.data.ts-n.data.ts}getEventReadUpTo(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=this.getLatestReceipt(e,n);return r&&this.receiptPointsAtConsistentEvent(r)?r.eventId:null}receiptPointsAtConsistentEvent(e){var n,r=this.findEventById(e.eventId);if(!r)return!1;if(!((n=e.data)!==null&&n!==void 0&&n.thread_id))return!0;if(e.data.thread_id===O_){var i=Ub(r);if(i)return!0}else if(r.threadRootId===e.data.thread_id)return!0;return N.warn("Ignoring receipt because its thread_id (".concat(e.data.thread_id,") disagrees ")+"with the thread root (".concat(r.threadRootId,") of the referenced event ")+"(event ID = ".concat(e.eventId,")")),!1}getLatestReceipt(e,n){var r,i,s=this.getReadReceiptForUserId(e,n,xs.Read),o=this.getReadReceiptForUserId(e,n,xs.ReadPrivate),a;return s!=null&&s.eventId&&o!==null&&o!==void 0&&o.eventId&&(a=this.compareReceipts(s,o)),a?(i=a<0?o:s)!==null&&i!==void 0?i:null:(r=o??s)!==null&&r!==void 0?r:null}addReceiptToStructure(e,n,r,i,s){var o,a,c=this.receipts.getOrCreate(n),l=c.get(r);l||(l=[null,null],c.set(r,l));var d=l[ag];if(s){var h;d=(h=l[cg])!==null&&h!==void 0?h:l[ag]}var m={eventId:e,data:i};if(d){var g=this.compareReceipts(d,m);if(g>=0)return}var y=s?l[ag]:m,v=s?m:l[cg],E=null;y&&v&&(E=this.getUnfilteredTimelineSet().compareEventOrdering(y.eventId,v.eventId));var w=E===null||E<0,R=(o=l[cg])!==null&&o!==void 0?o:l[ag];s&&w?l[cg]=m:s||(l[ag]=m,w||(l[cg]=null));var x=(a=l[cg])!==null&&a!==void 0?a:l[ag];if(R!==x){if(R&&this.receiptCacheByEventId.get(R.eventId)){var C=R.eventId;this.receiptCacheByEventId.set(C,this.receiptCacheByEventId.get(C).filter(k=>k.type!==n||k.userId!==r)),this.receiptCacheByEventId.get(C).length<1&&this.receiptCacheByEventId.delete(C)}this.receiptCacheByEventId.get(e)||this.receiptCacheByEventId.set(e,[]),this.receiptCacheByEventId.get(e).push({userId:r,type:n,data:i})}}getReceiptsForEvent(e){return this.receiptCacheByEventId.get(e.getId())||[]}fixupNotifications(e){var n=this.getReadReceiptForUserId(e,!1),r=this.timeline[this.timeline.length-1];r&&n?.eventId===r.getId()&&e===r.getSender()&&(this.setUnread(sn.Total,0),this.setUnread(sn.Highlight,0))}addLocalEchoReceipt(e,n,r){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;this.addReceipt(kJ(e,n,r,i),!0)}getUsersReadUpTo(e){return this.getReceiptsForEvent(e).filter(function(n){return qO(n.type)}).map(function(n){return n.userId})}}var aye=new Eo.UnstableValue("m.poll.disclosed","org.matrix.msc3381.poll.disclosed"),cye=new Eo.UnstableValue("m.poll.undisclosed","org.matrix.msc3381.poll.undisclosed"),lye=new Eo.UnstableValue("m.poll.start","org.matrix.msc3381.poll.start"),Ib=new Eo.UnstableValue("m.poll.response","org.matrix.msc3381.poll.response"),kC=new Eo.UnstableValue("m.poll.end","org.matrix.msc3381.poll.end"),cf=(function(t){return t.New="Poll.new",t.End="Poll.end",t.Update="Poll.update",t.Responses="Poll.Responses",t.Destroy="Poll.Destroy",t.UndecryptableRelations="Poll.UndecryptableRelations",t})({}),V$=(t,e)=>{var n=t.filter(r=>{if(!r.isDecryptionFailure())return Ib.matches(r.getType())&&r.getTs()<=e});return{responseEvents:n}};class xJ extends Gn{constructor(e,n,r){if(super(),this.rootEvent=e,this.matrixClient=n,this.room=r,M(this,"roomId",void 0),M(this,"pollEvent",void 0),M(this,"_isFetchingResponses",!1),M(this,"relationsNextBatch",void 0),M(this,"responses",null),M(this,"endEvent",void 0),M(this,"undecryptableRelationEventIds",new Set),M(this,"countUndecryptableEvents",i=>{var s=i.filter(a=>a.isDecryptionFailure()).map(a=>a.getId()),o=this.undecryptableRelationsCount;this.undecryptableRelationEventIds=new Set([...this.undecryptableRelationEventIds,...s]),this.undecryptableRelationsCount!==o&&this.emit(cf.UndecryptableRelations,this.undecryptableRelationsCount)}),!this.rootEvent.getRoomId()||!this.rootEvent.getId())throw new Error("Invalid poll start event.");this.roomId=this.rootEvent.getRoomId(),this.pollEvent=this.rootEvent.unstableExtensibleEvent}get pollId(){return this.rootEvent.getId()}get endEventId(){var e;return(e=this.endEvent)===null||e===void 0?void 0:e.getId()}get isEnded(){return!!this.endEvent}get isFetchingResponses(){return this._isFetchingResponses}get undecryptableRelationsCount(){return this.undecryptableRelationEventIds.size}getResponses(){var e=this;return B(function*(){return e.responses||e.isFetchingResponses||(yield e.fetchResponses()),e.responses})()}onNewRelation(e){var n;if(kC.matches(e.getType())&&this.validateEndEvent(e)&&(this.endEvent=e,this.refilterResponsesOnEnd(),this.emit(cf.End)),!!this.responses){var r=((n=this.endEvent)===null||n===void 0?void 0:n.getTs())||Number.MAX_SAFE_INTEGER,{responseEvents:i}=V$([e],r);this.countUndecryptableEvents([e]),i.length&&(i.forEach(s=>{this.responses.addEvent(s)}),this.emit(cf.Responses,this.responses))}}fetchResponses(){var e=this;return B(function*(){var n,r;e._isFetchingResponses=!0;var i=yield e.matrixClient.relations(e.roomId,e.rootEvent.getId(),"m.reference",void 0,{from:e.relationsNextBatch||void 0});yield Promise.all(i.events.map(l=>e.matrixClient.decryptEventIfNeeded(l)));var s=e.responses||new YO("m.reference",Ib.name,e.matrixClient,[Ib.altName]),o=i.events.find(l=>kC.matches(l.getType()));e.validateEndEvent(o)&&(e.endEvent=o,e.refilterResponsesOnEnd(),e.emit(cf.End));var a=((n=e.endEvent)===null||n===void 0?void 0:n.getTs())||Number.MAX_SAFE_INTEGER,{responseEvents:c}=V$(i.events,a);c.forEach(l=>{s.addEvent(l)}),e.relationsNextBatch=(r=i.nextBatch)!==null&&r!==void 0?r:void 0,e.responses=s,e.countUndecryptableEvents(i.events),e.relationsNextBatch?e.fetchResponses():e._isFetchingResponses=!1,e.emit(cf.Responses,e.responses)})()}refilterResponsesOnEnd(){var e;if(this.responses){var n=((e=this.endEvent)===null||e===void 0?void 0:e.getTs())||Number.MAX_SAFE_INTEGER;this.responses.getRelations().forEach(r=>{if(r.getTs()>n){var i;(i=this.responses)===null||i===void 0||i.removeEvent(r)}}),this.emit(cf.Responses,this.responses)}}validateEndEvent(e){if(!e||this.endEvent&&this.endEvent.getTs()<e.getTs())return!1;var n=this.room.currentState,r=e.getSender();return!!r&&(r===this.rootEvent.getSender()||n.maySendRedactionForEvent(this.rootEvent,r))}}var AJ=t=>{var e=t.getType();return Eo.M_POLL_START.matches(e)||Ib.matches(e)||kC.matches(e)};class uye{constructor(e){M(this,"room",void 0),M(this,"threadedReceipts",void 0),M(this,"unthreadedReceipts",void 0),M(this,"danglingReceipts",void 0),M(this,"onTimelineEvent",n=>{var r=n.getId();if(r){var i=this.danglingReceipts.remove(r);i?.forEach(s=>{s.receipt.thread_id?this.threadedReceipts.set(s.receipt.thread_id,s.eventId,s.receiptType,s.userId,s.receipt.ts,s.synthetic):this.unthreadedReceipts.set(r,s.receiptType,s.userId,s.receipt.ts,s.synthetic)})}}),this.room=e,this.threadedReceipts=new pye(e),this.unthreadedReceipts=new LJ(e),this.danglingReceipts=new mye,e.on(Me.Timeline,this.onTimelineEvent)}add(e,n){for(var[r,i]of Object.entries(e))for(var[s,o]of Object.entries(i))for(var[a,c]of Object.entries(o)){var l=this.room.findEventById(r);l?c.thread_id?this.threadedReceipts.set(c.thread_id,r,s,a,c.ts,n):this.unthreadedReceipts.set(r,s,a,c.ts,n):this.danglingReceipts.add(new fye(r,s,a,c,n))}}hasUserReadEvent(e,n){var r=this.unthreadedReceipts.get(e);if(r&&bA(r.eventId,n,this.room))return!0;var i=this.room.findEventById(n);if(!i)return N.warn("hasUserReadEvent event ID ".concat(n," not found in room ").concat(this.room.roomId,": this shouldn't happen!")),!1;var s=Mv(i),o=this.threadedReceipts.get(s,e);return!!(o&&bA(o.eventId,n,this.room)||this.userSentLatestEventInThread(s,e))}userSentLatestEventInThread(e,n){var r,i=e===O_?this.room.getLiveTimeline().getEvents():(r=this.room.getThread(e))===null||r===void 0?void 0:r.timeline;return!!(i&&i.length>0&&i[i.length-1].getSender()===n)}}class dye{constructor(e,n,r){this.eventId=e,this.receiptType=n,this.ts=r}}class fye{constructor(e,n,r,i,s){this.eventId=e,this.receiptType=n,this.userId=r,this.receipt=i,this.synthetic=s}}class hye{constructor(e){M(this,"room",void 0),M(this,"real",void 0),M(this,"synthetic",void 0),this.room=e,this.real=void 0,this.synthetic=void 0}set(e,n){e?this.synthetic=n:this.real=n,this.synthetic&&this.real&&bA(this.real.eventId,this.synthetic.eventId,this.room)&&(this.synthetic=void 0)}get(){var e;return(e=this.synthetic)!==null&&e!==void 0?e:this.real}getByType(e){return e?this.synthetic:this.real}}class LJ{constructor(e){M(this,"room",void 0),M(this,"data",void 0),this.room=e,this.data=new Map}set(e,n,r,i,s){var o=QO(this.data,r,()=>new hye(this.room)),a=o.getByType(s);a&&gye(a.eventId,e,this.room)||o.set(s,new dye(e,n,i))}get(e){var n;return(n=this.data.get(e))===null||n===void 0?void 0:n.get()}}class pye{constructor(e){M(this,"room",void 0),M(this,"data",void 0),this.room=e,this.data=new Map}set(e,n,r,i,s,o){var a=QO(this.data,e,()=>new LJ(this.room));a.set(n,r,i,s,o)}get(e,n){var r;return(r=this.data.get(e))===null||r===void 0?void 0:r.get(n)}}class mye{constructor(){M(this,"data",new Map)}add(e){var n=QO(this.data,e.eventId,()=>[]);n.push(e)}remove(e){var n=this.data.get(e);return this.data.delete(e),n}}function QO(t,e,n){var r=t.get(e);if(r)return r;var i=n();return t.set(e,i),i}function bA(t,e,n){var r=n.compareEventOrdering(t,e);return r!==null&&r>=0}function gye(t,e,n){var r=n.compareEventOrdering(t,e);return r!==null&&r>0}function vye(t,e,n){var r=t.findEventById(e),i=t.findEventById(n);if(!r||!i)return null;var s=Ub(r),o=Ub(i);return s&&o?yye(t,e,n,r,i):bye(e,n,r,i)}function yye(t,e,n,r,i){var s=t.getUnfilteredTimelineSet(),o=s.compareEventOrdering(e,n);if(o!==null)return o;var a=s.getTimelineForEvent(e);if(a===s.getLiveTimeline())return 1;var c=s.getTimelineForEvent(n);return c===s.getLiveTimeline()?-1:MJ(r,i)}function bye(t,e,n,r){var i=Mv(n),s=Mv(r),o=n.getThread();return o&&i===s?o.timelineSet.compareEventOrdering(t,e):MJ(n,r)}function MJ(t,e){var n=t.getTs(),r=e.getTs();return n<r?-1:n>r?1:0}var fe=(function(t){return t.Get="GET",t.Put="PUT",t.Post="POST",t.Delete="DELETE",t.Options="OPTIONS",t.Head="HEAD",t.Patch="PATCH",t})({});function K$(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function _ye(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?K$(Object(n),!0).forEach(function(r){M(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):K$(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}class xp extends Error{constructor(e,n,r){super(e),this.httpStatus=n,this.httpHeaders=r}isRateLimitError(){return this.httpStatus===429}getRetryAfterMs(){var e,n=(e=this.httpHeaders)===null||e===void 0?void 0:e.get("Retry-After");if(n!=null){if(/^\d+$/.test(n)){var r=Number.parseInt(n)*1e3;if(!Number.isFinite(r))throw new Error("Retry-After header integer value is too large");return r}var i=new Date(n);if(i.toUTCString()!==n)throw new Error("Retry-After header value is not a valid HTTP-date or non-negative decimal integer");return i.getTime()-Date.now()}return null}}class In extends xp{constructor(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,o=e.error||"Unknown message";n&&(o="[".concat(n,"] ").concat(o)),r&&(o="".concat(o," (").concat(r,")")),super("MatrixError: ".concat(o),n,s),this.url=r,this.event=i,M(this,"errcode",void 0),M(this,"error",void 0),M(this,"data",void 0),this.errcode=e.errcode,this.error=e.error,this.name=e.errcode||"Unknown error code",this.data=e}isRateLimitError(){return this.errcode==="M_LIMIT_EXCEEDED"||(this.errcode==="M_UNKNOWN"||this.errcode===void 0)&&super.isRateLimitError()}getRetryAfterMs(){var e=super.getRetryAfterMs();if(e!==null)return e;if(this.errcode==="M_LIMIT_EXCEEDED"&&"retry_after_ms"in this.data){if(!Number.isInteger(this.data.retry_after_ms))throw new Error("retry_after_ms is not an integer");return this.data.retry_after_ms}return null}asWidgetApiErrorData(){var e,n,r,i,s={};if(this.httpHeaders)for(var[o,a]of this.httpHeaders)s[o]=a;return{http_status:(e=this.httpStatus)!==null&&e!==void 0?e:400,http_headers:s,url:(n=this.url)!==null&&n!==void 0?n:"",response:_ye({errcode:(r=this.errcode)!==null&&r!==void 0?r:"M_UNKNOWN",error:(i=this.data.error)!==null&&i!==void 0?i:"Unknown message"},this.data)}}static fromWidgetApiErrorData(e){return new In(e.response,e.http_status,e.url,void 0,new Headers(e.http_headers))}}function ZO(t,e){if(!(t instanceof xp)||!t.isRateLimitError())return e;try{var n;return(n=t.getRetryAfterMs())!==null&&n!==void 0?n:e}catch{return e}}let Qp=class extends Error{constructor(e,n){super(e+(n?": ".concat(n.message):""))}get name(){return"ConnectionError"}};class OJ extends Error{constructor(e){var n;super((n=e?.message)!==null&&n!==void 0?n:"")}get name(){return"TokenRefreshError"}}class eP extends Error{constructor(e){var n;super((n=e?.message)!==null&&n!==void 0?n:"")}get name(){return"TokenRefreshLogoutError"}}var PJ=new uy(null,"ORG.MATRIX.MSC4387_SAFETY");class DJ extends In{constructor(){super(...arguments),M(this,"harms",void 0),M(this,"expiry",void 0);var e=arguments.length<=0?void 0:arguments[0];this.harms=new Set(e&&"harms"in e&&Array.isArray(e.harms)?e.harms:[]),this.message="".concat(super.message," (").concat([...this.harms].join(", "),")"),e&&"expiry"in e&&typeof e.expiry=="number"&&(this.expiry=new Date(e.expiry))}}var _A=(function(t){return t.SessionLoggedOut="Session.logged_out",t.NoConsent="no_consent",t})({}),X2={};var G$;function Sye(){if(G$)return X2;G$=1;var t=/; *([!#$%&'*+.^_`|~0-9A-Za-z-]+) *= *("(?:[\u000b\u0020\u0021\u0023-\u005b\u005d-\u007e\u0080-\u00ff]|\\[\u000b\u0020-\u00ff])*"|[!#$%&'*+.^_`|~0-9A-Za-z-]+) */g,e=/^[\u000b\u0020-\u007e\u0080-\u00ff]+$/,n=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+$/,r=/\\([\u000b\u0020-\u00ff])/g,i=/([\\"])/g,s=/^[!#$%&'*+.^_`|~0-9A-Za-z-]+\/[!#$%&'*+.^_`|~0-9A-Za-z-]+$/;X2.format=o,X2.parse=a;function o(h){if(!h||typeof h!="object")throw new TypeError("argument obj is required");var m=h.parameters,g=h.type;if(!g||!s.test(g))throw new TypeError("invalid type");var y=g;if(m&&typeof m=="object")for(var v,E=Object.keys(m).sort(),w=0;w<E.length;w++){if(v=E[w],!n.test(v))throw new TypeError("invalid parameter name");y+="; "+v+"="+l(m[v])}return y}function a(h){if(!h)throw new TypeError("argument string is required");var m=typeof h=="object"?c(h):h;if(typeof m!="string")throw new TypeError("argument string is required to be a string");var g=m.indexOf(";"),y=g!==-1?m.slice(0,g).trim():m.trim();if(!s.test(y))throw new TypeError("invalid media type");var v=new d(y.toLowerCase());if(g!==-1){var E,w,R;for(t.lastIndex=g;w=t.exec(m);){if(w.index!==g)throw new TypeError("invalid parameter format");g+=w[0].length,E=w[1].toLowerCase(),R=w[2],R.charCodeAt(0)===34&&(R=R.slice(1,-1),R.indexOf("\\")!==-1&&(R=R.replace(r,"$1"))),v.parameters[E]=R}if(g!==m.length)throw new TypeError("invalid parameter format")}return v}function c(h){var m;if(typeof h.getHeader=="function"?m=h.getHeader("content-type"):typeof h.headers=="object"&&(m=h.headers&&h.headers["content-type"]),typeof m!="string")throw new TypeError("content-type header is missing from object");return m}function l(h){var m=String(h);if(n.test(m))return m;if(m.length>0&&!e.test(m))throw new TypeError("invalid parameter value");return'"'+m.replace(i,"\\$1")+'"'}function d(h){this.parameters=Object.create(null),this.type=h}return X2}var wye=Sye();function bT(t){var e=new AbortController;return setTimeout(()=>{e.abort()},t),e.signal}function NJ(t){var e=new AbortController;function n(){for(var s of t)s.removeEventListener("abort",r)}function r(){e.abort(),n()}for(var i of t){if(i.aborted){r();break}i.addEventListener("abort",r)}return{signal:e.signal,cleanup:n}}function tP(t,e){var n,r,i=WI(t)?new Headers(t.getAllResponseHeaders().trim().split(/[\r\n]+/).map(a=>{var c=a.indexOf(":");return[a.substring(0,c),a.substring(c+1)]})):t.headers,s;try{s=Eye(i)}catch(a){return a}if(((n=s)===null||n===void 0?void 0:n.type)==="application/json"&&e){var o=JSON.parse(e);return o.errcode&&PJ.matches(o.errcode)?new DJ(o,t.status,WI(t)?t.responseURL:t.url,void 0,i):new In(o,t.status,WI(t)?t.responseURL:t.url,void 0,i)}return((r=s)===null||r===void 0?void 0:r.type)==="text/plain"?new xp("Server returned ".concat(t.status," error: ").concat(e),t.status,i):new xp("Server returned ".concat(t.status," error"),t.status,i)}function WI(t){return"getResponseHeader"in t}function Eye(t){var e=t.get("Content-Type");if(e===null)return null;try{return wye.parse(e)}catch(n){throw new Error("Error parsing Content-Type '".concat(e,"': ").concat(n))}}function xb(t,e){return SA.apply(this,arguments)}function SA(){return SA=B(function*(t,e){for(var n=0,r=null;n<t;)try{if(n>0){var i=1e3*Math.pow(2,n);N.log("network operation failed ".concat(n," times, retrying in ").concat(i,"ms...")),yield Yp(i)}return yield e()}catch(s){if(s instanceof Qp)n+=1,r=s;else throw s}throw r}),SA.apply(this,arguments)}function nP(t,e,n){return e>4||t instanceof Qp&&!n||t.httpStatus&&Math.floor(t.httpStatus/100)===4&&t.httpStatus!==429||t.name==="AbortError"||t.name==="M_TOO_LARGE"?-1:ZO(t,1e3*Math.pow(2,e))}var lf=(function(t){return t.Success="success",t.Failure="failure",t.Logout="logout",t})({}),Cye=500,Tye=60*1e3;class Rye{constructor(e){this.opts=e,M(this,"tokenRefreshPromise",void 0),M(this,"latestTokenRefreshExpiry",void 0)}prepareForRequest(){var e=this;return B(function*(){return yield e.refreshIfNeeded(),{accessToken:e.opts.accessToken,refreshToken:e.opts.refreshToken,expiry:e.latestTokenRefreshExpiry}})()}refreshIfNeeded(){var e=this;return B(function*(){if(e.tokenRefreshPromise)return e.tokenRefreshPromise;if(e.latestTokenRefreshExpiry){var n=e.latestTokenRefreshExpiry.getTime()-Date.now();n<=Cye&&(yield e._handleUnknownToken())}})()}handleUnknownToken(e,n){var r=this;return B(function*(){return r._handleUnknownToken(e,n)})()}_handleUnknownToken(e,n){var r=this;return B(function*(){if(e!=null&&e.expiry){var i=e.expiry.getTime()-Date.now();if(i>=Tye)return lf.Logout}if(!e||e?.accessToken===r.opts.accessToken){var s;(s=r.tokenRefreshPromise)!==null&&s!==void 0||(r.tokenRefreshPromise=r.doTokenRefresh(n));try{return yield r.tokenRefreshPromise}finally{r.tokenRefreshPromise=void 0}}return lf.Success})()}doTokenRefresh(e){var n=this;return B(function*(){if(!n.opts.refreshToken||!n.opts.tokenRefreshFunction){var r;return(r=n.opts.logger)===null||r===void 0||r.error("Unable to refresh token - no refresh token or refresh function"),lf.Logout}e&&e>1&&(yield Yp(1e3*Math.min(32,2**e)));try{var i,s;(i=n.opts.logger)===null||i===void 0||i.debug("Attempting to refresh token");var{accessToken:o,refreshToken:a,expiry:c}=yield n.opts.tokenRefreshFunction(n.opts.refreshToken);return n.opts.accessToken=o,n.opts.refreshToken=a,n.latestTokenRefreshExpiry=c,(s=n.opts.logger)===null||s===void 0||s.debug("... token refresh complete, new token expiry:",c),lf.Success}catch(h){var l;if(h instanceof eP||h instanceof In){var d;return(d=n.opts.logger)===null||d===void 0||d.error("Failed to refresh token",h),lf.Logout}return(l=n.opts.logger)===null||l===void 0||l.warn("Failed to refresh token",h),lf.Failure}})()}}function z$(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function W$(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?z$(Object(n),!0).forEach(function(r){M(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):z$(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}class kye{constructor(e,n){var r;if(this.eventEmitter=e,this.opts=n,M(this,"abortController",new AbortController),M(this,"tokenRefresher",void 0),VX(n,["baseUrl","prefix"]),!n.onlyData)throw new Error("Constructing FetchHttpApi without `onlyData=true` is no longer supported.");n.useAuthorizationHeader=(r=n.useAuthorizationHeader)!==null&&r!==void 0?r:!0,this.tokenRefresher=new Rye(n)}abort(){this.abortController.abort(),this.abortController=new AbortController}fetch(e,n){return this.opts.fetchFn?this.opts.fetchFn(e,n):globalThis.fetch(e,n)}setIdBaseUrl(e){this.opts.idBaseUrl=e}idServerRequest(e,n,r,i,s){if(!this.opts.idBaseUrl)throw new Error("No identity server base URL set");var o=void 0,a=void 0;e===fe.Get?o=r:a=r;var c=this.getUrl(n,o,i,this.opts.idBaseUrl),l={json:!0,headers:{}};return s&&(l.headers.Authorization="Bearer ".concat(s)),this.requestOtherUrl(e,c,a,l)}authedRequest(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};return this.doAuthedRequest(1,e,n,r,i,s)}doAuthedRequest(e,n,r,i,s){var o=arguments,a=this;return B(function*(){var c=o.length>5&&o[5]!==void 0?o[5]:{},l=P_(c);l.abortSignal=c.abortSignal;var d=yield a.tokenRefresher.prepareForRequest();d.accessToken&&(a.opts.useAuthorizationHeader?(l.headers||(l.headers={}),l.headers.Authorization||(l.headers.Authorization="Bearer ".concat(d.accessToken)),i.access_token&&delete i.access_token):i.access_token||(i.access_token=d.accessToken));try{var h=yield a.request(n,r,i,s,l);return h}catch(g){if(!(g instanceof In))throw g;if(g.errcode==="M_UNKNOWN_TOKEN"){var m=yield a.tokenRefresher.handleUnknownToken(d,e);if(m===lf.Success)return a.doAuthedRequest(e+1,n,r,i,s,c);if(m===lf.Failure)throw new OJ(g);l!=null&&l.inhibitLogoutEmit||a.eventEmitter.emit(_A.SessionLoggedOut,g)}else g.errcode=="M_CONSENT_NOT_GIVEN"&&a.eventEmitter.emit(_A.NoConsent,g.message,g.data.consent_uri);throw g}})()}request(e,n,r,i,s){var o=this.getUrl(n,r,s?.prefix,s?.baseUrl);return this.requestOtherUrl(e,o,i,s)}requestOtherUrl(e,n,r){var i=arguments,s=this;return B(function*(){var o,a,c,l,d=i.length>3&&i[3]!==void 0?i[3]:{};if(d.json!==void 0&&d.rawResponseBody!==void 0)throw new Error("Invalid call to `FetchHttpApi` sets both `opts.json` and `opts.rawResponseBody`");var h=s.sanitizeUrlForLogs(n);(o=s.opts.logger)===null||o===void 0||o.debug("FetchHttpApi: --> ".concat(e," ").concat(h));var m=Object.assign({},d.headers||{}),g=!d.rawResponseBody&&d.json!==!1;g&&(m.Accept||(m.Accept="application/json"));var y=(a=d.localTimeoutMs)!==null&&a!==void 0?a:s.opts.localTimeoutMs,v=(c=d.keepAlive)!==null&&c!==void 0?c:!1,E=[s.abortController.signal];y!==void 0&&E.push(bT(y)),d.abortSignal&&E.push(d.abortSignal);var w;d.json!==!1&&(r==null||(l=r.constructor)===null||l===void 0?void 0:l.name)===Object.name?(w=JSON.stringify(r),m["Content-Type"]||(m["Content-Type"]="application/json")):w=r;var{signal:R,cleanup:x}=NJ(E),C="Authorization"in m?void 0:"no-cache",k,T=Date.now();try{var L;k=yield s.fetch(n,{signal:R,method:e,body:w,headers:m,mode:"cors",redirect:"follow",referrer:"",referrerPolicy:"no-referrer",cache:C,credentials:"omit",keepalive:v,priority:d.priority}),(L=s.opts.logger)===null||L===void 0||L.debug("FetchHttpApi: <-- ".concat(e," ").concat(h," [").concat(Date.now()-T,"ms ").concat(k.status,"]"))}catch(P){var O;throw(O=s.opts.logger)===null||O===void 0||O.debug("FetchHttpApi: <-- ".concat(e," ").concat(h," [").concat(Date.now()-T,"ms ").concat(P,"]")),P.name==="AbortError"?P:new Qp("fetch failed",P)}finally{x()}if(!k.ok)throw tP(k,yield k.text());return d.rawResponseBody?yield k.blob():g?yield k.json():yield k.text()})()}sanitizeUrlForLogs(e){try{var n;typeof e=="string"?n=new URL(e):n=e;var r=new URLSearchParams;for(var i of n.searchParams.keys())r.append(i,"xxx");var s=r.toString(),o=s?"?".concat(s):"";return n.origin+n.pathname+o}catch{return"??"}}getUrl(e,n,r,i){var s=i??this.opts.baseUrl,o=s.endsWith("/")?s.slice(0,-1):s,a=new URL(o+(r??this.opts.prefix)+e);if(this.opts.extraParams||n){var c=W$(W$({},this.opts.extraParams),n);oA(c,a.searchParams)}return a}}var fr=(function(t){return t.V1="/_matrix/client/v1",t.V3="/_matrix/client/v3",t.Unstable="/_matrix/client/unstable",t})({}),hu=(function(t){return t.V2="/_matrix/identity/v2",t})({}),Xg=(function(t){return t.V1="/_matrix/media/v1",t.V3="/_matrix/media/v3",t})({}),Iye=1e3,xye=0,YI,ju=[],Aye=function(){};function Y$(t,e){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];e=e||0,e<0&&(e=0);var s=Date.now()+e,o=xye++,a={runAt:s,func:t,params:r,key:o},c=Mye(ju,function(l){return l.runAt-s});return ju.splice(c,0,a),rP(),o}function X$(t){if(ju.length!==0){var e;for(e=0;e<ju.length;e++){var n=ju[e];if(n.key==t){ju.splice(e,1);break}}e===0&&rP()}}function rP(){YI&&globalThis.clearTimeout(YI);var t=ju[0];if(t){var e=Date.now(),n=Math.min(t.runAt-e,Iye);YI=globalThis.setTimeout(Lye,n)}}function Lye(){for(var t=Date.now(),e=[];;){var n=ju[0];if(!n||n.runAt>t)break;var r=ju.shift();Aye("runCallbacks: popping",r.key),e.push(r)}rP();for(var i of e)try{i.func.apply(globalThis,i.params)}catch(s){N.error("Uncaught exception in callback function",s)}}function Mye(t,e){for(var n=0,r=t.length;n<r;){var i=n+r>>1,s=e(t[i]);s>0?r=i:n=i+1}return n}class UJ extends kye{constructor(){super(...arguments),M(this,"uploads",[])}uploadContent(e){var n,r,i,s,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=(n=o.includeFilename)!==null&&n!==void 0?n:!0,c=(r=o.abortController)!==null&&r!==void 0?r:new AbortController,l=((i=o.type)!==null&&i!==void 0?i:e.type)||"application/octet-stream",d=(s=o.name)!==null&&s!==void 0?s:e.name,h={loaded:0,total:0,abortController:c},m=Promise.withResolvers();if(globalThis.XMLHttpRequest){var g=new globalThis.XMLHttpRequest,y=function(){g.abort(),m.reject(new Error("Timeout"))},v=Y$(y,3e4);g.onreadystatechange=function(){switch(g.readyState){case globalThis.XMLHttpRequest.DONE:X$(v);try{if(g.status===0)throw new DOMException(g.statusText,"AbortError");if(!g.responseText)throw new Error("No response body.");g.status>=400?m.reject(tP(g,g.responseText)):m.resolve(JSON.parse(g.responseText))}catch(x){if(x.name==="AbortError"){m.reject(x);return}m.reject(new Qp("request failed",x))}break}},g.upload.onprogress=x=>{var C;X$(v),h.loaded=x.loaded,h.total=x.total,v=Y$(y,3e4),(C=o.progressHandler)===null||C===void 0||C.call(o,{loaded:x.loaded,total:x.total})};var E=this.getUrl("/upload",void 0,Xg.V3);a&&d&&E.searchParams.set("filename",encodeURIComponent(d)),!this.opts.useAuthorizationHeader&&this.opts.accessToken&&E.searchParams.set("access_token",encodeURIComponent(this.opts.accessToken)),g.open(fe.Post,E.href),this.opts.useAuthorizationHeader&&this.opts.accessToken&&g.setRequestHeader("Authorization","Bearer "+this.opts.accessToken),g.setRequestHeader("Content-Type",l),g.send(e),c.signal.addEventListener("abort",()=>{g.abort()})}else{var w={};a&&d&&(w.filename=d);var R={"Content-Type":l};this.authedRequest(fe.Post,"/upload",w,e,{prefix:Xg.V3,headers:R,abortSignal:c.signal}).then(m.resolve,m.reject)}return h.promise=m.promise.finally(()=>{bC(this.uploads,x=>x===h)}),c.signal.addEventListener("abort",()=>{bC(this.uploads,x=>x===h),m.reject(new DOMException("Aborted","AbortError"))}),this.uploads.push(h),h.promise}cancelUpload(e){var n=this.uploads.find(r=>r.promise===e);return n?(n.abortController.abort(),!0):!1}getCurrentUploads(){return this.uploads}getContentUri(){return{base:this.opts.baseUrl,path:Xg.V3+"/upload",params:{access_token:this.opts.accessToken}}}}var Oye=360*60*1e3,Pye=30*1e3,jJ=(function(t){return t.Stable="stable",t.Unstable="unstable",t})({});class FJ{constructor(e,n){var r=this;this.logger=e,this.http=n,M(this,"capabilities",void 0),M(this,"retryTimeout",void 0),M(this,"refreshTimeout",void 0),M(this,"fetchCapabilities",B(function*(){var i=yield r.http.authedRequest(fe.Get,"/capabilities");return r.capabilities=i.capabilities,r.capabilities})),M(this,"poll",B(function*(){try{yield r.fetchCapabilities(),r.clearTimeouts(),r.refreshTimeout=setTimeout(r.poll,Oye),r.logger.debug("Fetched new server capabilities")}catch(s){r.clearTimeouts();var i=Math.floor(Pye+Math.random()*5e3);r.retryTimeout=setTimeout(r.poll,i),r.logger.warn("Failed to refresh capabilities: retrying in ".concat(i,"ms"),s)}}))}start(){this.poll().then()}stop(){this.clearTimeouts()}getCachedCapabilities(){return this.capabilities}clearTimeouts(){this.refreshTimeout&&(clearInterval(this.refreshTimeout),this.refreshTimeout=void 0),this.retryTimeout&&(clearTimeout(this.retryTimeout),this.retryTimeout=void 0)}}var K0=N.getChild("RoomStickyEvents"),mf=(function(t){return t.Update="RoomStickyEvents.Update",t})({});function XI(t){if(typeof t!="string")throw new Error("Not a string");if(!t.startsWith("@"))throw new Error("Not a userId")}class cp extends Gn{constructor(){super(...arguments),M(this,"stickyEventsMap",new Map),M(this,"unkeyedStickyEvents",new Set),M(this,"stickyEventTimer",void 0),M(this,"nextStickyEventExpiryTs",Number.MAX_SAFE_INTEGER),M(this,"cleanExpiredStickyEvents",()=>{var e=Date.now(),n=[];this.nextStickyEventExpiryTs=Number.MAX_SAFE_INTEGER;for(var[r,i]of this.stickyEventsMap.entries()){var s;for(var[o,[a,...c]]of i)e>=a.unstableStickyExpiresAt?(K0.debug("Expiring sticky event",a.getId()),n.push(a),this.stickyEventsMap.get(r).delete(o)):(this.stickyEventsMap.get(r).set(o,[a,...c.filter(d=>d.unstableStickyExpiresAt<=e)]),this.nextStickyEventExpiryTs=Math.min(this.nextStickyEventExpiryTs,a.unstableStickyExpiresAt));((s=this.stickyEventsMap.get(r))===null||s===void 0?void 0:s.size)===0&&this.stickyEventsMap.delete(r)}for(var l of this.unkeyedStickyEvents)e>=l.unstableStickyExpiresAt?(K0.debug("Expiring sticky event",l.getId()),this.unkeyedStickyEvents.delete(l),n.push(l)):this.nextStickyEventExpiryTs=Math.min(this.nextStickyEventExpiryTs,l.unstableStickyExpiresAt);n.length&&this.emit(mf.Update,[],[],n),this.scheduleStickyTimer()})}static sortStickyEvent(e,n){var r,i;if(n.getTs()!==e.getTs())return n.getTs()-e.getTs();if(((r=n.getId())!==null&&r!==void 0?r:"")>((i=e.getId())!==null&&i!==void 0?i:""))return 1;throw Error("Comparing two sticky events with the same event ID is not allowed.")}static stickyMapKey(e,n){return"".concat(e).concat(n)}*getStickyEvents(){yield*this.unkeyedStickyEvents;for(var e of this.stickyEventsMap.values())for(var n of e.values())yield n[0]}getKeyedStickyEvent(e,n,r){var i;return XI(e),(i=this.stickyEventsMap.get(n))===null||i===void 0||(i=i.get(cp.stickyMapKey(r,e)))===null||i===void 0?void 0:i[0]}getUnkeyedStickyEvent(e,n){return[...this.unkeyedStickyEvents].filter(r=>r.getType()===n&&r.getSender()===e)}addStickyEvent(e){var n,r,i,s=e.getContent().msc4354_sticky_key;if(typeof s!="string"&&s!==void 0)throw new Error("".concat(e.getId()," is missing msc4354_sticky_key"));if(e.unstableStickyExpiresAt===void 0)throw new Error("".concat(e.getId()," is missing msc4354_sticky.duration_ms"));var o=e.getSender(),a=e.getType();if(XI(o),e.unstableStickyExpiresAt<=Date.now())return K0.info("ignored sticky event with older expiration time than current time",s),{added:!1};if(!o.startsWith("@"))throw new Error("Expected sender to start with @");var c=e;if(s===void 0)return this.unkeyedStickyEvents.add(c),this.nextStickyEventExpiryTs=Math.min(e.unstableStickyExpiresAt,this.nextStickyEventExpiryTs),this.scheduleStickyTimer(),{added:!0};var l=cp.stickyMapKey(s,o),d=[c,...(n=(r=this.stickyEventsMap.get(a))===null||r===void 0?void 0:r.get(l))!==null&&n!==void 0?n:[]].sort(cp.sortStickyEvent);return this.stickyEventsMap.has(a)||this.stickyEventsMap.set(a,new Map),(i=this.stickyEventsMap.get(a))===null||i===void 0||i.set(l,d),this.nextStickyEventExpiryTs=Math.min(c.unstableStickyExpiresAt,this.nextStickyEventExpiryTs),this.scheduleStickyTimer(),{added:d[0]===c,prevEvent:d?.[1]}}addStickyEvents(e){var n=[],r=[];for(var i of e)try{var s=this.addStickyEvent(i);s.added&&(s.prevEvent?r.push({current:i,previous:s.prevEvent}):n.push(i))}catch(o){K0.warn("ignored invalid sticky event",o)}(n.length||r.length)&&this.emit(mf.Update,n,r,[]),this.scheduleStickyTimer()}scheduleStickyTimer(){this.stickyEventTimer&&(clearTimeout(this.stickyEventTimer),this.stickyEventTimer=void 0),this.nextStickyEventExpiryTs!==Number.MAX_SAFE_INTEGER&&(this.stickyEventTimer=setTimeout(this.cleanExpiredStickyEvents,this.nextStickyEventExpiryTs-Date.now()))}handleRedaction(e){var n=typeof e=="string"?e:e.getId();for(var r of this.unkeyedStickyEvents)if(r.getId()===n){this.unkeyedStickyEvents.delete(r),this.emit(mf.Update,[],[],[r]);return}if(typeof e!="string"&&!e.isRedacted()){var i,s,o=e.getContent().msc4354_sticky_key;if(typeof o!="string"&&o!==void 0)return;var a=e.getType(),c=e.getSender();XI(c);var l=this.stickyEventsMap.get(a);if(!l)return;var d=cp.stickyMapKey(o,c),[h,...m]=(i=l.get(d))!==null&&i!==void 0?i:[];if(!h)return;K0.debug("Redaction for ".concat(n," under sticky key ").concat(o));var g=m.filter(E=>!E.isRedacted()).sort(cp.sortStickyEvent);(s=this.stickyEventsMap.get(a))===null||s===void 0||s.set(d,g),g.length?this.emit(mf.Update,[],[{previous:h,current:g[0]}],[]):(l.delete(d),l.size===0&&this.stickyEventsMap.delete(a),this.emit(mf.Update,[],[],[h]));return}for(var y of this.stickyEventsMap.values())for(var[v]of y.values())if(v.getId()===n)return this.handleRedaction(v)}clear(){this.stickyEventsMap.clear(),this.nextStickyEventExpiryTs=Number.MAX_SAFE_INTEGER,this.scheduleStickyTimer()}}function J$(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function G0(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?J$(Object(n),!0).forEach(function(r){M(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):J$(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var $J="10",Dye=["1","2","3","4","5","6","7","8","9","10"],Nye=30,sn=(function(t){return t.Highlight="highlight",t.Total="total",t})({}),Me=(function(t){return t.MyMembership="Room.myMembership",t.Tags="Room.tags",t.AccountData="Room.accountData",t.Receipt="Room.receipt",t.Name="Room.name",t.Redaction="Room.redaction",t.RedactionCancelled="Room.redactionCancelled",t.LocalEchoUpdated="Room.localEchoUpdated",t.Timeline="Room.timeline",t.TimelineReset="Room.timelineReset",t.TimelineRefresh="Room.TimelineRefresh",t.OldStateUpdated="Room.OldStateUpdated",t.CurrentStateUpdated="Room.CurrentStateUpdated",t.HistoryImportedWithinTimeline="Room.historyImportedWithinTimeline",t.UnreadNotifications="Room.UnreadNotifications",t.Summary="Room.Summary",t})({});let _T=class extends IJ{constructor(e,n,r){var i,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};super(),i=this,this.roomId=e,this.client=n,this.myUserId=r,this.opts=s,M(this,"reEmitter",void 0),M(this,"txnToEvent",new Map),M(this,"notificationCounts",{}),M(this,"bumpStamp",void 0),M(this,"threadNotifications",new Map),M(this,"cachedThreadReadReceipts",new Map),M(this,"oldestThreadedReceiptTs",1/0),M(this,"unthreadedReceipts",new Map),M(this,"timelineSets",void 0),M(this,"polls",new Map),M(this,"threadsTimelineSets",[]),M(this,"filteredTimelineSets",{}),M(this,"timelineNeedsRefresh",!1),M(this,"pendingEventList",void 0),M(this,"blacklistUnverifiedDevices",void 0),M(this,"selfMembership",void 0),M(this,"heroes",null),M(this,"getTypeWarning",!1),M(this,"membersPromise",void 0),M(this,"name",void 0),M(this,"normalizedName",void 0),M(this,"tags",{}),M(this,"accountData",new Map),M(this,"summary",null),M(this,"oldState",void 0),M(this,"currentState",void 0),M(this,"relations",void 0),M(this,"threads",new Map),M(this,"visibilityEvents",new Map),M(this,"roomReceipts",new uye(this)),M(this,"stickyEvents",new cp),M(this,"threadTimelineSetsPromise",null),M(this,"threadsReady",!1),M(this,"updateThreadRootEvents",(o,a,c)=>{if(o.length){var l;if(this.updateThreadRootEvent((l=this.threadsTimelineSets)===null||l===void 0?void 0:l[0],o,a,c),o.hasCurrentUserParticipated){var d;this.updateThreadRootEvent((d=this.threadsTimelineSets)===null||d===void 0?void 0:d[1],o,a,c)}}}),M(this,"updateThreadRootEvent",(o,a,c,l)=>{o&&a.rootEvent&&(l&&o.removeEvent(a.id),$n.hasServerSideSupport?o.addLiveEvent(a.rootEvent,{duplicateStrategy:B1.Replace,fromCache:!1,roomState:this.currentState,addToState:!1}):o.addEventToTimeline(a.rootEvent,o.getLiveTimeline(),{toStartOfTimeline:c,addToState:!1}))}),M(this,"tryApplyRedaction",o=>{if(o.isRedaction()){var a=o.event.redacts,c=a?this.findEventById(a):void 0;if(a)try{this.stickyEvents.handleRedaction(c||a)}catch(y){N.error("Failed to handle redaction for sticky event",y)}c&&this.applyEventAsRedaction(o,c)}else if(o.getType()===ee.RoomMember){var l=o.getContent().membership;if(l!==Ke.Ban&&!(l===Ke.Leave&&o.getStateKey()!==o.getSender()))return;var d=o.getContent()["org.matrix.msc4293.redact_events"];if(d!==!0)return;var h=this.getLiveTimeline().getState(Tt.Forward);if(!h.maySendRedactionForEvent(o,o.getSender()))return;var m=this.getTimelineSets().map(y=>y.getTimelines()).reduce((y,v)=>(y.push(...v),y),[]).map(y=>y.getEvents().filter(v=>v.getSender()===o.getStateKey())).reduce((y,v)=>(y.push(...v),v),[]);for(var g of m)this.applyEventAsRedaction(o,g)}}),this.setMaxListeners(100),this.reEmitter=new py(this),s.pendingEventOrdering=s.pendingEventOrdering||Lv.Chronological,this.name=e,this.normalizedName=e,this.relations=new fJ(this.client,this),this.on(Me.Receipt,this.onReceipt),this.reEmitter.reEmit(this.stickyEvents,[mf.Update]),this.timelineSets=[new Dg(this,s)],this.reEmitter.reEmit(this.getUnfilteredTimelineSet(),[Me.Timeline,Me.TimelineReset]),this.fixUpLegacyTimelineFields(),this.opts.pendingEventOrdering===Lv.Detached&&(this.pendingEventList=[],this.client.store.getPendingEvents(this.roomId).then(o=>{var a=this.client.getEventMapper({decrypt:!1});o.forEach((function(){var c=B(function*(l){var d=a(l);yield n.decryptEventIfNeeded(d),d.setStatus(lt.NOT_SENT),i.addPendingEvent(d,d.getTxnId())});return function(l){return c.apply(this,arguments)}})())})),this.opts.lazyLoadMembers?this.membersPromise=void 0:this.membersPromise=Promise.resolve(!1)}createThreadsTimelineSets(){var e=this;return B(function*(){var n;if(e.threadTimelineSetsPromise)return e.threadTimelineSetsPromise;if((n=e.client)!==null&&n!==void 0&&n.supportsThreads())try{e.threadTimelineSetsPromise=Promise.all([e.createThreadTimelineSet(),e.createThreadTimelineSet(gc.My)]);var r=yield e.threadTimelineSetsPromise;return e.threadsTimelineSets[0]=r[0],e.threadsTimelineSets[1]=r[1],r}catch{return e.threadTimelineSetsPromise=null,null}return null})()}decryptCriticalEvents(){var e=this;return B(function*(){if(e.client.getCrypto()){var n=e.getEventReadUpTo(e.client.getUserId(),!0),r=e.getLiveTimeline().getEvents(),i=r.findIndex(o=>o.event.event_id===n),s=r.slice(i).reverse().map(o=>e.client.decryptEventIfNeeded(o));yield Promise.allSettled(s)}})()}decryptAllEvents(){var e=this;return B(function*(){if(e.client.getCrypto()){var n=e.getUnfilteredTimelineSet().getLiveTimeline().getEvents().slice(0).reverse().map(r=>e.client.decryptEventIfNeeded(r));yield Promise.allSettled(n)}})()}getCreator(){var e,n=this.currentState.getStateEvents(ee.RoomCreate,"");return(e=n?.getSender())!==null&&e!==void 0?e:null}getVersion(){return this.currentState.getRoomVersion()}getRecommendedVersion(){var e=this;return B(function*(){var n={};try{n=yield e.client.getCapabilities()}catch{}var r=n["m.room_versions"];if(!r){r={default:$J,available:{}};for(var i of Dye)r.available[i]=jJ.Stable}var s=e.checkVersionAgainstCapability(r);if(s.urgent&&s.needsUpgrade){N.warn("Refreshing room version capability because the server looks to be supporting a newer room version we don't know about.");try{n=yield e.client.fetchCapabilities()}catch(o){N.warn("Failed to refresh room version capabilities",o)}if(r=n["m.room_versions"],r)s=e.checkVersionAgainstCapability(r);else return N.warn("No room version capability - assuming upgrade required."),s}return s})()}checkVersionAgainstCapability(e){var n=this.getVersion();N.log("[".concat(this.roomId,"] Current version: ").concat(n)),N.log("[".concat(this.roomId,"] Version capability: "),e);var r={version:n,needsUpgrade:!1,urgent:!1};if(n===e.default)return r;var i=Object.keys(e.available).filter(s=>e.available[s]==="stable");return i.includes(n)||(r.version=e.default,r.needsUpgrade=!0,r.urgent=!!this.getVersion().match(/^[0-9]+[0-9.]*$/g),r.urgent?N.warn("URGENT upgrade required on ".concat(this.roomId)):N.warn("Non-urgent upgrade required on ".concat(this.roomId))),r}userMayUpgradeRoom(e){return this.currentState.maySendStateEvent(ee.RoomTombstone,e)}getPendingEvents(){if(!this.pendingEventList)throw new Error("Cannot call getPendingEvents with pendingEventOrdering == "+this.opts.pendingEventOrdering);return this.pendingEventList}removePendingEvent(e){if(!this.pendingEventList)throw new Error("Cannot call removePendingEvent with pendingEventOrdering == "+this.opts.pendingEventOrdering);var n=bC(this.pendingEventList,function(r){return r.getId()==e},!1);return this.savePendingEvents(),n}hasPendingEvent(e){var n,r;return(n=(r=this.pendingEventList)===null||r===void 0?void 0:r.some(i=>i.getId()===e))!==null&&n!==void 0?n:!1}getPendingEvent(e){var n,r;return(n=(r=this.pendingEventList)===null||r===void 0?void 0:r.find(i=>i.getId()===e))!==null&&n!==void 0?n:null}getLiveTimeline(){return this.getUnfilteredTimelineSet().getLiveTimeline()}get timeline(){return this.getLiveTimeline().getEvents()}getLastActiveTimestamp(){var e=this.getLiveTimeline(),n=e.getEvents();if(n.length){var r=n[n.length-1];return r.getTs()}else return Number.MIN_SAFE_INTEGER}getLastLiveEvent(){var e,n,r=this.getLiveTimeline().getEvents(),i=r[r.length-1],s=this.getLastThread();if(!s)return i;var o=s.events[s.events.length-1];return((e=i?.getTs())!==null&&e!==void 0?e:0)>((n=o?.getTs())!==null&&n!==void 0?n:0)?i:o}getLastThread(){return this.getThreads().reduce((e,n)=>{var r,i;if(!e)return n;var s=n.events[n.events.length-1],o=e.events[e.events.length-1];return((r=s?.getTs())!==null&&r!==void 0?r:0)>=((i=o?.getTs())!==null&&i!==void 0?i:0)?n:e},void 0)}getMyMembership(){var e;return(e=this.selfMembership)!==null&&e!==void 0?e:Ke.Leave}getDMInviter(){var e=this.getMember(this.myUserId);if(e)return e.getDMInviter();if(this.selfMembership===Ke.Invite){var n=this.getInvitedAndJoinedMemberCount();if(n===2){var r;return(r=this.heroes)===null||r===void 0||(r=r[0])===null||r===void 0?void 0:r.userId}}}guessDMUserId(){var e=this.getMember(this.myUserId);if(e){var n=e.getDMInviter();if(n)return n}if(Array.isArray(this.heroes)&&this.heroes.length)return this.heroes[0].userId;var r=this.currentState.getMembers(),i=r.find(s=>s.userId!==this.myUserId);return i?i.userId:this.myUserId}getFunctionalMembers(){var e=this.currentState.getStateEvents(tJ.name,"");return Array.isArray(e?.getContent().service_members)?e.getContent().service_members:[]}getAvatarFallbackMember(){var e,n=this.getFunctionalMembers(),r=0;if(this.getMembers().forEach(v=>{v.membership!=="join"&&v.membership!=="invite"||n.includes(v.userId)||r++}),!(r>2)){var i=(e=this.heroes)===null||e===void 0?void 0:e.filter(v=>!n.includes(v.userId)),s=Array.isArray(i)&&i.length;if(s){for(var o of i)if(o.fromMSC4186){var c=new Tb(this.roomId,o.userId);return c.setMembershipEvent(new es({event_id:"$"+this.roomId+o.userId+new Date().getTime(),type:ee.RoomMember,state_key:o.userId,content:{displayname:o.displayName,avatar_url:o.avatarUrl}})),c}else{var a=this.getMember(o.userId);if(a)return a}var l=i.map(v=>this.getMember(v.userId)).find(v=>!!v);if(l)return l}var d=this.getMembers(),h=d?.filter(v=>!n.includes(v.userId));if(h.length<=2){var m=h.find(v=>v.userId!==this.myUserId);if(m)return m}if(s){var g=i.map(v=>this.client.getUser(v.userId)).find(v=>!!v);if(g){var y=new Tb(this.roomId,g.userId);return y.user=g,y}}}}updateMyMembership(e){var n=this.selfMembership;this.selfMembership=e,n!==e&&(e===Ke.Leave&&this.cleanupAfterLeaving(),this.emit(Me.MyMembership,this,e,n))}loadMembersFromServer(){var e=this;return B(function*(){var n=e.client.store.getSyncToken(),r=yield e.client.members(e.roomId,void 0,Ke.Leave,n??void 0);return r.chunk})()}loadMembers(){var e=this;return B(function*(){var n=!1,r=yield e.client.store.getOutOfBandMembers(e.roomId);(r===null||e.hasEncryptionStateEvent())&&(n=!0,r=yield e.loadMembersFromServer(),N.log("LL: got ".concat(r.length," ")+"members from server for room ".concat(e.roomId)));var i=r.filter(wc).map(e.client.getEventMapper());return{memberEvents:i,fromServer:n}})()}membersLoaded(){return this.opts.lazyLoadMembers?this.currentState.outOfBandMembersReady():!0}loadMembersIfNeeded(){if(this.membersPromise)return this.membersPromise;this.currentState.markOutOfBandMembersStarted();var e=this.loadMembers().then(n=>(this.currentState.setOutOfBandMembers(n.memberEvents),this.recalculate(),n.fromServer)).catch(n=>{throw this.membersPromise=void 0,this.currentState.markOutOfBandMembersFailed(),n});return e.then(n=>{if(n){var r=this.currentState.getMembers().filter(s=>s.isOutOfBand()).map(s=>{var o;return(o=s.events.member)===null||o===void 0?void 0:o.event});N.log("LL: telling store to write ".concat(r.length)+" members for room ".concat(this.roomId));var i=this.client.store;return i.setOutOfBandMembers(this.roomId,r).catch(s=>{N.log("LL: storing OOB room members failed, oh well",s)})}}).catch(n=>{N.error(n)}),this.membersPromise=e,this.membersPromise}clearLoadedMembersIfNeeded(){var e=this;return B(function*(){e.opts.lazyLoadMembers&&e.membersPromise&&(yield e.loadMembersIfNeeded(),yield e.client.store.clearOutOfBandMembers(e.roomId),e.currentState.clearOutOfBandMembers(),e.membersPromise=void 0)})()}cleanupAfterLeaving(){this.clearLoadedMembersIfNeeded().catch(e=>{N.error("error after clearing loaded members from "+"room ".concat(this.roomId," after leaving")),N.log(e)})}refreshLiveTimeline(){var e=this;return B(function*(){var n=e.getLiveTimeline(),r=n.getPaginationToken(Ue.FORWARDS),i=n.getPaginationToken(Ue.BACKWARDS),s=n.getEvents(),o=s[s.length-1];N.log("[refreshLiveTimeline for ".concat(e.roomId,"] at ")+"mostRecentEventInTimeline=".concat(o&&o.getId()," ")+"liveTimelineBefore=".concat(n.toString()," ")+"forwardPaginationToken=".concat(r," ")+"backwardPaginationToken=".concat(i));var a=e.getUnfilteredTimelineSet(),c=null;o?(e.resetLiveTimeline(null,null),e.emit(Me.TimelineRefresh,e,a),c=yield e.client.getEventTimeline(a,o.getId())):c=yield e.client.getLatestTimeline(a);var l=a.getLiveTimeline();!l||l.getPaginationToken(Tt.Forward)===null&&l.getPaginationToken(Tt.Backward)===null&&l.getEvents().length===0?(N.log("[refreshLiveTimeline for ".concat(e.roomId,"] using our new live timeline")),c.setPaginationToken(r,Ue.FORWARDS),a.setLiveTimeline(c),e.fixUpLegacyTimelineFields()):N.log("[refreshLiveTimeline for ".concat(e.roomId,"] `/sync` or some other request beat us to creating a new ")+"live timeline after we reset it. We'll use that instead since any events in the scrollback from this timeline will include the history."),e.setTimelineNeedsRefresh(!1),e.emit(Me.TimelineRefresh,e,a)})()}resetLiveTimeline(e,n){for(var r of this.timelineSets)r.resetLiveTimeline(e??void 0,n??void 0);for(var i of this.threads.values())i.resetLiveTimeline(e,n);this.fixUpLegacyTimelineFields()}fixUpLegacyTimelineFields(){var e=this.oldState,n=this.currentState;this.oldState=this.getLiveTimeline().getState(Ue.BACKWARDS),this.currentState=this.getLiveTimeline().getState(Ue.FORWARDS),e!==this.oldState&&this.emit(Me.OldStateUpdated,this,e,this.oldState),n!==this.currentState&&(this.emit(Me.CurrentStateUpdated,this,n,this.currentState),this.reEmitter.stopReEmitting(n,[Rt.Events,Rt.Members,Rt.NewMember,Rt.Update,Rt.Marker,Qn.New,Qn.Update,Qn.Destroy,Qn.LivenessChange]),this.reEmitter.reEmit(this.currentState,[Rt.Events,Rt.Members,Rt.NewMember,Rt.Update,Rt.Marker,Qn.New,Qn.Update,Qn.Destroy,Qn.LivenessChange]))}onReceipt(e){this.hasEncryptionStateEvent()&&this.clearNotificationsOnReceipt(e)}clearNotificationsOnReceipt(e){var n=[],r=!1,i=e.getContent();for(var s of Object.values(i))for(var[o,a]of Object.entries(s))if(qO(o)&&a){for(var[c,l]of Object.entries(a))if(!(!l||typeof l!="object")){var d=l;c===this.client.getUserId()&&(d.thread_id===void 0?r=!0:typeof d.thread_id=="string"&&n.push(d.thread_id))}}r&&(n=this.getThreads().filter(k=>this.getThreadUnreadNotificationCount(k.id,sn.Total)>0||this.getThreadUnreadNotificationCount(k.id,sn.Highlight)>0).map(k=>k.id),n.push("main"));for(var h of n){var m,g=20,y=h==="main"?this.getLiveTimeline():(m=this.getThread(h))===null||m===void 0?void 0:m.liveTimeline;if(!y){N.warn("Couldn't find timeline for thread ID ".concat(h," in room ").concat(this.roomId));continue}for(var v=y.getEvents(),E=0,w=v.length-1;w>=0;w--){var R;if(w===v.length-g)return;var x=v[w];if(this.hasUserReadEvent(this.client.getUserId(),x.getId()))break;var C=this.client.getPushActionsForEvent(x);E+=C!=null&&(R=C.tweaks)!==null&&R!==void 0&&R.highlight?1:0}h==="main"?this.setUnreadNotificationCount(sn.Highlight,E):this.setThreadUnreadNotificationCount(h,sn.Highlight,E)}}getTimelineSets(){return this.timelineSets}getUnfilteredTimelineSet(){return this.timelineSets[0]}getTimelineForEvent(e){var n=this.findEventById(e),r=this.findThreadForEvent(n);return r?r.timelineSet.getTimelineForEvent(e):this.getUnfilteredTimelineSet().getTimelineForEvent(e)}addTimeline(){return this.getUnfilteredTimelineSet().addTimeline()}setTimelineNeedsRefresh(e){this.timelineNeedsRefresh=e}getTimelineNeedsRefresh(){return this.timelineNeedsRefresh}findEventById(e){var n=this.getUnfilteredTimelineSet().findEventById(e);if(!n)for(var r=this.getThreads(),i=0;i<r.length;i++){var s=r[i];if(n=s.findEventById(e),n)return n}return n}getUnreadNotificationCount(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:sn.Total,n=this.getRoomUnreadNotificationCount(e);for(var r of this.threadNotifications.values()){var i;n+=(i=r[e])!==null&&i!==void 0?i:0}return n}getUnreadCountForEventContext(){var e,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:sn.Total,r=arguments.length>1?arguments[1]:void 0,i=!!r.threadRootId&&!r.isThreadRoot;return(e=i?this.getThreadUnreadNotificationCount(r.threadRootId,n):this.getRoomUnreadNotificationCount(n))!==null&&e!==void 0?e:0}getRoomUnreadNotificationCount(){var e,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:sn.Total;return(e=this.notificationCounts[n])!==null&&e!==void 0?e:0}getThreadUnreadNotificationCount(e){var n,r,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:sn.Total;return(n=(r=this.threadNotifications.get(e))===null||r===void 0?void 0:r[i])!==null&&n!==void 0?n:0}hasThreadUnreadNotification(){for(var e of this.threadNotifications.values()){var n,r;if(((n=e.highlight)!==null&&n!==void 0?n:0)>0||((r=e.total)!==null&&r!==void 0?r:0)>0)return!0}return!1}setThreadUnreadNotificationCount(e,n,r){var i,s,o=G0({highlight:(i=this.threadNotifications.get(e))===null||i===void 0?void 0:i.highlight,total:(s=this.threadNotifications.get(e))===null||s===void 0?void 0:s.total},{[n]:r});this.threadNotifications.set(e,o),this.emit(Me.UnreadNotifications,o,e)}get threadsAggregateNotificationType(){var e=null;for(var n of this.threadNotifications.values()){var r,i;if(((r=n.highlight)!==null&&r!==void 0?r:0)>0)return sn.Highlight;((i=n.total)!==null&&i!==void 0?i:0)>0&&!e&&(e=sn.Total)}return e}resetThreadUnreadNotificationCountFromSync(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],n=this.hasEncryptionStateEvent();for(var[r,i]of this.threadNotifications)e.includes(r)||(i.total=0,n||(i.highlight=0));this.emit(Me.UnreadNotifications)}setBumpStamp(e){this.bumpStamp=e}getBumpStamp(){return this.bumpStamp}setUnreadNotificationCount(e,n){this.notificationCounts[e]=n,this.emit(Me.UnreadNotifications,this.notificationCounts)}setUnread(e,n){return this.setUnreadNotificationCount(e,n)}setSummary(e){var n,r=(n=e["m.heroes"])===null||n===void 0?void 0:n.map(o=>({userId:o,fromMSC4186:!1})),i=e["m.joined_member_count"],s=e["m.invited_member_count"];Number.isInteger(i)&&this.currentState.setJoinedMemberCount(i),Number.isInteger(s)&&this.currentState.setInvitedMemberCount(s),Array.isArray(r)&&(this.heroes=r.filter(o=>o.userId!=this.myUserId)),this.emit(Me.Summary,e)}setMSC4186SummaryData(e,n,r){e&&(this.heroes=e.filter(i=>i.user_id!==this.myUserId).map(i=>({userId:i.user_id,displayName:i.displayname,avatarUrl:i.avatar_url,fromMSC4186:!0}))),n!==void 0&&Number.isInteger(n)&&this.currentState.setJoinedMemberCount(n),r!==void 0&&Number.isInteger(r)&&this.currentState.setInvitedMemberCount(r),this.emit(Me.Summary,{"m.heroes":this.heroes?this.heroes.map(i=>i.userId):[],"m.joined_member_count":n,"m.invited_member_count":r})}setBlacklistUnverifiedDevices(e){this.blacklistUnverifiedDevices=e}getBlacklistUnverifiedDevices(){return this.blacklistUnverifiedDevices===void 0?null:this.blacklistUnverifiedDevices}getAvatarUrl(e,n,r,i){var s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!1,a=this.getMxcAvatarUrl();return!a&&!s?null:a?gT(e,a,n,r,i,void 0,void 0,o):null}getMxcAvatarUrl(){var e,n=(e=this.currentState.getStateEvents(ee.RoomAvatar,""))===null||e===void 0?void 0:e.getContent().url;return n&&typeof n=="string"?n:null}getCanonicalAlias(){var e,n=(e=this.currentState.getStateEvents(ee.RoomCanonicalAlias,""))===null||e===void 0?void 0:e.getContent().alias;return n&&typeof n=="string"?n:null}getAltAliases(){var e,n=(e=this.currentState.getStateEvents(ee.RoomCanonicalAlias,""))===null||e===void 0?void 0:e.getContent().alt_aliases;return Array.isArray(n)?n.filter(r=>typeof r=="string"):[]}addEventsToTimeline(e,n,r,i,s){i.getTimelineSet().addEventsToTimeline(e,n,r,i,s)}getThread(e){var n;return(n=this.threads.get(e))!==null&&n!==void 0?n:null}getThreads(){return Array.from(this.threads.values())}getMember(e){return this.currentState.getMember(e)}getMembers(){return this.currentState.getMembers()}getJoinedMembers(){return this.getMembersWithMembership(Ke.Join)}getJoinedMemberCount(){return this.currentState.getJoinedMemberCount()}getInvitedMemberCount(){return this.currentState.getInvitedMemberCount()}getInvitedAndJoinedMemberCount(){return this.getInvitedMemberCount()+this.getJoinedMemberCount()}getMembersWithMembership(e){return this.currentState.getMembers().filter(function(n){return n.membership===e})}getEncryptionTargetMembers(){var e=this;return B(function*(){yield e.loadMembersIfNeeded();var n=e.getMembersWithMembership(Ke.Join);return e.shouldEncryptForInvitedMembers()&&(n=n.concat(e.getMembersWithMembership(Ke.Invite))),n})()}shouldEncryptForInvitedMembers(){var e,n=this.currentState.getStateEvents(ee.RoomHistoryVisibility,"");return(n==null||(e=n.getContent())===null||e===void 0?void 0:e.history_visibility)!=="joined"}getDefaultRoomName(e){return this.calculateRoomName(e,!0)}hasMembershipState(e,n){var r=this.getMember(e);return r?r.membership===n:!1}getOrCreateFilteredTimelineSet(e){var{prepopulateTimeline:n=!0,useSyncEvents:r=!0,pendingEvents:i=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.filteredTimelineSets[e.filterId])return this.filteredTimelineSets[e.filterId];var s=Object.assign({filter:e,pendingEvents:i},this.opts),o=new Dg(this,s);this.reEmitter.reEmit(o,[Me.Timeline,Me.TimelineReset]),r&&(this.filteredTimelineSets[e.filterId]=o,this.timelineSets.push(o));var a=this.getLiveTimeline();if(n){a.getEvents().forEach(function(d){o.addLiveEvent(d,{addToState:!1})});for(var c=a;c.getNeighbouringTimeline(Ue.BACKWARDS);)c=c.getNeighbouringTimeline(Ue.BACKWARDS);o.getLiveTimeline().setPaginationToken(c.getPaginationToken(Ue.BACKWARDS),Ue.BACKWARDS)}else if(r){var l=a.getPaginationToken(Tt.Forward);o.getLiveTimeline().setPaginationToken(l,Tt.Backward)}return o}getThreadListFilter(){var e=arguments,n=this;return B(function*(){var r=e.length>0&&e[0]!==void 0?e[0]:gc.All,i=n.client.getUserId(),s=new zo(i),o={room:{timeline:{[ev.name]:[Rn.name]}}};r===gc.My&&(o.room.timeline[Zg.name]=[i]),s.setDefinition(o);var a=yield n.client.getOrCreateFilter("THREAD_PANEL_".concat(n.roomId,"_").concat(r),s);return s.filterId=a,s})()}createThreadTimelineSet(e){var n=this;return B(function*(){var r;if($n.hasServerSideListSupport)r=new Dg(n,G0(G0({},n.opts),{},{pendingEvents:!1}),void 0,void 0,e??gc.All),n.reEmitter.reEmit(r,[Me.Timeline,Me.TimelineReset]);else if($n.hasServerSideSupport){var i=yield n.getThreadListFilter(e);r=n.getOrCreateFilteredTimelineSet(i,{prepopulateTimeline:!1,useSyncEvents:!1,pendingEvents:!1})}else r=new Dg(n,{pendingEvents:!1}),Array.from(n.threads).forEach(s=>{var[,o]=s;if(o.length!==0){var a=o.timeline.some(c=>c.getSender()===n.client.getUserId());(e!==gc.My||a)&&r.getLiveTimeline().addEvent(o.rootEvent,{toStartOfTimeline:!1,addToState:!1})}});return r})()}processThreadRoots(e,n){if(this.client.supportsThreads())for(var r of e)Ue.setEventMetadata(r,this.currentState,n),this.getThread(r.getId())||this.createThread(r.getId(),r,[],n)}fetchRoomThreads(){var e=this;return B(function*(){if(!(e.threadsReady||!e.client.supportsThreads())){if($n.hasServerSideListSupport)yield Promise.all([e.fetchRoomThreadList(gc.All),e.fetchRoomThreadList(gc.My)]);else{var n=yield e.getThreadListFilter(),{chunk:r}=yield e.client.createMessagesRequest(e.roomId,"",Number.MAX_SAFE_INTEGER,Tt.Backward,n);if(!r.length)return;var i=r.map(e.client.getEventMapper()).sort((m,g)=>{var y=m.getServerAggregatedRelation(Rn.name),v=g.getServerAggregatedRelation(Rn.name);return y.latest_event.origin_server_ts-v.latest_event.origin_server_ts}),s,o=e.getLiveTimeline().getState(Ue.FORWARDS);for(var a of i){var c,l={duplicateStrategy:B1.Ignore,fromCache:!1,addToState:!1,roomState:o};(c=e.threadsTimelineSets[0])===null||c===void 0||c.addLiveEvent(a,l);var d=a.getServerAggregatedRelation(Rn.name);if(d!=null&&d.current_user_participated){var h;(h=e.threadsTimelineSets[1])===null||h===void 0||h.addLiveEvent(a,l),s=a}}e.processThreadRoots(i,!0),e.client.decryptEventIfNeeded(i[i.length-1]),s&&e.client.decryptEventIfNeeded(s)}e.on(As.NewReply,e.onThreadReply),e.on(As.Update,e.onThreadUpdate),e.on(As.Delete,e.onThreadDelete),e.threadsReady=!0}})()}processPollEvents(e){var n=this;return B(function*(){for(var r of e)try{if(!r.isEncrypted()&&!AJ(r))continue;yield n.client.decryptEventIfNeeded(r),n.processPollEvent(r)}catch(i){N.warn("Error processing poll event",r.getId(),i)}})()}processPollEvent(e){var n=this;return B(function*(){if(e.isDecryptionFailure()){e.once(Zt.Decrypted,o=>{n.processPollEvent(o)});return}if(Eo.M_POLL_START.matches(e.getType())){try{var r=new xJ(e,n.client,n);n.polls.set(e.getId(),r),n.emit(cf.New,r),e.once(Zt.BeforeRedaction,o=>{n.polls.delete(o.getId())})}catch{}return}var i=e.relationEventId;if(i&&n.polls.has(i)){var s=n.polls.get(i);s?.onNewRelation(e)}})()}fetchRoomThreadList(e){var n=this;return B(function*(){if(n.client.supportsThreads()&&n.threadsTimelineSets.length!==0){var r=e===gc.My?n.threadsTimelineSets[1]:n.threadsTimelineSets[0],{chunk:i,end:s}=yield n.client.createThreadListMessagesRequest(n.roomId,null,void 0,Tt.Backward,r.threadListType,r.getFilter());if(r.getLiveTimeline().setPaginationToken(s??null,Tt.Backward),!!i.length){var o=i.map(n.client.getEventMapper());n.processThreadRoots(o,!0);var a=n.getLiveTimeline().getState(Ue.FORWARDS);for(var c of o)r.addLiveEvent(c,{duplicateStrategy:B1.Replace,fromCache:!1,roomState:a,addToState:!1})}}})()}onThreadUpdate(e){this.updateThreadRootEvents(e,!1,!1)}onThreadReply(e){this.updateThreadRootEvents(e,!1,!0)}onThreadDelete(e){var n;this.threads.delete(e.id);var r=this.getTimelineForEvent(e.id),i=r==null||(n=r.getEvents())===null||n===void 0?void 0:n.find(o=>o.getId()===e.id);i?e.clearEventMetadata(i):N.debug("onThreadDelete: Could not find root event in room timeline");for(var s of this.threadsTimelineSets)s.removeEvent(e.id)}removeFilteredTimelineSet(e){var n=this.filteredTimelineSets[e.filterId];delete this.filteredTimelineSets[e.filterId];var r=this.timelineSets.indexOf(n);r>-1&&this.timelineSets.splice(r,1)}eventShouldLiveIn(e,n,r){var i;if(!((i=this.client)!==null&&i!==void 0&&i.supportsThreads()))return{shouldLiveInRoom:!0,shouldLiveInThread:!1};if(e.isThreadRoot||r!=null&&r.has(e.getId()))return{shouldLiveInRoom:!0,shouldLiveInThread:!0,threadId:e.getId()};var s=e.isRelation(Rn.name),o=e.getAssociatedId(),a=e.threadRootId;if(o&&!s&&(a===o||r!=null&&r.has(o)))return{shouldLiveInRoom:!0,shouldLiveInThread:!1};var c;if(o){var l;c=(l=this.findEventById(o))!==null&&l!==void 0?l:n?.find(d=>d.getId()===o)}return c&&!s?this.eventShouldLiveIn(c,n,r):a!=null?{shouldLiveInRoom:!1,shouldLiveInThread:!0,threadId:a}:!o||e.replyEventId?{shouldLiveInRoom:!0,shouldLiveInThread:!1}:{shouldLiveInRoom:!1,shouldLiveInThread:!1}}findThreadForEvent(e){if(!e)return null;var{threadId:n}=this.eventShouldLiveIn(e);return n?this.getThread(n):null}addThreadedEvents(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=this.getThread(e);if(i)i.addEvents(n,r);else{var s,o=(s=this.findEventById(e))!==null&&s!==void 0?s:n.find(a=>a.getId()===e);this.createThread(e,o,n,r)}}processThreadedEvents(e,n){e.forEach(this.tryApplyRedaction);var r={};for(var i of e){var s,{threadId:o,shouldLiveInThread:a}=this.eventShouldLiveIn(i);a&&!r[o]&&(r[o]=[]),(s=r[o])===null||s===void 0||s.push(i)}Object.entries(r).map(c=>{var[l,d]=c;return this.addThreadedEvents(l,d,n)})}createThread(e,n){var r,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],s=arguments.length>3?arguments[3]:void 0;if(this.threads.has(e))return this.threads.get(e);if(n){var o=this.relations.getAllChildEventsForEvent(n.getId());o!=null&&o.length&&(i=i.concat(o.filter(c=>!c.isRelation(vn.Replace))))}var a=new $n(e,n,{room:this,client:this.client,pendingEventOrdering:this.opts.pendingEventOrdering,receipts:(r=this.cachedThreadReadReceipts.get(e))!==null&&r!==void 0?r:[]});return this.reEmitter.reEmit(a,[As.Delete,As.Update,As.NewReply,Me.Timeline,Me.TimelineReset]),this.cachedThreadReadReceipts.delete(e),this.threads.set(a.id,a),a.addEvents(i,!1),this.threadsReady&&a.initialEventsFetched&&this.updateThreadRootEvents(a,s,!1),this.emit(As.New,a,s),a}applyEventAsRedaction(e,n){var r=n.threadRootId;if(n.makeRedacted(e,this),n.isState()){var i=this.currentState.getStateEvents(n.getType(),n.getStateKey());i?.getId()===n.getId()&&this.currentState.setStateEvents([n])}this.emit(Me.Redaction,e,this,r),this.visibilityEvents.delete(n.getId()),n.isVisibilityEvent()&&this.redactVisibilityChangeEvent(e)}processLiveEvent(e){this.tryApplyRedaction(e),e.isVisibilityEvent()&&this.applyNewVisibilityEvent(e),this.applyPendingVisibilityEvents(e);var n=e.getUnsigned().transaction_id;if(!n&&e.getSender()===this.myUserId){for(var[r,i]of this.txnToEvent)if(i.getId()===e.getId()){N.debug("processLiveEvent: found sent event without txn ID: ",r,e.getId());var s=e.getUnsigned();s.transaction_id=r,e.setUnsigned(s);break}}}addLiveEvent(e,n){var{duplicateStrategy:r,timelineWasEmpty:i,fromCache:s,addToState:o}=n;for(var a of this.timelineSets)a.addLiveEvent(e,{duplicateStrategy:r,fromCache:s,timelineWasEmpty:i,addToState:o});e.sender&&e.getType()!==ee.RoomRedaction&&this.addReceipt(kJ(e.sender.userId,e,xs.Read),!0)}addPendingEvent(e,n){if(e.status!==lt.SENDING&&e.status!==lt.NOT_SENT)throw new Error("addPendingEvent called on an event with status "+e.status);if(this.txnToEvent.get(n))throw new Error("addPendingEvent called on an event with known txnId "+n);if(Ue.setEventMetadata(e,this.getLiveTimeline().getState(Ue.FORWARDS),!1),this.txnToEvent.set(n,e),this.pendingEventList){if(this.pendingEventList.some(o=>o.status===lt.NOT_SENT)&&(N.warn("Setting event as NOT_SENT due to messages in the same state"),e.setStatus(lt.NOT_SENT)),this.pendingEventList.push(e),this.savePendingEvents(),e.isRelation()&&this.aggregateNonLiveRelation(e),e.isRedaction()){var r=e.event.redacts,i=this.pendingEventList.find(o=>o.getId()===r);!i&&r&&(i=this.findEventById(r)),i&&(i.markLocallyRedacted(e),this.emit(Me.Redaction,e,this,i.threadRootId))}}else for(var s of this.timelineSets)s.getFilter()?s.getFilter().filterRoomTimeline([e]).length&&s.addEventToTimeline(e,s.getLiveTimeline(),{toStartOfTimeline:!1,addToState:!1}):s.addEventToTimeline(e,s.getLiveTimeline(),{toStartOfTimeline:!1,addToState:!1});this.emit(Me.LocalEchoUpdated,e,this)}savePendingEvents(){if(this.pendingEventList){var e=this.pendingEventList.map(n=>G0(G0({},n.event),{},{txn_id:n.getTxnId()})).filter(n=>{var r=n.type===ee.RoomMessageEncrypted,i=this.hasEncryptionStateEvent();return r||!i});this.client.store.setPendingEvents(this.roomId,e)}}aggregateNonLiveRelation(e){this.relations.aggregateChildEvent(e)}getEventForTxnId(e){return this.txnToEvent.get(e)}handleRemoteEcho(e,n){var r=n.getId(),i=e.getId(),s=n.status;N.debug("Got remote echo for event ".concat(r," -> ").concat(i," old status ").concat(s)),this.txnToEvent.delete(e.getUnsigned().transaction_id),this.pendingEventList&&this.removePendingEvent(r),n.handleRemoteEcho(e.event);var{shouldLiveInRoom:o,threadId:a}=this.eventShouldLiveIn(e),c=a?this.getThread(a):null;if(c?.setEventMetadata(n),c?.timelineSet.handleRemoteEcho(n,r,i),o)for(var l of this.timelineSets)l.handleRemoteEcho(n,r,i);this.emit(Me.LocalEchoUpdated,n,this,r,s)}updatePendingEvent(e,n,r){if(N.log("setting pendingEvent status to ".concat(n," in ").concat(e.getRoomId()," ")+"event ID ".concat(e.getId()," -> ").concat(r)),n==lt.SENT&&!r)throw new Error("updatePendingEvent called with status=SENT, but no new event id");if(n==lt.SENT){var i=this.getTimelineForEvent(r);if(i){var s=this.findEventById(r),o=s?.getUnsigned().transaction_id;if(!o&&s){var a=s.getUnsigned();a.transaction_id=e.getTxnId(),s.setUnsigned(a),this.removeEvent(s.getId()),this.handleRemoteEcho(s,e)}return}}var c=e.status,l=e.getId();if(!c)throw new Error("updatePendingEventStatus called on an event which is not a local echo.");var d=Uye[c];if(!(d!=null&&d.includes(n)))throw new Error("Invalid EventStatus transition ".concat(c,"->").concat(n));if(e.setStatus(n),n==lt.SENT){e.replaceLocalEventId(r);var{shouldLiveInRoom:h,threadId:m}=this.eventShouldLiveIn(e),g=m?this.getThread(m):void 0;if(g?.setEventMetadata(e),g?.timelineSet.replaceEventId(l,r),h)for(var y of this.timelineSets)y.replaceEventId(l,r)}else if(n==lt.CANCELLED){if(this.pendingEventList){var v=this.getPendingEvent(l);this.removePendingEvent(l),v!=null&&v.isRedaction()&&this.revertRedactionLocalEcho(v)}this.removeEvent(l)}this.savePendingEvents(),this.emit(Me.LocalEchoUpdated,e,this,l,c)}revertRedactionLocalEcho(e){var n=e.event.redacts;if(n){var r=this.getUnfilteredTimelineSet().findEventById(n);r&&(r.unmarkLocallyRedacted(),this.emit(Me.RedactionCancelled,e,this),r.isRelation()&&this.aggregateNonLiveRelation(r))}}assertTimelineSetsAreLive(){for(var e=0;e<this.timelineSets.length;e++){var n=this.timelineSets[e].getLiveTimeline();if(n.getPaginationToken(Ue.FORWARDS))throw new Error("live timeline "+e+" is no longer live - it has a pagination token ("+n.getPaginationToken(Ue.FORWARDS)+")");if(n.getNeighbouringTimeline(Ue.FORWARDS))throw new Error("live timeline ".concat(e," is no longer live - it has a neighbouring timeline"))}}addLiveEvents(e,n){var r=this;return B(function*(){var{duplicateStrategy:i,fromCache:s,timelineWasEmpty:o=!1,addToState:a}=n;if(i&&["replace","ignore"].indexOf(i)===-1)throw new Error("duplicateStrategy MUST be either 'replace' or 'ignore'");r.assertTimelineSetsAreLive();var c=r.findThreadRoots(e),l={},d={duplicateStrategy:i,fromCache:s,timelineWasEmpty:o,addToState:a},h=[...e];for(var m of e){var g;if(r.processLiveEvent(m),m.getUnsigned().transaction_id){var y=r.txnToEvent.get(m.getUnsigned().transaction_id);if(y){r.handleRemoteEcho(m,y);continue}}var{shouldLiveInRoom:v,shouldLiveInThread:E,threadId:w=""}=r.eventShouldLiveIn(m,h,c);if(!E&&!v&&m.isRelation())try{var R=new es(yield r.client.fetchRoomEvent(r.roomId,m.relationEventId));if(h.push(R),R.threadRootId){c.add(R.threadRootId);var x=m.getUnsigned();x[CC.name]=R.threadRootId,m.setUnsigned(x)}({shouldLiveInRoom:v,shouldLiveInThread:E,threadId:w=""}=r.eventShouldLiveIn(m,h,c))}catch(C){N.error("Failed to load parent event of unhandled relation",C)}E&&!l[w]&&(l[w]=[]),(g=l[w])===null||g===void 0||g.push(m),v?r.addLiveEvent(m,d):!E&&m.isRelation()&&r.relations.aggregateChildEvent(m)}Object.entries(l).forEach(C=>{var[k,T]=C;r.addThreadedEvents(k,T,!1)})})()}partitionThreadedEvents(e){var n=0,r=1,i=2;if(this.client.supportsThreads()){var s=this.findThreadRoots(e);return e.reduce((o,a)=>{var{shouldLiveInRoom:c,shouldLiveInThread:l,threadId:d}=this.eventShouldLiveIn(a,e,s);return c&&o[n].push(a),l&&(a.setThreadId(d??""),o[r].push(a)),!l&&!c&&o[i].push(a),o},[[],[],[]])}else return[e,[],[]]}findThreadRoots(e){var n=new Set;for(var r of e){var i=r.threadRootId;i!=null&&n.add(i)}return n}addReceipt(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=e.getContent();this.roomReceipts.add(r,n),Object.keys(r).forEach(i=>{Object.keys(r[i]).forEach(s=>{Object.keys(r[i][s]).forEach(o=>{var a,c,l,d=r[i][s][o],h=!d.thread_id||d.thread_id===O_,m=h?this:this.threads.get((a=d.thread_id)!==null&&a!==void 0?a:"");if(m){if(m.addReceiptToStructure(i,s,o,d,n),!n&&this.client.isInitialSyncComplete()&&o===this.client.getUserId()){var g=m.timeline[m.timeline.length-1];g&&i===g.getId()&&o===g.getSender()&&(m.setUnread(sn.Total,0),m.setUnread(sn.Highlight,0))}}else{var y;this.cachedThreadReadReceipts.set(d.thread_id,[...(y=this.cachedThreadReadReceipts.get(d.thread_id))!==null&&y!==void 0?y:[],{eventId:i,receiptType:s,userId:o,receipt:d,synthetic:n}])}var v=this.client.getUserId();o===v&&!h&&d.ts<this.oldestThreadedReceiptTs&&(this.oldestThreadedReceiptTs=d.ts),!d.thread_id&&d.ts>((c=(l=this.unthreadedReceipts.get(o))===null||l===void 0?void 0:l.ts)!==null&&c!==void 0?c:0)&&this.unthreadedReceipts.set(o,d)})})}),this.emit(Me.Receipt,e,this)}addEphemeralEvents(e){for(var n of e)n.getType()===ee.Typing?this.currentState.setTypingEvent(n):n.getType()===ee.Receipt&&this.addReceipt(n)}removeEvents(e){for(var n of e)this.removeEvent(n)}removeEvent(e){var n=!1;for(var r of this.timelineSets){var i=r.removeEvent(e);i&&(i.isRedaction()&&this.revertRedactionLocalEcho(i),n=!0)}return n}recalculate(){var e=this.currentState.getStateEvents(ee.RoomMember,this.myUserId);if(e){var n=e.getContent().membership;if(this.updateMyMembership(n),n===Ke.Invite){var r=e.getUnsigned().invite_room_state||[];r.forEach(s=>{var o=this.currentState.getStateEvents(s.type,s.state_key);o||this.currentState.setStateEvents([new es({type:s.type,state_key:s.state_key,content:s.content,event_id:"$fake"+Date.now(),room_id:this.roomId,sender:this.myUserId})])})}}var i=this.name;this.name=this.calculateRoomName(this.myUserId),this.normalizedName=Sve(this.name),this.summary=new hJ(this.roomId,{title:this.name}),i!==this.name&&this.emit(Me.Name,this)}addTags(e){this.tags=e.getContent().tags||{},this.emit(Me.Tags,e,this)}addAccountData(e){for(var n of e){n.getType()==="m.tag"&&this.addTags(n);var r=n.getType(),i=this.accountData.get(r);this.accountData.set(r,n),this.emit(Me.AccountData,n,this,i)}}getAccountData(e){return this.accountData.get(e)}_unstable_getStickyEvents(){return this.stickyEvents.getStickyEvents()}_unstable_getKeyedStickyEvent(e,n,r){return this.stickyEvents.getKeyedStickyEvent(e,n,r)}_unstable_getUnkeyedStickyEvent(e,n){return this.stickyEvents.getUnkeyedStickyEvent(e,n)}_unstable_addStickyEvents(e){return this.stickyEvents.addStickyEvents(e)}maySendMessage(){return this.getMyMembership()===Ke.Join&&(this.hasEncryptionStateEvent()?this.currentState.maySendEvent(ee.RoomMessageEncrypted,this.myUserId):this.currentState.maySendEvent(ee.RoomMessage,this.myUserId))}canInvite(e){var n=this.getMyMembership()===Ke.Join,r=this.currentState.getStateEvents(ee.RoomPowerLevels,""),i=r&&r.getContent(),s=this.getMember(e);return i&&s&&i.invite>s.powerLevel&&(n=!1),n}getJoinRule(){return this.currentState.getJoinRule()}getHistoryVisibility(){return this.currentState.getHistoryVisibility()}getGuestAccess(){return this.currentState.getGuestAccess()}getType(){var e=this.currentState.getStateEvents(ee.RoomCreate,"");if(!e){this.getTypeWarning||(N.warn("[getType] Room "+this.roomId+" does not have an m.room.create event"),this.getTypeWarning=!0);return}return e.getContent()[EC]}isSpaceRoom(){return this.getType()===Yg.Space}isCallRoom(){return this.getType()===Yg.UnstableCall}isElementVideoRoom(){return this.getType()===Yg.ElementVideo}findPredecessor(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n=this.getLiveTimeline().getState(Ue.FORWARDS);return n?n.findPredecessor(e):null}roomNameGenerator(e){if(this.client.roomNameGenerator){var n=this.client.roomNameGenerator(this.roomId,e);if(n!==null)return n}switch(e.type){case al.Actual:return e.name;case al.Generated:return e.subtype==="Inviting"?"Inviting ".concat(Q$(e.names,e.count)):Q$(e.names,e.count);case al.EmptyRoom:return e.oldName?"Empty room (was ".concat(e.oldName,")"):"Empty room"}}calculateRoomName(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!n){var r,i=(r=this.currentState.getStateEvents(ee.RoomName,""))===null||r===void 0?void 0:r.getContent().name;if(i&&typeof i=="string")return this.roomNameGenerator({type:al.Actual,name:i})}var s=this.getCanonicalAlias();if(s)return this.roomNameGenerator({type:al.Actual,name:s});var o=this.currentState.getJoinedMemberCount(),a=this.currentState.getInvitedMemberCount(),c=o+a-1,l=this.getFunctionalMembers(),d=[];if(this.heroes)this.heroes.forEach(R=>{if(l.includes(R.userId)){c--;return}if(R.displayName)d.push(R.displayName);else{var x=this.getMember(R.userId);d.push(x?x.name:R.userId)}});else{var h=this.currentState.getMembers().filter(R=>R.userId!==e&&(R.membership===Ke.Invite||R.membership===Ke.Join));h=h.filter(R=>{var{userId:x}=R;return l.includes(x)?(c--,!1):!0});var m=new Intl.Collator;h.sort((R,x)=>m.compare(R.userId,x.userId)),h=h.slice(0,5),d=h.map(R=>R.name)}if(c)return this.roomNameGenerator({type:al.Generated,names:d,count:c});var g=this.getMyMembership();if(g==Ke.Join){var y=this.currentState.getStateEvents(ee.RoomThirdPartyInvite);if(y!=null&&y.length){var v=y.map(R=>R.getContent().display_name);return this.roomNameGenerator({type:al.Generated,subtype:"Inviting",names:v,count:v.length+1})}}var E=d;E.length||(E=this.currentState.getMembers().filter(R=>R.userId!==e&&R.membership!==Ke.Invite&&R.membership!==Ke.Join).map(R=>R.name));var w;return E.length&&(w=this.roomNameGenerator({type:al.Generated,names:E,count:E.length+1})),this.roomNameGenerator({type:al.EmptyRoom,oldName:w})}applyNewVisibilityEvent(e){var n=e.asVisibilityChange();if(n){var r=e.getSender();if(r){var i=dp.name&&this.currentState.maySendStateEvent(dp.name,r)||dp.altName&&this.currentState.maySendStateEvent(dp.altName,r);if(i){var s=this.visibilityEvents.get(n.eventId);if(s){for(var o=s.length-1,a=Math.max(0,s.length-Nye);o>=a;--o){var c=s[o];if(c.getTs()<e.getTs())break}o===-1?s.unshift(e):s.splice(o+1,0,e)}else this.visibilityEvents.set(n.eventId,[e]);var l=this.findEventById(n.eventId);l&&l.applyVisibilityEvent(n)}}}}redactVisibilityChangeEvent(e){if(!e.isVisibilityEvent)throw new Error("expected a visibility change event");var n=e.getRelation(),r=n?.event_id,i=this.visibilityEvents.get(r);if(i){var s=i.findIndex(l=>l.getId()===e.getId());if(s!==-1&&(i.splice(s,1),s===i.length)){var o=this.findEventById(r);if(!o)return;if(s===0)this.visibilityEvents.delete(r),o.applyVisibilityEvent();else{var a=i[i.length-1],c=a.asVisibilityChange();if(!c)throw new Error("at this stage, visibility changes should be well-formed");o.applyVisibilityEvent(c)}}}}applyPendingVisibilityEvents(e){var n=this.visibilityEvents.get(e.getId());if(!(!n||n.length==0)){var r=n[n.length-1],i=r.asVisibilityChange();i&&(i.visible,!(r.getTs()<e.getTs())&&e.applyVisibilityEvent(i))}}getOldestThreadedReceiptTs(){return this.oldestThreadedReceiptTs}hasUserReadEvent(e,n){return this.roomReceipts.hasUserReadEvent(e,n)}getLastUnthreadedReceiptFor(e){return this.unthreadedReceipts.get(e)}fixupNotifications(e){super.fixupNotifications(e);var n=this.getThreads().filter(i=>this.getThreadUnreadNotificationCount(i.id,sn.Total)>0);for(var r of n)r.fixupNotifications(e)}compareEventOrdering(e,n){return vye(this,e,n)}hasEncryptionStateEvent(){var e;return!!(!((e=this.getLiveTimeline().getState(Ue.FORWARDS))===null||e===void 0)&&e.getStateEvents(ee.RoomEncryption,""))}};var Uye={[lt.ENCRYPTING]:[lt.SENDING,lt.NOT_SENT,lt.CANCELLED],[lt.SENDING]:[lt.ENCRYPTING,lt.QUEUED,lt.NOT_SENT,lt.SENT],[lt.QUEUED]:[lt.SENDING,lt.NOT_SENT,lt.CANCELLED],[lt.SENT]:[],[lt.NOT_SENT]:[lt.SENDING,lt.QUEUED,lt.CANCELLED],[lt.CANCELLED]:[]},al=(function(t){return t[t.EmptyRoom=0]="EmptyRoom",t[t.Generated=1]="Generated",t[t.Actual=2]="Actual",t})({});function Q$(t,e){var n=e-1;if(t.length){if(t.length===1&&n<=1)return t[0];if(t.length===2&&n<=2)return"".concat(t[0]," and ").concat(t[1]);var r=n>1;return r?"".concat(t[0]," and ").concat(n," others"):"".concat(t[0]," and 1 other")}else return"Empty room"}var hi=(function(t){return t[t.Stable=0]="Stable",t[t.Unstable=1]="Unstable",t[t.Unsupported=2]="Unsupported",t})({}),pi=(function(t){return t.Thread="Thread",t.ThreadUnreadNotifications="ThreadUnreadNotifications",t.LoginTokenRequest="LoginTokenRequest",t.RelationBasedRedactions="RelationBasedRedactions",t.AccountDataDeletion="AccountDataDeletion",t.RelationsRecursion="RelationsRecursion",t.IntentionalMentions="IntentionalMentions",t})({}),jye={[pi.Thread]:{unstablePrefixes:["org.matrix.msc3440"],matrixVersion:"v1.3"},[pi.ThreadUnreadNotifications]:{unstablePrefixes:["org.matrix.msc3771","org.matrix.msc3773"],matrixVersion:"v1.4"},[pi.LoginTokenRequest]:{unstablePrefixes:["org.matrix.msc3882"]},[pi.RelationBasedRedactions]:{unstablePrefixes:["org.matrix.msc3912"]},[pi.AccountDataDeletion]:{unstablePrefixes:["org.matrix.msc3391"]},[pi.RelationsRecursion]:{unstablePrefixes:["org.matrix.msc3981"],matrixVersion:"v1.10"},[pi.IntentionalMentions]:{unstablePrefixes:["org.matrix.msc3952_intentional_mentions"],matrixVersion:"v1.7"}};function Fye(t){return wA.apply(this,arguments)}function wA(){return wA=B(function*(t){var e=new Map;for(var[n,r]of Object.entries(jye)){var i,s,o,a,c=(i=(s=t.versions)===null||s===void 0?void 0:s.includes(r.matrixVersion||""))!==null&&i!==void 0?i:!1,l=(o=(a=r.unstablePrefixes)===null||a===void 0?void 0:a.every(d=>{var h;return((h=t.unstable_features)===null||h===void 0?void 0:h[d])===!0}))!==null&&o!==void 0?o:!1;c?e.set(n,hi.Stable):l?e.set(n,hi.Unstable):e.set(n,hi.Unsupported)}return e}),wA.apply(this,arguments)}function Z$(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function IC(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Z$(Object(n),!0).forEach(function(r){M(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Z$(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var eB=80*1e3,$ye=3,Qt=(function(t){return t.Error="ERROR",t.Prepared="PREPARED",t.Stopped="STOPPED",t.Syncing="SYNCING",t.Catchup="CATCHUP",t.Reconnecting="RECONNECTING",t})({}),Bye=["org.matrix.msc2716v3"];function tB(t,e){return"FILTER_SYNC_".concat(t)+(e?"_"+e:"")}var BJ=(function(t){return t.Offline="offline",t.Online="online",t.Unavailable="unavailable",t})({});function HJ(t){return IC({initialSyncLimit:8,resolveInvitesToProfiles:!1,pollTimeout:30*1e3,pendingEventOrdering:Lv.Chronological,threadSupport:!1},t)}function qJ(t){return IC({canResetEntireTimeline:e=>!1},t)}class bf{constructor(e,n,r){var i=this;this.client=e,M(this,"opts",void 0),M(this,"syncOpts",void 0),M(this,"_peekRoom",null),M(this,"currentSyncRequest",void 0),M(this,"abortController",void 0),M(this,"syncState",null),M(this,"syncStateData",void 0),M(this,"catchingUp",!1),M(this,"running",!1),M(this,"keepAliveTimer",void 0),M(this,"connectionReturnedResolvers",void 0),M(this,"notifEvents",[]),M(this,"failedSyncCount",0),M(this,"storeIsInvalid",!1),M(this,"presence",void 0),M(this,"getPushRules",B(function*(){try{i.syncOpts.logger.debug("Getting push rules...");var s=yield i.client.getPushRules();i.syncOpts.logger.debug("Got push rules"),i.client.pushRules=s}catch(o){return i.syncOpts.logger.error("Getting push rules failed",o),i.shouldAbortSync(o)?void 0:(i.syncOpts.logger.debug("Waiting for saved sync before retrying push rules..."),yield i.recoverFromSyncStartupError(i.savedSyncPromise,o),i.getPushRules())}})),M(this,"buildDefaultFilter",()=>{var s=new zo(this.client.credentials.userId);return this.client.canSupport.get(pi.ThreadUnreadNotifications)!==hi.Unsupported&&s.setUnreadThreadNotifications(!0),s}),M(this,"prepareLazyLoadingForSync",B(function*(){i.syncOpts.logger.debug("Prepare lazy loading for sync..."),i.client.isGuest()&&(i.opts.lazyLoadMembers=!1),i.opts.lazyLoadMembers&&(i.syncOpts.logger.debug("Enabling lazy load on sync filter..."),i.opts.filter||(i.opts.filter=i.buildDefaultFilter()),i.opts.filter.setLazyLoadMembers(!0))})),M(this,"storeClientOptions",B(function*(){try{i.syncOpts.logger.debug("Storing client options..."),yield i.client.storeClientOptions(),i.syncOpts.logger.debug("Stored client options")}catch(s){throw i.syncOpts.logger.error("Storing client options failed",s),s}})),M(this,"getFilter",B(function*(){i.syncOpts.logger.debug("Getting filter...");var s;i.opts.filter?s=i.opts.filter:s=i.buildDefaultFilter();var o;try{o=yield i.client.getOrCreateFilter(tB(i.client.credentials.userId),s)}catch(a){return i.syncOpts.logger.error("Getting filter failed",a),i.shouldAbortSync(a)?{}:(i.syncOpts.logger.debug("Waiting for saved sync before retrying filter..."),yield i.recoverFromSyncStartupError(i.savedSyncPromise,a),i.getFilter())}return{filter:s,filterId:o}})),M(this,"savedSyncPromise",void 0),M(this,"onOnline",()=>{this.syncOpts.logger.debug("Browser thinks we are back online"),this.startKeepAlives(0)}),this.opts=HJ(n),this.syncOpts=qJ(r),e.getNotifTimelineSet()&&e.reEmitter.reEmit(e.getNotifTimelineSet(),[Me.Timeline,Me.TimelineReset])}createRoom(e){var n=VJ(this.client,e,this.opts);return n.on(Rt.Marker,(r,i)=>{this.onMarkerStateEvent(n,r,i)}),n}onMarkerStateEvent(e,n){var{timelineWasEmpty:r}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(r){this.syncOpts.logger.debug("MarkerState: Ignoring markerEventId=".concat(n.getId()," in roomId=").concat(e.roomId," ")+"because the timeline was empty before the marker arrived which means there is nothing to refresh.");return}var i=Bye.includes(e.getVersion())||n.getSender()===e.getCreator();i?(this.syncOpts.logger.debug("MarkerState: Timeline needs to be refreshed because "+"a new markerEventId=".concat(n.getId()," was sent in roomId=").concat(e.roomId)),e.setTimelineNeedsRefresh(!0),e.emit(Me.HistoryImportedWithinTimeline,n,e)):this.syncOpts.logger.debug("MarkerState: Ignoring markerEventId=".concat(n.getId()," in roomId=").concat(e.roomId," because ")+"MSC2716 is not supported in the room version or for any room version, the marker wasn't sent by the room creator.")}syncLeftRooms(){var e=this;return B(function*(){var n,r=e.client,i=new zo(e.client.credentials.userId);i.setTimelineLimit(1),i.setIncludeLeaveRooms(!0);var s=e.opts.pollTimeout+eB,o=yield r.getOrCreateFilter(tB(r.credentials.userId,"LEFT_ROOMS"),i),a={timeout:0,filter:o,"org.matrix.msc4222.use_state_after":!0},c=yield r.http.authedRequest(fe.Get,"/sync",a,void 0,{localTimeoutMs:s}),l=[];(n=c.rooms)!==null&&n!==void 0&&n.leave&&(l=e.mapSyncResponseToRoomArray(c.rooms.leave));var d=yield Promise.all(l.map((function(){var h=B(function*(m){var g=m.room;if(m.isBrandNewRoom){m.timeline=m.timeline||{prev_batch:null,events:[]},g.getLiveTimeline().setPaginationToken(m.timeline.prev_batch,Ue.BACKWARDS);var{timelineEvents:y}=yield e.mapAndInjectRoomEvents(m);return g.recalculate(),r.store.storeRoom(g),r.emit(Pe.Room,g),e.processEventsForNotifs(g,y),g}});return function(m){return h.apply(this,arguments)}})()));return d.filter(Boolean)})()}peek(e){var n,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:20;if(((n=this._peekRoom)===null||n===void 0?void 0:n.roomId)===e)return Promise.resolve(this._peekRoom);var i=this.client;return this._peekRoom=this.createRoom(e),this.client.roomInitialSync(e,r).then(s=>{var o;if(((o=this._peekRoom)===null||o===void 0?void 0:o.roomId)!==e)throw new Error("Peeking aborted");s.messages=s.messages||{chunk:[]},s.messages.chunk=s.messages.chunk||[],s.state=s.state||[];var a=P_(s.state).map(i.getEventMapper()),c=s.state.map(i.getEventMapper()),l=s.messages.chunk.map(i.getEventMapper());return Array.isArray(s.presence)&&s.presence.map(i.getEventMapper()).forEach(function(d){var h=i.store.getUser(d.getContent().user_id);h?h.setPresenceEvent(d):(h=qu.createUser(d.getContent().user_id,i),h.setPresenceEvent(d),i.store.storeUser(h)),i.emit(Pe.Event,d)}),s.messages.start&&(this._peekRoom.oldState.paginationToken=s.messages.start),this._peekRoom.oldState.setStateEvents(a),this._peekRoom.currentState.setStateEvents(c),this.resolveInvites(this._peekRoom),this._peekRoom.recalculate(),this._peekRoom.addEventsToTimeline(l.reverse(),!0,!0,this._peekRoom.getLiveTimeline(),s.messages.start),i.store.storeRoom(this._peekRoom),i.emit(Pe.Room,this._peekRoom),this.peekPoll(this._peekRoom),this._peekRoom})}stopPeeking(){this._peekRoom=null}peekPoll(e,n){var r,i=this;if(this._peekRoom!==e){this.syncOpts.logger.debug("Stopped peeking in room %s",e.roomId);return}this.client.http.authedRequest(fe.Get,"/events",{room_id:e.roomId,timeout:String(30*1e3),from:n},void 0,{localTimeoutMs:50*1e3,abortSignal:(r=this.abortController)===null||r===void 0?void 0:r.signal}).then((function(){var s=B(function*(o){if(i._peekRoom!==e){i.syncOpts.logger.debug("Stopped peeking in room %s",e.roomId);return}o.chunk.filter(function(c){return c.type==="m.presence"}).map(i.client.getEventMapper()).forEach(c=>{var l=i.client.store.getUser(c.getContent().user_id);l?l.setPresenceEvent(c):(l=qu.createUser(c.getContent().user_id,i.client),l.setPresenceEvent(c),i.client.store.storeUser(l)),i.client.emit(Pe.Event,c)});var a=o.chunk.filter(function(c){return c.room_id===e.roomId&&c.event_id}).map(i.client.getEventMapper());yield e.addLiveEvents(a,{addToState:!0}),i.peekPoll(e,o.end)});return function(o){return s.apply(this,arguments)}})(),s=>{this.syncOpts.logger.error("[%s] Peek poll failed: %s",e.roomId,s),setTimeout(()=>{this.peekPoll(e,n)},30*1e3)})}getSyncState(){return this.syncState}getSyncStateData(){var e;return(e=this.syncStateData)!==null&&e!==void 0?e:null}recoverFromSyncStartupError(e,n){var r=this;return B(function*(){yield e;var i=r.startKeepAlives();r.updateSyncState(Qt.Error,{error:n}),yield i})()}shouldAbortSync(e){return e.errcode==="M_UNKNOWN_TOKEN"?(this.syncOpts.logger.warn("Token no longer valid - assuming logout"),this.stop(),this.updateSyncState(Qt.Error,{error:e}),!0):!1}sync(){var e=this;return B(function*(){var n,r;if(e.running=!0,e.abortController=new AbortController,(n=globalThis.window)===null||n===void 0||(r=n.addEventListener)===null||r===void 0||r.call(n,"online",e.onOnline,!1),e.client.isGuest())return e.doSync({});e.syncOpts.logger.debug("Getting saved sync token...");var i=e.client.store.getSavedSyncToken().then(d=>(e.syncOpts.logger.debug("Got saved sync token"),d));e.savedSyncPromise=e.client.store.getSavedSync().then(d=>{if(e.syncOpts.logger.debug("Got reply from saved sync, exists? ".concat(!!d)),d)return e.syncFromCache(d)}).catch(d=>{e.syncOpts.logger.error("Getting saved sync failed",d)}),yield e.getPushRules(),yield e.prepareLazyLoadingForSync(),yield e.storeClientOptions();var{filterId:s,filter:o}=yield e.getFilter();if(o){if(e.client.resetNotifTimelineSet(),!e.currentSyncRequest){var a=s,c=yield i;if(c)e.syncOpts.logger.debug("Sending first sync request...");else{e.syncOpts.logger.debug("Sending initial sync request...");var l=e.buildDefaultFilter();l.setDefinition(o.getDefinition()),l.setTimelineLimit(e.opts.initialSyncLimit),a=JSON.stringify(l.getDefinition())}e.currentSyncRequest=e.doSyncRequest({filter:a},c)}return e.syncOpts.logger.debug("Waiting for saved sync before starting sync processing..."),yield e.savedSyncPromise,e.doSync({filter:s})}})()}stop(){var e,n,r;this.syncOpts.logger.debug("SyncApi.stop"),(e=globalThis.window)===null||e===void 0||(n=e.removeEventListener)===null||n===void 0||n.call(e,"online",this.onOnline,!1),this.running=!1,(r=this.abortController)===null||r===void 0||r.abort(),this.keepAliveTimer&&(clearTimeout(this.keepAliveTimer),this.keepAliveTimer=void 0)}retryImmediately(){return this.connectionReturnedResolvers?(this.startKeepAlives(0),!0):!1}syncFromCache(e){var n=this;return B(function*(){n.syncOpts.logger.debug("sync(): not doing HTTP hit, instead returning stored /sync data");var r=e.nextBatch;n.client.store.setSyncToken(r);var i={nextSyncToken:r,catchingUp:!1,fromCache:!0},s={next_batch:r,rooms:e.roomsData,account_data:{events:e.accountData}};try{yield n.processSyncResponse(i,s)}catch(o){n.syncOpts.logger.error("Error processing cached sync",o)}n.storeIsInvalid||n.updateSyncState(Qt.Prepared,i)})()}doSync(e){var n=this;return B(function*(){for(;n.running;){var r=n.client.store.getSyncToken(),i=void 0;try{n.currentSyncRequest||(n.currentSyncRequest=n.doSyncRequest(e,r)),i=yield n.currentSyncRequest}catch(a){var s=yield n.onSyncError(a);if(s)return;continue}finally{n.currentSyncRequest=void 0}n.client.store.setSyncToken(i.next_batch),n.failedSyncCount=0;var o={oldSyncToken:r??void 0,nextSyncToken:i.next_batch,catchingUp:n.catchingUp};try{yield n.processSyncResponse(o,i)}catch(a){n.syncOpts.logger.error("Caught /sync error",a),n.client.emit(Pe.SyncUnexpectedError,a)}yield n.client.store.setSyncData(i),o.catchingUp=n.catchingUp,e.hasSyncedBefore||(n.updateSyncState(Qt.Prepared,o),e.hasSyncedBefore=!0),n.syncOpts.cryptoCallbacks&&(yield n.syncOpts.cryptoCallbacks.onSyncCompleted(o)),n.updateSyncState(Qt.Syncing,o),n.client.store.wantsSave()&&(yield n.client.store.save())}n.running||(n.syncOpts.logger.debug("Sync no longer running: exiting."),n.connectionReturnedResolvers&&(n.connectionReturnedResolvers.reject(),n.connectionReturnedResolvers=void 0),n.updateSyncState(Qt.Stopped))})()}doSyncRequest(e,n){var r,i=this.getSyncParams(e,n);return this.client.http.authedRequest(fe.Get,"/sync",i,void 0,{localTimeoutMs:i.timeout+eB,abortSignal:(r=this.abortController)===null||r===void 0?void 0:r.signal})}getSyncParams(e,n){var r=this.opts.pollTimeout;(this.getSyncState()!==Qt.Syncing||this.catchingUp)&&(this.catchingUp=!0,r=0);var i=e.filter;this.client.isGuest()&&!i&&(i=this.getGuestFilter());var s={filter:i,timeout:r,"org.matrix.msc4222.use_state_after":!0};return this.opts.disablePresence?s.set_presence=BJ.Offline:this.presence!==void 0&&(s.set_presence=this.presence),n?s.since=n:s._cacheBuster=Date.now(),[Qt.Reconnecting,Qt.Error].includes(this.getSyncState())&&(s.timeout=0),s}setPresence(e){this.presence=e}onSyncError(e){var n=this;return B(function*(){if(!n.running)return n.syncOpts.logger.debug("Sync no longer running: exiting"),n.connectionReturnedResolvers&&(n.connectionReturnedResolvers.reject(),n.connectionReturnedResolvers=void 0),n.updateSyncState(Qt.Stopped),!0;if(n.syncOpts.logger.error("/sync error %s",e),n.shouldAbortSync(e))return!0;n.failedSyncCount++,n.syncOpts.logger.debug("Number of consecutive failed sync requests:",n.failedSyncCount),n.syncOpts.logger.debug("Starting keep-alive");var r=n.startKeepAlives();n.currentSyncRequest=void 0,n.updateSyncState(n.failedSyncCount>=$ye?Qt.Error:Qt.Reconnecting,{error:e});var i=yield r;return i&&n.getSyncState()===Qt.Error&&n.updateSyncState(Qt.Catchup,{catchingUp:!0}),!1})()}processSyncResponse(e,n){var r=this;return B(function*(){var i,s,o,a,c=r.client;if(Array.isArray((i=n.presence)===null||i===void 0?void 0:i.events)&&n.presence.events.filter(wc).map(c.getEventMapper()).forEach(function(w){var R=c.store.getUser(w.getSender());R?R.setPresenceEvent(w):(R=qu.createUser(w.getSender(),c),R.setPresenceEvent(w),c.store.storeUser(R)),c.emit(Pe.Event,w)}),Array.isArray((s=n.account_data)===null||s===void 0?void 0:s.events)){var l=n.account_data.events.filter(wc).map(c.getEventMapper()),d=l.reduce((w,R)=>(w[R.getType()]=c.store.getAccountData(R.getType()),w),{});c.store.storeAccountDataEvents(l),l.forEach(function(w){if(w.getType()===ee.PushRules){var R=w.getContent();c.setPushRules(R)}var x=d[w.getType()];return c.emit(Pe.AccountData,w,x),w})}if(n.to_device&&Array.isArray(n.to_device.events)&&n.to_device.events.length>0){var h=n.to_device.events.filter(wc),m;r.syncOpts.cryptoCallbacks?m=yield r.syncOpts.cryptoCallbacks.preprocessToDeviceMessages(h):m=h.map(w=>({message:w,encryptionInfo:null})),KJ(m,c)}else r.catchingUp=!1;var g=[],y=[],v=[],E=[];n.rooms&&(n.rooms.invite&&(g=r.mapSyncResponseToRoomArray(n.rooms.invite)),n.rooms.join&&(y=r.mapSyncResponseToRoomArray(n.rooms.join)),n.rooms.leave&&(v=r.mapSyncResponseToRoomArray(n.rooms.leave)),n.rooms.knock&&(E=r.mapSyncResponseToRoomArray(n.rooms.knock))),r.notifEvents=[],yield Promise.all(g.map((function(){var w=B(function*(R){var x=R.room,C=r.mapSyncEventsFormat(R.invite_state,x);yield r.injectRoomEvents(x,C,void 0),R.isBrandNewRoom?(x.recalculate(),c.store.storeRoom(x),c.emit(Pe.Room,x)):x.recalculate(),C.forEach(function(k){c.emit(Pe.Event,k)})});return function(R){return w.apply(this,arguments)}})())),yield Promise.all(y.map((function(){var w=B(function*(R){var x,C=R.room,k=r.mapSyncEventsFormat(R.state,C),T=r.mapSyncEventsFormat(R["org.matrix.msc4222.state_after"],C),L=r.mapSyncEventsFormat(R.timeline,C,!1),O=r.mapSyncEventsFormat(R.ephemeral),P=r.mapSyncEventsFormat(R.account_data),D=r.mapSyncEventsFormat(R.msc4354_sticky),j=R["org.matrix.msc4222.state_after"]?T:k.concat(L),H=r.isRoomEncrypted(C,j);if(R.unread_notifications){if(!H||R.unread_notifications.notification_count===0){var z;C.setUnreadNotificationCount(sn.Total,(z=R.unread_notifications.notification_count)!==null&&z!==void 0?z:0)}if(!H||C.getUnreadNotificationCount(sn.Highlight)<=0){var Y;C.setUnreadNotificationCount(sn.Highlight,(Y=R.unread_notifications.highlight_count)!==null&&Y!==void 0?Y:0)}}var W=(x=R[kb.name])!==null&&x!==void 0?x:R[kb.altName];if(W){C.resetThreadUnreadNotificationCountFromSync(Object.keys(W));for(var[F,$]of Object.entries(W)){if(!H||$.notification_count===0){var V;C.setThreadUnreadNotificationCount(F,sn.Total,(V=$.notification_count)!==null&&V!==void 0?V:0)}var G=C.getThreadUnreadNotificationCount(F,sn.Highlight)<=0;if(!H||H&&G){var Z;C.setThreadUnreadNotificationCount(F,sn.Highlight,(Z=$.highlight_count)!==null&&Z!==void 0?Z:0)}}}else C.resetThreadUnreadNotificationCountFromSync();if(R.timeline=R.timeline||{},R.isBrandNewRoom)R.timeline.prev_batch!==null&&C.getLiveTimeline().setPaginationToken(R.timeline.prev_batch,Ue.BACKWARDS);else if(R.timeline.limited){for(var q=!0,J=L.length-1;J>=0;J--){var ue=L[J].getId();if(C.getTimelineForEvent(ue)){r.syncOpts.logger.debug("Already have event ".concat(ue," in limited sync - not resetting")),q=!1,L.splice(0,J);break}}if(q){var ge;C.resetLiveTimeline(R.timeline.prev_batch,r.syncOpts.canResetEntireTimeline(C.roomId)?null:(ge=e.oldSyncToken)!==null&&ge!==void 0?ge:null),c.resetNotifTimelineSet()}}if(r.syncOpts.cryptoCallbacks)for(var Re of j)Re.isState()&&Re.getType()===ee.RoomEncryption&&Re.getStateKey()===""&&(yield r.syncOpts.cryptoCallbacks.onCryptoEvent(C,Re));for(var we of L.filter(De=>De.isState()))yield r.client.decryptEventIfNeeded(we);try{"org.matrix.msc4222.state_after"in R?yield r.injectRoomEvents(C,void 0,T,L,e.fromCache):yield r.injectRoomEvents(C,k,void 0,L,e.fromCache)}catch(De){r.syncOpts.logger.error("Failed to process events on room ".concat(C.roomId,":"),De)}R.summary&&C.setSummary(R.summary),C.addEphemeralEvents(O),C.addAccountData(P);var de=D.concat(L.filter(De=>De.unstableStickyInfo!==void 0));C._unstable_addStickyEvents(de),C.recalculate(),R.isBrandNewRoom&&(c.store.storeRoom(C),c.emit(Pe.Room,C)),r.processEventsForNotifs(C,L);var ke=De=>c.emit(Pe.Event,De);k.forEach(ke),L.forEach(ke),O.forEach(ke),P.forEach(ke),D.filter(De=>!L.some(Je=>Je.getId()===De.getId())).forEach(ke),C.decryptCriticalEvents()});return function(R){return w.apply(this,arguments)}})())),yield Promise.all(v.map((function(){var w=B(function*(R){var x=R.room,{timelineEvents:C,stateEvents:k,stateAfterEvents:T}=yield r.mapAndInjectRoomEvents(R),L=r.mapSyncEventsFormat(R.account_data);x.addAccountData(L),x.recalculate(),R.isBrandNewRoom&&(c.store.storeRoom(x),c.emit(Pe.Room,x)),r.processEventsForNotifs(x,C),k?.forEach(function(O){c.emit(Pe.Event,O)}),T?.forEach(function(O){c.emit(Pe.Event,O)}),C.forEach(function(O){c.emit(Pe.Event,O)}),L.forEach(function(O){c.emit(Pe.Event,O)})});return function(R){return w.apply(this,arguments)}})())),yield Promise.all(E.map((function(){var w=B(function*(R){var x=R.room,C=r.mapSyncEventsFormat(R.knock_state,x);yield r.injectRoomEvents(x,C,void 0),R.isBrandNewRoom?(x.recalculate(),c.store.storeRoom(x),c.emit(Pe.Room,x)):x.recalculate(),C.forEach(function(k){c.emit(Pe.Event,k)})});return function(R){return w.apply(this,arguments)}})())),e.oldSyncToken&&r.notifEvents.length&&(r.notifEvents.sort(function(w,R){return w.getTs()-R.getTs()}),r.notifEvents.forEach(function(w){var R;(R=c.getNotifTimelineSet())===null||R===void 0||R.addLiveEvent(w,{addToState:!0})})),n.device_lists&&r.syncOpts.cryptoCallbacks&&(yield r.syncOpts.cryptoCallbacks.processDeviceLists(n.device_lists)),yield(o=r.syncOpts.cryptoCallbacks)===null||o===void 0?void 0:o.processKeyCounts(n.device_one_time_keys_count,(a=n.device_unused_fallback_key_types)!==null&&a!==void 0?a:n["org.matrix.msc2732.device_unused_fallback_key_types"])})()}startKeepAlives(e){return e===void 0&&(e=2e3+Math.floor(Math.random()*5e3)),this.keepAliveTimer!==null&&clearTimeout(this.keepAliveTimer),e>0?this.keepAliveTimer=setTimeout(this.pokeKeepAlive.bind(this),e):this.pokeKeepAlive(),this.connectionReturnedResolvers||(this.connectionReturnedResolvers=Promise.withResolvers()),this.connectionReturnedResolvers.promise}pokeKeepAlive(){var e,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(!this.running){clearTimeout(this.keepAliveTimer),this.connectionReturnedResolvers&&(this.connectionReturnedResolvers.reject("SyncApi.stop() was called"),this.connectionReturnedResolvers=void 0);return}var r=()=>{clearTimeout(this.keepAliveTimer),this.connectionReturnedResolvers&&(this.connectionReturnedResolvers.resolve(n),this.connectionReturnedResolvers=void 0)};this.client.http.request(fe.Get,"/_matrix/client/versions",void 0,void 0,{prefix:"",localTimeoutMs:15*1e3,abortSignal:(e=this.abortController)===null||e===void 0?void 0:e.signal}).then(()=>{r()},i=>{i.httpStatus==400||i.httpStatus==404?this.keepAliveTimer=setTimeout(r,2e3):(n=!0,this.keepAliveTimer=setTimeout(this.pokeKeepAlive.bind(this,n),5e3+Math.floor(Math.random()*5e3)),this.updateSyncState(Qt.Error,{error:i}))})}mapSyncResponseToRoomArray(e){var n=this.client;return Object.keys(e).filter(r=>!$1(r)).map(r=>{var i=n.store.getRoom(r),s=!1;return i||(i=this.createRoom(r),s=!0),IC(IC({},e[r]),{},{room:i,isBrandNewRoom:s})})}mapSyncEventsFormat(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!e||!Array.isArray(e.events))return[];var i=this.client.getEventMapper({decrypt:r});return e.events.filter(wc).map(function(s){return n&&(s.room_id=n.roomId),i(s)})}resolveInvites(e){if(!(!e||!this.opts.resolveInvitesToProfiles)){var n=this.client;e.getMembersWithMembership(Ke.Invite).forEach(function(r){if(!r.requestedProfileInfo){r.requestedProfileInfo=!0;var i=n.getUser(r.userId),s;i?s=Promise.resolve({avatar_url:i.avatarUrl,displayname:i.displayName}):s=n.getProfileInfo(r.userId),s.then(function(o){var a=r.events.member;a?.getContent().membership===Ke.Invite&&(a.getContent().avatar_url=o.avatar_url,a.getContent().displayname=o.displayname,r.setMembershipEvent(a,e.currentState))},function(o){})}})}}findEncryptionEvent(e){return e?.find(n=>n.getType()===ee.RoomEncryption&&n.getStateKey()==="")}isRoomEncrypted(e,n){return e.hasEncryptionStateEvent()||!!this.findEncryptionEvent(n)}mapAndInjectRoomEvents(e){var n=this;return B(function*(){var r=n.mapSyncEventsFormat(e.state,e.room),i=n.mapSyncEventsFormat(e["org.matrix.msc4222.state_after"],e.room),s=n.mapSyncEventsFormat(e.timeline,e.room);return"org.matrix.msc4222.state_after"in e?yield n.injectRoomEvents(e.room,void 0,i,s):yield n.injectRoomEvents(e.room,r,void 0,s),{timelineEvents:s,stateEvents:r,stateAfterEvents:i}})()}injectRoomEvents(e,n,r,i){var s=arguments,o=this;return B(function*(){var a=s.length>4&&s[4]!==void 0?s[4]:!1,c=r??n,l=e.getLiveTimeline(),d=l.getEvents().length==0;if(d){for(var h of c)o.client.getPushActionsForEvent(h);l.initialiseState(c,{timelineWasEmpty:d})}o.resolveInvites(e),e.recalculate(),d||(e.oldState.setStateEvents(c),e.currentState.setStateEvents(c)),yield e.addLiveEvents(i||[],{fromCache:a,timelineWasEmpty:d,addToState:r===void 0}),o.client.processBeaconEvents(e,i)})()}processEventsForNotifs(e,n){if(this.client.getNotifTimelineSet())for(var r of n){var i,s=this.client.getPushActionsForEvent(r);s!=null&&s.notify&&(i=s.tweaks)!==null&&i!==void 0&&i.highlight&&this.notifEvents.push(r)}}getGuestFilter(){return"{}"}updateSyncState(e,n){var r=this.syncState;this.syncState=e,this.syncStateData=n,this.client.emit(Pe.Sync,this.syncState,r,n)}}function VJ(t,e,n){var{timelineSupport:r}=t,i=new _T(e,t,t.getUserId(),{lazyLoadMembers:n.lazyLoadMembers,pendingEventOrdering:n.pendingEventOrdering,timelineSupport:r});return t.reEmitter.reEmit(i,[Me.Name,Me.Redaction,Me.RedactionCancelled,Me.Receipt,Me.Tags,Me.LocalEchoUpdated,Me.AccountData,Me.MyMembership,Me.Timeline,Me.TimelineReset,Rt.Events,Rt.Members,Rt.NewMember,Rt.Update,Qn.New,Qn.Update,Qn.Destroy,Qn.LivenessChange]),i.on(Rt.NewMember,(s,o,a)=>{var c;a.user=(c=t.getUser(a.userId))!==null&&c!==void 0?c:void 0,t.reEmitter.reEmit(a,[ao.Name,ao.Typing,ao.PowerLevel,ao.Membership])}),i}function KJ(t,e){var n=[];t.map(r=>{if(r.message.type==="m.key.verification.cancel"){var i=r.message.content.transaction_id;i&&n.push(i)}return r}).forEach(function(r){{var i=r.message,s=i.content,o=new es(Object.assign({},i));if(i.type==="m.key.verification.start"||i.type==="m.key.verification.request"){var a=s.transaction_id;n.includes(a)&&o.flagCancelled()}r.encryptionInfo&&o.makeEncrypted(ee.RoomMessageEncrypted,{ciphertext:""},r.encryptionInfo.senderCurve25519KeyBase64,""),e.emit(Pe.ToDeviceEvent,o)}e.emit(Pe.ReceivedToDeviceMessage,r)})}class Hye{constructor(){M(this,"accountData",new Map),M(this,"fromToken",null)}isNewlyCreated(){return Promise.resolve(!0)}getSyncToken(){return this.fromToken}setSyncToken(e){this.fromToken=e}storeRoom(e){}getRoom(e){return null}getRooms(){return[]}removeRoom(e){}getRoomSummaries(){return[]}storeUser(e){}getUser(e){return null}getUsers(){return[]}scrollback(e,n){return[]}setUserCreator(e){}storeEvents(e,n,r,i){}storeFilter(e){}getFilter(e,n){return null}getFilterIdByName(e){return null}setFilterIdByName(e,n){}storeAccountDataEvents(e){}getAccountData(e){}setSyncData(e){return Promise.resolve()}wantsSave(){return!1}save(){return Promise.resolve()}startup(){return Promise.resolve()}getSavedSync(){return Promise.resolve(null)}getSavedSyncToken(){return Promise.resolve(null)}deleteAllData(){return Promise.resolve()}getOutOfBandMembers(){return Promise.resolve(null)}setOutOfBandMembers(e,n){return Promise.resolve()}clearOutOfBandMembers(){return Promise.resolve()}getClientOptions(){return Promise.resolve(void 0)}storeClientOptions(e){return Promise.resolve()}getPendingEvents(e){return B(function*(){return[]})()}setPendingEvents(e,n){return Promise.resolve()}saveToDeviceBatches(e){return B(function*(){return Promise.resolve()})()}getOldestToDeviceBatch(){return Promise.resolve(null)}removeToDeviceBatch(e){return B(function*(){return Promise.resolve()})()}destroy(){return B(function*(){})()}}const zi=[];for(let t=0;t<256;++t)zi.push((t+256).toString(16).slice(1));function qye(t,e=0){return(zi[t[e+0]]+zi[t[e+1]]+zi[t[e+2]]+zi[t[e+3]]+"-"+zi[t[e+4]]+zi[t[e+5]]+"-"+zi[t[e+6]]+zi[t[e+7]]+"-"+zi[t[e+8]]+zi[t[e+9]]+"-"+zi[t[e+10]]+zi[t[e+11]]+zi[t[e+12]]+zi[t[e+13]]+zi[t[e+14]]+zi[t[e+15]]).toLowerCase()}let JI;const Vye=new Uint8Array(16);function Kye(){if(!JI){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");JI=crypto.getRandomValues.bind(crypto)}return JI(Vye)}const Gye=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),nB={randomUUID:Gye};function zye(t,e,n){t=t||{};const r=t.random??t.rng?.()??Kye();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,qye(r)}function GJ(t,e,n){return nB.randomUUID&&!t?nB.randomUUID():zye(t)}var dc={},QI={},ZI={exports:{}},rB;function iP(){if(rB)return ZI.exports;rB=1;var t=ZI.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{push:"msid",reg:/^msid:([\w-]+)(?: ([\w-]+))?/,names:["id","appdata"],format:"msid:%s %s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var n="candidate:%s %d %s %d %s %d typ %s";return n+=e.raddr!=null?" raddr %s rport %d":"%v%v",n+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(n+=" generation %d"),n+=e["network-id"]!=null?" network-id %d":"%v",n+=e["network-cost"]!=null?" network-cost %d":"%v",n}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var n="ssrc:%d";return e.attribute!=null&&(n+=" %s",e.value!=null&&(n+=":%s")),n}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var n="mediaclk:";return n+=e.id!=null?"id=%s %s":"%v%s",n+=e.mediaClockValue!=null?"=%s":"",n+=e.rateNumerator!=null?" rate=%s":"",n+=e.rateDenominator!=null?"/%s":"",n}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(t).forEach(function(e){var n=t[e];n.forEach(function(r){r.reg||(r.reg=/(.*)/),r.format||(r.format="%s")})}),ZI.exports}var iB;function Wye(){return iB||(iB=1,(function(t){var e=function(a){return String(Number(a))===a?Number(a):a},n=function(a,c,l,d){if(d&&!l)c[d]=e(a[1]);else for(var h=0;h<l.length;h+=1)a[h+1]!=null&&(c[l[h]]=e(a[h+1]))},r=function(a,c,l){var d=a.name&&a.names;a.push&&!c[a.push]?c[a.push]=[]:d&&!c[a.name]&&(c[a.name]={});var h=a.push?{}:d?c[a.name]:c;n(l.match(a.reg),h,a.names,a.name),a.push&&c[a.push].push(h)},i=iP(),s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(a){var c={},l=[],d=c;return a.split(/(\r\n|\r|\n)/).filter(s).forEach(function(h){var m=h[0],g=h.slice(2);m==="m"&&(l.push({rtp:[],fmtp:[]}),d=l[l.length-1]);for(var y=0;y<(i[m]||[]).length;y+=1){var v=i[m][y];if(v.reg.test(g))return r(v,d,g)}}),c.media=l,c};var o=function(a,c){var l=c.split(/=(.+)/,2);return l.length===2?a[l[0]]=e(l[1]):l.length===1&&c.length>1&&(a[l[0]]=void 0),a};t.parseParams=function(a){return a.split(/;\s?/).reduce(o,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(a){return a.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(a){for(var c=[],l=a.split(" ").map(e),d=0;d<l.length;d+=3)c.push({component:l[d],ip:l[d+1],port:l[d+2]});return c},t.parseImageAttributes=function(a){return a.split(" ").map(function(c){return c.substring(1,c.length-1).split(",").reduce(o,{})})},t.parseSimulcastStreamList=function(a){return a.split(";").map(function(c){return c.split(",").map(function(l){var d,h=!1;return l[0]!=="~"?d=e(l):(d=e(l.substring(1,l.length)),h=!0),{scid:d,paused:h}})})}})(QI)),QI}var ex,sB;function Yye(){if(sB)return ex;sB=1;var t=iP(),e=/%[sdv%]/g,n=function(o){var a=1,c=arguments,l=c.length;return o.replace(e,function(d){if(a>=l)return d;var h=c[a];switch(a+=1,d){case"%%":return"%";case"%s":return String(h);case"%d":return Number(h);case"%v":return""}})},r=function(o,a,c){var l=a.format instanceof Function?a.format(a.push?c:c[a.name]):a.format,d=[o+"="+l];if(a.names)for(var h=0;h<a.names.length;h+=1){var m=a.names[h];a.name?d.push(c[a.name][m]):d.push(c[a.names[h]])}else d.push(c[a.name]);return n.apply(null,d)},i=["v","o","s","i","u","e","p","c","b","t","r","z","a"],s=["i","c","b","a"];return ex=function(o,a){a=a||{},o.version==null&&(o.version=0),o.name==null&&(o.name=" "),o.media.forEach(function(h){h.payloads==null&&(h.payloads="")});var c=a.outerOrder||i,l=a.innerOrder||s,d=[];return c.forEach(function(h){t[h].forEach(function(m){m.name in o&&o[m.name]!=null?d.push(r(h,m,o)):m.push in o&&o[m.push]!=null&&o[m.push].forEach(function(g){d.push(r(h,m,g))})})}),o.media.forEach(function(h){d.push(r("m",t.m[0],h)),l.forEach(function(m){t[m].forEach(function(g){g.name in h&&h[g.name]!=null?d.push(r(m,g,h)):g.push in h&&h[g.push]!=null&&h[g.push].forEach(function(y){d.push(r(m,g,y))})})})}),d.join(`\r
`)+`\r
`},ex}var oB;function Xye(){if(oB)return dc;oB=1;var t=Wye(),e=Yye(),n=iP();return dc.grammar=n,dc.write=e,dc.parse=t.parse,dc.parseParams=t.parseParams,dc.parseFmtpConfig=t.parseFmtpConfig,dc.parsePayloads=t.parsePayloads,dc.parseRemoteCandidates=t.parseRemoteCandidates,dc.parseImageAttributes=t.parseImageAttributes,dc.parseSimulcastStreamList=t.parseSimulcastStreamList,dc}var EA=Xye();function sP(t,e){if(typeof t.toBase64=="function")return t.toBase64(e);var n=btoa(t.reduce((r,i)=>r+String.fromCharCode(i),""));return e.omitPadding&&(n=n.replace(/={1,2}$/,"")),e.alphabet==="base64url"&&(n=n.replace(/\+/g,"-").replace(/\//g,"_")),n}function H1(t){return sP(t,{alphabet:"base64",omitPadding:!1})}function oP(t){return sP(t,{alphabet:"base64",omitPadding:!0})}function ST(t){return sP(t,{alphabet:"base64url",omitPadding:!0})}function Jye(t,e){return typeof Uint8Array.fromBase64=="function"?Uint8Array.fromBase64(t,e):Uint8Array.from(atob(t),n=>n.charCodeAt(0))}function gp(t){return Jye(t.replace(/-/g,"+").replace(/_/g,"/"),{alphabet:"base64",lastChunkHandling:"loose"})}var Qye="abcdefghijklmnopqrstuvwxyz",Zye="ABCDEFGHIJKLMNOPQRSTUVWXYZ",e0e="0123456789";function zJ(t){var e=new Uint8Array(t);return globalThis.crypto.getRandomValues(e),ST(e)}function Qo(t){return t0e(t,Zye+Qye+e0e)}function t0e(t,e){if(e.length<2||e.length>256)throw new Error("Character set must be between 2 and 256 characters long");if(t<1||t>32768)throw new Error("Requested random string length must be between 1 and 32768");for(var n=256-256%e.length,r=new Uint8Array(Math.floor(t*1.3)),i=r.length,s=[];s.length<t;){i===r.length&&(globalThis.crypto.getRandomValues(r),i=0);var o=r[i++];o<n&&s.push(e[o%e.length])}return s.join("")}var Wd="org.matrix.msc3077.sdp_stream_metadata",On=(function(t){return t.Usermedia="m.usermedia",t.Screenshare="m.screenshare",t})({}),q1=null,CA=0,n0e=()=>(q1===null&&(q1=new AudioContext),CA++,q1),r0e=()=>{if(CA--,CA===0){var t;(t=q1)===null||t===void 0||t.close(),q1=null}},i0e=200,TA=-60,s0e=8,cl=(function(t){return t.NewStream="new_stream",t.MuteStateChanged="mute_state_changed",t.LocalVolumeChanged="local_volume_changed",t.VolumeChanged="volume_changed",t.ConnectedChanged="connected_changed",t.Speaking="speaking",t.Disposed="disposed",t})({});class Au extends Gn{constructor(e){super(),M(this,"stream",void 0),M(this,"sdpMetadataStreamId",void 0),M(this,"userId",void 0),M(this,"deviceId",void 0),M(this,"purpose",void 0),M(this,"speakingVolumeSamples",void 0),M(this,"client",void 0),M(this,"call",void 0),M(this,"roomId",void 0),M(this,"audioMuted",void 0),M(this,"videoMuted",void 0),M(this,"localVolume",1),M(this,"measuringVolumeActivity",!1),M(this,"audioContext",void 0),M(this,"analyser",void 0),M(this,"frequencyBinCount",void 0),M(this,"speakingThreshold",TA),M(this,"speaking",!1),M(this,"volumeLooperTimeout",void 0),M(this,"_disposed",!1),M(this,"_connected",!1),M(this,"onAddTrack",()=>{this.emit(cl.NewStream,this.stream)}),M(this,"onCallState",n=>{n===ft.Connected?this.connected=!0:n===ft.Connecting&&(this.connected=!1)}),M(this,"volumeLooper",()=>{if(this.analyser&&this.measuringVolumeActivity){this.analyser.getFloatFrequencyData(this.frequencyBinCount);var n=-1/0;for(var r of this.frequencyBinCount)r>n&&(n=r);this.speakingVolumeSamples.shift(),this.speakingVolumeSamples.push(n),this.emit(cl.VolumeChanged,n);var i=!1;for(var s of this.speakingVolumeSamples)if(s>this.speakingThreshold){i=!0;break}this.speaking!==i&&(this.speaking=i,this.emit(cl.Speaking,this.speaking)),this.volumeLooperTimeout=setTimeout(this.volumeLooper,i0e)}}),this.client=e.client,this.call=e.call,this.roomId=e.roomId,this.userId=e.userId,this.deviceId=e.deviceId,this.purpose=e.purpose,this.audioMuted=e.audioMuted,this.videoMuted=e.videoMuted,this.speakingVolumeSamples=new Array(s0e).fill(-1/0),this.sdpMetadataStreamId=e.stream.id,this.updateStream(null,e.stream),this.stream=e.stream,this.hasAudioTrack&&this.initVolumeMeasuring(),e.call&&(e.call.addListener(At.State,this.onCallState),this.onCallState(e.call.state))}get connected(){return this.isLocal()||this._connected}set connected(e){this._connected=e,this.emit(cl.ConnectedChanged,this.connected)}get hasAudioTrack(){return this.stream.getAudioTracks().length>0}updateStream(e,n){if(n!==e){var r=this.measuringVolumeActivity;e&&(e.removeEventListener("addtrack",this.onAddTrack),this.measureVolumeActivity(!1)),this.stream=n,n.addEventListener("addtrack",this.onAddTrack),this.hasAudioTrack?(this.initVolumeMeasuring(),r&&this.measureVolumeActivity(!0)):this.measureVolumeActivity(!1),this.emit(cl.NewStream,this.stream)}}initVolumeMeasuring(){if(this.hasAudioTrack){this.audioContext||(this.audioContext=n0e()),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=512,this.analyser.smoothingTimeConstant=.1;var e=this.audioContext.createMediaStreamSource(this.stream);e.connect(this.analyser),this.frequencyBinCount=new Float32Array(this.analyser.frequencyBinCount)}}getMember(){var e,n=this.client.getRoom(this.roomId);return(e=n?.getMember(this.userId))!==null&&e!==void 0?e:null}isLocal(){return this.userId===this.client.getUserId()&&(this.deviceId===void 0||this.deviceId===this.client.getDeviceId())}isAudioMuted(){return this.stream.getAudioTracks().length===0||this.audioMuted}isVideoMuted(){return this.stream.getVideoTracks().length===0||this.videoMuted}isSpeaking(){return this.speaking}setNewStream(e){this.updateStream(this.stream,e)}setAudioVideoMuted(e,n){e!==null&&(this.audioMuted!==e&&this.speakingVolumeSamples.fill(-1/0),this.audioMuted=e),n!==null&&(this.videoMuted=n),this.emit(cl.MuteStateChanged,this.audioMuted,this.videoMuted)}measureVolumeActivity(e){if(e){if(!this.analyser||!this.frequencyBinCount||!this.hasAudioTrack)return;this.measuringVolumeActivity=!0,this.volumeLooper()}else this.measuringVolumeActivity=!1,this.speakingVolumeSamples.fill(-1/0),this.emit(cl.VolumeChanged,-1/0)}setSpeakingThreshold(e){this.speakingThreshold=e}clone(){var e=this.client.getMediaHandler(),n=this.stream.clone();return N.log("CallFeed clone() cloning stream (originalStreamId=".concat(this.stream.id,", newStreamId").concat(n.id,")")),this.purpose===On.Usermedia?e.userMediaStreams.push(n):e.screensharingStreams.push(n),new Au({client:this.client,roomId:this.roomId,userId:this.userId,deviceId:this.deviceId,stream:n,purpose:this.purpose,audioMuted:this.audioMuted,videoMuted:this.videoMuted})}dispose(){var e,n;clearTimeout(this.volumeLooperTimeout),(e=this.stream)===null||e===void 0||e.removeEventListener("addtrack",this.onAddTrack),(n=this.call)===null||n===void 0||n.removeListener(At.State,this.onCallState),this.audioContext&&(this.audioContext=void 0,this.analyser=void 0,r0e()),this._disposed=!0,this.emit(cl.Disposed)}get disposed(){return this._disposed}set disposed(e){this._disposed=e}getLocalVolume(){return this.localVolume}setLocalVolume(e){this.localVolume=e,this.emit(cl.LocalVolumeChanged,e)}}var o0e=3e3,RA=(function(t){return t.Incoming="Call.incoming",t})({});class a0e{constructor(e){M(this,"calls",void 0),M(this,"callEventBuffer",void 0),M(this,"nextSeqByCall",new Map),M(this,"toDeviceEventBuffers",new Map),M(this,"client",void 0),M(this,"candidateEventsByCall",void 0),M(this,"eventBufferPromiseChain",void 0),M(this,"onSync",()=>{var n=this.callEventBuffer;this.callEventBuffer=[],this.eventBufferPromiseChain?this.eventBufferPromiseChain=this.eventBufferPromiseChain.then(()=>this.evaluateEventBuffer(n)):this.eventBufferPromiseChain=this.evaluateEventBuffer(n)}),M(this,"onRoomTimeline",n=>{this.callEventBuffer.push(n)}),M(this,"onToDeviceEvent",n=>{var r=n.getContent();if(!r.call_id){this.callEventBuffer.push(n);return}if(this.nextSeqByCall.has(r.call_id)||this.nextSeqByCall.set(r.call_id,0),r.seq===void 0){this.callEventBuffer.push(n);return}var i=this.nextSeqByCall.get(r.call_id)||0;if(r.seq!==i){this.toDeviceEventBuffers.has(r.call_id)||this.toDeviceEventBuffers.set(r.call_id,[]);var s=this.toDeviceEventBuffers.get(r.call_id),o=s.findIndex(d=>d.getContent().seq>r.seq);o===-1?s.push(n):s.splice(o,0,n)}else{var a=r.call_id;this.callEventBuffer.push(n),this.nextSeqByCall.set(a,r.seq+1);for(var c=this.toDeviceEventBuffers.get(a),l=c&&c.shift();l&&l.getContent().seq===this.nextSeqByCall.get(a);)this.callEventBuffer.push(l),this.nextSeqByCall.set(a,l.getContent().seq+1),l=c.shift()}}),this.client=e,this.calls=new Map,this.callEventBuffer=[],this.candidateEventsByCall=new Map}start(){this.client.on(Pe.Sync,this.onSync),this.client.on(Me.Timeline,this.onRoomTimeline),this.client.on(Pe.ToDeviceEvent,this.onToDeviceEvent)}stop(){this.client.removeListener(Pe.Sync,this.onSync),this.client.removeListener(Me.Timeline,this.onRoomTimeline),this.client.removeListener(Pe.ToDeviceEvent,this.onToDeviceEvent)}evaluateEventBuffer(e){var n=this;return B(function*(){yield Promise.all(e.map(d=>n.client.decryptEventIfNeeded(d)));var r=e.filter(d=>{var h=d.getType();return h.startsWith("m.call.")||h.startsWith("org.matrix.call.")}),i=new Set;for(var s of r){var o=s.getType();(o===ee.CallAnswer||o===ee.CallHangup)&&i.add(s.getContent().call_id)}for(var a of r){var c=a.getType(),l=a.getContent().call_id;if(!(c===ee.CallInvite&&i.has(l)))try{yield n.handleCallEvent(a)}catch(d){N.error("CallEventHandler evaluateEventBuffer() caught exception handling call event",d)}}})()}handleCallEvent(e){var n=this;return B(function*(){var r;n.client.emit(Pe.ReceivedVoipEvent,e);var i=e.getContent(),s=e.getRoomId()||((r=n.client.groupCallEventHandler.getGroupCallById(i.conf_id))===null||r===void 0||(r=r.room)===null||r===void 0?void 0:r.roomId),o=i.conf_id,a=e.getType(),c=e.getSender(),l=i.call_id?n.calls.get(i.call_id):void 0,d,h;if(o){if(h=n.client.groupCallEventHandler.getGroupCallById(o),!h){N.warn("CallEventHandler handleCallEvent() could not find a group call - ignoring event (groupCallId=".concat(o,", type=").concat(a,")"));return}if(d=i.device_id,!d){N.warn("CallEventHandler handleCallEvent() could not find a device id - ignoring event (senderId=".concat(c,")")),h.emit(Mn.Error,new XJ(c));return}if(i.dest_session_id!==n.client.getSessionId()){N.warn("CallEventHandler handleCallEvent() call event does not match current session id - ignoring");return}}var m=c===n.client.credentials.userId&&(d===void 0||d===n.client.getDeviceId());if(s){if(a===ee.CallInvite){var g,y,v;if(m||e.getLocalAge()>i.lifetime-o0e||l&&l.state===ft.Ended||(l&&N.warn("CallEventHandler handleCallEvent() already has a call but got an invite - clobbering (callId=".concat(i.call_id,")")),i.invitee&&i.invitee!==n.client.getUserId()))return;var E=((g=n.client.getTurnServersExpiry())!==null&&g!==void 0?g:0)-Date.now();if(N.info("CallEventHandler handleCallEvent() current turn creds expire in "+E+" ms"),l=(y=Ab(n.client,s,{forceTURN:n.client.forceTURN,opponentDeviceId:d,groupCallId:o,opponentSessionId:i.sender_session_id}))!==null&&y!==void 0?y:void 0,!l){N.log("CallEventHandler handleCallEvent() this client does not support WebRTC (callId=".concat(i.call_id,")"));return}l.callId=i.call_id;var w=(v=h)===null||v===void 0?void 0:v.getGroupCallStats();w&&l.initStats(w);try{yield l.initWithInvite(e)}catch(P){if(P instanceof vu)if(P.code===K1.UnknownDevice){var R;(R=h)===null||R===void 0||R.emit(Mn.Error,P)}else N.error(P)}if(n.calls.set(l.callId,l),n.candidateEventsByCall.get(l.callId))for(var x of n.candidateEventsByCall.get(l.callId))l.onRemoteIceCandidatesReceived(x);var C;for(var k of n.calls.values()){var T,L=[ft.WaitLocalMedia,ft.CreateOffer,ft.InviteSent].includes(k.state);if(l.roomId===k.roomId&&k.direction===rf.Outbound&&((T=l.getOpponentMember())===null||T===void 0?void 0:T.userId)===k.invitee&&L){C=k;break}}C?C.callId>l.callId?(N.log("CallEventHandler handleCallEvent() detected glare - answering incoming call and canceling outgoing call (incomingId=".concat(l.callId,", outgoingId=").concat(C.callId,")")),C.replacedBy(l)):(N.log("CallEventHandler handleCallEvent() detected glare - hanging up incoming call (incomingId=".concat(l.callId,", outgoingId=").concat(C.callId,")")),l.hangup(Ct.Replaced,!0)):n.client.emit(RA.Incoming,l);return}else if(a===ee.CallCandidates){if(m)return;l?l.onRemoteIceCandidatesReceived(e):(n.candidateEventsByCall.has(i.call_id)||n.candidateEventsByCall.set(i.call_id,[]),n.candidateEventsByCall.get(i.call_id).push(e));return}else if([ee.CallHangup,ee.CallReject].includes(a)){if(l)l.state!==ft.Ended&&(a===ee.CallHangup?l.onHangupReceived(i):l.onRejectReceived(i),l.state===ft.Ended&&n.calls.delete(i.call_id));else{var O;l=(O=Ab(n.client,s,{opponentDeviceId:d,opponentSessionId:i.sender_session_id}))!==null&&O!==void 0?O:void 0,l&&(l.callId=i.call_id,l.initWithHangup(e),n.calls.set(i.call_id,l))}return}if(!l||!l.hasPeerConnection){N.info("CallEventHandler handleCallEvent() discarding possible call event as we don't have a call (type=".concat(a,")"));return}if(e.getContent().party_id!==l.ourPartyId)switch(a){case ee.CallAnswer:m?l.state===ft.Ringing&&l.onAnsweredElsewhere(i):l.onAnswerReceived(e);break;case ee.CallSelectAnswer:l.onSelectAnswerReceived(e);break;case ee.CallNegotiate:l.onNegotiateReceived(e);break;case ee.CallAssertedIdentity:case ee.CallAssertedIdentityPrefix:l.onAssertedIdentityReceived(e);break;case ee.CallSDPStreamMetadataChanged:case ee.CallSDPStreamMetadataChangedPrefix:l.onSDPStreamMetadataChangedReceived(e);break}}})()}}var kA=(function(t){return t.Incoming="GroupCall.incoming",t.Outgoing="GroupCall.outgoing",t.Ended="GroupCall.ended",t.Participants="GroupCall.participants",t})({});class c0e{constructor(e){this.client=e,M(this,"groupCalls",new Map),M(this,"roomDeferreds",new Map),M(this,"onRoomsChanged",n=>{this.createGroupCallForRoom(n)}),M(this,"onRoomStateChanged",(n,r)=>{var i=n.getType();if(i===ee.GroupCallPrefix){var s=n.getStateKey(),o=n.getContent(),a=this.groupCalls.get(r.roomId);!a&&!o["m.terminated"]&&!n.isRedacted()?this.createGroupCallFromRoomStateEvent(n):a&&a.groupCallId===s?o["m.terminated"]||n.isRedacted()?a.terminate(!1):o["m.type"]!==a.type&&N.warn("GroupCallEventHandler onRoomStateChanged() currently does not support changing type (roomId=".concat(r.roomId,")")):a&&a.groupCallId!==s&&N.warn("GroupCallEventHandler onRoomStateChanged() currently does not support multiple calls (roomId=".concat(r.roomId,")"))}})}start(){var e=this;return B(function*(){e.client.getSyncState()!==Qt.Syncing&&(N.debug("GroupCallEventHandler start() waiting for client to start syncing"),yield new Promise(i=>{var s=()=>{if(e.client.getSyncState()===Qt.Syncing)return e.client.off(Pe.Sync,s),i()};e.client.on(Pe.Sync,s)}));var n=e.client.getRooms();for(var r of n)e.createGroupCallForRoom(r);e.client.on(Pe.Room,e.onRoomsChanged),e.client.on(Rt.Events,e.onRoomStateChanged)})()}stop(){this.client.removeListener(Pe.Room,this.onRoomsChanged),this.client.removeListener(Rt.Events,this.onRoomStateChanged)}getRoomDeferred(e){var n=this.roomDeferreds.get(e);if(n===void 0){var r;n={prom:new Promise(i=>{r=i})},n.resolve=r,this.roomDeferreds.set(e,n)}return n}waitUntilRoomReadyForGroupCalls(e){return this.getRoomDeferred(e).prom}getGroupCallById(e){return[...this.groupCalls.values()].find(n=>n.groupCallId===e)}createGroupCallForRoom(e){var n=e.currentState.getStateEvents(ee.GroupCallPrefix),r=n.sort((o,a)=>a.getTs()-o.getTs());for(var i of r){var s=i.getContent();if(!(s["m.terminated"]||i.isRedacted())){N.debug("GroupCallEventHandler createGroupCallForRoom() choosing group call from possible calls (stateKey=".concat(i.getStateKey(),", ts=").concat(i.getTs(),", roomId=").concat(e.roomId,", numOfPossibleCalls=").concat(n.length,")")),this.createGroupCallFromRoomStateEvent(i);break}}this.getRoomDeferred(e.roomId).resolve()}createGroupCallFromRoomStateEvent(e){var n=e.getRoomId(),r=e.getContent(),i=this.client.getRoom(n);if(!i){N.warn("GroupCallEventHandler createGroupCallFromRoomStateEvent() couldn't find room for call (roomId=".concat(n,")"));return}var s=e.getStateKey(),o=r["m.type"];if(!Object.values(wT).includes(o)){N.warn("GroupCallEventHandler createGroupCallFromRoomStateEvent() received invalid call type (type=".concat(o,", roomId=").concat(n,")"));return}var a=r["m.intent"];if(!Object.values(YJ).includes(a)){N.warn("Received invalid group call intent (type=".concat(o,", roomId=").concat(n,")"));return}var c=!!r["io.element.ptt"],l;if(r!=null&&r.dataChannelsEnabled&&r!==null&&r!==void 0&&r.dataChannelOptions){var{ordered:d,maxPacketLifeTime:h,maxRetransmits:m,protocol:g}=r.dataChannelOptions;l={ordered:d,maxPacketLifeTime:h,maxRetransmits:m,protocol:g}}var y=new aP(this.client,i,o,c,a,s,r?.dataChannelsEnabled||this.client.isVoipWithNoMediaAllowed,l,this.client.isVoipWithNoMediaAllowed,this.client.useLivekitForGroupCalls,r["io.element.livekit_service_url"]);return this.groupCalls.set(i.roomId,y),this.client.emit(kA.Incoming,y),y}}class l0e{constructor(){M(this,"bandwidth",{}),M(this,"bitrate",{}),M(this,"packetLoss",{}),M(this,"transport",[])}}class u0e{static buildBandwidthReport(e){var n=e.availableIncomingBitrate,r=e.availableOutgoingBitrate;return{download:n?Math.round(n/1e3):0,upload:r?Math.round(r/1e3):0}}}class d0e{static buildReport(e,n,r,i){var s=e?.get(n.localCandidateId),o=e?.get(n.remoteCandidateId);if(o&&s){var a=o.ip!==void 0?o.ip:o.address,c=o.port,l="".concat(a,":").concat(c),d=s.ip!==void 0?s.ip:s.address,h=s.port,m="".concat(d,":").concat(h),g=o.protocol;r.some(y=>y.ip===l&&y.type===g&&y.localIp===m)||r.push({ip:l,type:g,localIp:m,isFocus:i,localCandidateType:s.candidateType,remoteCandidateType:o.candidateType,networkType:s.networkType,rtt:n.currentRoundTripTime?n.currentRoundTripTime*1e3:NaN})}return r}}class f0e{constructor(){M(this,"ssrcToMid",{local:new Map,remote:new Map})}findMidBySsrc(e,n){var r;return this.ssrcToMid[n].forEach((i,s)=>{if(i.find(o=>o==e)){r=s;return}}),r}parse(e,n){var r=EA.parse(e),i=new Map;r.media.forEach(s=>{if(s.mid&&s.type==="video"||s.type==="audio"){var o,a=[];(o=s.ssrcs)===null||o===void 0||o.forEach(c=>{c.attribute==="cname"&&a.push("".concat(c.id))}),i.set("".concat(s.mid),a)}}),this.ssrcToMid[n]=i}getSsrcToMidMap(e){return this.ssrcToMid[e]}}class h0e{constructor(e){this.pc=e}getLocalTracks(e){var n=r=>r!==null&&r.kind===e;return this.pc.getTransceivers().filter(r=>r.currentDirection==="sendonly"||r.currentDirection==="sendrecv").filter(r=>r.sender!==null).map(r=>r.sender).map(r=>r.track).filter(n)}getTackById(e){return this.pc.getTransceivers().map(n=>{if(n?.sender.track!==null&&n.sender.track.id===e)return n.sender.track;if(n?.receiver.track!==null&&n.receiver.track.id===e)return n.receiver.track}).find(n=>n!==void 0)}getLocalTrackIdByMid(e){var n,r=this.pc.getTransceivers().find(i=>i.mid===e);return r==null||(n=r.sender)===null||n===void 0||(n=n.track)===null||n===void 0?void 0:n.id}getRemoteTrackIdByMid(e){var n,r=this.pc.getTransceivers().find(i=>i.mid===e);return r==null||(n=r.receiver)===null||n===void 0||(n=n.track)===null||n===void 0?void 0:n.id}getActiveSimulcastStreams(){return 3}getTransceiverByTrackId(e){return this.pc.getTransceivers().find(n=>n.receiver.track.id===e||n.sender.track!==null&&n.sender.track.id===e)}}class p0e{constructor(e,n,r){this.trackId=e,this.type=n,this.kind=r,M(this,"loss",{packetsTotal:0,packetsLost:0,isDownloadStream:!1}),M(this,"bitrate",{download:0,upload:0}),M(this,"resolution",{width:-1,height:-1}),M(this,"audioConcealment",{concealedAudio:0,totalAudioDuration:0}),M(this,"framerate",0),M(this,"jitter",0),M(this,"codec",""),M(this,"isAlive",!0),M(this,"isMuted",!1),M(this,"isEnabled",!0)}getType(){return this.type}setLoss(e){this.loss=e}getLoss(){return this.loss}setResolution(e){this.resolution=e}getResolution(){return this.resolution}setFramerate(e){this.framerate=e}getFramerate(){return this.framerate}setBitrate(e){this.bitrate=e}getBitrate(){return this.bitrate}setCodec(e){return this.codec=e,!0}getCodec(){return this.codec}resetBitrate(){this.bitrate={download:0,upload:0}}set alive(e){this.isAlive=e}get alive(){return this.isAlive}set muted(e){this.isMuted=e}get muted(){return this.isMuted}set enabled(e){this.isEnabled=e}get enabled(){return this.isEnabled}setJitter(e){this.jitter=e}getJitter(){return this.jitter}setAudioConcealment(e,n){this.audioConcealment.concealedAudio=e,this.audioConcealment.totalAudioDuration=n}getAudioConcealment(){return this.audioConcealment}}class m0e{constructor(e,n){this.mediaSsrcHandler=e,this.mediaTrackHandler=n,M(this,"track2stats",new Map)}findTrack2Stats(e,n){var r;if(e.trackIdentifier)r=e.trackIdentifier;else if(e.mid)r=n==="remote"?this.mediaTrackHandler.getRemoteTrackIdByMid(e.mid):this.mediaTrackHandler.getLocalTrackIdByMid(e.mid);else if(e.ssrc){var i=this.mediaSsrcHandler.findMidBySsrc(e.ssrc,n);if(!i)return;r=n==="remote"?this.mediaTrackHandler.getRemoteTrackIdByMid(e.mid):this.mediaTrackHandler.getLocalTrackIdByMid(e.mid)}if(r){var s=this.track2stats.get(r);if(!s){var o=this.mediaTrackHandler.getTackById(r);if(o!==void 0){var a=o.kind==="audio"?o.kind:"video";s=new p0e(r,n,a),this.track2stats.set(r,s)}else return}return s}}findLocalVideoTrackStats(e){var n=this.mediaTrackHandler.getLocalTracks("video");if(n.length!==0)return this.findTrack2Stats(e,"local")}getTrack2stats(){return this.track2stats}findTransceiverByTrackId(e){return this.mediaTrackHandler.getTransceiverByTrackId(e)}}class Zh{static getNonNegativeValue(e){var n=e;return typeof n!="number"&&(n=Number(n)),isNaN(n)?0:Math.max(0,n)}}class Vo{static buildFramerateResolution(e,n){var r={height:n.frameHeight,width:n.frameWidth},i=n.framesPerSecond;r.height&&r.width&&e.setResolution(r),e.setFramerate(Math.round(i||0))}static calculateSimulcastFramerate(e,n,r,i){var s=e.getFramerate();if(!s){if(r){var o=n.timestamp-r.timestamp;if(o>0&&n.framesSent){var a=n.framesSent-r.framesSent;s=a/o*1e3}}if(!s)return}s=i?Math.round(s/i):0,e.setFramerate(s)}static buildCodec(e,n,r){var i=e?.get(r.codecId);if(i){var s=i.mimeType.split("/")[1];s&&n.setCodec(s)}}static buildBitrateReceived(e,n,r){e.setBitrate({download:Vo.calculateBitrate(n.bytesReceived,r.bytesReceived,n.timestamp,r.timestamp),upload:0})}static buildBitrateSend(e,n,r){e.setBitrate({download:0,upload:this.calculateBitrate(n.bytesSent,r.bytesSent,n.timestamp,r.timestamp)})}static buildPacketsLost(e,n,r){var i=n.type==="outbound-rtp"?"packetsSent":"packetsReceived",s=n[i];(!s||s<0)&&(s=0);var o=Zh.getNonNegativeValue(r[i]),a=Math.max(0,s-o),c=Zh.getNonNegativeValue(n.packetsLost),l=Zh.getNonNegativeValue(r.packetsLost),d=Math.max(0,c-l);e.setLoss({packetsTotal:a+d,packetsLost:d,isDownloadStream:n.type!=="outbound-rtp"})}static calculateBitrate(e,n,r,i){var s=Zh.getNonNegativeValue(e),o=Zh.getNonNegativeValue(n),a=Math.max(0,s-o),c=r-i,l=0;return c>0&&(l=Math.round(a*8/c)),l}static setTrackStatsState(e,n){var r;if(n===void 0){e.alive=!1;return}var i=e.getType()==="remote"?n.receiver.track:n==null||(r=n.sender)===null||r===void 0?void 0:r.track;if(i==null){e.alive=!1;return}if(i.readyState==="ended"){e.alive=!1;return}e.muted=i.muted,e.enabled=i.enabled,e.alive=!0}static buildTrackSummary(e){var n={count:0,muted:0,maxJitter:0,maxPacketLoss:0,concealedAudio:0,totalAudio:0},r={count:0,muted:0,maxJitter:0,maxPacketLoss:0,concealedAudio:0,totalAudio:0},i=e.filter(o=>o.getType()==="remote"),s=i.filter(o=>o.kind==="audio");return i.forEach(o=>{var a=o.kind==="video"?n:r;if(a.count++,o.alive&&o.muted&&a.muted++,a.maxJitter<o.getJitter()&&(a.maxJitter=o.getJitter()),a.maxPacketLoss<o.getLoss().packetsLost&&(a.maxPacketLoss=o.getLoss().packetsLost),s.length>0){var c,l;a.concealedAudio+=(c=o.getAudioConcealment())===null||c===void 0?void 0:c.concealedAudio,a.totalAudio+=(l=o.getAudioConcealment())===null||l===void 0?void 0:l.totalAudioDuration}}),{audioTrackSummary:r,videoTrackSummary:n}}static buildJitter(e,n){if(n.type==="inbound-rtp"){var r=n?.jitter;if(r!==void 0){var i=Zh.getNonNegativeValue(r);e.setJitter(Math.round(i*1e3))}else e.setJitter(-1)}}static buildAudioConcealment(e,n){if(n.type==="inbound-rtp"){var r=1e3*n?.totalSamplesDuration/n?.totalSamplesReceived,i=r*n?.concealedSamples,s=1e3*n?.totalSamplesDuration;e.setAudioConcealment(i,s)}}}class V1{static build(e){var n={},r={download:0,upload:0},i={download:0,upload:0},s=0,o=0,a={local:new Map,remote:new Map},c={local:new Map,remote:new Map},l={local:new Map,remote:new Map},d=new Map,h=new Map,m=0,g=0,y=0,v=0,E=0,w=0;for(var[R,x]of e){var C=x.getLoss(),k=C.isDownloadStream?"download":"upload";if(r[k]+=C.packetsTotal,i[k]+=C.packetsLost,s+=x.getBitrate().download,o+=x.getBitrate().upload,x.kind==="audio"){var T=x.getAudioConcealment();E+=T.concealedAudio,w+=T.totalAudioDuration,m+=x.getBitrate().download,g+=x.getBitrate().upload}else y+=x.getBitrate().download,v+=x.getBitrate().upload;a[x.getType()].set(R,x.getResolution()),c[x.getType()].set(R,x.getFramerate()),l[x.getType()].set(R,x.getCodec()),x.getType()==="remote"&&(d.set(R,x.getJitter()),x.kind==="audio"&&h.set(R,x.getAudioConcealment())),x.resetBitrate()}return n.bitrate={upload:o,download:s},n.bitrate.audio={upload:g,download:m},n.bitrate.video={upload:v,download:y},n.packetLoss={total:V1.calculatePacketLoss(i.download+i.upload,r.download+r.upload),download:V1.calculatePacketLoss(i.download,r.download),upload:V1.calculatePacketLoss(i.upload,r.upload)},n.audioConcealment=h,n.totalAudioConcealment={concealedAudio:E,totalAudioDuration:w},n.framerate=c,n.resolution=a,n.codec=l,n.jitter=d,n}static calculatePacketLoss(e,n){return!n||n<=0||!e||e<=0?0:Math.round(e/n*100)}}class _f{static buildCallFeedReport(e,n,r){var i=r.getTransceivers(),s=[],o=[];return i.forEach(a=>{var c,l=(c=a.sender)!==null&&c!==void 0&&c.track?_f.buildTrackStats(a.sender.track,"sender"):null,d=_f.buildTrackStats(a.receiver.track,"receiver");s.push({mid:a.mid==null?"null":a.mid,direction:a.direction,currentDirection:a.currentDirection==null?"null":a.currentDirection,sender:l,receiver:d})}),{callId:e,opponentMemberId:n,transceiver:s,callFeeds:o}}static buildTrackStats(e){var n,r,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"--",s=(n=e.getSettings())===null||n===void 0?void 0:n.deviceId,o=(r=e.getConstraints())===null||r===void 0?void 0:r.deviceId;return{id:e.id,kind:e.kind,settingDeviceId:s??"unknown",constrainDeviceId:o??"unknown",muted:e.muted,enabled:e.enabled,readyState:e.readyState,label:i}}static expandCallFeedReport(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unknown";return n.forEach(i=>{var s=i.stream.getAudioTracks(),o=i.stream.getVideoTracks(),a=s.length>0?_f.buildTrackStats(i.stream.getAudioTracks()[0],i.purpose):null,c=o.length>0?_f.buildTrackStats(i.stream.getVideoTracks()[0],i.purpose):null,l={stream:i.stream.id,type:i.isLocal()?"local":"remote",audio:a,video:c,purpose:i.purpose,prefix:r,isVideoMuted:i.isVideoMuted(),isAudioMuted:i.isAudioMuted()};e.callFeeds.push(l)}),e}}function aB(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function J2(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?aB(Object(n),!0).forEach(function(r){M(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):aB(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}class g0e{constructor(e,n,r,i){var s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0;this.callId=e,this.opponentMemberId=n,this.pc=r,this.emitter=i,this.isFocus=s,M(this,"isActive",!0),M(this,"previousStatsReport",void 0),M(this,"currentStatsReport",void 0),M(this,"connectionStats",new l0e),M(this,"trackStats",void 0),r.addEventListener("signalingstatechange",this.onSignalStateChange.bind(this)),this.trackStats=new m0e(new f0e,new h0e(r))}processStats(e,n){var r=this;return B(function*(){var i={isFirstCollection:r.previousStatsReport===void 0,receivedMedia:0,receivedAudioMedia:0,receivedVideoMedia:0,audioTrackSummary:{count:0,muted:0,maxPacketLoss:0,maxJitter:0,concealedAudio:0,totalAudio:0},videoTrackSummary:{count:0,muted:0,maxPacketLoss:0,maxJitter:0,concealedAudio:0,totalAudio:0}};if(r.isActive){var s=r.pc.getStats();if(typeof s?.then=="function")return s.then(o=>{var a,c;r.currentStatsReport=typeof o?.result=="function"?o.result():o;try{r.processStatsReport(e,n)}catch(d){return r.handleError(d),i}r.previousStatsReport=r.currentStatsReport,i.receivedMedia=r.connectionStats.bitrate.download,i.receivedAudioMedia=((a=r.connectionStats.bitrate.audio)===null||a===void 0?void 0:a.download)||0,i.receivedVideoMedia=((c=r.connectionStats.bitrate.video)===null||c===void 0?void 0:c.download)||0;var l=Vo.buildTrackSummary(Array.from(r.trackStats.getTrack2stats().values()));return J2(J2({},i),{},{audioTrackSummary:l.audioTrackSummary,videoTrackSummary:l.videoTrackSummary})}).catch(o=>(r.handleError(o),i));r.isActive=!1}return Promise.resolve(i)})()}processStatsReport(e,n){var r,i=new Map;i.callId=this.callId,i.opponentMemberId=this.opponentMemberId,(r=this.currentStatsReport)===null||r===void 0||r.forEach(s=>{var o=this.previousStatsReport?this.previousStatsReport.get(s.id):null;if(s.type==="candidate-pair"&&s.nominated&&s.state==="succeeded")this.connectionStats.bandwidth=u0e.buildBandwidthReport(s),this.connectionStats.transport=d0e.buildReport(this.currentStatsReport,s,this.connectionStats.transport,this.isFocus);else if(s.type==="inbound-rtp"||s.type==="outbound-rtp"){var a=this.trackStats.findTrack2Stats(s,s.type==="inbound-rtp"?"remote":"local");if(!a)return;if(o&&Vo.buildPacketsLost(a,s,o),s.type==="inbound-rtp"){Vo.buildFramerateResolution(a,s),o&&Vo.buildBitrateReceived(a,s,o);var c=this.trackStats.findTransceiverByTrackId(a.trackId);Vo.setTrackStatsState(a,c),Vo.buildJitter(a,s),Vo.buildAudioConcealment(a,s)}else o&&(i.set(a.trackId,Zh.getNonNegativeValue(s.bytesSent)),Vo.buildBitrateSend(a,s,o));Vo.buildCodec(this.currentStatsReport,a,s)}else if(s.type==="track"&&s.kind==="video"&&!s.remoteSource){var l=this.trackStats.findLocalVideoTrackStats(s);if(!l)return;Vo.buildFramerateResolution(l,s),Vo.calculateSimulcastFramerate(l,s,o,this.trackStats.mediaTrackHandler.getActiveSimulcastStreams())}}),this.emitter.emitByteSendReport(i),this.emitter.emitCallFeedReport(_f.buildCallFeedReport(this.callId,this.opponentMemberId,this.pc)),this.processAndEmitConnectionStatsReport()}setActive(e){this.isActive=e}getActive(){return this.isActive}handleError(e){this.isActive=!1,N.warn("CallStatsReportGatherer ".concat(this.callId," processStatsReport fails and set to inactive ").concat(e))}processAndEmitConnectionStatsReport(){var e=V1.build(this.trackStats.getTrack2stats());e.callId=this.callId,e.opponentMemberId=this.opponentMemberId,this.connectionStats.bandwidth=e.bandwidth,this.connectionStats.bitrate=e.bitrate,this.connectionStats.packetLoss=e.packetLoss,this.emitter.emitConnectionStatsReport(J2(J2({},e),{},{transport:this.connectionStats.transport})),this.connectionStats.transport=[]}stopProcessingStats(){}onSignalStateChange(){this.pc.signalingState==="stable"&&(this.pc.currentRemoteDescription&&this.trackStats.mediaSsrcHandler.parse(this.pc.currentRemoteDescription.sdp,"remote"),this.pc.currentLocalDescription&&this.trackStats.mediaSsrcHandler.parse(this.pc.currentLocalDescription.sdp,"local"))}setOpponentMemberId(e){this.opponentMemberId=e}}var Fu=(function(t){return t.CONNECTION_STATS="StatsReport.connection_stats",t.CALL_FEED_REPORT="StatsReport.call_feed_report",t.BYTE_SENT_STATS="StatsReport.byte_sent_stats",t.SUMMARY_STATS="StatsReport.summary_stats",t})({});class v0e extends Gn{emitByteSendReport(e){this.emit(Fu.BYTE_SENT_STATS,e)}emitConnectionStatsReport(e){this.emit(Fu.CONNECTION_STATS,e)}emitCallFeedReport(e){this.emit(Fu.CALL_FEED_REPORT,e)}emitSummaryStatsReport(e){this.emit(Fu.SUMMARY_STATS,e)}}class WJ{constructor(e){this.emitter=e}build(e){var n=e.filter(d=>!d.isFirstCollection),r=n.length,i=e.length;if(r!==0){var s={receivedAudio:0,receivedVideo:0,receivedMedia:0,concealedAudio:0,totalAudio:0},o=0,a=0;n.forEach(d=>{this.countTrackListReceivedMedia(s,d),this.countConcealedAudio(s,d),o=this.buildMaxJitter(o,d),a=this.buildMaxPacketLoss(a,d)});var c=5,l={percentageReceivedMedia:Number((s.receivedMedia/r).toFixed(c)),percentageReceivedVideoMedia:Number((s.receivedVideo/r).toFixed(c)),percentageReceivedAudioMedia:Number((s.receivedAudio/r).toFixed(c)),maxJitter:o,maxPacketLoss:a,percentageConcealedAudio:Number(s.totalAudio>0?(s.concealedAudio/s.totalAudio).toFixed(c):0),peerConnections:i};this.emitter.emitSummaryStatsReport(l)}}static extendSummaryReport(e,n){var r=[],i=[];for(var s of n){i.push(s);for(var o of s[1])r.push(o)}e.opponentDevicesInCall=Math.max(0,r.length-1),e.opponentUsersInCall=Math.max(0,i.length-1),e.diffDevicesToPeerConnections=Math.max(0,r.length-1)-e.peerConnections,e.ratioPeerConnectionToDevices=Math.max(0,r.length-1)==0?0:e.peerConnections/(r.length-1)}countTrackListReceivedMedia(e,n){var r=!1,i=!1;(n.receivedAudioMedia>0||n.audioTrackSummary.count===0)&&(e.receivedAudio++,r=!0),(n.receivedVideoMedia>0||n.videoTrackSummary.count===0||n.videoTrackSummary.muted>0&&n.videoTrackSummary.muted===n.videoTrackSummary.count)&&(e.receivedVideo++,i=!0),i&&r&&e.receivedMedia++}buildMaxJitter(e,n){return e<n.videoTrackSummary.maxJitter&&(e=n.videoTrackSummary.maxJitter),e<n.audioTrackSummary.maxJitter&&(e=n.audioTrackSummary.maxJitter),e}buildMaxPacketLoss(e,n){return e<n.videoTrackSummary.maxPacketLoss&&(e=n.videoTrackSummary.maxPacketLoss),e<n.audioTrackSummary.maxPacketLoss&&(e=n.audioTrackSummary.maxPacketLoss),e}countConcealedAudio(e,n){e.concealedAudio+=n.audioTrackSummary.concealedAudio,e.totalAudio+=n.audioTrackSummary.totalAudio}}class y0e{constructor(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1e4;this.groupCallId=e,this.userId=n,this.interval=r,M(this,"timer",void 0),M(this,"gatherers",new Map),M(this,"reports",new v0e),M(this,"summaryStatsReportGatherer",new WJ(this.reports))}start(){this.timer===void 0&&this.interval>0&&(this.timer=setInterval(()=>{this.processStats()},this.interval))}stop(){this.timer!==void 0&&(clearInterval(this.timer),this.gatherers.forEach(e=>e.stopProcessingStats()))}hasStatsReportGatherer(e){return this.gatherers.has(e)}addStatsReportGatherer(e,n,r){return this.hasStatsReportGatherer(e)?!1:(this.gatherers.set(e,new g0e(e,n,r,this.reports)),!0)}removeStatsReportGatherer(e){return this.gatherers.delete(e)}getStatsReportGatherer(e){return this.hasStatsReportGatherer(e)?this.gatherers.get(e):void 0}updateOpponentMember(e,n){var r;(r=this.getStatsReportGatherer(e))===null||r===void 0||r.setOpponentMemberId(n)}processStats(){var e=[];this.gatherers.forEach(n=>{e.push(n.processStats(this.groupCallId,this.userId))}),Promise.all(e).then(n=>this.summaryStatsReportGatherer.build(n)).catch(n=>{N.error("Could not build summary stats report",n)})}setInterval(e){this.interval=e}}function cB(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function Q2(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?cB(Object(n),!0).forEach(function(r){M(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):cB(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var YJ=(function(t){return t.Ring="m.ring",t.Prompt="m.prompt",t.Room="m.room",t})({}),wT=(function(t){return t.Video="m.video",t.Voice="m.voice",t})({}),b0e=(function(t){return t.CallEnded="call_ended",t})({}),Mn=(function(t){return t.GroupCallStateChanged="group_call_state_changed",t.ActiveSpeakerChanged="active_speaker_changed",t.CallsChanged="calls_changed",t.UserMediaFeedsChanged="user_media_feeds_changed",t.ScreenshareFeedsChanged="screenshare_feeds_changed",t.LocalScreenshareStateChanged="local_screenshare_state_changed",t.LocalMuteStateChanged="local_mute_state_changed",t.ParticipantsChanged="participants_changed",t.Error="group_call_error",t})({}),k1=(function(t){return t.ConnectionStats="GroupCall.connection_stats",t.ByteSentStats="GroupCall.byte_sent_stats",t.SummaryStats="GroupCall.summary_stats",t.CallFeedStats="GroupCall.call_feed_stats",t})({}),K1=(function(t){return t.NoUserMedia="no_user_media",t.UnknownDevice="unknown_device",t.PlaceCallFailed="place_call_failed",t})({});class IA extends Error{constructor(e,n,r){r?(super(n+": "+r),M(this,"code",void 0)):(super(n),M(this,"code",void 0)),this.code=e}}class XJ extends IA{constructor(e){super(K1.UnknownDevice,"No device found for "+e),this.userId=e}}var hr=(function(t){return t.LocalCallFeedUninitialized="local_call_feed_uninitialized",t.InitializingLocalCallFeed="initializing_local_call_feed",t.LocalCallFeedInitialized="local_call_feed_initialized",t.Entered="entered",t.Ended="ended",t})({}),lB=1e3*60*60;function Z2(t){var e;return((e=t.getOpponentMember())===null||e===void 0?void 0:e.userId)||t.invitee||null}class aP extends Gn{constructor(e,n,r,i,s,o,a,c,l){var d,h,m=arguments.length>9&&arguments[9]!==void 0?arguments[9]:!1,g=arguments.length>10?arguments[10]:void 0;super(),this.client=e,this.room=n,this.type=r,this.isPtt=i,this.intent=s,this.dataChannelsEnabled=a,this.dataChannelOptions=c,this.useLivekit=m,M(this,"activeSpeakerInterval",1e3),M(this,"retryCallInterval",5e3),M(this,"participantTimeout",1e3*15),M(this,"pttMaxTransmitTime",1e3*20),M(this,"activeSpeaker",void 0),M(this,"localCallFeed",void 0),M(this,"localScreenshareFeed",void 0),M(this,"localDesktopCapturerSourceId",void 0),M(this,"userMediaFeeds",[]),M(this,"screenshareFeeds",[]),M(this,"groupCallId",void 0),M(this,"allowCallWithoutVideoAndAudio",void 0),M(this,"calls",new Map),M(this,"callHandlers",new Map),M(this,"activeSpeakerLoopInterval",void 0),M(this,"retryCallLoopInterval",void 0),M(this,"retryCallCounts",new Map),M(this,"reEmitter",void 0),M(this,"transmitTimer",null),M(this,"participantsExpirationTimer",null),M(this,"resendMemberStateTimer",null),M(this,"initWithAudioMuted",!1),M(this,"initWithVideoMuted",!1),M(this,"initCallFeedPromise",void 0),M(this,"_livekitServiceURL",void 0),M(this,"stats",void 0),M(this,"statsCollectIntervalTime",0),M(this,"onConnectionStats",y=>{this.emit(k1.ConnectionStats,{report:y})}),M(this,"onByteSentStats",y=>{this.emit(k1.ByteSentStats,{report:y})}),M(this,"onSummaryStats",y=>{WJ.extendSummaryReport(y,this.participants),this.emit(k1.SummaryStats,{report:y})}),M(this,"onCallFeedReport",y=>{this.localCallFeed&&(y=_f.expandCallFeedReport(y,[this.localCallFeed],"from-local-feed"));var v=[];this.forEachCall(E=>{E.callId===y.callId&&E.getFeeds().forEach(w=>v.push(w))}),y=_f.expandCallFeedReport(y,v,"from-call-feed"),this.emit(k1.CallFeedStats,{report:y})}),M(this,"_state",hr.LocalCallFeedUninitialized),M(this,"_participants",new Map),M(this,"_creationTs",null),M(this,"_enteredViaAnotherSession",!1),M(this,"onIncomingCall",y=>{var v,E;if(y.roomId===this.room.roomId){if(y.state!==ft.Ringing){N.warn("GroupCall ".concat(this.groupCallId," onIncomingCall() incoming call no longer in ringing state - ignoring"));return}if(!y.groupCallId||y.groupCallId!==this.groupCallId){N.log("GroupCall ".concat(this.groupCallId," onIncomingCall() ignored because it doesn't match the current group call")),y.reject();return}var w=(v=y.getOpponentMember())===null||v===void 0?void 0:v.userId;if(w===void 0){N.warn("GroupCall ".concat(this.groupCallId," onIncomingCall() incoming call with no member - ignoring"));return}if(this.useLivekit){N.info("Received incoming call whilst in signaling-only mode! Ignoring.");return}var R=(E=this.calls.get(w))!==null&&E!==void 0?E:new Map,x=R.get(y.getOpponentDeviceId());if(x?.callId!==y.callId){N.log("GroupCall ".concat(this.groupCallId," onIncomingCall() incoming call (userId=").concat(w,", callId=").concat(y.callId,")")),x&&x.hangup(Ct.Replaced,!1),R.set(y.getOpponentDeviceId(),y),this.calls.set(w,R),this.initCall(y);var C=this.getLocalFeeds().map(T=>T.clone());if(!this.callExpected(y))for(var k of C)Zr(k.stream.getAudioTracks(),!1),Zr(k.stream.getVideoTracks(),!1);y.answerWithCallFeeds(C),this.emit(Mn.CallsChanged,this.calls)}}}),M(this,"onRetryCallLoop",()=>{var y=!1;for(var[{userId:v},E]of this.participants){var w=this.calls.get(v),R=this.retryCallCounts.get(v);for(var[x,C]of E){var k,T,L=w?.get(x),O=(k=(T=R)===null||T===void 0?void 0:T.get(x))!==null&&k!==void 0?k:0;L?.getOpponentSessionId()!==C.sessionId&&this.wantsOutgoingCall(v,x)&&O<3&&(R===void 0&&(R=new Map,this.retryCallCounts.set(v,R)),R.set(x,O+1),y=!0)}}y&&this.placeOutgoingCalls()}),M(this,"onCallFeedsChanged",y=>{var v=Z2(y),E=y.getOpponentDeviceId();if(!v)throw new Error("Cannot change call feeds without user id");var w=this.getUserMediaFeed(v,E),R=y.remoteUsermediaFeed,x=R!==w,C=this.calls.get(v),k=C?.get(E);if(k?.callId===y.callId){x&&(!w&&R?this.addUserMediaFeed(R):w&&R?this.replaceUserMediaFeed(w,R):w&&!R&&this.removeUserMediaFeed(w));var T=this.getScreenshareFeed(v,E),L=y.remoteScreensharingFeed,O=L!==T;O&&(!T&&L?this.addScreenshareFeed(L):T&&L?this.replaceScreenshareFeed(T,L):T&&!L&&this.removeScreenshareFeed(T))}}),M(this,"onCallStateChanged",(y,v,E)=>{var w;if(v!==ft.Ended){var R=this.localCallFeed.isAudioMuted();y.localUsermediaStream&&y.isMicrophoneMuted()!==R&&y.setMicrophoneMuted(R);var x=this.localCallFeed.isVideoMuted();y.localUsermediaStream&&y.isLocalVideoMuted()!==x&&y.setLocalVideoMuted(x);var C=(w=y.getOpponentMember())===null||w===void 0?void 0:w.userId;if(v===ft.Connected&&C){var k=this.retryCallCounts.get(C);k?.delete(y.getOpponentDeviceId()),k?.size===0&&this.retryCallCounts.delete(C)}}}),M(this,"onCallHangup",y=>{var v,E;if(y.hangupReason!==Ct.Replaced){var w=(v=(E=y.getOpponentMember())===null||E===void 0?void 0:E.userId)!==null&&v!==void 0?v:this.room.getMember(y.invitee).userId,R=this.calls.get(w);R?.get(y.getOpponentDeviceId())===y&&(this.disposeCall(y,y.hangupReason),R.delete(y.getOpponentDeviceId()),R.size===0&&this.calls.delete(w),this.emit(Mn.CallsChanged,this.calls))}}),M(this,"onCallReplaced",(y,v)=>{var E=y.getOpponentMember().userId,w=this.calls.get(E);w===void 0&&(w=new Map,this.calls.set(E,w)),y.hangup(Ct.Replaced,!1),this.initCall(v),w.set(y.getOpponentDeviceId(),v),this.emit(Mn.CallsChanged,this.calls)}),M(this,"onActiveSpeakerLoop",()=>{var y=void 0,v=void 0;for(var E of this.userMediaFeeds)if(!(E.isLocal()&&this.userMediaFeeds.length>1)){var w=E.speakingVolumeSamples.reduce((x,C)=>x+Math.max(C,TA)),R=w/E.speakingVolumeSamples.length;(!y||R>y)&&(y=R,v=E)}v&&this.activeSpeaker!==v&&y&&y>TA&&(this.activeSpeaker=v,this.emit(Mn.ActiveSpeakerChanged,this.activeSpeaker))}),M(this,"onRoomState",()=>this.updateParticipants()),M(this,"onParticipantsChanged",()=>{this.forEachCall(y=>{var v=this.callExpected(y);for(var E of y.getLocalFeeds())Zr(E.stream.getAudioTracks(),!E.isAudioMuted()&&v),Zr(E.stream.getVideoTracks(),!E.isVideoMuted()&&v)}),this.state===hr.Entered&&!this.useLivekit&&this.placeOutgoingCalls()}),M(this,"onStateChanged",(y,v)=>{(y===hr.Entered||v===hr.Entered||y===hr.Ended)&&(this.updateParticipants(),this.updateMemberState().catch(E=>N.error("GroupCall ".concat(this.groupCallId,' onStateChanged() failed to update member state devices"'),E)))}),M(this,"onLocalFeedsChanged",()=>{this.state===hr.Entered&&this.updateMemberState().catch(y=>N.error("GroupCall ".concat(this.groupCallId," onLocalFeedsChanged() failed to update member state feeds"),y))}),this.reEmitter=new pJ(this),this.groupCallId=o??ep(),this._livekitServiceURL=g,this.creationTs=(d=(h=n.currentState.getStateEvents(ee.GroupCallPrefix,this.groupCallId))===null||h===void 0?void 0:h.getTs())!==null&&d!==void 0?d:null,this.updateParticipants(),n.on(Rt.Update,this.onRoomState),this.on(Mn.ParticipantsChanged,this.onParticipantsChanged),this.on(Mn.GroupCallStateChanged,this.onStateChanged),this.on(Mn.LocalScreenshareStateChanged,this.onLocalFeedsChanged),this.allowCallWithoutVideoAndAudio=!!l}create(){var e=this;return B(function*(){return e.creationTs=Date.now(),e.client.groupCallEventHandler.groupCalls.set(e.room.roomId,e),e.client.emit(kA.Outgoing,e),yield e.sendCallStateEvent(),e})()}sendCallStateEvent(){var e=this;return B(function*(){var n={"m.intent":e.intent,"m.type":e.type,"io.element.ptt":e.isPtt,dataChannelsEnabled:e.dataChannelsEnabled,dataChannelOptions:e.dataChannelsEnabled?e.dataChannelOptions:void 0};e.livekitServiceURL&&(n["io.element.livekit_service_url"]=e.livekitServiceURL),yield e.client.sendStateEvent(e.room.roomId,ee.GroupCallPrefix,n,e.groupCallId)})()}get livekitServiceURL(){return this._livekitServiceURL}updateLivekitServiceURL(e){return this._livekitServiceURL=e,this.sendCallStateEvent()}get state(){return this._state}set state(e){var n=this._state;e!==n&&(this._state=e,this.emit(Mn.GroupCallStateChanged,e,n))}get participants(){return this._participants}set participants(e){var n=this._participants,r=(s,o)=>s.sessionId===o.sessionId&&s.screensharing===o.screensharing,i=(s,o)=>f$(s,o,r);f$(e,n,i)||(this._participants=e,this.emit(Mn.ParticipantsChanged,e))}get creationTs(){return this._creationTs}set creationTs(e){this._creationTs=e}get enteredViaAnotherSession(){return this._enteredViaAnotherSession}set enteredViaAnotherSession(e){this._enteredViaAnotherSession=e,this.updateParticipants()}forEachCall(e){for(var n of this.calls.values())for(var r of n.values())e(r)}getLocalFeeds(){var e=[];return this.localCallFeed&&e.push(this.localCallFeed),this.localScreenshareFeed&&e.push(this.localScreenshareFeed),e}hasLocalParticipant(){var e,n;return(e=(n=this.participants.get(this.room.getMember(this.client.getUserId())))===null||n===void 0?void 0:n.has(this.client.getDeviceId()))!==null&&e!==void 0?e:!1}callExpected(e){var n,r=Z2(e),i=r===null?null:this.room.getMember(r),s=e.getOpponentDeviceId();return i!==null&&s!==void 0&&((n=this.participants.get(i))===null||n===void 0?void 0:n.get(s))!==void 0}initLocalCallFeed(){var e=this;return B(function*(){if(e.useLivekit){N.info("Livekit group call: not starting local call feed.");return}if(e.state!==hr.LocalCallFeedUninitialized)throw new Error('Cannot initialize local call feed in the "'.concat(e.state,'" state.'));if(e.state=hr.InitializingLocalCallFeed,e.initCallFeedPromise)return e.initCallFeedPromise;try{e.initCallFeedPromise=e.initLocalCallFeedInternal(),yield e.initCallFeedPromise}finally{e.initCallFeedPromise=void 0}})()}initLocalCallFeedInternal(){var e=this;return B(function*(){N.log("GroupCall ".concat(e.groupCallId," initLocalCallFeedInternal() running"));var n;try{n=yield e.client.getMediaHandler().getUserMediaStream(!0,e.type===wT.Video)}catch(i){if(e.allowCallWithoutVideoAndAudio)n=new MediaStream;else throw e.state=hr.LocalCallFeedUninitialized,i}if(e._state!==hr.InitializingLocalCallFeed)throw e.client.getMediaHandler().stopUserMediaStream(n),new Error("Group call disposed while gathering media stream");var r=new Au({client:e.client,roomId:e.room.roomId,userId:e.client.getUserId(),deviceId:e.client.getDeviceId(),stream:n,purpose:On.Usermedia,audioMuted:e.initWithAudioMuted||n.getAudioTracks().length===0||e.isPtt,videoMuted:e.initWithVideoMuted||n.getVideoTracks().length===0});Zr(n.getAudioTracks(),!r.isAudioMuted()),Zr(n.getVideoTracks(),!r.isVideoMuted()),e.localCallFeed=r,e.addUserMediaFeed(r),e.state=hr.LocalCallFeedInitialized})()}updateLocalUsermediaStream(e){var n=this;return B(function*(){if(n.localCallFeed){var r=n.localCallFeed.stream;n.localCallFeed.setNewStream(e);var i=n.localCallFeed.isAudioMuted(),s=n.localCallFeed.isVideoMuted();N.log("GroupCall ".concat(n.groupCallId," updateLocalUsermediaStream() (oldStreamId=").concat(r.id,", newStreamId=").concat(e.id,", micShouldBeMuted=").concat(i,", vidShouldBeMuted=").concat(s,")")),Zr(e.getAudioTracks(),!i),Zr(e.getVideoTracks(),!s),n.client.getMediaHandler().stopUserMediaStream(r)}})()}enter(){var e=this;return B(function*(){if(e.state===hr.LocalCallFeedUninitialized)yield e.initLocalCallFeed();else if(e.state!==hr.LocalCallFeedInitialized)throw new Error('Cannot enter call in the "'.concat(e.state,'" state'));N.log("GroupCall ".concat(e.groupCallId," enter() running")),e.state=hr.Entered,e.client.on(RA.Incoming,e.onIncomingCall);for(var n of e.client.callEventHandler.calls.values())e.onIncomingCall(n);e.useLivekit||(e.retryCallLoopInterval=setInterval(e.onRetryCallLoop,e.retryCallInterval),e.activeSpeaker=void 0,e.onActiveSpeakerLoop(),e.activeSpeakerLoopInterval=setInterval(e.onActiveSpeakerLoop,e.activeSpeakerInterval))})()}dispose(){var e;this.localCallFeed&&(this.removeUserMediaFeed(this.localCallFeed),this.localCallFeed=void 0),this.localScreenshareFeed&&(this.client.getMediaHandler().stopScreensharingStream(this.localScreenshareFeed.stream),this.removeScreenshareFeed(this.localScreenshareFeed),this.localScreenshareFeed=void 0,this.localDesktopCapturerSourceId=void 0),this.client.getMediaHandler().stopAllStreams(),this.transmitTimer!==null&&(clearTimeout(this.transmitTimer),this.transmitTimer=null),this.retryCallLoopInterval!==void 0&&(clearInterval(this.retryCallLoopInterval),this.retryCallLoopInterval=void 0),this.participantsExpirationTimer!==null&&(clearTimeout(this.participantsExpirationTimer),this.participantsExpirationTimer=null),this.state===hr.Entered&&(this.forEachCall(n=>n.hangup(Ct.UserHangup,!1)),this.activeSpeaker=void 0,clearInterval(this.activeSpeakerLoopInterval),this.retryCallCounts.clear(),clearInterval(this.retryCallLoopInterval),this.client.removeListener(RA.Incoming,this.onIncomingCall),(e=this.stats)===null||e===void 0||e.stop())}leave(){this.dispose(),this.state=hr.LocalCallFeedUninitialized}terminate(){var e=arguments,n=this;return B(function*(){var r=e.length>0&&e[0]!==void 0?e[0]:!0;if(n.dispose(),n.room.off(Rt.Update,n.onRoomState),n.client.groupCallEventHandler.groupCalls.delete(n.room.roomId),n.client.emit(kA.Ended,n),n.state=hr.Ended,r){var i=n.room.currentState.getStateEvents(ee.GroupCallPrefix,n.groupCallId);yield n.client.sendStateEvent(n.room.roomId,ee.GroupCallPrefix,Q2(Q2({},i.getContent()),{},{"m.terminated":b0e.CallEnded}),n.groupCallId)}})()}isLocalVideoMuted(){return this.localCallFeed?this.localCallFeed.isVideoMuted():!0}isMicrophoneMuted(){return this.localCallFeed?this.localCallFeed.isAudioMuted():!0}setMicrophoneMuted(e){var n=this;return B(function*(){if(!e&&!(yield n.client.getMediaHandler().hasAudioDevice()))return!1;var r=!e&&n.isPtt;n.isPtt&&(!e&&n.isMicrophoneMuted()?n.transmitTimer=setTimeout(()=>{n.setMicrophoneMuted(!0)},n.pttMaxTransmitTime):e&&!n.isMicrophoneMuted()&&(n.transmitTimer!==null&&clearTimeout(n.transmitTimer),n.transmitTimer=null)),n.forEachCall(o=>{var a;return(a=o.localUsermediaFeed)===null||a===void 0?void 0:a.setAudioVideoMuted(e,null)});var i=(function(){var o=B(function*(){var a=[];n.forEachCall(c=>a.push(c.sendMetadataUpdate())),yield Promise.all(a).catch(c=>N.info("GroupCall ".concat(n.groupCallId," setMicrophoneMuted() failed to send some metadata updates"),c))});return function(){return o.apply(this,arguments)}})();if(r&&(yield i()),n.localCallFeed){N.log("GroupCall ".concat(n.groupCallId," setMicrophoneMuted() (streamId=").concat(n.localCallFeed.stream.id,", muted=").concat(e,")"));var s=yield n.checkAudioPermissionIfNecessary(e);if(!s)return!1;n.localCallFeed.setAudioVideoMuted(e,null),Zr(n.localCallFeed.stream.getAudioTracks(),!e)}else N.log("GroupCall ".concat(n.groupCallId," setMicrophoneMuted() no stream muted (muted=").concat(e,")")),n.initWithAudioMuted=e;return n.forEachCall(o=>Zr(o.localUsermediaFeed.stream.getAudioTracks(),!e&&n.callExpected(o))),n.emit(Mn.LocalMuteStateChanged,e,n.isLocalVideoMuted()),r||(yield i()),!0})()}checkAudioPermissionIfNecessary(e){var n=this;return B(function*(){try{if(!e&&n.localCallFeed&&!n.localCallFeed.hasAudioTrack){var r=yield n.client.getMediaHandler().getUserMediaStream(!0,!n.localCallFeed.isVideoMuted());if(r?.getTracks().length===0)return N.log("GroupCall ".concat(n.groupCallId," setMicrophoneMuted() no device to receive local stream, muted=").concat(e)),!1}}catch{return N.log("GroupCall ".concat(n.groupCallId," setMicrophoneMuted() no device or permission to receive local stream, muted=").concat(e)),!1}return!0})()}setLocalVideoMuted(e){var n=this;return B(function*(){if(!e&&!(yield n.client.getMediaHandler().hasVideoDevice()))return!1;if(n.localCallFeed){N.log("GroupCall ".concat(n.groupCallId," setLocalVideoMuted() (stream=").concat(n.localCallFeed.stream.id,", muted=").concat(e,")"));try{var r=yield n.client.getMediaHandler().getUserMediaStream(!0,!e);yield n.updateLocalUsermediaStream(r),n.localCallFeed.setAudioVideoMuted(null,e),Zr(n.localCallFeed.stream.getVideoTracks(),!e)}catch{return N.log("GroupCall ".concat(n.groupCallId," setLocalVideoMuted() no device or permission to receive local stream, muted=").concat(e)),!1}}else N.log("GroupCall ".concat(n.groupCallId," setLocalVideoMuted() no stream muted (muted=").concat(e,")")),n.initWithVideoMuted=e;var i=[];return n.forEachCall(s=>i.push(s.setLocalVideoMuted(e))),yield Promise.all(i),n.forEachCall(s=>Zr(s.localUsermediaFeed.stream.getVideoTracks(),!e&&n.callExpected(s))),n.emit(Mn.LocalMuteStateChanged,n.isMicrophoneMuted(),e),!0})()}setScreensharingEnabled(e){var n=arguments,r=this;return B(function*(){var i=n.length>1&&n[1]!==void 0?n[1]:{};if(e===r.isScreensharing())return e;if(e)try{N.log("GroupCall ".concat(r.groupCallId," setScreensharingEnabled() is asking for screensharing permissions"));var s=yield r.client.getMediaHandler().getScreensharingStream(i),o=function*(l){var d=()=>{r.setScreensharingEnabled(!1),l.removeEventListener("ended",d)};l.addEventListener("ended",d)};for(var a of s.getTracks())yield*o(a);return N.log("GroupCall ".concat(r.groupCallId," setScreensharingEnabled() granted screensharing permissions. Setting screensharing enabled on all calls")),r.localDesktopCapturerSourceId=i.desktopCapturerSourceId,r.localScreenshareFeed=new Au({client:r.client,roomId:r.room.roomId,userId:r.client.getUserId(),deviceId:r.client.getDeviceId(),stream:s,purpose:On.Screenshare,audioMuted:!1,videoMuted:!1}),r.addScreenshareFeed(r.localScreenshareFeed),r.emit(Mn.LocalScreenshareStateChanged,!0,r.localScreenshareFeed,r.localDesktopCapturerSourceId),r.forEachCall(c=>c.pushLocalFeed(r.localScreenshareFeed.clone())),!0}catch(c){if(i.throwOnFail)throw c;return N.error("GroupCall ".concat(r.groupCallId," setScreensharingEnabled() enabling screensharing error"),c),r.emit(Mn.Error,new IA(K1.NoUserMedia,"Failed to get screen-sharing stream: ",c)),!1}else return r.forEachCall(c=>{c.localScreensharingFeed&&c.removeLocalFeed(c.localScreensharingFeed)}),r.client.getMediaHandler().stopScreensharingStream(r.localScreenshareFeed.stream),r.removeScreenshareFeed(r.localScreenshareFeed),r.localScreenshareFeed=void 0,r.localDesktopCapturerSourceId=void 0,r.emit(Mn.LocalScreenshareStateChanged,!1,void 0,void 0),!1})()}isScreensharing(){return!!this.localScreenshareFeed}wantsOutgoingCall(e,n){var r=this.client.getUserId(),i=this.client.getDeviceId();return e>=r&&(e!==r||n>i)}placeOutgoingCalls(){var e=this,n=!1,r=function(a){var c,l=(c=e.calls.get(a))!==null&&c!==void 0?c:new Map,d=function(y){var v=l.get(y);if(v?.getOpponentSessionId()!==m.sessionId&&e.wantsOutgoingCall(a,y)){n=!0,v!==void 0&&(N.debug("GroupCall ".concat(e.groupCallId," placeOutgoingCalls() replacing call (userId=").concat(a,", deviceId=").concat(y,", callId=").concat(v.callId,")")),v.hangup(Ct.NewSession,!1));var E=Ab(e.client,e.room.roomId,{invitee:a,opponentDeviceId:y,opponentSessionId:m.sessionId,groupCallId:e.groupCallId});E===null?(N.error("GroupCall ".concat(e.groupCallId," placeOutgoingCalls() failed to create call (userId=").concat(a,", device=").concat(y,")")),l.delete(y)):(e.initCall(E),l.set(y,E),N.debug("GroupCall ".concat(e.groupCallId," placeOutgoingCalls() placing call (userId=").concat(a,", deviceId=").concat(y,", sessionId=").concat(m.sessionId,")")),E.placeCallWithCallFeeds(e.getLocalFeeds().map(w=>w.clone()),m.screensharing).then(()=>{e.dataChannelsEnabled&&E.createDataChannel("datachannel",e.dataChannelOptions)}).catch(w=>{N.warn("GroupCall ".concat(e.groupCallId," placeOutgoingCalls() failed to place call (userId=").concat(a,")"),w),w instanceof vu&&w.code===K1.UnknownDevice?e.emit(Mn.Error,w):e.emit(Mn.Error,new IA(K1.PlaceCallFailed,"Failed to place call to ".concat(a))),E.hangup(Ct.SignallingFailed,!1),l.get(y)===E&&l.delete(y)}))}};for(var[h,m]of s)d(h);l.size>0?e.calls.set(a,l):e.calls.delete(a)};for(var[{userId:i},s]of this.participants)r(i);n&&this.emit(Mn.CallsChanged,this.calls)}getMemberStateEvents(e){return e===void 0?this.room.currentState.getStateEvents(ee.GroupCallMemberPrefix):this.room.currentState.getStateEvents(ee.GroupCallMemberPrefix,e)}initCall(e){var n=Z2(e);if(!n)throw new Error("Cannot init call without user id");var r=()=>this.onCallFeedsChanged(e),i=(c,l)=>this.onCallStateChanged(e,c,l),s=this.onCallHangup,o=c=>this.onCallReplaced(e,c),a=this.callHandlers.get(n);a===void 0&&(a=new Map,this.callHandlers.set(n,a)),a.set(e.getOpponentDeviceId(),{onCallFeedsChanged:r,onCallStateChanged:i,onCallHangup:s,onCallReplaced:o}),e.on(At.FeedsChanged,r),e.on(At.State,i),e.on(At.Hangup,s),e.on(At.Replaced,o),e.isPtt=this.isPtt,this.reEmitter.reEmit(e,Object.values(At)),e.initStats(this.getGroupCallStats()),r()}disposeCall(e,n){var r=Z2(e),i=e.getOpponentDeviceId();if(!r)throw new Error("Cannot dispose call without user id");var s=this.callHandlers.get(r),{onCallFeedsChanged:o,onCallStateChanged:a,onCallHangup:c,onCallReplaced:l}=s.get(i);if(e.removeListener(At.FeedsChanged,o),e.removeListener(At.State,a),e.removeListener(At.Hangup,c),e.removeListener(At.Replaced,l),s.delete(r),s.size===0&&this.callHandlers.delete(r),e.hangupReason!==Ct.Replaced){var d=this.getUserMediaFeed(r,i);d&&this.removeUserMediaFeed(d);var h=this.getScreenshareFeed(r,i);h&&this.removeScreenshareFeed(h)}}getUserMediaFeed(e,n){return this.userMediaFeeds.find(r=>r.userId===e&&r.deviceId===n)}addUserMediaFeed(e){this.userMediaFeeds.push(e),e.measureVolumeActivity(!0),this.emit(Mn.UserMediaFeedsChanged,this.userMediaFeeds)}replaceUserMediaFeed(e,n){var r=this.userMediaFeeds.findIndex(i=>i.userId===e.userId&&i.deviceId===e.deviceId);if(r===-1)throw new Error("Couldn't find user media feed to replace");this.userMediaFeeds.splice(r,1,n),e.dispose(),n.measureVolumeActivity(!0),this.emit(Mn.UserMediaFeedsChanged,this.userMediaFeeds)}removeUserMediaFeed(e){var n=this.userMediaFeeds.findIndex(r=>r.userId===e.userId&&r.deviceId===e.deviceId);if(n===-1)throw new Error("Couldn't find user media feed to remove");this.userMediaFeeds.splice(n,1),e.dispose(),this.emit(Mn.UserMediaFeedsChanged,this.userMediaFeeds),this.activeSpeaker===e&&(this.activeSpeaker=this.userMediaFeeds[0],this.emit(Mn.ActiveSpeakerChanged,this.activeSpeaker))}getScreenshareFeed(e,n){return this.screenshareFeeds.find(r=>r.userId===e&&r.deviceId===n)}addScreenshareFeed(e){this.screenshareFeeds.push(e),this.emit(Mn.ScreenshareFeedsChanged,this.screenshareFeeds)}replaceScreenshareFeed(e,n){var r=this.screenshareFeeds.findIndex(i=>i.userId===e.userId&&i.deviceId===e.deviceId);if(r===-1)throw new Error("Couldn't find screenshare feed to replace");this.screenshareFeeds.splice(r,1,n),e.dispose(),this.emit(Mn.ScreenshareFeedsChanged,this.screenshareFeeds)}removeScreenshareFeed(e){var n=this.screenshareFeeds.findIndex(r=>r.userId===e.userId&&r.deviceId===e.deviceId);if(n===-1)throw new Error("Couldn't find screenshare feed to remove");this.screenshareFeeds.splice(n,1),e.dispose(),this.emit(Mn.ScreenshareFeedsChanged,this.screenshareFeeds)}updateParticipants(){var e=this.room.getMember(this.client.getSafeUserId());if(!e){N.warn("GroupCall ".concat(this.groupCallId," updateParticipants() tried to update participants before local room member is available"));return}if(this.participantsExpirationTimer!==null&&(clearTimeout(this.participantsExpirationTimer),this.participantsExpirationTimer=null),this.state===hr.Ended){this.participants=new Map;return}var n=new Map,r=Date.now(),i=this.state===hr.Entered||this.enteredViaAnotherSession,s=1/0;for(var o of this.getMemberStateEvents()){var a=this.room.getMember(o.getStateKey()),c=o.getContent(),l=Array.isArray(c["m.calls"])?c["m.calls"]:[],d=l.find(E=>E["m.call_id"]===this.groupCallId),h=Array.isArray(d?.["m.devices"])?d["m.devices"]:[],m=h.filter(E=>typeof E.device_id=="string"&&typeof E.session_id=="string"&&typeof E.expires_ts=="number"&&E.expires_ts>r&&Array.isArray(E.feeds));if(!i&&a?.userId===this.client.getUserId()&&(m=m.filter(E=>E.device_id!==this.client.getDeviceId())),m.length>0&&a?.membership===Ke.Join){var g=new Map;n.set(a,g);for(var y of m)g.set(y.device_id,{sessionId:y.session_id,screensharing:y.feeds.some(E=>E.purpose===On.Screenshare)}),y.expires_ts<s&&(s=y.expires_ts)}}if(i){var v=n.get(e);v===void 0&&(v=new Map,n.set(e,v)),v.has(this.client.getDeviceId())||v.set(this.client.getDeviceId(),{sessionId:this.client.getSessionId(),screensharing:this.getLocalFeeds().some(E=>E.purpose===On.Screenshare)})}this.participants=n,s<1/0&&(this.participantsExpirationTimer=setTimeout(()=>this.updateParticipants(),s-r))}updateDevices(e){var n=arguments,r=this;return B(function*(){var i,s=n.length>1&&n[1]!==void 0?n[1]:!1,o=Date.now(),a=r.client.getUserId(),c=r.getMemberStateEvents(a),l=(i=c?.getContent())!==null&&i!==void 0?i:{},d=Array.isArray(l["m.calls"])?l["m.calls"]:[],h=null,m=[];for(var g of d)g["m.call_id"]===r.groupCallId?h=g:m.push(g);h===null&&(h={});var y=Array.isArray(h["m.devices"])?h["m.devices"]:[],v=y.filter(x=>typeof x.device_id=="string"&&typeof x.session_id=="string"&&typeof x.expires_ts=="number"&&x.expires_ts>o&&Array.isArray(x.feeds)),E=e(v);if(E!==null){var w=[...m];E.length>0&&w.push(Q2(Q2({},h),{},{"m.call_id":r.groupCallId,"m.devices":E}));var R={"m.calls":w};yield r.client.sendStateEvent(r.room.roomId,ee.GroupCallMemberPrefix,R,a,{keepAlive:s})}})()}addDeviceToMemberState(){var e=this;return B(function*(){yield e.updateDevices(n=>[...n.filter(r=>r.device_id!==e.client.getDeviceId()),{device_id:e.client.getDeviceId(),session_id:e.client.getSessionId(),expires_ts:Date.now()+lB,feeds:e.getLocalFeeds().map(r=>({purpose:r.purpose}))}])})()}updateMemberState(){var e=this;return B(function*(){e.resendMemberStateTimer!==null&&(clearInterval(e.resendMemberStateTimer),e.resendMemberStateTimer=null),e.state===hr.Entered?(yield e.addDeviceToMemberState(),e.resendMemberStateTimer=setInterval(B(function*(){N.log("GroupCall ".concat(e.groupCallId,' updateMemberState() resending call member state"'));try{yield e.addDeviceToMemberState()}catch(n){N.error("GroupCall ".concat(e.groupCallId," updateMemberState() failed to resend call member state"),n)}}),lB*3/4)):yield e.updateDevices(n=>n.filter(r=>r.device_id!==e.client.getDeviceId()),!0)})()}cleanMemberState(){var e=this;return B(function*(){var{devices:n}=yield e.client.getDevices(),r=new Map(n.map(i=>[i.device_id,i]));yield e.updateDevices(i=>{var s=i.filter(o=>{var a=r.get(o.device_id);return a?.last_seen_ts!==void 0&&!(o.device_id===e.client.getDeviceId()&&e.state!==hr.Entered&&!e.enteredViaAnotherSession)});return s.length===i.length?null:s})})()}getGroupCallStats(){if(this.stats===void 0){var e=this.client.getUserId()||"unknown";this.stats=new y0e(this.groupCallId,e,this.statsCollectIntervalTime),this.stats.reports.on(Fu.CONNECTION_STATS,this.onConnectionStats),this.stats.reports.on(Fu.BYTE_SENT_STATS,this.onByteSentStats),this.stats.reports.on(Fu.SUMMARY_STATS,this.onSummaryStats),this.stats.reports.on(Fu.CALL_FEED_REPORT,this.onCallFeedReport)}return this.stats}setGroupCallStatsInterval(e){this.statsCollectIntervalTime=e,this.stats!==void 0&&(this.stats.stop(),this.stats.setInterval(e),e>0&&this.stats.start())}}function uB(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function ew(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?uB(Object(n),!0).forEach(function(r){M(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):uB(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var ft=(function(t){return t.Fledgling="fledgling",t.InviteSent="invite_sent",t.WaitLocalMedia="wait_local_media",t.CreateOffer="create_offer",t.CreateAnswer="create_answer",t.Connecting="connecting",t.Connected="connected",t.Ringing="ringing",t.Ended="ended",t})({}),dB=(function(t){return t.Voice="voice",t.Video="video",t})({}),rf=(function(t){return t.Inbound="inbound",t.Outbound="outbound",t})({}),Tr=(function(t){return t.Local="local",t.Remote="remote",t})({}),At=(function(t){return t.Hangup="hangup",t.State="state",t.Error="error",t.Replaced="replaced",t.LocalHoldUnhold="local_hold_unhold",t.RemoteHoldUnhold="remote_hold_unhold",t.HoldUnhold="hold_unhold",t.FeedsChanged="feeds_changed",t.AssertedIdentityChanged="asserted_identity_changed",t.LengthChanged="length_changed",t.DataChannel="datachannel",t.SendVoipEvent="send_voip_event",t.PeerConnectionCreated="peer_connection_created",t})({}),Ct=(function(t){return t.UserHangup="user_hangup",t.LocalOfferFailed="local_offer_failed",t.NoUserMedia="no_user_media",t.UnknownDevices="unknown_devices",t.SendInvite="send_invite",t.CreateAnswer="create_answer",t.CreateOffer="create_offer",t.SendAnswer="send_answer",t.SetRemoteDescription="set_remote_description",t.SetLocalDescription="set_local_description",t.AnsweredElsewhere="answered_elsewhere",t.IceFailed="ice_failed",t.InviteTimeout="invite_timeout",t.Replaced="replaced",t.SignallingFailed="signalling_timeout",t.UserBusy="user_busy",t.Transferred="transferred",t.NewSession="new_session",t})({}),_0e="1",S0e="stun:turn.matrix.org",tx=60*1e3,w0e=1e3,E0e=30*1e3,C0e=2*1e3;class vu extends Error{constructor(e,n,r){super(n+": "+r),M(this,"code",void 0),this.code=e}}function ep(){return Date.now().toString()+Qo(16)}function fB(t){var e=[{mediaType:"audio",codec:"opus",enableDtx:!0,maxAverageBitrate:t?12e3:void 0}];return e}function fc(t,e){return t+":"+e}class T0e extends Gn{constructor(e){var n,r;if(super(),n=this,M(this,"roomId",void 0),M(this,"callId",void 0),M(this,"invitee",void 0),M(this,"hangupParty",void 0),M(this,"hangupReason",void 0),M(this,"direction",void 0),M(this,"ourPartyId",void 0),M(this,"peerConn",void 0),M(this,"toDeviceSeq",0),M(this,"isPtt",!1),M(this,"_state",ft.Fledgling),M(this,"client",void 0),M(this,"forceTURN",void 0),M(this,"turnServers",void 0),M(this,"candidateSendQueue",[]),M(this,"candidateSendTries",0),M(this,"candidatesEnded",!1),M(this,"feeds",[]),M(this,"transceivers",new Map),M(this,"inviteOrAnswerSent",!1),M(this,"waitForLocalAVStream",!1),M(this,"successor",void 0),M(this,"opponentMember",void 0),M(this,"opponentVersion",void 0),M(this,"opponentPartyId",void 0),M(this,"opponentCaps",void 0),M(this,"iceDisconnectedTimeout",void 0),M(this,"iceReconnectionTimeOut",void 0),M(this,"inviteTimeout",void 0),M(this,"removeTrackListeners",new Map),M(this,"remoteOnHold",!1),M(this,"callStatsAtEnd",void 0),M(this,"makingOffer",!1),M(this,"ignoreOffer",!1),M(this,"isSettingRemoteAnswerPending",!1),M(this,"responsePromiseChain",void 0),M(this,"remoteCandidateBuffer",new Map),M(this,"remoteAssertedIdentity",void 0),M(this,"remoteSDPStreamMetadata",void 0),M(this,"callLengthInterval",void 0),M(this,"callStartTime",void 0),M(this,"opponentDeviceId",void 0),M(this,"hasOpponentDeviceInfo",void 0),M(this,"opponentSessionId",void 0),M(this,"groupCallId",void 0),M(this,"stopVideoTrackTimer",void 0),M(this,"isOnlyDataChannelAllowed",void 0),M(this,"stats",void 0),M(this,"gotLocalIceCandidate",s=>{if(s.candidate){if(this.candidatesEnded&&N.warn("Call ".concat(this.callId," gotLocalIceCandidate() got candidate after candidates have ended!")),N.debug("Call ".concat(this.callId," got local ICE ").concat(s.candidate.sdpMid," ").concat(s.candidate.candidate)),this.callHasEnded())return;s.candidate.candidate===""?this.queueCandidate(null):this.queueCandidate(s.candidate)}}),M(this,"onIceGatheringStateChange",s=>{var o;N.debug("Call ".concat(this.callId," onIceGatheringStateChange() ice gathering state changed to ").concat(this.peerConn.iceGatheringState)),((o=this.peerConn)===null||o===void 0?void 0:o.iceGatheringState)==="complete"&&(this.queueCandidate(null),N.debug("Call ".concat(this.callId," onIceGatheringStateChange() ice gathering state complete, set candidates have ended")))}),M(this,"getLocalOfferFailed",s=>{N.error("Call ".concat(this.callId," getLocalOfferFailed() running"),s),this.emit(At.Error,new vu(Ct.LocalOfferFailed,"Failed to get local offer!",s),this),this.terminate(Tr.Local,Ct.LocalOfferFailed,!1)}),M(this,"getUserMediaFailed",s=>{if(this.successor){this.successor.getUserMediaFailed(s);return}N.warn("Call ".concat(this.callId," getUserMediaFailed() failed to get user media - ending call"),s),this.emit(At.Error,new vu(Ct.NoUserMedia,"Couldn't start capturing media! Is your microphone set up and does this app have permission?",s),this),this.terminate(Tr.Local,Ct.NoUserMedia,!1)}),M(this,"placeCallFailed",s=>{if(this.successor){this.successor.placeCallFailed(s);return}N.warn("Call ".concat(this.callId," placeCallWithCallFeeds() failed - ending call"),s),this.emit(At.Error,new vu(Ct.IceFailed,"Couldn't start call! Invalid ICE server configuration.",s),this),this.terminate(Tr.Local,Ct.IceFailed,!1)}),M(this,"onIceConnectionStateChanged",()=>{var s,o,a,c,l,d;if(!this.callHasEnded()){if(N.debug("Call ".concat(this.callId," onIceConnectionStateChanged() running (state=").concat((s=this.peerConn)===null||s===void 0?void 0:s.iceConnectionState,", conn=").concat((o=this.peerConn)===null||o===void 0?void 0:o.connectionState,")")),["connected","completed"].includes((a=(c=this.peerConn)===null||c===void 0?void 0:c.iceConnectionState)!==null&&a!==void 0?a:""))clearTimeout(this.iceDisconnectedTimeout),this.iceDisconnectedTimeout=void 0,this.iceReconnectionTimeOut&&clearTimeout(this.iceReconnectionTimeOut),this.state=ft.Connected,!this.callLengthInterval&&!this.callStartTime&&(this.callStartTime=Date.now(),this.callLengthInterval=setInterval(()=>{this.emit(At.LengthChanged,Math.round((Date.now()-this.callStartTime)/1e3),this)},w0e));else if(((l=this.peerConn)===null||l===void 0?void 0:l.iceConnectionState)=="failed"){var h;if(this.candidatesEnded=!1,(h=this.peerConn)!==null&&h!==void 0&&h.restartIce){var m;this.candidatesEnded=!1,N.debug("Call ".concat(this.callId," onIceConnectionStateChanged() ice restart (state=").concat((m=this.peerConn)===null||m===void 0?void 0:m.iceConnectionState,")")),this.peerConn.restartIce()}else N.info("Call ".concat(this.callId," onIceConnectionStateChanged() hanging up call (ICE failed and no ICE restart method)")),this.hangup(Ct.IceFailed,!1)}else((d=this.peerConn)===null||d===void 0?void 0:d.iceConnectionState)=="disconnected"&&(this.candidatesEnded=!1,this.iceReconnectionTimeOut=setTimeout(()=>{var y,v,E;N.info("Call ".concat(this.callId," onIceConnectionStateChanged() ICE restarting because of ICE disconnected, (state=").concat((y=this.peerConn)===null||y===void 0?void 0:y.iceConnectionState,", conn=").concat((v=this.peerConn)===null||v===void 0?void 0:v.connectionState,")")),(E=this.peerConn)!==null&&E!==void 0&&E.restartIce&&(this.candidatesEnded=!1,this.peerConn.restartIce()),this.iceReconnectionTimeOut=void 0},C0e),this.iceDisconnectedTimeout=setTimeout(()=>{N.info("Call ".concat(this.callId," onIceConnectionStateChanged() hanging up call (ICE disconnected for too long)")),this.hangup(Ct.IceFailed,!1)},E0e),this.state=ft.Connecting);if(this.isPtt&&["failed","disconnected"].includes(this.peerConn.iceConnectionState))for(var g of this.getRemoteFeeds())g.setAudioVideoMuted(!0,!0)}}),M(this,"onSignallingStateChanged",()=>{var s;N.debug("Call ".concat(this.callId," onSignallingStateChanged() running (state=").concat((s=this.peerConn)===null||s===void 0?void 0:s.signalingState,")"))}),M(this,"onTrack",s=>{if(s.streams.length===0){N.warn("Call ".concat(this.callId," onTrack() called with streamless track streamless (kind=").concat(s.track.kind,")"));return}var o=s.streams[0];if(this.pushRemoteFeed(o),!this.removeTrackListeners.has(o)){var a=()=>{o.getTracks().length===0&&(N.info("Call ".concat(this.callId," onTrack() removing track (streamId=").concat(o.id,")")),this.deleteFeedByStream(o),o.removeEventListener("removetrack",a),this.removeTrackListeners.delete(o))};o.addEventListener("removetrack",a),this.removeTrackListeners.set(o,a)}}),M(this,"onDataChannel",s=>{this.emit(At.DataChannel,s.channel,this)}),M(this,"onNegotiationNeeded",B(function*(){if(N.info("Call ".concat(n.callId," onNegotiationNeeded() negotiation is needed!")),n.state!==ft.CreateOffer&&n.opponentVersion===0){N.info("Call ".concat(n.callId," onNegotiationNeeded() opponent does not support renegotiation: ignoring negotiationneeded event"));return}n.queueGotLocalOffer()})),M(this,"onHangupReceived",s=>{N.debug("Call ".concat(this.callId," onHangupReceived() running")),this.partyIdMatches(s)||this.state===ft.Ringing?this.terminate(Tr.Remote,s.reason||Ct.UserHangup,!0):N.info("Call ".concat(this.callId," onHangupReceived() ignoring message from party ID ").concat(s.party_id,": our partner is ").concat(this.opponentPartyId))}),M(this,"onRejectReceived",s=>{N.debug("Call ".concat(this.callId," onRejectReceived() running"));var o=[ft.InviteSent,ft.Ringing].includes(this.state)||this.state===ft.Fledgling&&this.direction===rf.Inbound;o?this.terminate(Tr.Remote,s.reason||Ct.UserHangup,!0):N.debug("Call ".concat(this.callId," onRejectReceived() called in wrong state (state=").concat(this.state,")"))}),M(this,"onAnsweredElsewhere",s=>{N.debug("Call ".concat(this.callId," onAnsweredElsewhere() running")),this.terminate(Tr.Remote,Ct.AnsweredElsewhere,!0)}),this.roomId=e.roomId,this.invitee=e.invitee,this.client=e.client,!this.client.deviceId)throw new Error("Client must have a device ID to start calls");this.forceTURN=(r=e.forceTURN)!==null&&r!==void 0?r:!1,this.ourPartyId=this.client.deviceId,this.opponentDeviceId=e.opponentDeviceId,this.opponentSessionId=e.opponentSessionId,this.groupCallId=e.groupCallId,this.turnServers=e.turnServers||[],this.turnServers.length===0&&this.client.isFallbackICEServerAllowed()&&this.turnServers.push({urls:[S0e]});for(var i of this.turnServers)VX(i,["urls"]);this.callId=ep(),this.isOnlyDataChannelAllowed=this.client.isVoipWithNoMediaAllowed}placeVoiceCall(){var e=this;return B(function*(){yield e.placeCall(!0,!1)})()}placeVideoCall(){var e=this;return B(function*(){yield e.placeCall(!0,!0)})()}createDataChannel(e,n){var r=this.peerConn.createDataChannel(e,n);return this.emit(At.DataChannel,r,this),r}getOpponentMember(){return this.opponentMember}getOpponentDeviceId(){return this.opponentDeviceId}getOpponentSessionId(){return this.opponentSessionId}opponentCanBeTransferred(){return!!(this.opponentCaps&&this.opponentCaps["m.call.transferee"])}opponentSupportsDTMF(){return!!(this.opponentCaps&&this.opponentCaps["m.call.dtmf"])}getRemoteAssertedIdentity(){return this.remoteAssertedIdentity}get state(){return this._state}set state(e){var n=this._state;this._state=e,this.emit(At.State,e,n,this)}get type(){return this.hasUserMediaVideoSender||this.hasRemoteUserMediaVideoTrack?dB.Video:dB.Voice}get hasLocalUserMediaVideoTrack(){var e;return!!((e=this.localUsermediaStream)!==null&&e!==void 0&&e.getVideoTracks().length)}get hasRemoteUserMediaVideoTrack(){return this.getRemoteFeeds().some(e=>{var n;return e.purpose===On.Usermedia&&((n=e.stream)===null||n===void 0?void 0:n.getVideoTracks().length)})}get hasLocalUserMediaAudioTrack(){var e;return!!((e=this.localUsermediaStream)!==null&&e!==void 0&&e.getAudioTracks().length)}get hasRemoteUserMediaAudioTrack(){return this.getRemoteFeeds().some(e=>{var n;return e.purpose===On.Usermedia&&!!((n=e.stream)!==null&&n!==void 0&&n.getAudioTracks().length)})}get hasUserMediaAudioSender(){var e;return!!(!((e=this.transceivers.get(fc(On.Usermedia,"audio")))===null||e===void 0)&&e.sender)}get hasUserMediaVideoSender(){var e;return!!(!((e=this.transceivers.get(fc(On.Usermedia,"video")))===null||e===void 0)&&e.sender)}get localUsermediaFeed(){return this.getLocalFeeds().find(e=>e.purpose===On.Usermedia)}get localScreensharingFeed(){return this.getLocalFeeds().find(e=>e.purpose===On.Screenshare)}get localUsermediaStream(){var e;return(e=this.localUsermediaFeed)===null||e===void 0?void 0:e.stream}get localScreensharingStream(){var e;return(e=this.localScreensharingFeed)===null||e===void 0?void 0:e.stream}get remoteUsermediaFeed(){return this.getRemoteFeeds().find(e=>e.purpose===On.Usermedia)}get remoteScreensharingFeed(){return this.getRemoteFeeds().find(e=>e.purpose===On.Screenshare)}get remoteUsermediaStream(){var e;return(e=this.remoteUsermediaFeed)===null||e===void 0?void 0:e.stream}get remoteScreensharingStream(){var e;return(e=this.remoteScreensharingFeed)===null||e===void 0?void 0:e.stream}getFeedByStreamId(e){return this.getFeeds().find(n=>n.stream.id===e)}getFeeds(){return this.feeds}getLocalFeeds(){return this.feeds.filter(e=>e.isLocal())}getRemoteFeeds(){return this.feeds.filter(e=>!e.isLocal())}initOpponentCrypto(){var e=this;return B(function*(){var n;if(e.opponentDeviceId&&e.client.getUseE2eForGroupCall()){if(!e.client.getCrypto()){e.hasOpponentDeviceInfo=!0;return}var r=e.invitee||((n=e.getOpponentMember())===null||n===void 0?void 0:n.userId);throw r?(e.hasOpponentDeviceInfo=!1,new XJ(r)):new Error("Couldn't find opponent user ID to init crypto")}})()}getLocalSDPStreamMetadata(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n={};for(var r of this.getLocalFeeds())e&&(r.sdpMetadataStreamId=r.stream.id),n[r.sdpMetadataStreamId]={purpose:r.purpose,audio_muted:r.isAudioMuted(),video_muted:r.isVideoMuted()};return n}noIncomingFeeds(){return!this.feeds.some(e=>!e.isLocal())}pushRemoteFeed(e){if(!this.opponentSupportsSDPStreamMetadata()){this.pushRemoteFeedWithoutMetadata(e);return}var n=this.getOpponentMember().userId,r=this.remoteSDPStreamMetadata[e.id].purpose,i=this.remoteSDPStreamMetadata[e.id].audio_muted,s=this.remoteSDPStreamMetadata[e.id].video_muted;if(!r){N.warn("Call ".concat(this.callId," pushRemoteFeed() ignoring stream because we didn't get any metadata about it (streamId=").concat(e.id,")"));return}if(this.getFeedByStreamId(e.id)){N.warn("Call ".concat(this.callId," pushRemoteFeed() ignoring stream because we already have a feed for it (streamId=").concat(e.id,")"));return}this.feeds.push(new Au({client:this.client,call:this,roomId:this.roomId,userId:n,deviceId:this.getOpponentDeviceId(),stream:e,purpose:r,audioMuted:i,videoMuted:s})),this.emit(At.FeedsChanged,this.feeds,this),N.info("Call ".concat(this.callId," pushRemoteFeed() pushed stream (streamId=").concat(e.id,", active=").concat(e.active,", purpose=").concat(r,")"))}pushRemoteFeedWithoutMetadata(e){var n,r=this.getOpponentMember().userId,i=On.Usermedia,s=(n=this.feeds.find(o=>!o.isLocal()))===null||n===void 0?void 0:n.stream;if(s&&e.id!==s.id){N.warn("Call ".concat(this.callId," pushRemoteFeedWithoutMetadata() ignoring new stream because we already have stream (streamId=").concat(e.id,")"));return}if(this.getFeedByStreamId(e.id)){N.warn("Call ".concat(this.callId," pushRemoteFeedWithoutMetadata() ignoring stream because we already have a feed for it (streamId=").concat(e.id,")"));return}this.feeds.push(new Au({client:this.client,call:this,roomId:this.roomId,audioMuted:!1,videoMuted:!1,userId:r,deviceId:this.getOpponentDeviceId(),stream:e,purpose:i})),this.emit(At.FeedsChanged,this.feeds,this),N.info("Call ".concat(this.callId," pushRemoteFeedWithoutMetadata() pushed stream (streamId=").concat(e.id,", active=").concat(e.active,")"))}pushNewLocalFeed(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,i=this.client.getUserId();if(Zr(e.getAudioTracks(),!0),Zr(e.getVideoTracks(),!0),this.getFeedByStreamId(e.id)){N.warn("Call ".concat(this.callId," pushNewLocalFeed() ignoring stream because we already have a feed for it (streamId=").concat(e.id,")"));return}this.pushLocalFeed(new Au({client:this.client,roomId:this.roomId,audioMuted:!1,videoMuted:!1,userId:i,deviceId:this.getOpponentDeviceId(),stream:e,purpose:n}),r)}pushLocalFeed(e){var n=this,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(this.feeds.some(o=>e.stream.id===o.stream.id)){N.info("Call ".concat(this.callId," pushLocalFeed() ignoring duplicate local stream (streamId=").concat(e.stream.id,")"));return}if(this.feeds.push(e),r){var i=function(){N.info("Call ".concat(n.callId," pushLocalFeed() adding track to peer connection (id=").concat(s.id,", kind=").concat(s.kind,", streamId=").concat(e.stream.id,", streamPurpose=").concat(e.purpose,", enabled=").concat(s.enabled,")"));var a=fc(e.purpose,s.kind);if(n.transceivers.has(a)){var c=n.transceivers.get(a);c.sender.replaceTrack(s),c.direction=c.direction==="inactive"?"sendonly":"sendrecv"}else{var l=n.peerConn.addTrack(s,e.stream),d=n.peerConn.getTransceivers().find(h=>h.sender===l);d?n.transceivers.set(a,d):N.warn("Call ".concat(n.callId," pushLocalFeed() didn't find a matching transceiver after adding track!"))}};for(var s of e.stream.getTracks())i()}N.info("Call ".concat(this.callId," pushLocalFeed() pushed stream (id=").concat(e.stream.id,", active=").concat(e.stream.active,", purpose=").concat(e.purpose,")")),this.emit(At.FeedsChanged,this.feeds,this)}removeLocalFeed(e){var n=fc(e.purpose,"audio"),r=fc(e.purpose,"video");for(var i of[n,r])if(this.transceivers.has(i)){var s=this.transceivers.get(i);s.sender&&this.peerConn.removeTrack(s.sender)}e.purpose===On.Screenshare&&this.client.getMediaHandler().stopScreensharingStream(e.stream),this.deleteFeed(e)}deleteAllFeeds(){for(var e of this.feeds)(!e.isLocal()||!this.groupCallId)&&e.dispose();this.feeds=[],this.emit(At.FeedsChanged,this.feeds,this)}deleteFeedByStream(e){var n=this.getFeedByStreamId(e.id);if(!n){N.warn("Call ".concat(this.callId," deleteFeedByStream() didn't find the feed to delete (streamId=").concat(e.id,")"));return}this.deleteFeed(n)}deleteFeed(e){e.dispose(),this.feeds.splice(this.feeds.indexOf(e),1),this.emit(At.FeedsChanged,this.feeds,this)}getCurrentCallStats(){var e=this;return B(function*(){return e.callHasEnded()?e.callStatsAtEnd:e.collectCallStats()})()}collectCallStats(){var e=this;return B(function*(){if(e.peerConn){var n=yield e.peerConn.getStats(),r=[];return n.forEach(i=>{r.push(i)}),r}})()}initWithInvite(e){var n=this;return B(function*(){var r,i=e.getContent();n.direction=rf.Inbound;var s=yield n.client.checkTurnServers();s||N.warn("Call ".concat(n.callId," initWithInvite() failed to get TURN credentials! Proceeding with call anyway..."));var o=i[Wd];o?n.updateRemoteSDPStreamMetadata(o):N.debug("Call ".concat(n.callId," initWithInvite() did not get any SDPStreamMetadata! Can not send/receive multiple streams")),n.peerConn=n.createPeerConnection(),n.emit(At.PeerConnectionCreated,n.peerConn,n),n.chooseOpponent(e),yield n.initOpponentCrypto();try{yield n.peerConn.setRemoteDescription(i.offer),N.debug("Call ".concat(n.callId," initWithInvite() set remote description: ").concat(i.offer.type)),yield n.addBufferedIceCandidates()}catch(d){N.debug("Call ".concat(n.callId," initWithInvite() failed to set remote description"),d),n.terminate(Tr.Local,Ct.SetRemoteDescription,!1);return}var a=(r=n.feeds.find(d=>!d.isLocal()))===null||r===void 0?void 0:r.stream;if(!n.isOnlyDataChannelAllowed&&(!a||a.getTracks().length===0)){N.error("Call ".concat(n.callId," initWithInvite() no remote stream or no tracks after setting remote description!")),n.terminate(Tr.Local,Ct.SetRemoteDescription,!1);return}if(n.state=ft.Ringing,e.getLocalAge()){var c=setTimeout(()=>{if(n.state==ft.Ringing){var d;N.debug("Call ".concat(n.callId," initWithInvite() invite has expired. Hanging up.")),n.hangupParty=Tr.Remote,n.state=ft.Ended,n.stopAllMedia(),n.peerConn.signalingState!="closed"&&n.peerConn.close(),(d=n.stats)===null||d===void 0||d.removeStatsReportGatherer(n.callId),n.emit(At.Hangup,n)}},i.lifetime-e.getLocalAge()),l=d=>{d!==ft.Ringing&&(clearTimeout(c),n.off(At.State,l))};n.on(At.State,l)}})()}initWithHangup(e){this.state=ft.Ended}shouldAnswerWithMediaType(e,n,r){return e&&!n?(N.warn("Call ".concat(this.callId," shouldAnswerWithMediaType() unable to answer with ").concat(r," because the other side isn't sending it either.")),!1):!zX(e)&&e!==n&&!this.opponentSupportsSDPStreamMetadata()?(N.warn("Call ".concat(this.callId," shouldAnswerWithMediaType() unable to answer with ").concat(r,"=").concat(e," because the other side doesn't support it. Answering with ").concat(r,"=").concat(n,".")),n):e??n}answer(e,n){var r=this;return B(function*(){if(!r.inviteOrAnswerSent){if(e===!1&&n===!1)throw new Error("You CANNOT answer a call without media");if(!r.localUsermediaStream&&!r.waitForLocalAVStream){var i=r.state,s=r.shouldAnswerWithMediaType(e,r.hasRemoteUserMediaAudioTrack,"audio"),o=r.shouldAnswerWithMediaType(n,r.hasRemoteUserMediaVideoTrack,"video");r.state=ft.WaitLocalMedia,r.waitForLocalAVStream=!0;try{var a,c=yield r.client.getMediaHandler().getUserMediaStream(s,o);r.waitForLocalAVStream=!1;var l=new Au({client:r.client,roomId:r.roomId,userId:r.client.getUserId(),deviceId:(a=r.client.getDeviceId())!==null&&a!==void 0?a:void 0,stream:c,purpose:On.Usermedia,audioMuted:!1,videoMuted:!1}),d=[l];r.localScreensharingFeed&&d.push(r.localScreensharingFeed),r.answerWithCallFeeds(d)}catch(h){if(o)N.warn("Call ".concat(r.callId," answer() failed to getUserMedia(), trying to getUserMedia() without video")),r.state=i,r.waitForLocalAVStream=!1,yield r.answer(s,!1);else{r.getUserMediaFailed(h);return}}}else r.waitForLocalAVStream&&(r.state=ft.WaitLocalMedia)}})()}answerWithCallFeeds(e){this.inviteOrAnswerSent||this.queueGotCallFeedsForAnswer(e)}replacedBy(e){N.debug("Call ".concat(this.callId," replacedBy() running (newCallId=").concat(e.callId,")")),this.state===ft.WaitLocalMedia?(N.debug("Call ".concat(this.callId," replacedBy() telling new call to wait for local media (newCallId=").concat(e.callId,")")),e.waitForLocalAVStream=!0):[ft.CreateOffer,ft.InviteSent].includes(this.state)&&(e.direction===rf.Outbound?e.queueGotCallFeedsForAnswer([]):(N.debug("Call ".concat(this.callId," replacedBy() handing local stream to new call(newCallId=").concat(e.callId,")")),e.queueGotCallFeedsForAnswer(this.getLocalFeeds().map(n=>n.clone())))),this.successor=e,this.emit(At.Replaced,e,this),this.hangup(Ct.Replaced,!0)}hangup(e,n){if(!this.callHasEnded()&&(N.debug("Call ".concat(this.callId," hangup() ending call (reason=").concat(e,")")),this.terminate(Tr.Local,e,!n),![ft.Fledgling,ft.WaitLocalMedia].includes(this.state))){var r={};(this.opponentVersion&&this.opponentVersion!==0||e!==Ct.UserHangup)&&(r.reason=e),this.sendVoipEvent(ee.CallHangup,r)}}reject(){if(this.state!==ft.Ringing)throw Error("Call must be in 'ringing' state to reject!");if(this.opponentVersion===0){N.info("Call ".concat(this.callId," reject() opponent version is less than 1: sending hangup instead of reject (opponentVersion=").concat(this.opponentVersion,")")),this.hangup(Ct.UserHangup,!0);return}N.debug("Rejecting call: "+this.callId),this.terminate(Tr.Local,Ct.UserHangup,!0),this.sendVoipEvent(ee.CallReject,{})}upgradeCall(e,n){var r=this;return B(function*(){if(!(!e&&!n)&&r.opponentSupportsSDPStreamMetadata())try{N.debug("Call ".concat(r.callId," upgradeCall() upgrading call (audio=").concat(e,", video=").concat(n,")"));var i=e||r.hasLocalUserMediaAudioTrack,s=n||r.hasLocalUserMediaVideoTrack,o=yield r.client.getMediaHandler().getUserMediaStream(i,s,!1);yield r.updateLocalUsermediaStream(o,e,n)}catch(a){N.error("Call ".concat(r.callId," upgradeCall() failed to upgrade the call"),a),r.emit(At.Error,new vu(Ct.NoUserMedia,"Failed to get camera access: ",a),r)}})()}opponentSupportsSDPStreamMetadata(){return!!this.remoteSDPStreamMetadata}isScreensharing(){return!!this.localScreensharingStream}setScreensharingEnabled(e,n){var r=this;return B(function*(){if(e&&r.isScreensharing())return N.warn("Call ".concat(r.callId," setScreensharingEnabled() there is already a screensharing stream - there is nothing to do!")),!0;if(!e&&!r.isScreensharing())return N.warn("Call ".concat(r.callId," setScreensharingEnabled() there already isn't a screensharing stream - there is nothing to do!")),!1;if(!r.opponentSupportsSDPStreamMetadata())return r.setScreensharingEnabledWithoutMetadataSupport(e,n);if(N.debug("Call ".concat(r.callId," setScreensharingEnabled() running (enabled=").concat(e,")")),e)try{var i=yield r.client.getMediaHandler().getScreensharingStream(n);return i?(r.pushNewLocalFeed(i,On.Screenshare),!0):!1}catch(c){return N.error("Call ".concat(r.callId," setScreensharingEnabled() failed to get screen-sharing stream:"),c),!1}else{var s=r.transceivers.get(fc(On.Screenshare,"audio")),o=r.transceivers.get(fc(On.Screenshare,"video"));for(var a of[s,o])a&&a.sender&&r.peerConn.removeTrack(a.sender);return r.client.getMediaHandler().stopScreensharingStream(r.localScreensharingStream),r.deleteFeedByStream(r.localScreensharingStream),!1}})()}setScreensharingEnabledWithoutMetadataSupport(e,n){var r=this;return B(function*(){if(N.debug("Call ".concat(r.callId," setScreensharingEnabledWithoutMetadataSupport() running (enabled=").concat(e,")")),e)try{var i,s=yield r.client.getMediaHandler().getScreensharingStream(n);if(!s)return!1;var o=s.getTracks().find(m=>m.kind==="video"),a=(i=r.transceivers.get(fc(On.Usermedia,"video")))===null||i===void 0?void 0:i.sender;return a?.replaceTrack(o??null),r.pushNewLocalFeed(s,On.Screenshare,!1),!0}catch(m){return N.error("Call ".concat(r.callId," setScreensharingEnabledWithoutMetadataSupport() failed to get screen-sharing stream:"),m),!1}else{var c,l,d=(c=r.localUsermediaStream)===null||c===void 0?void 0:c.getTracks().find(m=>m.kind==="video"),h=(l=r.transceivers.get(fc(On.Usermedia,"video")))===null||l===void 0?void 0:l.sender;return h?.replaceTrack(d??null),r.client.getMediaHandler().stopScreensharingStream(r.localScreensharingStream),r.deleteFeedByStream(r.localScreensharingStream),!1}})()}updateLocalUsermediaStream(e){var n=arguments,r=this;return B(function*(){var i=n.length>1&&n[1]!==void 0?n[1]:!1,s=n.length>2&&n[2]!==void 0?n[2]:!1,o=r.localUsermediaFeed,a=i||!o.isAudioMuted()&&!r.remoteOnHold,c=s||!o.isVideoMuted()&&!r.remoteOnHold;N.log("Call ".concat(r.callId," updateLocalUsermediaStream() running (streamId=").concat(e.id,", audio=").concat(a,", video=").concat(c,")")),Zr(e.getAudioTracks(),a),Zr(e.getVideoTracks(),c);for(var l of r.localUsermediaStream.getTracks())r.localUsermediaStream.removeTrack(l),l.stop();for(var d of e.getTracks())r.localUsermediaStream.addTrack(d);var h=function*(){var y=fc(On.Usermedia,m.kind),v=r.transceivers.get(y),E=v?.sender,w=!1;if(E)try{N.info("Call ".concat(r.callId," updateLocalUsermediaStream() replacing track (id=").concat(m.id,", kind=").concat(m.kind,", streamId=").concat(e.id,", streamPurpose=").concat(o.purpose,")")),yield E.replaceTrack(m),v.direction=v.direction==="inactive"?"sendonly":"sendrecv",w=!0}catch(C){N.warn("Call ".concat(r.callId," updateLocalUsermediaStream() replaceTrack failed: adding new transceiver instead"),C)}if(!w){N.info("Call ".concat(r.callId," updateLocalUsermediaStream() adding track to peer connection (id=").concat(m.id,", kind=").concat(m.kind,", streamId=").concat(e.id,", streamPurpose=").concat(o.purpose,")"));var R=r.peerConn.addTrack(m,r.localUsermediaStream),x=r.peerConn.getTransceivers().find(C=>C.sender===R);x?r.transceivers.set(y,x):N.warn("Call ".concat(r.callId," updateLocalUsermediaStream() couldn't find matching transceiver for newly added track!"))}};for(var m of e.getTracks())yield*h()})()}setLocalVideoMuted(e){var n=this;return B(function*(){var r;if(N.log("Call ".concat(n.callId," setLocalVideoMuted() running ").concat(e)),!e&&n.stopVideoTrackTimer!==void 0&&(clearTimeout(n.stopVideoTrackTimer),n.stopVideoTrackTimer=void 0),!(yield n.client.getMediaHandler().hasVideoDevice()))return n.isLocalVideoMuted();if(!n.hasUserMediaVideoSender&&!e){var i;return(i=n.localUsermediaFeed)===null||i===void 0||i.setAudioVideoMuted(null,e),yield n.upgradeCall(!1,!0),n.isLocalVideoMuted()}if(!e&&n.localUsermediaStream.getVideoTracks().length===0){var s=yield n.client.getMediaHandler().getUserMediaStream(!0,!0);yield n.updateLocalUsermediaStream(s)}return(r=n.localUsermediaFeed)===null||r===void 0||r.setAudioVideoMuted(null,e),n.updateMuteStatus(),yield n.sendMetadataUpdate(),e&&(n.stopVideoTrackTimer=setTimeout(()=>{for(var o of n.localUsermediaStream.getVideoTracks())o.stop(),n.localUsermediaStream.removeTrack(o)},120)),n.isLocalVideoMuted()})()}isLocalVideoMuted(){var e,n;return(e=(n=this.localUsermediaFeed)===null||n===void 0?void 0:n.isVideoMuted())!==null&&e!==void 0?e:!1}setMicrophoneMuted(e){var n=this;return B(function*(){var r;return N.log("Call ".concat(n.callId," setMicrophoneMuted() running ").concat(e)),(yield n.client.getMediaHandler().hasAudioDevice())?!e&&(!n.hasUserMediaAudioSender||!n.hasLocalUserMediaAudioTrack)?(yield n.upgradeCall(!0,!1),n.isMicrophoneMuted()):((r=n.localUsermediaFeed)===null||r===void 0||r.setAudioVideoMuted(e,null),n.updateMuteStatus(),yield n.sendMetadataUpdate(),n.isMicrophoneMuted()):n.isMicrophoneMuted()})()}isMicrophoneMuted(){var e,n;return(e=(n=this.localUsermediaFeed)===null||n===void 0?void 0:n.isAudioMuted())!==null&&e!==void 0?e:!1}isRemoteOnHold(){return this.remoteOnHold}setRemoteOnHold(e){if(this.isRemoteOnHold()!==e){this.remoteOnHold=e;for(var n of this.peerConn.getTransceivers())n.direction=e?"sendonly":"sendrecv";this.updateMuteStatus(),this.sendMetadataUpdate(),this.emit(At.RemoteHoldUnhold,this.remoteOnHold,this)}}isLocalOnHold(){if(this.state!==ft.Connected)return!1;var e=!0;for(var n of this.peerConn.getTransceivers()){var r=["inactive","recvonly"].includes(n.currentDirection);r||(e=!1)}return e}sendDtmfDigit(e){for(var n of this.peerConn.getSenders()){var r;if(((r=n.track)===null||r===void 0?void 0:r.kind)==="audio"&&n.dtmf){n.dtmf.insertDTMF(e);return}}throw new Error("Unable to find a track to send DTMF on")}updateMuteStatus(){var e=this.isMicrophoneMuted()||this.remoteOnHold,n=this.isLocalVideoMuted()||this.remoteOnHold;N.log("Call ".concat(this.callId," updateMuteStatus stream ").concat(this.localUsermediaStream.id," micShouldBeMuted ").concat(e," vidShouldBeMuted ").concat(n)),Zr(this.localUsermediaStream.getAudioTracks(),!e),Zr(this.localUsermediaStream.getVideoTracks(),!n)}sendMetadataUpdate(){var e=this;return B(function*(){yield e.sendVoipEvent(ee.CallSDPStreamMetadataChangedPrefix,{[Wd]:e.getLocalSDPStreamMetadata()})})()}gotCallFeedsForInvite(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(this.successor){this.successor.queueGotCallFeedsForAnswer(e);return}if(this.callHasEnded()){this.stopAllMedia();return}for(var r of e)this.pushLocalFeed(r);n&&this.peerConn.addTransceiver("video",{direction:"recvonly"}),this.state=ft.CreateOffer,N.debug("Call ".concat(this.callId," gotUserMediaForInvite() run"))}sendAnswer(){var e=this;return B(function*(){var n={answer:{sdp:e.peerConn.localDescription.sdp,type:e.peerConn.localDescription.type},[Wd]:e.getLocalSDPStreamMetadata(!0)};n.capabilities={"m.call.transferee":e.client.supportsCallTransfer,"m.call.dtmf":!1};var r=e.discardDuplicateCandidates();N.info("Call ".concat(e.callId," sendAnswer() discarding ").concat(r," candidates that will be sent in answer"));try{yield e.sendVoipEvent(ee.CallAnswer,n),e.inviteOrAnswerSent=!0}catch(o){e.state=ft.Ringing,o instanceof In&&o.event&&e.client.cancelPendingEvent(o.event);var i=Ct.SendAnswer,s="Failed to send answer";throw o.name=="UnknownDeviceError"&&(i=Ct.UnknownDevices,s="Unknown devices present in the room"),e.emit(At.Error,new vu(i,s,o),e),o}e.sendCandidateQueue()})()}queueGotCallFeedsForAnswer(e){this.responsePromiseChain?this.responsePromiseChain=this.responsePromiseChain.then(()=>this.gotCallFeedsForAnswer(e)):this.responsePromiseChain=this.gotCallFeedsForAnswer(e)}mungeSdp(e,n){var r=EA.parse(e.sdp);r.media.forEach(i=>{var s=new Map,o=new Map;for(var a of i.rtp)s.set(a.payload,a.codec),o.set(a.codec,a.payload);for(var c of n)if(c.mediaType===i.type){if(!o.has(c.codec)){N.info("Call ".concat(this.callId," mungeSdp() ignoring SDP modifications for ").concat(c.codec," as it's not present."));continue}var l=[];c.enableDtx!==void 0&&l.push("usedtx=".concat(c.enableDtx?"1":"0")),c.maxAverageBitrate!==void 0&&l.push("maxaveragebitrate=".concat(c.maxAverageBitrate));var d=!1;for(var h of i.fmtp)s.get(h.payload)===c.codec&&(d=!0,h.config+=";"+l.join(";"));d||i.fmtp.push({payload:o.get(c.codec),config:l.join(";")})}}),e.sdp=EA.write(r)}createOffer(){var e=this;return B(function*(){var n=yield e.peerConn.createOffer();return e.mungeSdp(n,fB(e.isPtt)),n})()}createAnswer(){var e=this;return B(function*(){var n=yield e.peerConn.createAnswer();return e.mungeSdp(n,fB(e.isPtt)),n})()}gotCallFeedsForAnswer(e){var n=this;return B(function*(){if(!n.callHasEnded()){n.waitForLocalAVStream=!1;for(var r of e)n.pushLocalFeed(r);n.state=ft.CreateAnswer;var i;try{n.getRidOfRTXCodecs(),i=yield n.createAnswer()}catch(s){N.debug("Call ".concat(n.callId," gotCallFeedsForAnswer() failed to create answer: "),s),n.terminate(Tr.Local,Ct.CreateAnswer,!0);return}try{if(yield n.peerConn.setLocalDescription(i),n.callHasEnded()||(n.state=ft.Connecting,yield new Promise(s=>{setTimeout(s,200)}),n.callHasEnded()))return;n.sendAnswer()}catch(s){N.debug("Call ".concat(n.callId," gotCallFeedsForAnswer() error setting local description!"),s),n.terminate(Tr.Local,Ct.SetLocalDescription,!0);return}}})()}onRemoteIceCandidatesReceived(e){var n=this;return B(function*(){if(!n.callHasEnded()){var r=e.getContent(),i=r.candidates;if(!i){N.info("Call ".concat(n.callId," onRemoteIceCandidatesReceived() ignoring candidates event with no candidates!"));return}var s=r.version===0?null:r.party_id||null;if(n.opponentPartyId===void 0){if(s){N.info("Call ".concat(n.callId," onRemoteIceCandidatesReceived() buffering ").concat(i.length," candidates until we pick an opponent"));var o=n.remoteCandidateBuffer.get(s)||[];o.push(...i),n.remoteCandidateBuffer.set(s,o)}return}if(!n.partyIdMatches(r)){N.info("Call ".concat(n.callId," onRemoteIceCandidatesReceived() ignoring candidates from party ID ").concat(r.party_id,": we have chosen party ID ").concat(n.opponentPartyId));return}yield n.addIceCandidates(i)}})()}onAnswerReceived(e){var n=this;return B(function*(){var r=e.getContent();if(N.debug("Call ".concat(n.callId," onAnswerReceived() running (hangupParty=").concat(r.party_id,")")),n.callHasEnded()){N.debug("Call ".concat(n.callId," onAnswerReceived() ignoring answer because call has ended"));return}if(n.opponentPartyId!==void 0){N.info("Call ".concat(n.callId," onAnswerReceived() ignoring answer from party ID ").concat(r.party_id,": we already have an answer/reject from ").concat(n.opponentPartyId));return}n.chooseOpponent(e),yield n.addBufferedIceCandidates(),n.state=ft.Connecting;var i=r[Wd];i?n.updateRemoteSDPStreamMetadata(i):N.warn("Call ".concat(n.callId," onAnswerReceived() did not get any SDPStreamMetadata! Can not send/receive multiple streams"));try{n.isSettingRemoteAnswerPending=!0,yield n.peerConn.setRemoteDescription(r.answer),n.isSettingRemoteAnswerPending=!1,N.debug("Call ".concat(n.callId," onAnswerReceived() set remote description: ").concat(r.answer.type))}catch(s){n.isSettingRemoteAnswerPending=!1,N.debug("Call ".concat(n.callId," onAnswerReceived() failed to set remote description"),s),n.terminate(Tr.Local,Ct.SetRemoteDescription,!1);return}if(n.opponentPartyId!==null)try{yield n.sendVoipEvent(ee.CallSelectAnswer,{selected_party_id:n.opponentPartyId})}catch(s){N.warn("Call ".concat(n.callId," onAnswerReceived() failed to send select_answer event"),s)}})()}onSelectAnswerReceived(e){var n=this;return B(function*(){if(n.direction!==rf.Inbound){N.warn("Call ".concat(n.callId," onSelectAnswerReceived() got select_answer for an outbound call: ignoring"));return}var r=e.getContent().selected_party_id;if(r==null){N.warn("Call ".concat(n.callId," onSelectAnswerReceived() got nonsensical select_answer with null/undefined selected_party_id: ignoring"));return}r!==n.ourPartyId&&(N.info("Call ".concat(n.callId," onSelectAnswerReceived() got select_answer for party ID ").concat(r,": we are party ID ").concat(n.ourPartyId,".")),yield n.terminate(Tr.Remote,Ct.AnsweredElsewhere,!0))})()}onNegotiateReceived(e){var n=this;return B(function*(){var r=e.getContent(),i=r.description;if(!i||!i.sdp||!i.type){N.info("Call ".concat(n.callId," onNegotiateReceived() ignoring invalid m.call.negotiate event"));return}var s=n.direction===rf.Inbound,o=!n.makingOffer&&(n.peerConn.signalingState==="stable"||n.isSettingRemoteAnswerPending),a=i.type==="offer"&&!o;if(n.ignoreOffer=!s&&a,n.ignoreOffer){N.info("Call ".concat(n.callId," onNegotiateReceived() ignoring colliding negotiate event because we're impolite"));return}var c=n.isLocalOnHold(),l=r[Wd];l?n.updateRemoteSDPStreamMetadata(l):N.warn("Call ".concat(n.callId," onNegotiateReceived() received negotiation event without SDPStreamMetadata!"));try{if(n.isSettingRemoteAnswerPending=i.type=="answer",yield n.peerConn.setRemoteDescription(i),n.isSettingRemoteAnswerPending=!1,N.debug("Call ".concat(n.callId," onNegotiateReceived() set remote description: ").concat(i.type)),i.type==="offer"){var d,h;try{n.getRidOfRTXCodecs(),h=yield n.createAnswer()}catch(g){N.debug("Call ".concat(n.callId," onNegotiateReceived() failed to create answer: "),g),n.terminate(Tr.Local,Ct.CreateAnswer,!0);return}yield n.peerConn.setLocalDescription(h),N.debug("Call ".concat(n.callId," onNegotiateReceived() create an answer")),n.sendVoipEvent(ee.CallNegotiate,{lifetime:tx,description:(d=n.peerConn.localDescription)===null||d===void 0?void 0:d.toJSON(),[Wd]:n.getLocalSDPStreamMetadata(!0)})}}catch(g){n.isSettingRemoteAnswerPending=!1,N.warn("Call ".concat(n.callId," onNegotiateReceived() failed to complete negotiation"),g)}var m=n.isLocalOnHold();c!==m&&(n.emit(At.LocalHoldUnhold,m,n),n.emit(At.HoldUnhold,m))})()}updateRemoteSDPStreamMetadata(e){this.remoteSDPStreamMetadata=WX(this.remoteSDPStreamMetadata||{},e,!0);for(var n of this.getRemoteFeeds()){var r,i=n.stream.id,s=this.remoteSDPStreamMetadata[i];n.setAudioVideoMuted(s?.audio_muted,s?.video_muted),n.purpose=(r=this.remoteSDPStreamMetadata[i])===null||r===void 0?void 0:r.purpose}}onSDPStreamMetadataChangedReceived(e){var n=e.getContent(),r=n[Wd];this.updateRemoteSDPStreamMetadata(r)}onAssertedIdentityReceived(e){var n=this;return B(function*(){var r=e.getContent();r.asserted_identity&&(n.remoteAssertedIdentity={id:r.asserted_identity.id,displayName:r.asserted_identity.display_name},n.emit(At.AssertedIdentityChanged,n))})()}callHasEnded(){return this.state===ft.Ended}queueGotLocalOffer(){this.responsePromiseChain?this.responsePromiseChain=this.responsePromiseChain.then(()=>this.wrappedGotLocalOffer()):this.responsePromiseChain=this.wrappedGotLocalOffer()}wrappedGotLocalOffer(){var e=this;return B(function*(){e.makingOffer=!0;try{yield e.gotLocalOffer()}catch(n){e.getLocalOfferFailed(n);return}finally{e.makingOffer=!1}})()}gotLocalOffer(){var e=this;return B(function*(){if(N.debug("Call ".concat(e.callId," gotLocalOffer() running")),e.callHasEnded()){N.debug("Call ".concat(e.callId,' gotLocalOffer() ignoring newly created offer because the call has ended"'));return}var n;try{e.getRidOfRTXCodecs(),n=yield e.createOffer()}catch(d){N.debug("Call ".concat(e.callId," gotLocalOffer() failed to create offer: "),d),e.terminate(Tr.Local,Ct.CreateOffer,!0);return}try{yield e.peerConn.setLocalDescription(n)}catch(d){N.debug("Call ".concat(e.callId," gotLocalOffer() error setting local description!"),d),e.terminate(Tr.Local,Ct.SetLocalDescription,!0);return}if(e.peerConn.iceGatheringState==="gathering"&&(yield new Promise(d=>{setTimeout(d,200)})),!e.callHasEnded()){var r=e.state===ft.CreateOffer?ee.CallInvite:ee.CallNegotiate,i={lifetime:tx};if(r===ee.CallInvite&&e.invitee&&(i.invitee=e.invitee),e.state===ft.CreateOffer){var s;i.offer=(s=e.peerConn.localDescription)===null||s===void 0?void 0:s.toJSON()}else{var o;i.description=(o=e.peerConn.localDescription)===null||o===void 0?void 0:o.toJSON()}i.capabilities={"m.call.transferee":e.client.supportsCallTransfer,"m.call.dtmf":!1},i[Wd]=e.getLocalSDPStreamMetadata(!0);var a=e.discardDuplicateCandidates();N.info("Call ".concat(e.callId," gotLocalOffer() discarding ").concat(a," candidates that will be sent in offer"));try{yield e.sendVoipEvent(r,i)}catch(d){N.error("Call ".concat(e.callId," gotLocalOffer() failed to send invite"),d),d instanceof In&&d.event&&e.client.cancelPendingEvent(d.event);var c=Ct.SignallingFailed,l="Signalling failed";e.state===ft.CreateOffer&&(c=Ct.SendInvite,l="Failed to send invite"),d.name=="UnknownDeviceError"&&(c=Ct.UnknownDevices,l="Unknown devices present in the room"),e.emit(At.Error,new vu(c,l,d),e),e.terminate(Tr.Local,c,!1);return}e.sendCandidateQueue(),e.state===ft.CreateOffer&&(e.inviteOrAnswerSent=!0,e.state=ft.InviteSent,e.inviteTimeout=setTimeout(()=>{e.inviteTimeout=void 0,e.state===ft.InviteSent&&e.hangup(Ct.InviteTimeout,!1)},tx))}})()}getRidOfRTXCodecs(){if(!(!RTCRtpReceiver.getCapabilities||!RTCRtpSender.getCapabilities)){var e=this.transceivers.get(fc(On.Screenshare,"video"));if(!(!e||!e.setCodecPreferences)){var n=RTCRtpReceiver.getCapabilities("video").codecs,r=RTCRtpSender.getCapabilities("video").codecs,i=[];for(var s of[...n,...r])if(s.mimeType!=="video/rtx"){i.push(s);try{e.setCodecPreferences(i)}catch(o){N.info("Working around buggy WebRTC impl: claimed to support codec but threw when setting codec preferences",s,o),i.pop()}}}}}sendVoipEvent(e,n){var r=this;return B(function*(){var i=ew(ew({},n),{},{version:_0e,call_id:r.callId,party_id:r.ourPartyId,conf_id:r.groupCallId});if(r.opponentDeviceId){var s,o=r.toDeviceSeq++,a=ew(ew({},i),{},{device_id:r.client.deviceId,sender_session_id:r.client.getSessionId(),dest_session_id:r.opponentSessionId,seq:o,[yT]:GJ()});r.emit(At.SendVoipEvent,{type:"toDevice",eventType:e,userId:r.invitee||((s=r.getOpponentMember())===null||s===void 0?void 0:s.userId),opponentDeviceId:r.opponentDeviceId,content:a},r);var c=r.invitee||r.getOpponentMember().userId;if(r.client.getUseE2eForGroupCall()){if(!r.hasOpponentDeviceInfo){N.warn("Call ".concat(r.callId," sendVoipEvent() failed: we do not have opponentDeviceInfo"));return}throw new Error("Unimplemented")}else yield r.client.sendToDevice(e,new Map([[c,new Map([[r.opponentDeviceId,a]])]]))}else{var l;r.emit(At.SendVoipEvent,{type:"sendEvent",eventType:e,roomId:r.roomId,content:i,userId:r.invitee||((l=r.getOpponentMember())===null||l===void 0?void 0:l.userId)},r),yield r.client.sendEvent(r.roomId,e,i)}})()}queueCandidate(e){if(e?this.candidateSendQueue.push(e):this.candidatesEnded=!0,!(this.state===ft.Ringing||!this.inviteOrAnswerSent)){var n=this.direction===rf.Inbound?500:2e3;this.candidateSendTries===0&&setTimeout(()=>{this.sendCandidateQueue()},n)}}discardDuplicateCandidates(){for(var e=0,n=[],r=0;r<this.candidateSendQueue.length;r++){var i=this.candidateSendQueue[r];i.candidate===""?n.push(i):e++}return this.candidateSendQueue=n,e}transfer(e){var n=this;return B(function*(){var r=yield n.client.getProfileInfo(e),i=ep(),s={replacement_id:ep(),target_user:{id:e,display_name:r.displayname,avatar_url:r.avatar_url},create_call:i};yield n.sendVoipEvent(ee.CallReplaces,s),yield n.terminate(Tr.Local,Ct.Transferred,!0)})()}transferToCall(e){var n=this;return B(function*(){var r,i,s=(r=e.getOpponentMember())===null||r===void 0?void 0:r.userId,o=s?yield n.client.getProfileInfo(s):void 0,a=(i=n.getOpponentMember())===null||i===void 0?void 0:i.userId,c=a?yield n.client.getProfileInfo(a):void 0,l=ep(),d={replacement_id:ep(),target_user:{id:a,display_name:c?.displayname,avatar_url:c?.avatar_url},await_call:l};yield e.sendVoipEvent(ee.CallReplaces,d);var h={replacement_id:ep(),target_user:{id:s,display_name:o?.displayname,avatar_url:o?.avatar_url},create_call:l};yield n.sendVoipEvent(ee.CallReplaces,h),yield n.terminate(Tr.Local,Ct.Transferred,!0),yield e.terminate(Tr.Local,Ct.Transferred,!0)})()}terminate(e,n,r){var i=this;return B(function*(){var s;if(!i.callHasEnded()){i.hangupParty=e,i.hangupReason=n,i.state=ft.Ended,i.inviteTimeout&&(clearTimeout(i.inviteTimeout),i.inviteTimeout=void 0),i.iceDisconnectedTimeout!==void 0&&(clearTimeout(i.iceDisconnectedTimeout),i.iceDisconnectedTimeout=void 0),i.callLengthInterval&&(clearInterval(i.callLengthInterval),i.callLengthInterval=void 0),i.stopVideoTrackTimer!==void 0&&(clearTimeout(i.stopVideoTrackTimer),i.stopVideoTrackTimer=void 0);for(var[o,a]of i.removeTrackListeners)o.removeEventListener("removetrack",a);i.removeTrackListeners.clear(),i.callStatsAtEnd=yield i.collectCallStats(),i.stopAllMedia(),i.deleteAllFeeds(),i.peerConn&&i.peerConn.signalingState!=="closed"&&i.peerConn.close(),(s=i.stats)===null||s===void 0||s.removeStatsReportGatherer(i.callId),r&&i.emit(At.Hangup,i),i.client.callEventHandler.calls.delete(i.callId)}})()}stopAllMedia(){N.debug("Call ".concat(this.callId," stopAllMedia() running"));for(var e of this.feeds)if(e.isLocal()&&e.purpose===On.Usermedia)this.client.getMediaHandler().stopUserMediaStream(e.stream);else if(e.isLocal()&&e.purpose===On.Screenshare)this.client.getMediaHandler().stopScreensharingStream(e.stream);else if(!e.isLocal()){N.debug("Call ".concat(this.callId," stopAllMedia() stopping stream (streamId=").concat(e.stream.id,")"));for(var n of e.stream.getTracks())n.stop()}}checkForErrorListener(){if(this.listeners(QX.Error).length===0)throw new Error("You MUST attach an error listener using call.on('error', function() {})")}sendCandidateQueue(){var e=this;return B(function*(){if(!(e.candidateSendQueue.length===0||e.callHasEnded())){var n=e.candidateSendQueue;e.candidateSendQueue=[],++e.candidateSendTries;var r={candidates:n.map(a=>a.toJSON())};e.candidatesEnded&&r.candidates.push({candidate:""}),N.debug("Call ".concat(e.callId," sendCandidateQueue() attempting to send ").concat(n.length," candidates"));try{yield e.sendVoipEvent(ee.CallCandidates,r),e.candidateSendTries=0,e.sendCandidateQueue()}catch(a){if(a instanceof In&&a.event&&e.client.cancelPendingEvent(a.event),e.candidateSendQueue.push(...n),e.candidateSendTries>5){N.debug("Call ".concat(e.callId," sendCandidateQueue() failed to send candidates on attempt ").concat(e.candidateSendTries,". Giving up on this call."),a);var i=Ct.SignallingFailed,s="Signalling failed";e.emit(At.Error,new vu(i,s,a),e),e.hangup(i,!1);return}var o=500*Math.pow(2,e.candidateSendTries);++e.candidateSendTries,N.debug("Call ".concat(e.callId," sendCandidateQueue() failed to send candidates. Retrying in ").concat(o,"ms"),a),setTimeout(()=>{e.sendCandidateQueue()},o)}}})()}placeCall(e,n){var r=this;return B(function*(){if(!e)throw new Error("You CANNOT start a call without audio");r.state=ft.WaitLocalMedia;var i;try{var s,o=yield r.client.getMediaHandler().getUserMediaStream(e,n);Zr(o.getAudioTracks(),!0),Zr(o.getVideoTracks(),!0),i=new Au({client:r.client,roomId:r.roomId,userId:r.client.getUserId(),deviceId:(s=r.client.getDeviceId())!==null&&s!==void 0?s:void 0,stream:o,purpose:On.Usermedia,audioMuted:!1,videoMuted:!1})}catch(a){r.getUserMediaFailed(a);return}try{yield r.placeCallWithCallFeeds([i])}catch(a){r.placeCallFailed(a);return}})()}placeCallWithCallFeeds(e){var n=arguments,r=this;return B(function*(){var i=n.length>1&&n[1]!==void 0?n[1]:!1;r.checkForErrorListener(),r.direction=rf.Outbound,yield r.initOpponentCrypto(),r.client.callEventHandler.calls.set(r.callId,r);var s=yield r.client.checkTurnServers();s||N.warn("Call ".concat(r.callId," placeCallWithCallFeeds() failed to get TURN credentials! Proceeding with call anyway...")),r.peerConn=r.createPeerConnection(),r.emit(At.PeerConnectionCreated,r.peerConn,r),r.gotCallFeedsForInvite(e,i)})()}createPeerConnection(){var e,n=new window.RTCPeerConnection({iceTransportPolicy:this.forceTURN?"relay":void 0,iceServers:this.turnServers.length?this.turnServers:void 0,iceCandidatePoolSize:this.client.iceCandidatePoolSize,bundlePolicy:"max-bundle"});n.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChanged),n.addEventListener("signalingstatechange",this.onSignallingStateChanged),n.addEventListener("icecandidate",this.gotLocalIceCandidate),n.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),n.addEventListener("track",this.onTrack),n.addEventListener("negotiationneeded",this.onNegotiationNeeded),n.addEventListener("datachannel",this.onDataChannel);var r=this.getOpponentMember(),i=r?r.userId:"unknown";return(e=this.stats)===null||e===void 0||e.addStatsReportGatherer(this.callId,i,n),n}partyIdMatches(e){var n=e.version===0?null:e.party_id||null;return n===this.opponentPartyId}chooseOpponent(e){var n,r=e.getContent();if(N.debug("Call ".concat(this.callId," chooseOpponent() running (partyId=").concat(r.party_id,")")),this.opponentVersion=r.version,this.opponentVersion===0?this.opponentPartyId=null:this.opponentPartyId=r.party_id||null,this.opponentCaps=r.capabilities||{},this.opponentMember=(n=this.client.getRoom(this.roomId).getMember(e.getSender()))!==null&&n!==void 0?n:void 0,this.opponentMember){var i;(i=this.stats)===null||i===void 0||i.updateOpponentMember(this.callId,this.opponentMember.userId)}}addBufferedIceCandidates(){var e=this;return B(function*(){var n=e.remoteCandidateBuffer.get(e.opponentPartyId);n&&(N.info("Call ".concat(e.callId," addBufferedIceCandidates() adding ").concat(n.length," buffered candidates for opponent ").concat(e.opponentPartyId)),yield e.addIceCandidates(n)),e.remoteCandidateBuffer.clear()})()}addIceCandidates(e){var n=this;return B(function*(){for(var r of e){(r.sdpMid===null||r.sdpMid===void 0)&&(r.sdpMLineIndex===null||r.sdpMLineIndex===void 0)?N.debug("Call ".concat(n.callId," addIceCandidates() got remote ICE end-of-candidates")):N.debug("Call ".concat(n.callId," addIceCandidates() got remote ICE candidate (sdpMid=").concat(r.sdpMid,", candidate=").concat(r.candidate,")"));try{yield n.peerConn.addIceCandidate(r)}catch(i){n.ignoreOffer?N.debug("Call ".concat(n.callId," addIceCandidates() failed to add remote ICE candidate because ignoring offer"),i):N.info("Call ".concat(n.callId," addIceCandidates() failed to add remote ICE candidate"),i)}}})()}get hasPeerConnection(){return!!this.peerConn}initStats(e){this.stats=e,this.stats.start()}}function Zr(t,e){for(var n of t)n.enabled=e}function xA(){if(typeof window>"u"||typeof document>"u")return!1;try{var t,e,n,r=!!((t=(e=(n=window.RTCPeerConnection)!==null&&n!==void 0?n:window.RTCSessionDescription)!==null&&e!==void 0?e:window.RTCIceCandidate)!==null&&t!==void 0?t:navigator.mediaDevices);if(!r)return N.error("WebRTC is not supported in this browser / environment"),!1}catch(i){return N.error("Exception thrown when trying to access WebRTC",i),!1}return!0}function Ab(t,e,n){if(!xA())return null;var r=n?n.forceTURN:!1,i={client:t,roomId:e,invitee:n?.invitee,turnServers:t.getTurnServers(),forceTURN:t.forceTURN||r,opponentDeviceId:n?.opponentDeviceId,opponentSessionId:n?.opponentSessionId,groupCallId:n?.groupCallId},s=new T0e(i);return t.reEmitter.reEmit(s,Object.values(At)),s}var If=(function(t){return t.DontNotify="dont_notify",t.Notify="notify",t.Coalesce="coalesce",t})({}),cP=(function(t){return t.Highlight="highlight",t.Sound="sound",t})({}),R0e=(function(t){return t.ExactEquals="==",t.LessThan="<",t.GreaterThan=">",t.GreaterThanOrEqual=">=",t.LessThanOrEqual="<=",t})({}),k0e="2";function I0e(t){return t==="==2"||t==="2"}var ei=(function(t){return t.EventMatch="event_match",t.EventPropertyIs="event_property_is",t.EventPropertyContains="event_property_contains",t.ContainsDisplayName="contains_display_name",t.RoomMemberCount="room_member_count",t.SenderNotificationPermission="sender_notification_permission",t.CallStarted="call_started",t.CallStartedPrefix="org.matrix.msc3914.call_started",t})({}),Pi=(function(t){return t.Override="override",t.ContentSpecific="content",t.RoomSpecific="room",t.SenderSpecific="sender",t.Underride="underride",t})({}),Oi=(function(t){return t.Master=".m.rule.master",t.IsUserMention=".m.rule.is_user_mention",t.IsRoomMention=".m.rule.is_room_mention",t.ContainsDisplayName=".m.rule.contains_display_name",t.ContainsUserName=".m.rule.contains_user_name",t.AtRoomNotification=".m.rule.roomnotif",t.DM=".m.rule.room_one_to_one",t.EncryptedDM=".m.rule.encrypted_room_one_to_one",t.Message=".m.rule.message",t.EncryptedMessage=".m.rule.encrypted",t.InviteToSelf=".m.rule.invite_for_me",t.MemberEvent=".m.rule.member_event",t.IncomingCall=".m.rule.call",t.SuppressNotices=".m.rule.suppress_notices",t.Tombstone=".m.rule.tombstone",t.PollStart=".m.rule.poll_start",t.PollStartUnstable=".org.matrix.msc3930.rule.poll_start",t.PollEnd=".m.rule.poll_end",t.PollEndUnstable=".org.matrix.msc3930.rule.poll_end",t.PollStartOneToOne=".m.rule.poll_start_one_to_one",t.PollStartOneToOneUnstable=".org.matrix.msc3930.rule.poll_start_one_to_one",t.PollEndOneToOne=".m.rule.poll_end_one_to_one",t.PollEndOneToOneUnstable=".org.matrix.msc3930.rule.poll_end_one_to_one",t})({});function hB(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function pB(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?hB(Object(n),!0).forEach(function(r){M(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):hB(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var mB=[Pi.Override,Pi.ContentSpecific,Pi.RoomSpecific,Pi.SenderSpecific,Pi.Underride],x0e={".m.rule.is_room_mention":{rule_id:".m.rule.is_room_mention",default:!0,enabled:!0,conditions:[{kind:ei.EventPropertyIs,key:"content.m\\.mentions.room",value:!0},{kind:ei.SenderNotificationPermission,key:"room"}],actions:[If.Notify,{set_tweak:cP.Highlight}]},".m.rule.reaction":{rule_id:".m.rule.reaction",default:!0,enabled:!0,conditions:[{kind:ei.EventMatch,key:"type",pattern:"m.reaction"}],actions:[If.DontNotify]},".org.matrix.msc3786.rule.room.server_acl":{rule_id:".org.matrix.msc3786.rule.room.server_acl",default:!0,enabled:!0,conditions:[{kind:ei.EventMatch,key:"type",pattern:ee.RoomServerAcl},{kind:ei.EventMatch,key:"state_key",pattern:""}],actions:[]}},lP=Symbol("UserDefinedRules"),A0e=[Oi.Master,lP,Oi.SuppressNotices,Oi.InviteToSelf,Oi.MemberEvent,Oi.IsUserMention,Oi.ContainsDisplayName,Oi.IsRoomMention,Oi.AtRoomNotification,Oi.Tombstone,".m.rule.reaction",".m.rule.room.server_acl",".org.matrix.msc3786.rule.room.server_acl",".m.rule.suppress_edits"],L0e={".org.matrix.msc3914.rule.room.call":{rule_id:".org.matrix.msc3914.rule.room.call",default:!0,enabled:!0,conditions:[{kind:ei.EventMatch,key:"type",pattern:"org.matrix.msc3401.call"},{kind:ei.CallStarted}],actions:[If.Notify,{set_tweak:cP.Sound,value:"default"}]}},M0e=[lP,Oi.IncomingCall,".org.matrix.msc3914.rule.room.call",Oi.EncryptedDM,Oi.DM,Oi.Message,Oi.EncryptedMessage];function gB(t,e,n,r,i){var s=n.filter(y=>y.default),o=n.filter(y=>!y.default);function a(y){y===lP?l.push(...o):y in r?(t.warn("Adding default global ".concat(e," push rule ").concat(y)),l.push(r[y])):t.warn("Missing default global ".concat(e," push rule ").concat(y))}var c=0,l=[];for(var d of s){var h=i.indexOf(d.rule_id);if(h===-1){l.push(d);continue}for(;h>c;){var m=i[c];a(m),c+=1}l.push(d),c+=1}for(var g of i.slice(c))a(g);return l}class bc{constructor(e){this.client=e,M(this,"parsedKeys",new Map)}static actionListToActionsObject(e){var n={notify:!1,tweaks:{}};for(var r of e)r===If.Notify?n.notify=!0:typeof r=="object"&&(r.value===void 0&&(r.value=!0),n.tweaks[r.set_tweak]=r.value);return n}static rewriteDefaultRules(e,n){var r=JSON.parse(JSON.stringify(n));return r||(r={}),r.global||(r.global={}),r.global.override||(r.global.override=[]),r.global.underride||(r.global.underride=[]),r.global.override=gB(e,Pi.Override,r.global.override,x0e,A0e),r.global.underride=gB(e,Pi.Underride,r.global.underride,L0e,M0e),r}static getPushRuleGlobRegex(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"i",[i,s]=n?["(?<=^|\\W)","(?=\\W|$)"]:["^","$"],o="".concat(n,"-").concat(r,"-").concat(e);return bc.cachedGlobToRegex[o]||(bc.cachedGlobToRegex[o]=new RegExp(i+"("+GX(e)+")"+s,r)),bc.cachedGlobToRegex[o]}updateCachedPushRuleKeys(e){e||(e={}),e.global||(e.global={}),e.global.override||(e.global.override=[]),e.global.room||(e.global.room=[]),e.global.sender||(e.global.sender=[]),e.global.underride||(e.global.underride=[]);var n=new Set(this.parsedKeys.keys());for(var r of[e.global.override,e.global.room,e.global.sender,e.global.underride])for(var i of r)if(i.conditions)for(var s of i.conditions)s.kind===ei.EventMatch&&(n.delete(s.key),this.parsedKeys.set(s.key,bc.partsForDottedKey(s.key)));n.forEach(o=>this.parsedKeys.delete(o))}matchingRuleFromKindSet(e,n){for(var r of mB){var i=n[r];if(i){for(var s of i)if(s.enabled){var o=this.templateRuleToRaw(r,s);if(o&&this.ruleMatchesEvent(o,e))return pB(pB({},s),{},{kind:r})}}}return null}templateRuleToRaw(e,n){var r={rule_id:n.rule_id,actions:n.actions,conditions:[]};switch(e){case Pi.Underride:case Pi.Override:r.conditions=n.conditions;break;case Pi.RoomSpecific:if(!n.rule_id)return null;r.conditions.push({kind:ei.EventMatch,key:"room_id",value:n.rule_id});break;case Pi.SenderSpecific:if(!n.rule_id)return null;r.conditions.push({kind:ei.EventMatch,key:"user_id",value:n.rule_id});break;case Pi.ContentSpecific:if(!n.pattern)return null;r.conditions.push({kind:ei.EventMatch,key:"content.body",pattern:n.pattern});break}return r}eventFulfillsCondition(e,n){switch(e.kind){case ei.EventMatch:return this.eventFulfillsEventMatchCondition(e,n);case ei.EventPropertyIs:return this.eventFulfillsEventPropertyIsCondition(e,n);case ei.EventPropertyContains:return this.eventFulfillsEventPropertyContains(e,n);case ei.ContainsDisplayName:return this.eventFulfillsDisplayNameCondition(e,n);case ei.RoomMemberCount:return this.eventFulfillsRoomMemberCountCondition(e,n);case ei.SenderNotificationPermission:return this.eventFulfillsSenderNotifPermCondition(e,n);case ei.CallStarted:case ei.CallStartedPrefix:return this.eventFulfillsCallStartedCondition(e,n)}return!1}eventFulfillsSenderNotifPermCondition(e,n){var r=e.key;if(!r)return!1;var i=this.client.getRoom(n.getRoomId());return i!=null&&i.currentState?i.currentState.mayTriggerNotifOfType(r,n.getSender()):!1}eventFulfillsRoomMemberCountCondition(e,n){if(!e.is)return!1;var r=this.client.getRoom(n.getRoomId());if(!r||!r.currentState||!r.currentState.members)return!1;var i=r.currentState.getJoinedMemberCount(),s=e.is.match(/^([=<>]*)(\d*)$/);if(!s)return!1;var o=s[1],a=parseInt(s[2]);if(isNaN(a))return!1;switch(o){case"":case"==":return i==a;case"<":return i<a;case">":return i>a;case"<=":return i<=a;case">=":return i>=a;default:return!1}}eventFulfillsDisplayNameCondition(e,n){var r,i=n.getContent();if(n.isEncrypted()&&n.getClearContent()&&(i=n.getClearContent()),!i||!i.body||typeof i.body!="string")return!1;var s=this.client.getRoom(n.getRoomId()),o=s==null||(r=s.currentState)===null||r===void 0?void 0:r.getMember(this.client.credentials.userId);if(!o)return!1;var a=o.name,c=new RegExp("(^|\\W)"+KX(a)+"(\\W|$)","i");return i.body.search(c)>-1}eventFulfillsEventMatchCondition(e,n){if(!e.key)return!1;var r=this.valueForDottedKey(e.key,n);if(typeof r!="string")return!1;if(e.value)return e.value===r;if(typeof e.pattern!="string")return!1;var i=bc.getPushRuleGlobRegex(e.pattern,e.key==="content.body");return!!r.match(i)}eventFulfillsEventPropertyIsCondition(e,n){return!e.key||e.value===void 0?!1:e.value===this.valueForDottedKey(e.key,n)}eventFulfillsEventPropertyContains(e,n){if(!e.key||e.value===void 0)return!1;var r=this.valueForDottedKey(e.key,n);return Array.isArray(r)?r.includes(e.value):!1}eventFulfillsCallStartedCondition(e,n){return["m.ring","m.prompt"].includes(n.getContent()["m.intent"])&&!("m.terminated"in n.getContent())&&(n.getPrevContent()["m.terminated"]!==n.getContent()["m.terminated"]||Ip(n.getPrevContent(),{}))}static partsForDottedKey(e){var n=[],r="",i=!1;for(var s of e){if(i){s==="\\"||s==="."?r+=s:r+="\\"+s,i=!1;continue}s=="."?(n.push(r),r=""):s=="\\"?i=!0:r+=s}return i&&(r+="\\"),n.push(r),n}valueForDottedKey(e,n){var r=this.parsedKeys.get(e);r===void 0&&(r=bc.partsForDottedKey(e),this.parsedKeys.set(e,r));var i,s=r[0],o=0;for(s==="content"?(i=n.getContent(),++o):s==="type"?(i=n.getType(),++o):i=n.event;o<r.length;++o){if(zX(i))return;var a=r[o];i=i[a]}return i}matchingRuleForEventWithRulesets(e,n){return!n||e.getSender()===this.client.getSafeUserId()?null:this.matchingRuleFromKindSet(e,n.global)}pushActionsForEventAndRulesets(e,n){var r=this.matchingRuleForEventWithRulesets(e,n);if(!r)return{};var i=bc.actionListToActionsObject(r.actions);return i.tweaks.highlight===void 0&&(i.tweaks.highlight=r.kind==Pi.ContentSpecific),{actions:i,rule:r}}ruleMatchesEvent(e,n){var r;return this.client.supportsIntentionalMentions()&&n.getContent()["m.mentions"]!==void 0&&(e.rule_id===Oi.ContainsUserName||e.rule_id===Oi.ContainsDisplayName||e.rule_id===Oi.AtRoomNotification)?!1:!((r=e.conditions)!==null&&r!==void 0&&r.some(i=>!this.eventFulfillsCondition(i,n)))}actionsForEvent(e){var{actions:n}=this.pushActionsForEventAndRulesets(e,this.client.pushRules);return n||{}}actionsAndRuleForEvent(e){return this.pushActionsForEventAndRulesets(e,this.client.pushRules)}getPushRuleById(e){var n,r=this.getPushRuleAndKindById(e);return(n=r?.rule)!==null&&n!==void 0?n:null}getPushRuleAndKindById(e){for(var n of["global"]){var r;if(((r=this.client.pushRules)===null||r===void 0?void 0:r[n])!==void 0){for(var i of mB)if(this.client.pushRules[n][i]!==void 0){for(var s of this.client.pushRules[n][i])if(s.rule_id===e)return{rule:s,kind:i}}}}return null}}M(bc,"cachedGlobToRegex",{});var Lb=["v1.1","v1.2","v1.3","v1.4","v1.5","v1.6","v1.7","v1.8","v1.9"],O0e=Lb[0],P0e=Lb[Lb.length-1],Go=(function(t){return t.SUCCESS="SUCCESS",t.IGNORE="IGNORE",t.PROMPT="PROMPT",t.FAIL_PROMPT="FAIL_PROMPT",t.FAIL_ERROR="FAIL_ERROR",t})({}),ec=(function(t){return t.Invalid="Invalid homeserver discovery response",t.GenericFailure="Failed to get autodiscovery configuration from server",t.InvalidHsBaseUrl="Invalid base_url for m.homeserver",t.InvalidHomeserver="Homeserver URL does not appear to be a valid Matrix homeserver",t.InvalidIsBaseUrl="Invalid base_url for m.identity_server",t.InvalidIdentityServer="Identity server URL does not appear to be a valid identity server",t.InvalidIs="Invalid identity server discovery response",t.MissingWellknown="No .well-known JSON file found",t.InvalidJson="Invalid JSON",t.UnsupportedHomeserverSpecVersion="The homeserver does not meet the version requirements",t})({});class pt{static fromDiscoveryConfig(e){var n=this;return B(function*(){var r,i={"m.homeserver":{state:pt.FAIL_ERROR,error:pt.ERROR_INVALID,base_url:null},"m.identity_server":{state:pt.PROMPT,error:null,base_url:null}};if(!(e!=null&&e["m.homeserver"]))return N.error("No m.homeserver key in config"),i["m.homeserver"].state=pt.FAIL_PROMPT,i["m.homeserver"].error=pt.ERROR_INVALID,Promise.resolve(i);if(!e["m.homeserver"].base_url)return N.error("No m.homeserver base_url in config"),i["m.homeserver"].state=pt.FAIL_PROMPT,i["m.homeserver"].error=pt.ERROR_INVALID_HS_BASE_URL,Promise.resolve(i);var s=n.sanitizeWellKnownUrl(e["m.homeserver"].base_url);if(!s)return N.error("Invalid base_url for m.homeserver"),i["m.homeserver"].error=pt.ERROR_INVALID_HS_BASE_URL,Promise.resolve(i);var o=yield n.fetchWellKnownObject("".concat(s,"/_matrix/client/versions"));if(!o||!Array.isArray((r=o.raw)===null||r===void 0?void 0:r.versions))return N.error("Invalid /versions response"),i["m.homeserver"].error=pt.ERROR_INVALID_HOMESERVER,i["m.homeserver"].base_url=s,Promise.resolve(i);var a=new Set(o.raw.versions),c=!1;for(var l of Lb)if(a.has(l)){c=!0;break}if(!c)return N.error("Homeserver does not meet version requirements"),i["m.homeserver"].error=pt.ERROR_UNSUPPORTED_HOMESERVER_SPEC_VERSION,i["m.homeserver"].base_url=s,Promise.resolve(i);i["m.homeserver"]={state:pt.SUCCESS,error:null,base_url:s};var d="";if(e["m.identity_server"]){var h={"m.homeserver":i["m.homeserver"],"m.identity_server":{state:pt.FAIL_PROMPT,error:pt.ERROR_INVALID_IS,base_url:null}};if(d=n.sanitizeWellKnownUrl(e["m.identity_server"].base_url),!d)return N.error("Invalid base_url for m.identity_server"),h["m.identity_server"].error=pt.ERROR_INVALID_IS_BASE_URL,Promise.resolve(h);var m=yield n.fetchWellKnownObject("".concat(d,"/_matrix/identity/v2"));if(!(m!=null&&m.raw)||m.action!==Go.SUCCESS)return N.error("Invalid /v2 response"),h["m.identity_server"].error=pt.ERROR_INVALID_IDENTITY_SERVER,h["m.identity_server"].base_url=d,Promise.resolve(h)}return d&&d.toString().length>0&&(i["m.identity_server"]={state:pt.SUCCESS,error:null,base_url:d}),Object.keys(e).forEach(g=>{if(g==="m.homeserver"||g==="m.identity_server"){var y=["error","state","base_url"];for(var v of Object.keys(e[g]))y.includes(v)||(i[g][v]=e[g][v])}else i[g]=e[g]}),Promise.resolve(i)})()}static findClientConfig(e){var n=this;return B(function*(){if(!e||typeof e!="string"||e.length===0)throw new Error("'domain' must be a string of non-zero length");var r={"m.homeserver":{state:pt.FAIL_ERROR,error:pt.ERROR_INVALID,base_url:null},"m.identity_server":{state:pt.PROMPT,error:null,base_url:null}},i=e.includes("://")?e:"https://".concat(e),s=yield n.fetchWellKnownObject("".concat(i,"/.well-known/matrix/client"));return!s||s.action!==Go.SUCCESS?(N.error("No response or error when parsing .well-known"),s.reason&&N.error(s.reason),s.action===Go.IGNORE?r["m.homeserver"]={state:pt.PROMPT,error:null,base_url:null}:(r["m.homeserver"].state=pt.FAIL_PROMPT,r["m.homeserver"].error=pt.ERROR_INVALID),Promise.resolve(r)):pt.fromDiscoveryConfig(s.raw)})()}static getRawClientConfig(e){var n=this;return B(function*(){var r;if(!e||typeof e!="string"||e.length===0)throw new Error("'domain' must be a string of non-zero length");var i=yield n.fetchWellKnownObject("https://".concat(e,"/.well-known/matrix/client"));return i?(r=i.raw)!==null&&r!==void 0?r:{}:{}})()}static sanitizeWellKnownUrl(e){if(!e)return!1;try{var n,r;try{r=new URL(e)}catch(a){N.error("Could not parse url",a)}if(!((n=r)!==null&&n!==void 0&&n.hostname)||r.protocol!=="http:"&&r.protocol!=="https:")return!1;var i=r.port?":".concat(r.port):"",s=r.pathname?r.pathname:"",o="".concat(r.protocol,"//").concat(r.hostname).concat(i).concat(s);return o.endsWith("/")&&(o=o.substring(0,o.length-1)),o}catch(a){return N.error(a),!1}}static fetch(e,n){return this.fetchFn?this.fetchFn(e,n):globalThis.fetch(e,n)}static setFetchFn(e){pt.fetchFn=e}static fetchWellKnownObject(e){return B(function*(){var n;try{if(n=yield pt.fetch(e,{method:fe.Get,signal:bT(5e3)}),n.status===404)return{raw:{},action:Go.IGNORE,reason:pt.ERROR_MISSING_WELLKNOWN};if(n.status!==200)return{raw:{},action:Go.FAIL_PROMPT,reason:"General failure"}}catch(o){var r=o,i="";return typeof r=="object"&&(i=r?.message),{error:r,raw:{},action:Go.FAIL_PROMPT,reason:i||"General failure"}}try{return{raw:yield n.json(),action:Go.SUCCESS}}catch(o){var s=o;return{error:s,raw:{},action:Go.FAIL_PROMPT,reason:s?.name==="SyntaxError"?pt.ERROR_INVALID_JSON:pt.ERROR_INVALID}}})()}}M(pt,"ERROR_INVALID",ec.Invalid);M(pt,"ERROR_GENERIC_FAILURE",ec.GenericFailure);M(pt,"ERROR_INVALID_HS_BASE_URL",ec.InvalidHsBaseUrl);M(pt,"ERROR_INVALID_HOMESERVER",ec.InvalidHomeserver);M(pt,"ERROR_INVALID_IS_BASE_URL",ec.InvalidIsBaseUrl);M(pt,"ERROR_INVALID_IDENTITY_SERVER",ec.InvalidIdentityServer);M(pt,"ERROR_INVALID_IS",ec.InvalidIs);M(pt,"ERROR_MISSING_WELLKNOWN",ec.MissingWellknown);M(pt,"ERROR_INVALID_JSON",ec.InvalidJson);M(pt,"ERROR_UNSUPPORTED_HOMESERVER_SPEC_VERSION",ec.UnsupportedHomeserverSpecVersion);M(pt,"ALL_ERRORS",Object.keys(ec));M(pt,"FAIL_ERROR",Go.FAIL_ERROR);M(pt,"FAIL_PROMPT",Go.FAIL_PROMPT);M(pt,"PROMPT",Go.PROMPT);M(pt,"SUCCESS",Go.SUCCESS);M(pt,"fetchFn",void 0);var AA=(function(t){return t.IS="SERVICE_TYPE_IS",t.IM="SERVICE_TYPE_IM",t})({});class D0e{constructor(e){this.ourEvent=e,M(this,"timeline",void 0),M(this,"ourEventIndex",0),M(this,"paginateTokens",{[Tt.Backward]:null,[Tt.Forward]:null}),this.timeline=[e]}getEvent(){return this.timeline[this.ourEventIndex]}getTimeline(){return this.timeline}getOurEventIndex(){return this.ourEventIndex}getPaginateToken(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return this.paginateTokens[e?Tt.Backward:Tt.Forward]}setPaginateToken(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;this.paginateTokens[n?Tt.Backward:Tt.Forward]=e??null}addEvents(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;n?(this.timeline=e.concat(this.timeline),this.ourEventIndex+=e.length):this.timeline=this.timeline.concat(e)}}class ET{static fromJson(e,n){var r=e.context||{},i=(r.events_before||[]).map(n),s=(r.events_after||[]).map(n),o=new D0e(n(e.result)),a=o.ourEvent.threadRootId;return i=i.filter(c=>c.threadRootId===a),s=s.filter(c=>c.threadRootId===a),o.setPaginateToken(r.start,!0),o.addEvents(i,!0),o.addEvents(s,!1),o.setPaginateToken(r.end,!1),new ET(e.rank,o)}constructor(e,n){this.rank=e,this.context=n}}function xC(t){return"parent_delay_id"in t&&typeof t.parent_delay_id!="string"?!1:"delay"in t&&typeof t.delay!="number"?!0:"delay"in t||"parent_delay_id"in t}var vp=(function(t){return t.Cancel="cancel",t.Restart="restart",t.Send="send",t})({}),JJ=(function(t){return t.Public="public",t.Private="private",t})({}),CT=(function(t){return t.PrivateChat="private_chat",t.TrustedPrivateChat="trusted_private_chat",t.PublicChat="public_chat",t})({}),xf=(function(t){return t.Public="public",t.Invite="invite",t.Private="private",t.Knock="knock",t.Restricted="restricted",t})({}),N0e=(function(t){return t.RoomMembership="m.room_membership",t})({}),AC=(function(t){return t.CanJoin="can_join",t.Forbidden="forbidden",t})({}),uP=(function(t){return t.Invited="invited",t.Joined="joined",t.Shared="shared",t.WorldReadable="world_readable",t})({});function vB(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function yB(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?vB(Object(n),!0).forEach(function(r){M(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):vB(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function U0e(t,e){var n=!!e.preventReEmit,r=e.decrypt!==!1;function i(s){var o=t.getRoom(s.room_id),a;o&&s.state_key===void 0&&(a=o.findEventById(s.event_id)),!a||a.status?a=new es(s):(a.setUnsigned(yB(yB({},a.getUnsigned()),s.unsigned)),n=!0);var c=a.getServerAggregatedRelation(vn.Replace);if(c!=null&&c.content){var l=i(c);a.makeReplaced(l)}var d=o?.findThreadForEvent(a);return d&&a.setThread(d),a.isEncrypted()&&(n||t.reEmitter.reEmit(a,[Zt.Decrypted]),r&&t.decryptEventIfNeeded(a)),n||(t.reEmitter.reEmit(a,[Zt.Replaced,Zt.VisibilityChange]),o?.reEmitter.reEmit(a,[Zt.BeforeRedaction])),a}return i}function bB(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function Yd(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?bB(Object(n),!0).forEach(function(r){M(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):bB(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}class _B{constructor(e,n,r){this.client=e,this.indexEvent=n,this.directory=r}get id(){var e=this.indexEvent.getStateKey();if(!e)throw new Error("State key not found for branch");return e}get isActive(){return this.indexEvent.getContent().active===!0}get version(){var e;return(e=this.indexEvent.getContent().version)!==null&&e!==void 0?e:1}get roomId(){return this.indexEvent.getRoomId()}delete(){var e=this;return B(function*(){yield e.client.sendStateEvent(e.roomId,xu.name,{},e.id),yield e.client.redactEvent(e.roomId,e.id);var n=(yield e.getVersionHistory())[1];n&&(yield n.delete())})()}getName(){return this.indexEvent.getContent().name||"Unnamed File"}setName(e){var n=this;return B(function*(){yield n.client.sendStateEvent(n.roomId,xu.name,Yd(Yd({},n.indexEvent.getContent()),{},{name:e}),n.id)})()}isLocked(){return this.indexEvent.getContent().locked||!1}setLocked(e){var n=this;return B(function*(){yield n.client.sendStateEvent(n.roomId,xu.name,Yd(Yd({},n.indexEvent.getContent()),{},{locked:e}),n.id)})()}getFileInfo(){var e=this;return B(function*(){var n=yield e.getFileEvent(),r=n.getOriginalContent().file,i=e.client.mxcUrlToHttp(r.url);if(!i)throw new Error("No HTTP URL available for ".concat(r.url));return{info:r,httpUrl:i}})()}getFileEvent(){var e=this;return B(function*(){var n=e.client.getRoom(e.roomId);if(!n)throw new Error("Unknown room");for(var r=n.getUnfilteredTimelineSet().findEventById(e.id);!r&&n.getLiveTimeline().getState(Ue.BACKWARDS).paginationToken;)yield e.client.scrollback(n,100),r=n.getUnfilteredTimelineSet().findEventById(e.id);if(!r)throw new Error("Failed to find event");return yield e.client.decryptEventIfNeeded(r),r})()}createNewVersion(e,n,r,i){var s=this;return B(function*(){var o=yield s.directory.createFile(e,n,r,Yd(Yd({},i??{}),{},{"m.new_content":!0,"m.relates_to":{rel_type:vn.Replace,event_id:s.id}}));return yield s.client.sendStateEvent(s.roomId,xu.name,{active:!0,name:e,version:s.version+1},o.event_id),yield s.client.sendStateEvent(s.roomId,xu.name,Yd(Yd({},s.indexEvent.getContent()),{},{active:!1}),s.id),o})()}getVersionHistory(){var e=this;return B(function*(){var n=[];n.push(e);var r=e.client.getRoom(e.roomId);if(!r)throw new Error("Invalid or unknown room");var i=[...r.getLiveTimeline().getEvents()].reverse(),s,o=yield e.getFileEvent();do if(s=i.find(c=>c.replacingEventId()===o.getId()),s){var a=e.directory.getFile(s.getId());if(a)n.push(a),o=s;else break}while(s);return n})()}}function SB(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function qh(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?SB(Object(n),!0).forEach(function(r){M(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):SB(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var j0e={invite:100,kick:100,ban:100,redact:50,state_default:50,events_default:50,users_default:0,events:{[ee.RoomPowerLevels]:100,[ee.RoomHistoryVisibility]:100,[ee.RoomTombstone]:100,[ee.RoomEncryption]:100,[ee.RoomName]:50,[ee.RoomMessage]:50,[ee.RoomMessageEncrypted]:50,[ee.Sticker]:50},users:{}},lg=(function(t){return t.Viewer="viewer",t.Editor="editor",t.Owner="owner",t})({});class wB{constructor(e,n){if(this.client=e,this.roomId=n,M(this,"room",void 0),this.room=this.client.getRoom(this.roomId),!this.room)throw new Error("Unknown room")}get id(){return this.roomId}get isTopLevel(){var e=this.room.currentState.getStateEvents(ee.SpaceParent);return e!=null&&e.length?e.every(n=>{var r;return!((r=n.getContent())!==null&&r!==void 0&&r.via)}):!0}setName(e){var n=this;return B(function*(){yield n.client.sendStateEvent(n.roomId,ee.RoomName,{name:e},"")})()}invite(e){var n=arguments,r=this;return B(function*(){var i=n.length>1&&n[1]!==void 0?n[1]:!0,s=[r.retryInvite(e)];i&&s.push(...r.getDirectories().map(o=>o.invite(e,i))),yield Promise.all(s)})()}retryInvite(e){var n=this;return B(function*(){yield Cve(()=>n.client.invite(n.roomId,e),r=>!(r instanceof In&&r.errcode==="M_FORBIDDEN"))})()}setPermissions(e,n){var r=this;return B(function*(){var i,s=r.room.currentState.getStateEvents(ee.RoomPowerLevels,"");if(Array.isArray(s))throw new Error("Unexpected return type for power levels");var o=s?.getContent()||{},a=o.users_default||0,c=o.events_default||50,l=((i=o.events)===null||i===void 0?void 0:i[ee.RoomPowerLevels])||100,d=o.users||{};switch(n){case lg.Viewer:d[e]=a;break;case lg.Editor:d[e]=c;break;case lg.Owner:d[e]=l;break;default:throw new Error("Invalid role: "+n)}o.users=d,yield r.client.sendStateEvent(r.roomId,ee.RoomPowerLevels,o,"")})()}getPermissions(e){var n,r,i=this.room.currentState.getStateEvents(ee.RoomPowerLevels,"");if(Array.isArray(i))throw new Error("Unexpected return type for power levels");var s=i?.getContent()||{},o=s.users_default||0,a=s.events_default||50,c=((n=s.events)===null||n===void 0?void 0:n[ee.RoomPowerLevels])||100,l=((r=s.users)===null||r===void 0?void 0:r[e])||o;return l>=c?lg.Owner:l>=a?lg.Editor:lg.Viewer}createDirectory(e){var n=this;return B(function*(){var r=yield n.client.unstableCreateFileTree(e);return yield n.client.sendStateEvent(n.roomId,ee.SpaceChild,{via:[n.client.getDomain()]},r.roomId),yield n.client.sendStateEvent(r.roomId,ee.SpaceParent,{via:[n.client.getDomain()]},n.roomId),r})()}getDirectories(){var e=[],n=this.room.currentState.getStateEvents(ee.SpaceChild);for(var r of n)try{var i=r.getStateKey();if(i){var s=this.client.unstableGetFileTreeSpace(i);s&&e.push(s)}}catch(o){N.warn("Unable to create tree space instance for listing. Are we joined?",o)}return e}getDirectory(e){return this.getDirectories().find(n=>n.roomId===e)}delete(){var e=this;return B(function*(){var n=e.getDirectories();for(var r of n)yield r.delete();var i=[Ke.Invite,Ke.Knock,Ke.Join],s=e.room.currentState.getStateEvents(ee.RoomMember);for(var o of s){var a=o.getStateKey()!==e.client.getUserId();if(a&&i.includes(o.getContent().membership)){var c=o.getStateKey();if(!c)throw new Error("State key not found for branch");yield e.client.kick(e.roomId,c,"Room deleted")}}yield e.client.leave(e.roomId)})()}getOrderedChildren(e){var n=e.map(r=>({roomId:r.getStateKey(),order:r.getContent().order})).filter(r=>r.roomId);return n.sort((r,i)=>{if(r.order&&!i.order)return-1;if(!r.order&&i.order)return 1;if(!r.order&&!i.order){var s,o,a,c,l=this.client.getRoom(r.roomId),d=this.client.getRoom(i.roomId);if(!l||!d)return uE(r.roomId,i.roomId);var h=(s=(o=l.currentState.getStateEvents(ee.RoomCreate,""))===null||o===void 0?void 0:o.getTs())!==null&&s!==void 0?s:0,m=(a=(c=d.currentState.getStateEvents(ee.RoomCreate,""))===null||c===void 0?void 0:c.getTs())!==null&&a!==void 0?a:0;return h===m?uE(r.roomId,i.roomId):h-m}else return uE(r.order,i.order)}),n}getParentRoom(){var e=this.room.currentState.getStateEvents(ee.SpaceParent),n=e[0];if(!n)throw new Error("Expected to have a parent in a non-top level space");var r=n.getStateKey();if(!r)throw new Error("No state key found for parent");var i=this.client.getRoom(r);if(!i)throw new Error("Unable to locate room for parent");return i}getOrder(){if(this.isTopLevel)return-1;var e=this.getParentRoom(),n=e.currentState.getStateEvents(ee.SpaceChild),r=this.getOrderedChildren(n);return r.findIndex(i=>i.roomId===this.roomId)}setOrder(e){var n=this;return B(function*(){var r;if(n.isTopLevel)throw new Error("Cannot set order of top level spaces currently");var i=n.getParentRoom(),s=i.currentState.getStateEvents(ee.SpaceChild),o=n.getOrderedChildren(s);e=Math.max(Math.min(e,o.length-1),0);var a=n.getOrder(),c=a<e;c&&e===o.length-1?e--:!c&&e===0&&e++;var l=o[c?e:e-1],d=o[c?e+1:e],h=qf[0],m=!1;if(!l)d!=null&&d.order&&(h=u$(d.order));else if(e===o.length-1)d!=null&&d.order&&(h=O0(d.order));else{var g=l?.order,y=d?.order;g&&y?g===y?h=O0(g):h=Tve(g,y):g?h=O0(g):y?h=u$(y):m=!0}if(m){for(var v,E=0;E<=e;E++){var w=o[E];if(E===0&&(v=w.order),w.order)v=w.order;else{var R;v=v?O0(v):qf[0];var x=i.currentState.getStateEvents(ee.SpaceChild,w.roomId),C=(R=x?.getContent())!==null&&R!==void 0?R:{via:[n.client.getDomain()]};yield n.client.sendStateEvent(i.roomId,ee.SpaceChild,qh(qh({},C),{},{order:v}),w.roomId)}}v&&(h=O0(v))}var k=i.currentState.getStateEvents(ee.SpaceChild,n.roomId),T=(r=k?.getContent())!==null&&r!==void 0?r:{via:[n.client.getDomain()]};yield n.client.sendStateEvent(i.roomId,ee.SpaceChild,qh(qh({},T),{},{order:h}),n.roomId)})()}createFile(e,n,r,i){var s=this;return B(function*(){var{content_uri:o}=yield s.client.uploadContent(n,{includeFilename:!1});r.url=o;var a={msgtype:Nl.File,body:e,url:o,file:r};i=i??{},i["m.new_content"]&&(i["m.new_content"]=a);var c=yield s.client.sendMessage(s.roomId,qh(qh(qh({},i),a),{},{[ZX.name]:{}}));return yield s.client.sendStateEvent(s.roomId,xu.name,{active:!0,name:e},c.event_id),c})()}getFile(e){var n=this.room.currentState.getStateEvents(xu.name,e);return n?new _B(this.client,n,this):null}listFiles(){return this.listAllFiles().filter(e=>e.isActive)}listAllFiles(){var e,n=(e=this.room.currentState.getStateEvents(xu.name))!==null&&e!==void 0?e:[];return n.map(r=>new _B(this.client,r,this))}}var QJ=(function(t){return t.Recent="recent",t.Rank="rank",t})({}),tp=(function(t){return t.LocalStreamsChanged="local_streams_changed",t})({});class F0e extends Gn{constructor(e){super(),this.client=e,M(this,"audioInput",void 0),M(this,"audioSettings",void 0),M(this,"videoInput",void 0),M(this,"localUserMediaStream",void 0),M(this,"userMediaStreams",[]),M(this,"screensharingStreams",[]),M(this,"getMediaStreamPromise",void 0)}restoreMediaSettings(e,n){this.audioInput=e,this.videoInput=n}setAudioInput(e){var n=this;return B(function*(){N.info("MediaHandler setAudioInput() running (deviceId=".concat(e,")")),n.audioInput!==e&&(n.audioInput=e,yield n.updateLocalUsermediaStreams())})()}setAudioSettings(e){var n=this;return B(function*(){N.info("MediaHandler setAudioSettings() running (opts=".concat(JSON.stringify(e),")")),n.audioSettings=Object.assign({},e),yield n.updateLocalUsermediaStreams()})()}setVideoInput(e){var n=this;return B(function*(){N.info("MediaHandler setVideoInput() running (deviceId=".concat(e,")")),n.videoInput!==e&&(n.videoInput=e,yield n.updateLocalUsermediaStreams())})()}setMediaInputs(e,n){var r=this;return B(function*(){N.log("MediaHandler setMediaInputs() running (audioInput: ".concat(e," videoInput: ").concat(n,")")),r.audioInput=e,r.videoInput=n,yield r.updateLocalUsermediaStreams()})()}updateLocalUsermediaStreams(){var e=this;return B(function*(){if(e.userMediaStreams.length!==0){var n=new Map;for(var r of e.client.callEventHandler.calls.values())n.set(r.callId,{audio:r.hasLocalUserMediaAudioTrack,video:r.hasLocalUserMediaVideoTrack});for(var i of e.userMediaStreams){N.log("MediaHandler updateLocalUsermediaStreams() stopping all tracks (streamId=".concat(i.id,")"));for(var s of i.getTracks())s.stop()}e.userMediaStreams=[],e.localUserMediaStream=void 0;for(var o of e.client.callEventHandler.calls.values())if(!(o.callHasEnded()||!n.has(o.callId))){var{audio:a,video:c}=n.get(o.callId);N.log("MediaHandler updateLocalUsermediaStreams() calling getUserMediaStream() (callId=".concat(o.callId,")"));var l=yield e.getUserMediaStream(a,c);o.callHasEnded()||(yield o.updateLocalUsermediaStream(l))}for(var d of e.client.groupCallEventHandler.groupCalls.values())if(d.localCallFeed){N.log("MediaHandler updateLocalUsermediaStreams() calling getUserMediaStream() (groupCallId=".concat(d.groupCallId,")"));var h=yield e.getUserMediaStream(!0,d.type===wT.Video);d.state!==hr.Ended&&(yield d.updateLocalUsermediaStream(h))}e.emit(tp.LocalStreamsChanged)}})()}hasAudioDevice(){return B(function*(){try{var e=yield navigator.mediaDevices.enumerateDevices();return e.filter(n=>n.kind==="audioinput").length>0}catch(n){return N.log("MediaHandler hasAudioDevice() calling navigator.mediaDevices.enumerateDevices with error",n),!1}})()}hasVideoDevice(){return B(function*(){try{var e=yield navigator.mediaDevices.enumerateDevices();return e.filter(n=>n.kind==="videoinput").length>0}catch(n){return N.log("MediaHandler hasVideoDevice() calling navigator.mediaDevices.enumerateDevices with error",n),!1}})()}getUserMediaStream(e,n){var r=arguments,i=this;return B(function*(){var s=r.length>2&&r[2]!==void 0?r[2]:!0;return i.getMediaStreamPromise?i.getMediaStreamPromise=i.getMediaStreamPromise.then(()=>i.getUserMediaStreamInternal(e,n,s)):i.getMediaStreamPromise=i.getUserMediaStreamInternal(e,n,s),i.getMediaStreamPromise})()}getUserMediaStreamInternal(e,n,r){var i=this;return B(function*(){var s=e&&(yield i.hasAudioDevice()),o=n&&(yield i.hasVideoDevice()),a,c=!0;if(i.localUserMediaStream){var l,d;s!==i.localUserMediaStream.getAudioTracks().length>0&&(c=!1),o!==i.localUserMediaStream.getVideoTracks().length>0&&(c=!1),s&&((l=i.localUserMediaStream.getAudioTracks()[0])===null||l===void 0||(l=l.getSettings())===null||l===void 0?void 0:l.deviceId)!==i.audioInput&&(c=!1),o&&((d=i.localUserMediaStream.getVideoTracks()[0])===null||d===void 0||(d=d.getSettings())===null||d===void 0?void 0:d.deviceId)!==i.videoInput&&(c=!1)}else c=!1;if(c){var y;if(a=i.localUserMediaStream.clone(),N.log("MediaHandler getUserMediaStreamInternal() cloning (oldStreamId=".concat((y=i.localUserMediaStream)===null||y===void 0?void 0:y.id," newStreamId=").concat(a.id," shouldRequestAudio=").concat(s," shouldRequestVideo=").concat(o,")")),!s)for(var v of a.getAudioTracks())a.removeTrack(v);if(!o)for(var E of a.getVideoTracks())a.removeTrack(E)}else{var h;try{h=i.getUserMediaContraints(s,o,!0),a=yield navigator.mediaDevices.getUserMedia(h)}catch(w){N.warn("MediaHandler getUserMediaStreamInternal() error (e=".concat(w,"), retrying without exact deviceId")),h=i.getUserMediaContraints(s,o,!1),a=yield navigator.mediaDevices.getUserMedia(h)}N.log("MediaHandler getUserMediaStreamInternal() calling getUserMediaStream (streamId=".concat(a.id,", shouldRequestAudio=").concat(s,", shouldRequestVideo=").concat(o,", constraints=").concat(JSON.stringify(h),")"));for(var m of a.getTracks()){var g=m.getSettings();m.kind==="audio"?i.audioInput=g.deviceId:m.kind==="video"&&(i.videoInput=g.deviceId)}r&&(i.localUserMediaStream=a)}return r&&i.userMediaStreams.push(a),i.emit(tp.LocalStreamsChanged),a})()}stopUserMediaStream(e){N.log("MediaHandler stopUserMediaStream() stopping (streamId=".concat(e.id,")"));for(var n of e.getTracks())n.stop();var r=this.userMediaStreams.indexOf(e);if(r!==-1&&(N.debug("MediaHandler stopUserMediaStream() splicing usermedia stream out stream array (streamId=".concat(e.id,")"),e.id),this.userMediaStreams.splice(r,1)),this.emit(tp.LocalStreamsChanged),this.localUserMediaStream===e)this.localUserMediaStream=void 0;else for(var i of e.getTracks()){var s;if((s=this.localUserMediaStream)!==null&&s!==void 0&&s.getTrackById(i.id)){this.stopUserMediaStream(this.localUserMediaStream);break}}}getScreensharingStream(){var e=arguments,n=this;return B(function*(){var r=e.length>0&&e[0]!==void 0?e[0]:{},i=e.length>1&&e[1]!==void 0?e[1]:!0,s;if(n.screensharingStreams.length===0){var o=n.getScreenshareContraints(r);r.desktopCapturerSourceId?(N.debug("MediaHandler getScreensharingStream() calling getUserMedia() (opts=".concat(JSON.stringify(r),")")),s=yield navigator.mediaDevices.getUserMedia(o)):(N.debug("MediaHandler getScreensharingStream() calling getDisplayMedia() (opts=".concat(JSON.stringify(r),")")),s=yield navigator.mediaDevices.getDisplayMedia(o))}else{var a=n.screensharingStreams[n.screensharingStreams.length-1];N.log("MediaHandler getScreensharingStream() cloning (streamId=".concat(a.id,")")),s=a.clone()}return i&&n.screensharingStreams.push(s),n.emit(tp.LocalStreamsChanged),s})()}stopScreensharingStream(e){N.debug("MediaHandler stopScreensharingStream() stopping stream (streamId=".concat(e.id,")"));for(var n of e.getTracks())n.stop();var r=this.screensharingStreams.indexOf(e);r!==-1&&(N.debug("MediaHandler stopScreensharingStream() splicing stream out (streamId=".concat(e.id,")")),this.screensharingStreams.splice(r,1)),this.emit(tp.LocalStreamsChanged)}stopAllStreams(){for(var e of this.userMediaStreams){N.log("MediaHandler stopAllStreams() stopping (streamId=".concat(e.id,")"));for(var n of e.getTracks())n.stop()}for(var r of this.screensharingStreams)for(var i of r.getTracks())i.stop();this.userMediaStreams=[],this.screensharingStreams=[],this.localUserMediaStream=void 0,this.emit(tp.LocalStreamsChanged)}getUserMediaContraints(e,n,r){var i=!!navigator.webkitGetUserMedia,s=r?"exact":"ideal",o={};this.audioInput&&(o.deviceId={[s]:this.audioInput}),this.audioSettings&&(o.autoGainControl={ideal:this.audioSettings.autoGainControl},o.echoCancellation={ideal:this.audioSettings.echoCancellation},o.noiseSuppression={ideal:this.audioSettings.noiseSuppression});var a={width:i?{exact:640}:{ideal:640},height:i?{exact:360}:{ideal:360}};return this.videoInput&&(a.deviceId={[s]:this.videoInput}),{audio:e?o:!1,video:n?a:!1}}getScreenshareContraints(e){var{desktopCapturerSourceId:n,audio:r}=e;return n?{audio:r??!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:n}}}:{audio:r??!1,video:!0}}}var EB=(function(t){return t.RequestFinished="FINISHED",t.Complete="COMPLETE",t})({}),N_=(function(t){return t.PreProcess="ExtState.PreProcess",t.PostProcess="ExtState.PostProcess",t})({}),LA=(function(t){return t.RoomData="SlidingSync.RoomData",t.Lifecycle="SlidingSync.Lifecycle",t})({}),$0e=3;class B0e{constructor(e){this.crypto=e}name(){return"e2ee"}when(){return N_.PreProcess}onRequest(e){var n=this;return B(function*(){return e&&(N.log("ExtensionE2EE: invalidating all device lists due to missing 'pos'"),yield n.crypto.markAllTrackedUsersAsDirty()),{enabled:!0}})()}onResponse(e){var n=this;return B(function*(){e.device_lists&&(yield n.crypto.processDeviceLists(e.device_lists)),yield n.crypto.processKeyCounts(e.device_one_time_keys_count,e.device_unused_fallback_key_types||e["org.matrix.msc2732.device_unused_fallback_key_types"]),n.crypto.onSyncCompleted({})})()}}class H0e{constructor(e,n){this.client=e,this.cryptoCallbacks=n,M(this,"nextBatch",null)}name(){return"to_device"}when(){return N_.PreProcess}onRequest(e){var n=this;return B(function*(){return{since:n.nextBatch!==null?n.nextBatch:void 0,limit:100,enabled:!0}})()}onResponse(e){var n=this;return B(function*(){var r=e.events||[],i;n.cryptoCallbacks?i=yield n.cryptoCallbacks.preprocessToDeviceMessages(r):i=r.map(s=>({message:s,encryptionInfo:null})),KJ(i,n.client),n.nextBatch=e.next_batch})()}}class q0e{constructor(e){this.client=e}name(){return"account_data"}when(){return N_.PostProcess}onRequest(e){return B(function*(){return{enabled:!0}})()}onResponse(e){var n=this;return B(function*(){e.global&&e.global.length>0&&n.processGlobalAccountData(e.global);for(var r in e.rooms){var i=Jg(n.client,r,e.rooms[r]),s=n.client.getRoom(r);if(!s){N.warn("got account data for room but room doesn't exist on client:",r);continue}s.addAccountData(i),i.forEach(o=>{n.client.emit(Pe.Event,o)})}})()}processGlobalAccountData(e){var n=Jg(this.client,void 0,e),r=n.reduce((i,s)=>(i[s.getType()]=this.client.store.getAccountData(s.getType()),i),{});this.client.store.storeAccountDataEvents(n),n.forEach(i=>{if(i.getType()===ee.PushRules){var s=i.getContent();this.client.setPushRules(s)}var o=r[i.getType()];return this.client.emit(Pe.AccountData,i,o),i})}}class V0e{constructor(e){this.client=e}name(){return"typing"}when(){return N_.PostProcess}onRequest(e){return B(function*(){return{enabled:!0}})()}onResponse(e){var n=this;return B(function*(){if(e!=null&&e.rooms)for(var r in e.rooms)eQ(n.client,r,[e.rooms[r]])})()}}class K0e{constructor(e){this.client=e}name(){return"receipts"}when(){return N_.PostProcess}onRequest(e){return B(function*(){return{enabled:!0}})()}onResponse(e){var n=this;return B(function*(){if(e!=null&&e.rooms)for(var r in e.rooms)eQ(n.client,r,[e.rooms[r]])})()}}class ZJ{constructor(e,n,r,i){this.slidingSync=e,this.client=n,M(this,"opts",void 0),M(this,"syncOpts",void 0),M(this,"syncState",null),M(this,"syncStateData",void 0),M(this,"lastPos",null),M(this,"failCount",0),M(this,"notifEvents",[]),this.opts=HJ(r),this.syncOpts=qJ(i),n.getNotifTimelineSet()&&n.reEmitter.reEmit(n.getNotifTimelineSet(),[Me.Timeline,Me.TimelineReset]),this.slidingSync.on(LA.Lifecycle,this.onLifecycle.bind(this)),this.slidingSync.on(LA.RoomData,this.onRoomData.bind(this));var s=[new H0e(this.client,this.syncOpts.cryptoCallbacks),new q0e(this.client),new V0e(this.client),new K0e(this.client)];this.syncOpts.cryptoCallbacks&&s.push(new B0e(this.syncOpts.cryptoCallbacks)),s.forEach(o=>{this.slidingSync.registerExtension(o)})}onRoomData(e,n){var r=this;return B(function*(){var i=r.client.store.getRoom(e);if(!i){if(!n.initial){r.syncOpts.logger.debug("initial flag not set but no stored room exists for room ",e,n);return}i=VJ(r.client,e,r.opts)}yield r.processRoomData(r.client,i,n)})()}onLifecycle(e,n,r){switch(r&&this.syncOpts.logger.debug("onLifecycle",e,r),e){case EB.Complete:if(this.purgeNotifications(),!n)break;this.lastPos||this.updateSyncState(Qt.Prepared,{oldSyncToken:void 0,nextSyncToken:n.pos,catchingUp:!1,fromCache:!1}),this.updateSyncState(Qt.Syncing,{oldSyncToken:this.lastPos,nextSyncToken:n.pos,catchingUp:!1,fromCache:!1}),this.lastPos=n.pos;break;case EB.RequestFinished:if(r){if(this.failCount+=1,this.updateSyncState(this.failCount>$0e?Qt.Error:Qt.Reconnecting,{error:new In(r)}),this.shouldAbortSync(new In(r)))return}else this.failCount=0,this.syncOpts.logger.debug("SlidingSyncState.RequestFinished with ".concat(Object.keys(n?.rooms||[]).length," rooms"));break}}syncLeftRooms(){return B(function*(){return[]})()}peek(e){return B(function*(){return null})()}stopPeeking(){}setPresence(e){}getSyncState(){return this.syncState}getSyncStateData(){var e;return(e=this.syncStateData)!==null&&e!==void 0?e:null}createRoom(e){var{timelineSupport:n}=this.client,r=new _T(e,this.client,this.client.getUserId(),{lazyLoadMembers:this.opts.lazyLoadMembers,pendingEventOrdering:this.opts.pendingEventOrdering,timelineSupport:n});return this.client.reEmitter.reEmit(r,[Me.Name,Me.Redaction,Me.RedactionCancelled,Me.Receipt,Me.Tags,Me.LocalEchoUpdated,Me.AccountData,Me.MyMembership,Me.Timeline,Me.TimelineReset]),this.registerStateListeners(r),r}registerStateListeners(e){this.client.reEmitter.reEmit(e.currentState,[Rt.Events,Rt.Members,Rt.NewMember,Rt.Update]),e.currentState.on(Rt.NewMember,(n,r,i)=>{var s;i.user=(s=this.client.getUser(i.userId))!==null&&s!==void 0?s:void 0,this.client.reEmitter.reEmit(i,[ao.Name,ao.Typing,ao.PowerLevel,ao.Membership])})}shouldAbortSync(e){return e.errcode==="M_UNKNOWN_TOKEN"?(this.syncOpts.logger.warn("Token no longer valid - assuming logout"),this.stop(),this.updateSyncState(Qt.Error,{error:e}),!0):!1}processRoomData(e,n,r){var i=this;return B(function*(){r=G0e(e,n.roomId,r);var s=Jg(i.client,n.roomId,r.required_state),o=Jg(i.client,n.roomId,r.timeline,!1),a=[];if(r.limited||r.initial){var c=new Set;n.getLiveTimeline().getEvents().forEach(R=>{c.add(R.getId())});for(var l=[],d=[],h=!1,m=o.length-1;m>=0;m--){var g=o[m];if(c.has(g.getId())){h=!0;continue}h?l.push(g):d.unshift(g)}o=d,l.length>0&&n.addEventsToTimeline(l,!0,!1,n.getLiveTimeline(),r.prev_batch)}var y=n.hasEncryptionStateEvent();if(r.notification_count!=null&&n.setUnreadNotificationCount(sn.Total,r.notification_count),r.highlight_count!=null&&(!y||y&&n.getUnreadNotificationCount(sn.Highlight)<=0)&&n.setUnreadNotificationCount(sn.Highlight,r.highlight_count),r.bump_stamp&&n.setBumpStamp(r.bump_stamp),Number.isInteger(r.invited_count)&&n.currentState.setInvitedMemberCount(r.invited_count),Number.isInteger(r.joined_count)&&n.currentState.setJoinedMemberCount(r.joined_count),r.invite_state){var v=Jg(i.client,n.roomId,r.invite_state);yield i.injectRoomEvents(n,v),r.initial&&(n.recalculate(),i.client.store.storeRoom(n),i.client.emit(Pe.Room,n)),v.forEach(R=>{i.client.emit(Pe.Event,R)});return}if(r.limited){var E;n.getLiveTimeline().setPaginationToken((E=r.prev_batch)!==null&&E!==void 0?E:null,Ue.BACKWARDS)}yield i.injectRoomEvents(n,s,o,r.num_live),n.addEphemeralEvents(a),n.updateMyMembership(Ke.Join),n.setMSC4186SummaryData(r.heroes,r.joined_count,r.invited_count),n.recalculate(),r.initial&&(e.store.storeRoom(n),e.emit(Pe.Room,n)),i.addNotifications(o);var w=(function(){var R=B(function*(x){e.emit(Pe.Event,x),x.isState()&&x.getType()==ee.RoomEncryption&&i.syncOpts.cryptoCallbacks&&(yield i.syncOpts.cryptoCallbacks.onCryptoEvent(n,x))});return function(C){return R.apply(this,arguments)}})();yield c$(s,w),yield c$(o,w),a.forEach(function(R){e.emit(Pe.Event,R)}),n.decryptCriticalEvents()})()}injectRoomEvents(e,n){var r=arguments,i=this;return B(function*(){var s=r.length>2&&r[2]!==void 0?r[2]:[],o=r.length>3&&r[3]!==void 0?r[3]:0,a=e.getLiveTimeline(),c=a.getEvents().length==0;if(c){for(var l of n)i.client.getPushActionsForEvent(l);a.initialiseState(n)}c||(e.oldState.setStateEvents(n),e.currentState.setStateEvents(n));var d=[];o>0&&(d=s.slice(-1*o),s=s.slice(0,-1*d.length)),yield e.addLiveEvents(s,{fromCache:!0,addToState:!1}),d.length>0&&(yield e.addLiveEvents(d,{fromCache:!1,addToState:!1})),e.recalculate(),i.resolveInvites(e)})()}resolveInvites(e){if(!(!e||!this.opts.resolveInvitesToProfiles)){var n=this.client;e.getMembersWithMembership(Ke.Invite).forEach(function(r){if(!r.requestedProfileInfo){r.requestedProfileInfo=!0;var i=n.getUser(r.userId),s;i?s=Promise.resolve({avatar_url:i.avatarUrl,displayname:i.displayName}):s=n.getProfileInfo(r.userId),s.then(function(o){var a=r.events.member;a.getContent().membership===Ke.Invite&&(a.getContent().avatar_url=o.avatar_url,a.getContent().displayname=o.displayname,r.setMembershipEvent(a,e.currentState))},function(o){})}})}}retryImmediately(){return!0}sync(){var e=this;return B(function*(){for(e.syncOpts.logger.debug("Sliding sync init loop");!e.client.isGuest();)try{e.syncOpts.logger.debug("Getting push rules...");var n=yield e.client.getPushRules();e.syncOpts.logger.debug("Got push rules"),e.client.pushRules=n;break}catch(r){if(e.syncOpts.logger.error("Getting push rules failed",r),e.shouldAbortSync(r))return}yield e.slidingSync.start()})()}stop(){this.syncOpts.logger.debug("SyncApi.stop"),this.slidingSync.stop()}updateSyncState(e,n){var r=this.syncState;this.syncState=e,this.syncStateData=n,this.client.emit(Pe.Sync,this.syncState,r,n)}addNotifications(e){if(this.client.getNotifTimelineSet())for(var n of e){var r=this.client.getPushActionsForEvent(n);r&&r.notify&&r.tweaks&&r.tweaks.highlight&&this.notifEvents.push(n)}}purgeNotifications(){this.notifEvents.sort(function(e,n){return e.getTs()-n.getTs()}),this.notifEvents.forEach(e=>{var n;(n=this.client.getNotifTimelineSet())===null||n===void 0||n.addLiveEvent(e,{addToState:!1})}),this.notifEvents=[]}}function G0e(t,e,n){if(!n.name)return n;for(var r of n.required_state)if(r.type===ee.RoomName&&r.state_key==="")return r.content={name:n.name},n;return n.required_state.push({event_id:"$fake-sliding-sync-name-event-"+e,state_key:"",type:ee.RoomName,content:{name:n.name},sender:t.getUserId(),origin_server_ts:new Date().getTime()}),n}function Jg(t,e,n){var r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,i=t.getEventMapper({decrypt:r});return n.map(function(s){return s.room_id=e,i(s)})}function eQ(t,e,n){var r=Jg(t,e,n),i=t.getRoom(e);if(!i){N.warn("got ephemeral events for room but room doesn't exist on client:",e);return}i.addEphemeralEvents(r),r.forEach(s=>{t.emit(Pe.Event,s)})}var dP=new Kr("m.beacon_info","org.matrix.msc3672.beacon_info"),MA=new Kr("m.beacon","org.matrix.msc3672.beacon");class Iv{static RETRY_BACKOFF_RATELIMIT(e,n,r){return nP(r,n,!1)}static QUEUE_MESSAGES(e){return e.getType()===ee.RoomMessage||e.hasAssociation()?"message":null}constructor(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Iv.RETRY_BACKOFF_RATELIMIT,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Iv.QUEUE_MESSAGES;this.retryAlgorithm=e,this.queueAlgorithm=n,M(this,"queues",{}),M(this,"activeQueues",[]),M(this,"procFn",null),M(this,"processQueue",r=>{var i=this.peekNextEvent(r);if(!i){this.disableQueue(r);return}this.queues[r].length,Promise.resolve().then(()=>this.procFn(i.event)).then(s=>{this.removeNextEvent(r),i.event.getId(),i.resolvers.resolve(s),this.processQueue(r)},s=>{i.attempts+=1;var o=this.retryAlgorithm(i.event,i.attempts,s);i.attempts,i.event.getId(),o===-1?(N.info("Queue '%s' giving up on event %s",r,i.event.getId()),this.clearQueue(r,s)):setTimeout(this.processQueue,o,r)})})}getQueueForEvent(e){var n=this.queueAlgorithm(e);return!n||!this.queues[n]?null:this.queues[n].map(function(r){return r.event})}removeEventFromQueue(e){var n=this.queueAlgorithm(e);if(!n||!this.queues[n])return!1;var r=!1;return bC(this.queues[n],i=>i.event.getId()===e.getId()?(r=!0,!0):!1),r}setProcessFunction(e){this.procFn=e,this.startProcessingQueues()}queueEvent(e){var n=this.queueAlgorithm(e);if(!n)return null;this.queues[n]||(this.queues[n]=[]);var r=Promise.withResolvers();return this.queues[n].push({event:e,resolvers:r,attempts:0}),e.getId(),this.startProcessingQueues(),r.promise}startProcessingQueues(){this.procFn&&Object.keys(this.queues).filter(e=>this.activeQueues.indexOf(e)===-1&&this.queues[e].length>0).forEach(e=>{this.activeQueues.push(e),this.processQueue(e)})}disableQueue(e){var n=this.activeQueues.indexOf(e);n>=0&&this.activeQueues.splice(n,1),N.info("Stopping queue '%s' as it is now empty",e)}clearQueue(e,n){N.info("clearing queue '%s'",e);for(var r;r=this.removeNextEvent(e);)r.resolvers.reject(n);this.disableQueue(e)}peekNextEvent(e){var n=this.queues[e];if(Array.isArray(n))return n[0]}removeNextEvent(e){var n=this.queues[e];if(Array.isArray(n))return n.shift()}}var CB=20;class z0e{constructor(e,n){var r=this;this.client=e,this.logger=n,M(this,"sending",!1),M(this,"running",!0),M(this,"retryTimeout",null),M(this,"retryAttempts",0),M(this,"sendQueue",B(function*(){if(r.retryTimeout!==null&&clearTimeout(r.retryTimeout),r.retryTimeout=null,!(r.sending||!r.running)){r.logger.debug("Attempting to send queued to-device messages"),r.sending=!0;var i;try{for(;r.running&&(i=yield r.client.store.getOldestToDeviceBatch(),i!==null);)yield r.sendBatch(i),yield r.client.store.removeToDeviceBatch(i.id),r.retryAttempts=0;if(!r.running)return;r.logger.debug("All queued to-device messages sent")}catch(o){++r.retryAttempts;var s=Iv.RETRY_BACKOFF_RATELIMIT(null,r.retryAttempts,o);if(s===-1){Math.floor(o.httpStatus/100)===4?(r.logger.error("Fatal error when sending to-device message - dropping to-device batch!",o),yield r.client.store.removeToDeviceBatch(i.id)):r.logger.info("Automatic retry limit reached for to-device messages.");return}r.logger.info("Failed to send batch of to-device messages. Will retry in ".concat(s,"ms"),o),r.retryTimeout=setTimeout(r.sendQueue,s)}finally{r.sending=!1}}})),M(this,"onResumedSync",(i,s)=>{i===Qt.Syncing&&s!==Qt.Syncing&&(this.logger.info("Resuming queue after resumed sync"),this.sendQueue())})}start(){this.running=!0,this.sendQueue(),this.client.on(Pe.Sync,this.onResumedSync)}stop(){this.running=!1,this.retryTimeout!==null&&clearTimeout(this.retryTimeout),this.retryTimeout=null,this.client.removeListener(Pe.Sync,this.onResumedSync)}queueBatch(e){var n=this;return B(function*(){for(var r=[],i=0;i<e.batch.length;i+=CB){var s={eventType:e.eventType,batch:e.batch.slice(i,i+CB),txnId:n.client.makeTxnId()};r.push(s);var o=s.batch.map(a=>"".concat(a.userId,"/").concat(a.deviceId," (msgid ").concat(a.payload[yT],")"));n.logger.info("Enqueuing batch of to-device messages. type=".concat(e.eventType," txnid=").concat(s.txnId),o)}yield n.client.store.saveToDeviceBatches(r),n.sendQueue()})()}sendBatch(e){var n=this;return B(function*(){var r=new Hu(()=>new Map);for(var i of e.batch)r.getOrCreate(i.userId).set(i.deviceId,i.payload);n.logger.info("Sending batch of ".concat(e.batch.length," to-device messages with ID ").concat(e.id," and txnId ").concat(e.txnId)),yield n.client.sendToDevice(e.eventType,r,e.txnId)})()}}var nx=new Eo.UnstableValue("m.policies","org.matrix.msc3847.policies"),tw=new Eo.UnstableValue("m.ignore.invites","org.matrix.msc3847.ignore.invites"),TB=(function(t){return t.Ban="m.ban",t})({}),Qg=(function(t){return t.User="m.policy.user",t.Room="m.policy.room",t.Server="m.policy.server",t})({}),RB={[Qg.User]:ee.PolicyRuleUser,[Qg.Room]:ee.PolicyRuleRoom,[Qg.Server]:ee.PolicyRuleServer};class W0e{constructor(e){this.client=e}addRule(e,n,r){var i=this;return B(function*(){var s=yield i.getOrCreateTargetRoom(),o=yield i.client.sendStateEvent(s.roomId,RB[e],{entity:n,reason:r,recommendation:TB.Ban});return o.event_id})()}removeRule(e){var n=this;return B(function*(){yield n.client.redactEvent(e.getRoomId(),e.getId())})()}addSource(e){var n=this;return B(function*(){yield n.client.joinRoom(e);var r=(yield n.getOrCreateSourceRooms()).map(i=>i.roomId);return r.includes(e)?!1:(r.push(e),yield n.withIgnoreInvitesPolicies(i=>{i.sources=r}),!0)})()}getRuleForInvite(e){var n=this;return B(function*(){var{sender:r,roomId:i}=e,s=yield n.getOrCreateSourceRooms(),o=r.split(":")[1],a=i.split(":")[1];for(var c of s){var l=c.getUnfilteredTimelineSet().getLiveTimeline().getState(Ue.FORWARDS);for(var{scope:d,entities:h}of[{scope:Qg.Room,entities:[i]},{scope:Qg.User,entities:[r]},{scope:Qg.Server,entities:[o,a]}]){var m=l.getStateEvents(RB[d]);for(var g of m){var y=g.getContent();if(y?.recommendation==TB.Ban){var v=y?.entity;if(v){var E=void 0;try{E=new RegExp(GX(v))}catch{continue}for(var w of h)if(w&&E.test(w))return g}}}}}return null})()}getOrCreateTargetRoom(){var e=this;return B(function*(){var n=e.getIgnoreInvitesPolicies(),r=n.target;if(typeof r!="string"&&(r=null),r){var i=e.client.getRoom(r);if(i)return i;r=null}return r=(yield e.client.createRoom({name:"Individual Policy Room",preset:CT.PrivateChat})).room_id,yield e.withIgnoreInvitesPolicies(s=>{s.target=r}),e.client.getRoom(r)})()}getOrCreateSourceRooms(){var e=this;return B(function*(){var n=e.getIgnoreInvitesPolicies(),r=n.sources,i=!1;Array.isArray(r)||(i=!0,r=[]);var s=r.filter(a=>typeof a=="string").map(a=>e.client.getRoom(a)).filter(a=>!!a);if(s.length!=r.length&&(i=!0),s.length==0){var o=yield e.getOrCreateTargetRoom();i=!0,s=[o]}return i&&(yield e.withIgnoreInvitesPolicies(a=>{a.sources=r})),s})()}getIgnoreInvitesPolicies(){return this.getPoliciesAndIgnoreInvitesPolicies().ignoreInvitesPolicies}withIgnoreInvitesPolicies(e){var n=this;return B(function*(){var{policies:r,ignoreInvitesPolicies:i}=n.getPoliciesAndIgnoreInvitesPolicies();e(i),r[tw.name]=i,yield n.client.setAccountData(nx.name,r)})()}getPoliciesAndIgnoreInvitesPolicies(){var e={};for(var n of[nx.name,nx.altName]){var r;if(n){var i=(r=this.client.getAccountData(n))===null||r===void 0?void 0:r.getContent();if(i){e=i;break}}}var s={},o=!1;for(var a of[tw.name,tw.altName])if(a){var c=e[a];if(c&&typeof c=="object"){s=c,o=!0;break}}return o||(e[tw.name]=s),{policies:e,ignoreInvitesPolicies:s}}}var rx="matrix-js-sdk";function Y0e(t){if(t.length>=255)throw new TypeError("Alphabet too long");const e=new Uint8Array(256);for(let l=0;l<e.length;l++)e[l]=255;for(let l=0;l<t.length;l++){const d=t.charAt(l),h=d.charCodeAt(0);if(e[h]!==255)throw new TypeError(d+" is ambiguous");e[h]=l}const n=t.length,r=t.charAt(0),i=Math.log(n)/Math.log(256),s=Math.log(256)/Math.log(n);function o(l){if(l instanceof Uint8Array||(ArrayBuffer.isView(l)?l=new Uint8Array(l.buffer,l.byteOffset,l.byteLength):Array.isArray(l)&&(l=Uint8Array.from(l))),!(l instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(l.length===0)return"";let d=0,h=0,m=0;const g=l.length;for(;m!==g&&l[m]===0;)m++,d++;const y=(g-m)*s+1>>>0,v=new Uint8Array(y);for(;m!==g;){let R=l[m],x=0;for(let C=y-1;(R!==0||x<h)&&C!==-1;C--,x++)R+=256*v[C]>>>0,v[C]=R%n>>>0,R=R/n>>>0;if(R!==0)throw new Error("Non-zero carry");h=x,m++}let E=y-h;for(;E!==y&&v[E]===0;)E++;let w=r.repeat(d);for(;E<y;++E)w+=t.charAt(v[E]);return w}function a(l){if(typeof l!="string")throw new TypeError("Expected String");if(l.length===0)return new Uint8Array;let d=0,h=0,m=0;for(;l[d]===r;)h++,d++;const g=(l.length-d)*i+1>>>0,y=new Uint8Array(g);for(;d<l.length;){const R=l.charCodeAt(d);if(R>255)return;let x=e[R];if(x===255)return;let C=0;for(let k=g-1;(x!==0||C<m)&&k!==-1;k--,C++)x+=n*y[k]>>>0,y[k]=x%256>>>0,x=x/256>>>0;if(x!==0)throw new Error("Non-zero carry");m=C,d++}let v=g-m;for(;v!==g&&y[v]===0;)v++;const E=new Uint8Array(h+(g-v));let w=h;for(;v!==g;)E[w++]=y[v++];return E}function c(l){const d=a(l);if(d)return d;throw new Error("Non-base"+n+" character")}return{encode:o,decodeUnsafe:a,decode:c}}var X0e="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";const Aot=Y0e(X0e);var ki=(function(t){return t.UserTrustStatusChanged="userTrustStatusChanged",t.KeyBackupStatus="crypto.keyBackupStatus",t.KeyBackupFailed="crypto.keyBackupFailed",t.KeyBackupSessionsRemaining="crypto.keyBackupSessionsRemaining",t.KeyBackupDecryptionKeyCached="crypto.keyBackupDecryptionKeyCached",t.VerificationRequestReceived="crypto.verificationRequestReceived",t.WillUpdateDevices="crypto.willUpdateDevices",t.DevicesUpdated="crypto.devicesUpdated",t.KeysChanged="crossSigning.keysChanged",t.LegacyCryptoStoreMigrationProgress="crypto.legacyCryptoStoreMigrationProgress",t.DehydratedDeviceCreated="dehydration.DehydratedDeviceCreated",t.DehydratedDeviceUploaded="dehydration.DehydratedDeviceUploaded",t.RehydrationStarted="dehydration.RehydrationStarted",t.RehydrationProgress="dehydration.RehydrationProgress",t.RehydrationCompleted="dehydration.RehydrationCompleted",t.RehydrationError="dehydration.RehydrationError",t.DehydrationKeyCached="dehydration.DehydrationKeyCached",t.DehydratedDeviceRotationError="dehydration.DehydratedDeviceRotationError",t})({}),J0e=(function(t){return t.MEGOLM_UNKNOWN_INBOUND_SESSION_ID="MEGOLM_UNKNOWN_INBOUND_SESSION_ID",t.MEGOLM_KEY_WITHHELD="MEGOLM_KEY_WITHHELD",t.MEGOLM_KEY_WITHHELD_FOR_UNVERIFIED_DEVICE="MEGOLM_KEY_WITHHELD_FOR_UNVERIFIED_DEVICE",t.OLM_UNKNOWN_MESSAGE_INDEX="OLM_UNKNOWN_MESSAGE_INDEX",t.HISTORICAL_MESSAGE_NO_KEY_BACKUP="HISTORICAL_MESSAGE_NO_KEY_BACKUP",t.HISTORICAL_MESSAGE_BACKUP_UNCONFIGURED="HISTORICAL_MESSAGE_BACKUP_UNCONFIGURED",t.HISTORICAL_MESSAGE_WORKING_BACKUP="HISTORICAL_MESSAGE_WORKING_BACKUP",t.HISTORICAL_MESSAGE_USER_NOT_JOINED="HISTORICAL_MESSAGE_USER_NOT_JOINED",t.SENDER_IDENTITY_PREVIOUSLY_VERIFIED="SENDER_IDENTITY_PREVIOUSLY_VERIFIED",t.UNSIGNED_SENDER_DEVICE="UNSIGNED_SENDER_DEVICE",t.UNKNOWN_SENDER_DEVICE="UNKNOWN_SENDER_DEVICE",t.UNKNOWN_ERROR="UNKNOWN_ERROR",t})({}),Q0e=(function(t){return t[t.AllDevicesIsolationMode=0]="AllDevicesIsolationMode",t[t.OnlySignedDevicesIsolationMode=1]="OnlySignedDevicesIsolationMode",t})({});class Lot{constructor(e){this.errorOnVerifiedUserProblems=e,M(this,"kind",Q0e.AllDevicesIsolationMode)}}class Mot{constructor(e,n,r){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;this.crossSigningVerified=e,this.crossSigningVerifiedBefore=n,this.tofu=r,M(this,"needsUserApproval",void 0),this.needsUserApproval=i}isVerified(){return this.isCrossSigningVerified()}isCrossSigningVerified(){return this.crossSigningVerified}wasCrossSigningVerified(){return this.crossSigningVerifiedBefore}isTofu(){return this.tofu}}class Oot{constructor(e){var n,r,i,s,o;M(this,"signedByOwner",void 0),M(this,"crossSigningVerified",void 0),M(this,"tofu",void 0),M(this,"localVerified",void 0),M(this,"trustCrossSignedDevices",void 0),this.signedByOwner=(n=e.signedByOwner)!==null&&n!==void 0?n:!1,this.crossSigningVerified=(r=e.crossSigningVerified)!==null&&r!==void 0?r:!1,this.tofu=(i=e.tofu)!==null&&i!==void 0?i:!1,this.localVerified=(s=e.localVerified)!==null&&s!==void 0?s:!1,this.trustCrossSignedDevices=(o=e.trustCrossSignedDevices)!==null&&o!==void 0?o:!1}isVerified(){return this.localVerified||this.trustCrossSignedDevices&&this.crossSigningVerified}}var Pot=(function(t){return t.Fetch="fetch",t.LoadKeys="load_keys",t})({}),Dot=(function(t){return t.Master="master",t.SelfSigning="self_signing",t.UserSigning="user_signing",t})({}),Not=(function(t){return t[t.NONE=0]="NONE",t[t.GREY=1]="GREY",t[t.RED=2]="RED",t})({}),Uot=(function(t){return t[t.UNKNOWN=0]="UNKNOWN",t[t.UNVERIFIED_IDENTITY=1]="UNVERIFIED_IDENTITY",t[t.UNSIGNED_DEVICE=2]="UNSIGNED_DEVICE",t[t.UNKNOWN_DEVICE=3]="UNKNOWN_DEVICE",t[t.AUTHENTICITY_NOT_GUARANTEED=4]="AUTHENTICITY_NOT_GUARANTEED",t[t.MISMATCHED_SENDER_KEY=5]="MISMATCHED_SENDER_KEY",t[t.SENT_IN_CLEAR=6]="SENT_IN_CLEAR",t[t.VERIFICATION_VIOLATION=7]="VERIFICATION_VIOLATION",t[t.MISMATCHED_SENDER=8]="MISMATCHED_SENDER",t})({}),Z0e=new Uint8Array(8);function tQ(t,e){return OA.apply(this,arguments)}function OA(){return OA=B(function*(t,e){var n=yield globalThis.crypto.subtle.importKey("raw",t,{name:"HKDF"},!1,["deriveBits"]),r=yield globalThis.crypto.subtle.deriveBits({name:"HKDF",salt:Z0e,info:new TextEncoder().encode(e),hash:"SHA-256"},n,512),i=r.slice(0,32),s=r.slice(32),o=globalThis.crypto.subtle.importKey("raw",i,{name:"AES-CTR"},!1,["encrypt","decrypt"]),a=globalThis.crypto.subtle.importKey("raw",s,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign","verify"]);return Promise.all([o,a])}),OA.apply(this,arguments)}function nQ(t,e,n,r){return PA.apply(this,arguments)}function PA(){return PA=B(function*(t,e,n,r){var i;r?i=gp(r):(i=new Uint8Array(16),globalThis.crypto.getRandomValues(i),i[8]&=127);var[s,o]=yield tQ(e,n),a=new TextEncoder().encode(t),c=yield globalThis.crypto.subtle.encrypt({name:"AES-CTR",counter:i,length:64},s,a),l=yield globalThis.crypto.subtle.sign({name:"HMAC"},o,c);return{iv:H1(i),ciphertext:H1(new Uint8Array(c)),mac:H1(new Uint8Array(l))}}),PA.apply(this,arguments)}function e1e(t,e,n){return DA.apply(this,arguments)}function DA(){return DA=B(function*(t,e,n){var[r,i]=yield tQ(e,n),s=gp(t.ciphertext);if(!(yield globalThis.crypto.subtle.verify({name:"HMAC"},i,gp(t.mac),s)))throw new Error("Error decrypting secret ".concat(n,": bad MAC"));var o=yield globalThis.crypto.subtle.decrypt({name:"AES-CTR",counter:gp(t.iv),length:64},r,s);return new TextDecoder().decode(new Uint8Array(o))}),DA.apply(this,arguments)}var np="m.secret_storage.v1.aes-hmac-sha2";class rQ{constructor(e,n){this.accountDataAdapter=e,this.callbacks=n}getDefaultKeyId(){var e=this;return B(function*(){var n,r=yield e.accountDataAdapter.getAccountDataFromServer("m.secret_storage.default_key");return r&&(n=r.key)!==null&&n!==void 0?n:null})()}setDefaultKeyId(e){return new Promise((n,r)=>{var i=o=>{if(o.getType()==="m.secret_storage.default_key"){var a=o.getContent(),c=e===null?Object.keys(a).length===0:a.key===e;c&&(this.accountDataAdapter.removeListener(Pe.AccountData,i),n())}};this.accountDataAdapter.on(Pe.AccountData,i);var s=e===null?{}:{key:e};this.accountDataAdapter.setAccountData("m.secret_storage.default_key",s).catch(o=>{this.accountDataAdapter.removeListener(Pe.AccountData,i),r(o)})})}addKey(e,n,r){var i=this;return B(function*(){if(e!==np)throw new Error("Unknown key algorithm ".concat(e));var s={algorithm:e};n.name&&(s.name=n.name),n.passphrase&&(s.passphrase=n.passphrase);var{iv:o,mac:a}=yield UA(n.key);if(s.iv=o,s.mac=a,!r)do r=Qo(32);while(yield i.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key.".concat(r)));return yield i.accountDataAdapter.setAccountData("m.secret_storage.key.".concat(r),s),{keyId:r,keyInfo:s}})()}getKey(e){var n=this;return B(function*(){if(e||(e=yield n.getDefaultKeyId()),!e)return null;var r=yield n.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key.".concat(e));return r?[e,r]:null})()}hasKey(e){var n=this;return B(function*(){var r=yield n.getKey(e);return!!r})()}checkKey(e,n){return B(function*(){if(n.algorithm===np)if(n.mac){var{mac:r}=yield UA(e,n.iv);return NA(n.mac)===NA(r)}else return!0;else throw new Error("Unknown algorithm")})()}store(e,n,r){var i=this;return B(function*(){if(n===null){yield i.accountDataAdapter.setAccountData(e,{});return}var s={};if(!r){var o=yield i.getDefaultKeyId();if(!o)throw new Error("No keys specified and no default key present");r=[o]}if(r.length===0)throw new Error("Zero keys given to encrypt with!");for(var a of r){var c=yield i.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key.".concat(a));if(!c)throw new Error("Unknown key: "+a);if(c.algorithm===np){var l={[a]:c},[,d]=yield i.getSecretStorageKey(l,e);s[a]=yield d.encrypt(n)}else N.warn("unknown algorithm for secret storage key "+a+": "+c.algorithm)}yield i.accountDataAdapter.setAccountData(e,{encrypted:s})})()}get(e){var n=this;return B(function*(){var r=yield n.accountDataAdapter.getAccountDataFromServer(e);if(r){if(!r.encrypted)throw new Error("Content is not encrypted!");var i={};for(var s of Object.keys(r.encrypted)){var o=yield n.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key.".concat(s)),a=r.encrypted[s];o?.algorithm===np&&a.iv&&a.ciphertext&&a.mac&&(i[s]=o)}if(Object.keys(i).length===0)throw new Error("Could not decrypt ".concat(e," because none of ")+"the keys it is encrypted with are for a supported algorithm");var[c,l]=yield n.getSecretStorageKey(i,e),d=r.encrypted[c];return l.decrypt(d)}})()}isStored(e){var n=this;return B(function*(){var r=yield n.accountDataAdapter.getAccountDataFromServer(e);if(!(r!=null&&r.encrypted))return null;var i={};for(var s of Object.keys(r.encrypted)){var o=yield n.accountDataAdapter.getAccountDataFromServer("m.secret_storage.key.".concat(s));if(o){var a=r.encrypted[s];o.algorithm===np&&a.iv&&a.ciphertext&&a.mac&&(i[s]=o)}}return Object.keys(i).length?i:null})()}getSecretStorageKey(e,n){var r=this;return B(function*(){if(!r.callbacks.getSecretStorageKey)throw new Error("No getSecretStorageKey callback supplied");var i=yield r.callbacks.getSecretStorageKey({keys:e},n);if(!i)throw new Error("getSecretStorageKey callback returned falsey");if(i.length<2)throw new Error("getSecretStorageKey callback returned invalid data");var[s,o]=i;if(!e[s])throw new Error("App returned unknown key from getSecretStorageKey!");if(e[s].algorithm===np){var a={encrypt:function(l){return nQ(l,o,n)},decrypt:function(l){return e1e(l,o,n)}};return[s,a]}else throw new Error("Unknown key type: "+e[s].algorithm)})()}}function NA(t){for(var e=t.length;e>=1&&t.charCodeAt(e-1)==61;)e--;return e<t.length?t.substring(0,e):t}var t1e="\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0";function UA(t,e){return nQ(t1e,t,"",e)}const n1e=Object.freeze(Object.defineProperty({__proto__:null,SECRET_STORAGE_ALGORITHM_V1_AES:np,ServerSideSecretStorageImpl:rQ,calculateKeyCheck:UA,trimTrailingEquals:NA},Symbol.toStringTag,{value:"Module"}));function fP(t){return jA.apply(this,arguments)}function jA(){return jA=B(function*(t){if(!globalThis.crypto.subtle)throw new Error("Crypto.subtle is not available: insecure context?");var e=new TextEncoder().encode(t),n=yield globalThis.crypto.subtle.digest("SHA-256",e);return new Uint8Array(n)}),jA.apply(this,arguments)}var iQ=1e3*60*60*4,r1e=(t,e,n)=>{var r,i=" - ";if(typeof t.slot_id!="string"?e.push(i+"slot_id must be string"):t.slot_id.split("#").length!==2&&e.push(i+'slot_id must include exactly one "#"'),typeof t.member!="object"||t.member===null?e.push(i+"member must be an object"):(typeof t.member.user_id!="string"?e.push(i+"member.user_id must be string"):KO.test(t.member.user_id)?t.member.user_id!==n&&e.push(i+"member.user_id must match the sender"):e.push(i+"member.user_id must be a valid mxid"),typeof t.member.device_id!="string"&&e.push(i+"member.device_id must be string"),typeof t.member.id!="string"&&e.push(i+"member.id must be string")),typeof t.application!="object"||t.application===null?e.push(i+"application must be an object"):typeof t.application.type!="string"?e.push(i+"application.type must be a string"):t.application.type.includes("#")&&e.push(i+'application.type must not include "#"'),t.rtc_transports===void 0||!Array.isArray(t.rtc_transports))e.push(i+"rtc_transports must be an array");else for(var s of t.rtc_transports)if(typeof s!="object"||s===null||typeof s.type!="string"){e.push(i+"rtc_transports entries must be objects with a string type");break}if(t.versions===void 0||!Array.isArray(t.versions)?e.push(i+"versions must be an array"):t.versions.every(a=>typeof a=="string")||e.push(i+"versions must be an array of strings"),((r=t.sticky_key)!==null&&r!==void 0?r:t.msc4354_sticky_key)===void 0&&e.push(i+"sticky_key or msc4354_sticky_key must be a defined"),t.sticky_key!==void 0&&typeof t.sticky_key!="string"&&e.push(i+"sticky_key must be a string"),t.msc4354_sticky_key!==void 0&&typeof t.msc4354_sticky_key!="string"&&e.push(i+"msc4354_sticky_key must be a string"),t.sticky_key!==void 0&&t.msc4354_sticky_key!==void 0&&t.sticky_key!==t.msc4354_sticky_key&&e.push(i+"sticky_key and msc4354_sticky_key must be equal if both are defined"),t["m.relates_to"]!==void 0){var o=t["m.relates_to"];typeof o!="object"||o===null?e.push(i+"m.relates_to must be an object if provided"):(typeof o.event_id!="string"&&e.push(i+"m.relates_to.event_id must be a string"),o.rel_type!=="m.reference"&&e.push(i+"m.relates_to.rel_type must be m.reference"))}return e.length===0},i1e=(t,e)=>{var n,r=" - ";return typeof t.device_id!="string"&&e.push(r+"device_id must be string"),typeof t.call_id!="string"&&e.push(r+"call_id must be string"),typeof t.application!="string"&&e.push(r+"application must be a string"),typeof((n=t.focus_active)===null||n===void 0?void 0:n.type)!="string"&&e.push(r+"focus_active.type must be a string"),t.focus_active===void 0&&e.push(r+"focus_active has an invalid type"),t.foci_preferred!==void 0&&!(Array.isArray(t.foci_preferred)&&t.foci_preferred.every(i=>typeof i=="object"&&i!==null&&typeof i.type=="string"))&&e.push(r+"foci_preferred must be an array of transport objects"),t.created_ts!==void 0&&typeof t.created_ts!="number"&&e.push(r+"created_ts must be number"),t.scope!==void 0&&typeof t.scope!="string"&&e.push(r+"scope must be string"),t["m.call.intent"]!==void 0&&typeof t["m.call.intent"]!="string"&&e.push(r+"m.call.intent must be a string"),e.length===0};class Af{static equal(e,n){return Ip(e?.membershipData,n?.membershipData)}constructor(e,n,r,i){this.membershipData=n,this.rtcBackendIdentity=r,M(this,"logger",void 0),M(this,"matrixEventData",void 0);var[s,o,a]=[e.getId(),e.getSender(),e.getTs()];if(s===void 0)throw new Error("parentEvent is missing eventId field");if(o===void 0)throw new Error("parentEvent is missing sender field");this.matrixEventData={eventId:s,sender:o,ts:a},this.logger=i?.getChild("[CallMembership ".concat(o,":").concat(this.deviceId,"]"))}static computeRtcBackendIdentity(e,n){return B(function*(){var{kind:r,data:i}=n;switch(r){case"rtc":return Af.computeRtcIdentityRaw(i.member.user_id,i.member.device_id,i.member.id);case"session":return"".concat(e.getSender(),":").concat(i.device_id)}})()}static computeRtcIdentityRaw(e,n,r){return B(function*(){return oP(yield fP("".concat(e,"|").concat(n,"|").concat(r)))})()}static membershipDataFromMatrixEvent(e){var[n,r,i]=[e.getId(),e.getSender(),e.getContent()];if(n===void 0)throw new Error("parentEvent is missing eventId field");if(r===void 0)throw new Error("parentEvent is missing sender field");var s=[],o=[];if(i1e(i,s))return{kind:"session",data:i};if(r1e(i,o,r))return{kind:"rtc",data:i};var a=s.length<o.length?`Does not match MSC4143 m.call.member:
`.concat(s.join(`
`),`

`):`Does not match MSC4143 m.rtc.member:
`.concat(o.join(`
`),`

`),c=`
event:
`+JSON.stringify(i).replaceAll('"',"'");throw Error(`unknown CallMembership data.
`+a+c)}get sender(){return this.userId}get userId(){var{kind:e,data:n}=this.membershipData;return e==="rtc"?n.member.user_id:this.matrixEventData.sender}get eventId(){return this.matrixEventData.eventId}get slotId(){var e,{kind:n,data:r}=this.membershipData;if(r.application==="m.call")switch(n){case"rtc":return r.slot_id;default:{var[i,s]=[this.application,r.call_id],o;if(s===""){var a;o="ROOM",(a=this.logger)===null||a===void 0||a.info("use slotId compat hack emptyString -> ROOM")}else o=s;return Ob({application:i,id:o})}}if((e=this.logger)===null||e===void 0||e.info("NOT using slotId compat hack emptyString -> ROOM"),n==="rtc")return r.slot_id;var[c,l]=[this.application,r.call_id];return Ob({application:c,id:l})}get deviceId(){var{kind:e,data:n}=this.membershipData;return e==="rtc"?n.member.device_id:n.device_id}get callIntent(){var{kind:e,data:n}=this.membershipData;switch(e){case"rtc":{var r,i=n.application["m.call.intent"];if(typeof i=="string")return i;(r=this.logger)===null||r===void 0||r.warn("RTC membership has invalid m.call.intent");return}default:return n["m.call.intent"]}}get slotDescription(){return m1e(this.slotId)}get application(){var{kind:e,data:n}=this.membershipData;return e==="rtc"?n.application.type:n.application}get applicationData(){var{kind:e,data:n}=this.membershipData;return e==="rtc"?n.application:{type:n.application,"m.call.intent":n["m.call.intent"]}}get scope(){var{kind:e,data:n}=this.membershipData;if(e!=="rtc")return n.scope}get membershipID(){return this.memberId}get memberId(){var e,{kind:n,data:r}=this.membershipData;return n==="rtc"?r.member.id:(e=r.membershipID)!==null&&e!==void 0?e:"".concat(this.matrixEventData.sender,":").concat(r.device_id)}createdTs(){var e,{kind:n,data:r}=this.membershipData;return n==="rtc"?this.matrixEventData.ts:(e=r.created_ts)!==null&&e!==void 0?e:this.matrixEventData.ts}getAbsoluteExpiry(){var e,{kind:n,data:r}=this.membershipData;if(n!=="rtc")return this.createdTs()+((e=r.expires)!==null&&e!==void 0?e:iQ)}getMsUntilExpiry(){var{kind:e}=this.membershipData;if(e!=="rtc")return this.getAbsoluteExpiry()-Date.now()}isExpired(){var{kind:e}=this.membershipData;return e==="rtc"?!1:this.getMsUntilExpiry()<=0}getTransport(e){var{kind:n,data:r}=this.membershipData;switch(n){case"rtc":return r.rtc_transports[0];case"session":switch(r.focus_active.focus_selection){case"multi_sfu":return r.foci_preferred[0];case"oldest_membership":if(Af.equal(this,e))return r.foci_preferred[0];if(e!==void 0)return e.getTransport(e);break}}}getFocusActive(){var{kind:e,data:n}=this.membershipData;if(e==="session")return n.focus_active}get transports(){var{kind:e,data:n}=this.membershipData;return e==="rtc"?n.rtc_transports:n.foci_preferred}get kind(){return this.membershipData.kind}}var _c=(function(t){return t.Disconnected="Disconnected",t.Connecting="Connecting",t.Connected="Connected",t.Disconnecting="Disconnecting",t.Unknown="Unknown",t})({}),hE=(t,e,n)=>t.sender===e&&t.deviceId===n;class s1e{constructor(e,n){this.membershipLoopHandler=e,M(this,"logger",void 0),M(this,"running",!1),M(this,"wakeup",r=>{this.logger.error("Cannot call wakeup before calling `startWithJoin()`")}),M(this,"_actions",[]),this.logger=(n??N).getChild("[NewMembershipActionScheduler]")}get actions(){return this._actions}startWithJoin(){var e=this;return B(function*(){if(e.running){e.logger.error("Cannot call startWithJoin() on NewMembershipActionScheduler while already running");return}e.running=!0,e._actions=[{ts:Date.now(),type:dt.SendDelayedEvent}];try{for(var n=function*(){e._actions.sort((l,d)=>l.ts-d.ts);var i=e._actions[0],s=void 0,o=new Promise(l=>{e.wakeup=d=>{s=d,l()}});i.ts>Date.now()&&(yield Promise.race([o,Yp(i.ts-Date.now())]));var a={};if(!s){e.logger.debug("Current MembershipManager processing: ".concat(i.type,`
Queue:`),e._actions,`
Date.now: "`.concat(Date.now()));try{a=yield e.membershipLoopHandler(i.type)}catch(l){throw Error("The MembershipManager shut down because of the end condition: ".concat(l))}}e._actions.splice(0,1);var c=s??a;"replace"in c?e._actions=c.replace:"insert"in c&&e._actions.push(...c.insert)};e._actions.length>0;)yield*n()}finally{e.running=!1}e.logger.debug("Leave MembershipManager ActionScheduler loop (no more actions)")})()}initiateJoin(){var e;(e=this.wakeup)===null||e===void 0||e.call(this,{replace:[{ts:Date.now(),type:dt.SendDelayedEvent}]})}initiateLeave(){var e;(e=this.wakeup)===null||e===void 0||e.call(this,{replace:[{ts:Date.now(),type:dt.SendScheduledDelayedLeaveEvent}]})}}var hP=(function(t){return t.TooNew="TOO_NEW",t})({});class pP extends Error{constructor(e){var n="Crypto store is invalid because ".concat(e,", ")+"please stop the client, delete all data and start the client again";super(n),this.reason=e,this.name="InvalidCryptoStoreError"}}M(pP,"TOO_NEW",hP.TooNew);class o1e extends Error{constructor(e,n){super(e),this.value=n}}class a1e extends Error{constructor(){super("MatrixClient has been stopped")}}class Wo extends Error{constructor(e,n){super(e),this.clientEndpoint=n,this.name="UnsupportedDelayedEventsEndpointError"}}class FA extends Error{constructor(e,n){super(e),this.clientEndpoint=n,this.name="UnsupportedStickyEventsEndpointError"}}var _l=(function(t){return t.StatusChanged="StatusChanged",t.ProbablyLeft="ProbablyLeft",t.DelayIdChanged="DelayIdChanged",t})({}),TT=t=>t.type==="livekit"&&"livekit_service_url"in t;function kB(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function Ng(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?kB(Object(n),!0).forEach(function(r){M(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):kB(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var $A=3600*1e3,dt=(function(t){return t.SendDelayedEvent="SendDelayedEvent",t.SendJoinEvent="SendJoinEvent",t.RestartDelayedEvent="RestartDelayedEvent",t.UpdateExpiry="UpdateExpiry",t.SendScheduledDelayedLeaveEvent="SendScheduledDelayedLeaveEvent",t.SendLeaveEvent="SendLeaveEvent",t})({});function _a(t,e){return{insert:[{ts:Date.now()+(e??0),type:t}]}}function ix(t,e){return{replace:[{ts:Date.now()+0,type:t}]}}class Mb extends Gn{isActivated(){return this.activated}isJoined(){return this.isActivated()}join(e,n,r){if(this.scheduler.running){this.logger.error("MembershipManager is already running. Ignoring join request.");return}this.fociPreferred=e,this.rtcTransport=n,this.leavePromiseResolvers=void 0,this.activated=!0,this.oldStatus=this.status,this.state=Mb.defaultState,this.scheduler.startWithJoin().catch(i=>{this.logger.error("MembershipManager stopped because: ",i),r?.(i)}).finally(()=>{if(this.activated=!1,this.oldStatus&&this.oldStatus!==this.status&&this.emit(_l.StatusChanged,this.oldStatus,this.status),!this.scheduler.running){var i;(i=this.leavePromiseResolvers)===null||i===void 0||i.resolve(!0),this.leavePromiseResolvers=void 0}})}leave(e){return this.scheduler.running?(this.leavePromiseResolvers||(this.leavePromiseResolvers=Promise.withResolvers(),this.activated=!1,this.scheduler.initiateLeave(),e&&setTimeout(()=>{var n;return(n=this.leavePromiseResolvers)===null||n===void 0?void 0:n.resolve(!1)},e)),this.leavePromiseResolvers.promise):(this.logger.warn("Called MembershipManager.leave() even though the MembershipManager is not running"),Promise.resolve(!0))}onRTCSessionMemberUpdate(e){if(!this.isActivated())return Promise.resolve();if(this._ownMembership=e.find(r=>hE(r,this.userId,this.deviceId)),!this._ownMembership){var n=[dt.SendDelayedEvent,dt.SendJoinEvent];this.logger.warn("Missing own membership: force re-join"),this.state.hasMemberStateEvent=!1,this.scheduler.actions.some(r=>n.includes(r.type))?this.logger.error("tried adding another `SendDelayedEvent` actions even though we already have one in the Queue\nActionQueueOnMemberUpdate:",this.scheduler.actions):this.scheduler.initiateJoin()}return Promise.resolve()}updateCallIntent(e){var n=this;return B(function*(){if(!n.activated||!n.ownMembership)throw Error("You cannot update your intent before joining the call");n.ownMembership.callIntent!==e&&(n.callIntent=e,yield n.sendJoinEvent())})()}constructor(e,n,r,i,s){super(),this.joinConfig=e,this.room=n,this.client=r,this.slotDescription=i,M(this,"activated",!1),M(this,"logger",void 0),M(this,"callIntent",void 0),M(this,"leavePromiseResolvers",void 0),M(this,"_ownMembership",void 0),M(this,"oldStatus",void 0),M(this,"scheduler",void 0),M(this,"state",void 0),M(this,"deviceId",void 0),M(this,"userId",void 0),M(this,"stateKey",void 0),M(this,"rtcTransport",void 0),M(this,"fociPreferred",void 0),M(this,"delayedLeaveEventDelayMsOverride",void 0),M(this,"clientSendDelayedDisconnectMembership",()=>this.client._unstable_sendDelayedStateEvent(this.room.roomId,{delay:this.delayedLeaveEventDelayMs},ee.GroupCallMemberPrefix,{},this.stateKey)),M(this,"clientSendMembership",c=>this.client.sendStateEvent(this.room.roomId,ee.GroupCallMemberPrefix,c,this.stateKey)),this.logger=(s??N).getChild("[MembershipManager]");var[o,a]=[this.client.getUserId(),this.client.getDeviceId()];if(o===null)throw Error("Missing userId in client");if(a===null)throw Error("Missing deviceId in client");this.deviceId=a,this.userId=o,this.stateKey=this.makeMembershipStateKey(o,a),this.state=Mb.defaultState,this.callIntent=e?.callIntent,this.scheduler=new s1e(c=>(this.oldStatus&&(this.logger.debug("MembershipManager applied action changes. Status: ".concat(this.oldStatus," -> ").concat(this.status)),this.oldStatus!==this.status&&this.emit(_l.StatusChanged,this.oldStatus,this.status)),this.oldStatus=this.status,this.logger.debug("MembershipManager before processing action. status=".concat(this.oldStatus)),this.membershipLoopHandler(c)),this.logger)}get ownMembership(){return this._ownMembership}static get defaultState(){return{hasMemberStateEvent:!1,delayId:void 0,startTime:0,rateLimitRetries:new Map,networkErrorRetries:new Map,expireUpdateIterations:1,probablyLeft:!1}}get networkErrorRetryMs(){var e,n;return(e=(n=this.joinConfig)===null||n===void 0?void 0:n.networkErrorRetryMs)!==null&&e!==void 0?e:3e3}get membershipEventExpiryMs(){var e,n;return(e=(n=this.joinConfig)===null||n===void 0?void 0:n.membershipEventExpiryMs)!==null&&e!==void 0?e:iQ}get membershipEventExpiryHeadroomMs(){var e,n;return(e=(n=this.joinConfig)===null||n===void 0?void 0:n.membershipEventExpiryHeadroomMs)!==null&&e!==void 0?e:5e3}computeNextExpiryActionTs(e){return this.state.startTime+Math.min(this.membershipEventExpiryMs,$A)*e-this.membershipEventExpiryHeadroomMs}get delayedLeaveEventDelayMs(){var e,n,r;return(e=(n=this.delayedLeaveEventDelayMsOverride)!==null&&n!==void 0?n:(r=this.joinConfig)===null||r===void 0?void 0:r.delayedLeaveEventDelayMs)!==null&&e!==void 0?e:8e3}get delayedLeaveEventRestartMs(){var e,n;return(e=(n=this.joinConfig)===null||n===void 0?void 0:n.delayedLeaveEventRestartMs)!==null&&e!==void 0?e:5e3}get maximumRateLimitRetryCount(){var e,n;return(e=(n=this.joinConfig)===null||n===void 0?void 0:n.maximumRateLimitRetryCount)!==null&&e!==void 0?e:10}get maximumNetworkErrorRetryCount(){var e,n;return(e=(n=this.joinConfig)===null||n===void 0?void 0:n.maximumNetworkErrorRetryCount)!==null&&e!==void 0?e:10}get delayedLeaveEventRestartLocalTimeoutMs(){var e,n;return(e=(n=this.joinConfig)===null||n===void 0?void 0:n.delayedLeaveEventRestartLocalTimeoutMs)!==null&&e!==void 0?e:2e3}membershipLoopHandler(e){var n=this;return B(function*(){switch(e){case dt.SendDelayedEvent:return n.state.delayId?n.cancelKnownDelayIdBeforeSendDelayedEvent(n.state.delayId):n.sendOrResendDelayedLeaveEvent();case dt.RestartDelayedEvent:return n.state.delayId?n.restartDelayedEvent(n.state.delayId):_a(dt.SendDelayedEvent);case dt.SendScheduledDelayedLeaveEvent:return n.state.hasMemberStateEvent?n.state.delayId?n.sendScheduledDelayedLeaveEventOrFallbackToSendLeaveEvent(n.state.delayId):_a(dt.SendLeaveEvent):{replace:[]};case dt.SendJoinEvent:return n.sendJoinEvent();case dt.UpdateExpiry:return n.updateExpiryOnJoinedEvent();case dt.SendLeaveEvent:return n.state.hasMemberStateEvent?n.sendFallbackLeaveEvent():{replace:[]}}})()}sendOrResendDelayedLeaveEvent(){var e=this;return B(function*(){return yield e.clientSendDelayedDisconnectMembership().then(n=>(e.state.expectedServerDelayLeaveTs=Date.now()+e.delayedLeaveEventDelayMs,e.setAndEmitProbablyLeft(!1),e.resetRateLimitCounter(dt.SendDelayedEvent),e.setAndEmitDelayId(n.delay_id),e.state.hasMemberStateEvent?_a(dt.RestartDelayedEvent,e.delayedLeaveEventRestartMs):_a(dt.SendJoinEvent))).catch(n=>{var r=dt.SendDelayedEvent;if(e.manageMaxDelayExceededSituation(n))return _a(r);var i=e.actionUpdateFromErrors(n,r,"_unstable_sendDelayedStateEvent");if(i)return i;if(e.state.hasMemberStateEvent){if(e.isUnsupportedDelayedEndpoint(n))return{};throw Error("Could not send delayed event, even though delayed events are supported. "+n)}else return e.isUnsupportedDelayedEndpoint(n)?e.logger.info("Not using delayed event because the endpoint is not supported"):e.logger.info("Not using delayed event because: "+n),_a(dt.SendJoinEvent)})})()}cancelKnownDelayIdBeforeSendDelayedEvent(e){var n=this;return B(function*(){return yield n.client._unstable_cancelScheduledDelayedEvent(e).then(()=>(n.setAndEmitDelayId(void 0),n.resetRateLimitCounter(dt.SendDelayedEvent),ix(dt.SendDelayedEvent))).catch(r=>{var i=dt.SendDelayedEvent,s=n.actionUpdateFromErrors(r,i,"cancelScheduledDelayedEvent");if(s)return s;if(n.isNotFoundError(r))return n.setAndEmitDelayId(void 0),ix(i);if(n.isUnsupportedDelayedEndpoint(r))return ix(dt.SendJoinEvent);throw Error("We failed to cancel a delayed event where we already had a delay id with an error we cannot automatically handle")})})()}setAndEmitProbablyLeft(e){this.state.probablyLeft!==e&&(this.state.probablyLeft=e,this.emit(_l.ProbablyLeft,this.state.probablyLeft))}setAndEmitDelayId(e){this.state.delayId!==e&&(this.state.delayId=e,this.emit(_l.DelayIdChanged,this.state.delayId))}restartDelayedEvent(e){var n=this;return B(function*(){var r=n.state.expectedServerDelayLeaveTs?n.state.expectedServerDelayLeaveTs-Date.now():void 0,i=new Promise((s,o)=>{setTimeout(()=>{o(new qX("Restart delayed event timed out before the HS responded"))},r!==void 0&&!n.state.probablyLeft?Math.min(n.delayedLeaveEventRestartLocalTimeoutMs,r):n.delayedLeaveEventRestartLocalTimeoutMs)});return yield Promise.race([n.client._unstable_restartScheduledDelayedEvent(e),i]).then(()=>(n.state.expectedServerDelayLeaveTs=Date.now()+n.delayedLeaveEventDelayMs,n.resetRateLimitCounter(dt.RestartDelayedEvent),n.setAndEmitProbablyLeft(!1),_a(dt.RestartDelayedEvent,n.delayedLeaveEventRestartMs))).catch(s=>{n.state.expectedServerDelayLeaveTs&&n.state.expectedServerDelayLeaveTs<=Date.now()&&n.setAndEmitProbablyLeft(!0);var o=dt.RestartDelayedEvent;if(n.isNotFoundError(s))return n.setAndEmitDelayId(void 0),_a(dt.SendDelayedEvent);if(n.isUnsupportedDelayedEndpoint(s))return{};var a=n.actionUpdateFromErrors(s,o,"restartScheduledDelayedEvent");if(a)return a;throw Error("Could not restart delayed event, even though delayed events are supported. "+s)})})()}sendScheduledDelayedLeaveEventOrFallbackToSendLeaveEvent(e){var n=this;return B(function*(){return yield n.client._unstable_sendScheduledDelayedEvent(e).then(()=>(n.state.hasMemberStateEvent=!1,n.setAndEmitDelayId(void 0),n.resetRateLimitCounter(dt.SendScheduledDelayedLeaveEvent),{replace:[]})).catch(r=>{var i=dt.SendLeaveEvent;if(n.isUnsupportedDelayedEndpoint(r))return{};if(n.isNotFoundError(r))return n.setAndEmitDelayId(void 0),_a(i);var s=n.actionUpdateFromErrors(r,i,"sendScheduledDelayedEvent");return s||(n.logger.warn("Encountered unexpected error during SendScheduledDelayedLeaveEvent. Falling back to SendLeaveEvent",r),_a(i))})})()}sendJoinEvent(){var e=this;return B(function*(){return yield e.clientSendMembership(e.makeMyMembership(e.membershipEventExpiryMs)).then(()=>{e.setAndEmitProbablyLeft(!1),e.state.startTime=Date.now(),e.state.expireUpdateIterations=1,e.state.hasMemberStateEvent=!0,e.resetRateLimitCounter(dt.SendJoinEvent);var n=e.scheduler.actions.filter(r=>r.type!==dt.UpdateExpiry&&r.type!==dt.SendJoinEvent);return{replace:[...n,{ts:Date.now(),type:dt.RestartDelayedEvent},{ts:e.computeNextExpiryActionTs(e.state.expireUpdateIterations),type:dt.UpdateExpiry}]}}).catch(n=>{var r=e.actionUpdateFromErrors(n,dt.SendJoinEvent,"sendStateEvent");if(r)return r;throw n})})()}updateExpiryOnJoinedEvent(){var e=this;return B(function*(){var n=e.state.expireUpdateIterations+1;return yield e.clientSendMembership(e.makeMyMembership(e.membershipEventExpiryMs*n)).then(()=>(e.resetRateLimitCounter(dt.UpdateExpiry),e.state.expireUpdateIterations=n,{insert:[{ts:e.computeNextExpiryActionTs(n),type:dt.UpdateExpiry}]})).catch(r=>{var i=e.actionUpdateFromErrors(r,dt.UpdateExpiry,"sendStateEvent");if(i)return i;throw r})})()}sendFallbackLeaveEvent(){var e=this;return B(function*(){return yield e.clientSendMembership({}).then(()=>(e.resetRateLimitCounter(dt.SendLeaveEvent),e.state.hasMemberStateEvent=!1,{replace:[]})).catch(n=>{var r=e.actionUpdateFromErrors(n,dt.SendLeaveEvent,"sendStateEvent");if(r)return r;throw n})})()}makeMembershipStateKey(e,n){var r=this.slotDescription.application,i=r==="m.call"&&this.slotDescription.id==="ROOM",s=i?"":this.slotDescription.id,o="".concat(e,"_").concat(n,"_").concat(r).concat(s);return/^org\.matrix\.msc(3757|3779)\b/.exec(this.room.getVersion())?o:"_".concat(o)}makeMyMembership(e){var n,r,i=this.ownMembership,s=this.slotDescription.application==="m.call"&&this.slotDescription.id==="ROOM",o=this.rtcTransport===void 0?{focus_active:{type:"livekit",focus_selection:"oldest_membership"},foci_preferred:(n=this.fociPreferred)!==null&&n!==void 0?n:[]}:{focus_active:{type:"livekit",focus_selection:"multi_sfu"},foci_preferred:[this.rtcTransport,...(r=this.fociPreferred)!==null&&r!==void 0?r:[]]};return Ng(Ng({application:this.slotDescription.application,call_id:s?"":this.slotDescription.id,scope:"m.room",device_id:this.deviceId,membershipID:"".concat(this.userId,":").concat(this.deviceId),expires:e,"m.call.intent":this.callIntent},o),i!==void 0?{created_ts:i.createdTs()}:void 0)}isNotFoundError(e){return e instanceof In&&e.errcode==="M_NOT_FOUND"}manageMaxDelayExceededSituation(e){if(e instanceof In&&e.errcode==="M_UNKNOWN"&&e.data["org.matrix.msc4140.errcode"]==="M_MAX_DELAY_EXCEEDED"){var n=e.data["org.matrix.msc4140.max_delay"];return typeof n=="number"&&this.delayedLeaveEventDelayMs>n&&(this.delayedLeaveEventDelayMsOverride=n),this.logger.warn("Retry sending delayed disconnection event due to server timeout limitations:",e),!0}return!1}actionUpdateFromErrors(e,n,r){var i=this.actionUpdateFromRateLimitError(e,r,n);if(i)return i;var s=this.actionUpdateFromNetworkErrorRetry(e,n);if(s)return s}actionUpdateFromRateLimitError(e,n,r){var i;if((e instanceof xp||e instanceof In)&&e.isRateLimitError()){var s=(i=this.state.rateLimitRetries.get(r))!==null&&i!==void 0?i:0;if(s<this.maximumRateLimitRetryCount){var o,a=5e3;try{var c;o=(c=e.getRetryAfterMs())!==null&&c!==void 0?c:a,this.logger.info("Rate limited by server, retrying in ".concat(o,"ms"))}catch(l){this.logger.warn("Error while retrieving a rate-limit retry delay, retrying after default delay of ".concat(a),l),o=a}return this.state.rateLimitRetries.set(r,s+1),_a(r,o)}throw Error("Exceeded maximum retries for "+r+" attempts (client."+n+")",{cause:e})}}actionUpdateFromNetworkErrorRetry(e,n){var r,i=(r=this.state.networkErrorRetries.get(n))!==null&&r!==void 0?r:0,s=this.networkErrorRetryMs/1e3+"s",o="("+i+"/"+this.maximumNetworkErrorRetryCount+")",a=this.networkErrorRetryMs;if(e instanceof Error&&e.name==="AbortError")a=0,this.logger.warn("Network local timeout error while sending event, immediate retry ("+o+")",e);else if(e instanceof Error&&e.message.includes("updating delayed event"))this.logger.warn("delayed event update timeout error, retrying in "+s+" "+o,e);else if(e instanceof Qp)this.logger.warn("Network connection error while sending event, retrying in "+s+" "+o,e);else if((e instanceof xp||e instanceof In)&&typeof e.httpStatus=="number"&&e.httpStatus>=500&&e.httpStatus<600)this.logger.warn("Server error while sending event, retrying in "+s+" "+o,e);else return;if(i<this.maximumNetworkErrorRetryCount)return this.state.networkErrorRetries.set(n,i+1),_a(n,a);throw Error("Reached maximum ("+this.maximumNetworkErrorRetryCount+") retries cause by: "+e)}isUnsupportedDelayedEndpoint(e){return e instanceof Wo}resetRateLimitCounter(e){this.state.rateLimitRetries.set(e,0),this.state.networkErrorRetries.set(e,0)}get status(){var e=this.scheduler.actions;if(e.length===1){var{type:n}=e[0];switch(n){case dt.SendDelayedEvent:case dt.SendJoinEvent:return _c.Connecting;case dt.UpdateExpiry:return _c.Connected;case dt.SendScheduledDelayedLeaveEvent:case dt.SendLeaveEvent:return _c.Disconnecting}}else if(e.length===2){var r=e.map(s=>s.type);if((r.includes(dt.RestartDelayedEvent)||r.includes(dt.SendDelayedEvent)&&this.state.hasMemberStateEvent)&&r.includes(dt.UpdateExpiry))return _c.Connected}else if(e.length===3){var i=e.map(s=>s.type);if(i.filter(s=>s===dt.RestartDelayedEvent).length===2&&i.includes(dt.UpdateExpiry))return _c.Connected}return this.scheduler.running?(this.logger.error("MembershipManager has an unknown state. Actions: ",e),_c.Unknown):_c.Disconnected}get probablyLeft(){return this.state.probablyLeft}get delayId(){return this.state.delayId}}class RT extends Mb{constructor(e,n,r,i,s,o){super(e,n,r,i,o),this.clientWithSticky=r,this.memberId=s,M(this,"clientSendDelayedDisconnectMembership",()=>this.clientWithSticky._unstable_sendStickyDelayedEvent(this.room.roomId,$A,{delay:this.delayedLeaveEventDelayMs},null,ee.RTCMembership,{msc4354_sticky_key:this.memberId})),M(this,"clientSendMembership",a=>this.clientWithSticky._unstable_sendStickyEvent(this.room.roomId,$A,null,ee.RTCMembership,Ng(Ng({},a),{},{msc4354_sticky_key:this.memberId})))}actionUpdateFromErrors(e,n,r){var i;return super.actionUpdateFromErrors(e,n,(i=RT.nameMap.get(r))!==null&&i!==void 0?i:"unknown")}makeMyMembership(e){var n=this.ownMembership,r=TT(this.rtcTransport)?this.rtcTransport:void 0,i=n!=null&&n.eventId?{"m.relation":{rel_type:vn.Reference,event_id:n?.eventId}}:{};return Ng({application:Ng({type:this.slotDescription.application},this.callIntent?{"m.call.intent":this.callIntent}:{}),slot_id:Ob(this.slotDescription),rtc_transports:r?[{type:r.type,livekit_service_url:r.livekit_service_url}]:[],member:{device_id:this.deviceId,user_id:this.userId,id:this.memberId},versions:[]},i)}}M(RT,"nameMap",new Map([["sendStateEvent","_unstable_sendStickyEvent"],["sendDelayedStateEvent","_unstable_sendStickyDelayedEvent"]]));var xv=(function(t){return t.ReceivedKeys="received_keys",t.NotSupportedError="not_supported_error",t})({});function uf(t){return"".concat(t.userId,":").concat(t.deviceId,"(").concat(t.memberId,")")}class c1e{get updateEncryptionKeyThrottle(){var e,n;return(e=(n=this.joinConfig)===null||n===void 0?void 0:n.updateEncryptionKeyThrottle)!==null&&e!==void 0?e:3e3}get makeKeyDelay(){var e,n;return(e=(n=this.joinConfig)===null||n===void 0?void 0:n.makeKeyDelay)!==null&&e!==void 0?e:3e3}get useKeyDelay(){var e,n;return(e=(n=this.joinConfig)===null||n===void 0?void 0:n.useKeyDelay)!==null&&e!==void 0?e:5e3}constructor(e,n,r,i,s,o){var a=this;this.membership=e,this.getMemberships=n,this.transport=r,this.statistics=i,this.onEncryptionKeysChanged=s,M(this,"manageMediaKeys",!1),M(this,"keysEventUpdateTimeout",void 0),M(this,"makeNewKeyTimeout",void 0),M(this,"setNewKeyTimeouts",new Set),M(this,"encryptionKeys",new Map),M(this,"lastEncryptionKeyUpdateRequest",void 0),M(this,"lastMembershipFingerprints",void 0),M(this,"latestGeneratedKeyIndex",-1),M(this,"joinConfig",void 0),M(this,"logger",void 0),M(this,"joined",!1),M(this,"sendEncryptionKeysEvent",(function(){var c=B(function*(l){if(a.keysEventUpdateTimeout!==void 0&&(clearTimeout(a.keysEventUpdateTimeout),a.keysEventUpdateTimeout=void 0),a.lastEncryptionKeyUpdateRequest=Date.now(),!!a.joined){var d=a.getKeysForParticipant(a.membership);if(!d){a.logger.warn("Tried to send encryption keys event but no keys found!");return}if(typeof l!="number"&&a.latestGeneratedKeyIndex===-1){a.logger.warn("Tried to send encryption keys event but no current key index found!");return}var h=l??a.latestGeneratedKeyIndex;a.logger.info("Try sending encryption keys event. keyIndexToSend=".concat(h," (method parameter: ").concat(l,")"));var m=d[h];try{a.statistics.counters.roomEventEncryptionKeysSent+=1;var g=a.getMemberships().filter(v=>v.sender!=null).map(v=>({userId:v.sender,deviceId:v.deviceId,membershipTs:v.createdTs()}));yield a.transport.sendKey(oP(m),h,g),a.logger.debug("sendEncryptionKeysEvent participantId=".concat(a.membership.userId,":").concat(a.membership.deviceId," numKeys=").concat(d.length," currentKeyIndex=").concat(a.latestGeneratedKeyIndex," keyIndexToSend=").concat(h))}catch(v){if(a.keysEventUpdateTimeout===void 0){var y=ZO(v,5e3);a.logger.warn("Failed to send m.call.encryption_key, retrying in ".concat(y),v),a.keysEventUpdateTimeout=setTimeout(()=>{a.sendEncryptionKeysEvent()},y)}else a.logger.info("Not scheduling key resend as another re-send is already pending")}}});return function(l){return c.apply(this,arguments)}})()),M(this,"onNewKeyReceived",(c,l,d,h)=>{this.logger.debug("Received key over key transport ".concat(c.userId,":").concat(c.deviceId," at index ").concat(d)),this.setEncryptionKey(c,d,l,h)}),M(this,"onRotateKeyTimeout",()=>{if(this.manageMediaKeys){this.makeNewKeyTimeout=void 0,this.logger.info("Making new sender key for key rotation");var c=this.makeNewSenderKey(!0);this.sendEncryptionKeysEvent(c)}}),this.logger=(o??N).getChild("[EncryptionManager]")}rtcBackendIdentityFromMembershipParts(e){return"".concat(e.userId,":").concat(e.deviceId)}getEncryptionKeys(){var e=new Map;for(var[n,r]of this.encryptionKeys){var i=r.map((s,o)=>({key:s.key,membership:s.membership,keyIndex:o,rtcBackendIdentity:this.rtcBackendIdentityFromMembershipParts(s.membership)}));e.set(n,i)}return e}join(e){var n,r,i;this.joinConfig=e,this.joined=!0,this.manageMediaKeys=(n=(r=this.joinConfig)===null||r===void 0?void 0:r.manageMediaKeys)!==null&&n!==void 0?n:this.manageMediaKeys,this.transport.on(xv.ReceivedKeys,this.onNewKeyReceived),this.transport.start(),(i=this.joinConfig)!==null&&i!==void 0&&i.manageMediaKeys&&(this.makeNewSenderKey(),this.requestSendCurrentKey())}leave(){this.encryptionKeys.set(uf(this.membership),[]),this.transport.off(xv.ReceivedKeys,this.onNewKeyReceived),this.transport.stop(),this.makeNewKeyTimeout!==void 0&&(clearTimeout(this.makeNewKeyTimeout),this.makeNewKeyTimeout=void 0);for(var e of this.setNewKeyTimeouts)clearTimeout(e);this.setNewKeyTimeouts.clear(),this.manageMediaKeys=!1,this.joined=!1}onMembershipsUpdate(e){if(this.manageMediaKeys&&this.joined){var n=new Set(e.filter(l=>!hE(l,this.membership.userId,this.membership.deviceId)).map(uf)),r=new Set(this.getMemberships().filter(l=>!hE(l,this.membership.userId,this.membership.deviceId)).map(uf)),i=Array.from(n).some(l=>!r.has(l)),s=Array.from(r).some(l=>!n.has(l)),o=this.lastMembershipFingerprints;if(this.storeLastMembershipFingerprints(),i)this.makeNewKeyTimeout||(this.logger.debug("Member(s) have left: queueing sender key rotation"),this.makeNewKeyTimeout=setTimeout(this.onRotateKeyTimeout,this.makeKeyDelay));else if(s)this.logger.debug("New member(s) have joined: re-sending keys"),this.requestSendCurrentKey();else if(o){var a=this.lastMembershipFingerprints,c=Array.from(o).some(l=>!a.has(l))||Array.from(a).some(l=>!o.has(l));c&&(this.logger.debug("Member(s) have updated/reconnected: re-sending keys to everyone"),this.requestSendCurrentKey())}}}makeNewSenderKey(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n=zJ(16),r=this.getNewEncryptionKeyIndex();return this.logger.info("Generated new key at index "+r),this.setEncryptionKey(this.membership,r,n,Date.now(),e),r}requestSendCurrentKey(){if(this.manageMediaKeys){if(this.lastEncryptionKeyUpdateRequest&&this.lastEncryptionKeyUpdateRequest+this.updateEncryptionKeyThrottle>Date.now()){this.logger.info("Last encryption key event sent too recently: postponing"),this.keysEventUpdateTimeout===void 0&&(this.keysEventUpdateTimeout=setTimeout(()=>{this.sendEncryptionKeysEvent()},this.updateEncryptionKeyThrottle));return}this.sendEncryptionKeysEvent()}}getKeysForParticipant(e){var n;return(n=this.encryptionKeys.get(uf(e)))===null||n===void 0?void 0:n.map(r=>r.key)}storeLastMembershipFingerprints(){this.lastMembershipFingerprints=new Set(this.getMemberships().filter(e=>!hE(e,this.membership.userId,this.membership.deviceId)).map(e=>"".concat(uf(e),":").concat(e.createdTs())))}getNewEncryptionKeyIndex(){return this.latestGeneratedKeyIndex===-1?0:(this.latestGeneratedKeyIndex+1)%256}setEncryptionKey(e,n,r,i){var s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;this.logger.debug("Setting encryption key for ".concat(e.userId,":").concat(e.deviceId," at index ").concat(n));var o=gp(r),a=uf(e);this.encryptionKeys.has(a)||this.encryptionKeys.set(a,[]);var c=this.encryptionKeys.get(a),l=c[n];if(l){if(l.timestamp>i){this.logger.info("Ignoring new key at index ".concat(n," for ").concat(a," as it is older than existing known key"));return}if(l1e(l.key,o)){l.timestamp=i;return}}if(e.userId===this.membership.userId&&e.deviceId===this.membership.deviceId&&(this.latestGeneratedKeyIndex=n),c[n]={key:o,timestamp:i,membership:e},s){var d=setTimeout(()=>{this.setNewKeyTimeouts.delete(d),this.logger.info("Delayed-emitting key changed event for ".concat(a," index ").concat(n)),this.onEncryptionKeysChanged(o,n,e,this.rtcBackendIdentityFromMembershipParts(e))},this.useKeyDelay);this.setNewKeyTimeouts.add(d)}else this.onEncryptionKeysChanged(o,n,e,this.rtcBackendIdentityFromMembershipParts(e))}}function l1e(t,e){return t===e?!0:!!t&&!!e&&t.length===e.length&&t.every((n,r)=>n===e[r])}class u1e{constructor(){M(this,"tsBuffer",new Map)}isOutdated(e,n){var r,i=uf(e);this.tsBuffer.has(i)||this.tsBuffer.set(i,new Map);var s=(r=this.tsBuffer.get(i))===null||r===void 0?void 0:r.get(n.keyIndex);return s&&s>n.creationTS?!0:(this.tsBuffer.get(i).set(n.keyIndex,n.creationTS),!1)}}class d1e{constructor(e,n,r,i,s,o,a){this.ownMembership=e,this.getMemberships=n,this.transport=r,this.statistics=i,this.onEncryptionKeysChanged=s,M(this,"manageMediaKeys",!1),M(this,"useHashedRtcBackendIdentity",!1),M(this,"ownRtcBackendIdentityCache",void 0),M(this,"participantKeyRings",new Map),M(this,"outboundSession",null),M(this,"currentKeyDistributionPromise",null),M(this,"useKeyDelay",5e3),M(this,"keyRotationGracePeriodMs",1e4),M(this,"needToEnsureKeyAgain",!1),M(this,"keyBuffer",new u1e),M(this,"logger",void 0),M(this,"rtcIdentityProvider",void 0),M(this,"keysWithoutMatchingRTCMembership",[]),M(this,"onNewKeyReceived",(c,l,d,h)=>{var m;if(!this.manageMediaKeys){var g;(g=this.logger)===null||g===void 0||g.warn("Received key over transport ".concat(c.userId,":").concat(c.deviceId," at index ").concat(d," but media keys are disabled"));return}(m=this.logger)===null||m===void 0||m.debug("Received key over transport ".concat(c.userId,":").concat(c.deviceId," at index ").concat(d));var y=gp(l),v={key:y,membership:c,keyIndex:d,creationTS:h},E=this.keyBuffer.isOutdated(c,v);if(!E)this.addKeyToParticipant(v.key,v.keyIndex,v.membership),this.statistics.counters.roomEventEncryptionKeysReceived+=1;else{var w;(w=this.logger)===null||w===void 0||w.info("Received an out of order key for ".concat(c.userId,":").concat(c.deviceId,", dropping it"))}}),this.logger=o?.getChild("[EncryptionManager]"),this.rtcIdentityProvider=a??Af.computeRtcIdentityRaw}getOwnRtcBackendIdentity(){var e=this;return B(function*(){if(e.ownRtcBackendIdentityCache)return e.ownRtcBackendIdentityCache;if(e.useHashedRtcBackendIdentity){var n,{userId:r,deviceId:i,memberId:s}=e.ownMembership;(n=e.logger)===null||n===void 0||n.info("Computing RTC backend identity for ".concat(r,":").concat(i,":").concat(s," (SHOULD ONLY BE CALLED ONCE)")),e.ownRtcBackendIdentityCache=yield e.rtcIdentityProvider(r,i,s)}else e.ownRtcBackendIdentityCache="".concat(e.ownMembership.userId,":").concat(e.ownMembership.deviceId);return e.ownRtcBackendIdentityCache})()}getEncryptionKeys(){return new Map(this.participantKeyRings)}checkKeysWithoutMatchingRTCMembership(){var e=this.keysWithoutMatchingRTCMembership;this.keysWithoutMatchingRTCMembership=[],e.forEach(n=>{this.addKeyToParticipant(n.key,n.keyIndex,n.membership)})}addKeyToParticipant(e,n,r){var i=this.getMemberships(),s=i.find(a=>a.userId===r.userId&&a.deviceId===r.deviceId);if(!s){var o;(o=this.logger)===null||o===void 0||o.info("No matching RTC membership for key from ".concat(r.userId,":").concat(r.deviceId,", delaying key addition")),this.keysWithoutMatchingRTCMembership.push({key:e,keyIndex:n,membership:r});return}this.addKeyToParticipantWithBackendIdentity(e,n,r,s.rtcBackendIdentity)}addKeyToParticipantWithBackendIdentity(e,n,r,i){var s=uf(r);this.participantKeyRings.has(s)||this.participantKeyRings.set(s,[]),this.participantKeyRings.get(s).push({key:e,keyIndex:n,membership:r,rtcBackendIdentity:i}),this.onEncryptionKeysChanged(e,n,r,i)}join(e){var n,r,i,s,o;this.manageMediaKeys=(n=e?.manageMediaKeys)!==null&&n!==void 0?n:!0,this.useHashedRtcBackendIdentity=(r=e?.unstableSendStickyEvents)!==null&&r!==void 0?r:!1,this.useKeyDelay=(i=e?.useKeyDelay)!==null&&i!==void 0?i:1e3,this.keyRotationGracePeriodMs=(s=e?.keyRotationGracePeriodMs)!==null&&s!==void 0?s:1e4,this.transport.on(xv.ReceivedKeys,this.onNewKeyReceived),this.getOwnRtcBackendIdentity(),(o=this.logger)===null||o===void 0||o.info("Joining room"),this.transport.start()}leave(){this.transport.off(xv.ReceivedKeys,this.onNewKeyReceived),this.transport.stop(),this.participantKeyRings.clear()}ensureKeyDistribution(){if(this.manageMediaKeys)if(this.currentKeyDistributionPromise==null){var e;(e=this.logger)===null||e===void 0||e.debug("No active rollout, start a new one"),this.currentKeyDistributionPromise=this.rolloutOutboundKey().then(()=>{var r;if((r=this.logger)===null||r===void 0||r.debug("Rollout completed"),this.currentKeyDistributionPromise=null,this.needToEnsureKeyAgain){var i;(i=this.logger)===null||i===void 0||i.debug("New Rollout needed"),this.needToEnsureKeyAgain=!1,this.ensureKeyDistribution()}})}else{var n;(n=this.logger)===null||n===void 0||n.debug("Rollout in progress, a new rollout will be started after the current one"),this.needToEnsureKeyAgain=!0}}onMembershipsUpdate(){var e;(e=this.logger)===null||e===void 0||e.trace("onMembershipsUpdate"),this.ensureKeyDistribution(),this.checkKeysWithoutMatchingRTCMembership()}rolloutOutboundKey(){var e=this;return B(function*(){var n,r,i=e.outboundSession==null;if(i){var s={key:e.generateRandomKey(),creationTS:Date.now(),sharedWith:[],keyId:0};e.outboundSession=s,e.addKeyToParticipantWithBackendIdentity(s.key,s.keyId,e.ownMembership,yield e.getOwnRtcBackendIdentity())}var o=e.getMemberships().filter(O=>O.sender!=null).map(O=>({userId:O.sender,deviceId:O.deviceId,membershipTs:O.createdTs()})),a=(n=(r=e.outboundSession)===null||r===void 0?void 0:r.sharedWith)!==null&&n!==void 0?n:[];a=a.filter(O=>!o.some(P=>O.userId==P.userId&&O.deviceId==P.deviceId&&O.membershipTs!=P.membershipTs));var c=a.filter(O=>!o.some(P=>O.userId==P.userId&&O.deviceId==P.deviceId&&O.membershipTs==P.membershipTs)),l=o.filter(O=>!a.some(P=>O.userId==P.userId&&O.deviceId==P.deviceId&&O.membershipTs==P.membershipTs)),d=[],h,m=!1;if(c.length>0){var g=e.createNewOutboundSession();m=!0,d=o,h=g}else if(l.length>0){var y=Date.now(),v=y-e.outboundSession.creationTS;if(v<e.keyRotationGracePeriodMs){var E;(E=e.logger)===null||E===void 0||E.debug("New joiners detected, but the key is recent enough (age:".concat(v,"), keeping it")),d=l,h=e.outboundSession}else{var w;(w=e.logger)===null||w===void 0||w.debug("New joiners detected, rotating the key");var R=e.createNewOutboundSession();m=!0,d=o,h=R}}else return;try{var x,C;if((x=e.logger)===null||x===void 0||x.trace("Sending key..."),yield e.transport.sendKey(H1(h.key),h.keyId,d),e.statistics.counters.roomEventEncryptionKeysSent+=1,h.sharedWith.push(...d),(C=e.logger)===null||C===void 0||C.trace("key index:".concat(h.keyId," sent to ").concat(h.sharedWith.map(O=>"".concat(O.userId,":").concat(O.deviceId)).join(","))),m){var k,T;(k=e.logger)===null||k===void 0||k.trace("Delay Rollout for key:".concat(h.keyId,"...")),yield Yp(e.useKeyDelay),(T=e.logger)===null||T===void 0||T.trace("...Delayed rollout of index:".concat(h.keyId," ")),e.addKeyToParticipantWithBackendIdentity(h.key,h.keyId,e.ownMembership,yield e.getOwnRtcBackendIdentity())}}catch(O){var L;(L=e.logger)===null||L===void 0||L.error("Failed to rollout key",O)}})()}createNewOutboundSession(){var e,n={key:this.generateRandomKey(),creationTS:Date.now(),sharedWith:[],keyId:this.nextKeyIndex()};return(e=this.logger)===null||e===void 0||e.info("creating new outbound key index:".concat(n.keyId)),this.outboundSession=n,n}nextKeyIndex(){return this.outboundSession?(this.outboundSession.keyId+1)%256:0}generateRandomKey(){var e=new Uint8Array(16);return globalThis.crypto.getRandomValues(e),e}}let f1e=class extends Error{constructor(e){super(e)}get name(){return"NotSupportedError"}};class h1e extends Gn{setParentLogger(e){this.logger=e.getChild("[ToDeviceKeyTransport]")}constructor(e,n,r,i,s){super(),this.membership=e,this.roomId=n,this.client=r,this.statistics=i,M(this,"logger",N),M(this,"onToDeviceEvent",o=>{if(o.getType()===ee.CallEncryptionKeysPrefix){var a=this.getValidEventContent(o);a&&o.getSender()&&this.receiveCallKeyEvent(o.getSender(),a)}}),this.setParentLogger(s??N)}start(){this.client.on(Pe.ToDeviceEvent,this.onToDeviceEvent)}stop(){this.client.off(Pe.ToDeviceEvent,this.onToDeviceEvent)}sendKey(e,n,r){var i=this;return B(function*(){var s={keys:{index:n,key:e},room_id:i.roomId,member:{claimed_device_id:i.membership.deviceId,id:i.membership.memberId},session:{call_id:"",application:"m.call",scope:"m.room"},sent_ts:Date.now()},o=r.map(a=>({userId:a.userId,deviceId:a.deviceId})).filter(a=>!(a.userId==i.membership.userId&&a.deviceId==i.membership.deviceId));o.length>0?(yield i.client.encryptAndSendToDevice(ee.CallEncryptionKeysPrefix,o,s).catch(a=>{var c=a.message;if(c.includes("unknown variant")&&c.includes("send_to_device")||c.includes("not supported"))throw new f1e("The widget driver does not support to-device encryption")}),i.statistics.counters.roomEventEncryptionKeysSent+=1):i.logger.warn("No targets found for sending key")})()}receiveCallKeyEvent(e,n){var r;this.statistics.counters.roomEventEncryptionKeysReceived+=1;var i=Date.now(),s=i-(typeof n.sent_ts=="number"?n.sent_ts:i);this.statistics.totals.roomEventEncryptionKeysReceivedTotalAge+=s;var o="".concat(e,":").concat(n.member.claimed_device_id);this.emit(xv.ReceivedKeys,{userId:e,deviceId:n.member.claimed_device_id,memberId:(r=n.member.id)!==null&&r!==void 0?r:o},n.keys.key,n.keys.index,i)}getValidEventContent(e){var n=e.getContent(),r=n.room_id;if(!r){this.logger.warn("Malformed Event: invalid call encryption keys event, no roomId");return}if(r!==this.roomId){this.logger.warn("Malformed Event: Mismatch roomId");return}if(!n.keys||!n.keys.key||typeof n.keys.index!="number"){this.logger.warn("Malformed Event: Missing keys field");return}if(!n.member||!n.member.claimed_device_id){this.logger.warn("Malformed Event: Missing claimed_device_id");return}return n}}class p1e extends Gn{setParentLogger(e){this.logger=e.getChild("[RoomKeyTransport]")}constructor(e,n,r,i){super(),this.room=e,this.client=n,this.statistics=r,M(this,"logger",N),this.setParentLogger(i??N)}start(){this.room.on(Me.Timeline,e=>{this.consumeCallEncryptionEvent(e)})}stop(){this.room.off(Me.Timeline,e=>{this.consumeCallEncryptionEvent(e)})}consumeCallEncryptionEvent(e){var n=arguments,r=this;return B(function*(){var i=n.length>1&&n[1]!==void 0?n[1]:!1;if(yield r.client.decryptEventIfNeeded(e),e.isDecryptionFailure()){i?r.logger.warn("Decryption failed for event ".concat(e.getId(),": ").concat(e.decryptionFailureReason)):(r.logger.warn("Decryption failed for event ".concat(e.getId(),": ").concat(e.decryptionFailureReason," will retry once only")),setTimeout(()=>{r.consumeCallEncryptionEvent(e,!0)},1e3));return}else i&&r.logger.info("Decryption succeeded for event ".concat(e.getId()," after retry"));if(e.getType()!==ee.CallEncryptionKeysPrefix)return Promise.resolve();if(!r.room)return r.logger.error("Got room state event for unknown room ".concat(e.getRoomId(),"!")),Promise.resolve();r.onEncryptionEvent(e)})()}sendKey(e,n,r){var i=this;return B(function*(){var s={keys:[{index:n,key:e}],device_id:i.client.getDeviceId(),call_id:"",sent_ts:Date.now()};try{yield i.client.sendEvent(i.room.roomId,ee.CallEncryptionKeysPrefix,s)}catch(a){i.logger.error("Failed to send call encryption keys",a);var o=a;throw o.event&&i.client.cancelPendingEvent(o.event),a}})()}onEncryptionEvent(e){var n=e.getSender(),r=e.getContent(),i=r.device_id,s=r.call_id;if(!n){this.logger.warn("Received m.call.encryption_keys with no userId: callId=".concat(s));return}if(s!==""){this.logger.warn("Received m.call.encryption_keys with unsupported callId: userId=".concat(n,", deviceId=").concat(i,", callId=").concat(s));return}if(!Array.isArray(r.keys)){this.logger.warn("Received m.call.encryption_keys where keys wasn't an array: callId=".concat(s));return}if(n===this.client.getUserId()&&i===this.client.getDeviceId()){this.logger.info("Ignoring our own keys event");return}this.statistics.counters.roomEventEncryptionKeysReceived+=1;var o=Date.now()-(typeof r.sent_ts=="number"?r.sent_ts:e.getTs());this.statistics.totals.roomEventEncryptionKeysReceivedTotalAge+=o;for(var a of r.keys){if(!a){this.logger.info("Ignoring false-y key in keys event");continue}var c=a.key,l=a.index;!c||l===void 0||l===null||s===void 0||s===null||typeof i!="string"||typeof s!="string"||typeof c!="string"||typeof l!="number"?this.logger.warn("Malformed call encryption_key: userId=".concat(n,", deviceId=").concat(i,", encryptionKeyIndex=").concat(l," callId=").concat(s)):(this.logger.debug("onCallEncryption userId=".concat(n,":").concat(i," encryptionKeyIndex=").concat(l," age=").concat(o,"ms")),this.emit(xv.ReceivedKeys,{userId:n,deviceId:i,memberId:"".concat(n,":").concat(i)},c,l,e.getTs()))}}}function IB(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function xB(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?IB(Object(n),!0).forEach(function(r){M(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):IB(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var Ji=(function(t){return t.MembershipsChanged="memberships_changed",t.JoinStateChanged="join_state_changed",t.EncryptionKeyChanged="encryption_key_changed",t.MembershipManagerError="membership_manager_error",t.DidSendCallNotification="did_send_call_notification",t})({});function m1e(t){var[e,n]=t.split("#");return{application:e,id:n}}function Ob(t){return"".concat(t.application,"#").concat(t.id)}var g1e={listenForStickyEvents:!0,listenForMemberStateEvents:!0};class Pb extends Gn{get membershipStatus(){var e;return(e=this.membershipManager)===null||e===void 0?void 0:e.status}get probablyLeft(){var e;return(e=this.membershipManager)===null||e===void 0?void 0:e.probablyLeft}get delayId(){var e;return(e=this.membershipManager)===null||e===void 0?void 0:e.delayId}get callId(){var e;return(e=this.slotDescription)===null||e===void 0?void 0:e.id}get slotId(){return Ob(this.slotDescription)}static sessionMembershipsForSlot(e,n){var r=arguments;return B(function*(){var i=r.length>2&&r[2]!==void 0?r[2]:g1e,s=N.getChild("[MatrixRTCSession ".concat(e.roomId,"]")),o=_1e(e,i,s),a=yield v1e(e,o,n,s);return a.sort((c,l)=>c.createdTs()-l.createdTs()),a.length>1&&s.debug("Call memberships in room ".concat(e.roomId,", in order: "),a.map(c=>[c.createdTs(),c.userId])),a})()}static sessionForSlot(e,n,r,i){return new Pb(e,n,r,i)}get room(){return this.roomSubset}constructor(e,n,r,i){var s;super(),s=this,this.client=e,this.roomSubset=n,this.slotDescription=r,this.calculateMembershipsOpts=i,M(this,"membershipManager",void 0),M(this,"encryptionManager",void 0),M(this,"joinConfig",void 0),M(this,"logger",void 0),M(this,"pendingNotificationToSend",void 0),M(this,"expiryTimeout",void 0),M(this,"memberships",[]),M(this,"statistics",{counters:{roomEventEncryptionKeysSent:0,roomEventEncryptionKeysReceived:0},totals:{roomEventEncryptionKeysReceivedTotalAge:0}}),M(this,"reEmitter",new py(this)),M(this,"onRoomMemberUpdate",()=>{this.ensureRecalculateSessionMembers()}),M(this,"onStickyEventUpdate",(o,a,c)=>{[...o,...c,...a.flatMap(l=>[l.current,l.previous])].some(l=>l.getType()===ee.RTCMembership)&&this.ensureRecalculateSessionMembers()}),M(this,"_onRTCSessionMemberUpdate",B(function*(){yield s.recalculateSessionMembers()})),M(this,"recalculateSessionMembersDirty",!1),M(this,"recalculateSessionMembersPromise",void 0),M(this,"recalculateSessionMembers",B(function*(){var o,a=s.memberships;s.memberships=yield Pb.sessionMembershipsForSlot(s.room,Ob(s.slotDescription),s.calculateMembershipsOpts);var c=a.length!=s.memberships.length||a.some((g,y)=>!Af.equal(g,s.memberships[y]));if(c){var l,d;s.logger.info("Memberships for call in room ".concat(s.roomSubset.roomId," have changed: emitting (").concat(s.memberships.length," members)")),Eve(s.logger,"emit MatrixRTCSessionEvent.MembershipsChanged",()=>{s.emit(Ji.MembershipsChanged,a,s.memberships)}),(l=s.membershipManager)===null||l===void 0||l.onRTCSessionMemberUpdate(s.memberships);var h=(d=s.membershipManager)===null||d===void 0?void 0:d.ownMembership;if(s.pendingNotificationToSend&&h&&a.length===0){var m;h.eventId&&(m=s.joinConfig)!==null&&m!==void 0&&m.notificationType?s.sendCallNotify(h.eventId,s.joinConfig.notificationType,h.callIntent):s.logger.warn("Own membership eventId is undefined, cannot send call notification")}s.memberships.length>0&&(s.pendingNotificationToSend=void 0)}else s.logger.debug("No membership changes detected for room ".concat(s.roomSubset.roomId));(o=s.encryptionManager)===null||o===void 0||o.onMembershipsUpdate(a),s.setExpiryTimer()})),this.logger=N.getChild("[MatrixRTCSession ".concat(n.roomId,"]")),this.roomSubset.on(Rt.Members,this.onRoomMemberUpdate),this.roomSubset.on(mf.Update,this.onStickyEventUpdate),this.ensureRecalculateSessionMembers(),this.setExpiryTimer()}isJoined(){var e,n;return(e=(n=this.membershipManager)===null||n===void 0?void 0:n.isJoined())!==null&&e!==void 0?e:!1}stop(){var e=this;return B(function*(){var n;yield(n=e.membershipManager)===null||n===void 0?void 0:n.leave(1e3),e.expiryTimeout&&(clearTimeout(e.expiryTimeout),e.expiryTimeout=void 0),e.roomSubset.off(Rt.Members,e.onRoomMemberUpdate),e.roomSubset.off(mf.Update,e.onStickyEventUpdate)})()}joinRTCSession(e,n,r,i){var s;if(this.isJoined()){this.logger.info("Already joined to session in room ".concat(this.roomSubset.roomId,": ignoring join call"));return}else{this.membershipManager=i!=null&&i.unstableSendStickyEvents?new RT(i,this.roomSubset,this.client,this.slotDescription,e.memberId,this.logger):new Mb(i,this.roomSubset,this.client,this.slotDescription,this.logger),this.reEmitter.reEmit(this.membershipManager,[_l.ProbablyLeft,_l.StatusChanged,_l.DelayIdChanged]);var o;if(i!=null&&i.useExperimentalToDeviceTransport){this.logger.info("Using experimental to-device transport for encryption keys"),this.logger.info("Using to-device with room fallback transport for encryption keys");var[a,c,l]=[this.roomSubset,this.client,this.statistics],d=new h1e(e,a.roomId,c,l);this.encryptionManager=new d1e(e,()=>this.memberships,d,this.statistics,(h,m,g,y)=>{this.emit(Ji.EncryptionKeyChanged,h,m,g,y)},this.logger)}else o=new p1e(this.roomSubset,this.client,this.statistics),this.encryptionManager=new c1e(e,()=>this.memberships,o,this.statistics,(h,m,g,y)=>{this.emit(Ji.EncryptionKeyChanged,h,m,g,y)})}this.joinConfig=i,this.pendingNotificationToSend=(s=this.joinConfig)===null||s===void 0?void 0:s.notificationType,this.membershipManager.join(n,r,h=>{this.logger.error("MembershipManager encountered an unrecoverable error: ",h),this.emit(Ji.MembershipManagerError,h),this.emit(Ji.JoinStateChanged,this.isJoined())}),this.encryptionManager.join(i),this.emit(Ji.JoinStateChanged,!0)}joinRoomSession(e,n,r){var[i,s]=[this.client.getUserId(),this.client.getDeviceId()],o="".concat(i,":").concat(s);this.joinRTCSession({userId:i,deviceId:s,memberId:o},e,n,r)}leaveRoomSession(){var e=arguments,n=this;return B(function*(){var r=e.length>0&&e[0]!==void 0?e[0]:void 0;if(!n.isJoined())return n.logger.info("Not joined to session in room ".concat(n.roomSubset.roomId,": ignoring leave call")),!1;n.logger.info("Leaving call session in room ".concat(n.roomSubset.roomId)),n.encryptionManager.leave();var i=n.membershipManager.leave(r);return n.emit(Ji.JoinStateChanged,!1),yield i})()}getFocusInUse(){var e=this.getOldestMembership();return e?.getTransport(e)}getActiveFocus(){var e;return(e=this.getOldestMembership())===null||e===void 0?void 0:e.getFocusActive()}getOldestMembership(){return this.memberships[0]}getConsensusCallIntent(){var e,n=(e=this.memberships.find(r=>!!r.callIntent))===null||e===void 0?void 0:e.callIntent;if(n&&this.memberships.every(r=>!r.callIntent||r.callIntent===n))return n}updateCallIntent(e){var n=this;return B(function*(){var r,i,s=(r=n.membershipManager)===null||r===void 0?void 0:r.ownMembership;if(!s)throw Error("Not connected yet");yield(i=n.membershipManager)===null||i===void 0?void 0:i.updateCallIntent(e)})()}reemitEncryptionKeys(){var e;(e=this.encryptionManager)===null||e===void 0||e.getEncryptionKeys().forEach((n,r)=>{n.forEach(i=>{this.emit(Ji.EncryptionKeyChanged,i.key,i.keyIndex,i.membership,i.rtcBackendIdentity)})})}setExpiryTimer(){this.expiryTimeout&&(clearTimeout(this.expiryTimeout),this.expiryTimeout=void 0);var e;for(var n of this.memberships){var r=n.getMsUntilExpiry();r!==void 0&&(e===void 0||r<e)&&(e=r)}e!=null&&(this.expiryTimeout=setTimeout(this.ensureRecalculateSessionMembers.bind(this),e))}sendCallNotify(e,n,r){var i=this,s=(function(){var o=B(function*(){var a={"m.mentions":{user_ids:[],room:!0},notification_type:n,"m.relates_to":{event_id:e,rel_type:vn.Reference},sender_ts:Date.now(),lifetime:3e4};r&&(a["m.call.intent"]=r);var c=yield i.client.sendEvent(i.roomSubset.roomId,ee.RTCNotification,a);return{response:c,content:a}});return function(){return o.apply(this,arguments)}})();s().then(o=>{var a=xB(xB({},o.response),o.content);this.emit(Ji.DidSendCallNotification,a)}).catch(o=>{var[a,c]=o;return this.logger.error("Failed to send call notification",a,c)})}ensureRecalculateSessionMembers(){this.recalculateSessionMembersPromise===void 0?this.recalculateSessionMembersPromise=this.recalculateSessionMembers().then(()=>{this.recalculateSessionMembersPromise=void 0,this.recalculateSessionMembersDirty&&(this.ensureRecalculateSessionMembers(),this.recalculateSessionMembersDirty=!1)}):this.recalculateSessionMembersDirty=!0}}function v1e(t,e,n,r){return BA.apply(this,arguments)}function BA(){return BA=B(function*(t,e,n,r){var i=[];for(var s of e){var o=s.getContent();if(y1e(o,r))try{var a=Af.membershipDataFromMatrixEvent(s),c=new Af(s,a,yield Af.computeRtcBackendIdentity(s,a),r);b1e(c,t,n,r)&&i.push(c)}catch(l){r.warn("Couldn't construct call membership: ",l)}}return i}),BA.apply(this,arguments)}function y1e(t,e){var n=Object.keys(t).filter(r=>r!=="msc4354_sticky_key").length;return n===0?!1:n>1&&"application"in t?!0:(n===1&&"memberships"in t&&e.warn("Legacy event found. Those are ignored, they do not contribute to the MatrixRTC session"),!1)}function b1e(t,e,n,r){var i;return t.slotId!==n?(r.info("Ignoring membership of user ".concat(t.userId," for a different slot:  user: ").concat(JSON.stringify(t.slotDescription),", slotId: ").concat(n,")")),!1):t.isExpired()?(r.info("Ignoring expired device membership ".concat(t.userId,"/").concat(t.deviceId)),!1):e.hasMembershipState((i=t.userId)!==null&&i!==void 0?i:"",Ke.Join)?!0:(r.info("Ignoring membership of user ".concat(t.userId," who is not in the room.")),!1)}function _1e(t,e,n){var{listenForStickyEvents:r,listenForMemberStateEvents:i}=e,s=[];if(r&&(s=[...t._unstable_getStickyEvents()].filter(c=>c.getType()===ee.RTCMembership)),i){var o=t.getLiveTimeline().getState(Ue.FORWARDS);if(!o)return n.warn("Couldn't get state for room "+t.roomId+"using empty membership array"),[];var a=o.getStateEvents(ee.GroupCallMemberPrefix);s=s.concat(a.filter(c=>!s.some(l=>l.getContent().msc4354_sticky_key===c.getStateKey())))}return s}var LC=(function(t){return t.SessionStarted="session_started",t.SessionEnded="session_ended",t})({});class S1e extends Gn{constructor(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{application:"m.call",id:"ROOM"};super(),this.client=n,this.slotDescription=r,M(this,"roomSessions",new Map),M(this,"logger",void 0),M(this,"onRoom",i=>{this.refreshRoom(i)}),M(this,"onEvent",i=>{if(i.unstableStickyExpiresAt&&i.getType()===ee.RTCMembership){var s=this.client.getRoom(i.getRoomId());s&&this.refreshRoom(s)}}),M(this,"onRoomState",i=>{if(i.getType()===ee.GroupCallMemberPrefix){var s=this.client.getRoom(i.getRoomId());if(!s){this.logger.error("Got room state event for unknown room ".concat(i.getRoomId(),"!"));return}this.refreshRoom(s)}}),this.logger=e.getChild("[MatrixRTCSessionManager]")}start(){for(var e of(n=this.client.getRooms())!==null&&n!==void 0?n:[]){var n,r=Pb.sessionForSlot(this.client,e,this.slotDescription);r.memberships.length>0&&this.roomSessions.set(e.roomId,r)}this.client.on(Pe.Room,this.onRoom),this.client.on(Pe.Event,this.onEvent),this.client.on(Rt.Events,this.onRoomState)}stop(){for(var e of this.roomSessions.values())e.stop();this.roomSessions.clear(),this.client.off(Pe.Room,this.onRoom),this.client.off(Pe.Event,this.onEvent),this.client.off(Rt.Events,this.onRoomState)}getActiveRoomSession(e){return this.roomSessions.get(e.roomId)}getRoomSession(e){return this.roomSessions.has(e.roomId)||this.roomSessions.set(e.roomId,Pb.sessionForSlot(this.client,e,this.slotDescription)),this.roomSessions.get(e.roomId)}refreshRoom(e){var n=this;return B(function*(){var r=!n.roomSessions.has(e.roomId),i=n.getRoomSession(e),s=i.memberships.length>0&&!r;yield i._onRTCSessionMemberUpdate().catch(a=>{n.logger.error("Error updating RTC session members for ".concat(e.roomId,": ").concat(a))});var o=i.memberships.length>0;s&&!o?(n.logger.trace("Session ended for ".concat(e.roomId," (").concat(i.memberships.length," members)")),n.emit(LC.SessionEnded,e.roomId,n.roomSessions.get(e.roomId))):!s&&o&&(n.logger.trace("Session started for ".concat(e.roomId," (").concat(i.memberships.length," members)")),n.emit(LC.SessionStarted,e.roomId,n.roomSessions.get(e.roomId)))})()}}function sx(t){return e=>{var n,r;return((n=e.content)===null||n===void 0||(n=n["m.relates_to"])===null||n===void 0?void 0:n.event_id)!==t||((r=e.content)===null||r===void 0||(r=r["m.relates_to"])===null||r===void 0?void 0:r.rel_type)===Rn.name}}class I1 extends Error{}I1.prototype.name="InvalidTokenError";function w1e(t){return decodeURIComponent(atob(t).replace(/(.)/g,(e,n)=>{let r=n.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r}))}function E1e(t){let e=t.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return w1e(e)}catch{return atob(e)}}function sQ(t,e){if(typeof t!="string")throw new I1("Invalid token specified: must be a string");e||(e={});const n=e.header===!0?0:1,r=t.split(".")[n];if(typeof r!="string")throw new I1(`Invalid token specified: missing part #${n+1}`);let i;try{i=E1e(r)}catch(s){throw new I1(`Invalid token specified: invalid base64 for part #${n+1} (${s.message})`)}try{return JSON.parse(i)}catch(s){throw new I1(`Invalid token specified: invalid json for part #${n+1} (${s.message})`)}}var C1e={debug:()=>{},info:()=>{},warn:()=>{},error:()=>{}},hl,pl,Db=(t=>(t[t.NONE=0]="NONE",t[t.ERROR=1]="ERROR",t[t.WARN=2]="WARN",t[t.INFO=3]="INFO",t[t.DEBUG=4]="DEBUG",t))(Db||{});(t=>{function e(){hl=3,pl=C1e}t.reset=e;function n(i){if(!(0<=i&&i<=4))throw new Error("Invalid log level");hl=i}t.setLevel=n;function r(i){pl=i}t.setLogger=r})(Db||(Db={}));var qr=class ll{constructor(e){this._name=e}debug(...e){hl>=4&&pl.debug(ll._format(this._name,this._method),...e)}info(...e){hl>=3&&pl.info(ll._format(this._name,this._method),...e)}warn(...e){hl>=2&&pl.warn(ll._format(this._name,this._method),...e)}error(...e){hl>=1&&pl.error(ll._format(this._name,this._method),...e)}throw(e){throw this.error(e),e}create(e){const n=Object.create(this);return n._method=e,n.debug("begin"),n}static createStatic(e,n){const r=new ll(`${e}.${n}`);return r.debug("begin"),r}static _format(e,n){const r=`[${e}]`;return n?`${r} ${n}:`:r}static debug(e,...n){hl>=4&&pl.debug(ll._format(e),...n)}static info(e,...n){hl>=3&&pl.info(ll._format(e),...n)}static warn(e,...n){hl>=2&&pl.warn(ll._format(e),...n)}static error(e,...n){hl>=1&&pl.error(ll._format(e),...n)}};Db.reset();var MC=class{static decode(t){try{return sQ(t)}catch(e){throw qr.error("JwtUtils.decode",e),e}}static async generateSignedJwt(t,e,n){const r=Oc.encodeBase64Url(new TextEncoder().encode(JSON.stringify(t))),i=Oc.encodeBase64Url(new TextEncoder().encode(JSON.stringify(e))),s=`${r}.${i}`,o=await window.crypto.subtle.sign({name:"ECDSA",hash:{name:"SHA-256"}},n,new TextEncoder().encode(s)),a=Oc.encodeBase64Url(new Uint8Array(o));return`${s}.${a}`}},T1e="10000000-1000-4000-8000-100000000000",HA=t=>btoa([...new Uint8Array(t)].map(e=>String.fromCharCode(e)).join("")),oQ=class ul{static _randomWord(){const e=new Uint32Array(1);return crypto.getRandomValues(e),e[0]}static generateUUIDv4(){return T1e.replace(/[018]/g,n=>(+n^ul._randomWord()&15>>+n/4).toString(16)).replace(/-/g,"")}static generateCodeVerifier(){return ul.generateUUIDv4()+ul.generateUUIDv4()+ul.generateUUIDv4()}static async generateCodeChallenge(e){if(!crypto.subtle)throw new Error("Crypto.subtle is available only in secure contexts (HTTPS).");try{const r=new TextEncoder().encode(e),i=await crypto.subtle.digest("SHA-256",r);return HA(i).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}catch(n){throw qr.error("CryptoUtils.generateCodeChallenge",n),n}}static generateBasicAuth(e,n){const i=new TextEncoder().encode([e,n].join(":"));return HA(i)}static async hash(e,n){const r=new TextEncoder().encode(n),i=await crypto.subtle.digest(e,r);return new Uint8Array(i)}static async customCalculateJwkThumbprint(e){let n;switch(e.kty){case"RSA":n={e:e.e,kty:e.kty,n:e.n};break;case"EC":n={crv:e.crv,kty:e.kty,x:e.x,y:e.y};break;case"OKP":n={crv:e.crv,kty:e.kty,x:e.x};break;case"oct":n={crv:e.k,kty:e.kty};break;default:throw new Error("Unknown jwk type")}const r=await ul.hash("SHA-256",JSON.stringify(n));return ul.encodeBase64Url(r)}static async generateDPoPProof({url:e,accessToken:n,httpMethod:r,keyPair:i,nonce:s}){let o,a;const c={jti:window.crypto.randomUUID(),htm:r??"GET",htu:e,iat:Math.floor(Date.now()/1e3)};n&&(o=await ul.hash("SHA-256",n),a=ul.encodeBase64Url(o),c.ath=a),s&&(c.nonce=s);try{const l=await crypto.subtle.exportKey("jwk",i.publicKey),d={alg:"ES256",typ:"dpop+jwt",jwk:{crv:l.crv,kty:l.kty,x:l.x,y:l.y}};return await MC.generateSignedJwt(d,c,i.privateKey)}catch(l){throw l instanceof TypeError?new Error(`Error exporting dpop public key: ${l.message}`):l}}static async generateDPoPJkt(e){try{const n=await crypto.subtle.exportKey("jwk",e.publicKey);return await ul.customCalculateJwkThumbprint(n)}catch(n){throw n instanceof TypeError?new Error(`Could not retrieve dpop keys from storage: ${n.message}`):n}}static async generateDPoPKeys(){return await window.crypto.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!1,["sign","verify"])}};oQ.encodeBase64Url=t=>HA(t).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_");var Oc=oQ,R1e=class{constructor(e){this._name=e,this._callbacks=[],this._logger=new qr(`Event('${this._name}')`)}addHandler(e){return this._callbacks.push(e),()=>this.removeHandler(e)}removeHandler(e){const n=this._callbacks.lastIndexOf(e);n>=0&&this._callbacks.splice(n,1)}async raise(...e){this._logger.debug("raise:",...e);for(const n of this._callbacks)await n(...e)}},OC=class pE extends R1e{constructor(){super(...arguments),this._logger=new qr(`Timer('${this._name}')`),this._timerHandle=null,this._expiration=0,this._callback=()=>{const e=this._expiration-pE.getEpochTime();this._logger.debug("timer completes in",e),this._expiration<=pE.getEpochTime()&&(this.cancel(),super.raise())}}static getEpochTime(){return Math.floor(Date.now()/1e3)}init(e){const n=this._logger.create("init");e=Math.max(Math.floor(e),1);const r=pE.getEpochTime()+e;if(this.expiration===r&&this._timerHandle){n.debug("skipping since already initialized for expiration at",this.expiration);return}this.cancel(),n.debug("using duration",e),this._expiration=r;const i=Math.min(e,5);this._timerHandle=setInterval(this._callback,i*1e3)}get expiration(){return this._expiration}cancel(){this._logger.create("cancel"),this._timerHandle&&(clearInterval(this._timerHandle),this._timerHandle=null)}},AB=class{static readParams(t,e="query"){if(!t)throw new TypeError("Invalid URL");const r=new URL(t,"http://127.0.0.1")[e==="fragment"?"hash":"search"];return new URLSearchParams(r.slice(1))}},qA=";",Av=class extends Error{constructor(t,e){var n,r,i;if(super(t.error_description||t.error||""),this.form=e,this.name="ErrorResponse",!t.error)throw qr.error("ErrorResponse","No error passed"),new Error("No error passed");this.error=t.error,this.error_description=(n=t.error_description)!=null?n:null,this.error_uri=(r=t.error_uri)!=null?r:null,this.state=t.userState,this.session_state=(i=t.session_state)!=null?i:null,this.url_state=t.url_state}},k1e=class extends Error{constructor(t){super(t),this.name="ErrorTimeout"}},I1e=class{constructor(){this._logger=new qr("InMemoryWebStorage"),this._data={}}clear(){this._logger.create("clear"),this._data={}}getItem(t){return this._logger.create(`getItem('${t}')`),this._data[t]}setItem(t,e){this._logger.create(`setItem('${t}')`),this._data[t]=e}removeItem(t){this._logger.create(`removeItem('${t}')`),delete this._data[t]}get length(){return Object.getOwnPropertyNames(this._data).length}key(t){return Object.getOwnPropertyNames(this._data)[t]}},VA=class extends Error{constructor(t,e){super(e),this.name="ErrorDPoPNonce",this.nonce=t}},mP=class{constructor(t=[],e=null,n={}){this._jwtHandler=e,this._extraHeaders=n,this._logger=new qr("JsonService"),this._contentTypes=[],this._contentTypes.push(...t,"application/json"),e&&this._contentTypes.push("application/jwt")}async fetchWithTimeout(t,e={}){const{timeoutInSeconds:n,...r}=e;if(!n)return await fetch(t,r);const i=new AbortController,s=setTimeout(()=>i.abort(),n*1e3);try{return await fetch(t,{...e,signal:i.signal})}catch(o){throw o instanceof DOMException&&o.name==="AbortError"?new k1e("Network timed out"):o}finally{clearTimeout(s)}}async getJson(t,{token:e,credentials:n,timeoutInSeconds:r}={}){const i=this._logger.create("getJson"),s={Accept:this._contentTypes.join(", ")};e&&(i.debug("token passed, setting Authorization header"),s.Authorization="Bearer "+e),this.appendExtraHeaders(s);let o;try{i.debug("url:",t),o=await this.fetchWithTimeout(t,{method:"GET",headers:s,timeoutInSeconds:r,credentials:n})}catch(l){throw i.error("Network Error"),l}i.debug("HTTP response received, status",o.status);const a=o.headers.get("Content-Type");if(a&&!this._contentTypes.find(l=>a.startsWith(l))&&i.throw(new Error(`Invalid response Content-Type: ${a??"undefined"}, from URL: ${t}`)),o.ok&&this._jwtHandler&&a?.startsWith("application/jwt"))return await this._jwtHandler(await o.text());let c;try{c=await o.json()}catch(l){throw i.error("Error parsing JSON response",l),o.ok?l:new Error(`${o.statusText} (${o.status})`)}if(!o.ok)throw i.error("Error from server:",c),c.error?new Av(c):new Error(`${o.statusText} (${o.status}): ${JSON.stringify(c)}`);return c}async postForm(t,{body:e,basicAuth:n,timeoutInSeconds:r,initCredentials:i,extraHeaders:s}){const o=this._logger.create("postForm"),a={Accept:this._contentTypes.join(", "),"Content-Type":"application/x-www-form-urlencoded",...s};n!==void 0&&(a.Authorization="Basic "+n),this.appendExtraHeaders(a);let c;try{o.debug("url:",t),c=await this.fetchWithTimeout(t,{method:"POST",headers:a,body:e,timeoutInSeconds:r,credentials:i})}catch(m){throw o.error("Network error"),m}o.debug("HTTP response received, status",c.status);const l=c.headers.get("Content-Type");if(l&&!this._contentTypes.find(m=>l.startsWith(m)))throw new Error(`Invalid response Content-Type: ${l??"undefined"}, from URL: ${t}`);const d=await c.text();let h={};if(d)try{h=JSON.parse(d)}catch(m){throw o.error("Error parsing JSON response",m),c.ok?m:new Error(`${c.statusText} (${c.status})`)}if(!c.ok){if(o.error("Error from server:",h),c.headers.has("dpop-nonce")){const m=c.headers.get("dpop-nonce");throw new VA(m,`${JSON.stringify(h)}`)}throw h.error?new Av(h,e):new Error(`${c.statusText} (${c.status}): ${JSON.stringify(h)}`)}return h}appendExtraHeaders(t){const e=this._logger.create("appendExtraHeaders"),n=Object.keys(this._extraHeaders),r=["authorization","accept","content-type"];n.length!==0&&n.forEach(i=>{if(r.includes(i.toLocaleLowerCase())){e.warn("Protected header could not be overridden",i,r);return}const s=typeof this._extraHeaders[i]=="function"?this._extraHeaders[i]():this._extraHeaders[i];s&&s!==""&&(t[i]=s)})}},aQ=class{constructor(t){this._settings=t,this._logger=new qr("MetadataService"),this._signingKeys=null,this._metadata=null,this._metadataUrl=this._settings.metadataUrl,this._jsonService=new mP(["application/jwk-set+json"],null,this._settings.extraHeaders),this._settings.signingKeys&&(this._logger.debug("using signingKeys from settings"),this._signingKeys=this._settings.signingKeys),this._settings.metadata&&(this._logger.debug("using metadata from settings"),this._metadata=this._settings.metadata),this._settings.fetchRequestCredentials&&(this._logger.debug("using fetchRequestCredentials from settings"),this._fetchRequestCredentials=this._settings.fetchRequestCredentials)}resetSigningKeys(){this._signingKeys=null}async getMetadata(){const t=this._logger.create("getMetadata");if(this._metadata)return t.debug("using cached values"),this._metadata;if(!this._metadataUrl)throw t.throw(new Error("No authority or metadataUrl configured on settings")),null;t.debug("getting metadata from",this._metadataUrl);const e=await this._jsonService.getJson(this._metadataUrl,{credentials:this._fetchRequestCredentials,timeoutInSeconds:this._settings.requestTimeoutInSeconds});return t.debug("merging remote JSON with seed metadata"),this._metadata=Object.assign({},this._settings.metadataSeed,e),this._metadata}getIssuer(){return this._getMetadataProperty("issuer")}getAuthorizationEndpoint(){return this._getMetadataProperty("authorization_endpoint")}getUserInfoEndpoint(){return this._getMetadataProperty("userinfo_endpoint")}getTokenEndpoint(t=!0){return this._getMetadataProperty("token_endpoint",t)}getCheckSessionIframe(){return this._getMetadataProperty("check_session_iframe",!0)}getEndSessionEndpoint(){return this._getMetadataProperty("end_session_endpoint",!0)}getRevocationEndpoint(t=!0){return this._getMetadataProperty("revocation_endpoint",t)}getKeysEndpoint(t=!0){return this._getMetadataProperty("jwks_uri",t)}async _getMetadataProperty(t,e=!1){const n=this._logger.create(`_getMetadataProperty('${t}')`),r=await this.getMetadata();if(n.debug("resolved"),r[t]===void 0){if(e===!0){n.warn("Metadata does not contain optional property");return}n.throw(new Error("Metadata does not contain property "+t))}return r[t]}async getSigningKeys(){const t=this._logger.create("getSigningKeys");if(this._signingKeys)return t.debug("returning signingKeys from cache"),this._signingKeys;const e=await this.getKeysEndpoint(!1);t.debug("got jwks_uri",e);const n=await this._jsonService.getJson(e,{timeoutInSeconds:this._settings.requestTimeoutInSeconds});if(t.debug("got key set",n),!Array.isArray(n.keys))throw t.throw(new Error("Missing keys on keyset")),null;return this._signingKeys=n.keys,this._signingKeys}},kT=class{constructor({prefix:t="oidc.",store:e=localStorage}={}){this._logger=new qr("WebStorageStateStore"),this._store=e,this._prefix=t}async set(t,e){this._logger.create(`set('${t}')`),t=this._prefix+t,await this._store.setItem(t,e)}async get(t){return this._logger.create(`get('${t}')`),t=this._prefix+t,await this._store.getItem(t)}async remove(t){this._logger.create(`remove('${t}')`),t=this._prefix+t;const e=await this._store.getItem(t);return await this._store.removeItem(t),e}async getAllKeys(){this._logger.create("getAllKeys");const t=await this._store.length,e=[];for(let n=0;n<t;n++){const r=await this._store.key(n);r&&r.indexOf(this._prefix)===0&&e.push(r.substr(this._prefix.length))}return e}},x1e="code",A1e="openid",L1e="client_secret_post",M1e=900,KA=class{constructor({authority:t,metadataUrl:e,metadata:n,signingKeys:r,metadataSeed:i,client_id:s,client_secret:o,response_type:a=x1e,scope:c=A1e,redirect_uri:l,post_logout_redirect_uri:d,client_authentication:h=L1e,prompt:m,display:g,max_age:y,ui_locales:v,acr_values:E,resource:w,response_mode:R,filterProtocolClaims:x=!0,loadUserInfo:C=!1,requestTimeoutInSeconds:k,staleStateAgeInSeconds:T=M1e,mergeClaimsStrategy:L={array:"replace"},disablePKCE:O=!1,stateStore:P,revokeTokenAdditionalContentTypes:D,fetchRequestCredentials:j,refreshTokenAllowedScope:H,extraQueryParams:z={},extraTokenParams:Y={},extraHeaders:W={},dpop:F,omitScopeWhenRequesting:$=!1}){var V;if(this.authority=t,e?this.metadataUrl=e:(this.metadataUrl=t,t&&(this.metadataUrl.endsWith("/")||(this.metadataUrl+="/"),this.metadataUrl+=".well-known/openid-configuration")),this.metadata=n,this.metadataSeed=i,this.signingKeys=r,this.client_id=s,this.client_secret=o,this.response_type=a,this.scope=c,this.redirect_uri=l,this.post_logout_redirect_uri=d,this.client_authentication=h,this.prompt=m,this.display=g,this.max_age=y,this.ui_locales=v,this.acr_values=E,this.resource=w,this.response_mode=R,this.filterProtocolClaims=x??!0,this.loadUserInfo=!!C,this.staleStateAgeInSeconds=T,this.mergeClaimsStrategy=L,this.omitScopeWhenRequesting=$,this.disablePKCE=!!O,this.revokeTokenAdditionalContentTypes=D,this.fetchRequestCredentials=j||"same-origin",this.requestTimeoutInSeconds=k,P)this.stateStore=P;else{const G=typeof window<"u"?window.localStorage:new I1e;this.stateStore=new kT({store:G})}if(this.refreshTokenAllowedScope=H,this.extraQueryParams=z,this.extraTokenParams=Y,this.extraHeaders=W,this.dpop=F,this.dpop&&!((V=this.dpop)!=null&&V.store))throw new Error("A DPoPStore is required when dpop is enabled")}},O1e=class{constructor(t,e){this._settings=t,this._metadataService=e,this._logger=new qr("UserInfoService"),this._getClaimsFromJwt=async n=>{const r=this._logger.create("_getClaimsFromJwt");try{const i=MC.decode(n);return r.debug("JWT decoding successful"),i}catch(i){throw r.error("Error parsing JWT response"),i}},this._jsonService=new mP(void 0,this._getClaimsFromJwt,this._settings.extraHeaders)}async getClaims(t){const e=this._logger.create("getClaims");t||this._logger.throw(new Error("No token passed"));const n=await this._metadataService.getUserInfoEndpoint();e.debug("got userinfo url",n);const r=await this._jsonService.getJson(n,{token:t,credentials:this._settings.fetchRequestCredentials,timeoutInSeconds:this._settings.requestTimeoutInSeconds});return e.debug("got claims",r),r}},cQ=class{constructor(t,e){this._settings=t,this._metadataService=e,this._logger=new qr("TokenClient"),this._jsonService=new mP(this._settings.revokeTokenAdditionalContentTypes,null,this._settings.extraHeaders)}async exchangeCode({grant_type:t="authorization_code",redirect_uri:e=this._settings.redirect_uri,client_id:n=this._settings.client_id,client_secret:r=this._settings.client_secret,extraHeaders:i,...s}){const o=this._logger.create("exchangeCode");n||o.throw(new Error("A client_id is required")),e||o.throw(new Error("A redirect_uri is required")),s.code||o.throw(new Error("A code is required"));const a=new URLSearchParams({grant_type:t,redirect_uri:e});for(const[h,m]of Object.entries(s))m!=null&&a.set(h,m);let c;switch(this._settings.client_authentication){case"client_secret_basic":if(!r)throw o.throw(new Error("A client_secret is required")),null;c=Oc.generateBasicAuth(n,r);break;case"client_secret_post":a.append("client_id",n),r&&a.append("client_secret",r);break}const l=await this._metadataService.getTokenEndpoint(!1);o.debug("got token endpoint");const d=await this._jsonService.postForm(l,{body:a,basicAuth:c,timeoutInSeconds:this._settings.requestTimeoutInSeconds,initCredentials:this._settings.fetchRequestCredentials,extraHeaders:i});return o.debug("got response"),d}async exchangeCredentials({grant_type:t="password",client_id:e=this._settings.client_id,client_secret:n=this._settings.client_secret,scope:r=this._settings.scope,...i}){const s=this._logger.create("exchangeCredentials");e||s.throw(new Error("A client_id is required"));const o=new URLSearchParams({grant_type:t});this._settings.omitScopeWhenRequesting||o.set("scope",r);for(const[d,h]of Object.entries(i))h!=null&&o.set(d,h);let a;switch(this._settings.client_authentication){case"client_secret_basic":if(!n)throw s.throw(new Error("A client_secret is required")),null;a=Oc.generateBasicAuth(e,n);break;case"client_secret_post":o.append("client_id",e),n&&o.append("client_secret",n);break}const c=await this._metadataService.getTokenEndpoint(!1);s.debug("got token endpoint");const l=await this._jsonService.postForm(c,{body:o,basicAuth:a,timeoutInSeconds:this._settings.requestTimeoutInSeconds,initCredentials:this._settings.fetchRequestCredentials});return s.debug("got response"),l}async exchangeRefreshToken({grant_type:t="refresh_token",client_id:e=this._settings.client_id,client_secret:n=this._settings.client_secret,timeoutInSeconds:r,extraHeaders:i,...s}){const o=this._logger.create("exchangeRefreshToken");e||o.throw(new Error("A client_id is required")),s.refresh_token||o.throw(new Error("A refresh_token is required"));const a=new URLSearchParams({grant_type:t});for(const[h,m]of Object.entries(s))Array.isArray(m)?m.forEach(g=>a.append(h,g)):m!=null&&a.set(h,m);let c;switch(this._settings.client_authentication){case"client_secret_basic":if(!n)throw o.throw(new Error("A client_secret is required")),null;c=Oc.generateBasicAuth(e,n);break;case"client_secret_post":a.append("client_id",e),n&&a.append("client_secret",n);break}const l=await this._metadataService.getTokenEndpoint(!1);o.debug("got token endpoint");const d=await this._jsonService.postForm(l,{body:a,basicAuth:c,timeoutInSeconds:r,initCredentials:this._settings.fetchRequestCredentials,extraHeaders:i});return o.debug("got response"),d}async revoke(t){var e;const n=this._logger.create("revoke");t.token||n.throw(new Error("A token is required"));const r=await this._metadataService.getRevocationEndpoint(!1);n.debug(`got revocation endpoint, revoking ${(e=t.token_type_hint)!=null?e:"default token type"}`);const i=new URLSearchParams;for(const[s,o]of Object.entries(t))o!=null&&i.set(s,o);i.set("client_id",this._settings.client_id),this._settings.client_secret&&i.set("client_secret",this._settings.client_secret),await this._jsonService.postForm(r,{body:i,timeoutInSeconds:this._settings.requestTimeoutInSeconds}),n.debug("got response")}},P1e=class{constructor(t,e,n){this._settings=t,this._metadataService=e,this._claimsService=n,this._logger=new qr("ResponseValidator"),this._userInfoService=new O1e(this._settings,this._metadataService),this._tokenClient=new cQ(this._settings,this._metadataService)}async validateSigninResponse(t,e,n){const r=this._logger.create("validateSigninResponse");this._processSigninState(t,e),r.debug("state processed"),await this._processCode(t,e,n),r.debug("code processed"),t.isOpenId&&this._validateIdTokenAttributes(t),r.debug("tokens validated"),await this._processClaims(t,e?.skipUserInfo,t.isOpenId),r.debug("claims processed")}async validateCredentialsResponse(t,e){const n=this._logger.create("validateCredentialsResponse");t.isOpenId&&t.id_token&&this._validateIdTokenAttributes(t),n.debug("tokens validated"),await this._processClaims(t,e,t.isOpenId),n.debug("claims processed")}async validateRefreshResponse(t,e){var n,r;const i=this._logger.create("validateRefreshResponse");t.userState=e.data,(n=t.session_state)!=null||(t.session_state=e.session_state),(r=t.scope)!=null||(t.scope=e.scope),t.isOpenId&&t.id_token&&(this._validateIdTokenAttributes(t,e.id_token),i.debug("ID Token validated")),t.id_token||(t.id_token=e.id_token,t.profile=e.profile);const s=t.isOpenId&&!!t.id_token;await this._processClaims(t,!1,s),i.debug("claims processed")}validateSignoutResponse(t,e){const n=this._logger.create("validateSignoutResponse");if(e.id!==t.state&&n.throw(new Error("State does not match")),n.debug("state validated"),t.userState=e.data,t.error)throw n.warn("Response was error",t.error),new Av(t)}_processSigninState(t,e){var n;const r=this._logger.create("_processSigninState");if(e.id!==t.state&&r.throw(new Error("State does not match")),e.client_id||r.throw(new Error("No client_id on state")),e.authority||r.throw(new Error("No authority on state")),this._settings.authority!==e.authority&&r.throw(new Error("authority mismatch on settings vs. signin state")),this._settings.client_id&&this._settings.client_id!==e.client_id&&r.throw(new Error("client_id mismatch on settings vs. signin state")),r.debug("state validated"),t.userState=e.data,t.url_state=e.url_state,(n=t.scope)!=null||(t.scope=e.scope),t.error)throw r.warn("Response was error",t.error),new Av(t);e.code_verifier&&!t.code&&r.throw(new Error("Expected code in response"))}async _processClaims(t,e=!1,n=!0){const r=this._logger.create("_processClaims");if(t.profile=this._claimsService.filterProtocolClaims(t.profile),e||!this._settings.loadUserInfo||!t.access_token){r.debug("not loading user info");return}r.debug("loading user info");const i=await this._userInfoService.getClaims(t.access_token);r.debug("user info claims received from user info endpoint"),n&&i.sub!==t.profile.sub&&r.throw(new Error("subject from UserInfo response does not match subject in ID Token")),t.profile=this._claimsService.mergeClaims(t.profile,this._claimsService.filterProtocolClaims(i)),r.debug("user info claims received, updated profile:",t.profile)}async _processCode(t,e,n){const r=this._logger.create("_processCode");if(t.code){r.debug("Validating code");const i=await this._tokenClient.exchangeCode({client_id:e.client_id,client_secret:e.client_secret,code:t.code,redirect_uri:e.redirect_uri,code_verifier:e.code_verifier,extraHeaders:n,...e.extraTokenParams});Object.assign(t,i)}else r.debug("No code to process")}_validateIdTokenAttributes(t,e){var n;const r=this._logger.create("_validateIdTokenAttributes");r.debug("decoding ID Token JWT");const i=MC.decode((n=t.id_token)!=null?n:"");if(i.sub||r.throw(new Error("ID Token is missing a subject claim")),e){const s=MC.decode(e);i.sub!==s.sub&&r.throw(new Error("sub in id_token does not match current sub")),i.auth_time&&i.auth_time!==s.auth_time&&r.throw(new Error("auth_time in id_token does not match original auth_time")),i.azp&&i.azp!==s.azp&&r.throw(new Error("azp in id_token does not match original azp")),!i.azp&&s.azp&&r.throw(new Error("azp not in id_token, but present in original id_token"))}t.profile=i}},PC=class GA{constructor(e){this.id=e.id||Oc.generateUUIDv4(),this.data=e.data,e.created&&e.created>0?this.created=e.created:this.created=OC.getEpochTime(),this.request_type=e.request_type,this.url_state=e.url_state}toStorageString(){return new qr("State").create("toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type,url_state:this.url_state})}static fromStorageString(e){return qr.createStatic("State","fromStorageString"),Promise.resolve(new GA(JSON.parse(e)))}static async clearStaleState(e,n){const r=qr.createStatic("State","clearStaleState"),i=OC.getEpochTime()-n,s=await e.getAllKeys();r.debug("got keys",s);for(let o=0;o<s.length;o++){const a=s[o],c=await e.get(a);let l=!1;if(c)try{const d=await GA.fromStorageString(c);r.debug("got item from key:",a,d.created),d.created<=i&&(l=!0)}catch(d){r.error("Error parsing state for key:",a,d),l=!0}else r.debug("no item in storage for key:",a),l=!0;l&&(r.debug("removed item for key:",a),e.remove(a))}}},gP=class zA extends PC{constructor(e){super(e),this.code_verifier=e.code_verifier,this.code_challenge=e.code_challenge,this.authority=e.authority,this.client_id=e.client_id,this.redirect_uri=e.redirect_uri,this.scope=e.scope,this.client_secret=e.client_secret,this.extraTokenParams=e.extraTokenParams,this.response_mode=e.response_mode,this.skipUserInfo=e.skipUserInfo}static async create(e){const n=e.code_verifier===!0?Oc.generateCodeVerifier():e.code_verifier||void 0,r=n?await Oc.generateCodeChallenge(n):void 0;return new zA({...e,code_verifier:n,code_challenge:r})}toStorageString(){return new qr("SigninState").create("toStorageString"),JSON.stringify({id:this.id,data:this.data,created:this.created,request_type:this.request_type,url_state:this.url_state,code_verifier:this.code_verifier,authority:this.authority,client_id:this.client_id,redirect_uri:this.redirect_uri,scope:this.scope,client_secret:this.client_secret,extraTokenParams:this.extraTokenParams,response_mode:this.response_mode,skipUserInfo:this.skipUserInfo})}static fromStorageString(e){qr.createStatic("SigninState","fromStorageString");const n=JSON.parse(e);return zA.create(n)}},lQ=class uQ{constructor(e){this.url=e.url,this.state=e.state}static async create({url:e,authority:n,client_id:r,redirect_uri:i,response_type:s,scope:o,state_data:a,response_mode:c,request_type:l,client_secret:d,nonce:h,url_state:m,resource:g,skipUserInfo:y,extraQueryParams:v,extraTokenParams:E,disablePKCE:w,dpopJkt:R,omitScopeWhenRequesting:x,...C}){if(!e)throw this._logger.error("create: No url passed"),new Error("url");if(!r)throw this._logger.error("create: No client_id passed"),new Error("client_id");if(!i)throw this._logger.error("create: No redirect_uri passed"),new Error("redirect_uri");if(!s)throw this._logger.error("create: No response_type passed"),new Error("response_type");if(!o)throw this._logger.error("create: No scope passed"),new Error("scope");if(!n)throw this._logger.error("create: No authority passed"),new Error("authority");const k=await gP.create({data:a,request_type:l,url_state:m,code_verifier:!w,client_id:r,authority:n,redirect_uri:i,response_mode:c,client_secret:d,scope:o,extraTokenParams:E,skipUserInfo:y}),T=new URL(e);T.searchParams.append("client_id",r),T.searchParams.append("redirect_uri",i),T.searchParams.append("response_type",s),x||T.searchParams.append("scope",o),h&&T.searchParams.append("nonce",h),R&&T.searchParams.append("dpop_jkt",R);let L=k.id;m&&(L=`${L}${qA}${m}`),T.searchParams.append("state",L),k.code_challenge&&(T.searchParams.append("code_challenge",k.code_challenge),T.searchParams.append("code_challenge_method","S256")),g&&(Array.isArray(g)?g:[g]).forEach(P=>T.searchParams.append("resource",P));for(const[O,P]of Object.entries({response_mode:c,...C,...v}))P!=null&&T.searchParams.append(O,P.toString());return new uQ({url:T.href,state:k})}};lQ._logger=new qr("SigninRequest");var D1e=lQ,N1e="openid",mE=class{constructor(t){if(this.access_token="",this.token_type="",this.profile={},this.state=t.get("state"),this.session_state=t.get("session_state"),this.state){const e=decodeURIComponent(this.state).split(qA);this.state=e[0],e.length>1&&(this.url_state=e.slice(1).join(qA))}this.error=t.get("error"),this.error_description=t.get("error_description"),this.error_uri=t.get("error_uri"),this.code=t.get("code")}get expires_in(){if(this.expires_at!==void 0)return this.expires_at-OC.getEpochTime()}set expires_in(t){typeof t=="string"&&(t=Number(t)),t!==void 0&&t>=0&&(this.expires_at=Math.floor(t)+OC.getEpochTime())}get isOpenId(){var t;return((t=this.scope)==null?void 0:t.split(" ").includes(N1e))||!!this.id_token}},U1e=class{constructor({url:t,state_data:e,id_token_hint:n,post_logout_redirect_uri:r,extraQueryParams:i,request_type:s,client_id:o}){if(this._logger=new qr("SignoutRequest"),!t)throw this._logger.error("ctor: No url passed"),new Error("url");const a=new URL(t);n&&a.searchParams.append("id_token_hint",n),o&&a.searchParams.append("client_id",o),r&&(a.searchParams.append("post_logout_redirect_uri",r),e&&(this.state=new PC({data:e,request_type:s}),a.searchParams.append("state",this.state.id)));for(const[c,l]of Object.entries({...i}))l!=null&&a.searchParams.append(c,l.toString());this.url=a.href}},j1e=class{constructor(t){this.state=t.get("state"),this.error=t.get("error"),this.error_description=t.get("error_description"),this.error_uri=t.get("error_uri")}},F1e=["nbf","jti","auth_time","nonce","acr","amr","azp","at_hash"],$1e=["sub","iss","aud","exp","iat"],B1e=class{constructor(t){this._settings=t,this._logger=new qr("ClaimsService")}filterProtocolClaims(t){const e={...t};if(this._settings.filterProtocolClaims){let n;Array.isArray(this._settings.filterProtocolClaims)?n=this._settings.filterProtocolClaims:n=F1e;for(const r of n)$1e.includes(r)||delete e[r]}return e}mergeClaims(t,e){const n={...t};for(const[r,i]of Object.entries(e))if(n[r]!==i)if(Array.isArray(n[r])||Array.isArray(i))if(this._settings.mergeClaimsStrategy.array=="replace")n[r]=i;else{const s=Array.isArray(n[r])?n[r]:[n[r]];for(const o of Array.isArray(i)?i:[i])s.includes(o)||s.push(o);n[r]=s}else typeof n[r]=="object"&&typeof i=="object"?n[r]=this.mergeClaims(n[r],i):n[r]=i;return n}},H1e=class{constructor(t,e){this.keys=t,this.nonce=e}},vP=class{constructor(t,e){this._logger=new qr("OidcClient"),this.settings=t instanceof KA?t:new KA(t),this.metadataService=e??new aQ(this.settings),this._claimsService=new B1e(this.settings),this._validator=new P1e(this.settings,this.metadataService,this._claimsService),this._tokenClient=new cQ(this.settings,this.metadataService)}async createSigninRequest({state:t,request:e,request_uri:n,request_type:r,id_token_hint:i,login_hint:s,skipUserInfo:o,nonce:a,url_state:c,response_type:l=this.settings.response_type,scope:d=this.settings.scope,redirect_uri:h=this.settings.redirect_uri,prompt:m=this.settings.prompt,display:g=this.settings.display,max_age:y=this.settings.max_age,ui_locales:v=this.settings.ui_locales,acr_values:E=this.settings.acr_values,resource:w=this.settings.resource,response_mode:R=this.settings.response_mode,extraQueryParams:x=this.settings.extraQueryParams,extraTokenParams:C=this.settings.extraTokenParams,dpopJkt:k,omitScopeWhenRequesting:T=this.settings.omitScopeWhenRequesting}){const L=this._logger.create("createSigninRequest");if(l!=="code")throw new Error("Only the Authorization Code flow (with PKCE) is supported");const O=await this.metadataService.getAuthorizationEndpoint();L.debug("Received authorization endpoint",O);const P=await D1e.create({url:O,authority:this.settings.authority,client_id:this.settings.client_id,redirect_uri:h,response_type:l,scope:d,state_data:t,url_state:c,prompt:m,display:g,max_age:y,ui_locales:v,id_token_hint:i,login_hint:s,acr_values:E,dpopJkt:k,resource:w,request:e,request_uri:n,extraQueryParams:x,extraTokenParams:C,request_type:r,response_mode:R,client_secret:this.settings.client_secret,skipUserInfo:o,nonce:a,disablePKCE:this.settings.disablePKCE,omitScopeWhenRequesting:T});await this.clearStaleState();const D=P.state;return await this.settings.stateStore.set(D.id,D.toStorageString()),P}async readSigninResponseState(t,e=!1){const n=this._logger.create("readSigninResponseState"),r=new mE(AB.readParams(t,this.settings.response_mode));if(!r.state)throw n.throw(new Error("No state in response")),null;const i=await this.settings.stateStore[e?"remove":"get"](r.state);if(!i)throw n.throw(new Error("No matching state found in storage")),null;return{state:await gP.fromStorageString(i),response:r}}async processSigninResponse(t,e){const n=this._logger.create("processSigninResponse"),{state:r,response:i}=await this.readSigninResponseState(t,!0);if(n.debug("received state from storage; validating response"),this.settings.dpop&&this.settings.dpop.store){const s=await this.getDpopProof(this.settings.dpop.store);e={...e,DPoP:s}}try{await this._validator.validateSigninResponse(i,r,e)}catch(s){if(s instanceof VA&&this.settings.dpop){const o=await this.getDpopProof(this.settings.dpop.store,s.nonce);e.DPoP=o,await this._validator.validateSigninResponse(i,r,e)}else throw s}return i}async getDpopProof(t,e){let n,r;return(await t.getAllKeys()).includes(this.settings.client_id)?(r=await t.get(this.settings.client_id),r.nonce!==e&&e&&(r.nonce=e,await t.set(this.settings.client_id,r))):(n=await Oc.generateDPoPKeys(),r=new H1e(n,e),await t.set(this.settings.client_id,r)),await Oc.generateDPoPProof({url:await this.metadataService.getTokenEndpoint(!1),httpMethod:"POST",keyPair:r.keys,nonce:r.nonce})}async processResourceOwnerPasswordCredentials({username:t,password:e,skipUserInfo:n=!1,extraTokenParams:r={}}){const i=await this._tokenClient.exchangeCredentials({username:t,password:e,...r}),s=new mE(new URLSearchParams);return Object.assign(s,i),await this._validator.validateCredentialsResponse(s,n),s}async useRefreshToken({state:t,redirect_uri:e,resource:n,timeoutInSeconds:r,extraHeaders:i,extraTokenParams:s}){var o;const a=this._logger.create("useRefreshToken");let c;if(this.settings.refreshTokenAllowedScope===void 0)c=t.scope;else{const h=this.settings.refreshTokenAllowedScope.split(" ");c=(((o=t.scope)==null?void 0:o.split(" "))||[]).filter(g=>h.includes(g)).join(" ")}if(this.settings.dpop&&this.settings.dpop.store){const h=await this.getDpopProof(this.settings.dpop.store);i={...i,DPoP:h}}let l;try{l=await this._tokenClient.exchangeRefreshToken({refresh_token:t.refresh_token,scope:c,redirect_uri:e,resource:n,timeoutInSeconds:r,extraHeaders:i,...s})}catch(h){if(h instanceof VA&&this.settings.dpop)i.DPoP=await this.getDpopProof(this.settings.dpop.store,h.nonce),l=await this._tokenClient.exchangeRefreshToken({refresh_token:t.refresh_token,scope:c,redirect_uri:e,resource:n,timeoutInSeconds:r,extraHeaders:i,...s});else throw h}const d=new mE(new URLSearchParams);return Object.assign(d,l),a.debug("validating response",d),await this._validator.validateRefreshResponse(d,{...t,scope:c}),d}async createSignoutRequest({state:t,id_token_hint:e,client_id:n,request_type:r,post_logout_redirect_uri:i=this.settings.post_logout_redirect_uri,extraQueryParams:s=this.settings.extraQueryParams}={}){const o=this._logger.create("createSignoutRequest"),a=await this.metadataService.getEndSessionEndpoint();if(!a)throw o.throw(new Error("No end session endpoint")),null;o.debug("Received end session endpoint",a),!n&&i&&!e&&(n=this.settings.client_id);const c=new U1e({url:a,id_token_hint:e,client_id:n,post_logout_redirect_uri:i,state_data:t,extraQueryParams:s,request_type:r});await this.clearStaleState();const l=c.state;return l&&(o.debug("Signout request has state to persist"),await this.settings.stateStore.set(l.id,l.toStorageString())),c}async readSignoutResponseState(t,e=!1){const n=this._logger.create("readSignoutResponseState"),r=new j1e(AB.readParams(t,this.settings.response_mode));if(!r.state){if(n.debug("No state in response"),r.error)throw n.warn("Response was error:",r.error),new Av(r);return{state:void 0,response:r}}const i=await this.settings.stateStore[e?"remove":"get"](r.state);if(!i)throw n.throw(new Error("No matching state found in storage")),null;return{state:await PC.fromStorageString(i),response:r}}async processSignoutResponse(t){const e=this._logger.create("processSignoutResponse"),{state:n,response:r}=await this.readSignoutResponseState(t,!0);return n?(e.debug("Received state from storage; validating response"),this._validator.validateSignoutResponse(r,n)):e.debug("No state from storage; skipping response validation"),r}clearStaleState(){return this._logger.create("clearStaleState"),PC.clearStaleState(this.settings.stateStore,this.settings.staleStateAgeInSeconds)}async revokeToken(t,e){return this._logger.create("revokeToken"),await this._tokenClient.revoke({token:t,token_type_hint:e})}},fs=(function(t){return t.NotSupported="OIDC authentication not supported",t.Misconfigured="OIDC is misconfigured",t.General="Something went wrong with OIDC discovery",t.OpSupport="Configured OIDC OP does not support required functions",t.DynamicRegistrationNotSupported="Dynamic registration not supported",t.DynamicRegistrationFailed="Dynamic registration failed",t.DynamicRegistrationInvalid="Dynamic registration invalid response",t.CodeExchangeFailed="Failed to exchange code for token",t.InvalidBearerTokenResponse="Invalid bearer token response",t.InvalidIdToken="Invalid ID token",t.MissingOrInvalidStoredState="State required to finish logging in is not found in storage.",t})({}),yP=t=>!!t&&typeof t=="object"&&!Array.isArray(t),$u=(t,e)=>!t[e]||!G1(t,e)?(N.error("Missing or invalid property: ".concat(e)),!1):!0,G1=(t,e)=>t[e]&&typeof t[e]!="string"?(N.error("Invalid property: ".concat(e)),!1):!0,LB=(t,e)=>t[e]&&(!Array.isArray(t[e])||!t[e].every(n=>typeof n=="string"))?(N.error("Invalid property: ".concat(e)),!1):!0,ox=(t,e,n)=>{var r=t[e];return!r||!Array.isArray(r)||!r.includes(n)?(N.error("Invalid property: ".concat(e,". ").concat(n," is required.")),!1):!0},dQ=t=>{if(!yP(t))throw N.error("Issuer configuration not found or malformed"),new Error(fs.OpSupport);var e=[$u(t,"issuer"),$u(t,"authorization_endpoint"),$u(t,"token_endpoint"),$u(t,"revocation_endpoint"),G1(t,"registration_endpoint"),G1(t,"account_management_uri"),G1(t,"device_authorization_endpoint"),LB(t,"account_management_actions_supported"),ox(t,"response_types_supported","code"),ox(t,"grant_types_supported",Nb.AuthorizationCode),ox(t,"code_challenge_methods_supported","S256"),LB(t,"prompt_values_supported")].some(n=>!n);if(!e)return t;throw N.error("Issuer configuration not valid"),new Error(fs.OpSupport)},fQ=t=>{try{return sQ(t)}catch(e){throw N.error("Could not decode id_token",e),e}},hQ=(t,e,n,r)=>{try{if(!t)throw new Error("No ID token");var i=fQ(t);if(i.iss!==e)throw new Error("Invalid issuer");var s=typeof i.aud=="string"?[i.aud]:i.aud;if(!s.includes(n))throw new Error("Invalid audience");if(r!==void 0&&i.nonce!==r)throw new Error("Invalid nonce");if(!i.exp||Date.now()>i.exp*1e3)throw new Error("Invalid expiry")}catch(o){throw N.error("Invalid ID token",o),new Error(fs.InvalidIdToken)}};function pQ(t){if(!yP(t))throw N.error("Stored user state not found"),new Error(fs.MissingOrInvalidStoredState);var e=[$u(t,"homeserverUrl"),$u(t,"nonce"),G1(t,"identityServerUrl")].some(n=>!n);if(e)throw new Error(fs.MissingOrInvalidStoredState)}var q1e=t=>yP(t)&&$u(t,"token_type")&&t.token_type.toLowerCase()==="bearer"&&$u(t,"access_token")&&$u(t,"refresh_token")&&(!("expires_in"in t)||typeof t.expires_in=="number");function mQ(t){if(!q1e(t))throw new Error(fs.InvalidBearerTokenResponse)}function MB(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function DC(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?MB(Object(n),!0).forEach(function(r){M(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):MB(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var IT=t=>{var e=t??Qo(10);return"openid urn:matrix:org.matrix.msc2967.client:api:* urn:matrix:org.matrix.msc2967.client:device:".concat(e)},V1e=(function(){var t=B(function*(e){if(!globalThis.crypto.subtle)return N.warn("A secure context is required to generate code challenge. Using plain text code challenge"),e;var n=yield fP(e);return ST(n)});return function(n){return t.apply(this,arguments)}})(),K1e=t=>{var{redirectUri:e}=t;return{scope:IT(),redirectUri:e,state:Qo(8),nonce:Qo(8),codeVerifier:Qo(64)}},G1e=(function(){var t=B(function*(e,n,r){var{scope:i,redirectUri:s,state:o,nonce:a,codeVerifier:c}=r,l=new URL(e);return l.searchParams.append("response_mode","query"),l.searchParams.append("response_type","code"),l.searchParams.append("redirect_uri",s),l.searchParams.append("client_id",n),l.searchParams.append("state",o),l.searchParams.append("scope",i),l.searchParams.append("nonce",a),l.searchParams.append("code_challenge_method","S256"),l.searchParams.append("code_challenge",yield V1e(c)),l.toString()});return function(n,r,i){return t.apply(this,arguments)}})(),z1e=(function(){var t=B(function*(e){var{metadata:n,redirectUri:r,clientId:i,homeserverUrl:s,identityServerUrl:o,nonce:a,prompt:c,urlState:l,loginHint:d}=e,h=IT(),m=new vP(DC(DC({},n),{},{client_id:i,redirect_uri:r,authority:n.issuer,response_mode:"query",response_type:"code",scope:h,stateStore:new kT({prefix:"mx_oidc_",store:window.sessionStorage})})),g={homeserverUrl:s,nonce:a,identityServerUrl:o},y=yield m.createSigninRequest({state:g,nonce:a,prompt:c,url_state:l,login_hint:d});return y.url});return function(n){return t.apply(this,arguments)}})(),W1e=t=>({id_token:t.id_token,scope:t.scope,expires_at:t.expires_at,refresh_token:t.refresh_token,access_token:t.access_token,token_type:"Bearer"}),Y1e=(function(){var t=B(function*(e,n){var r=new URL(window.location.origin);r.searchParams.append("code",e),r.searchParams.append("state",n),Db.setLogger(N);try{var i=new mE(r.searchParams),s=new kT({prefix:"mx_oidc_",store:window.sessionStorage}),o=yield s.get(i.state);if(!o)throw new Error(fs.MissingOrInvalidStoredState);var a=yield gP.fromStorageString(o),c=new vP(DC(DC({},a),{},{stateStore:s})),l=yield c.processSigninResponse(r.href),d=l.userState;pQ(d),mQ(l),hQ(l.id_token,c.settings.authority,c.settings.client_id,d.nonce);var h=W1e(l);return{oidcClientSettings:{clientId:c.settings.client_id,issuer:c.settings.authority},tokenResponse:h,homeserverUrl:d.homeserverUrl,identityServerUrl:d.identityServerUrl,idTokenClaims:l.profile}}catch(g){N.error("Oidc login failed",g);var m=g.message;throw Object.values(fs).includes(m)?g:new Error(fs.CodeExchangeFailed)}});return function(n,r){return t.apply(this,arguments)}})();function OB(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function PB(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?OB(Object(n),!0).forEach(function(r){M(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):OB(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var bP=(function(){var t=B(function*(e){var n=new URL(".well-known/openid-configuration",e),r=yield fetch(n,{method:fe.Get,signal:bT(5e3)}),i=yield r.json();return _P(i)});return function(n){return t.apply(this,arguments)}})(),_P=(function(){var t=B(function*(e){var n=dQ(e),r=new KA({authority:n.issuer,metadata:n,redirect_uri:"",client_id:""}),i=new aQ(r);return PB(PB({},n),{},{signingKeys:yield i.getSigningKeys()})});return function(n){return t.apply(this,arguments)}})(),Nb=(function(t){return t.AuthorizationCode="authorization_code",t.RefreshToken="refresh_token",t.DeviceAuthorization="urn:ietf:params:oauth:grant-type:device_code",t})({}),X1e=Nb.DeviceAuthorization,ax=(t,e)=>{if(!e)return!1;var n=new URL(e);return!(n.protocol!==t.protocol||n.hostname!==t.hostname&&!n.hostname.endsWith(".".concat(t.hostname)))},J1e=(function(){var t=B(function*(e,n){if(!e.registration_endpoint)throw new Error(fs.DynamicRegistrationNotSupported);var r=[Nb.AuthorizationCode,Nb.RefreshToken];if(r.some(d=>!e.grant_types_supported.includes(d)))throw new Error(fs.DynamicRegistrationNotSupported);var i=new URL(n.clientUri),s={client_name:n.clientName,client_uri:n.clientUri,response_types:["code"],grant_types:r,redirect_uris:n.redirectUris,id_token_signed_response_alg:"RS256",token_endpoint_auth_method:"none",application_type:n.applicationType,contacts:n.contacts,logo_uri:ax(i,n.logoUri)?n.logoUri:void 0,policy_uri:ax(i,n.policyUri)?n.policyUri:void 0,tos_uri:ax(i,n.tosUri)?n.tosUri:void 0},o={Accept:"application/json","Content-Type":"application/json"};try{var a=yield fetch(e.registration_endpoint,{method:fe.Post,headers:o,body:JSON.stringify(s)});if(a.status>=400)throw new Error(fs.DynamicRegistrationFailed);var c=yield a.json(),l=c.client_id;if(!l||typeof l!="string")throw new Error(fs.DynamicRegistrationInvalid);return l}catch(d){throw Object.values(fs).includes(d.message)?d:(N.error("Dynamic registration request failed",d),new Error(fs.DynamicRegistrationFailed))}});return function(n,r){return t.apply(this,arguments)}})();class Q1e{constructor(e,n,r,i,s){this.issuer=e,this.clientId=n,this.redirectUri=r,this.deviceId=i,this.idTokenClaims=s,M(this,"oidcClientReady",void 0),M(this,"initPromise",void 0),M(this,"oidcClient",void 0),M(this,"inflightRefreshRequest",void 0),this.oidcClientReady=Promise.resolve()}ensureInit(){var e=this;return B(function*(){if(!e.oidcClient){if(e.initPromise)return e.initPromise;e.initPromise=e.initialiseOidcClient(e.issuer,e.clientId,e.deviceId,e.redirectUri);try{yield e.initPromise}finally{e.initPromise=void 0}}})()}initialiseOidcClient(e,n,r,i){var s=this;return B(function*(){try{var o,a=yield bP(e),c=IT(r);s.oidcClient=new vP({metadata:a,signingKeys:(o=a.signingKeys)!==null&&o!==void 0?o:void 0,client_id:n,scope:c,redirect_uri:i,authority:a.issuer,stateStore:new kT({prefix:"mx_oidc_",store:window.sessionStorage})})}catch(l){throw N.error("Failed to initialise OIDC client.",l),new Error("Failed to initialise OIDC client.")}})()}doRefreshAccessToken(e){var n=this;return B(function*(){yield n.ensureInit(),n.inflightRefreshRequest||(n.inflightRefreshRequest=n.getNewTokens(e));try{var r=yield n.inflightRefreshRequest;return r}catch(i){throw i instanceof Av?new eP(i):i}finally{n.inflightRefreshRequest=void 0}})()}persistTokens(e){return B(function*(){})()}getNewTokens(e){var n=this;return B(function*(){if(!n.oidcClient)throw new Error("Cannot get new token before OIDC client is initialised.");var r={refresh_token:e,session_state:"test",data:void 0,profile:n.idTokenClaims},i=Date.now(),s=yield n.oidcClient.useRefreshToken({state:r,timeoutInSeconds:300}),o={accessToken:s.access_token,refreshToken:s.refresh_token,expiry:s.expires_in?new Date(i+s.expires_in*1e3):void 0};return yield n.persistTokens(o),o})()}}var Z1e=["server","limit","since"];function DB(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function Xn(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?DB(Object(n),!0).forEach(function(r){M(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):DB(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var ebe=3e3,NB=600*1e3,tbe=new Kr("last_seen_user_agent","org.matrix.msc3852.last_seen_user_agent"),Lv=(function(t){return t.Chronological="chronological",t.Detached="detached",t})({}),nbe=new uy("m.get_login_token","org.matrix.msc3882.get_login_token"),gQ="uk.half-shot.msc2666",vQ="uk.half-shot.msc2666.mutual_rooms",yQ="uk.half-shot.msc2666.query_mutual_rooms",Xi="org.matrix.msc4140",NC="org.matrix.msc4354",bQ="uk.tcpip.msc4133",_Q="uk.tcpip.msc4133.stable",tl="$",Pe=(function(t){return t.Sync="sync",t.Event="event",t.ToDeviceEvent="toDeviceEvent",t.ReceivedToDeviceMessage="receivedToDeviceMessage",t.AccountData="accountData",t.Room="Room",t.DeleteRoom="deleteRoom",t.SyncUnexpectedError="sync.unexpectedError",t.ClientWellKnown="WellKnown.client",t.ReceivedVoipEvent="received_voip_event",t.TurnServers="turnServers",t.TurnServersError="turnServers.error",t})({}),UB=new Kr("action","org.matrix.msc3824.action");class xT extends Gn{constructor(e){var n,r,i,s,o,a;super(),i=this,M(this,"logger",void 0),M(this,"reEmitter",new py(this)),M(this,"olmVersion",null),M(this,"usingExternalCrypto",!1),M(this,"_store",void 0),M(this,"deviceId",void 0),M(this,"credentials",void 0),M(this,"legacyPickleKey",void 0),M(this,"scheduler",void 0),M(this,"clientRunning",!1),M(this,"timelineSupport",!1),M(this,"urlPreviewCache",{}),M(this,"identityServer",void 0),M(this,"http",void 0),M(this,"cryptoBackend",void 0),M(this,"enableEncryptedStateEvents",void 0),M(this,"cryptoCallbacks",void 0),M(this,"callEventHandler",void 0),M(this,"groupCallEventHandler",void 0),M(this,"supportsCallTransfer",!1),M(this,"forceTURN",!1),M(this,"iceCandidatePoolSize",0),M(this,"idBaseUrl",void 0),M(this,"baseUrl",void 0),M(this,"isVoipWithNoMediaAllowed",void 0),M(this,"disableVoip",void 0),M(this,"useLivekitForGroupCalls",void 0),M(this,"canSupportVoip",!1),M(this,"peekSync",null),M(this,"isGuestAccount",!1),M(this,"ongoingScrollbacks",{}),M(this,"notifTimelineSet",null),M(this,"legacyCryptoStore",void 0),M(this,"verificationMethods",void 0),M(this,"fallbackICEServerAllowed",!1),M(this,"syncApi",void 0),M(this,"roomNameGenerator",void 0),M(this,"pushRules",void 0),M(this,"syncLeftRoomsPromise",void 0),M(this,"syncedLeftRooms",!1),M(this,"clientOpts",void 0),M(this,"clientWellKnownIntervalID",void 0),M(this,"canResetTimelineCallback",void 0),M(this,"canSupport",new Map),M(this,"pushProcessor",new bc(this)),M(this,"serverVersionsPromise",void 0),M(this,"clientWellKnown",void 0),M(this,"clientWellKnownPromise",void 0),M(this,"turnServers",[]),M(this,"turnServersExpiry",0),M(this,"checkTurnServersIntervalID",void 0),M(this,"txnCtr",0),M(this,"mediaHandler",new F0e(this)),M(this,"sessionId",void 0),M(this,"eventsBeingEncrypted",new Set),M(this,"useE2eForGroupCall",!0),M(this,"toDeviceMessageQueue",void 0),M(this,"livekitServiceURL",void 0),M(this,"_secretStorage",void 0),M(this,"ignoredInvites",void 0),M(this,"matrixRTC",void 0),M(this,"serverCapabilitiesService",void 0),M(this,"startCallEventHandler",()=>{this.isInitialSyncComplete()&&(xA()&&(this.callEventHandler.start(),this.groupCallEventHandler.start()),this.off(Pe.Sync,this.startCallEventHandler))}),M(this,"startMatrixRTC",()=>{this.isInitialSyncComplete()&&(this.matrixRTC.start(),this.off(Pe.Sync,this.startMatrixRTC))}),M(this,"fixupRoomNotifications",()=>{if(this.isInitialSyncComplete()){var l,d=((l=this.getRooms())!==null&&l!==void 0?l:[]).filter(g=>g.getUnreadNotificationCount(sn.Total)>0);for(var h of d){var m=this.getSafeUserId();h.fixupNotifications(m)}this.off(Pe.Sync,this.fixupRoomNotifications)}}),this.logger=(n=e.logger)!==null&&n!==void 0?n:N,e.baseUrl=VI(e.baseUrl),e.idBaseUrl=VI(e.idBaseUrl),this.baseUrl=e.baseUrl,this.idBaseUrl=e.idBaseUrl,this.identityServer=e.identityServer,this.usingExternalCrypto=(r=e.usingExternalCrypto)!==null&&r!==void 0?r:!1,this.store=e.store||new Hye,this.deviceId=e.deviceId||null,this.sessionId=Qo(10);var c=e.userId||null;this.credentials={userId:c},this.http=new UJ(this,{fetchFn:e.fetchFn,baseUrl:e.baseUrl,idBaseUrl:e.idBaseUrl,accessToken:e.accessToken,refreshToken:e.refreshToken,tokenRefreshFunction:e.tokenRefreshFunction,prefix:fr.V3,onlyData:!0,extraParams:e.queryParams,localTimeoutMs:e.localTimeoutMs,useAuthorizationHeader:e.useAuthorizationHeader,logger:this.logger}),e.pickleKey&&(this.legacyPickleKey=e.pickleKey),this.useLivekitForGroupCalls=!!e.useLivekitForGroupCalls,this.scheduler=e.scheduler,this.scheduler&&this.scheduler.setProcessFunction((function(){var l=B(function*(d){var h=i.getRoom(d.getRoomId());d.status!==lt.SENDING&&i.updatePendingEventStatus(h,d,lt.SENDING);var m=yield i.sendEventHttpRequest(d);return h&&h.updatePendingEvent(d,lt.SENT,m.event_id),m});return function(d){return l.apply(this,arguments)}})()),this.disableVoip=(s=e.disableVoip)!==null&&s!==void 0?s:!1,!this.disableVoip&&xA()&&(this.callEventHandler=new a0e(this),this.groupCallEventHandler=new c0e(this),this.canSupportVoip=!0,this.on(Pe.Sync,this.startCallEventHandler)),this.matrixRTC=new S1e(this.logger,this),this.serverCapabilitiesService=new FJ(this.logger,this.http),this.on(Pe.Sync,this.fixupRoomNotifications),this.timelineSupport=!!e.timelineSupport,this.legacyCryptoStore=e.cryptoStore,this.verificationMethods=e.verificationMethods,this.cryptoCallbacks=e.cryptoCallbacks||{},this.enableEncryptedStateEvents=(o=e.enableEncryptedStateEvents)!==null&&o!==void 0?o:!1,this.forceTURN=e.forceTURN||!1,this.iceCandidatePoolSize=e.iceCandidatePoolSize===void 0?0:e.iceCandidatePoolSize,this.supportsCallTransfer=e.supportsCallTransfer||!1,this.fallbackICEServerAllowed=e.fallbackICEServerAllowed||!1,this.isVoipWithNoMediaAllowed=e.isVoipWithNoMediaAllowed||!1,e.useE2eForGroupCall!==void 0&&(this.useE2eForGroupCall=e.useE2eForGroupCall),this.livekitServiceURL=e.livekitServiceURL,this.roomNameGenerator=e.roomNameGenerator,this.toDeviceMessageQueue=new z0e(this,this.logger),this.on(Zt.Decrypted,l=>{SQ(this,l)}),this.ignoredInvites=new W0e(this),this._secretStorage=new rQ(this,(a=e.cryptoCallbacks)!==null&&a!==void 0?a:{}),this.setMaxListeners(0)}set store(e){this._store=e,this._store.setUserCreator(n=>qu.createUser(n,this))}get store(){return this._store}startClient(e){var n=this;return B(function*(){if(!n.clientRunning){n.clientRunning=!0,n.on(Pe.Sync,n.startMatrixRTC);var r=n.getUserId();r&&n.store.storeUser(new qu(r)),n.supportsVoip()&&(n.checkTurnServersIntervalID=setInterval(()=>{n.checkTurnServers()},NB),n.checkTurnServers()),n.syncApi&&(n.logger.error("Still have sync object whilst not running: stopping old one"),n.syncApi.stop());try{yield n.getVersions();var{threads:i,list:s,fwdPagination:o}=yield n.doesServerSupportThread();$n.setServerSideSupport(i),$n.setServerSideListSupport(s),$n.setServerSideFwdPaginationSupport(o)}catch(a){n.logger.error("Can't fetch server versions, continuing to initialise sync, this will be retried later",a)}n.clientOpts=e??{},n.clientOpts.slidingSync?n.syncApi=new ZJ(n.clientOpts.slidingSync,n,n.clientOpts,n.buildSyncApiOptions()):n.syncApi=new bf(n,n.clientOpts,n.buildSyncApiOptions()),n.syncApi.sync().catch(a=>n.logger.info("Sync startup aborted with an error:",a)),n.clientOpts.clientWellKnownPollPeriod!==void 0&&(n.clientWellKnownIntervalID=setInterval(()=>{n.fetchClientWellKnown()},1e3*n.clientOpts.clientWellKnownPollPeriod),n.fetchClientWellKnown()),n.toDeviceMessageQueue.start(),n.serverCapabilitiesService.start()}})()}buildSyncApiOptions(){return{cryptoCallbacks:this.cryptoBackend,canResetEntireTimeline:e=>this.canResetTimelineCallback?this.canResetTimelineCallback(e):!1,logger:this.logger.getChild("sync")}}stopClient(){var e,n,r,i,s;(e=this.cryptoBackend)===null||e===void 0||e.stop(),this.off(Pe.Sync,this.startMatrixRTC),this.clientRunning&&(this.logger.debug("stopping MatrixClient"),this.clientRunning=!1,(n=this.syncApi)===null||n===void 0||n.stop(),this.syncApi=void 0,(r=this.peekSync)===null||r===void 0||r.stopPeeking(),(i=this.callEventHandler)===null||i===void 0||i.stop(),(s=this.groupCallEventHandler)===null||s===void 0||s.stop(),this.callEventHandler=void 0,this.groupCallEventHandler=void 0,globalThis.clearInterval(this.checkTurnServersIntervalID),this.checkTurnServersIntervalID=void 0,this.clientWellKnownIntervalID!==void 0&&globalThis.clearInterval(this.clientWellKnownIntervalID),this.toDeviceMessageQueue.stop(),this.matrixRTC.stop(),this.serverCapabilitiesService.stop())}clearStores(){var e=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this.clientRunning)throw new Error("Cannot clear stores while client is running");var r=[];r.push(this.store.deleteAllData()),this.legacyCryptoStore&&r.push(this.legacyCryptoStore.deleteAllData());var i=(function(){var s=B(function*(){var o;try{if(o=globalThis.indexedDB,!o)return}catch{return}var a=function*(m){var g=new Promise((y,v)=>{e.logger.info("Removing IndexedDB instance ".concat(m));var E=o.deleteDatabase(m);E.onsuccess=w=>{e.logger.info("Removed IndexedDB instance ".concat(m)),y(0)},E.onerror=w=>{e.logger.warn("Failed to remove IndexedDB instance ".concat(m,":"),w),y(0)},E.onblocked=w=>{e.logger.info("cannot yet remove IndexedDB instance ".concat(m))}});yield g};for(var c of["".concat((l=n.cryptoDatabasePrefix)!==null&&l!==void 0?l:rx,"::matrix-sdk-crypto"),"".concat((d=n.cryptoDatabasePrefix)!==null&&d!==void 0?d:rx,"::matrix-sdk-crypto-meta")]){var l,d;yield*a(c)}});return function(){return s.apply(this,arguments)}})();return r.push(i()),Promise.all(r).then()}getUserId(){var e,n;return(e=(n=this.credentials)===null||n===void 0?void 0:n.userId)!==null&&e!==void 0?e:null}getSafeUserId(){var e=this.getUserId();if(!e)throw new Error("Expected logged in user but found none.");return e}getDomain(){var e;return(e=this.credentials)!==null&&e!==void 0&&e.userId?this.credentials.userId.replace(/^.*?:/,""):null}getUserIdLocalpart(){var e,n;return(e=(n=this.credentials)===null||n===void 0||(n=n.userId)===null||n===void 0?void 0:n.split(":")[0].substring(1))!==null&&e!==void 0?e:null}getDeviceId(){return this.deviceId}getSessionId(){return this.sessionId}supportsVoip(){return!this.disableVoip&&this.canSupportVoip}getMediaHandler(){return this.mediaHandler}setForceTURN(e){this.forceTURN=e}setSupportsCallTransfer(e){this.supportsCallTransfer=e}getUseE2eForGroupCall(){return this.useE2eForGroupCall}createCall(e){return Ab(this,e)}createGroupCall(e,n,r,i,s,o){var a=this;return B(function*(){if(a.getGroupCallForRoom(e))throw new Error("".concat(e," already has an existing group call"));var c=a.getRoom(e);if(!c)throw new Error("Cannot find room ".concat(e));return new aP(a,c,n,r,i,void 0,s||a.isVoipWithNoMediaAllowed,o,a.isVoipWithNoMediaAllowed,a.useLivekitForGroupCalls,a.livekitServiceURL).create()})()}getLivekitServiceURL(){return this.livekitServiceURL}setLivekitServiceURL(e){this.livekitServiceURL=e}waitUntilRoomReadyForGroupCalls(e){return this.groupCallEventHandler.waitUntilRoomReadyForGroupCalls(e)}getGroupCallForRoom(e){return this.groupCallEventHandler.groupCalls.get(e)||null}getSyncState(){var e,n;return(e=(n=this.syncApi)===null||n===void 0?void 0:n.getSyncState())!==null&&e!==void 0?e:null}getSyncStateData(){return this.syncApi?this.syncApi.getSyncStateData():null}isInitialSyncComplete(){var e=this.getSyncState();return e?e===Qt.Prepared||e===Qt.Syncing:!1}isGuest(){return this.isGuestAccount}setGuest(e){this.isGuestAccount=e}getScheduler(){return this.scheduler}retryImmediately(){var e,n;return this.toDeviceMessageQueue.sendQueue(),(e=(n=this.syncApi)===null||n===void 0?void 0:n.retryImmediately())!==null&&e!==void 0?e:!1}getNotifTimelineSet(){return this.notifTimelineSet}setNotifTimelineSet(e){this.notifTimelineSet=e}getCapabilities(){var e=this;return B(function*(){var n=e.serverCapabilitiesService.getCachedCapabilities();return n||e.serverCapabilitiesService.fetchCapabilities()})()}getCachedCapabilities(){return this.serverCapabilitiesService.getCachedCapabilities()}fetchCapabilities(){return this.serverCapabilitiesService.fetchCapabilities()}initRustCrypto(){var e=arguments,n=this;return B(function*(){var r,i,s=e.length>0&&e[0]!==void 0?e[0]:{};if(n.cryptoBackend){n.logger.warn("Attempt to re-initialise e2e encryption on MatrixClient");return}var o=n.getUserId();if(o===null)throw new Error("Cannot enable encryption on MatrixClient with unknown userId: ensure userId is passed in createClient().");var a=n.getDeviceId();if(a===null)throw new Error("Cannot enable encryption on MatrixClient with unknown deviceId: ensure deviceId is passed in createClient().");n.logger.debug("Downloading Rust crypto library");var c=yield Rb(()=>import("./index-Rt5Cjb-1.js"),__vite__mapDeps([0,1]),import.meta.url),l=yield c.initRustCrypto({logger:n.logger,http:n.http,userId:o,deviceId:a,secretStorage:n.secretStorage,cryptoCallbacks:n.cryptoCallbacks,storePrefix:s.useIndexedDB===!1?null:(r=s.cryptoDatabasePrefix)!==null&&r!==void 0?r:rx,storeKey:s.storageKey,storePassphrase:s.storagePassword,legacyCryptoStore:n.legacyCryptoStore,legacyPickleKey:(i=n.legacyPickleKey)!==null&&i!==void 0?i:"DEFAULT_KEY",legacyMigrationProgressListener:(d,h)=>{n.emit(ki.LegacyCryptoStoreMigrationProgress,d,h)},enableEncryptedStateEvents:n.enableEncryptedStateEvents});l.setSupportedVerificationMethods(n.verificationMethods),n.cryptoBackend=l,n.on(ao.Membership,l.onRoomMembership.bind(l)),n.on(Pe.Event,d=>{l.onLiveEventFromSync(d)}),n.reEmitter.reEmit(l,[ki.VerificationRequestReceived,ki.UserTrustStatusChanged,ki.KeyBackupStatus,ki.KeyBackupSessionsRemaining,ki.KeyBackupFailed,ki.KeyBackupDecryptionKeyCached,ki.KeysChanged,ki.DevicesUpdated,ki.WillUpdateDevices,ki.DehydratedDeviceCreated,ki.DehydratedDeviceUploaded,ki.RehydrationStarted,ki.RehydrationProgress,ki.RehydrationCompleted,ki.RehydrationError,ki.DehydrationKeyCached,ki.DehydratedDeviceRotationError])})()}get secretStorage(){return this._secretStorage}getCrypto(){return this.cryptoBackend}isRoomEncrypted(e){var n=this.getRoom(e);return n?n.hasEncryptionStateEvent():!1}isKeyBackupKeyStored(){return Promise.resolve(this.secretStorage.isStored("m.megolm_backup.v1"))}makeKeyBackupPath(e,n,r){var i;n!==void 0?i=Oe("/room_keys/keys/$roomId/$sessionId",{$roomId:e,$sessionId:n}):e!==void 0?i=Oe("/room_keys/keys/$roomId",{$roomId:e}):i="/room_keys/keys";var s=r===void 0?void 0:{version:r};return{path:i,queryData:s}}deleteKeysFromBackup(e,n,r){var i=this;return B(function*(){var s=i.makeKeyBackupPath(e,n,r);yield i.http.authedRequest(fe.Delete,s.path,s.queryData,void 0,{prefix:fr.V3})})()}getMediaConfig(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n=e?"/media/config":"/config";return this.http.authedRequest(fe.Get,n,void 0,void 0,{prefix:e?fr.V1:Xg.V3})}getRoom(e){return e?this.store.getRoom(e):null}getRooms(){return this.store.getRooms()}getVisibleRooms(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n=this.store.getRooms(),r=new Set(n);for(var i of r){var s=this.findPredecessorRooms(i,!0,e);for(var o of s)r.delete(o)}return Array.from(r)}getUser(e){return this.store.getUser(e)}getUsers(){return this.store.getUsers()}setAccountData(e,n){var r=this;return B(function*(){if(!r.clientRunning)return r.logger.warn("Calling `setAccountData` before the client is started: `getAccountData` may return inconsistent results."),yield xb(5,()=>r.setAccountDataRaw(e,n));var i=r.store.getAccountData(e);if(i&&Ip(i.event.content,n))return{};var s=Promise.withResolvers();function o(c){c.getType()===e&&s.resolve()}r.addListener(Pe.AccountData,o);try{var a=yield xb(5,()=>r.setAccountDataRaw(e,n));return yield s.promise,a}finally{r.removeListener(Pe.AccountData,o)}})()}setAccountDataRaw(e,n){var r=Oe("/user/$userId/account_data/$type",{$userId:this.credentials.userId,$type:e});return this.http.authedRequest(fe.Put,r,void 0,n)}getAccountData(e){return this.store.getAccountData(e)}getAccountDataFromServer(e){var n=this;return B(function*(){if(n.isInitialSyncComplete()){var r=n.store.getAccountData(e);return r?r.getContent():null}var i=Oe("/user/$userId/account_data/$type",{$userId:n.credentials.userId,$type:e});try{return yield n.http.authedRequest(fe.Get,i)}catch(o){var s;if(((s=o.data)===null||s===void 0?void 0:s.errcode)==="M_NOT_FOUND")return null;throw o}})()}deleteAccountData(e){var n=this;return B(function*(){var r=n.canSupport.get(pi.AccountDataDeletion);if(r===hi.Unsupported){yield n.setAccountData(e,{});return}var i=Oe("/user/$userId/account_data/$type",{$userId:n.getSafeUserId(),$type:e}),s=r===hi.Unstable?{prefix:"/_matrix/client/unstable/org.matrix.msc3391"}:void 0;return yield n.http.authedRequest(fe.Delete,i,void 0,void 0,s)})()}getIgnoredUsers(){var e=this.getAccountData(ee.IgnoredUserList);return e!=null&&e.getContent().ignored_users?Object.keys(e.getContent().ignored_users):[]}setIgnoredUsers(e){var n={ignored_users:{}};return e.forEach(r=>{n.ignored_users[r]={}}),this.setAccountData(ee.IgnoredUserList,n)}isUserIgnored(e){return this.getIgnoredUsers().includes(e)}joinRoom(e){var n=arguments,r=this;return B(function*(){var i,s,o=n.length>1&&n[1]!==void 0?n[1]:{},a=r.getRoom(e),c=a?.getMember(r.getSafeUserId()),l=c?.membership,d=l==Ke.Invite&&(i=c==null||(s=c.events.member)===null||s===void 0?void 0:s.getSender())!==null&&i!==void 0?i:null;if(r.logger.debug("joinRoom[".concat(e,"]: preJoinMembership=").concat(l,", inviter=").concat(d,", opts=").concat(JSON.stringify(o))),l==Ke.Join)return a;var h=Promise.resolve();if(o.inviteSignUrl){var m=new URL(o.inviteSignUrl);m.searchParams.set("mxid",r.credentials.userId),h=r.http.requestOtherUrl(fe.Post,m)}var g={};o.viaServers&&(g.via=g.server_name=o.viaServers.slice(0,3));var y={},v=yield h;v&&(y.third_party_signed=v);var E=Oe("/join/$roomid",{$roomid:e}),w=yield r.http.authedRequest(fe.Post,E,g,y),R=w.room_id;if(o.acceptSharedHistory&&d&&r.cryptoBackend){var x=yield r.cryptoBackend.maybeAcceptKeyBundle(R,d);x||r.cryptoBackend.markRoomAsPendingKeyBundle(R,d)}var C=r.getRoom(R);if(C!=null&&C.hasMembershipState(r.credentials.userId,Ke.Join))return C;var k=new bf(r,r.clientOpts,r.buildSyncApiOptions());return k.createRoom(R)})()}knockRoom(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=this.getRoom(e);if(r!=null&&r.hasMembershipState(this.credentials.userId,Ke.Knock))return Promise.resolve({room_id:r.roomId});var i=Oe("/knock/$roomIdOrAlias",{$roomIdOrAlias:e}),s={};if(n.viaServers){var o=Array.isArray(n.viaServers)?n.viaServers.slice(0,3):[n.viaServers];s.server_name=o,s.via=o}var a={};return n.reason&&(a.reason=n.reason),this.http.authedRequest(fe.Post,i,s,a)}resendEvent(e,n){return this.toDeviceMessageQueue.sendQueue(),this.updatePendingEventStatus(n,e,lt.SENDING),this.encryptAndSendEvent(n,e)}cancelPendingEvent(e){if(![lt.QUEUED,lt.NOT_SENT,lt.ENCRYPTING].includes(e.status))throw new Error("cannot cancel an event with status "+e.status);e.status===lt.ENCRYPTING?this.eventsBeingEncrypted.delete(e.getId()):this.scheduler&&e.status===lt.QUEUED&&this.scheduler.removeEventFromQueue(e);var n=this.getRoom(e.getRoomId());this.updatePendingEventStatus(n,e,lt.CANCELLED)}setRoomName(e,n){return this.sendStateEvent(e,ee.RoomName,{name:n})}setRoomTopic(e,n,r){var i=CJ(n,r);return this.sendStateEvent(e,ee.RoomTopic,i)}getRoomTags(e){var n=Oe("/user/$userId/rooms/$roomId/tags",{$userId:this.credentials.userId,$roomId:e});return this.http.authedRequest(fe.Get,n)}setRoomTag(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=Oe("/user/$userId/rooms/$roomId/tags/$tag",{$userId:this.credentials.userId,$roomId:e,$tag:n});return this.http.authedRequest(fe.Put,i,void 0,r)}deleteRoomTag(e,n){var r=Oe("/user/$userId/rooms/$roomId/tags/$tag",{$userId:this.credentials.userId,$roomId:e,$tag:n});return this.http.authedRequest(fe.Delete,r)}setRoomAccountData(e,n,r){var i=Oe("/user/$userId/rooms/$roomId/account_data/$type",{$userId:this.credentials.userId,$roomId:e,$type:n});return this.http.authedRequest(fe.Put,i,void 0,r)}setPowerLevel(e,n,r){var i=this;return B(function*(){var s,o;if(i.clientRunning&&i.isInitialSyncComplete()){var a;o=(a=i.getRoom(e))===null||a===void 0||(a=a.currentState)===null||a===void 0||(a=a.getStateEvents(ee.RoomPowerLevels,""))===null||a===void 0?void 0:a.getContent()}if(!o)try{o=yield i.getStateEvent(e,ee.RoomPowerLevels,"")}catch(d){if(d instanceof In&&d.errcode==="M_NOT_FOUND")o={};else throw d}o=P_(o),(s=o)!==null&&s!==void 0&&s.users||(o.users={});var c=Array.isArray(n)?n:[n];for(var l of c)r==null?delete o.users[l]:o.users[l]=r;return i.sendStateEvent(e,ee.RoomPowerLevels,o,"")})()}unstable_createLiveBeacon(e,n){var r=this;return B(function*(){return r.unstable_setLiveBeacon(e,n)})()}unstable_setLiveBeacon(e,n){var r=this;return B(function*(){return r.sendStateEvent(e,dP.name,n,r.getUserId())})()}sendEvent(e,n,r,i,s){var o,a,c,l;return!(n!=null&&n.startsWith(tl))&&n!==null?(l=i,c=r,a=n,o=null):(l=s,c=i,a=r,o=n),this.addThreadRelationIfNeeded(c,o,e),this.sendCompleteEvent({roomId:e,threadId:o,eventObject:{type:a,content:c},txnId:l})}addThreadRelationIfNeeded(e,n,r){var i;if(n&&!((i=e["m.relates_to"])!==null&&i!==void 0&&i.rel_type)){var s,o,a=!!((s=e["m.relates_to"])!==null&&s!==void 0&&s["m.in_reply_to"]);e["m.relates_to"]=Xn(Xn({},e["m.relates_to"]),{},{rel_type:Rn.name,event_id:n,is_falling_back:!a});var c=(o=this.getRoom(r))===null||o===void 0?void 0:o.getThread(n);if(c&&!a){var l,d;e["m.relates_to"]["m.in_reply_to"]={event_id:(l=(d=c.lastReply(h=>h.isRelation(Rn.name)&&!h.status))===null||d===void 0?void 0:d.getId())!==null&&l!==void 0?l:n}}}}sendCompleteEvent(e){var{roomId:n,threadId:r,eventObject:i,delayOpts:s,queryDict:o,txnId:a}=e;a||(a=this.makeTxnId());var c=new es(Object.assign(i,{event_id:"~"+n+":"+a,user_id:this.credentials.userId,sender:this.credentials.userId,room_id:n,origin_server_ts:new Date().getTime()})),l=this.getRoom(n),d=r?l?.getThread(r):void 0;d&&c.setThread(d),s||(this.reEmitter.reEmit(c,[Zt.Replaced,Zt.VisibilityChange]),l?.reEmitter.reEmit(c,[Zt.BeforeRedaction]));var h=c.getAssociatedId();if(h!=null&&h.startsWith("~")){var m=l?.getPendingEvents().find(y=>y.getId()===h);m?.once(Zt.LocalEventIdReplaced,()=>{c.updateAssociatedId(m.getId())})}var g=c.getType();return this.logger.debug("sendEvent of type ".concat(g," in ").concat(n," with txnId ").concat(a).concat(s?" (delayed event)":"").concat(o?" query params: "+JSON.stringify(o):"")),c.setTxnId(a),c.setStatus(lt.SENDING),s?this.encryptAndSendEvent(l,c,s,o):(l?.addPendingEvent(c,a),c.status===lt.NOT_SENT?Promise.reject(new Error("Event blocked by other events not yet sent")):this.encryptAndSendEvent(l,c,o))}encryptAndSendEvent(e,n,r,i){var s=this;return B(function*(){var o=i;if(r&&xC(r))return s.sendEventHttpRequest(n,r,o);o||(o=r);try{var a;s.eventsBeingEncrypted.add(n.getId());try{yield s.encryptEventIfNeeded(n,e??void 0)}finally{a=!s.eventsBeingEncrypted.delete(n.getId())}if(a)return{};n.status===lt.ENCRYPTING&&s.updatePendingEventStatus(e,n,lt.SENDING);var c=null;return s.scheduler&&(c=s.scheduler.queueEvent(n),c&&s.scheduler.getQueueForEvent(n).length>1&&s.updatePendingEventStatus(e,n,lt.QUEUED)),c||(c=s.sendEventHttpRequest(n,o),e&&(c=c.then(l=>(e.updatePendingEvent(n,lt.SENT,l.event_id),l)))),yield c}catch(l){s.logger.error("Error sending event",l);try{n.error=l,s.updatePendingEventStatus(e,n,lt.NOT_SENT)}catch(d){s.logger.error("Exception in error handler!",d)}throw l instanceof In&&(l.event=n),l}})()}encryptEventIfNeeded(e,n){var r=this;return B(function*(){if(n&&(yield r.shouldEncryptEventForRoom(e,n))&&!(!r.cryptoBackend&&r.usingExternalCrypto)){if(!r.cryptoBackend)throw new Error("This room is configured to use encryption, but your client does not support encryption.");r.updatePendingEventStatus(n,e,lt.ENCRYPTING),yield r.cryptoBackend.encryptEvent(e,n)}})()}shouldEncryptEventForRoom(e,n){var r=this;return B(function*(){var i;return e.isEncrypted()||e.getType()===ee.Reaction||e.isRedaction()?!1:!!(n.hasEncryptionStateEvent()||(yield(i=r.cryptoBackend)===null||i===void 0?void 0:i.isEncryptionEnabledInRoom(n.roomId)))})()}getEncryptedIfNeededEventType(e,n){var r;return n===ee.Reaction?n:(r=this.getRoom(e))!==null&&r!==void 0&&r.hasEncryptionStateEvent()?ee.RoomMessageEncrypted:n}updatePendingEventStatus(e,n,r){e?e.updatePendingEvent(n,r):n.setStatus(r)}sendEventHttpRequest(e,n,r){var i=e.getTxnId();i||(i=this.makeTxnId(),e.setTxnId(i));var s={$roomId:e.getRoomId(),$eventType:e.getWireType(),$stateKey:e.getStateKey(),$txnId:i},o;if(e.isState()){var a="/rooms/$roomId/state/$eventType";e.getStateKey()&&e.getStateKey().length>0&&(a="/rooms/$roomId/state/$eventType/$stateKey"),o=Oe(a,s)}else if(e.isRedaction()&&e.event.redacts){var c="/rooms/$roomId/redact/$redactsEventId/$txnId";o=Oe(c,Xn({$redactsEventId:e.event.redacts},s))}else o=Oe("/rooms/$roomId/send/$eventType/$txnId",s);var l=n&&xC(n)?n:void 0,d=l?r:n,h=e.getWireContent();return l?this.http.authedRequest(fe.Put,o,Xn(Xn({},jB(l)),d),h):this.http.authedRequest(fe.Put,o,d,h).then(m=>(this.logger.debug("Event sent to ".concat(e.getRoomId()," with event id ").concat(m.event_id)),m))}redactEvent(e,n,r,i,s){var o,a,c;(o=r)!==null&&o!==void 0&&o.startsWith(tl)||(s=i,i=r,r=n,n=null);var l=(a=s)===null||a===void 0?void 0:a.reason,d={reason:l};if(((c=s)===null||c===void 0?void 0:c.with_rel_types)!==void 0){if(this.canSupport.get(pi.RelationBasedRedactions)===hi.Unsupported)throw new Error("Server does not support relation based redactions "+"roomId ".concat(e," eventId ").concat(r," txnId: ").concat(i," threadId ").concat(n));var h=this.canSupport.get(pi.RelationBasedRedactions)===hi.Stable?mA.stable:mA.unstable;d[h]=s.with_rel_types}return this.sendCompleteEvent({roomId:e,threadId:n,eventObject:{type:ee.RoomRedaction,content:d,redacts:r},txnId:i})}sendMessage(e,n,r,i){typeof n!="string"&&n!==null&&(i=r,r=n,n=null);var s=ee.RoomMessage,o=r;return this.sendEvent(e,n,s,o,i)}sendTextMessage(e,n,r,i){var s;!((s=n)!==null&&s!==void 0&&s.startsWith(tl))&&n!==null&&(i=r,r=n,n=null);var o=bJ(r);return this.sendMessage(e,n,o,i)}sendNotice(e,n,r,i){var s;!((s=n)!==null&&s!==void 0&&s.startsWith(tl))&&n!==null&&(i=r,r=n,n=null);var o=_J(r);return this.sendMessage(e,n,o,i)}sendEmoteMessage(e,n,r,i){var s;!((s=n)!==null&&s!==void 0&&s.startsWith(tl))&&n!==null&&(i=r,r=n,n=null);var o=SJ(r);return this.sendMessage(e,n,o,i)}sendImageMessage(e,n,r,i){var s,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"Image";!((s=n)!==null&&s!==void 0&&s.startsWith(tl))&&n!==null&&(o=i||"Image",i=r,r=n,n=null);var a={msgtype:Nl.Image,url:r,info:i,body:o};return this.sendMessage(e,n,a)}sendStickerMessage(e,n,r,i){var s,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"Sticker";!((s=n)!==null&&s!==void 0&&s.startsWith(tl))&&n!==null&&(o=i||"Sticker",i=r,r=n,n=null);var a={url:r,info:i,body:o};return this.sendEvent(e,n,ee.Sticker,a)}sendHtmlMessage(e,n,r,i){var s;!((s=n)!==null&&s!==void 0&&s.startsWith(tl))&&n!==null&&(i=r,r=n,n=null);var o=gJ(r,i);return this.sendMessage(e,n,o)}sendHtmlNotice(e,n,r,i){var s;!((s=n)!==null&&s!==void 0&&s.startsWith(tl))&&n!==null&&(i=r,r=n,n=null);var o=vJ(r,i);return this.sendMessage(e,n,o)}sendHtmlEmote(e,n,r,i){var s;!((s=n)!==null&&s!==void 0&&s.startsWith(tl))&&n!==null&&(i=r,r=n,n=null);var o=yJ(r,i);return this.sendMessage(e,n,o)}_unstable_sendDelayedEvent(e,n,r,i,s,o){var a=this;return B(function*(){if(!(yield a.doesServerSupportUnstableFeature(Xi)))throw new Wo("Server does not support the delayed events API","sendDelayedEvent");return a.addThreadRelationIfNeeded(s,r,e),a.sendCompleteEvent({roomId:e,threadId:r,eventObject:{type:i,content:s},delayOpts:n,txnId:o})})()}_unstable_sendStickyDelayedEvent(e,n,r,i,s,o,a){var c=this;return B(function*(){if(!(yield c.doesServerSupportUnstableFeature(Xi)))throw new Wo("Server does not support the delayed events API","getDelayedEvents");if(!(yield c.doesServerSupportUnstableFeature(NC)))throw new FA("Server does not support the sticky events","sendStickyEvent");return c.addThreadRelationIfNeeded(o,i,e),c.sendCompleteEvent({roomId:e,threadId:i,eventObject:{type:s,content:o},queryDict:{"org.matrix.msc4354.sticky_duration_ms":n},delayOpts:r,txnId:a})})()}_unstable_sendDelayedStateEvent(e,n,r,i){var s=arguments,o=this;return B(function*(){var a=s.length>4&&s[4]!==void 0?s[4]:"",c=s.length>5&&s[5]!==void 0?s[5]:{};if(!(yield o.doesServerSupportUnstableFeature(Xi)))throw new Wo("Server does not support the delayed events API","sendDelayedStateEvent");var l={$roomId:e,$eventType:r,$stateKey:a},d=Oe("/rooms/$roomId/state/$eventType",l);return a!==void 0&&(d=Oe(d+"/$stateKey",l)),o.http.authedRequest(fe.Put,d,jB(n),i,c)})()}_unstable_sendStickyEvent(e,n,r,i,s,o){var a=this;return B(function*(){if(!(yield a.doesServerSupportUnstableFeature(NC)))throw new FA("Server does not support the sticky events","sendStickyEvent");return a.addThreadRelationIfNeeded(s,r,e),a.sendCompleteEvent({roomId:e,threadId:r,eventObject:{type:i,content:s},queryDict:{"org.matrix.msc4354.sticky_duration_ms":n},txnId:o})})()}_unstable_getDelayedEvents(e,n,r){var i=this;return B(function*(){if(!(yield i.doesServerSupportUnstableFeature(Xi)))throw new Wo("Server does not support the delayed events API","getDelayedEvents");var s={from:r,status:e,delay_id:n};return yield i.http.authedRequest(fe.Get,"/delayed_events",s,void 0,{prefix:"".concat(fr.Unstable,"/").concat(Xi)})})()}_unstable_updateDelayedEvent(e,n){var r=arguments,i=this;return B(function*(){var s=r.length>2&&r[2]!==void 0?r[2]:{};if(!(yield i.doesServerSupportUnstableFeature(Xi)))throw new Wo("Server does not support the delayed events API","updateDelayedEvent");return yield i.updateScheduledDelayedEventWithActionInBody(e,n,s)})()}_unstable_cancelScheduledDelayedEvent(e){var n=arguments,r=this;return B(function*(){var i=n.length>1&&n[1]!==void 0?n[1]:{};return yield r.updateScheduledDelayedEvent(e,vp.Cancel,i)})()}_unstable_restartScheduledDelayedEvent(e){var n=arguments,r=this;return B(function*(){var i=n.length>1&&n[1]!==void 0?n[1]:{};return yield r.updateScheduledDelayedEvent(e,vp.Restart,i)})()}_unstable_sendScheduledDelayedEvent(e){var n=arguments,r=this;return B(function*(){var i=n.length>1&&n[1]!==void 0?n[1]:{};return yield r.updateScheduledDelayedEvent(e,vp.Send,i)})()}updateScheduledDelayedEvent(e,n){var r=arguments,i=this;return B(function*(){var s=r.length>2&&r[2]!==void 0?r[2]:{};if(!(yield i.doesServerSupportUnstableFeature(Xi)))throw new Wo("Server does not support the delayed events API","".concat(n,"ScheduledDelayedEvent"));try{var o=Oe("/delayed_events/$delayId/$action",{$delayId:e,$action:n});return yield i.http.request(fe.Post,o,void 0,void 0,Xn(Xn({},s),{},{prefix:"".concat(fr.Unstable,"/").concat(Xi)}))}catch(a){if(a instanceof In&&a.errcode==="M_UNRECOGNIZED")return yield i.updateScheduledDelayedEventWithActionInBody(e,n,s);throw a}})()}updateScheduledDelayedEventWithActionInBody(e,n){var r=arguments,i=this;return B(function*(){var s=r.length>2&&r[2]!==void 0?r[2]:{},o=Oe("/delayed_events/$delayId",{$delayId:e}),a={action:n};try{return yield i.http.request(fe.Post,o,void 0,a,Xn(Xn({},s),{},{prefix:"".concat(fr.Unstable,"/").concat(Xi)}))}catch(c){if(c instanceof In&&c.errcode==="M_MISSING_TOKEN")return yield i.http.authedRequest(fe.Post,o,void 0,a,Xn(Xn({},s),{},{prefix:"".concat(fr.Unstable,"/").concat(Xi)}));throw c}})()}sendReceipt(e,n,r){var i=arguments,s=this;return B(function*(){var o=i.length>3&&i[3]!==void 0?i[3]:!1;if(s.isGuest())return Promise.resolve({});var a=Oe("/rooms/$roomId/receipt/$receiptType/$eventId",{$roomId:e.getRoomId(),$receiptType:n,$eventId:e.getId()}),c=!o&&s.supportsThreads(),l=c?Xn(Xn({},r),{},{thread_id:Mv(e)}):r,d=s.http.authedRequest(fe.Post,a,void 0,l||{}),h=s.getRoom(e.getRoomId());return h&&s.credentials.userId&&h.addLocalEchoReceipt(s.credentials.userId,e,n,o),d})()}sendReadReceipt(e){var n=arguments,r=this;return B(function*(){var i=n.length>1&&n[1]!==void 0?n[1]:xs.Read,s=n.length>2&&n[2]!==void 0?n[2]:!1;if(e){var o=e.getId(),a=r.getRoom(e.getRoomId());if(a!=null&&a.hasPendingEvent(o))throw new Error("Cannot set read receipt to a pending event (".concat(o,")"));return r.sendReceipt(e,i,{},s)}})()}setRoomReadMarkers(e,n,r,i){var s=this;return B(function*(){var o=s.getRoom(e);if(o!=null&&o.hasPendingEvent(n))throw new Error("Cannot set read marker to a pending event (".concat(n,")"));var a;if(r){if(a=r.getId(),o!=null&&o.hasPendingEvent(a))throw new Error("Cannot set read receipt to a pending event (".concat(a,")"));o?.addLocalEchoReceipt(s.credentials.userId,r,xs.Read)}var c;if(i){if(c=i.getId(),o!=null&&o.hasPendingEvent(c))throw new Error("Cannot set read receipt to a pending event (".concat(c,")"));o?.addLocalEchoReceipt(s.credentials.userId,i,xs.ReadPrivate)}return yield s.setRoomReadMarkersHttpRequest(e,n,a,c)})()}sendRtcDecline(e,n){return this.sendEvent(e,ee.RTCDecline,{"m.relates_to":{event_id:n,rel_type:vn.Reference}})}getUrlPreview(e,n){n=Math.floor(n/6e4)*6e4;var r=new URL(e);r.hash="",e=r.toString();var i=n+"_"+e;if(i in this.urlPreviewCache)return this.urlPreviewCache[i];var s=this.http.authedRequest(fe.Get,"/preview_url",{url:e,ts:n.toString()},void 0,{prefix:Xg.V3,priority:"low"});return this.urlPreviewCache[i]=s,s}sendTyping(e,n,r){if(this.isGuest())return Promise.resolve({});var i=Oe("/rooms/$roomId/typing/$userId",{$roomId:e,$userId:this.getUserId()}),s={typing:n};return n&&(s.timeout=r||2e4),this.http.authedRequest(fe.Put,i,void 0,s)}getRoomUpgradeHistory(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=this.getRoom(e);if(!i)return[];var s=this.findPredecessorRooms(i,n,r),o=this.findSuccessorRooms(i,n,r);return[...s,i,...o]}findPredecessorRooms(e,n,r){for(var i,s=[],o=new Set([e.roomId]),a=(i=e.findPredecessor(r))===null||i===void 0?void 0:i.roomId;a!==null;){var c;if(a){if(o.has(a))break;o.add(a)}var l=this.getRoom(a);if(l===null)break;if(n){var d=l.currentState.getStateEvents(ee.RoomTombstone,"");if(!d||d.getContent().replacement_room!==e.roomId)break}s.splice(0,0,l),e=l,a=(c=e.findPredecessor(r))===null||c===void 0?void 0:c.roomId}return s}findSuccessorRooms(e,n,r){for(var i=[],s=e.currentState.getStateEvents(ee.RoomTombstone,"");s;){var o=this.getRoom(s.getContent().replacement_room);if(!o||o.roomId===e.roomId)break;if(n){var a,c=(a=o.findPredecessor(r))===null||a===void 0?void 0:a.roomId;if(!c||c!==e.roomId)break}i.push(o);var l=new Set(i.map(d=>d.roomId));if(l.size<i.length)return i.slice(0,i.length-1);e=o,s=e.currentState.getStateEvents(ee.RoomTombstone,"")}return i}invite(e,n){var r=arguments,i=this;return B(function*(){var s=r.length>2&&r[2]!==void 0?r[2]:{};if(typeof s!="object"&&(s={reason:s}),s.shareEncryptedHistory){var o;yield(o=i.cryptoBackend)===null||o===void 0?void 0:o.shareRoomHistoryWithUser(e,n)}return yield i.membershipChange(e,n,Ke.Invite,s.reason)})()}inviteByEmail(e,n){return this.inviteByThreePid(e,"email",n)}inviteByThreePid(e,n,r){var i=this;return B(function*(){var s,o=Oe("/rooms/$roomId/invite",{$roomId:e}),a=i.getIdentityServerUrl(!0);if(!a)return Promise.reject(new In({error:"No supplied identity server URL",errcode:"ORG.MATRIX.JSSDK_MISSING_PARAM"}));var c={id_server:a,medium:n,address:r};if((s=i.identityServer)!==null&&s!==void 0&&s.getAccessToken){var l=yield i.identityServer.getAccessToken();l&&(c.id_access_token=l)}return i.http.authedRequest(fe.Post,o,void 0,c)})()}leave(e){return this.membershipChange(e,void 0,Ke.Leave)}leaveRoomChain(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=this.getRoomUpgradeHistory(e,!0),i=r;if(!n){i=[];for(var s of r)if(i.push(s),s.roomId===e)break}var o={},a=[],c=d=>this.leave(d).then(()=>{delete o[d]}).catch(h=>{o[d]=h});for(var l of i)a.push(c(l.roomId));return Promise.all(a).then(()=>o)}ban(e,n,r){return this.membershipChange(e,n,Ke.Ban,r)}forget(e){var n=arguments,r=this;return B(function*(){var i=n.length>1&&n[1]!==void 0?n[1]:!0,s=Oe("/rooms/$room_id/forget",{$room_id:e}),o=yield r.http.authedRequest(fe.Post,s);return i&&(r.store.removeRoom(e),r.emit(Pe.DeleteRoom,e)),o})()}unban(e,n){var r=Oe("/rooms/$roomId/unban",{$roomId:e}),i={user_id:n};return this.http.authedRequest(fe.Post,r,void 0,i)}kick(e,n,r){var i=Oe("/rooms/$roomId/kick",{$roomId:e}),s={user_id:n,reason:r};return this.http.authedRequest(fe.Post,i,void 0,s)}membershipChange(e,n,r,i){var s=Oe("/rooms/$room_id/$membership",{$room_id:e,$membership:r});return this.http.authedRequest(fe.Post,s,void 0,{user_id:n,reason:i})}getPushActionsForEvent(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!e.getPushActions()||n){var{actions:r,rule:i}=this.pushProcessor.actionsAndRuleForEvent(e);e.setPushDetails(r,i)}return e.getPushActions()}getPushDetailsForEvent(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!e.getPushDetails()||n){var{actions:r,rule:i}=this.pushProcessor.actionsAndRuleForEvent(e);e.setPushDetails(r,i)}return e.getPushDetails()}setProfileInfo(e,n){var r=Oe("/profile/$userId/$info",{$userId:this.credentials.userId,$info:e});return this.http.authedRequest(fe.Put,r,void 0,n)}setDisplayName(e){var n=this;return B(function*(){var r=yield n.setProfileInfo("displayname",{displayname:e}),i=n.getUser(n.getUserId());return i&&(i.displayName=e,i.emit(Yi.DisplayName,i.events.presence,i)),r})()}setAvatarUrl(e){var n=this;return B(function*(){var r=yield n.setProfileInfo("avatar_url",{avatar_url:e}),i=n.getUser(n.getUserId());return i&&(i.avatarUrl=e,i.emit(Yi.AvatarUrl,i.events.presence,i)),r})()}mxcUrlToHttp(e,n,r,i,s,o,a){return gT(this.baseUrl,e,n,r,i,s,o,a)}setSyncPresence(e){var n=this;return B(function*(){var r;(r=n.syncApi)===null||r===void 0||r.setPresence(e)})()}setPresence(e){var n=this;return B(function*(){var r=Oe("/presence/$userId/status",{$userId:n.credentials.userId}),i=["offline","online","unavailable"];if(i.indexOf(e.presence)===-1)throw new Error("Bad presence value: "+e.presence);yield n.http.authedRequest(fe.Put,r,void 0,e)})()}getPresence(e){var n=Oe("/presence/$userId/status",{$userId:e});return this.http.authedRequest(fe.Get,n)}scrollback(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:30,r=0,i=this.ongoingScrollbacks[e.roomId]||{};if(i.promise)return i.promise;if(i.errorTs){var s=Date.now()-i.errorTs;r=Math.max(ebe-s,0)}if(e.oldState.paginationToken===null)return Promise.resolve(e);var o=this.store.scrollback(e,n).length;if(o===n)return Promise.resolve(e);n=n-o;var a=new Promise((c,l)=>{Yp(r).then(()=>this.createMessagesRequest(e.roomId,e.oldState.paginationToken,n,Tt.Backward)).then(d=>{var h,m,g=d.chunk.map(this.getEventMapper());if(d.state){var y=d.state.map(this.getEventMapper());e.currentState.setUnknownStateEvents(y)}var[v,E,w]=e.partitionThreadedEvents(g);this.processAggregatedTimelineEvents(e,v),e.addEventsToTimeline(v,!0,!0,e.getLiveTimeline()),this.processThreadEvents(e,E,!0),w.forEach(R=>e.relations.aggregateChildEvent(R)),e.oldState.paginationToken=(h=d.end)!==null&&h!==void 0?h:null,d.chunk.length===0&&(e.oldState.paginationToken=null),this.store.storeEvents(e,g,(m=d.end)!==null&&m!==void 0?m:null,!0),delete this.ongoingScrollbacks[e.roomId],c(e)}).catch(d=>{this.ongoingScrollbacks[e.roomId]={errorTs:Date.now()},l(d)})});return i={promise:a},this.ongoingScrollbacks[e.roomId]=i,a}getEventMapper(e){return U0e(this,e||{})}getEventContext(e,n){var r=this;return B(function*(){var i,s=Oe("/rooms/$roomId/context/$eventId",{$roomId:e,$eventId:n}),o={limit:"0"};(i=r.clientOpts)!==null&&i!==void 0&&i.lazyLoadMembers&&(o.filter=JSON.stringify(zo.LAZY_LOADING_MESSAGES_FILTER));var a=yield r.http.authedRequest(fe.Get,s,o);if(a.event){var c,l,d;return{start:a.start,end:a.end,event:a.event,events_after:(c=a.events_after)!==null&&c!==void 0?c:[],events_before:(l=a.events_before)!==null&&l!==void 0?l:[],state:(d=a.state)!==null&&d!==void 0?d:[]}}throw new Error("'event' not in '/context' result - homeserver too old?")})()}getEventTimeline(e,n){var r=this;return B(function*(){var i,s,o;if(!r.timelineSupport)throw new Error("timeline support is disabled. Set the 'timelineSupport' parameter to true when creating MatrixClient to enable it.");if(!(e!=null&&e.room))throw new Error("getEventTimeline only supports room timelines");if(e.getTimelineForEvent(n))return e.getTimelineForEvent(n);if(e.thread&&r.supportsThreads()){var a;return(a=yield r.getThreadTimeline(e,n))!==null&&a!==void 0?a:null}var c=yield r.getEventContext(e.room.roomId,n);if(e.getTimelineForEvent(n))return e.getTimelineForEvent(n);var l=r.getEventMapper(),d=l(c.event);if(d.isRelation(Rn.name))return r.logger.warn("Tried loading a regular timeline at the position of a thread event"),null;var h=[...c.events_after.reverse().map(l),d,...c.events_before.map(l)],m=e.getTimelineForEvent(h[0].getId());if(m)m.getState(Ue.BACKWARDS).setUnknownStateEvents(c.state.map(l));else{var g;m=e.addTimeline(),m.initialiseState(c.state.map(l)),m.getState(Ue.FORWARDS).paginationToken=(g=c.end)!==null&&g!==void 0?g:null}var[y,v,E]=e.room.partitionThreadedEvents(h);return e.addEventsToTimeline(y,!0,!1,m,c.start),r.processThreadEvents(e.room,v,!0),r.processAggregatedTimelineEvents(e.room,y),E.forEach(w=>e.relations.aggregateChildEvent(w)),(i=(s=e.getTimelineForEvent(n))!==null&&s!==void 0?s:(o=e.room.findThreadForEvent(d))===null||o===void 0?void 0:o.liveTimeline)!==null&&i!==void 0?i:m})()}getThreadTimeline(e,n){var r=this;return B(function*(){if(!r.supportsThreads())throw new Error("could not get thread timeline: no client support");if(!e.room)throw new Error("could not get thread timeline: not a room timeline");if(!e.thread)throw new Error("could not get thread timeline: not a thread timeline");var i=yield r.getEventContext(e.room.roomId,n),s=r.getEventMapper(),o=s(i.event);if(e.canContain(o)){var a=r.canSupport.get(pi.RelationsRecursion)!==hi.Unsupported;if($n.hasServerSideSupport)if($n.hasServerSideFwdPaginationSupport){var c,l,d;if(!e.thread)throw new Error("could not get thread timeline: not a thread timeline");var h=e.thread,m=yield r.fetchRelations(e.room.roomId,h.id,null,null,{dir:Tt.Backward,from:i.start,recurse:a||void 0}),g=yield r.fetchRelations(e.room.roomId,h.id,null,null,{dir:Tt.Forward,from:i.end,recurse:a||void 0}),y=[...g.chunk.reverse().filter(sx(h.id)).map(s),o,...m.chunk.filter(sx(h.id)).map(s)];for(var v of y){var E;yield(E=e.thread)===null||E===void 0?void 0:E.processEvent(v)}var w=e.getTimelineForEvent(o.getId());if(w?w.getState(Ue.BACKWARDS).setUnknownStateEvents(i.state.map(s)):(w=e.addTimeline(),w.initialiseState(i.state.map(s))),e.addEventsToTimeline(y,!0,!1,w,g.next_batch),!m.next_batch){var R=yield r.fetchRoomEvent(e.room.roomId,h.id);e.addEventsToTimeline([s(R)],!0,!1,w,null)}return w.setPaginationToken((c=m.next_batch)!==null&&c!==void 0?c:null,Tt.Backward),w.setPaginationToken((l=g.next_batch)!==null&&l!==void 0?l:null,Tt.Forward),r.processAggregatedTimelineEvents(e.room,y),(d=e.getTimelineForEvent(n))!==null&&d!==void 0?d:w}else{for(var x,C=e.thread,k=yield r.fetchRelations(e.room.roomId,C.id,Rn.name,null,{dir:Tt.Backward,from:i.start,recurse:a||void 0}),T=[],L=i.end;L;){var O=yield r.fetchRelations(e.room.roomId,C.id,Rn.name,null,{dir:Tt.Forward,from:L,recurse:a||void 0});L=O.next_batch,T.push(...O.chunk)}var P=[...T.reverse().map(s),o,...k.chunk.map(s)];for(var D of P){var j;yield(j=e.thread)===null||j===void 0?void 0:j.processEvent(D)}var H=e.getLiveTimeline();if(H.getState(Ue.BACKWARDS).setUnknownStateEvents(i.state.map(s)),e.addEventsToTimeline(P,!0,!1,H,null),!k.next_batch){var z=yield r.fetchRoomEvent(e.room.roomId,C.id);e.addEventsToTimeline([s(z)],!0,!1,H,null)}return H.setPaginationToken((x=k.next_batch)!==null&&x!==void 0?x:null,Tt.Backward),H.setPaginationToken(null,Tt.Forward),r.processAggregatedTimelineEvents(e.room,P),H}}})()}getLatestTimeline(e){var n=this;return B(function*(){if(!n.timelineSupport)throw new Error("timeline support is disabled. Set the 'timelineSupport' parameter to true when creating MatrixClient to enable it.");if(!e.room)throw new Error("getLatestTimeline only supports room timelines");var r;if(e.threadListType!==null){var i,s=yield n.createThreadListMessagesRequest(e.room.roomId,null,1,Tt.Backward,e.threadListType,e.getFilter());r=(i=s.chunk)===null||i===void 0?void 0:i[0]}else if(e.thread&&$n.hasServerSideSupport){var o,a=n.canSupport.get(pi.RelationsRecursion)!==hi.Unsupported,c=yield n.fetchRelations(e.room.roomId,e.thread.id,Rn.name,null,{dir:Tt.Backward,limit:1,recurse:a||void 0});r=(o=c.chunk)===null||o===void 0?void 0:o[0]}else{var l,d,h=Oe("/rooms/$roomId/messages",{$roomId:e.room.roomId}),m={dir:"b"};(l=n.clientOpts)!==null&&l!==void 0&&l.lazyLoadMembers&&(m.filter=JSON.stringify(zo.LAZY_LOADING_MESSAGES_FILTER));var g=yield n.http.authedRequest(fe.Get,h,m);r=(d=g.chunk)===null||d===void 0?void 0:d[0]}if(!r)throw new Error("No message returned when trying to construct getLatestTimeline");return n.getEventTimeline(e,r.event_id)})()}createMessagesRequest(e,n){var r,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:30,s=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,a=Oe("/rooms/$roomId/messages",{$roomId:e}),c={limit:i.toString(),dir:s};n&&(c.from=n);var l=null;if((r=this.clientOpts)!==null&&r!==void 0&&r.lazyLoadMembers&&(l=Object.assign({},zo.LAZY_LOADING_MESSAGES_FILTER)),o){var d;l=l||{},Object.assign(l,(d=o.getRoomTimelineFilterComponent())===null||d===void 0?void 0:d.toJSON())}return l&&(c.filter=JSON.stringify(l)),this.http.authedRequest(fe.Get,a,c)}createThreadListMessagesRequest(e,n){var r,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:30,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:Tt.Backward,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:gc.All,a=arguments.length>5?arguments[5]:void 0,c=Oe("/rooms/$roomId/threads",{$roomId:e}),l={limit:i.toString(),dir:s,include:wQ(o)};n&&(l.from=n);var d={};if((r=this.clientOpts)!==null&&r!==void 0&&r.lazyLoadMembers&&(d=Xn({},zo.LAZY_LOADING_MESSAGES_FILTER)),a){var h;d=Xn(Xn({},d),(h=a.getRoomTimelineFilterComponent())===null||h===void 0?void 0:h.toJSON())}Object.keys(d).length&&(l.filter=JSON.stringify(d));var m={prefix:$n.hasServerSideListSupport===ds.Stable?fr.V1:"/_matrix/client/unstable/org.matrix.msc3856"};return this.http.authedRequest(fe.Get,c,l,void 0,m).then(g=>{var y;return Xn(Xn({},g),{},{chunk:(y=g.chunk)===null||y===void 0?void 0:y.reverse(),start:g.prev_batch,end:g.next_batch})})}paginateEventTimeline(e,n){var r=this,i=e.getTimelineSet()===this.notifTimelineSet,s=this.getRoom(e.getRoomId()),o=e.getTimelineSet().threadListType,a=e.getTimelineSet().thread;n=n||{};var c=n.backwards||!1;if(i&&!c)throw new Error("paginateNotifTimeline can only paginate backwards");var l=c?Ue.BACKWARDS:Ue.FORWARDS,d=e.getPaginationToken(l),h=e.paginationRequests[l];if(h)return h;var m,g,y;if(i){var v;m="/notifications",g={limit:((v=n.limit)!==null&&v!==void 0?v:30).toString(),only:"highlight"},d&&d!=="end"&&(g.from=d),y=this.http.authedRequest(fe.Get,m,g).then((function(){var C=B(function*(k){var T=k.next_token,L=[];k.notifications=k.notifications.filter(wc);for(var O=0;O<k.notifications.length;O++){var P=k.notifications[O],D=r.getEventMapper()(P.event);r.getPushDetailsForEvent(D,!0),D.event.room_id=P.room_id,L[O]=D}var j=e.getTimelineSet();return j.addEventsToTimeline(L,c,!1,e,T),r.processAggregatedTimelineEvents(j.room,L),c&&!k.next_token&&e.setPaginationToken(null,l),!!k.next_token});return function(k){return C.apply(this,arguments)}})()).finally(()=>{e.paginationRequests[l]=null}),e.paginationRequests[l]=y}else if(o!==null){if(!s)throw new Error("Unknown room "+e.getRoomId());if(!$n.hasServerSideFwdPaginationSupport&&l===Tt.Forward)throw new Error("Cannot paginate threads forwards without server-side support for MSC 3715");y=this.createThreadListMessagesRequest(e.getRoomId(),d,n.limit,l,o,e.getFilter()).then(C=>{if(C.state){var k=e.getState(l),T=C.state.filter(wc).map(this.getEventMapper());k.setUnknownStateEvents(T)}var L=C.end,O=C.chunk.filter(wc).map(this.getEventMapper()),P=e.getTimelineSet();return P.addEventsToTimeline(O,c,!1,e,L),this.processAggregatedTimelineEvents(s,O),this.processThreadRoots(s,O,c),c&&C.end==C.start&&e.setPaginationToken(null,l),C.end!==C.start}).finally(()=>{e.paginationRequests[l]=null}),e.paginationRequests[l]=y}else if(a){var E,w,R=this.getRoom((E=e.getRoomId())!==null&&E!==void 0?E:void 0);if(!R)throw new Error("Unknown room "+e.getRoomId());var x=this.canSupport.get(pi.RelationsRecursion)!==hi.Unsupported;y=this.fetchRelations((w=e.getRoomId())!==null&&w!==void 0?w:"",a.id,null,null,{dir:l,limit:n.limit,from:d??void 0,recurse:x||void 0}).then((function(){var C=B(function*(k){var T=r.getEventMapper(),L=k.chunk.filter(wc).filter(sx(a.id)).map(T);for(var O of L.slice().reverse()){yield a?.processEvent(O);var P=O.getSender();(!c||a?.getEventReadUpTo(P)===null)&&R.addLocalEchoReceipt(P,O,xs.Read)}var D=k.next_batch,j=e.getTimelineSet();if(j.addEventsToTimeline(L,c,!1,e,D??null),!D&&c){var H,z,Y=(H=a.rootEvent)!==null&&H!==void 0?H:T(yield r.fetchRoomEvent((z=e.getRoomId())!==null&&z!==void 0?z:"",a.id));j.addEventsToTimeline([Y],!0,!1,e,null)}return r.processAggregatedTimelineEvents(j.room,L),c&&!D&&e.setPaginationToken(null,l),!!D});return function(k){return C.apply(this,arguments)}})()).finally(()=>{e.paginationRequests[l]=null}),e.paginationRequests[l]=y}else{if(!s)throw new Error("Unknown room "+e.getRoomId());y=this.createMessagesRequest(e.getRoomId(),d,n.limit,l,e.getFilter()).then(C=>{if(C.state){var k=e.getState(l),T=C.state.filter(wc).map(this.getEventMapper());k.setUnknownStateEvents(T)}var L=C.end,O=C.chunk.filter(wc).map(this.getEventMapper()),P=e.getTimelineSet(),[D,,j]=s.partitionThreadedEvents(O);P.addEventsToTimeline(D,c,!1,e,L),this.processAggregatedTimelineEvents(s,D),this.processThreadRoots(s,D.filter(z=>z.getServerAggregatedRelation(Rn.name)),!1),j.forEach(z=>s.relations.aggregateChildEvent(z));var H=C.end===void 0||C.end===C.start;return c&&H&&e.setPaginationToken(null,l),!H}).finally(()=>{e.paginationRequests[l]=null}),e.paginationRequests[l]=y}return y}resetNotifTimelineSet(){this.notifTimelineSet&&this.notifTimelineSet.resetLiveTimeline("end")}peekInRoom(e){var n,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:20;return(n=this.peekSync)===null||n===void 0||n.stopPeeking(),this.peekSync=new bf(this,this.clientOpts,this.buildSyncApiOptions()),this.peekSync.peek(e,r)}stopPeeking(){this.peekSync&&(this.peekSync.stopPeeking(),this.peekSync=null)}setGuestAccess(e,n){var r=this.sendStateEvent(e,ee.RoomGuestAccess,{guest_access:n.allowJoin?AC.CanJoin:AC.Forbidden},""),i=Promise.resolve();return n.allowRead&&(i=this.sendStateEvent(e,ee.RoomHistoryVisibility,{history_visibility:uP.WorldReadable},"")),Promise.all([i,r]).then()}requestRegisterEmailToken(e,n,r,i){return this.requestTokenFromEndpoint("/register/email/requestToken",{email:e,client_secret:n,send_attempt:r,next_link:i})}requestRegisterMsisdnToken(e,n,r,i,s){return this.requestTokenFromEndpoint("/register/msisdn/requestToken",{country:e,phone_number:n,client_secret:r,send_attempt:i,next_link:s})}requestAdd3pidEmailToken(e,n,r,i){return this.requestTokenFromEndpoint("/account/3pid/email/requestToken",{email:e,client_secret:n,send_attempt:r,next_link:i})}requestAdd3pidMsisdnToken(e,n,r,i,s){return this.requestTokenFromEndpoint("/account/3pid/msisdn/requestToken",{country:e,phone_number:n,client_secret:r,send_attempt:i,next_link:s})}requestPasswordEmailToken(e,n,r,i){return this.requestTokenFromEndpoint("/account/password/email/requestToken",{email:e,client_secret:n,send_attempt:r,next_link:i})}requestPasswordMsisdnToken(e,n,r,i,s){return this.requestTokenFromEndpoint("/account/password/msisdn/requestToken",{country:e,phone_number:n,client_secret:r,send_attempt:i,next_link:s})}requestTokenFromEndpoint(e,n){var r=this;return B(function*(){var i=Object.assign({},n);return r.http.request(fe.Post,e,void 0,i)})()}getRoomPushRule(e,n){if(this.pushRules){var r;return(r=this.pushRules[e])===null||r===void 0||(r=r.room)===null||r===void 0?void 0:r.find(i=>i.rule_id===n)}else throw new Error("SyncApi.sync() must be done before accessing to push rules.")}setRoomMutePushRule(e,n,r){var i,s=!1,o=this.getRoomPushRule(e,n);if(o!=null&&o.actions.includes(If.DontNotify)&&(s=!0),!r)s&&(i=this.deletePushRule(e,Pi.RoomSpecific,o.rule_id));else if(!o)i=this.addPushRule(e,Pi.RoomSpecific,n,{actions:[If.DontNotify]});else if(!s){var a=Promise.withResolvers();this.deletePushRule(e,Pi.RoomSpecific,o.rule_id).then(()=>{this.addPushRule(e,Pi.RoomSpecific,n,{actions:[If.DontNotify]}).then(()=>{a.resolve()}).catch(c=>{a.reject(c)})}).catch(c=>{a.reject(c)}),i=a.promise}if(i)return new Promise((c,l)=>{i.then(()=>{this.getPushRules().then(d=>{this.pushRules=d,c()}).catch(d=>{l(d)})}).catch(d=>{this.getPushRules().then(h=>{this.pushRules=h,l(d)}).catch(h=>{l(d)})})})}searchMessageText(e){var n={search_term:e.query};return"keys"in e&&(n.keys=e.keys),this.search({body:{search_categories:{room_events:n}}})}searchRoomEvents(e){var n={search_categories:{room_events:{search_term:e.term,filter:e.filter,order_by:QJ.Recent,event_context:{before_limit:1,after_limit:1,include_profile:!0}}}},r={_query:n,results:[],highlights:[]};return this.search({body:n}).then(i=>this.processRoomEventsSearch(r,i))}backPaginateRoomEventsSearch(e){if(!e.next_batch)return Promise.reject(new Error("Cannot backpaginate event search any further"));if(e.pendingRequest)return e.pendingRequest;var n={body:e._query,next_batch:e.next_batch},r=this.search(n,e.abortSignal).then(i=>this.processRoomEventsSearch(e,i)).finally(()=>{e.pendingRequest=void 0});return e.pendingRequest=r,r}processRoomEventsSearch(e,n){var r,i,s=n.search_categories.room_events;e.count=s.count,e.next_batch=s.next_batch;var o=new Set(s.highlights);e.highlights.forEach(g=>{o.add(g)}),e.highlights=Array.from(o);for(var a=this.getEventMapper(),c=(r=(i=s.results)===null||i===void 0?void 0:i.length)!==null&&r!==void 0?r:0,l=0;l<c;l++){var d=ET.fromJson(s.results[l],a),h=this.getRoom(d.context.getEvent().getRoomId());if(h)for(var m of d.context.getTimeline())m.setMetadata(h.currentState,!1);e.results.push(d)}return e}syncLeftRooms(){if(this.syncedLeftRooms)return Promise.resolve([]);if(this.syncLeftRoomsPromise)return this.syncLeftRoomsPromise;var e=new bf(this,this.clientOpts,this.buildSyncApiOptions());return this.syncLeftRoomsPromise=e.syncLeftRooms(),this.syncLeftRoomsPromise.then(()=>{this.logger.debug("Marking success of sync left room request"),this.syncedLeftRooms=!0}).finally(()=>{this.syncLeftRoomsPromise=void 0}),this.syncLeftRoomsPromise}createFilter(e){var n=Oe("/user/$userId/filter",{$userId:this.credentials.userId});return this.http.authedRequest(fe.Post,n,void 0,e).then(r=>{var i=zo.fromJson(this.credentials.userId,r.filter_id,e);return this.store.storeFilter(i),i})}getFilter(e,n,r){if(r){var i=this.store.getFilter(e,n);if(i)return Promise.resolve(i)}var s=Oe("/user/$userId/filter/$filterId",{$userId:e,$filterId:n});return this.http.authedRequest(fe.Get,s).then(o=>{var a=zo.fromJson(e,n,o);return this.store.storeFilter(a),a})}getOrCreateFilter(e,n){var r=this;return B(function*(){var i=r.store.getFilterIdByName(e),s;if(i){try{var o=yield r.getFilter(r.credentials.userId,i,!0);if(o){var a=o.getDefinition(),c=n.getDefinition();Ip(a,c)&&(s=i)}}catch(d){if(d.errcode!=="M_UNKNOWN"&&d.errcode!=="M_NOT_FOUND")throw d}s||r.store.setFilterIdByName(e,void 0)}if(s)return s;var l=yield r.createFilter(n.getDefinition());return r.store.setFilterIdByName(e,l.filterId),l.filterId})()}getOpenIdToken(){var e=Oe("/user/$userId/openid/request_token",{$userId:this.credentials.userId});return this.http.authedRequest(fe.Post,e,void 0,{})}turnServer(){return this.http.authedRequest(fe.Get,"/voip/turnServer")}getTurnServers(){return this.turnServers||[]}getTurnServersExpiry(){return this.turnServersExpiry}get pollingTurnServers(){return this.checkTurnServersIntervalID!==void 0}checkTurnServers(){var e=this;return B(function*(){if(e.supportsVoip()){var n=!1,r=e.turnServersExpiry-Date.now();if(r>NB)e.logger.debug("TURN creds are valid for another "+r+" ms: not fetching new ones."),n=!0;else{e.logger.debug("Fetching new TURN credentials");try{var i=yield e.turnServer();if(i.uris){e.logger.debug("Got TURN URIs: "+i.uris+" refresh in "+i.ttl+" secs");var s={urls:i.uris,username:i.username,credential:i.password};e.turnServers=[s],e.turnServersExpiry=Date.now()+i.ttl*1e3,n=!0,e.emit(Pe.TurnServers,e.turnServers)}}catch(o){e.logger.error("Failed to get TURN URIs",o),o.httpStatus===403?(e.logger.info("TURN access unavailable for this account: stopping credentials checks"),e.checkTurnServersIntervalID!==null&&globalThis.clearInterval(e.checkTurnServersIntervalID),e.checkTurnServersIntervalID=void 0,e.emit(Pe.TurnServersError,o,!0)):e.emit(Pe.TurnServersError,o,!1)}}return n}})()}setFallbackICEServerAllowed(e){this.fallbackICEServerAllowed=e}isFallbackICEServerAllowed(){return this.fallbackICEServerAllowed}isSynapseAdministrator(){var e=Oe("/_synapse/admin/v1/users/$userId/admin",{$userId:this.getUserId()});return this.http.authedRequest(fe.Get,e,void 0,void 0,{prefix:""}).then(n=>n.admin)}whoisSynapseUser(e){var n=Oe("/_synapse/admin/v1/whois/$userId",{$userId:e});return this.http.authedRequest(fe.Get,n,void 0,void 0,{prefix:""})}deactivateSynapseUser(e){var n=Oe("/_synapse/admin/v1/deactivate/$userId",{$userId:e});return this.http.authedRequest(fe.Post,n,void 0,void 0,{prefix:""})}fetchClientWellKnown(){var e=this;return B(function*(){var n;e.clientWellKnownPromise=pt.getRawClientConfig((n=e.getDomain())!==null&&n!==void 0?n:void 0),e.clientWellKnown=yield e.clientWellKnownPromise,e.emit(Pe.ClientWellKnown,e.clientWellKnown)})()}getClientWellKnown(){return this.clientWellKnown}waitForClientWellKnown(){if(!this.clientRunning)throw new Error("Client is not running");return this.clientWellKnownPromise}storeClientOptions(){var e=["boolean","string","number"],n=Object.entries(this.clientOpts).filter(r=>{var[i,s]=r;return e.includes(typeof s)}).reduce((r,i)=>{var[s,o]=i;return r[s]=o,r},{});return this.store.storeClientOptions(n)}_unstable_getSharedRooms(e){var n=this;return B(function*(){var r=yield n.doesServerSupportUnstableFeature(gQ),i=yield n.doesServerSupportUnstableFeature(vQ),s=yield n.doesServerSupportUnstableFeature(yQ);if(!r&&!i&&!s)throw Error("Server does not support the Mutual Rooms API");var o,a;s?(o="/uk.half-shot.msc2666/user/mutual_rooms",a={user_id:e}):(o=Oe("/uk.half-shot.msc2666/user/".concat(i?"mutual_rooms":"shared_rooms","/$userId"),{$userId:e}),a={});var c=[],l=null;do{var d={};l!=null&&s&&(d.batch_token=l);var h=yield n.http.authedRequest(fe.Get,o,Xn(Xn({},a),d),void 0,{prefix:fr.Unstable});c.push(...h.joined),h.next_batch_token!==void 0?l=h.next_batch_token:l=null}while(l!=null);return c})()}_unstable_getRTCTransports(){var e=this;return B(function*(){return(yield e.http.authedRequest(fe.Get,"/rtc/transports",void 0,void 0,{prefix:"".concat(fr.Unstable,"/org.matrix.msc4143")})).rtc_transports})()}getVersions(){var e=this;return B(function*(){if(e.serverVersionsPromise)return e.serverVersionsPromise;e.serverVersionsPromise=e.http.authedRequest(fe.Get,"/_matrix/client/versions",void 0,void 0,{prefix:""}).catch(r=>{throw e.serverVersionsPromise=void 0,r});var n=yield e.serverVersionsPromise;return e.canSupport=yield Fye(n),e.serverVersionsPromise})()}isVersionSupported(e){var n=this;return B(function*(){var{versions:r}=yield n.getVersions();return r&&r.includes(e)})()}doesServerSupportUnstableFeature(e){var n=this;return B(function*(){var r=yield n.getVersions();if(!r)return!1;var i=r.unstable_features;return i&&!!i[e]})()}doesServerForceEncryptionForPreset(e){var n=this;return B(function*(){var r=yield n.getVersions();if(!r)return!1;var i=r.unstable_features,s=e.includes("_chat")?e.substring(0,e.indexOf("_chat")):e;return i&&!!i["io.element.e2ee_forced.".concat(s)]})()}doesServerSupportThread(){var e=this;return B(function*(){if(yield e.isVersionSupported("v1.4"))return{threads:ds.Stable,list:ds.Stable,fwdPagination:ds.Stable};try{var[n,r,i,s,o,a]=yield Promise.all([e.doesServerSupportUnstableFeature("org.matrix.msc3440"),e.doesServerSupportUnstableFeature("org.matrix.msc3440.stable"),e.doesServerSupportUnstableFeature("org.matrix.msc3856"),e.doesServerSupportUnstableFeature("org.matrix.msc3856.stable"),e.doesServerSupportUnstableFeature("org.matrix.msc3715"),e.doesServerSupportUnstableFeature("org.matrix.msc3715.stable")]);return{threads:gE(r,n),list:gE(s,i),fwdPagination:gE(a,o)}}catch{return{threads:ds.None,list:ds.None,fwdPagination:ds.None}}})()}hasLazyLoadMembersEnabled(){var e;return!!((e=this.clientOpts)!==null&&e!==void 0&&e.lazyLoadMembers)}setCanResetTimelineCallback(e){this.canResetTimelineCallback=e}getCanResetTimelineCallback(){return this.canResetTimelineCallback}relations(e,n,r,i){var s=arguments,o=this;return B(function*(){var a,c,l=s.length>4&&s[4]!==void 0?s[4]:{dir:Tt.Backward},d=i?o.getEncryptedIfNeededEventType(e,i):null,[h,m]=yield Promise.all([o.fetchRoomEvent(e,n),o.fetchRelations(e,n,r,d,l)]),g=o.getEventMapper(),y=h?g(h):void 0,v=m.chunk.map(g);if(d===ee.RoomMessageEncrypted){var E=y?v.concat(y):v;yield Promise.all(E.map(w=>o.decryptEventIfNeeded(w))),i!==null&&(v=v.filter(w=>w.getType()===i))}return y&&r===vn.Replace&&(v=v.filter(w=>w.getSender()===y.getSender())),{originalEvent:y??null,events:v,nextBatch:(a=m.next_batch)!==null&&a!==void 0?a:null,prevBatch:(c=m.prev_batch)!==null&&c!==void 0?c:null}})()}generateClientSecret(){return Qo(32)}decryptEventIfNeeded(e,n){return e.isState()&&!this.enableEncryptedStateEvents?Promise.resolve():(e.shouldAttemptDecryption()&&this.getCrypto()&&e.attemptDecryption(this.cryptoBackend,n),e.isBeingDecrypted()?e.getDecryptionPromise():Promise.resolve())}termsUrlForService(e,n){switch(e){case AA.IS:return this.http.getUrl("/terms",void 0,hu.V2,n);case AA.IM:return this.http.getUrl("/terms",void 0,"/_matrix/integrations/v1",n);default:throw new Error("Unsupported service type")}}getHomeserverUrl(){return this.baseUrl}getIdentityServerUrl(){var e,n,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return r&&((e=this.idBaseUrl)!==null&&e!==void 0&&e.startsWith("http://")||(n=this.idBaseUrl)!==null&&n!==void 0&&n.startsWith("https://"))?this.idBaseUrl.split("://")[1]:this.idBaseUrl}setIdentityServerUrl(e){this.idBaseUrl=VI(e),this.http.setIdBaseUrl(this.idBaseUrl)}getAccessToken(){return this.http.opts.accessToken||null}getRefreshToken(){var e;return(e=this.http.opts.refreshToken)!==null&&e!==void 0?e:null}setAccessToken(e){this.http.opts.accessToken=e,this.serverVersionsPromise=void 0}isLoggedIn(){return this.http.opts.accessToken!==void 0}makeTxnId(){return"m"+new Date().getTime()+"."+this.txnCtr++}isUsernameAvailable(e){return this.http.authedRequest(fe.Get,"/register/available",{username:e}).then(n=>n.available).catch(n=>n.errcode==="M_USER_IN_USE"?!1:Promise.reject(n))}register(e,n,r,i,s,o,a){r&&(i.session=r);var c={auth:i,refresh_token:!0};return e!=null&&(c.username=e),n!=null&&(c.password=n),o!=null&&(c.guest_access_token=o),a!=null&&(c.inhibit_login=a),this.registerRequest(c)}registerGuest(){var{body:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.registerRequest(e||{},"guest")}registerRequest(e,n){var r={};return n&&(r.kind=n),this.http.request(fe.Post,"/register",r,e)}refreshToken(e){var n=r=>this.http.authedRequest(fe.Post,"/refresh",void 0,{refresh_token:e},{prefix:r,inhibitLogoutEmit:!0});return n(fr.V3).catch(r=>{if(r.errcode==="M_UNRECOGNIZED")return n(fr.V1);throw r})}loginFlows(){return this.http.request(fe.Get,"/login")}login(e,n){return this.loginRequest(Xn(Xn({},n),{},{type:e})).then(r=>(r.access_token&&r.user_id&&(this.http.opts.accessToken=r.access_token,this.credentials={userId:r.user_id}),r))}loginWithPassword(e,n){return this.login("m.login.password",{user:e,password:n})}getCasLoginUrl(e){return this.getSsoLoginUrl(e,"cas")}getSsoLoginUrl(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"sso",r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,s="/login/"+n+"/redirect";r&&(s+="/"+r);var o={redirectUrl:e,[UB.stable]:i,[UB.unstable]:i};return this.http.getUrl(s,o).href}loginWithToken(e){return this.login("m.login.token",{token:e})}loginRequest(e){var n=this;return B(function*(){return yield n.http.authedRequest(fe.Post,"/login",void 0,e)})()}logout(){var e=arguments,n=this;return B(function*(){var r=e.length>0&&e[0]!==void 0?e[0]:!1;return r&&(n.stopClient(),n.http.abort()),n.http.authedRequest(fe.Post,"/logout")})()}deactivateAccount(e,n){var r={};return e&&(r.auth=e),n!==void 0&&(r.erase=n),this.http.authedRequest(fe.Post,"/account/deactivate",void 0,r)}requestLoginToken(e){var n=this;return B(function*(){var r={auth:e};return n.http.authedRequest(fe.Post,"/login/get_token",void 0,r,{prefix:fr.V1})})()}getFallbackAuthUrl(e,n){var r=Oe("/auth/$loginType/fallback/web",{$loginType:e});return this.http.getUrl(r,{session:n}).href}createRoom(e){var n=this;return B(function*(){var r,i=(e.invite_3pid||[]).filter(a=>!a.id_access_token);if(i.length>0&&(r=n.identityServer)!==null&&r!==void 0&&r.getAccessToken){var s=yield n.identityServer.getAccessToken();if(s)for(var o of i)o.id_access_token=s}return n.http.authedRequest(fe.Post,"/createRoom",void 0,e)})()}fetchRelations(e,n,r,i){var s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{dir:Tt.Backward},o=s;$n.hasServerSideFwdPaginationSupport===ds.Experimental&&(o=o$("dir","org.matrix.msc3715.dir",o)),this.canSupport.get(pi.RelationsRecursion)===hi.Unstable&&(o=o$("recurse","org.matrix.msc3981.recurse",o));var a=oA(o),c="/rooms/$roomId/relations/$eventId";r!==null?(c+="/$relationType",i!==null&&(c+="/$eventType")):i!==null&&(this.logger.warn("eventType: ".concat(i,` ignored when fetching
            relations as relationType is null`)),i=null);var l=Oe(c+"?"+a,{$roomId:e,$eventId:n,$relationType:r,$eventType:i});return this.http.authedRequest(fe.Get,l,void 0,void 0,{prefix:fr.V1})}roomState(e){var n=Oe("/rooms/$roomId/state",{$roomId:e});return this.http.authedRequest(fe.Get,n)}fetchRoomEvent(e,n){var r=Oe("/rooms/$roomId/event/$eventId",{$roomId:e,$eventId:n});return this.http.authedRequest(fe.Get,r)}members(e,n,r,i){var s={};n&&(s.membership=n),r&&(s.not_membership=r),i&&(s.at=i);var o=oA(s),a=Oe("/rooms/$roomId/members?"+o,{$roomId:e});return this.http.authedRequest(fe.Get,a)}upgradeRoom(e,n,r){var i=Oe("/rooms/$roomId/upgrade",{$roomId:e});return this.http.authedRequest(fe.Post,i,void 0,{new_version:n,additional_creators:r})}getStateEvent(e,n,r){var i={$roomId:e,$eventType:n,$stateKey:r},s=Oe("/rooms/$roomId/state/$eventType",i);return r!==void 0&&(s=Oe(s+"/$stateKey",i)),this.http.authedRequest(fe.Get,s)}sendStateEvent(e,n,r){var i=arguments,s=this;return B(function*(){var o=i.length>3&&i[3]!==void 0?i[3]:"",a=i.length>4&&i[4]!==void 0?i[4]:{},c=s.getRoom(e),l=new es({room_id:e,type:n,state_key:o,content:r});yield s.encryptStateEventIfNeeded(l,c??void 0);var d={$roomId:e,$eventType:l.getWireType(),$stateKey:l.getWireStateKey()},h=Oe("/rooms/$roomId/state/$eventType",d);return o!==void 0&&(h=Oe(h+"/$stateKey",d)),s.http.authedRequest(fe.Put,h,void 0,l.getWireContent(),a)})()}encryptStateEventIfNeeded(e,n){var r=this;return B(function*(){if(r.enableEncryptedStateEvents&&n&&!(!r.cryptoBackend&&r.usingExternalCrypto)){if(!r.cryptoBackend)throw new Error("This room is configured to use encryption, but your client does not support encryption.");(yield r.shouldEncryptEventForRoom(e,n))&&(yield r.cryptoBackend.isStateEncryptionEnabledInRoom(n.roomId))&&(["m.room.create","m.room.member","m.room.join_rules","m.room.power_levels","m.room.third_party_invite","m.room.history_visibility","m.room.guest_access","m.room.encryption"].includes(e.getType())||(yield r.cryptoBackend.encryptEvent(e,n)))}})()}roomInitialSync(e,n){var r,i=Oe("/rooms/$roomId/initialSync",{$roomId:e});return this.http.authedRequest(fe.Get,i,{limit:(r=n?.toString())!==null&&r!==void 0?r:"30"})}setRoomReadMarkersHttpRequest(e,n,r,i){var s=this;return B(function*(){var o=Oe("/rooms/$roomId/read_markers",{$roomId:e}),a={[xs.FullyRead]:n,[xs.Read]:r};return((yield s.doesServerSupportUnstableFeature("org.matrix.msc2285.stable"))||(yield s.isVersionSupported("v1.4")))&&(a[xs.ReadPrivate]=i),s.http.authedRequest(fe.Post,o,void 0,a)})()}getJoinedRooms(){var e=Oe("/joined_rooms",{});return this.http.authedRequest(fe.Get,e)}getJoinedRoomMembers(e){var n=Oe("/rooms/$roomId/joined_members",{$roomId:e});return this.http.authedRequest(fe.Get,n)}publicRooms(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{server:n,limit:r,since:i}=e,s=Wve(e,Z1e);if(Object.keys(s).length===0){var o={server:n,limit:r,since:i};return this.http.authedRequest(fe.Get,"/publicRooms",o)}else{var a={server:n},c=Xn({limit:r,since:i},s);return this.http.authedRequest(fe.Post,"/publicRooms",a,c)}}createAlias(e,n){var r=Oe("/directory/room/$alias",{$alias:e}),i={room_id:n};return this.http.authedRequest(fe.Put,r,void 0,i)}deleteAlias(e){var n=Oe("/directory/room/$alias",{$alias:e});return this.http.authedRequest(fe.Delete,n)}getLocalAliases(e){var n=Oe("/rooms/$roomId/aliases",{$roomId:e}),r=fr.V3;return this.http.authedRequest(fe.Get,n,void 0,void 0,{prefix:r})}getRoomIdForAlias(e){var n=Oe("/directory/room/$alias",{$alias:e});return this.http.authedRequest(fe.Get,n)}getRoomDirectoryVisibility(e){var n=Oe("/directory/list/room/$roomId",{$roomId:e});return this.http.authedRequest(fe.Get,n)}setRoomDirectoryVisibility(e,n){var r=Oe("/directory/list/room/$roomId",{$roomId:e});return this.http.authedRequest(fe.Put,r,void 0,{visibility:n})}searchUserDirectory(e){var{term:n,limit:r}=e,i={search_term:n};return r!==void 0&&(i.limit=r),this.http.authedRequest(fe.Post,"/user_directory/search",void 0,i)}uploadContent(e,n){return this.http.uploadContent(e,n)}cancelUpload(e){return this.http.cancelUpload(e)}getCurrentUploads(){return this.http.getCurrentUploads()}getProfileInfo(e,n){var r=n?Oe("/profile/$userId/$info",{$userId:e,$info:n}):Oe("/profile/$userId",{$userId:e});return this.http.authedRequest(fe.Get,r)}doesServerSupportExtendedProfiles(){var e=this;return B(function*(){return(yield e.isVersionSupported("v1.16"))||(yield e.doesServerSupportUnstableFeature(bQ))||(yield e.doesServerSupportUnstableFeature(_Q))})()}getExtendedProfileRequestPrefix(){var e=this;return B(function*(){return(yield e.isVersionSupported("v1.16"))||(yield e.doesServerSupportUnstableFeature("uk.tcpip.msc4133.stable"))?fr.V3:"/_matrix/client/unstable/uk.tcpip.msc4133"})()}getExtendedProfile(e){var n=this;return B(function*(){if(!(yield n.doesServerSupportExtendedProfiles()))throw new Error("Server does not support extended profiles");return n.http.authedRequest(fe.Get,Oe("/profile/$userId",{$userId:e}),void 0,void 0,{prefix:yield n.getExtendedProfileRequestPrefix()})})()}getExtendedProfileProperty(e,n){var r=this;return B(function*(){if(!(yield r.doesServerSupportExtendedProfiles()))throw new Error("Server does not support extended profiles");var i=yield r.http.authedRequest(fe.Get,Oe("/profile/$userId/$key",{$userId:e,$key:n}),void 0,void 0,{prefix:yield r.getExtendedProfileRequestPrefix()});return i[n]})()}setExtendedProfileProperty(e,n){var r=this;return B(function*(){if(!(yield r.doesServerSupportExtendedProfiles()))throw new Error("Server does not support extended profiles");var i=r.getUserId();yield r.http.authedRequest(fe.Put,Oe("/profile/$userId/$key",{$userId:i,$key:e}),void 0,{[e]:n},{prefix:yield r.getExtendedProfileRequestPrefix()})})()}deleteExtendedProfileProperty(e){var n=this;return B(function*(){if(!(yield n.doesServerSupportExtendedProfiles()))throw new Error("Server does not support extended profiles");var r=n.getUserId();yield n.http.authedRequest(fe.Delete,Oe("/profile/$userId/$key",{$userId:r,$key:e}),void 0,void 0,{prefix:yield n.getExtendedProfileRequestPrefix()})})()}patchExtendedProfile(e){var n=this;return B(function*(){if(!(yield n.doesServerSupportExtendedProfiles()))throw new Error("Server does not support extended profiles");var r=n.getUserId();return n.http.authedRequest(fe.Patch,Oe("/profile/$userId",{$userId:r}),{},e,{prefix:yield n.getExtendedProfileRequestPrefix()})})()}setExtendedProfile(e){var n=this;return B(function*(){if(!(yield n.doesServerSupportExtendedProfiles()))throw new Error("Server does not support extended profiles");var r=n.getUserId();yield n.http.authedRequest(fe.Put,Oe("/profile/$userId",{$userId:r}),{},e,{prefix:yield n.getExtendedProfileRequestPrefix()})})()}getThreePids(){return this.http.authedRequest(fe.Get,"/account/3pid")}addThreePidOnly(e){var n=this;return B(function*(){var r="/account/3pid/add";return n.http.authedRequest(fe.Post,r,void 0,e)})()}bindThreePid(e){var n=this;return B(function*(){var r="/account/3pid/bind";return n.http.authedRequest(fe.Post,r,void 0,e)})()}unbindThreePid(e,n){var r=this;return B(function*(){var i="/account/3pid/unbind",s={medium:e,address:n,id_server:r.getIdentityServerUrl(!0)};return r.http.authedRequest(fe.Post,i,void 0,s)})()}deleteThreePid(e,n){var r="/account/3pid/delete";return this.http.authedRequest(fe.Post,r,void 0,{medium:e,address:n})}setPassword(e,n,r){var i="/account/password",s={auth:e,new_password:n,logout_devices:r};return this.http.authedRequest(fe.Post,i,void 0,s)}getDevices(){return this.http.authedRequest(fe.Get,"/devices")}getDevice(e){var n=Oe("/devices/$device_id",{$device_id:e});return this.http.authedRequest(fe.Get,n)}setDeviceDetails(e,n){var r=Oe("/devices/$device_id",{$device_id:e});return this.http.authedRequest(fe.Put,r,void 0,n)}deleteDevice(e,n){var r=Oe("/devices/$device_id",{$device_id:e}),i={};return n&&(i.auth=n),this.http.authedRequest(fe.Delete,r,void 0,i)}deleteMultipleDevices(e,n){var r={devices:e};n&&(r.auth=n);var i="/delete_devices";return this.http.authedRequest(fe.Post,i,void 0,r)}getPushers(){var e=this;return B(function*(){var n=yield e.http.authedRequest(fe.Get,"/pushers");return(yield e.doesServerSupportUnstableFeature("org.matrix.msc3881"))||(n.pushers=n.pushers.map(r=>(r.hasOwnProperty(gA.name)||(r[gA.name]=!0),r))),n})()}setPusher(e){var n="/pushers/set";return this.http.authedRequest(fe.Post,n,void 0,e)}removePusher(e,n){var r="/pushers/set",i={pushkey:e,app_id:n,kind:null};return this.http.authedRequest(fe.Post,r,void 0,i)}setLocalNotificationSettings(e,n){var r="".concat(nJ.name,".").concat(e);return this.setAccountData(r,n)}getPushRules(){return this.http.authedRequest(fe.Get,"/pushrules/").then(e=>(this.setPushRules(e),this.pushRules))}setPushRules(e){this.pushRules=bc.rewriteDefaultRules(this.logger,e,this.getUserId()),this.pushProcessor.updateCachedPushRuleKeys(this.pushRules)}addPushRule(e,n,r,i){var s=Oe("/pushrules/"+e+"/$kind/$ruleId",{$kind:n,$ruleId:r});return this.http.authedRequest(fe.Put,s,void 0,i)}deletePushRule(e,n,r){var i=Oe("/pushrules/"+e+"/$kind/$ruleId",{$kind:n,$ruleId:r});return this.http.authedRequest(fe.Delete,i)}setPushRuleEnabled(e,n,r,i){var s=Oe("/pushrules/"+e+"/$kind/$ruleId/enabled",{$kind:n,$ruleId:r});return this.http.authedRequest(fe.Put,s,void 0,{enabled:i})}setPushRuleActions(e,n,r,i){var s=Oe("/pushrules/"+e+"/$kind/$ruleId/actions",{$kind:n,$ruleId:r});return this.http.authedRequest(fe.Put,s,void 0,{actions:i})}search(e,n){var{body:r,next_batch:i}=e,s={};return i&&(s.next_batch=i),this.http.authedRequest(fe.Post,"/search",s,r,{abortSignal:n})}uploadKeysRequest(e,n){return this.http.authedRequest(fe.Post,"/keys/upload",void 0,e)}uploadKeySignatures(e){return this.http.authedRequest(fe.Post,"/keys/signatures/upload",void 0,e)}downloadKeysForUsers(e){var{token:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r={device_keys:{}};return n!==void 0&&(r.token=n),e.forEach(i=>{r.device_keys[i]=[]}),this.http.authedRequest(fe.Post,"/keys/query",void 0,r)}claimOneTimeKeys(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"signed_curve25519",r=arguments.length>2?arguments[2]:void 0,i={};n===void 0&&(n="signed_curve25519");for(var[s,o]of e){var a=i[s]||{};wC(i,s,a),wC(a,o,n)}var c={one_time_keys:i};r&&(c.timeout=r);var l="/keys/claim";return this.http.authedRequest(fe.Post,l,void 0,c)}getKeyChanges(e,n){var r={from:e,to:n};return this.http.authedRequest(fe.Get,"/keys/changes",r)}uploadDeviceSigningKeys(e,n){var r=Object.assign({},n);return e&&Object.assign(r,{auth:e}),this.http.authedRequest(fe.Post,"/keys/device_signing/upload",void 0,r,{prefix:fr.Unstable})}registerWithIdentityServer(e){if(!this.idBaseUrl)throw new Error("No identity server base URL set");var n=this.http.getUrl("/account/register",void 0,hu.V2,this.idBaseUrl);return this.http.requestOtherUrl(fe.Post,n,e)}requestEmailToken(e,n,r,i,s){var o={client_secret:n,email:e,send_attempt:r?.toString()};return i&&(o.next_link=i),this.http.idServerRequest(fe.Post,"/validate/email/requestToken",o,hu.V2,s)}requestMsisdnToken(e,n,r,i,s,o){var a={client_secret:r,country:e,phone_number:n,send_attempt:i?.toString()};return s&&(a.next_link=s),this.http.idServerRequest(fe.Post,"/validate/msisdn/requestToken",a,hu.V2,o)}submitMsisdnToken(e,n,r,i){var s={sid:e,client_secret:n,token:r};return this.http.idServerRequest(fe.Post,"/validate/msisdn/submitToken",s,hu.V2,i??void 0)}submitMsisdnTokenOtherUrl(e,n,r,i){var s={sid:n,client_secret:r,token:i};return this.http.requestOtherUrl(fe.Post,e,s)}getIdentityHashDetails(e){return this.http.idServerRequest(fe.Get,"/hash_details",void 0,hu.V2,e)}identityHashedLookup(e,n){var r=this;return B(function*(){var i={},s=yield r.getIdentityHashDetails(n);if(!s||!s.lookup_pepper||!s.algorithms)throw new Error("Unsupported identity server: bad response");i.pepper=s.lookup_pepper;var o={};if(s.algorithms.includes("sha256"))i.addresses=yield Promise.all(e.map((function(){var m=B(function*(g){var y=g[0].toLowerCase(),v=g[1].toLowerCase(),E=yield fP("".concat(y," ").concat(v," ").concat(i.pepper)),w=ST(E);return o[w]=g[0],w});return function(g){return m.apply(this,arguments)}})())),i.algorithm="sha256";else if(s.algorithms.includes("none"))i.addresses=e.map(m=>{var g=m[0].toLowerCase(),y=m[1].toLowerCase(),v="".concat(g," ").concat(y);return o[v]=m[0],v}),i.algorithm="none";else throw new Error("Unsupported identity server: unknown hash algorithm");var a=yield r.http.idServerRequest(fe.Post,"/lookup",i,hu.V2,n);if(!(a!=null&&a.mappings))return[];var c=[];for(var l of Object.keys(a.mappings)){var d=a.mappings[l],h=o[l];if(!h)throw new Error("Identity server returned more results than expected");c.push({address:h,mxid:d})}return c})()}lookupThreePid(e,n,r){var i=this;return B(function*(){var s=yield i.identityHashedLookup([[n,e]],r),o=s.find(c=>c.address===n);if(!o)return{};var a={address:n,medium:e,mxid:o.mxid};return a})()}bulkLookupThreePids(e,n){var r=this;return B(function*(){var i=yield r.identityHashedLookup(e.map(c=>[c[1],c[0]]),n),s=[],o=function*(l){var d=e.find(h=>h[1]===l.address);if(!d)throw new Error("Identity sever returned unexpected results");s.push([d[0],l.address,l.mxid])};for(var a of i)yield*o(a);return{threepids:s}})()}getIdentityAccount(e){return this.http.idServerRequest(fe.Get,"/account",void 0,hu.V2,e)}sendToDevice(e,n,r){var i=Oe("/sendToDevice/$eventType/$txnId",{$eventType:e,$txnId:r||this.makeTxnId()}),s={messages:up(n)},o=new Map;for(var[a,c]of n)o.set(a,Array.from(c.keys()));return this.logger.debug("PUT ".concat(i),o),this.http.authedRequest(fe.Put,i,void 0,s)}encryptAndSendToDevice(e,n,r){var i=this;return B(function*(){if(!i.cryptoBackend)throw new Error("Cannot encrypt to device event, your client does not support encryption.");var s=yield i.cryptoBackend.encryptToDeviceMessages(e,n,r);yield i.queueToDevice(s)})()}queueToDevice(e){return this.toDeviceMessageQueue.queueBatch(e)}getThirdpartyProtocols(){return this.http.authedRequest(fe.Get,"/thirdparty/protocols").then(e=>{if(!e||typeof e!="object")throw new Error("/thirdparty/protocols did not return an object: ".concat(e));return e})}getThirdpartyLocation(e,n){var r=Oe("/thirdparty/location/$protocol",{$protocol:e});return this.http.authedRequest(fe.Get,r,n)}getThirdpartyUser(e,n){var r=Oe("/thirdparty/user/$protocol",{$protocol:e});return this.http.authedRequest(fe.Get,r,n)}getTerms(e,n){var r=this.termsUrlForService(e,n);return this.http.requestOtherUrl(fe.Get,r)}agreeToTerms(e,n,r,i){var s=this.termsUrlForService(e,n),o={Authorization:"Bearer "+r};return this.http.requestOtherUrl(fe.Post,s,{user_accepts:i},{headers:o})}reportEvent(e,n,r,i){var s=Oe("/rooms/$roomId/report/$eventId",{$roomId:e,$eventId:n});return this.http.authedRequest(fe.Post,s,void 0,{score:r,reason:i})}reportRoom(e,n){var r=Oe("/rooms/$roomId/report",{$roomId:e});return this.http.authedRequest(fe.Post,r,void 0,{reason:n})}getRoomHierarchy(e,n,r){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,s=arguments.length>4?arguments[4]:void 0,o=Oe("/rooms/$roomId/hierarchy",{$roomId:e}),a={suggested_only:String(i),max_depth:r?.toString(),from:s,limit:n?.toString()};return this.http.authedRequest(fe.Get,o,a,void 0,{prefix:fr.V1}).catch(c=>{if(c.errcode==="M_UNRECOGNIZED")return this.http.authedRequest(fe.Get,o,a,void 0,{prefix:"/_matrix/client/unstable/org.matrix.msc2946"});throw c})}unstableCreateFileTree(e){var n=this;return B(function*(){var{room_id:r}=yield n.createRoom({name:e,preset:CT.PrivateChat,power_level_content_override:Xn(Xn({},j0e),{},{users:{[n.getUserId()]:100}}),creation_content:{[EC]:Yg.Space},initial_state:[{type:fA.name,state_key:pA.name,content:{[hA.name]:!0}},{type:ee.RoomEncryption,state_key:"",content:{algorithm:"m.megolm.v1.aes-sha2"}}]});return new wB(n,r)})()}unstableGetFileTreeSpace(e){var n,r,i=this.getRoom(e);if(i?.getMyMembership()!==Ke.Join)return null;var s=i.currentState.getStateEvents(ee.RoomCreate,""),o=i.currentState.getStateEvents(fA.name,pA.name);if(!s)throw new Error("Expected single room create event");return!(o!=null&&(n=o.getContent())!==null&&n!==void 0&&n[hA.name])||((r=s.getContent())===null||r===void 0?void 0:r[EC])!==Yg.Space?null:new wB(this,e)}slidingSync(e,n,r){var i={};e.pos&&(i.pos=e.pos,delete e.pos),e.timeout&&(i.timeout=e.timeout,delete e.timeout);var s=e.clientTimeout;return delete e.clientTimeout,this.http.authedRequest(fe.Post,"/sync",i,e,{prefix:"/_matrix/client/unstable/org.matrix.simplified_msc3575",baseUrl:n,localTimeoutMs:s,abortSignal:r})}supportsThreads(){var e;return((e=this.clientOpts)===null||e===void 0?void 0:e.threadSupport)||!1}supportsIntentionalMentions(){return this.canSupport.get(pi.IntentionalMentions)!==hi.Unsupported}getRoomSummary(e,n){var r=this;return B(function*(){var i={prefix:"/_matrix/client/unstable/im.nheko.summary"};try{var s=Oe("/summary/$roomid",{$roomid:e});return yield r.http.authedRequest(fe.Get,s,{via:n},void 0,i)}catch(a){if(a instanceof In&&a.errcode==="M_UNRECOGNIZED"){var o=Oe("/rooms/$roomid/summary",{$roomid:e});return yield r.http.authedRequest(fe.Get,o,{via:n},void 0,i)}else throw a}})()}processThreadEvents(e,n,r){e.processThreadedEvents(n,r)}processThreadRoots(e,n,r){this.supportsThreads()&&e.processThreadRoots(n,r)}processBeaconEvents(e,n){this.processAggregatedTimelineEvents(e,n)}processAggregatedTimelineEvents(e,n){n!=null&&n.length&&e&&(e.currentState.processBeaconEvents(n,this),e.processPollEvents(n))}whoami(){var e=this;return B(function*(){return e.http.authedRequest(fe.Get,"/account/whoami")})()}timestampToEvent(e,n,r){var i=this;return B(function*(){var s=Oe("/rooms/$roomId/timestamp_to_event",{$roomId:e}),o={ts:n.toString(),dir:r};try{return yield i.http.authedRequest(fe.Get,s,o,void 0,{prefix:fr.V1})}catch(a){if(a.errcode==="M_UNRECOGNIZED"&&(a.httpStatus===400||a.httpStatus===404||a.httpStatus===405))return yield i.http.authedRequest(fe.Get,s,o,void 0,{prefix:"/_matrix/client/unstable/org.matrix.msc3030"});throw a}})()}getAuthMetadata(){var e=this;return B(function*(){var n;try{var r=yield e.isVersionSupported("v1.15");n=yield e.http.request(fe.Get,"/auth_metadata",void 0,void 0,{prefix:r?fr.V1:fr.Unstable+"/org.matrix.msc2965"})}catch(s){if(s instanceof In&&s.errcode==="M_UNRECOGNIZED"){var{issuer:i}=yield e.http.request(fe.Get,"/auth_issuer",void 0,void 0,{prefix:fr.Unstable+"/org.matrix.msc2965"});return bP(i)}throw s}return _P(n)})()}}M(xT,"RESTORE_BACKUP_ERROR_BAD_KEY","RESTORE_BACKUP_ERROR_BAD_KEY");function jB(t){return Object.fromEntries(Object.entries(t).map(e=>{var[n,r]=e;return["".concat(Xi,".").concat(n),r]}))}function SQ(t,e){var n,r=t.getUserId(),i=e.getId(),s=t.getRoom(e.getRoomId());if(!(!s||!r||!i)){if(!s.findEventById(i)){N.info("Decrypted event ".concat(e.getId()," is not in room ").concat(s.roomId,": ignoring"));return}var o=!!e.threadRootId&&!e.isThreadRoot,a;if(o){var c=s.getThread(e.threadRootId);a=c?c.hasUserReadEvent(r,i):!0}else a=s.hasUserReadEvent(r,i);if(!a){var l=t.getPushActionsForEvent(e,!0),d=!!(l!=null&&(n=l.tweaks)!==null&&n!==void 0&&n.highlight);if(d){var h=s.getUnreadCountForEventContext(sn.Highlight,e)+1;o?s.setThreadUnreadNotificationCount(e.threadRootId,sn.Highlight,h):s.setUnreadNotificationCount(sn.Highlight,h)}var m=!!(l!=null&&l.notify);if(m){var g=s.getUnreadCountForEventContext(sn.Total,e)+1;o?s.setThreadUnreadNotificationCount(e.threadRootId,sn.Total,g):s.setUnreadNotificationCount(sn.Total,g)}}}}function Mv(t){return Ub(t)?O_:t.threadRootId}function Ub(t){if(!t.threadRootId||t.isThreadRoot)return!0;if(!t.isRelation())return N.warn("Event is not a relation or a thread root, but still has a threadRootId! id=".concat(t.getId())),!0;if(t.isRelation(Rn.name))return!1;var e=t.relationEventId===t.threadRootId;return e}function FB(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function $B(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?FB(Object(n),!0).forEach(function(r){M(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):FB(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var As=(function(t){return t.New="Thread.new",t.Update="Thread.update",t.NewReply="Thread.newReply",t.ViewThread="Thread.viewThread",t.Delete="Thread.delete",t})({}),ds=(function(t){return t[t.None=0]="None",t[t.Experimental=1]="Experimental",t[t.Stable=2]="Stable",t})({});function gE(t,e){return t?ds.Stable:e?ds.Experimental:ds.None}class $n extends IJ{constructor(e,n,r){var i,s;if(super(),i=this,this.id=e,this.rootEvent=n,M(this,"timelineSet",void 0),M(this,"_currentUserParticipated",!1),M(this,"reEmitter",void 0),M(this,"lastEvent",void 0),M(this,"replyCount",0),M(this,"lastPendingEvent",void 0),M(this,"pendingReplyCount",0),M(this,"room",void 0),M(this,"client",void 0),M(this,"pendingEventOrdering",void 0),M(this,"processRootEventPromise",void 0),M(this,"initialEventsFetched",!$n.hasServerSideSupport),M(this,"initalEventFetchProm",void 0),M(this,"replayEvents",[]),M(this,"onTimelineReset",B(function*(){yield i.processRootEventPromise,i.processRootEventPromise=void 0})),M(this,"onBeforeRedaction",(o,a)=>{o!=null&&o.isRelation(Rn.name)&&this.room.eventShouldLiveIn(o).threadId===this.id&&o.getId()!==this.id&&!a.status&&(this.replyCount--,this.updatePendingReplyCount(),this.emit(As.Update,this))}),M(this,"onRedaction",(function(){var o=B(function*(a,c,l){if(l===i.id)if(i.replyCount<=0){for(var d of i.timeline)i.clearEventMetadata(d);i.lastEvent=i.rootEvent,i._currentUserParticipated=!1,i.emit(As.Delete,i)}else{var h;((h=i.lastEvent)===null||h===void 0?void 0:h.getId())===a.getAssociatedId()&&(yield i.processRootEventPromise,i.processRootEventPromise=void 0),yield i.updateThreadMetadata()}});return function(a,c,l){return o.apply(this,arguments)}})()),M(this,"onTimelineEvent",(o,a,c)=>{if(!c){var l=o.getSender();l&&a&&this.shouldSendLocalEchoReceipt(l,o)&&a.addLocalEchoReceipt(l,o,xs.Read),o.getId()!==this.id&&o.isRelation(Rn.name)&&this.replyCount++}this.onEcho(o,c??!1)}),M(this,"onLocalEcho",o=>{this.onEcho(o,!1)}),M(this,"onEcho",(function(){var o=B(function*(a,c){a.threadRootId===i.id&&i.lastEvent!==a&&(yield i.updateThreadMetadata(),a.isRelation(Rn.name)&&(c||(i.lastEvent=void 0,i.emit(As.NewReply,i,a))))});return function(a,c){return o.apply(this,arguments)}})()),this.setMaxListeners(1e3),!(r!=null&&r.room))throw new Error("element-web#22141: A thread requires a room in order to function");this.room=r.room,this.client=r.client,this.pendingEventOrdering=(s=r.pendingEventOrdering)!==null&&s!==void 0?s:Lv.Chronological,this.timelineSet=new Dg(this.room,{timelineSupport:!0,pendingEvents:!0},this.client,this),this.reEmitter=new py(this),this.reEmitter.reEmit(this.timelineSet,[Me.Timeline,Me.TimelineReset]),this.room.on(Zt.BeforeRedaction,this.onBeforeRedaction),this.room.on(Me.Redaction,this.onRedaction),this.room.on(Me.LocalEchoUpdated,this.onLocalEcho),this.room.on(Me.TimelineReset,this.onTimelineReset),this.timelineSet.on(Me.Timeline,this.onTimelineEvent),this.processReceipts(r.receipts),this.updateThreadMetadata(),this.setEventMetadata(this.rootEvent)}fetchRootEvent(){var e=this;return B(function*(){try{var n=yield e.client.fetchRoomEvent(e.roomId,e.id),r=e.client.getEventMapper();e.rootEvent=r(n)}catch(i){N.error("Failed to fetch thread root to construct thread with",i)}yield e.processEvent(e.rootEvent)})()}static setServerSideSupport(e){$n.hasServerSideSupport=e,e!==ds.Stable&&(Zg.setPreferUnstable(!0),ev.setPreferUnstable(!0),Rn.setPreferUnstable(!0))}static setServerSideListSupport(e){$n.hasServerSideListSupport=e}static setServerSideFwdPaginationSupport(e){$n.hasServerSideFwdPaginationSupport=e}shouldSendLocalEchoReceipt(e,n){var r,i=(r=this.client.canSupport.get(pi.RelationsRecursion))!==null&&r!==void 0?r:hi.Unsupported;if(i===hi.Unsupported){var s,o=(s=this.getReadReceiptForUserId(e))===null||s===void 0?void 0:s.eventId;if(o){var a=this.findEventById(o);if(a&&a.getTs()>n.getTs())return!1}}return!0}get roomState(){return this.room.getLiveTimeline().getState(Ue.FORWARDS)}addEventToTimeline(e,n){this.findEventById(e.getId())||this.timelineSet.addEventToTimeline(e,this.liveTimeline,{toStartOfTimeline:n,fromCache:!1,roomState:this.roomState,addToState:!1})}insertEventIntoTimeline(e){var n=e.getId();n&&(this.findEventById(n)||this.timelineSet.insertEventIntoTimeline(e,this.liveTimeline,this.roomState,!1))}addEvents(e,n){e.forEach(r=>this.addEvent(r,n,!1)),this.updateThreadMetadata()}addEvent(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;this.setEventMetadata(e);var i=this.lastReply(),s=!i||e.localTimestamp>=i.localTimestamp;if(!$n.hasServerSideSupport)this.addEventToTimeline(e,n),this.client.decryptEventIfNeeded(e);else if(e.isRelation(vn.Annotation)||e.isRelation(vn.Replace)){this.addRelatedThreadEvent(e,n);return}else!n&&s?(this.addEventToTimeline(e,!1),this.fetchEditsWhereNeeded(e)):n?this.addEventToTimeline(e,n):this.insertEventIntoTimeline(e);e.getId()!==this.id&&e.isRelation(Rn.name)&&!n&&s&&(this.lastEvent=void 0),r&&(this.emit(As.NewReply,this,e),this.updateThreadMetadata())}addRelatedThreadEvent(e,n){if(this.initialEventsFetched){var s,o=(s=this.client.canSupport.get(pi.RelationsRecursion))!==null&&s!==void 0?s:hi.Unsupported;o===hi.Unsupported?this.insertEventIntoTimeline(e):this.addEventToTimeline(e,n)}else{var r;if((r=this.replayEvents)===null||r===void 0||r.push(e),e.isRelation(vn.Annotation)){var i;(i=this.timelineSet.relations)===null||i===void 0||i.aggregateChildEvent(e,this.timelineSet)}}}processEvent(e){var n=this;return B(function*(){e&&(n.setEventMetadata(e),yield n.fetchEditsWhereNeeded(e))})()}processReceipts(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];for(var{eventId:n,receiptType:r,userId:i,receipt:s,synthetic:o}of e)this.addReceiptToStructure(n,r,i,s,o)}getRootEventBundledRelationship(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.rootEvent;return e?.getServerAggregatedRelation(Rn.name)}processRootEvent(){var e=this;return B(function*(){var n=e.getRootEventBundledRelationship();if($n.hasServerSideSupport&&n){e.replyCount=n.count,e._currentUserParticipated=!!n.current_user_participated;var r=e.client.getEventMapper();e.lastEvent=r($B($B({},n.latest_event),{},{room_id:e.roomId})),e.updatePendingReplyCount(),yield e.processEvent(e.lastEvent)}})()}updatePendingReplyCount(){var e=this.pendingEventOrdering===Lv.Detached?this.room.getPendingEvents():this.events,n=e.filter(r=>{var i;return r.threadRootId===this.id&&r.isRelation(Rn.name)&&r.status!==null&&r.getId()!==((i=this.lastEvent)===null||i===void 0?void 0:i.getId())});this.lastPendingEvent=n.length?n[n.length-1]:void 0,this.pendingReplyCount=n.length}resetLiveTimeline(e,n){var r=this;return B(function*(){var i=r.liveTimeline;r.timelineSet.resetLiveTimeline(e??void 0,n??void 0);var s=r.liveTimeline,o,a;if(e){var c=yield r.client.createMessagesRequest(r.roomId,e,1,Tt.Forward);o=c.end}if(n){var l=yield r.client.createMessagesRequest(r.roomId,n,1,Tt.Backward);a=l.start}n&&i.getPaginationToken(Tt.Forward)===n&&i.setPaginationToken(a??null,Tt.Forward),e&&s.getPaginationToken(Tt.Backward)===e&&s.setPaginationToken(o??null,Tt.Backward)})()}updateThreadFromRootEvent(){var e=this;return B(function*(){$n.hasServerSideSupport&&(!e.initialEventsFetched&&!e.lastEvent&&(yield e.processRootEvent()),yield e.fetchRootEvent()),yield e.processRootEvent()})()}updateThreadMetadata(){var e=this;return B(function*(){if(e.updatePendingReplyCount(),e.processRootEventPromise||(e.processRootEventPromise=e.updateThreadFromRootEvent()),yield e.processRootEventPromise,!e.initialEventsFetched)if(e.initalEventFetchProm)yield e.initalEventFetchProm;else try{e.timelineSet.resetLiveTimeline(),e.replyCount===0&&e.rootEvent?(e.timelineSet.addEventsToTimeline([e.rootEvent],!0,!1,e.liveTimeline,null),e.liveTimeline.setPaginationToken(null,Tt.Backward)):(e.initalEventFetchProm=e.client.paginateEventTimeline(e.liveTimeline,{backwards:!0}),yield e.initalEventFetchProm),e.initialEventsFetched=!0;for(var n of e.replayEvents)e.addEvent(n,!1);e.replayEvents=null,e.emit(Me.TimelineReset,e.room,e.timelineSet,!0)}catch(r){N.error("Failed to load start of newly created thread: ",r),e.initialEventsFetched=!1}e.emit(As.Update,e)})()}fetchEditsWhereNeeded(){var e=arguments,n=this;return B(function*(){var r,i=(r=n.client.canSupport.get(pi.RelationsRecursion))!==null&&r!==void 0?r:hi.Unsupported;if(i===hi.Unsupported){for(var s=e.length,o=new Array(s),a=0;a<s;a++)o[a]=e[a];return Promise.all(o.filter(rbe).map((function(){var c=B(function*(l){try{var d=yield n.client.relations(n.roomId,l.getId(),vn.Replace,l.getType(),{limit:1});if(d.events.length){var h=d.events[0];l.makeReplaced(h),n.insertEventIntoTimeline(h)}}catch(m){N.error("Failed to load edits for encrypted thread event",m)}});return function(l){return c.apply(this,arguments)}})()))}})()}setEventMetadata(e){e&&(Ue.setEventMetadata(e,this.roomState,!1),e.setThread(this))}clearEventMetadata(e){if(e){var n;e.setThread(void 0),(n=e.event)===null||n===void 0||(n=n.unsigned)===null||n===void 0||(n=n["m.relations"])===null||n===void 0||delete n[Rn.name]}}findEventById(e){return this.timelineSet.findEventById(e)}lastReply(){for(var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:i=>i.isRelation(Rn.name),n=this.timeline.length-1;n>=0;n--){var r=this.timeline[n];if(e(r))return r}return null}get roomId(){return this.room.roomId}get length(){return this.replyCount+this.pendingReplyCount}get replyToEvent(){var e,n;return(e=(n=this.lastPendingEvent)!==null&&n!==void 0?n:this.lastEvent)!==null&&e!==void 0?e:this.lastReply()}get timeline(){return this.events}get events(){return this.liveTimeline.getEvents()}has(e){return this.timelineSet.findEventById(e)instanceof es}get hasCurrentUserParticipated(){return this._currentUserParticipated}get liveTimeline(){return this.timelineSet.getLiveTimeline()}getUnfilteredTimelineSet(){return this.timelineSet}addReceipt(e,n){throw new Error("Unsupported function on the thread model")}getEventReadUpTo(e,n){var r=e===this.client.getUserId(),i=this.timeline[this.timeline.length-1];if(r&&i){var s=i.getTs()<this.room.getOldestThreadedReceiptTs(),o=i.getId();if(s&&o)return o}var a=super.getEventReadUpTo(e,n);if(i){var c=this.room.getLastUnthreadedReceiptFor(e);if(!c)return a;for(var l=((d=this.timeline)===null||d===void 0?void 0:d.length)-1;l>=0;--l){var d,h,m=this.timeline[l];if(m.getId()===a)return a;if(m.getTs()<c.ts)return(h=m.getId())!==null&&h!==void 0?h:a}}return a}hasUserReadEvent(e,n){if(e===this.client.getUserId()){var r,i,s,o,a,c,l=((r=(i=this.lastReply())===null||i===void 0?void 0:i.getTs())!==null&&r!==void 0?r:0)<this.room.getOldestThreadedReceiptTs(),d=(s=(o=this.room.getLastUnthreadedReceiptFor(e))===null||o===void 0?void 0:o.ts)!==null&&s!==void 0?s:0,h=((a=this===null||this===void 0||(c=this.lastReply())===null||c===void 0?void 0:c.getTs())!==null&&a!==void 0?a:0)<d;if(l||h)return!0}return this.room.hasUserReadEvent(e,n)}setUnread(e,n){return this.room.setThreadUnreadNotificationCount(this.id,e,n)}getLastUnthreadedReceiptFor(e){return this.room.getLastUnthreadedReceiptFor(e)}}M($n,"hasServerSideSupport",ds.None);M($n,"hasServerSideListSupport",ds.None);M($n,"hasServerSideFwdPaginationSupport",ds.None);function rbe(t){return t.isEncrypted()&&(t.isRelation(Rn.name)||t.isThreadRoot)}var Zg=new pT("related_by_senders","io.element.relation_senders"),ev=new pT("related_by_rel_types","io.element.relation_types"),Rn=new pT("m.thread","io.element.thread"),gc=(function(t){return t[t.My=0]="My",t[t.All=1]="All",t})({});function wQ(t){return t===gc.My?"participated":"all"}class BB extends Error{constructor(e,n,r){super(n),this.code=e,M(this,"detailedString",void 0),this.name="DecryptionError",this.detailedString=ibe(this,r)}}function ibe(t,e){var n=t.name+"[msg: "+t.message;return e&&(n+=", "+Object.keys(e).map(r=>r+": "+e[r]).join(", ")),n+="]",n}var HB=Object.freeze({visible:!0}),SP=36e5,Zt=(function(t){return t.Decrypted="Event.decrypted",t.BeforeRedaction="Event.beforeRedaction",t.VisibilityChange="Event.visibilityChange",t.LocalEventIdReplaced="Event.localEventIdReplaced",t.Status="Event.status",t.Replaced="Event.replaced",t.RelationsCreated="Event.relationsCreated",t.SentinelUpdated="Event.sentinelUpdated",t})({});class es extends Gn{setMetadata(e,n){var r,i,s=this.isState()&&this.getType()===ee.RoomMember&&this.getSender()===this.getStateKey(),o=!1;if(s||!((r=this.sender)!==null&&r!==void 0&&(r=r.events)!==null&&r!==void 0&&r.member)){var a=e.getSentinelMember(this.getSender());a!==this.sender&&(o=!0),this.sender=a}if(s||!((i=this.target)!==null&&i!==void 0&&(i=i.events)!==null&&i!==void 0&&i.member)&&this.getType()===ee.RoomMember){var c=e.getSentinelMember(this.getStateKey());c!==this.target&&(o=!0),this.target=c}this.isState()&&n&&(this.forwardLooking=!1),o&&this.emit(Zt.SentinelUpdated)}constructor(){var e,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.event=n,M(this,"pushDetails",{}),M(this,"_replacingEvent",null),M(this,"_localRedactionEvent",null),M(this,"_isCancelled",!1),M(this,"clearEvent",void 0),M(this,"visibility",HB),M(this,"_hasCachedExtEv",!1),M(this,"_cachedExtEv",void 0),M(this,"_decryptionFailureReason",null),M(this,"senderCurve25519Key",null),M(this,"claimedEd25519Key",null),M(this,"keyForwardedBy",void 0),M(this,"decryptionPromise",null),M(this,"retryDecryption",!1),M(this,"txnId",void 0),M(this,"thread",void 0),M(this,"threadId",void 0),M(this,"localTimestamp",void 0),M(this,"sender",null),M(this,"target",null),M(this,"status",null),M(this,"error",null),M(this,"forwardLooking",!0),M(this,"reEmitter",void 0),M(this,"unstableStickyExpiresAt",void 0),["state_key","type","sender","room_id","membership"].forEach(s=>{typeof n[s]=="string"&&(n[s]=qI(n[s]))}),["membership","avatar_url","displayname"].forEach(s=>{var o;typeof((o=n.content)===null||o===void 0?void 0:o[s])=="string"&&(n.content[s]=qI(n.content[s]))}),["rel_type"].forEach(s=>{var o;typeof((o=n.content)===null||o===void 0||(o=o["m.relates_to"])===null||o===void 0?void 0:o[s])=="string"&&(n.content["m.relates_to"][s]=qI(n.content["m.relates_to"][s]))}),this.txnId=n.txn_id;var r=this.getAge(),i=Date.now();this.localTimestamp=r!==void 0?i-r:(e=this.getTs())!==null&&e!==void 0?e:i,this.reEmitter=new py(this),this.unstableStickyInfo&&(this.unstableStickyInfo.duration_ttl_ms?this.unstableStickyExpiresAt=i+this.unstableStickyInfo.duration_ttl_ms:this.unstableStickyExpiresAt=Math.min(i,this.getTs())+this.unstableStickyInfo.duration_ms)}get unstableExtensibleEvent(){if(!this._hasCachedExtEv){var e;this._cachedExtEv=(e=Eo.ExtensibleEvents.parse(this.getEffectiveEvent()))!==null&&e!==void 0?e:void 0}return this._cachedExtEv}invalidateExtensibleEvent(){this._hasCachedExtEv=!1}getEffectiveEvent(){var e=Object.assign({},this.getContent());if(this.getWireType()===ee.RoomMessageEncrypted)for(var[n,r]of Object.entries(this.getWireContent()))["algorithm","ciphertext","device_id","sender_key","session_id"].includes(n)||e[n]===void 0&&(e[n]=r);return Object.assign({},this.event,this.clearEvent,{content:e})}getId(){return this.event.event_id}getSender(){return this.event.sender}getType(){return this.clearEvent?this.clearEvent.type:this.event.type}getWireType(){return this.event.type}getRoomId(){return this.event.room_id}getTs(){return this.event.origin_server_ts}getDate(){return this.event.origin_server_ts?new Date(this.event.origin_server_ts):null}getDetails(){var e=this.getRoomId();if(e){var n;return"id=".concat(this.getId()," type=").concat(this.getWireType()," sender=").concat(this.getSender()," room=").concat(e," ts=").concat((n=this.getDate())===null||n===void 0?void 0:n.toISOString())}else{var r=this.getContent()[yT];return"msgid=".concat(r," type=").concat(this.getWireType()," sender=").concat(this.getSender())}}getOriginalContent(){var e;if(this._localRedactionEvent)return{};if(this.clearEvent){var n;return(n=this.clearEvent.content)!==null&&n!==void 0?n:{}}return(e=this.event.content)!==null&&e!==void 0?e:{}}getContent(){if(this._localRedactionEvent)return{};if(this._replacingEvent){var e;return(e=this._replacingEvent.getContent()["m.new_content"])!==null&&e!==void 0?e:{}}else return this.getOriginalContent()}getWireContent(){return this.event.content||{}}get threadRootId(){var e;if(!this.isState()){var n=(e=this.getWireContent())===null||e===void 0?void 0:e["m.relates_to"];if(n?.rel_type===Rn.name)return n.event_id;if(this.thread)return this.thread.id;if(this.threadId!==void 0)return this.threadId;var r=this.getUnsigned();if(typeof r[CC.name]=="string")return r[CC.name]}}get isThreadRoot(){if(this.isState())return!1;var e=this.getServerAggregatedRelation(Rn.name);return!!e||this.threadRootId===this.getId()}get replyEventId(){var e;return(e=this.getWireContent()["m.relates_to"])===null||e===void 0||(e=e["m.in_reply_to"])===null||e===void 0?void 0:e.event_id}get relationEventId(){var e;return(e=this.getWireContent())===null||e===void 0||(e=e["m.relates_to"])===null||e===void 0?void 0:e.event_id}getPrevContent(){return this.getUnsigned().prev_content||{}}getDirectionalContent(){return this.forwardLooking?this.getContent():this.getPrevContent()}getAge(){return this.getUnsigned().age}getLocalAge(){return Date.now()-this.localTimestamp}getStateKey(){return this.clearEvent?this.clearEvent.state_key:this.event.state_key}getWireStateKey(){return this.event.state_key}isState(){return this.event.state_key!==void 0}getMembershipAtEvent(){var e=this.getUnsigned();return rJ.findIn(e)}makeEncrypted(e,n,r,i){this.clearEvent={type:this.event.type,content:this.event.content,state_key:this.event.state_key},this.event.type=e,this.event.content=n,this.senderCurve25519Key=r,this.claimedEd25519Key=i,this.isState()&&(this.event.state_key="".concat(this.clearEvent.type,":").concat(this.clearEvent.state_key))}isBeingDecrypted(){return this.decryptionPromise!=null}getDecryptionPromise(){return this.decryptionPromise}isDecryptionFailure(){return this._decryptionFailureReason!==null}get decryptionFailureReason(){return this._decryptionFailureReason}shouldAttemptDecryption(){return!(this.isRedacted()||this.isBeingDecrypted()||this.clearEvent||!this.isEncrypted())}attemptDecryption(e){var n=arguments,r=this;return B(function*(){var i=n.length>1&&n[1]!==void 0?n[1]:{};if(!r.isEncrypted())throw new Error("Attempt to decrypt event which isn't encrypted");var s=r.clearEvent&&!r.isDecryptionFailure();if(s)throw new Error("Attempt to decrypt event which has already been decrypted");return r.decryptionPromise?(N.log("Event ".concat(r.getId()," already being decrypted; queueing a retry")),r.retryDecryption=!0,r.decryptionPromise):(r.decryptionPromise=r.decryptionLoop(e,i),r.decryptionPromise)})()}getKeyRequestRecipients(e){var n=[{userId:e,deviceId:"*"}];return n}decryptionLoop(e){var n=arguments,r=this;return B(function*(){var i=n.length>1&&n[1]!==void 0?n[1]:{};for(yield Promise.resolve();;){r.retryDecryption=!1;var s=void 0;try{var o=yield e.decryptEvent(r);i.isRetry===!0&&N.info("Decrypted event on retry (".concat(r.getDetails(),")")),r.setClearData(o),r._decryptionFailureReason=null}catch(c){var a=c instanceof BB?c.detailedString:String(c);if(s=c,r.retryDecryption){N.log("Error decrypting event (".concat(r.getDetails(),"), but retrying: ").concat(a));continue}N.warn("Error decrypting event (".concat(r.getDetails(),"): ").concat(a)),r.setClearDataForDecryptionFailure(String(c)),r._decryptionFailureReason=c instanceof BB?c.code:J0e.UNKNOWN_ERROR}r.decryptionPromise=null,r.retryDecryption=!1,r.setPushDetails(),i.emit!==!1&&r.emit(Zt.Decrypted,r,s);return}})()}setClearData(e){var n,r;this.clearEvent=e.clearEvent,this.senderCurve25519Key=(n=e.senderCurve25519Key)!==null&&n!==void 0?n:null,this.claimedEd25519Key=(r=e.claimedEd25519Key)!==null&&r!==void 0?r:null,this.keyForwardedBy=e.keyForwardedBy,this.invalidateExtensibleEvent()}setClearDataForDecryptionFailure(e){this.clearEvent={type:ee.RoomMessage,content:{msgtype:"m.bad.encrypted",body:"** Unable to decrypt: ".concat(e," **")}},this.senderCurve25519Key=null,this.claimedEd25519Key=null,this.invalidateExtensibleEvent()}getClearContent(){return this.clearEvent?this.clearEvent.content:null}isEncrypted(){return this.event.type===ee.RoomMessageEncrypted}getSenderKey(){return this.senderCurve25519Key}getKeysClaimed(){return this.claimedEd25519Key?{ed25519:this.claimedEd25519Key}:{}}getClaimedEd25519Key(){return this.claimedEd25519Key}getForwardingCurve25519KeyChain(){return[]}isKeySourceUntrusted(){return!1}getKeyForwardingUser(){return this.keyForwardedBy}getUnsigned(){return this.event.unsigned||{}}setUnsigned(e){this.event.unsigned=e}unmarkLocallyRedacted(){var e=this._localRedactionEvent;return this._localRedactionEvent=null,this.event.unsigned&&(this.event.unsigned.redacted_because=void 0),!!e}markLocallyRedacted(e){this._localRedactionEvent||(this.emit(Zt.BeforeRedaction,this,e),this._localRedactionEvent=e,this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=e.event)}applyVisibilityEvent(e){var n,r,i=(n=e?.visible)!==null&&n!==void 0?n:!0,s=(r=e?.reason)!==null&&r!==void 0?r:null,o=!1;(this.visibility.visible!==i||!this.visibility.visible&&this.visibility.reason!==s)&&(o=!0),o&&(i?this.visibility=HB:this.visibility=Object.freeze({visible:!1,reason:s}),this.emit(Zt.VisibilityChange,this,i))}messageVisibility(){return this.visibility}makeRedacted(e,n){if(!e.event)throw new Error("invalid redactionEvent in makeRedacted");this._localRedactionEvent=null,this.emit(Zt.BeforeRedaction,this,e),this._replacingEvent=null,this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=e.event;for(var r in this.event)this.event.hasOwnProperty(r)&&!sbe.has(r)&&delete this.event[r];this.isEncrypted()&&(this.clearEvent=void 0);var i=this.getType()in qB?qB[this.getType()]:{},s=this.getContent();for(var o in s)s.hasOwnProperty(o)&&!i[o]&&delete s[o];!this.isThreadRoot&&this.threadRootId&&this.threadRootId!==this.getId()&&(this.moveAllRelatedToMainTimeline(n),e.moveToMainTimeline(n)),this.invalidateExtensibleEvent()}moveAllRelatedToMainTimeline(e){var n=this.thread;if(this.moveToMainTimeline(e),n)for(var r of n.events){var i;((i=r.getRelation())===null||i===void 0?void 0:i.event_id)===this.getId()&&r.moveAllRelatedToMainTimeline(e)}}moveToMainTimeline(e){var n;(n=this.thread)===null||n===void 0||n.timelineSet.removeEvent(this.getId()),this.setThread(void 0);var r=e.getLiveTimeline();r.getTimelineSet().insertEventIntoTimeline(this,r,r.getState(Ue.FORWARDS),!1)}isRedacted(){return!!this.getUnsigned().redacted_because}isRedaction(){return this.getType()===ee.RoomRedaction}asVisibilityChange(){if(!dp.matches(this.getType()))return null;var e=this.getRelation();if(!e||e.rel_type!="m.reference")return null;var n=e.event_id;if(!n)return null;var r=this.getWireContent(),i=!!r.visible,s=r.reason;return s&&typeof s!="string"?null:{visible:i,reason:s,eventId:n}}isVisibilityEvent(){return dp.matches(this.getType())}getRedactionEvent(){var e,n;if(!this.isRedacted())return null;if((e=this.clearEvent)!==null&&e!==void 0&&e.unsigned){var r,i;return(r=(i=this.clearEvent)===null||i===void 0?void 0:i.unsigned.redacted_because)!==null&&r!==void 0?r:null}else return(n=this.event.unsigned)!==null&&n!==void 0&&n.redacted_because?this.event.unsigned.redacted_because:{}}getPushActions(){return this.pushDetails.actions||null}getPushDetails(){return this.pushDetails}setPushDetails(e,n){this.pushDetails={actions:e,rule:n}}handleRemoteEcho(e){var n,r=this.getUnsigned(),i=this.getId();this.event=e,r.redacted_because&&(this.event.unsigned||(this.event.unsigned={}),this.event.unsigned.redacted_because=r.redacted_because),this.setStatus(null),this.getId()!==i&&this.emit(Zt.LocalEventIdReplaced,this),this.localTimestamp=Date.now()-((n=this.getAge())!==null&&n!==void 0?n:0)}isSending(){return!!this.status}setStatus(e){this.status=e,this.emit(Zt.Status,this,e)}replaceLocalEventId(e){this.event.event_id=e,this.emit(Zt.LocalEventIdReplaced,this)}isRelation(e){var n,r=(n=this.getWireContent())===null||n===void 0?void 0:n["m.relates_to"];return this.isState()&&(r!=null&&r.rel_type)&&[vn.Replace,vn.Thread].includes(r.rel_type)?!1:!!(r!=null&&r.rel_type&&r.event_id&&(!e||r.rel_type===e))}getRelation(){var e;return this.isRelation()&&(e=this.getWireContent()["m.relates_to"])!==null&&e!==void 0?e:null}makeReplaced(e){this.isRedacted()&&e||this.isState()||this._replacingEvent!==e&&(this._replacingEvent=e??null,this.emit(Zt.Replaced,this),this.invalidateExtensibleEvent())}getAssociatedStatus(){return this._replacingEvent?this._replacingEvent.status:this._localRedactionEvent?this._localRedactionEvent.status:this.status}getServerAggregatedRelation(e){var n;return(n=this.getUnsigned()["m.relations"])===null||n===void 0?void 0:n[e]}replacingEventId(){var e=this.getServerAggregatedRelation(vn.Replace);if(e)return e.event_id;if(this._replacingEvent)return this._replacingEvent.getId()}replacingEvent(){return this._replacingEvent}replacingEventDate(){var e=this.getServerAggregatedRelation(vn.Replace);if(e){var n=e.origin_server_ts;if(Number.isFinite(n))return new Date(n)}else if(this._replacingEvent){var r;return(r=this._replacingEvent.getDate())!==null&&r!==void 0?r:void 0}}localRedactionEvent(){return this._localRedactionEvent}getAssociatedId(){var e=this.getRelation();if(this.replyEventId)return this.replyEventId;if(e)return e.event_id;if(this.isRedaction())return this.event.redacts}hasAssociation(){return!!this.getAssociatedId()}updateAssociatedId(e){var n=this.getRelation();n?n.event_id=e:this.isRedaction()&&(this.event.redacts=e)}flagCancelled(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this._isCancelled=e}isCancelled(){return this._isCancelled}toSnapshot(){var e=new es(JSON.parse(JSON.stringify(this.event)));for(var[n,r]of Object.entries(this))n!=="event"&&(e[n]=r);return e}isEquivalentTo(e){if(!e)return!1;if(e===this)return!0;var n=aA(this.event),r=aA(e.event);return JSON.stringify(n)===JSON.stringify(r)}toJSON(){var e=this.getEffectiveEvent();return this.isEncrypted()?{decrypted:e,encrypted:this.event}:e}setTxnId(e){this.txnId=e}getTxnId(){return this.txnId}setThread(e){this.isState()||(this.thread&&this.reEmitter.stopReEmitting(this.thread,[As.Update]),this.thread=e,this.setThreadId(e?.id),e&&this.reEmitter.reEmit(e,[As.Update]))}getThread(){return this.thread}setThreadId(e){this.threadId=e}get unstableStickyInfo(){var e,n;if((e=this.event.msc4354_sticky)!==null&&e!==void 0&&e.duration_ms)return{duration_ms:Math.min(SP,this.event.msc4354_sticky.duration_ms),duration_ttl_ms:(n=this.event.unsigned)===null||n===void 0?void 0:n.msc4354_sticky_duration_ttl_ms}}}var sbe=new Set(["event_id","type","room_id","user_id","sender","state_key","prev_state","content","unsigned","origin_server_ts"]),qB={[ee.RoomMember]:{membership:1},[ee.RoomJoinRules]:{join_rule:1},[ee.RoomPowerLevels]:{ban:1,events:1,events_default:1,kick:1,redact:1,state_default:1,users:1,users_default:1}},obe=["1","2","3","4","5","6","7","8","9","10","11"];function abe(t){return!obe.includes(t)}var qo=(function(t){return t[t.NotStarted=0]="NotStarted",t[t.InProgress=1]="InProgress",t[t.Finished=2]="Finished",t})(qo||{}),Rt=(function(t){return t.Events="RoomState.events",t.Members="RoomState.members",t.NewMember="RoomState.newMember",t.Update="RoomState.update",t.BeaconLiveness="RoomState.BeaconLiveness",t.Marker="RoomState.Marker",t})({});class jb extends Gn{constructor(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{status:qo.NotStarted};super(),this.roomId=e,this.oobMemberFlags=n,M(this,"reEmitter",new py(this)),M(this,"sentinels",{}),M(this,"displayNameToUserIds",new Map),M(this,"userIdsToDisplayNames",{}),M(this,"tokenToInvite",{}),M(this,"joinedMemberCount",null),M(this,"summaryJoinedMemberCount",null),M(this,"invitedMemberCount",null),M(this,"summaryInvitedMemberCount",null),M(this,"modified",-1),M(this,"members",{}),M(this,"events",new Map),M(this,"paginationToken",null),M(this,"beacons",new Map),M(this,"_liveBeaconIds",[]),M(this,"getVersionWarning",!1),this.updateModifiedTime()}getRoomVersion(){var e,n=this.getStateEvents(ee.RoomCreate,"");return n?(e=n.getContent().room_version)!==null&&e!==void 0?e:"1":(this.getVersionWarning||(N.warn("[getVersion] Room "+this.roomId+" does not have an m.room.create event"),this.getVersionWarning=!0),"1")}getJoinedMemberCount(){return this.summaryJoinedMemberCount!==null?this.summaryJoinedMemberCount:(this.joinedMemberCount===null&&(this.joinedMemberCount=this.getMembers().reduce((e,n)=>n.membership===Ke.Join?e+1:e,0)),this.joinedMemberCount)}setJoinedMemberCount(e){this.summaryJoinedMemberCount=e}getInvitedMemberCount(){return this.summaryInvitedMemberCount!==null?this.summaryInvitedMemberCount:(this.invitedMemberCount===null&&(this.invitedMemberCount=this.getMembers().reduce((e,n)=>n.membership===Ke.Invite?e+1:e,0)),this.invitedMemberCount)}setInvitedMemberCount(e){this.summaryInvitedMemberCount=e}getMembers(){return Object.values(this.members)}getMembersExcept(e){return this.getMembers().filter(n=>!e.includes(n.userId))}getMember(e){return this.members[e]||null}getSentinelMember(e){if(!e)return null;var n=this.sentinels[e];if(n===void 0){n=new Tb(this.roomId,e);var r=this.members[e];r!=null&&r.events.member&&n.setMembershipEvent(r.events.member,this),this.sentinels[e]=n}return n}getStateEvents(e,n){if(!this.events.has(e))return n===void 0?[]:null;if(n===void 0)return Array.from(this.events.get(e).values());var r=this.events.get(e).get(n);return r||null}get hasLiveBeacons(){var e;return!!((e=this.liveBeaconIds)!==null&&e!==void 0&&e.length)}get liveBeaconIds(){return this._liveBeaconIds}clone(){var e=new jb(this.roomId,this.oobMemberFlags),n=this.oobMemberFlags.status;return this.oobMemberFlags.status=qo.NotStarted,Array.from(this.events.values()).forEach(r=>{e.setStateEvents(Array.from(r.values()))}),this.oobMemberFlags.status=n,this.summaryInvitedMemberCount!==null&&e.setInvitedMemberCount(this.getInvitedMemberCount()),this.summaryJoinedMemberCount!==null&&e.setJoinedMemberCount(this.getJoinedMemberCount()),this.oobMemberFlags.status==qo.Finished&&this.getMembers().forEach(r=>{if(r.isOutOfBand()){var i;(i=e.getMember(r.userId))===null||i===void 0||i.markOutOfBand()}}),e}setUnknownStateEvents(e){var n=e.filter(r=>!this.events.has(r.getType())||!this.events.get(r.getType()).has(r.getStateKey()));this.setStateEvents(n)}setStateEvents(e,n){this.updateModifiedTime(),e.forEach(r=>{if(!(r.getRoomId()!==this.roomId||!r.isState())){dP.matches(r.getType())&&this.setBeacon(r);var i=this.getStateEventMatching(r);if(this.setStateEvent(r),r.getType()===ee.RoomMember){var s;this.updateDisplayNameCache(r.getStateKey(),(s=r.getContent().displayname)!==null&&s!==void 0?s:""),this.updateThirdPartyTokenCache(r)}this.emit(Rt.Events,r,this,i)}}),this.onBeaconLivenessChange(),e.forEach(r=>{if(!(r.getRoomId()!==this.roomId||!r.isState()))if(r.getType()===ee.RoomMember){var i=r.getStateKey();(r.getContent().membership===Ke.Leave||r.getContent().membership===Ke.Ban)&&(r.getContent().avatar_url=r.getContent().avatar_url||r.getPrevContent().avatar_url,r.getContent().displayname=r.getContent().displayname||r.getPrevContent().displayname);var s=this.getOrCreateMember(i,r);s.setMembershipEvent(r,this),this.updateMember(s),this.emit(Rt.Members,r,this,s)}else if(r.getType()===ee.RoomPowerLevels){if(r.getStateKey()!=="")return;var o=Object.values(this.members),a=this.getStateEvents(ee.RoomCreate,""),c=VB(this.getRoomVersion(),a);o.forEach(l=>{var d=l.getLastModifiedTime();if(a){var h=KB(l.userId,r,c);l.setPowerLevel(h,r)}d!==l.getLastModifiedTime()&&this.emit(Rt.Members,r,this,l)}),this.sentinels={}}else eJ.matches(r.getType())&&this.emit(Rt.Marker,r,n)}),this.emit(Rt.Update,this)}processBeaconEvents(e,n){var r=this;return B(function*(){if(!(!e.length||!r.beacons.size)){var i=[...r.beacons.values()].reduce((l,d)=>(l[d.beaconInfoId]=d,l),{}),s=(l,d)=>{if(MA.matches(d.getType())){var h=i[l];h&&h.addLocations([d])}},o=function*(d){var h,m=(h=d.getRelation())===null||h===void 0?void 0:h.event_id;if(!m||!i[m])return{v:void 0};if(!MA.matches(d.getType())&&!d.isEncrypted())return{v:void 0};try{yield n.decryptEventIfNeeded(d),s(m,d)}catch{d.isDecryptionFailure()&&d.once(Zt.Decrypted,B(function*(){s(m,d)}))}},a;for(var c of e)if(a=yield*o(c),a)return a.v}})()}getOrCreateMember(e,n){var r=this.members[e];return r||(r=new Tb(this.roomId,e),this.members[e]=r,this.emit(Rt.NewMember,n,this,r)),r}setStateEvent(e){this.events.has(e.getType())||this.events.set(e.getType(),new Map),this.events.get(e.getType()).set(e.getStateKey(),e)}setBeacon(e){var n=RC(e);if(this.beacons.has(n)){var r=this.beacons.get(n);if(e.isRedacted()){var i;r.beaconInfoId===((i=e.getRedactionEvent())===null||i===void 0?void 0:i.redacts)&&(r.destroy(),this.beacons.delete(n));return}return r.update(e)}if(!e.isRedacted()){var s=new RJ(e);this.reEmitter.reEmit(s,[Qn.New,Qn.Update,Qn.Destroy,Qn.LivenessChange]),this.emit(Qn.New,e,s),s.on(Qn.LivenessChange,this.onBeaconLivenessChange.bind(this)),s.on(Qn.Destroy,this.onBeaconLivenessChange.bind(this)),this.beacons.set(s.identifier,s)}}onBeaconLivenessChange(){this._liveBeaconIds=Array.from(this.beacons.values()).filter(e=>e.isLive).map(e=>e.identifier),this.emit(Rt.BeaconLiveness,this,this.hasLiveBeacons)}getStateEventMatching(e){var n,r;return(n=(r=this.events.get(e.getType()))===null||r===void 0?void 0:r.get(e.getStateKey()))!==null&&n!==void 0?n:null}updateMember(e){var n=this.getStateEvents(ee.RoomCreate,""),r=this.getStateEvents(ee.RoomPowerLevels,"");if(r&&n){var i=KB(e.userId,r,VB(this.getRoomVersion(),n));e.setPowerLevel(i,r)}delete this.sentinels[e.userId],this.members[e.userId]=e,this.joinedMemberCount=null,this.invitedMemberCount=null}needsOutOfBandMembers(){return this.oobMemberFlags.status===qo.NotStarted}outOfBandMembersReady(){return this.oobMemberFlags.status===qo.Finished}markOutOfBandMembersStarted(){this.oobMemberFlags.status===qo.NotStarted&&(this.oobMemberFlags.status=qo.InProgress)}markOutOfBandMembersFailed(){this.oobMemberFlags.status===qo.InProgress&&(this.oobMemberFlags.status=qo.NotStarted)}clearOutOfBandMembers(){var e=0;Object.keys(this.members).forEach(n=>{var r=this.members[n];r.isOutOfBand()&&(++e,delete this.members[n])}),N.log("LL: RoomState removed ".concat(e," members...")),this.oobMemberFlags.status=qo.NotStarted}setOutOfBandMembers(e){N.log("LL: RoomState about to set ".concat(e.length," OOB members ...")),this.oobMemberFlags.status===qo.InProgress&&(N.log("LL: RoomState put in finished state ..."),this.oobMemberFlags.status=qo.Finished,e.forEach(n=>this.setOutOfBandMember(n)),this.emit(Rt.Update,this))}setOutOfBandMember(e){if(e.getType()===ee.RoomMember){var n=e.getStateKey(),r=this.getMember(n);if(!(r&&!r.isOutOfBand())){var i=this.getOrCreateMember(n,e);i.setMembershipEvent(e,this),i.markOutOfBand(),this.updateDisplayNameCache(i.userId,i.name),this.setStateEvent(e),this.updateMember(i),this.emit(Rt.Members,e,this,i)}}}setTypingEvent(e){Object.values(this.members).forEach(function(n){n.setTypingEvent(e)})}getInviteForThreePidToken(e){return this.tokenToInvite[e]||null}updateModifiedTime(){this.modified=Date.now()}getLastModifiedTime(){return this.modified}getUserIdsWithDisplayName(e){var n;return(n=this.displayNameToUserIds.get(kf(e)))!==null&&n!==void 0?n:[]}maySendRedactionForEvent(e,n){var r=this.getMember(n);if(!r||r.membership===Ke.Leave||e.status||e.isRedacted())return!1;var i=this.maySendEvent(ee.RoomRedaction,n);return i?e.getSender()===n?!0:this.hasSufficientPowerLevelFor("redact",r.powerLevel):!1}hasSufficientPowerLevelFor(e,n){var r=this.getStateEvents(ee.RoomPowerLevels,""),i={};r&&(i=r.getContent());var s=50;return a$(i[e])&&(s=i[e]),n>=s}maySendMessage(e){return this.maySendEventOfType(ee.RoomMessage,e,!1)}maySendEvent(e,n){return this.maySendEventOfType(e,n,!1)}mayClientSendStateEvent(e,n){return n.isGuest()||!n.credentials.userId?!1:this.maySendStateEvent(e,n.credentials.userId)}maySendStateEvent(e,n){return this.maySendEventOfType(e,n,!0)}maySendEventOfType(e,n,r){var i,s=this.getStateEvents(ee.RoomPowerLevels,""),o,a={},c=0,l=0;s&&(o=s.getContent(),a=o.events||{},Number.isSafeInteger(o.state_default)?c=o.state_default:c=50,Number.isSafeInteger(o.events_default)&&(l=o.events_default));var d=r?c:l;Number.isSafeInteger(a[e])&&(d=a[e]);var h=this.getMember(n),m=(i=h?.powerLevel)!==null&&i!==void 0?i:0;return m>=d}mayTriggerNotifOfType(e,n){var r=this.getMember(n);if(!r)return!1;var i=this.getStateEvents(ee.RoomPowerLevels,""),s=50;return i&&i.getContent()&&i.getContent().notifications&&a$(i.getContent().notifications[e])&&(s=i.getContent().notifications[e]),r.powerLevel>=s}getJoinRule(){var e,n=this.getStateEvents(ee.RoomJoinRules,""),r=(e=n?.getContent())!==null&&e!==void 0?e:{};return r.join_rule||xf.Invite}getHistoryVisibility(){var e,n=this.getStateEvents(ee.RoomHistoryVisibility,""),r=(e=n?.getContent())!==null&&e!==void 0?e:{};return r.history_visibility||uP.Shared}getGuestAccess(){var e,n=this.getStateEvents(ee.RoomGuestAccess,""),r=(e=n?.getContent())!==null&&e!==void 0?e:{};return r.guest_access||AC.Forbidden}findPredecessor(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(e){var n=this.getStateEvents(ee.RoomPredecessor,"");if(n){var r=n.getContent(),i=r.predecessor_room_id,s=r.last_known_event_id;typeof s!="string"&&(s=void 0);var o=r.via_servers;if(Array.isArray(o)||(o=void 0),typeof i=="string")return{roomId:i,eventId:s,viaServers:o}}}var a=this.getStateEvents(ee.RoomCreate,"");if(a){var c=a.getContent().predecessor;if(c){var l=c.room_id;if(typeof l=="string"){var d=c.event_id;return(typeof d!="string"||d==="")&&(d=void 0),{roomId:l,eventId:d}}}}return null}updateThirdPartyTokenCache(e){if(e.getContent().third_party_invite){var n=(e.getContent().third_party_invite.signed||{}).token;if(n){var r=this.getStateEvents(ee.RoomThirdPartyInvite,n);r&&(this.tokenToInvite[n]=e)}}}updateDisplayNameCache(e,n){var r=this.userIdsToDisplayNames[e];if(delete this.userIdsToDisplayNames[e],r){var i=kf(r),s=this.displayNameToUserIds.get(i);if(s){var o=s.filter(d=>d!==e);this.displayNameToUserIds.set(i,o)}}this.userIdsToDisplayNames[e]=n;var a=n&&kf(n);if(a){var c,l=(c=this.displayNameToUserIds.get(a))!==null&&c!==void 0?c:[];l.push(e),this.displayNameToUserIds.set(a,l)}}}function VB(t,e){var n=new Set;if(abe(t)&&e){var r=e.getSender();r&&n.add(r);var i=e.getDirectionalContent().additional_creators;Array.isArray(i)&&i.forEach(s=>n.add(s))}return n}function KB(t,e,n){if(n.has(t))return 1/0;var r=e.getDirectionalContent(),i=r.users||{};return i[t]!==void 0&&Number.isInteger(i[t])?i[t]:r.users_default!==void 0?r.users_default:0}function GB(t){var e=typeof t=="string"&&!!t&&t!=="undefined"&&t!=="null";return e||typeof t=="number"}class Fb{constructor(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};M(this,"rooms",{}),M(this,"users",{}),M(this,"syncToken",null),M(this,"filters",new Hu(()=>new Map)),M(this,"accountData",new Map),M(this,"localStorage",void 0),M(this,"oobMembers",new Map),M(this,"pendingEvents",{}),M(this,"clientOptions",void 0),M(this,"pendingToDeviceBatches",[]),M(this,"nextToDeviceBatchId",0),M(this,"createUser",void 0),M(this,"onRoomMember",(n,r,i)=>{var s;if(i.membership!==Ke.Invite){var o=this.users[i.userId]||((s=this.createUser)===null||s===void 0?void 0:s.call(this,i.userId));i.name&&(o.setDisplayName(i.name),i.events.member&&o.setRawDisplayName(i.events.member.getDirectionalContent().displayname)),i.events.member&&i.events.member.getContent().avatar_url&&o.setAvatarUrl(i.events.member.getContent().avatar_url),this.users[o.userId]=o}}),this.localStorage=e.localStorage}getSyncToken(){return this.syncToken}isNewlyCreated(){return Promise.resolve(!0)}setSyncToken(e){this.syncToken=e}storeRoom(e){this.rooms[e.roomId]=e,e.currentState.on(Rt.Members,this.onRoomMember),e.currentState.getMembers().forEach(n=>{this.onRoomMember(null,e.currentState,n)})}setUserCreator(e){this.createUser=e}getRoom(e){return this.rooms[e]||null}getRooms(){return Object.values(this.rooms)}removeRoom(e){this.rooms[e]&&this.rooms[e].currentState.removeListener(Rt.Members,this.onRoomMember),delete this.rooms[e]}getRoomSummaries(){return Object.values(this.rooms).map(function(e){return e.summary})}storeUser(e){this.users[e.userId]=e}getUser(e){return this.users[e]||null}getUsers(){return Object.values(this.users)}scrollback(e,n){return[]}storeEvents(e,n,r,i){}storeFilter(e){!(e!=null&&e.userId)||!(e!=null&&e.filterId)||this.filters.getOrCreate(e.userId).set(e.filterId,e)}getFilter(e,n){var r;return((r=this.filters.get(e))===null||r===void 0?void 0:r.get(n))||null}getFilterIdByName(e){if(!this.localStorage)return null;var n="mxjssdk_memory_filter_"+e;try{var r=this.localStorage.getItem(n);if(GB(r))return r}catch{}return null}setFilterIdByName(e,n){if(this.localStorage){var r="mxjssdk_memory_filter_"+e;try{GB(n)?this.localStorage.setItem(r,n):this.localStorage.removeItem(r)}catch{}}}storeAccountDataEvents(e){e.forEach(n=>{var r=!Object.keys(n.getContent()).length;r?this.accountData.delete(n.getType()):this.accountData.set(n.getType(),n)})}getAccountData(e){return this.accountData.get(e)}setSyncData(e){return Promise.resolve()}wantsSave(){return!1}save(e){return Promise.resolve()}startup(){return Promise.resolve()}getSavedSync(){return Promise.resolve(null)}getSavedSyncToken(){return Promise.resolve(null)}deleteAllData(){return this.rooms={},this.users={},this.syncToken=null,this.filters=new Hu(()=>new Map),this.accountData=new Map,Promise.resolve()}getOutOfBandMembers(e){return Promise.resolve(this.oobMembers.get(e)||null)}setOutOfBandMembers(e,n){return this.oobMembers.set(e,n),Promise.resolve()}clearOutOfBandMembers(e){return this.oobMembers.delete(e),Promise.resolve()}getClientOptions(){return Promise.resolve(this.clientOptions)}storeClientOptions(e){return this.clientOptions=Object.assign({},e),Promise.resolve()}getPendingEvents(e){var n=this;return B(function*(){var r;return(r=n.pendingEvents[e])!==null&&r!==void 0?r:[]})()}setPendingEvents(e,n){var r=this;return B(function*(){r.pendingEvents[e]=n})()}saveToDeviceBatches(e){for(var n of e)this.pendingToDeviceBatches.push({id:this.nextToDeviceBatchId++,eventType:n.eventType,txnId:n.txnId,batch:n.batch});return Promise.resolve()}getOldestToDeviceBatch(){var e=this;return B(function*(){return e.pendingToDeviceBatches.length===0?null:e.pendingToDeviceBatches[0]})()}removeToDeviceBatch(e){return this.pendingToDeviceBatches=this.pendingToDeviceBatches.filter(n=>n.id!==e),Promise.resolve()}destroy(){return B(function*(){})()}}var EQ=(t=>(t.ToWidget="toWidget",t.FromWidget="fromWidget",t))(EQ||{});function cbe(t){if(t==="toWidget")return"fromWidget";if(t==="fromWidget")return"toWidget";throw new Error("Invalid direction")}var yu=(t=>(t.MSC2762="org.matrix.msc2762",t.MSC2762_UPDATE_STATE="org.matrix.msc2762_update_state",t.MSC2871="org.matrix.msc2871",t.MSC2873="org.matrix.msc2873",t.MSC2931="org.matrix.msc2931",t.MSC2974="org.matrix.msc2974",t.MSC2876="org.matrix.msc2876",t.MSC3819="org.matrix.msc3819",t.MSC3846="town.robin.msc3846",t.MSC3869="org.matrix.msc3869",t.MSC3973="org.matrix.msc3973",t.MSC4039="org.matrix.msc4039",t))(yu||{});const lbe=["0.0.1","0.0.2","org.matrix.msc2762","org.matrix.msc2762_update_state","org.matrix.msc2871","org.matrix.msc2873","org.matrix.msc2931","org.matrix.msc2974","org.matrix.msc2876","org.matrix.msc3819","town.robin.msc3846","org.matrix.msc3869","org.matrix.msc3973","org.matrix.msc4039"];class ube extends vT.EventEmitter{constructor(e,n,r,i){super(),this.sendDirection=e,this.transportWindow=r,this.inboundWindow=i,this.strictOriginCheck=!1,this.targetOrigin="*",this.timeoutSeconds=10,this._ready=!1,this.outboundRequests=new Map,this.stopController=new AbortController,this._widgetId=n}get ready(){return this._ready}get widgetId(){return this._widgetId||null}get nextRequestId(){const e=`widgetapi-${Date.now()}`;let n=0,r=e;for(;this.outboundRequests.has(r);)r=`${e}-${n++}`;return this.outboundRequests.set(r,null),r}sendInternal(e){console.log(`[PostmessageTransport] Sending object to ${this.targetOrigin}: `,e),this.transportWindow.postMessage(e,this.targetOrigin)}reply(e,n){return this.sendInternal({...e,response:n})}send(e,n){return this.sendComplete(e,n).then(r=>r.response)}sendComplete(e,n){if(!this.ready||!this.widgetId)return Promise.reject(new Error("Not ready or unknown widget ID"));const r={api:this.sendDirection,widgetId:this.widgetId,requestId:this.nextRequestId,action:e,data:n};return e===Ir.UpdateVisibility&&(r.visible=n.visible),new Promise((i,s)=>{const o=h=>{d(),i(h)},a=h=>{d(),s(h)},c=setTimeout(()=>a(new Error("Request timed out")),(this.timeoutSeconds||1)*1e3),l=()=>a(new Error("Transport stopped"));this.stopController.signal.addEventListener("abort",l);const d=()=>{this.outboundRequests.delete(r.requestId),clearTimeout(c),this.stopController.signal.removeEventListener("abort",l)};this.outboundRequests.set(r.requestId,{request:r,resolve:o,reject:a}),this.sendInternal(r)})}start(){this.inboundWindow.addEventListener("message",e=>{this.handleMessage(e)}),this._ready=!0}stop(){this._ready=!1,this.stopController.abort()}handleMessage(e){if(this.stopController.signal.aborted||!e.data||this.strictOriginCheck&&e.origin!==globalThis.origin)return;const n=e.data;if(!(!n.action||!n.requestId||!n.widgetId))if(n.response){if(n.api!==this.sendDirection)return;this.handleResponse(n)}else{const r=n;if(r.api!==cbe(this.sendDirection))return;this.handleRequest(r)}}handleRequest(e){if(this.widgetId){if(this.widgetId!==e.widgetId)return}else this._widgetId=e.widgetId;this.emit("message",new CustomEvent("message",{detail:e}))}handleResponse(e){if(e.widgetId!==this.widgetId)return;const n=this.outboundRequests.get(e.requestId);if(n)if(fbe(e.response)){const{message:r,...i}=e.response.error;n.reject(new UC(r,i))}else n.resolve(e)}}var Ir=(t=>(t.SupportedApiVersions="supported_api_versions",t.Capabilities="capabilities",t.NotifyCapabilities="notify_capabilities",t.ThemeChange="theme_change",t.LanguageChange="language_change",t.TakeScreenshot="screenshot",t.UpdateVisibility="visibility",t.OpenIDCredentials="openid_credentials",t.WidgetConfig="widget_config",t.CloseModalWidget="close_modal",t.ButtonClicked="button_clicked",t.SendEvent="send_event",t.SendToDevice="send_to_device",t.UpdateState="update_state",t.UpdateTurnServers="update_turn_servers",t))(Ir||{}),Fn=(t=>(t.SupportedApiVersions="supported_api_versions",t.ContentLoaded="content_loaded",t.SendSticker="m.sticker",t.UpdateAlwaysOnScreen="set_always_on_screen",t.GetOpenIDCredentials="get_openid",t.CloseModalWidget="close_modal",t.OpenModalWidget="open_modal",t.SetModalButtonEnabled="set_button_enabled",t.SendEvent="send_event",t.SendToDevice="send_to_device",t.WatchTurnServers="watch_turn_servers",t.UnwatchTurnServers="unwatch_turn_servers",t.BeeperReadRoomAccountData="com.beeper.read_room_account_data",t.MSC2876ReadEvents="org.matrix.msc2876.read_events",t.MSC2931Navigate="org.matrix.msc2931.navigate",t.MSC2974RenegotiateCapabilities="org.matrix.msc2974.request_capabilities",t.MSC3869ReadRelations="org.matrix.msc3869.read_relations",t.MSC3973UserDirectorySearch="org.matrix.msc3973.user_directory_search",t.MSC4039GetMediaConfigAction="org.matrix.msc4039.get_media_config",t.MSC4039UploadFileAction="org.matrix.msc4039.upload_file",t.MSC4039DownloadFileAction="org.matrix.msc4039.download_file",t.MSC4157UpdateDelayedEvent="org.matrix.msc4157.update_delayed_event",t))(Fn||{}),Ag=(t=>(t.Allowed="allowed",t.Blocked="blocked",t.PendingUserConfirmation="request",t))(Ag||{}),CQ=(t=>(t.Custom="m.custom",t.JitsiMeet="m.jitsi",t.Stickerpicker="m.stickerpicker",t))(CQ||{}),TQ=(t=>(t.Close="m.close",t))(TQ||{}),dl=(t=>(t.Send="send",t.Receive="receive",t))(dl||{});class ls{constructor(e,n,r,i,s){this.direction=e,this.eventType=n,this.kind=r,this.keyStr=i,this.raw=s}matchesAsStateEvent(e,n,r){return this.kind!=="state_event"||this.direction!==e||this.eventType!==n?!1:this.keyStr===null||this.keyStr===r}matchesAsToDeviceEvent(e,n){return!(this.kind!=="to_device"||this.direction!==e||this.eventType!==n)}matchesAsRoomEvent(e,n,r=null){if(this.kind!=="event"||this.direction!==e||this.eventType!==n)return!1;if(this.eventType==="m.room.message"){if(this.keyStr===null||this.keyStr===r)return!0}else return!0;return!1}matchesAsRoomAccountData(e,n){return!(this.kind!=="room_account"||this.direction!==e||this.eventType!==n)}static forStateEvent(e,n,r){n=n.replace(/#/g,"\\#"),r=r!=null?`#${r}`:"";const i=`org.matrix.msc2762.${e}.state_event:${n}${r}`;return ls.findEventCapabilities([i])[0]}static forToDeviceEvent(e,n){const r=`org.matrix.msc3819.${e}.to_device:${n}`;return ls.findEventCapabilities([r])[0]}static forRoomEvent(e,n){const r=`org.matrix.msc2762.${e}.event:${n}`;return ls.findEventCapabilities([r])[0]}static forRoomMessageEvent(e,n){n=n??"";const r=`org.matrix.msc2762.${e}.event:m.room.message#${n}`;return ls.findEventCapabilities([r])[0]}static forRoomAccountData(e,n){const r=`com.beeper.capabilities.${e}.room_account_data:${n}`;return ls.findEventCapabilities([r])[0]}static findEventCapabilities(e){const n=[];for(const r of e){let i=null,s,o=null;if(r.startsWith("org.matrix.msc2762.send.event:")?(i="send",o="event",s=r.substring(30)):r.startsWith("org.matrix.msc2762.send.state_event:")?(i="send",o="state_event",s=r.substring(36)):r.startsWith("org.matrix.msc3819.send.to_device:")?(i="send",o="to_device",s=r.substring(34)):r.startsWith("org.matrix.msc2762.receive.event:")?(i="receive",o="event",s=r.substring(33)):r.startsWith("org.matrix.msc2762.receive.state_event:")?(i="receive",o="state_event",s=r.substring(39)):r.startsWith("org.matrix.msc3819.receive.to_device:")?(i="receive",o="to_device",s=r.substring(37)):r.startsWith("com.beeper.capabilities.receive.room_account_data:")&&(i="receive",o="room_account",s=r.substring(50)),i===null||o===null||s===void 0)continue;const a=s.startsWith("m.room.message#")||o==="state_event";let c=null;if(s.includes("#")&&a){const l=s.split("#"),d=l.findIndex(h=>!h.endsWith("\\"));s=l.slice(0,d+1).map(h=>h.endsWith("\\")?h.substring(0,h.length-1):h).join("#"),c=l.slice(d+1).join("#")}n.push(new ls(i,s,o,c,r))}return n}}var rp=(t=>(t.AnyRoom="*",t))(rp||{}),vE=(t=>(t.Cancel="cancel",t.Restart="restart",t.Send="send",t))(vE||{});const hT=class hT extends Error{constructor(e,n){super(e),this.data=n}};hT.prototype.name=hT.name;let UC=hT;class dbe extends vT.EventEmitter{constructor(e=null,n=null){if(super(),this.capabilitiesFinished=!1,this.supportsMSC2974Renegotiate=!1,this.requestedCapabilities=[],this.turnServerWatchers=0,!globalThis.parent)throw new Error("No parent window. This widget doesn't appear to be embedded properly.");this.transport=new ube(EQ.FromWidget,e,globalThis.parent,globalThis),this.transport.targetOrigin=n,this.transport.on("message",this.handleMessage.bind(this))}hasCapability(e){return Array.isArray(this.approvedCapabilities)?this.approvedCapabilities.includes(e):this.requestedCapabilities.includes(e)}requestCapability(e){if(this.capabilitiesFinished&&!this.supportsMSC2974Renegotiate)throw new Error("Capabilities have already been negotiated");this.requestedCapabilities.push(e)}requestCapabilities(e){for(const n of e)this.requestCapability(n)}requestCapabilityForRoomTimeline(e){this.requestCapability(`org.matrix.msc2762.timeline:${e}`)}requestCapabilityToSendState(e,n){this.requestCapability(ls.forStateEvent(dl.Send,e,n).raw)}requestCapabilityToReceiveState(e,n){this.requestCapability(ls.forStateEvent(dl.Receive,e,n).raw)}requestCapabilityToSendToDevice(e){this.requestCapability(ls.forToDeviceEvent(dl.Send,e).raw)}requestCapabilityToReceiveToDevice(e){this.requestCapability(ls.forToDeviceEvent(dl.Receive,e).raw)}requestCapabilityToSendEvent(e){this.requestCapability(ls.forRoomEvent(dl.Send,e).raw)}requestCapabilityToReceiveEvent(e){this.requestCapability(ls.forRoomEvent(dl.Receive,e).raw)}requestCapabilityToSendMessage(e){this.requestCapability(ls.forRoomMessageEvent(dl.Send,e).raw)}requestCapabilityToReceiveMessage(e){this.requestCapability(ls.forRoomMessageEvent(dl.Receive,e).raw)}requestCapabilityToReceiveRoomAccountData(e){this.requestCapability(ls.forRoomAccountData(dl.Receive,e).raw)}requestOpenIDConnectToken(){return new Promise((e,n)=>{this.transport.sendComplete(Fn.GetOpenIDCredentials,{}).then(r=>{const i=r.response;if(i.state===Ag.Allowed)e(i);else if(i.state===Ag.Blocked)n(new Error("User declined to verify their identity"));else if(i.state===Ag.PendingUserConfirmation){const s=o=>{o.preventDefault();const a=o.detail;a.data.original_request_id===r.requestId&&(a.data.state===Ag.Allowed?(e(a.data),this.transport.reply(a,{})):a.data.state===Ag.Blocked?(n(new Error("User declined to verify their identity")),this.transport.reply(a,{})):(n(new Error("Invalid state on reply: "+i.state)),this.transport.reply(a,{error:{message:"Invalid state"}})),this.off(`action:${Ir.OpenIDCredentials}`,s))};this.on(`action:${Ir.OpenIDCredentials}`,s)}else n(new Error("Invalid state: "+i.state))}).catch(n)})}updateRequestedCapabilities(){return this.transport.send(Fn.MSC2974RenegotiateCapabilities,{capabilities:this.requestedCapabilities}).then()}sendContentLoaded(){return this.transport.send(Fn.ContentLoaded,{}).then()}sendSticker(e){return this.transport.send(Fn.SendSticker,e).then()}setAlwaysOnScreen(e){return this.transport.send(Fn.UpdateAlwaysOnScreen,{value:e}).then(n=>n.success)}openModalWidget(e,n,r=[],i={},s=CQ.Custom){return this.transport.send(Fn.OpenModalWidget,{type:s,url:e,name:n,buttons:r,data:i}).then()}closeModalWidget(e={}){return this.transport.send(Fn.CloseModalWidget,e).then()}sendRoomEvent(e,n,r,i,s,o){return this.sendEvent(e,void 0,n,r,i,s,o)}sendStateEvent(e,n,r,i,s,o){return this.sendEvent(e,n,r,i,s,o)}sendEvent(e,n,r,i,s,o,a){return this.transport.send(Fn.SendEvent,{type:e,content:r,...n!==void 0&&{state_key:n},...i!==void 0&&{room_id:i},...s!==void 0&&{delay:s},...o!==void 0&&{parent_delay_id:o},...a!==void 0&&{sticky_duration_ms:a}})}cancelScheduledDelayedEvent(e){return this.transport.send(Fn.MSC4157UpdateDelayedEvent,{delay_id:e,action:vE.Cancel})}restartScheduledDelayedEvent(e){return this.transport.send(Fn.MSC4157UpdateDelayedEvent,{delay_id:e,action:vE.Restart})}sendScheduledDelayedEvent(e){return this.transport.send(Fn.MSC4157UpdateDelayedEvent,{delay_id:e,action:vE.Send})}sendToDevice(e,n,r){return this.transport.send(Fn.SendToDevice,{type:e,encrypted:n,messages:r})}readRoomAccountData(e,n){const r={type:e};return n&&(n.includes(rp.AnyRoom)?r.room_ids=rp.AnyRoom:r.room_ids=n),this.transport.send(Fn.BeeperReadRoomAccountData,r).then(i=>i.events)}readRoomEvents(e,n,r,i,s){const o={type:e,msgtype:r};return n!==void 0&&(o.limit=n),i&&(i.includes(rp.AnyRoom)?o.room_ids=rp.AnyRoom:o.room_ids=i),s&&(o.since=s),this.transport.send(Fn.MSC2876ReadEvents,o).then(a=>a.events)}async readEventRelations(e,n,r,i,s,o,a,c){if(!(await this.getClientVersions()).includes(yu.MSC3869))throw new Error("The read_relations action is not supported by the client.");const d={event_id:e,rel_type:r,event_type:i,room_id:n,to:a,from:o,limit:s,direction:c};return this.transport.send(Fn.MSC3869ReadRelations,d)}readStateEvents(e,n,r,i){const s={type:e,state_key:r===void 0?!0:r};return n!==void 0&&(s.limit=n),i&&(i.includes(rp.AnyRoom)?s.room_ids=rp.AnyRoom:s.room_ids=i),this.transport.send(Fn.MSC2876ReadEvents,s).then(o=>o.events)}setModalButtonEnabled(e,n){if(e===TQ.Close)throw new Error("The close button cannot be disabled");return this.transport.send(Fn.SetModalButtonEnabled,{button:e,enabled:n}).then()}navigateTo(e){if(!e||!e.startsWith("https://matrix.to/#"))throw new Error("Invalid matrix.to URI");return this.transport.send(Fn.MSC2931Navigate,{uri:e}).then()}async*getTurnServers(){let e;const n=async r=>{r.preventDefault(),e(r.detail.data),this.transport.reply(r.detail,{})};if(this.on(`action:${Ir.UpdateTurnServers}`,n),this.turnServerWatchers===0)try{await this.transport.send(Fn.WatchTurnServers,{})}catch(r){throw this.off(`action:${Ir.UpdateTurnServers}`,n),r}this.turnServerWatchers++;try{for(;;)yield await new Promise(r=>e=r)}finally{this.off(`action:${Ir.UpdateTurnServers}`,n),this.turnServerWatchers--,this.turnServerWatchers===0&&await this.transport.send(Fn.UnwatchTurnServers,{})}}async searchUserDirectory(e,n){if(!(await this.getClientVersions()).includes(yu.MSC3973))throw new Error("The user_directory_search action is not supported by the client.");const i={search_term:e,limit:n};return this.transport.send(Fn.MSC3973UserDirectorySearch,i)}async getMediaConfig(){if(!(await this.getClientVersions()).includes(yu.MSC4039))throw new Error("The get_media_config action is not supported by the client.");const n={};return this.transport.send(Fn.MSC4039GetMediaConfigAction,n)}async uploadFile(e){if(!(await this.getClientVersions()).includes(yu.MSC4039))throw new Error("The upload_file action is not supported by the client.");const r={file:e};return this.transport.send(Fn.MSC4039UploadFileAction,r)}async downloadFile(e){if(!(await this.getClientVersions()).includes(yu.MSC4039))throw new Error("The download_file action is not supported by the client.");const r={content_uri:e};return this.transport.send(Fn.MSC4039DownloadFileAction,r)}start(){this.transport.start(),this.getClientVersions().then(e=>{e.includes(yu.MSC2974)&&(this.supportsMSC2974Renegotiate=!0)})}handleMessage(e){const n=new CustomEvent(`action:${e.detail.action}`,{detail:e.detail,cancelable:!0});if(this.emit(`action:${e.detail.action}`,n),!n.defaultPrevented)switch(e.detail.action){case Ir.SupportedApiVersions:return this.replyVersions(e.detail);case Ir.Capabilities:return this.handleCapabilities(e.detail);case Ir.UpdateVisibility:return this.transport.reply(e.detail,{});case Ir.NotifyCapabilities:return this.transport.reply(e.detail,{});default:return this.transport.reply(e.detail,{error:{message:"Unknown or unsupported action: "+e.detail.action}})}}replyVersions(e){this.transport.reply(e,{supported_versions:lbe})}getClientVersions(){return Array.isArray(this.cachedClientVersions)?Promise.resolve(this.cachedClientVersions):this.transport.send(Fn.SupportedApiVersions,{}).then(e=>(this.cachedClientVersions=e.supported_versions,e.supported_versions)).catch(e=>(console.warn("non-fatal error getting supported client versions: ",e),[]))}handleCapabilities(e){return this.capabilitiesFinished?this.transport.reply(e,{error:{message:"Capability negotiation already completed"}}):this.getClientVersions().then(n=>(n.includes(yu.MSC2871)?this.once(`action:${Ir.NotifyCapabilities}`,r=>{this.approvedCapabilities=r.detail.data.approved,this.emit("ready")}):this.emit("ready"),this.capabilitiesFinished=!0,this.transport.reply(e,{capabilities:this.requestedCapabilities})))}}var lp=(t=>(t.Screenshots="m.capability.screenshot",t.StickerSending="m.sticker",t.AlwaysOnScreen="m.always_on_screen",t.RequiresClient="io.element.requires_client",t.MSC2931Navigate="org.matrix.msc2931.navigate",t.MSC3846TurnServers="town.robin.msc3846.turn_servers",t.MSC3973UserDirectorySearch="org.matrix.msc3973.user_directory_search",t.MSC4039UploadFile="org.matrix.msc4039.upload_file",t.MSC4039DownloadFile="org.matrix.msc4039.download_file",t.MSC4157SendDelayedEvent="org.matrix.msc4157.send.delayed_event",t.MSC4157UpdateDelayedEvent="org.matrix.msc4157.update_delayed_event",t.MSC4407SendStickyEvent="org.matrix.msc4407.send.sticky_event",t.MSC4407ReceiveStickyEvent="org.matrix.msc4407.receive.sticky_event",t))(lp||{});function fbe(t){const e=t.error;return typeof e=="object"&&e!==null&&"message"in e&&typeof e.message=="string"}function zB(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function nw(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?zB(Object(n),!0).forEach(function(r){M(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):zB(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function hbe(t){var e,n,r,i=2;for(typeof Symbol<"u"&&(n=Symbol.asyncIterator,r=Symbol.iterator);i--;){if(n&&(e=t[n])!=null)return e.call(t);if(r&&(e=t[r])!=null)return new yE(e.call(t));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function yE(t){function e(n){if(Object(n)!==n)return Promise.reject(new TypeError(n+" is not an object."));var r=n.done;return Promise.resolve(n.value).then(function(i){return{value:i,done:r}})}return yE=function(r){this.s=r,this.n=r.next},yE.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(r){var i=this.s.return;return i===void 0?Promise.resolve({value:r,done:!0}):e(i.apply(this.s,arguments))},throw:function(r){var i=this.s.return;return i===void 0?Promise.reject(r):e(i.apply(this.s,arguments))}},new yE(t)}var bE=(function(t){return t.PendingEventsChanged="PendingEvent.pendingEventsChanged",t})({});class RQ extends xT{constructor(e,n,r,i,s){var o,a;super(i),o=this,this.widgetApi=e,this.capabilities=n,this.roomId=r,M(this,"room",void 0),M(this,"widgetApiReady",void 0),M(this,"roomStateSynced",void 0),M(this,"lifecycle",void 0),M(this,"syncState",null),M(this,"pendingSendingEventsTxId",[]),M(this,"eventEmitter",new Gn),M(this,"syncApiResolver",Promise.withResolvers()),M(this,"updateTxId",(function(){var d=B(function*(h){if(h.getSender()===o.getUserId()&&o.pendingSendingEventsTxId.some(v=>h.getType()===v.type)){for(var m,g=(m=o.pendingSendingEventsTxId.find(v=>v.id===h.getId()))===null||m===void 0?void 0:m.txId;!g&&o.pendingSendingEventsTxId.length>0;){var y;yield new Promise(v=>o.eventEmitter.once(bE.PendingEventsChanged,()=>v())),g=(y=o.pendingSendingEventsTxId.find(v=>v.id===h.getId()))===null||y===void 0?void 0:y.txId}g&&(h.setTxnId(g),h.setUnsigned(nw(nw({},h.getUnsigned()),{},{transaction_id:g}))),o.pendingSendingEventsTxId=o.pendingSendingEventsTxId.filter(v=>v.id!==h.getId()),o.pendingSendingEventsTxId.length===0&&o.eventEmitter.emit(bE.PendingEventsChanged)}});return function(h){return d.apply(this,arguments)}})()),M(this,"onEvent",(function(){var d=B(function*(h){if(h.preventDefault(),h.detail.data.room_id===o.roomId){var m=new es(h.detail.data);yield o.updateTxId(m),yield o.syncApiResolver.promise,o.syncApi instanceof bf?(yield o.supportUpdateState())?yield o.syncApi.injectRoomEvents(o.room,void 0,[],[m]):yield o.syncApi.injectRoomEvents(o.room,[],void 0,[m]):(yield o.supportUpdateState())?yield o.syncApi.injectRoomEvents(o.room,[],[m]):N.error("slididng sync cannot be used in widget mode if the client widget driver does not support the version: 'org.matrix.msc2762_update_state'"),o.emit(Pe.Event,m),m.unstableStickyInfo!==void 0&&o.room._unstable_addStickyEvents([m]),o.setSyncState(Qt.Syncing),N.info("Received event ".concat(m.getId()," ").concat(m.getType()))}else{var{event_id:g,room_id:y}=h.detail.data;N.info("Received event ".concat(g," for a different room ").concat(y,"; discarding"))}yield o.ack(h)});return function(h){return d.apply(this,arguments)}})()),M(this,"onToDevice",(function(){var d=B(function*(h){h.preventDefault();var m=new es({type:h.detail.data.type,sender:h.detail.data.sender,content:h.detail.data.content});h.detail.data.encrypted&&m.makeEncrypted(ee.RoomMessageEncrypted,{},"",""),o.emit(Pe.ToDeviceEvent,m),o.setSyncState(Qt.Syncing),yield o.ack(h)});return function(h){return d.apply(this,arguments)}})()),M(this,"onStateUpdate",(function(){var d=B(function*(h){h.preventDefault(),(yield o.supportUpdateState())||N.warn("received update_state widget action but the widget driver did not claim to support 'org.matrix.msc2762_update_state'"),yield o.syncApiResolver.promise;for(var m of h.detail.data.state)if(m.room_id===o.roomId){var g=new es(m);o.syncApi instanceof bf?yield o.syncApi.injectRoomEvents(o.room,void 0,[g]):yield o.syncApi.injectRoomEvents(o.room,[g]),N.info("Updated state entry ".concat(g.getType()," ").concat(g.getStateKey()," to ").concat(g.getId()))}else{var{event_id:y,room_id:v}=h.detail.data;N.info("Received state entry ".concat(y," for a different room ").concat(v,"; discarding"))}yield o.ack(h)});return function(h){return d.apply(this,arguments)}})());var c=this.widgetApi.transport.send.bind(this.widgetApi.transport);this.widgetApi.transport.send=(function(){var d=B(function*(h,m){try{return yield c(h,m)}catch(g){WB(g)}});return function(h,m){return d.apply(this,arguments)}})();var l=this.widgetApi.transport.sendComplete.bind(this.widgetApi.transport);this.widgetApi.transport.sendComplete=(function(){var d=B(function*(h,m){try{return yield l(h,m)}catch(g){WB(g)}});return function(h,m){return d.apply(this,arguments)}})(),this.widgetApiReady=new Promise(d=>this.widgetApi.once("ready",d)),this.roomStateSynced=(a=n.receiveState)!==null&&a!==void 0&&a.length?new Promise(d=>this.widgetApi.once("action:".concat(Ir.UpdateState),d)):Promise.resolve(),this.requestInitialCapabilities(n,r),e.on("action:".concat(Ir.SendEvent),this.onEvent),e.on("action:".concat(Ir.SendToDevice),this.onToDevice),e.on("action:".concat(Ir.UpdateState),this.onStateUpdate),e.start(),s&&e.sendContentLoaded()}requestInitialCapabilities(e,n){var r,i,s,o,a,c,l,d,h,m,g,y;((r=e.sendEvent)!==null&&r!==void 0&&r.length||(i=e.receiveEvent)!==null&&i!==void 0&&i.length||e.sendMessage===!0||Array.isArray(e.sendMessage)&&e.sendMessage.length||e.receiveMessage===!0||Array.isArray(e.receiveMessage)&&e.receiveMessage.length||(s=e.sendState)!==null&&s!==void 0&&s.length||(o=e.receiveState)!==null&&o!==void 0&&o.length)&&this.widgetApi.requestCapabilityForRoomTimeline(n),(a=e.sendEvent)===null||a===void 0||a.forEach(v=>this.widgetApi.requestCapabilityToSendEvent(v)),(c=e.receiveEvent)===null||c===void 0||c.forEach(v=>this.widgetApi.requestCapabilityToReceiveEvent(v)),e.sendMessage===!0?this.widgetApi.requestCapabilityToSendMessage():Array.isArray(e.sendMessage)&&e.sendMessage.forEach(v=>this.widgetApi.requestCapabilityToSendMessage(v)),e.receiveMessage===!0?this.widgetApi.requestCapabilityToReceiveMessage():Array.isArray(e.receiveMessage)&&e.receiveMessage.forEach(v=>this.widgetApi.requestCapabilityToReceiveMessage(v)),(l=e.sendState)===null||l===void 0||l.forEach(v=>{var{eventType:E,stateKey:w}=v;return this.widgetApi.requestCapabilityToSendState(E,w)}),(d=e.receiveState)===null||d===void 0||d.forEach(v=>{var{eventType:E,stateKey:w}=v;return this.widgetApi.requestCapabilityToReceiveState(E,w)}),(h=e.sendToDevice)===null||h===void 0||h.forEach(v=>this.widgetApi.requestCapabilityToSendToDevice(v)),(m=e.receiveToDevice)===null||m===void 0||m.forEach(v=>this.widgetApi.requestCapabilityToReceiveToDevice(v)),e.sendDelayedEvents&&((g=e.sendEvent)!==null&&g!==void 0&&g.length||e.sendMessage===!0||Array.isArray(e.sendMessage)&&e.sendMessage.length||(y=e.sendState)!==null&&y!==void 0&&y.length)&&this.widgetApi.requestCapability(lp.MSC4157SendDelayedEvent),e.updateDelayedEvents&&this.widgetApi.requestCapability(lp.MSC4157UpdateDelayedEvent),e.sendSticky&&this.widgetApi.requestCapability(lp.MSC4407SendStickyEvent),e.receiveSticky&&this.widgetApi.requestCapability(lp.MSC4407ReceiveStickyEvent),e.turnServers&&this.widgetApi.requestCapability(lp.MSC3846TurnServers)}supportUpdateState(){var e=this;return B(function*(){return(yield e.widgetApi.getClientVersions()).includes(yu.MSC2762_UPDATE_STATE)})()}startClient(){var e=arguments,n=this;return B(function*(){var r=e.length>0&&e[0]!==void 0?e[0]:{};n.lifecycle=new AbortController;var i=n.getUserId();if(i&&n.store.storeUser(new qu(i)),r.slidingSync?n.syncApi=new ZJ(r.slidingSync,n,r,n.buildSyncApiOptions()):n.syncApi=new bf(n,r,n.buildSyncApiOptions()),n.syncApiResolver.resolve(),n.room=n.syncApi.createRoom(n.roomId),n.store.storeRoom(n.room),yield n.widgetApiReady,yield n.supportUpdateState())yield n.roomStateSynced;else{var s,o;yield Promise.all((s=(o=n.capabilities.receiveState)===null||o===void 0?void 0:o.map((function(){var a=B(function*(c){var{eventType:l,stateKey:d}=c,h=yield n.widgetApi.readStateEvents(l,void 0,d,[n.roomId]),m=h.map(g=>new es(g));n.syncApi instanceof bf?yield n.syncApi.injectRoomEvents(n.room,void 0,m):yield n.syncApi.injectRoomEvents(n.room,m),m.forEach(g=>{n.emit(Pe.Event,g),N.info("Backfilled event ".concat(g.getId()," ").concat(g.getType()," ").concat(g.getStateKey()))})});return function(c){return a.apply(this,arguments)}})()))!==null&&s!==void 0?s:[])}r.clientWellKnownPollPeriod!==void 0&&(n.clientWellKnownIntervalID=setInterval(()=>{n.fetchClientWellKnown()},1e3*r.clientWellKnownPollPeriod),n.fetchClientWellKnown()),n.setSyncState(Qt.Syncing),N.info("Finished initial sync"),n.matrixRTC.start(),n.capabilities.turnServers&&n.watchTurnServers()})()}stopClient(){this.widgetApi.off("action:".concat(Ir.SendEvent),this.onEvent),this.widgetApi.off("action:".concat(Ir.SendToDevice),this.onToDevice),this.widgetApi.off("action:".concat(Ir.UpdateState),this.onStateUpdate),super.stopClient(),this.lifecycle.abort()}joinRoom(e){var n=this;return B(function*(){if(e===n.roomId)return n.room;throw new Error("Unknown room: ".concat(e))})()}encryptAndSendEvent(e,n,r,i){var s=this;return B(function*(){var o,a=i,c;r&&xC(r)?c=r:a||(a=r);var l=(o=a)===null||o===void 0?void 0:o["org.matrix.msc4354.sticky_duration_ms"];if(l!==void 0&&typeof l!="number")throw new Error("Sticky duration must be a number when defined");var d=l,h=n.event.redacts?nw(nw({},n.getContent()),{},{redacts:n.event.redacts}):n.getContent();if(c){var m=yield s.widgetApi.sendRoomEvent(n.getType(),h,e.roomId,"delay"in c?c.delay:void 0,"parent_delay_id"in c?c.parent_delay_id:void 0,d).catch(jo);return s.validateSendDelayedEventResponse(m)}var g=n.getTxnId();g&&s.pendingSendingEventsTxId.push({type:n.getType(),id:void 0,txId:g});var y;try{y=yield s.widgetApi.sendRoomEvent(n.getType(),h,e.roomId,void 0,void 0,d).catch(jo)}catch(v){throw s.updatePendingEventStatus(e,n,lt.NOT_SENT),v}return e.updatePendingEvent(n,lt.SENT,y.event_id),s.pendingSendingEventsTxId.forEach(v=>{v.txId===g&&(v.id=y.event_id)}),s.eventEmitter.emit(bE.PendingEventsChanged),{event_id:y.event_id}})()}sendStateEvent(e,n,r){var i=arguments,s=this;return B(function*(){var o=i.length>3&&i[3]!==void 0?i[3]:"",a=yield s.widgetApi.sendStateEvent(n,o,r,e).catch(jo);if(a.event_id===void 0)throw new Error("'event_id' absent from response to an event request");return{event_id:a.event_id}})()}_unstable_sendDelayedStateEvent(e,n,r,i){var s=arguments,o=this;return B(function*(){var a=s.length>4&&s[4]!==void 0?s[4]:"";if(!(yield o.doesServerSupportUnstableFeature(Xi)))throw new Wo("Server does not support the delayed events API","sendDelayedStateEvent");var c=yield o.widgetApi.sendStateEvent(r,a,i,e,"delay"in n?n.delay:void 0,"parent_delay_id"in n?n.parent_delay_id:void 0).catch(jo);return o.validateSendDelayedEventResponse(c)})()}validateSendDelayedEventResponse(e){if(e.delay_id===void 0)throw new Error("'delay_id' absent from response to a delayed event request");return{delay_id:e.delay_id}}_unstable_updateDelayedEvent(e,n){var r=this;return B(function*(){if(!(yield r.doesServerSupportUnstableFeature(Xi)))throw new Wo("Server does not support the delayed events API","updateDelayedEvent");var i;switch(n){case vp.Cancel:i=r.widgetApi.cancelScheduledDelayedEvent;break;case vp.Restart:i=r.widgetApi.cancelScheduledDelayedEvent;break;case vp.Send:i=r.widgetApi.sendScheduledDelayedEvent;break}return yield i.call(r.widgetApi,e).catch(jo),{}})()}_unstable_cancelScheduledDelayedEvent(e){var n=this;return B(function*(){if(!(yield n.doesServerSupportUnstableFeature(Xi)))throw new Wo("Server does not support the delayed events API","cancelScheduledDelayedEvent");return yield n.widgetApi.cancelScheduledDelayedEvent(e).catch(jo),{}})()}_unstable_restartScheduledDelayedEvent(e){var n=this;return B(function*(){if(!(yield n.doesServerSupportUnstableFeature(Xi)))throw new Wo("Server does not support the delayed events API","restartScheduledDelayedEvent");return yield n.widgetApi.restartScheduledDelayedEvent(e).catch(jo),{}})()}_unstable_sendScheduledDelayedEvent(e){var n=this;return B(function*(){if(!(yield n.doesServerSupportUnstableFeature(Xi)))throw new Wo("Server does not support the delayed events API","sendScheduledDelayedEvent");return yield n.widgetApi.sendScheduledDelayedEvent(e).catch(jo),{}})()}encryptAndSendToDevice(e,n,r){var i=this;return B(function*(){var s=new Hu(()=>new Map);for(var{userId:o,deviceId:a}of n)s.getOrCreate(o).set(a,r);yield i.widgetApi.sendToDevice(e,!0,up(s)).catch(jo)})()}sendToDevice(e,n){var r=this;return B(function*(){return yield r.widgetApi.sendToDevice(e,!1,up(n)).catch(jo),{}})()}getOpenIdToken(){var e=this;return B(function*(){var n=yield e.widgetApi.requestOpenIDConnectToken().catch(jo);return{access_token:n.access_token,expires_in:n.expires_in,matrix_server_name:n.matrix_server_name,token_type:n.token_type}})()}queueToDevice(e){var n=this;return B(function*(){var{eventType:r,batch:i}=e,s=new Hu(()=>new Map);for(var{userId:o,deviceId:a,payload:c}of i)s.getOrCreate(o).set(a,c);yield n.widgetApi.sendToDevice(r,!1,up(s)).catch(jo)})()}sendToDeviceViaWidgetApi(e,n,r){var i=this;return B(function*(){yield i.widgetApi.sendToDevice(e,n,up(r)).catch(jo)})()}checkTurnServers(){var e=this;return B(function*(){return e.turnServers.length>0})()}getSyncState(){return this.syncState}setSyncState(e){var n=this.syncState;this.syncState=e,this.emit(Pe.Sync,e,n)}ack(e){var n=this;return B(function*(){yield n.widgetApi.transport.reply(e.detail,{})})()}watchTurnServers(){var e=this;return B(function*(){var n=e.widgetApi.getTurnServers(),r=()=>{n.return(void 0)};e.lifecycle.signal.addEventListener("abort",r);try{var i=!1,s=!1,o;try{for(var a=hbe(n),c;i=!(c=yield a.next()).done;i=!1){var l=c.value;e.turnServers=[{urls:l.uris,username:l.username,credential:l.password}],e.emit(Pe.TurnServers,e.turnServers),N.log("Received TURN server: ".concat(l.uris))}}catch(d){s=!0,o=d}finally{try{i&&a.return!=null&&(yield a.return())}finally{if(s)throw o}}}catch(d){N.warn("Error watching TURN servers",d)}finally{e.lifecycle.signal.removeEventListener("abort",r)}})()}}function WB(t){throw t instanceof UC&&t.data.matrix_api_error?In.fromWidgetApiErrorData(t.data.matrix_api_error):t}function jo(t){throw t instanceof Error&&t.message==="Request timed out"?new Qp("widget api timeout"):t}class pbe{constructor(){M(this,"unthreadedReadReceipts",new Map),M(this,"threadedReadReceipts",new Hu(()=>new Map))}setUnthreaded(e,n){this.unthreadedReadReceipts.set(e,n)}setThreaded(e,n,r){this.threadedReadReceipts.getOrCreate(e).set(n,r)}allUnthreaded(){return this.unthreadedReadReceipts.entries()}*allThreaded(){for(var e of this.threadedReadReceipts.values())for(var n of e.entries())yield n}consumeEphemeralEvents(e){e?.forEach(n=>{n.type!==ee.Receipt||!n.content||Object.keys(n.content).forEach(r=>{Object.entries(n.content[r]).forEach(i=>{var[s,o]=i;if(qO(s))for(var a of Object.keys(o)){var c=n.content[r][s][a],l={data:n.content[r][s][a],type:s,eventId:r};c.thread_id?this.setThreaded(c.thread_id,a,l):this.setUnthreaded(a,l)}})})})}buildAccumulatedReceiptEvent(e){var n={type:ee.Receipt,room_id:e,content:{}},r=new Hu(()=>new Hu(()=>new Map));for(var[i,s]of this.allUnthreaded())r.getOrCreate(s.eventId).getOrCreate(s.type).set(i,s.data);for(var[o,a]of this.allThreaded())r.getOrCreate(a.eventId).getOrCreate(a.type).set(o,a.data);return n.content=up(r),r.size>0?n:null}}var pu=(function(t){return t.Invite="invite",t.Leave="leave",t.Join="join",t.Knock="knock",t})({});function mbe(t){return"_localTs"in t&&t._localTs!==void 0}class kQ{constructor(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.opts=e,M(this,"accountData",{}),M(this,"inviteRooms",{}),M(this,"knockRooms",{}),M(this,"joinRooms",{}),M(this,"nextBatch",null),this.opts.maxTimelineEntries=this.opts.maxTimelineEntries||50}accumulate(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;this.accumulateRooms(e,n),this.accumulateAccountData(e),this.nextBatch=e.next_batch}accumulateAccountData(e){!e.account_data||!e.account_data.events||e.account_data.events.forEach(n=>{this.accountData[n.type]=n})}accumulateRooms(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;e.rooms&&(e.rooms.invite&&Object.keys(e.rooms.invite).forEach(r=>{this.accumulateRoom(r,pu.Invite,e.rooms.invite[r],n)}),e.rooms.join&&Object.keys(e.rooms.join).forEach(r=>{this.accumulateRoom(r,pu.Join,e.rooms.join[r],n)}),e.rooms.leave&&Object.keys(e.rooms.leave).forEach(r=>{this.accumulateRoom(r,pu.Leave,e.rooms.leave[r],n)}),e.rooms.knock&&Object.keys(e.rooms.knock).forEach(r=>{this.accumulateRoom(r,pu.Knock,e.rooms.knock[r],n)}))}accumulateRoom(e,n,r){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;switch(n){case pu.Invite:this.knockRooms[e]&&delete this.knockRooms[e],this.accumulateInviteState(e,r);break;case pu.Knock:this.accumulateKnockState(e,r);break;case pu.Join:this.knockRooms[e]?delete this.knockRooms[e]:this.inviteRooms[e]&&delete this.inviteRooms[e],this.accumulateJoinState(e,r,i);break;case pu.Leave:this.knockRooms[e]?delete this.knockRooms[e]:this.inviteRooms[e]?delete this.inviteRooms[e]:delete this.joinRooms[e];break;default:N.error("Unknown cateogory: ",n)}}accumulateInviteState(e,n){if(!(!n.invite_state||!n.invite_state.events)){if(!this.inviteRooms[e]){this.inviteRooms[e]={invite_state:n.invite_state};return}var r=this.inviteRooms[e];n.invite_state.events.forEach(i=>{for(var s=!1,o=0;o<r.invite_state.events.length;o++){var a=r.invite_state.events[o];a.type===i.type&&a.state_key==i.state_key&&(r.invite_state.events[o]=i,s=!0)}s||r.invite_state.events.push(i)})}}accumulateKnockState(e,n){if(!(!n.knock_state||!n.knock_state.events)){if(!this.knockRooms[e]){this.knockRooms[e]={knock_state:n.knock_state};return}var r=this.knockRooms[e];n.knock_state.events.forEach(i=>{for(var s=!1,o=0;o<r.knock_state.events.length;o++){var a=r.knock_state.events[o];a.type===i.type&&a.state_key==i.state_key&&(r.knock_state.events[o]=i,s=!0)}s||r.knock_state.events.push(i)})}}accumulateJoinState(e,n){var r,i,s,o,a,c,l,d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,h=Date.now();this.joinRooms[e]||(this.joinRooms[e]={_currentState:Object.create(null),_timeline:[],_accountData:Object.create(null),_unreadNotifications:{},_unreadThreadNotifications:{},_summary:{},_receipts:new pbe,_stickyEvents:[]});var m=this.joinRooms[e];if(n.account_data&&n.account_data.events&&n.account_data.events.forEach(L=>{m._accountData[L.type]=L}),n.unread_notifications&&(m._unreadNotifications=n.unread_notifications),m._unreadThreadNotifications=(r=(i=n[kb.stable])!==null&&i!==void 0?i:n[kb.unstable])!==null&&r!==void 0?r:void 0,n.summary){var g,y,v,E="m.heroes",w="m.invited_member_count",R="m.joined_member_count",x=m._summary,C=n.summary;x[E]=(g=C[E])!==null&&g!==void 0?g:x[E],x[R]=(y=C[R])!==null&&y!==void 0?y:x[R],x[w]=(v=C[w])!==null&&v!==void 0?v:x[w]}if(m._receipts.consumeEphemeralEvents((s=n.ephemeral)===null||s===void 0?void 0:s.events),n.timeline&&n.timeline.limited&&(m._timeline=[]),(o=n.state)===null||o===void 0||(o=o.events)===null||o===void 0||o.forEach(L=>{rw(m._currentState,L)}),(a=n["org.matrix.msc4222.state_after"])===null||a===void 0||(a=a.events)===null||a===void 0||a.forEach(L=>{rw(m._currentState,L)}),(c=n.timeline)===null||c===void 0||(c=c.events)===null||c===void 0||c.forEach((L,O)=>{var P;n["org.matrix.msc4222.state_after"]||rw(m._currentState,L);var D;if(d)D=L;else{var j;D=Object.assign({},L),D.unsigned!==void 0&&(D.unsigned=Object.assign({},D.unsigned));var H=(j=L.unsigned)===null||j===void 0?void 0:j.age;H!==void 0&&(D._localTs=Date.now()-H)}m._timeline.push({event:D,token:O===0&&(P=n.timeline.prev_batch)!==null&&P!==void 0?P:null})}),m._stickyEvents=m._stickyEvents.filter(L=>{var{expiresTs:O}=L;return O>h}),(l=n.msc4354_sticky)!==null&&l!==void 0&&l.events&&(m._stickyEvents=m._stickyEvents.concat(n.msc4354_sticky.events.map(L=>{var O=Math.min(L.msc4354_sticky.duration_ms,SP),P=Math.min(L.origin_server_ts,h);return{event:L,expiresTs:O+P}}))),m._timeline.length>this.opts.maxTimelineEntries){for(var k=m._timeline.length-this.opts.maxTimelineEntries,T=k;T<m._timeline.length;T++)if(m._timeline[T].token){m._timeline=m._timeline.slice(T,m._timeline.length);break}}}getJSON(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n={join:{},invite:{},knock:{},leave:{}};Object.keys(this.inviteRooms).forEach(i=>{n.invite[i]=this.inviteRooms[i]}),Object.keys(this.knockRooms).forEach(i=>{n.knock[i]=this.knockRooms[i]}),Object.keys(this.joinRooms).forEach(i=>{var s,o=this.joinRooms[i],a={ephemeral:{events:[]},account_data:{events:[]},state:{events:[]},"org.matrix.msc4222.state_after":{events:[]},timeline:{events:[],prev_batch:null},unread_notifications:o._unreadNotifications,unread_thread_notifications:o._unreadThreadNotifications,summary:o._summary,msc4354_sticky:(s=o._stickyEvents)!==null&&s!==void 0&&s.length?{events:o._stickyEvents.map(g=>g.event)}:void 0};Object.keys(o._accountData).forEach(g=>{a.account_data.events.push(o._accountData[g])});var c=o._receipts.buildAccumulatedReceiptEvent(i);c&&a.ephemeral.events.push(c),o._timeline.forEach(g=>{if(!a.timeline.prev_batch){if(!g.token)return;a.timeline.prev_batch=g.token}var y;!e&&mbe(g.event)?(y=Object.assign({},g.event),y.unsigned!==void 0&&(y.unsigned=Object.assign({},y.unsigned)),delete y._localTs,y.unsigned=y.unsigned||{},y.unsigned.age=Date.now()-g.event._localTs):y=g.event,a.timeline.events.push(y)});for(var l=Object.create(null),d=a.timeline.events.length-1;d>=0;d--){var h=a.timeline.events[d];if(!(h.state_key===null||h.state_key===void 0)){var m=P_(h);m.unsigned&&(m.unsigned.prev_content&&(m.content=m.unsigned.prev_content),m.unsigned.prev_sender&&(m.sender=m.unsigned.prev_sender)),rw(l,m)}}Object.keys(o._currentState).forEach(g=>{Object.keys(o._currentState[g]).forEach(y=>{var v=o._currentState[g][y];a["org.matrix.msc4222.state_after"].events.push(v),l[g]&&l[g][y]&&(v=l[g][y]),a.state.events.push(v)})}),n.join[i]=a});var r=[];return Object.keys(this.accountData).forEach(i=>{r.push(this.accountData[i])}),{nextBatch:this.nextBatch,roomsData:n,accountData:r}}getNextBatchToken(){return this.nextBatch}}function rw(t,e){e.state_key===null||e.state_key===void 0||!e.type||(t[e.type]||(t[e.type]=Object.create(null)),t[e.type][e.state_key]=e)}var IQ=(function(t){return t[t.Blocked=-1]="Blocked",t[t.Unverified=0]="Unverified",t[t.Verified=1]="Verified",t})({});class gbe{constructor(e){M(this,"deviceId",void 0),M(this,"userId",void 0),M(this,"algorithms",void 0),M(this,"keys",void 0),M(this,"verified",void 0),M(this,"signatures",void 0),M(this,"displayName",void 0),M(this,"dehydrated",!1),this.deviceId=e.deviceId,this.userId=e.userId,this.algorithms=e.algorithms,this.keys=e.keys,this.verified=e.verified||IQ.Unverified,this.signatures=e.signatures||new Map,this.displayName=e.displayName,this.dehydrated=!!e.dehydrated}getFingerprint(){return this.keys.get("ed25519:".concat(this.deviceId))}getIdentityKey(){return this.keys.get("curve25519:".concat(this.deviceId))}}var YB=function(){},vbe=10;class ybe{constructor(e,n){var r,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.client=e,this.timelineSet=n,M(this,"windowLimit",void 0),M(this,"start",void 0),M(this,"end",void 0),M(this,"eventCount",0),this.windowLimit=i.windowLimit||1e3,(r=n.room)===null||r===void 0||r.on(Me.Timeline,this.onTimelineEvent.bind(this))}load(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:20,r=i=>{if(!i)throw new Error("No timeline given to initFields");var s,o=i.getEvents();if(!e)s=o.length;else if(s=o.findIndex(l=>l.getId()===e),s<0)throw new Error("getEventTimeline result didn't include requested event");var a=Math.min(o.length,s+Math.ceil(n/2)),c=Math.max(0,a-n);this.start=new WA(i,c-i.getBaseIndex()),this.end=new WA(i,a-i.getBaseIndex()),this.eventCount=a-c};return this.timelineSet.getTimelineForEvent(e)?(r(this.timelineSet.getTimelineForEvent(e)),Promise.resolve()):e?this.client.getEventTimeline(this.timelineSet,e).then(r):(r(this.timelineSet.getLiveTimeline()),Promise.resolve())}getTimelineIndex(e){if(e==Ue.BACKWARDS){var n;return(n=this.start)!==null&&n!==void 0?n:null}else if(e==Ue.FORWARDS){var r;return(r=this.end)!==null&&r!==void 0?r:null}else throw new Error("Invalid direction '"+e+"'")}extend(e,n){var r=this.getTimelineIndex(e);if(!r)return!1;var i=e==Ue.BACKWARDS?r.retreat(n):r.advance(n);if(i){this.eventCount+=i,YB("TimelineWindow: increased cap by "+i+" (now "+this.eventCount+")");var s=this.eventCount-this.windowLimit;return s>0&&this.unpaginate(s,e!=Ue.BACKWARDS),!0}return!1}onTimelineEvent(e,n,r,i){i&&this.onEventRemoved()}onEventRemoved(){var e=this.getEvents();e.length>0&&e[e.length-1]===void 0&&this.end&&this.end.index--}canPaginate(e){var n=this.getTimelineIndex(e);if(!n)return!1;if(e==Ue.BACKWARDS){if(n.index>n.minIndex())return!0}else if(n.index<n.maxIndex())return!0;var r=n.timeline.getNeighbouringTimeline(e),i=n.timeline.getPaginationToken(e);return!!r||!!i}paginate(e,n){var r=arguments,i=this;return B(function*(){var s=r.length>2&&r[2]!==void 0?r[2]:!0,o=r.length>3&&r[3]!==void 0?r[3]:vbe,a=i.getTimelineIndex(e);if(!a)return!1;if(a.pendingPaginate)return a.pendingPaginate;if(i.extend(e,n))return!0;if(!s||o===0)return!1;var c=a.timeline.getPaginationToken(e);if(!c)return!1;var l=i.client.paginateEventTimeline(a.timeline,{backwards:e==Ue.BACKWARDS,limit:n}).finally(function(){a.pendingPaginate=void 0}).then(d=>d?i.paginate(e,n,!0,o-1):i.paginate(e,n,!1,0));return a.pendingPaginate=l,l})()}unpaginate(e,n){var r=n?this.start:this.end;if(!r)throw new Error("Attempting to unpaginate startOfTimeline=".concat(n," but don't have this direction"));if(e>this.eventCount||e<0)throw new Error("Attemting to unpaginate ".concat(e," events, but only have ").concat(this.eventCount," in the timeline"));for(;e>0;){var i=n?r.advance(e):r.retreat(e);if(i<=0)throw new Error("Unable to unpaginate any further, but still have "+this.eventCount+" events");e-=i,this.eventCount-=i,YB("TimelineWindow.unpaginate: dropped "+i+" (now "+this.eventCount+")")}}getEvents(){if(!this.start)return[];for(var e=[],n=this.start.timeline;n;){var r,i,s=n.getEvents(),o=0,a=s.length;n===this.start.timeline&&(o=this.start.index+n.getBaseIndex()),n===((r=this.end)===null||r===void 0?void 0:r.timeline)&&(a=this.end.index+n.getBaseIndex());for(var c=o;c<a;c++)e.push(s[c]);if(n===((i=this.end)===null||i===void 0?void 0:i.timeline))break;n=n.getNeighbouringTimeline(Ue.FORWARDS)}return e}}class WA{constructor(e,n){this.timeline=e,this.index=n,M(this,"pendingPaginate",void 0)}minIndex(){return this.timeline.getBaseIndex()*-1}maxIndex(){return this.timeline.getEvents().length-this.timeline.getBaseIndex()}advance(e){if(!e)return 0;var n;if(e<0){if(n=Math.max(e,this.minIndex()-this.index),n<0)return this.index+=n,n}else if(n=Math.min(e,this.maxIndex()-this.index),n>0)return this.index+=n,n;var r=this.timeline.getNeighbouringTimeline(e<0?Ue.BACKWARDS:Ue.FORWARDS);return r?(this.timeline=r,e<0?this.index=this.maxIndex():this.index=this.minIndex(),this.advance(e)):0}retreat(e){return this.advance(e*-1)*-1}}var z0="m.login.email.identity",XB="m.login.msisdn",YA=(function(t){return t.Password="m.login.password",t.Recaptcha="m.login.recaptcha",t.Terms="m.login.terms",t.Email="m.login.email.identity",t.Msisdn="m.login.msisdn",t.Sso="m.login.sso",t.SsoUnstable="org.matrix.login.sso",t.Dummy="m.login.dummy",t.RegistrationToken="m.login.registration_token",t.UnstableRegistrationToken="org.matrix.msc3231.login.registration_token",t.OAuth="m.oauth",t})({});class xQ extends Error{constructor(e,n,r){super(e),this.required_stages=n,this.flows=r,M(this,"name","NoAuthFlowFoundError")}}class wP{constructor(e){var n=this;M(this,"matrixClient",void 0),M(this,"inputs",void 0),M(this,"clientSecret",void 0),M(this,"requestCallback",void 0),M(this,"busyChangedCallback",void 0),M(this,"stateUpdatedCallback",void 0),M(this,"requestEmailTokenCallback",void 0),M(this,"supportedStages",void 0),M(this,"data",void 0),M(this,"emailSid",void 0),M(this,"requestingEmailToken",!1),M(this,"attemptAuthDeferred",null),M(this,"chosenFlow",null),M(this,"currentStage",null),M(this,"emailAttempt",1),M(this,"submitPromise",null),M(this,"requestEmailToken",B(function*(){if(n.requestingEmailToken)N.warn("Could not request email token: Already requesting");else{N.trace("Requesting email token. Attempt: "+n.emailAttempt),n.requestingEmailToken=!0;try{var r=yield n.requestEmailTokenCallback(n.inputs.emailAddress,n.clientSecret,n.emailAttempt++,n.data.session);n.emailSid=r.sid,N.trace("Email token request succeeded")}finally{n.requestingEmailToken=!1}}})),this.matrixClient=e.matrixClient,this.data=e.authData||{flows:[]},this.requestCallback=e.doRequest,this.busyChangedCallback=e.busyChanged,this.stateUpdatedCallback=e.stateUpdated||e.startAuthStage,this.requestEmailTokenCallback=e.requestEmailToken,this.inputs=e.inputs||{},e.sessionId&&(this.data.session=e.sessionId),this.clientSecret=e.clientSecret||this.matrixClient.generateClientSecret(),this.emailSid=e.emailSid,e.supportedStages!==void 0&&(this.supportedStages=new Set(e.supportedStages))}attemptAuth(){var e=this;return B(function*(){var n;e.attemptAuthDeferred=Promise.withResolvers();var r=e.attemptAuthDeferred.promise;if((n=e.data)!==null&&n!==void 0&&(n=n.flows)!==null&&n!==void 0&&n.length)e.startNextAuthStage();else{var i;(i=e.busyChangedCallback)===null||i===void 0||i.call(e,!0);var s=e.data.session?{session:e.data.session}:null;e.doRequest(s).finally(()=>{var o;(o=e.busyChangedCallback)===null||o===void 0||o.call(e,!1)})}return r})()}poll(){var e=this;return B(function*(){if(e.data.session&&e.attemptAuthDeferred&&!e.submitPromise){var n={};if(e.currentStage==z0&&e.emailSid){var r={sid:e.emailSid,client_secret:e.clientSecret},i=e.matrixClient.getIdentityServerUrl();i&&(r.id_server=new URL(i).host),n={type:z0,threepid_creds:r}}e.submitAuthDict(n,!0)}})()}getSessionId(){var e;return(e=this.data)===null||e===void 0?void 0:e.session}getClientSecret(){return this.clientSecret}getStageParams(e){var n;return(n=this.data)===null||n===void 0||(n=n.params)===null||n===void 0?void 0:n[e]}getChosenFlow(){return this.chosenFlow}submitAuthDict(e){var n=arguments,r=this;return B(function*(){var i,s=n.length>1&&n[1]!==void 0?n[1]:!1;if(!r.attemptAuthDeferred)throw new Error("submitAuthDict() called before attemptAuth()");if(!s){var o;(o=r.busyChangedCallback)===null||o===void 0||o.call(r,!0)}for(;r.submitPromise;)try{yield r.submitPromise}catch{}var a;(i=r.data)!==null&&i!==void 0&&i.session?a=Object.assign({session:r.data.session},e):a=e;try{r.submitPromise=r.doRequest(a,s),yield r.submitPromise}finally{if(r.submitPromise=null,!s){var c;(c=r.busyChangedCallback)===null||c===void 0||c.call(r,!1)}}})()}getEmailSid(){return this.emailSid}setEmailSid(e){this.emailSid=e}doRequest(e){var n=arguments,r=this;return B(function*(){var i=n.length>1&&n[1]!==void 0?n[1]:!1;try{var s=yield r.requestCallback(e,i);r.attemptAuthDeferred.resolve(s),r.attemptAuthDeferred=null}catch(y){var o,a,c,l,d=y instanceof In?y:null,h=(o=d==null||(a=d.data)===null||a===void 0?void 0:a.flows)!==null&&o!==void 0?o:null,m=((c=r.data)===null||c===void 0?void 0:c.flows)||!!h;if(!d||d.httpStatus!==401||!d.data||!m)if(i)N.log("Background poll request failed doing UI auth: ignoring",y);else{var g;(g=r.attemptAuthDeferred)===null||g===void 0||g.reject(y)}d&&!d.data&&(d.data={}),d&&!d.data.flows&&!d.data.completed&&!d.data.session&&(d.data.flows=r.data.flows,d.data.completed=r.data.completed,d.data.session=r.data.session),d&&(r.data=d.data);try{r.startNextAuthStage()}catch(v){r.attemptAuthDeferred.reject(v),r.attemptAuthDeferred=null;return}if(!r.emailSid&&(l=r.chosenFlow)!==null&&l!==void 0&&l.stages.includes(YA.Email))try{yield r.requestEmailToken()}catch(v){r.attemptAuthDeferred.reject(v),r.attemptAuthDeferred=null}}})()}startNextAuthStage(){var e,n,r=this.chooseStage();if(!r)throw new Error("No incomplete flows from the server");if(this.currentStage=r,r===YA.Dummy){this.submitAuthDict({type:"m.login.dummy"});return}if((e=this.data)!==null&&e!==void 0&&e.errcode||(n=this.data)!==null&&n!==void 0&&n.error){var i,s;this.stateUpdatedCallback(r,{errcode:((i=this.data)===null||i===void 0?void 0:i.errcode)||"",error:((s=this.data)===null||s===void 0?void 0:s.error)||""});return}this.stateUpdatedCallback(r,r===z0?{emailSid:this.emailSid}:{})}chooseStage(){this.chosenFlow===null&&(this.chosenFlow=this.chooseFlow()),N.log("Active flow => %s",JSON.stringify(this.chosenFlow));var e=this.firstUncompletedStage(this.chosenFlow);return N.log("Next stage: %s",e),e}scoreFlow(e){var n=e.stages.length;return this.supportedStages!==void 0&&(n+=e.stages.filter(r=>!this.supportedStages.has(r)).length*10),n}chooseFlow(){var e,n=((e=this.data)===null||e===void 0?void 0:e.flows)||[],r=!!this.inputs.emailAddress||!!this.emailSid,i=!!this.inputs.phoneCountry&&!!this.inputs.phoneNumber;n.sort((d,h)=>this.scoreFlow(d)-this.scoreFlow(h));for(var s of n){var o=!1,a=!1;for(var c of s.stages)c===z0?o=!0:c==XB&&(a=!0);if(o==r&&a==i)return s}var l=[];throw r&&l.push(z0),i&&l.push(XB),new xQ("No appropriate authentication flow found",l,n)}firstUncompletedStage(e){var n,r=((n=this.data)===null||n===void 0?void 0:n.completed)||[];return e.stages.find(i=>!r.includes(i))}}function AQ(t,e){return new Promise((n,r)=>{var i=!0,s=t.open(e);s.onupgradeneeded=()=>{i=!1},s.onblocked=()=>r(s.error),s.onsuccess=()=>{var o=s.result;o.close(),i||t.deleteDatabase(e),n(i)},s.onerror=()=>r(s.error)})}var LQ=[t=>{t.createObjectStore("users",{keyPath:["userId"]}),t.createObjectStore("accountData",{keyPath:["type"]}),t.createObjectStore("sync",{keyPath:["clobber"]})},t=>{var e=t.createObjectStore("oob_membership_events",{keyPath:["room_id","state_key"]});e.createIndex("room","room_id")},t=>{t.createObjectStore("client_options",{keyPath:["clobber"]})},t=>{t.createObjectStore("to_device_queue",{autoIncrement:!0})}],bbe=LQ.length;function iw(t,e,n){var r=t.openCursor(e);return new Promise((i,s)=>{var o=[];r.onerror=()=>{var a;s(new Error("Query failed: "+((a=r.error)===null||a===void 0?void 0:a.name)))},r.onsuccess=()=>{var a=r.result;if(!a){i(o);return}o.push(n(a)),a.continue()}})}function Vh(t){return new Promise((e,n)=>{t.oncomplete=function(r){e(r)},t.onerror=function(){n(t.error)}})}function MQ(t){return new Promise((e,n)=>{t.onsuccess=function(r){e(r)},t.onerror=function(){n(t.error)}})}function _be(t){return new Promise((e,n)=>{t.onsuccess=()=>e(t),t.onerror=r=>n(r)})}function cx(t){return MQ(t).then(e=>t.result)}class JB{static exists(e,n){return n="matrix-js-sdk:"+(n||"default"),AQ(e,n)}constructor(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"default";this.indexedDB=e,M(this,"dbName",void 0),M(this,"syncAccumulator",void 0),M(this,"db",void 0),M(this,"disconnected",!0),M(this,"_isNewlyCreated",!1),M(this,"syncToDatabasePromise",void 0),M(this,"pendingUserPresenceData",[]),this.dbName="matrix-js-sdk:"+n,this.syncAccumulator=new kQ}connect(e){var n=this;if(!this.disconnected)return N.log("LocalIndexedDBStoreBackend.connect: already connected or connecting"),Promise.resolve();this.disconnected=!1,N.log("LocalIndexedDBStoreBackend.connect: connecting...");var r=this.indexedDB.open(this.dbName,bbe);return r.onupgradeneeded=i=>{var s=r.result,o=i.oldVersion;N.log("LocalIndexedDBStoreBackend.connect: upgrading from ".concat(o)),o<1&&(this._isNewlyCreated=!0),LQ.forEach((a,c)=>{o<=c&&a(s)})},r.onblocked=()=>{N.log("can't yet open LocalIndexedDBStoreBackend because it is open elsewhere")},N.log("LocalIndexedDBStoreBackend.connect: awaiting connection..."),MQ(r).then(B(function*(){N.log("LocalIndexedDBStoreBackend.connect: connected"),n.db=r.result,n.db.onversionchange=()=>{var i;(i=n.db)===null||i===void 0||i.close(),n.disconnected=!0,n.db=void 0},n.db.onclose=()=>{n.disconnected=!0,n.db=void 0,e?.()},yield n.init()}))}isNewlyCreated(){return Promise.resolve(this._isNewlyCreated)}init(){return Promise.all([this.loadAccountData(),this.loadSyncData()]).then(e=>{var[n,r]=e;N.log("LocalIndexedDBStoreBackend: loaded initial data"),this.syncAccumulator.accumulate({next_batch:r.nextBatch,rooms:r.roomsData,account_data:{events:n}},!0)})}getOutOfBandMembers(e){return new Promise((n,r)=>{var i=this.db.transaction(["oob_membership_events"],"readonly"),s=i.objectStore("oob_membership_events"),o=s.index("room"),a=IDBKeyRange.only(e),c=o.openCursor(a),l=[],d=!1;c.onsuccess=()=>{var h=c.result;if(!h)return!l.length&&!d?n(null):n(l);var m=h.value;m.oob_written?d=!0:l.push(m),h.continue()},c.onerror=h=>{r(h)}}).then(n=>(N.log("LL: got ".concat(n?.length," membershipEvents from storage for room ").concat(e," ...")),n))}setOutOfBandMembers(e,n){var r=this;return B(function*(){N.log("LL: backend about to store ".concat(n.length)+" members for ".concat(e));var i=r.db.transaction(["oob_membership_events"],"readwrite"),s=i.objectStore("oob_membership_events");n.forEach(a=>{s.put(a)});var o={room_id:e,oob_written:!0,state_key:0};s.put(o),yield Vh(i),N.log("LL: backend done storing for ".concat(e,"!"))})()}clearOutOfBandMembers(e){var n=this;return B(function*(){var r=n.db.transaction(["oob_membership_events"],"readonly"),i=r.objectStore("oob_membership_events"),s=i.index("room"),o=IDBKeyRange.only(e),a=cx(s.openKeyCursor(o,"next")).then(y=>(y?.primaryKey)[1]),c=cx(s.openKeyCursor(o,"prev")).then(y=>(y?.primaryKey)[1]),[l,d]=yield Promise.all([a,c]),h=n.db.transaction(["oob_membership_events"],"readwrite"),m=h.objectStore("oob_membership_events"),g=IDBKeyRange.bound([e,l],[e,d]);N.log("LL: Deleting all users + marker in storage for room ".concat(e,", with key range:"),[e,l],[e,d]),yield _be(m.delete(g))})()}clearDatabase(){return new Promise(e=>{var n;N.log("Removing indexeddb instance: ".concat(this.dbName)),(n=this.db)===null||n===void 0||n.close();var r=this.indexedDB.deleteDatabase(this.dbName);r.onblocked=()=>{N.log("can't yet delete indexeddb ".concat(this.dbName," because it is open elsewhere"))},r.onerror=()=>{var i;N.warn("unable to delete js-sdk store indexeddb: ".concat((i=r.error)===null||i===void 0?void 0:i.name)),e()},r.onsuccess=()=>{N.log("Removed indexeddb instance: ".concat(this.dbName)),e()}})}getSavedSync(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,n=this.syncAccumulator.getJSON();return n.nextBatch?e?Promise.resolve(P_(n)):Promise.resolve(n):Promise.resolve(null)}getNextBatchToken(){return Promise.resolve(this.syncAccumulator.getNextBatchToken())}setSyncData(e){return Promise.resolve().then(()=>{this.syncAccumulator.accumulate(e)})}syncToDatabase(e){var n=this;return B(function*(){return n.syncToDatabasePromise?(N.warn("Skipping syncToDatabase() as persist already in flight"),n.pendingUserPresenceData.push(...e),n.syncToDatabasePromise):(e.unshift(...n.pendingUserPresenceData),n.syncToDatabasePromise=n.doSyncToDatabase(e),n.syncToDatabasePromise)})()}doSyncToDatabase(e){var n=this;return B(function*(){try{var r=n.syncAccumulator.getJSON(!0);yield Promise.all([n.persistUserPresenceEvents(e),n.persistAccountData(r.accountData),n.persistSyncData(r.nextBatch,r.roomsData)])}finally{n.syncToDatabasePromise=void 0}})()}persistSyncData(e,n){return N.log("Persisting sync data up to",e),ig(()=>{var r=this.db.transaction(["sync"],"readwrite"),i=r.objectStore("sync");return i.put({clobber:"-",nextBatch:e,roomsData:n}),Vh(r).then(()=>{N.log("Persisted sync data up to",e)})})}persistAccountData(e){return ig(()=>{var n=this.db.transaction(["accountData"],"readwrite"),r=n.objectStore("accountData");for(var i of e)r.put(i);return Vh(n).then()})}persistUserPresenceEvents(e){return ig(()=>{var n=this.db.transaction(["users"],"readwrite"),r=n.objectStore("users");for(var i of e)r.put({userId:i[0],event:i[1]});return Vh(n).then()})}getUserPresenceEvents(){return ig(()=>{var e=this.db.transaction(["users"],"readonly"),n=e.objectStore("users");return iw(n,void 0,r=>[r.value.userId,r.value.event])})}loadAccountData(){return N.log("LocalIndexedDBStoreBackend: loading account data..."),ig(()=>{var e=this.db.transaction(["accountData"],"readonly"),n=e.objectStore("accountData");return iw(n,void 0,r=>r.value).then(r=>(N.log("LocalIndexedDBStoreBackend: loaded account data"),r))})}loadSyncData(){return N.log("LocalIndexedDBStoreBackend: loading sync data..."),ig(()=>{var e=this.db.transaction(["sync"],"readonly"),n=e.objectStore("sync");return iw(n,void 0,r=>r.value).then(r=>(N.log("LocalIndexedDBStoreBackend: loaded sync data"),r.length>1&&N.warn("loadSyncData: More than 1 sync row found."),r.length>0?r[0]:{}))})}getClientOptions(){return Promise.resolve().then(()=>{var e=this.db.transaction(["client_options"],"readonly"),n=e.objectStore("client_options");return iw(n,void 0,r=>{var i;return(i=r.value)===null||i===void 0?void 0:i.options}).then(r=>r[0])})}storeClientOptions(e){var n=this;return B(function*(){var r=n.db.transaction(["client_options"],"readwrite"),i=r.objectStore("client_options");i.put({clobber:"-",options:e}),yield Vh(r)})()}saveToDeviceBatches(e){var n=this;return B(function*(){var r=n.db.transaction(["to_device_queue"],"readwrite"),i=r.objectStore("to_device_queue");for(var s of e)i.add(s);yield Vh(r)})()}getOldestToDeviceBatch(){var e=this;return B(function*(){var n=e.db.transaction(["to_device_queue"],"readonly"),r=n.objectStore("to_device_queue"),i=yield cx(r.openCursor());if(!i)return null;var s=i.value;return{id:i.key,txnId:s.txnId,eventType:s.eventType,batch:s.batch}})()}removeToDeviceBatch(e){var n=this;return B(function*(){var r=n.db.transaction(["to_device_queue"],"readwrite"),i=r.objectStore("to_device_queue");i.delete(e),yield Vh(r)})()}destroy(){var e=this;return B(function*(){var n;(n=e.db)===null||n===void 0||n.close()})()}}class Sbe{constructor(e,n){this.workerFactory=e,this.dbName=n,M(this,"worker",void 0),M(this,"nextSeq",0),M(this,"inFlight",{}),M(this,"startPromise",void 0),M(this,"onWorkerMessage",r=>{var i=r.data;if(i.command=="closed"){var s;(s=this.onClose)===null||s===void 0||s.call(this)}else if(i.command=="cmd_success"||i.command=="cmd_fail"){if(i.seq===void 0){N.error("Got reply from worker with no seq");return}var o=this.inFlight[i.seq];if(o===void 0){N.error("Got reply for unknown seq "+i.seq);return}if(delete this.inFlight[i.seq],i.command=="cmd_success")o.resolve(i.result);else{var a=new Error(i.error.message);a.name=i.error.name,o.reject(a)}}else N.warn("Unrecognised message from worker: ",i)})}connect(e){return this.onClose=e,this.ensureStarted().then(()=>this.doCmd("connect"))}clearDatabase(){return this.ensureStarted().then(()=>this.doCmd("clearDatabase"))}isNewlyCreated(){return this.doCmd("isNewlyCreated")}getSavedSync(){return this.doCmd("getSavedSync")}getNextBatchToken(){return this.doCmd("getNextBatchToken")}setSyncData(e){return this.doCmd("setSyncData",[e])}syncToDatabase(e){return this.doCmd("syncToDatabase",[e])}getOutOfBandMembers(e){return this.doCmd("getOutOfBandMembers",[e])}setOutOfBandMembers(e,n){return this.doCmd("setOutOfBandMembers",[e,n])}clearOutOfBandMembers(e){return this.doCmd("clearOutOfBandMembers",[e])}getClientOptions(){return this.doCmd("getClientOptions")}storeClientOptions(e){return this.doCmd("storeClientOptions",[e])}getUserPresenceEvents(){return this.doCmd("getUserPresenceEvents")}saveToDeviceBatches(e){var n=this;return B(function*(){return n.doCmd("saveToDeviceBatches",[e])})()}getOldestToDeviceBatch(){var e=this;return B(function*(){return e.doCmd("getOldestToDeviceBatch")})()}removeToDeviceBatch(e){var n=this;return B(function*(){return n.doCmd("removeToDeviceBatch",[e])})()}ensureStarted(){return this.startPromise||(this.worker=this.workerFactory(),this.worker.onmessage=this.onWorkerMessage,this.startPromise=this.doCmd("setupWorker",[this.dbName]).then(()=>{N.log("IndexedDB worker is ready")})),this.startPromise}doCmd(e,n){return Promise.resolve().then(()=>{var r,i=this.nextSeq++,s=Promise.withResolvers();return this.inFlight[i]=s,(r=this.worker)===null||r===void 0||r.postMessage({command:e,seq:i,args:n}),s.promise})}destroy(){var e=this;return B(function*(){var n;(n=e.worker)===null||n===void 0||n.terminate()})()}}var wbe=1e3*60*5;class OQ extends Fb{static exists(e,n){return JB.exists(e,n)}constructor(e){if(super(e),M(this,"backend",void 0),M(this,"startedUp",!1),M(this,"syncTs",0),M(this,"userModifiedMap",{}),M(this,"emitter",new Gn),M(this,"onClose",()=>{this.emitter.emit("closed")}),M(this,"getSavedSync",this.degradable(()=>this.backend.getSavedSync(),"getSavedSync")),M(this,"isNewlyCreated",this.degradable(()=>this.backend.isNewlyCreated(),"isNewlyCreated")),M(this,"getSavedSyncToken",this.degradable(()=>this.backend.getNextBatchToken(),"getSavedSyncToken")),M(this,"deleteAllData",this.degradable(()=>(super.deleteAllData(),this.backend.clearDatabase().then(()=>{N.log("Deleted indexeddb data.")},n=>{throw N.error("Failed to delete indexeddb data: ".concat(n)),n})),null)),M(this,"reallySave",this.degradable(()=>{this.syncTs=Date.now();var n=[];for(var r of this.getUsers())this.userModifiedMap[r.userId]!==r.getLastModifiedTime()&&r.events.presence&&(n.push([r.userId,r.events.presence.event]),this.userModifiedMap[r.userId]=r.getLastModifiedTime());return this.backend.syncToDatabase(n)},null)),M(this,"setSyncData",this.degradable(n=>this.backend.setSyncData(n),"setSyncData")),M(this,"getOutOfBandMembers",this.degradable(n=>this.backend.getOutOfBandMembers(n),"getOutOfBandMembers")),M(this,"setOutOfBandMembers",this.degradable((n,r)=>(super.setOutOfBandMembers(n,r),this.backend.setOutOfBandMembers(n,r)),"setOutOfBandMembers")),M(this,"clearOutOfBandMembers",this.degradable(n=>(super.clearOutOfBandMembers(n),this.backend.clearOutOfBandMembers(n)),"clearOutOfBandMembers")),M(this,"getClientOptions",this.degradable(()=>this.backend.getClientOptions(),"getClientOptions")),M(this,"storeClientOptions",this.degradable(n=>(super.storeClientOptions(n),this.backend.storeClientOptions(n)),"storeClientOptions")),!e.indexedDB)throw new Error("Missing required option: indexedDB");e.workerFactory?this.backend=new Sbe(e.workerFactory,e.dbName):this.backend=new JB(e.indexedDB,e.dbName)}on(e,n){this.emitter.on(e,n)}startup(){return this.startedUp?(N.log("IndexedDBStore.startup: already started"),Promise.resolve()):(N.log("IndexedDBStore.startup: connecting to backend"),this.backend.connect(this.onClose).then(()=>(N.log("IndexedDBStore.startup: loading presence events"),this.backend.getUserPresenceEvents())).then(e=>{N.log("IndexedDBStore.startup: processing presence events"),e.forEach(n=>{var[r,i]=n;if(!this.createUser)throw new Error("`IndexedDBStore.startup` must be called after assigning it to the client, not before!");var s=this.createUser(r);i&&s.setPresenceEvent(new es(i)),this.userModifiedMap[s.userId]=s.getLastModifiedTime(),this.storeUser(s)}),this.startedUp=!0}))}destroy(){return this.backend.destroy()}wantsSave(){var e=Date.now();return e-this.syncTs>wbe}save(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return e||this.wantsSave()?this.reallySave():Promise.resolve()}degradable(e,n){var r=this,i=n?super[n]:null;return B(function*(){for(var s=arguments.length,o=new Array(s),a=0;a<s;a++)o[a]=arguments[a];try{return yield e.call(r,...o)}catch(c){N.error("IndexedDBStore failure, degrading to MemoryStore",c),r.emitter.emit("degraded",c);try{N.log("IndexedDBStore trying to delete degraded data"),yield r.backend.clearDatabase(),N.log("IndexedDBStore delete after degrading succeeded")}catch(l){N.warn("IndexedDBStore delete after degrading failed",l)}if(i)return i.call(r,...o)}})}getPendingEvents(e){var n=()=>super.getPendingEvents,r=this;return B(function*(){if(!r.localStorage)return n().call(r,e);var i=r.localStorage.getItem(lx(e));if(i)try{return JSON.parse(i)}catch(s){N.error("Could not parse persisted pending events",s)}return[]})()}setPendingEvents(e,n){var r=()=>super.setPendingEvents,i=this;return B(function*(){if(!i.localStorage)return r().call(i,e,n);n.length>0?i.localStorage.setItem(lx(e),JSON.stringify(n)):i.localStorage.removeItem(lx(e))})()}saveToDeviceBatches(e){return this.backend.saveToDeviceBatches(e)}getOldestToDeviceBatch(){return this.backend.getOldestToDeviceBatch()}removeToDeviceBatch(e){return this.backend.removeToDeviceBatch(e)}}function lx(t){return"mx_pending_events_".concat(t)}var Pc="crypto.",QB=Pc+"migration",ux=Pc+"account",Ebe=Pc+"cross_signing_keys",_E=Pc+"inboundgroupsessions/",Cbe=Pc+"inboundgroupsessions.withheld/",Tbe=Pc+"rooms/",dx=Pc+"sessionsneedingbackup";function ug(t){return Pc+"sessions/"+t}function fx(t,e){return _E+t+"/"+e}function Rbe(t,e){return Cbe+t+"/"+e}function kbe(t){return Tbe+t}class AT extends mT{static exists(e){for(var n=e.length,r=0;r<n;r++){var i;if((i=e.key(r))!==null&&i!==void 0&&i.startsWith(Pc))return!0}return!1}constructor(e){super(),this.store=e}containsData(){var e=this;return B(function*(){return AT.exists(e.store)})()}getMigrationState(){var e=this;return B(function*(){var n;return(n=Sa(e.store,QB))!==null&&n!==void 0?n:Rv.NOT_STARTED})()}setMigrationState(e){var n=this;return B(function*(){Kh(n.store,QB,e)})()}countEndToEndSessions(e,n){for(var r=0,i=0;i<this.store.length;++i){var s=this.store.key(i);if(s!=null&&s.startsWith(ug(""))){var o=Sa(this.store,s);r+=Object.keys(o??{}).length}}n(r)}_getEndToEndSessions(e){var n=Sa(this.store,ug(e)),r={};for(var[i,s]of Object.entries(n||{}))typeof s=="string"?r[i]={session:s}:r[i]=s;return r}getEndToEndSession(e,n,r,i){var s,o=this._getEndToEndSessions(e);i((s=o[n])!==null&&s!==void 0?s:{})}getEndToEndSessions(e,n,r){var i;r((i=this._getEndToEndSessions(e))!==null&&i!==void 0?i:{})}storeEndToEndSession(e,n,r,i){var s=this._getEndToEndSessions(e)||{};s[n]=r,Kh(this.store,ug(e),s)}getEndToEndSessionsBatch(){var e=this;return B(function*(){for(var n=[],r=0;r<e.store.length;++r){var i;if((i=e.store.key(r))!==null&&i!==void 0&&i.startsWith(ug(""))){var s=e.store.key(r).split("/")[1];for(var o of Object.values(e._getEndToEndSessions(s)))if(n.push(o),n.length>=kv)return n}}return n.length===0?null:n})()}deleteEndToEndSessionsBatch(e){var n=this;return B(function*(){for(var{deviceKey:r,sessionId:i}of e){var s=n._getEndToEndSessions(r)||{};delete s[i],Object.keys(s).length===0?n.store.removeItem(ug(r)):Kh(n.store,ug(r),s)}})()}getEndToEndInboundGroupSession(e,n,r,i){i(Sa(this.store,fx(e,n)),Sa(this.store,Rbe(e,n)))}storeEndToEndInboundGroupSession(e,n,r,i){Kh(this.store,fx(e,n),r)}countEndToEndInboundGroupSessions(){var e=this;return B(function*(){for(var n=0,r=0;r<e.store.length;++r){var i=e.store.key(r);i!=null&&i.startsWith(_E)&&(n+=1)}return n})()}getEndToEndInboundGroupSessionsBatch(){var e=this;return B(function*(){for(var n=Sa(e.store,dx)||{},r=[],i=0;i<e.store.length;++i){var s=e.store.key(i);if(s!=null&&s.startsWith(_E)){var o=s.slice(_E.length);if(r.push({senderKey:o.slice(0,43),sessionId:o.slice(44),sessionData:Sa(e.store,s),needsBackup:o in n}),r.length>=kv)return r}}return r.length===0?null:r})()}deleteEndToEndInboundGroupSessionsBatch(e){var n=this;return B(function*(){for(var{senderKey:r,sessionId:i}of e){var s=fx(r,i);n.store.removeItem(s)}})()}getEndToEndRooms(e,n){for(var r={},i=kbe(""),s=0;s<this.store.length;++s){var o=this.store.key(s);if(o!=null&&o.startsWith(i)){var a=o.slice(i.length);r[a]=Sa(this.store,o)}}n(r)}markSessionsNeedingBackup(e){var n=Sa(this.store,dx)||{};for(var r of e)n[r.senderKey+"/"+r.sessionId]=!0;return Kh(this.store,dx,n),Promise.resolve()}deleteAllData(){return this.store.removeItem(ux),Promise.resolve()}getAccount(e,n){var r=Sa(this.store,ux);n(r)}storeAccount(e,n){Kh(this.store,ux,n)}getCrossSigningKeys(e,n){var r=Sa(this.store,Ebe);n(r)}getSecretStorePrivateKey(e,n,r){var i=Sa(this.store,Pc+"ssss_cache.".concat(r));n(i)}storeSecretStorePrivateKey(e,n,r){Kh(this.store,Pc+"ssss_cache.".concat(n),r)}doTxn(e,n,r){return Promise.resolve(r(null))}}function Sa(t,e){try{return JSON.parse(t.getItem(e))}catch(n){N.log("Error: Failed to get key %s: %s",e,n.message),N.log(n.stack)}return null}function Kh(t,e,n){t.setItem(e,JSON.stringify(n))}let Ibe=class{constructor(e){this.db=e,M(this,"nextTxnId",0),e.onversionchange=()=>{N.log("versionchange for indexeddb ".concat(this.db.name,": closing")),e.close()}}containsData(){return B(function*(){throw Error("Not implemented for Backend")})()}startup(){var e=this;return B(function*(){return e})()}deleteAllData(){return B(function*(){throw Error("This is not implemented, call IDBFactory::deleteDatabase(dbName) instead.")})()}getMigrationState(){var e=this;return B(function*(){var n=Rv.NOT_STARTED;return yield e.doTxn("readonly",[Jt.STORE_ACCOUNT],r=>{var i=r.objectStore(Jt.STORE_ACCOUNT),s=i.get(uA);s.onsuccess=()=>{var o;n=(o=s.result)!==null&&o!==void 0?o:Rv.NOT_STARTED}}),n})()}setMigrationState(e){var n=this;return B(function*(){yield n.doTxn("readwrite",[Jt.STORE_ACCOUNT],r=>{var i=r.objectStore(Jt.STORE_ACCOUNT);i.put(e,uA)})})()}getAccount(e,n){var r=e.objectStore("account"),i=r.get("-");i.onsuccess=function(){try{n(i.result||null)}catch(s){Js(e,s)}}}storeAccount(e,n){var r=e.objectStore("account");r.put(n,"-")}getCrossSigningKeys(e,n){var r=e.objectStore("account"),i=r.get("crossSigningKeys");i.onsuccess=function(){try{n(i.result||null)}catch(s){Js(e,s)}}}getSecretStorePrivateKey(e,n,r){var i=e.objectStore("account"),s=i.get("ssss_cache:".concat(r));s.onsuccess=function(){try{n(s.result||null)}catch(o){Js(e,o)}}}storeSecretStorePrivateKey(e,n,r){var i=e.objectStore("account");i.put(r,"ssss_cache:".concat(n))}countEndToEndSessions(e,n){var r=e.objectStore("sessions"),i=r.count();i.onsuccess=function(){try{n(i.result)}catch(s){Js(e,s)}}}getEndToEndSessions(e,n,r){var i=n.objectStore("sessions"),s=i.index("deviceKey"),o=s.openCursor(e),a={};o.onsuccess=function(){var c=o.result;if(c)a[c.value.sessionId]={session:c.value.session,lastReceivedMessageTs:c.value.lastReceivedMessageTs},c.continue();else try{r(a)}catch(l){Js(n,l)}}}getEndToEndSession(e,n,r,i){var s=r.objectStore("sessions"),o=s.get([e,n]);o.onsuccess=function(){try{o.result?i({session:o.result.session,lastReceivedMessageTs:o.result.lastReceivedMessageTs}):i(null)}catch(a){Js(r,a)}}}storeEndToEndSession(e,n,r,i){var s=i.objectStore("sessions");s.put({deviceKey:e,sessionId:n,session:r.session,lastReceivedMessageTs:r.lastReceivedMessageTs})}getEndToEndSessionsBatch(){var e=this;return B(function*(){var n=[];return yield e.doTxn("readonly",[Jt.STORE_SESSIONS],r=>{var i=r.objectStore(Jt.STORE_SESSIONS),s=i.openCursor();s.onsuccess=function(){try{var o=s.result;o&&(n.push(o.value),n.length<kv&&o.continue())}catch(a){Js(r,a)}}}),n.length===0?null:n})()}deleteEndToEndSessionsBatch(e){var n=this;return B(function*(){yield n.doTxn("readwrite",[Jt.STORE_SESSIONS],(function(){var r=B(function*(i){try{var s=i.objectStore(Jt.STORE_SESSIONS),o=function*(){var d=s.delete([a,c]);yield new Promise(h=>{d.onsuccess=h})};for(var{deviceKey:a,sessionId:c}of e)yield*o()}catch(l){Js(i,l)}});return function(i){return r.apply(this,arguments)}})())})()}getEndToEndInboundGroupSession(e,n,r,i){var s=!1,o=!1,a=r.objectStore("inbound_group_sessions"),c=a.get([e,n]);c.onsuccess=function(){try{c.result?s=c.result.session:s=null,o!==!1&&i(s,o)}catch(h){Js(r,h)}};var l=r.objectStore("inbound_group_sessions_withheld"),d=l.get([e,n]);d.onsuccess=function(){try{d.result?o=d.result.session:o=null,s!==!1&&i(s,o)}catch(h){Js(r,h)}}}storeEndToEndInboundGroupSession(e,n,r,i){var s=i.objectStore("inbound_group_sessions");s.put({senderCurve25519Key:e,sessionId:n,session:r})}countEndToEndInboundGroupSessions(){var e=this;return B(function*(){var n=0;return yield e.doTxn("readonly",[Jt.STORE_INBOUND_GROUP_SESSIONS],r=>{var i=r.objectStore(Jt.STORE_INBOUND_GROUP_SESSIONS),s=i.count();s.onsuccess=()=>{n=s.result}}),n})()}getEndToEndInboundGroupSessionsBatch(){var e=this;return B(function*(){var n=[];return yield e.doTxn("readonly",[Jt.STORE_INBOUND_GROUP_SESSIONS,Jt.STORE_BACKUP],r=>{var i=r.objectStore(Jt.STORE_INBOUND_GROUP_SESSIONS),s=r.objectStore(Jt.STORE_BACKUP),o=i.openCursor();o.onsuccess=function(){try{var a=o.result;if(a){var c=s.get(a.key);c.onsuccess=()=>{n.push({senderKey:a.value.senderCurve25519Key,sessionId:a.value.sessionId,sessionData:a.value.session,needsBackup:c.result!==void 0}),n.length<kv&&a.continue()}}}catch(l){Js(r,l)}}}),n.length===0?null:n})()}deleteEndToEndInboundGroupSessionsBatch(e){var n=this;return B(function*(){yield n.doTxn("readwrite",[Jt.STORE_INBOUND_GROUP_SESSIONS],(function(){var r=B(function*(i){try{var s=i.objectStore(Jt.STORE_INBOUND_GROUP_SESSIONS),o=function*(){var d=s.delete([a,c]);yield new Promise(h=>{d.onsuccess=h})};for(var{senderKey:a,sessionId:c}of e)yield*o()}catch(l){Js(i,l)}});return function(i){return r.apply(this,arguments)}})())})()}getEndToEndDeviceData(e,n){var r=e.objectStore("device_data"),i=r.get("-");i.onsuccess=function(){try{n(i.result||null)}catch(s){Js(e,s)}}}getEndToEndRooms(e,n){var r={},i=e.objectStore("rooms"),s=i.openCursor();s.onsuccess=function(){var o=s.result;if(o)r[o.key]=o.value,o.continue();else try{n(r)}catch(a){Js(e,a)}}}markSessionsNeedingBackup(e,n){var r=this;return B(function*(){n||(n=r.db.transaction("sessions_needing_backup","readwrite"));var i=n.objectStore("sessions_needing_backup");yield Promise.all(e.map(s=>new Promise((o,a)=>{var c=i.put({senderCurve25519Key:s.senderKey,sessionId:s.sessionId});c.onsuccess=o,c.onerror=a})))})()}doTxn(e,n,r){var i=this.db.transaction(n,e),s=Lbe(i),o=r(i);return s.then(()=>o)}};var PQ=[t=>{Abe(t)},t=>{t.createObjectStore("account")},t=>{var e=t.createObjectStore("sessions",{keyPath:["deviceKey","sessionId"]});e.createIndex("deviceKey","deviceKey")},t=>{t.createObjectStore("inbound_group_sessions",{keyPath:["senderCurve25519Key","sessionId"]})},t=>{t.createObjectStore("device_data")},t=>{t.createObjectStore("rooms")},t=>{t.createObjectStore("sessions_needing_backup",{keyPath:["senderCurve25519Key","sessionId"]})},t=>{t.createObjectStore("inbound_group_sessions_withheld",{keyPath:["senderCurve25519Key","sessionId"]})},t=>{var e=t.createObjectStore("session_problems",{keyPath:["deviceKey","time"]});e.createIndex("deviceKey","deviceKey"),t.createObjectStore("notified_error_devices",{keyPath:["userId","deviceId"]})},t=>{t.createObjectStore("shared_history_inbound_group_sessions",{keyPath:["roomId"]})},t=>{t.createObjectStore("parked_shared_history",{keyPath:["roomId"]})}],DQ=PQ.length;function xbe(t,e){N.log("Upgrading IndexedDBCryptoStore from version ".concat(e)+" to ".concat(DQ)),PQ.forEach((n,r)=>{e<=r&&n(t)})}function Abe(t){var e=t.createObjectStore("outgoingRoomKeyRequests",{keyPath:"requestId"});e.createIndex("session",["requestBody.room_id","requestBody.session_id"]),e.createIndex("state","state")}function Js(t,e){t._mx_abortexception=e;try{t.abort()}catch{}}function Lbe(t){return new Promise((e,n)=>{t.oncomplete=()=>{t._mx_abortexception!==void 0&&n(t._mx_abortexception),e(null)},t.onerror=r=>{t._mx_abortexception!==void 0?n(t._mx_abortexception):(N.log("Error performing indexeddb txn",r),n(t.error))},t.onabort=r=>{t._mx_abortexception!==void 0?n(t._mx_abortexception):(N.log("Error performing indexeddb txn",r),n(t.error))}})}class Jt{static exists(e,n){return AQ(e,n)}static existsAndIsNotMigrated(e,n){return new Promise((r,i)=>{var s=!0,o=e.open(n);o.onupgradeneeded=()=>{s=!1},o.onblocked=()=>i(o.error),o.onsuccess=()=>{var a=o.result;if(!s)a.close(),e.deleteDatabase(n),r(!1);else{var c=a.transaction([Jt.STORE_ACCOUNT],"readonly"),l=c.objectStore(Jt.STORE_ACCOUNT),d=l.get(uA);d.onsuccess=()=>{var h,m=(h=d.result)!==null&&h!==void 0?h:Rv.NOT_STARTED;r(m===Rv.NOT_STARTED)},d.onerror=()=>{i(d.error)},a.close()}},o.onerror=()=>i(o.error)})}constructor(e,n){this.indexedDB=e,this.dbName=n,M(this,"backendPromise",void 0),M(this,"backend",void 0)}containsData(){var e=this;return B(function*(){return Jt.exists(e.indexedDB,e.dbName)})()}startup(){return this.backendPromise?this.backendPromise:(this.backendPromise=new Promise((e,n)=>{if(!this.indexedDB){n(new Error("no indexeddb support available"));return}N.log("connecting to indexeddb ".concat(this.dbName));var r=this.indexedDB.open(this.dbName,DQ);r.onupgradeneeded=i=>{var s=r.result,o=i.oldVersion;xbe(s,o)},r.onblocked=()=>{N.log("can't yet open IndexedDBCryptoStore because it is open elsewhere")},r.onerror=i=>{N.log("Error connecting to indexeddb",i),n(r.error)},r.onsuccess=()=>{var i=r.result;N.log("connected to indexeddb ".concat(this.dbName)),e(new Ibe(i))}}).then(e=>e.doTxn("readonly",[Jt.STORE_INBOUND_GROUP_SESSIONS,Jt.STORE_INBOUND_GROUP_SESSIONS_WITHHELD],n=>{e.getEndToEndInboundGroupSession("","",n,()=>{})}).then(()=>e)).catch(e=>{if(e.name==="VersionError")throw N.warn("Crypto DB is too new for us to use!",e),new pP(hP.TooNew);N.warn("unable to connect to indexeddb ".concat(this.dbName)+": falling back to localStorage store: ".concat(e));try{if(!(globalThis.localStorage instanceof Storage))throw new Error("localStorage is not available");return new AT(globalThis.localStorage)}catch(n){return N.warn("Unable to open localStorage: falling back to in-memory store: ".concat(n)),new mT}}).then(e=>(this.backend=e,e)),this.backendPromise)}deleteAllData(){return new Promise((e,n)=>{if(!this.indexedDB){n(new Error("no indexeddb support available"));return}N.log("Removing indexeddb instance: ".concat(this.dbName));var r=this.indexedDB.deleteDatabase(this.dbName);r.onblocked=()=>{N.log("can't yet delete IndexedDBCryptoStore because it is open elsewhere")},r.onerror=i=>{N.log("Error deleting data from indexeddb",i),n(r.error)},r.onsuccess=()=>{N.log("Removed indexeddb instance: ".concat(this.dbName)),e()}}).catch(e=>{N.warn("unable to delete IndexedDBCryptoStore: ".concat(e))})}getMigrationState(){return this.backend.getMigrationState()}setMigrationState(e){return this.backend.setMigrationState(e)}getAccount(e,n){this.backend.getAccount(e,n)}storeAccount(e,n){this.backend.storeAccount(e,n)}getCrossSigningKeys(e,n){this.backend.getCrossSigningKeys(e,n)}getSecretStorePrivateKey(e,n,r){this.backend.getSecretStorePrivateKey(e,n,r)}storeSecretStorePrivateKey(e,n,r){this.backend.storeSecretStorePrivateKey(e,n,r)}countEndToEndSessions(e,n){this.backend.countEndToEndSessions(e,n)}getEndToEndSession(e,n,r,i){this.backend.getEndToEndSession(e,n,r,i)}getEndToEndSessions(e,n,r){this.backend.getEndToEndSessions(e,n,r)}storeEndToEndSession(e,n,r,i){this.backend.storeEndToEndSession(e,n,r,i)}countEndToEndInboundGroupSessions(){return this.backend.countEndToEndInboundGroupSessions()}getEndToEndSessionsBatch(){return this.backend.getEndToEndSessionsBatch()}deleteEndToEndSessionsBatch(e){return this.backend.deleteEndToEndSessionsBatch(e)}getEndToEndInboundGroupSession(e,n,r,i){this.backend.getEndToEndInboundGroupSession(e,n,r,i)}storeEndToEndInboundGroupSession(e,n,r,i){this.backend.storeEndToEndInboundGroupSession(e,n,r,i)}getEndToEndInboundGroupSessionsBatch(){return this.backend.getEndToEndInboundGroupSessionsBatch()}deleteEndToEndInboundGroupSessionsBatch(e){return this.backend.deleteEndToEndInboundGroupSessionsBatch(e)}getEndToEndRooms(e,n){this.backend.getEndToEndRooms(e,n)}markSessionsNeedingBackup(e,n){return this.backend.markSessionsNeedingBackup(e,n)}doTxn(e,n,r,i){return this.backend.doTxn(e,n,r,i)}}M(Jt,"STORE_ACCOUNT","account");M(Jt,"STORE_SESSIONS","sessions");M(Jt,"STORE_INBOUND_GROUP_SESSIONS","inbound_group_sessions");M(Jt,"STORE_INBOUND_GROUP_SESSIONS_WITHHELD","inbound_group_sessions_withheld");M(Jt,"STORE_SHARED_HISTORY_INBOUND_GROUP_SESSIONS","shared_history_inbound_group_sessions");M(Jt,"STORE_PARKED_SHARED_HISTORY","parked_shared_history");M(Jt,"STORE_DEVICE_DATA","device_data");M(Jt,"STORE_ROOMS","rooms");M(Jt,"STORE_BACKUP","sessions_needing_backup");var Mbe=(function(t){return t.Email="email",t.Phone="msisdn",t})({}),NQ=new Kr("oauth_aware_preferred","org.matrix.msc3824.delegated_oidc_compatibility"),Obe=NQ,Pbe=(function(t){return t.Gitlab="gitlab",t.Github="github",t.Apple="apple",t.Google="google",t.Facebook="facebook",t.Twitter="twitter",t})({}),Dbe=(function(t){return t.LOGIN="login",t.REGISTER="register",t})({}),Nbe="m.tz",Ube="us.cloke.msc4175.tz";class jbe{constructor(e){M(this,"relations",void 0),this.relations=e.filter(n=>!!n)}getRelations(){return this.relations.reduce((e,n)=>[...e,...n.getRelations()],[])}on(e,n){this.relations.forEach(r=>r.on(e,n))}off(e,n){this.relations.forEach(r=>r.off(e,n))}}var Fbe=(function(t){return t.Global="Global",t.SetItemError="setItem",t.GetItemError="getItem",t.RemoveItemError="removeItem",t.ClearError="clear",t.QuotaExceededError="QuotaExceededError",t})({});class $be extends Gn{}var Bbe=new $be,UQ=()=>new mT;function jQ(t){UQ=t}function FQ(t){var e,n,r;return t.store=(e=t.store)!==null&&e!==void 0?e:new Fb({localStorage:globalThis.localStorage}),t.scheduler=(n=t.scheduler)!==null&&n!==void 0?n:new Iv,t.cryptoStore=(r=t.cryptoStore)!==null&&r!==void 0?r:UQ(),t}function LT(t){return new xT(FQ(t))}function $Q(t,e,n,r){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0;return new RQ(t,e,n,FQ(r),i)}const Hbe=Object.freeze(Object.defineProperty({__proto__:null,AuthType:YA,AutoDiscovery:pt,AutoDiscoveryAction:Go,AutoDiscoveryError:ec,Beacon:RJ,BeaconEvent:Qn,CallEvent:At,CallFeedEvent:cl,Category:pu,ClientEvent:Pe,ClientPrefix:fr,ClientStoppedError:a1e,ConditionKind:ei,ConditionOperator:R0e,ConnectionError:Qp,ContentHelpers:sye,DELEGATED_OIDC_COMPATIBILITY:Obe,DEVICE_CODE_SCOPE:X1e,DMMemberCountCondition:k0e,DebugLogger:VO,Device:gbe,DeviceVerification:IQ,Direction:Tt,DuplicateStrategy:B1,EVENT_VISIBILITY_CHANGE_TYPE:dp,EventEmitterEvents:QX,EventStatus:lt,EventTimeline:Ue,EventTimelineSet:Dg,EventType:ee,FILTER_RELATED_BY_REL_TYPES:ev,FILTER_RELATED_BY_SENDERS:Zg,FeatureSupport:ds,Filter:zo,GET_LOGIN_TOKEN_CAPABILITY:nbe,GroupCall:aP,GroupCallEvent:Mn,GroupCallIntent:YJ,GroupCallState:hr,GroupCallStatsReportEvent:k1,GroupCallType:wT,GuestAccess:AC,HTTPError:xp,HistoryVisibility:uP,HttpApiEvent:_A,IdentityPrefix:hu,IdentityProviderBrand:Pbe,IndexedDBCryptoStore:Jt,IndexedDBStore:OQ,InteractiveAuth:wP,InvalidCryptoStoreError:pP,InvalidCryptoStoreState:hP,JoinRule:xf,KNOWN_SAFE_ROOM_VERSION:$J,KeySignatureUploadError:o1e,KnownMembership:Ke,LOCAL_NOTIFICATION_SETTINGS_PREFIX:nJ,LocalStorageCryptoStore:AT,LocalStorageErrors:Fbe,LocationAssetType:Tv,MAIN_ROOM_TIMELINE:O_,MAXIMUM_MATRIX_VERSION:P0e,MAX_STICKY_DURATION_MS:SP,MINIMUM_MATRIX_VERSION:O0e,MSC3912_RELATION_BASED_REDACTIONS_PROP:mA,MXID_PATTERN:KO,M_ASSET:L_,M_BEACON:MA,M_BEACON_INFO:dP,M_HTML:Qve,M_LOCATION:M_,M_MESSAGE:Jve,M_POLL_END:kC,M_POLL_KIND_DISCLOSED:aye,M_POLL_KIND_UNDISCLOSED:cye,M_POLL_RESPONSE:Ib,M_POLL_START:lye,M_TEXT:XO,M_TIMESTAMP:oh,M_TOPIC:JO,MatrixClient:xT,MatrixError:In,MatrixEvent:es,MatrixEventEvent:Zt,MatrixHttpApi:UJ,MatrixSafetyError:DJ,MatrixSafetyErrorCode:PJ,MatrixScheduler:Iv,MediaHandlerEvent:tp,MediaPrefix:Xg,MemoryCryptoStore:mT,MemoryStore:Fb,Method:fe,MsgType:Nl,NoAuthFlowFoundError:xQ,NotificationCountType:sn,OAUTH_AWARE_PREFERRED_FLOW_FIELD:NQ,OAuthGrantType:Nb,OidcError:fs,OidcTokenRefresher:Q1e,PUSHER_DEVICE_ID:Uve,PUSHER_ENABLED:gA,PendingEventOrdering:Lv,Poll:xJ,PollEvent:cf,Preset:CT,ProfileKeyMSC4175Timezone:Ube,ProfileKeyTimezone:Nbe,PushRuleActionName:If,PushRuleKind:Pi,REFERENCE_RELATION:mJ,ReceiptType:xs,RelatedRelations:jbe,RelationType:vn,Relations:YO,RelationsEvent:fE,RestrictedAllowType:N0e,Room:_T,RoomCreateTypeField:EC,RoomEvent:Me,RoomMember:Tb,RoomMemberEvent:ao,RoomNameType:al,RoomState:jb,RoomStateEvent:Rt,RoomSummary:hJ,RoomType:Yg,RoomVersionStability:jJ,RoomWidgetClient:RQ,RoomWidgetClientEvent:bE,RuleId:Oi,SERVICE_TYPES:AA,SSOAction:Dbe,STABLE_MSC4133_EXTENDED_PROFILES:_Q,SUPPORTED_MATRIX_VERSIONS:Lb,SearchOrderBy:QJ,SearchResult:ET,SecretStorage:n1e,ServerCapabilities:FJ,SetPresence:BJ,SlidingSyncEvent:LA,StatsReport:Fu,SyncAccumulator:kQ,SyncState:Qt,THREAD_RELATION_TYPE:Rn,Thread:$n,ThreadEvent:As,ThreadFilterType:gc,ThreepidMedium:Mbe,TimelineIndex:WA,TimelineWindow:ybe,ToDeviceMessageId:yT,TokenRefreshError:OJ,TokenRefreshLogoutError:eP,TweakName:cP,TypedEventEmitter:Gn,UNSIGNED_MEMBERSHIP_FIELD:rJ,UNSIGNED_THREAD_ID_FIELD:CC,UNSTABLE_ELEMENT_FUNCTIONAL_USERS:tJ,UNSTABLE_MSC2666_MUTUAL_ROOMS:vQ,UNSTABLE_MSC2666_QUERY_MUTUAL_ROOMS:yQ,UNSTABLE_MSC2666_SHARED_ROOMS:gQ,UNSTABLE_MSC2716_MARKER:eJ,UNSTABLE_MSC3088_ENABLED:hA,UNSTABLE_MSC3088_PURPOSE:fA,UNSTABLE_MSC3089_BRANCH:xu,UNSTABLE_MSC3089_LEAF:ZX,UNSTABLE_MSC3089_TREE_SUBTYPE:pA,UNSTABLE_MSC3852_LAST_SEEN_UA:tbe,UNSTABLE_MSC4133_EXTENDED_PROFILES:bQ,UNSTABLE_MSC4140_DELAYED_EVENTS:Xi,UNSTABLE_MSC4354_STICKY_EVENTS:NC,UnsupportedDelayedEventsEndpointError:Wo,UnsupportedStickyEventsEndpointError:FA,UpdateDelayedEventAction:vp,User:qu,UserEvent:Yi,Visibility:JJ,anySignal:NJ,calculateRetryBackoff:nP,completeAuthorizationCodeGrant:Y1e,createClient:LT,createNewMatrixCall:Ab,createRoomWidgetClient:$Q,decodeBase64:gp,decodeIdToken:fQ,determineFeatureSupport:gE,discoverAndValidateOIDCIssuerWellKnown:bP,encodeBase64:H1,encodeUnpaddedBase64:oP,encodeUnpaddedBase64Url:ST,fixNotificationCountOnDecryption:SQ,generateAuthorizationParams:K1e,generateAuthorizationUrl:G1e,generateOidcAuthorizationUrl:z1e,generateScope:IT,getBeaconInfoIdentifier:RC,getHttpUriForMxc:gT,inMainTimelineForReceipt:Ub,isDmMemberCountCondition:I0e,isEventTypeSame:Zve,isPollEvent:AJ,isSendDelayedEventRequestOpts:xC,isTimestampInDuration:yA,localStorageErrorsEventsEmitter:Bbe,parseErrorResponse:tP,registerOidcClient:J1e,retryNetworkOperation:xb,safeGetRetryAfterMs:ZO,setCryptoStoreFactory:jQ,threadFilterTypeToFilter:wQ,threadIdForReceipt:Mv,timeoutSignal:bT,validateAuthMetadata:dQ,validateAuthMetadataAndKeys:_P,validateBearerTokenResponse:mQ,validateIdToken:hQ,validateStoredUserState:pQ},Symbol.toStringTag,{value:"Module"}));if(globalThis.__js_sdk_entrypoint)throw new Error("Multiple matrix-js-sdk entrypoints detected!");globalThis.__js_sdk_entrypoint=!0;var XA;try{XA=globalThis.indexedDB}catch{}XA&&jQ(()=>new Jt(XA,"matrix-js-sdk:crypto"));globalThis.matrixcs=Hbe;var hx={exports:{}},St={};var ZB;function qbe(){if(ZB)return St;ZB=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),s=Symbol.for("react.consumer"),o=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),l=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),h=Symbol.for("react.activity"),m=Symbol.iterator;function g(q){return q===null||typeof q!="object"?null:(q=m&&q[m]||q["@@iterator"],typeof q=="function"?q:null)}var y={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},v=Object.assign,E={};function w(q,J,ue){this.props=q,this.context=J,this.refs=E,this.updater=ue||y}w.prototype.isReactComponent={},w.prototype.setState=function(q,J){if(typeof q!="object"&&typeof q!="function"&&q!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,q,J,"setState")},w.prototype.forceUpdate=function(q){this.updater.enqueueForceUpdate(this,q,"forceUpdate")};function R(){}R.prototype=w.prototype;function x(q,J,ue){this.props=q,this.context=J,this.refs=E,this.updater=ue||y}var C=x.prototype=new R;C.constructor=x,v(C,w.prototype),C.isPureReactComponent=!0;var k=Array.isArray;function T(){}var L={H:null,A:null,T:null,S:null},O=Object.prototype.hasOwnProperty;function P(q,J,ue){var ge=ue.ref;return{$$typeof:t,type:q,key:J,ref:ge!==void 0?ge:null,props:ue}}function D(q,J){return P(q.type,J,q.props)}function j(q){return typeof q=="object"&&q!==null&&q.$$typeof===t}function H(q){var J={"=":"=0",":":"=2"};return"$"+q.replace(/[=:]/g,function(ue){return J[ue]})}var z=/\/+/g;function Y(q,J){return typeof q=="object"&&q!==null&&q.key!=null?H(""+q.key):J.toString(36)}function W(q){switch(q.status){case"fulfilled":return q.value;case"rejected":throw q.reason;default:switch(typeof q.status=="string"?q.then(T,T):(q.status="pending",q.then(function(J){q.status==="pending"&&(q.status="fulfilled",q.value=J)},function(J){q.status==="pending"&&(q.status="rejected",q.reason=J)})),q.status){case"fulfilled":return q.value;case"rejected":throw q.reason}}throw q}function F(q,J,ue,ge,Re){var we=typeof q;(we==="undefined"||we==="boolean")&&(q=null);var de=!1;if(q===null)de=!0;else switch(we){case"bigint":case"string":case"number":de=!0;break;case"object":switch(q.$$typeof){case t:case e:de=!0;break;case d:return de=q._init,F(de(q._payload),J,ue,ge,Re)}}if(de)return Re=Re(q),de=ge===""?"."+Y(q,0):ge,k(Re)?(ue="",de!=null&&(ue=de.replace(z,"$&/")+"/"),F(Re,J,ue,"",function(Je){return Je})):Re!=null&&(j(Re)&&(Re=D(Re,ue+(Re.key==null||q&&q.key===Re.key?"":(""+Re.key).replace(z,"$&/")+"/")+de)),J.push(Re)),1;de=0;var ke=ge===""?".":ge+":";if(k(q))for(var De=0;De<q.length;De++)ge=q[De],we=ke+Y(ge,De),de+=F(ge,J,ue,we,Re);else if(De=g(q),typeof De=="function")for(q=De.call(q),De=0;!(ge=q.next()).done;)ge=ge.value,we=ke+Y(ge,De++),de+=F(ge,J,ue,we,Re);else if(we==="object"){if(typeof q.then=="function")return F(W(q),J,ue,ge,Re);throw J=String(q),Error("Objects are not valid as a React child (found: "+(J==="[object Object]"?"object with keys {"+Object.keys(q).join(", ")+"}":J)+"). If you meant to render a collection of children, use an array instead.")}return de}function $(q,J,ue){if(q==null)return q;var ge=[],Re=0;return F(q,ge,"","",function(we){return J.call(ue,we,Re++)}),ge}function V(q){if(q._status===-1){var J=q._result;J=J(),J.then(function(ue){(q._status===0||q._status===-1)&&(q._status=1,q._result=ue)},function(ue){(q._status===0||q._status===-1)&&(q._status=2,q._result=ue)}),q._status===-1&&(q._status=0,q._result=J)}if(q._status===1)return q._result.default;throw q._result}var G=typeof reportError=="function"?reportError:function(q){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var J=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof q=="object"&&q!==null&&typeof q.message=="string"?String(q.message):String(q),error:q});if(!window.dispatchEvent(J))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",q);return}console.error(q)},Z={map:$,forEach:function(q,J,ue){$(q,function(){J.apply(this,arguments)},ue)},count:function(q){var J=0;return $(q,function(){J++}),J},toArray:function(q){return $(q,function(J){return J})||[]},only:function(q){if(!j(q))throw Error("React.Children.only expected to receive a single React element child.");return q}};return St.Activity=h,St.Children=Z,St.Component=w,St.Fragment=n,St.Profiler=i,St.PureComponent=x,St.StrictMode=r,St.Suspense=c,St.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=L,St.__COMPILER_RUNTIME={__proto__:null,c:function(q){return L.H.useMemoCache(q)}},St.cache=function(q){return function(){return q.apply(null,arguments)}},St.cacheSignal=function(){return null},St.cloneElement=function(q,J,ue){if(q==null)throw Error("The argument must be a React element, but you passed "+q+".");var ge=v({},q.props),Re=q.key;if(J!=null)for(we in J.key!==void 0&&(Re=""+J.key),J)!O.call(J,we)||we==="key"||we==="__self"||we==="__source"||we==="ref"&&J.ref===void 0||(ge[we]=J[we]);var we=arguments.length-2;if(we===1)ge.children=ue;else if(1<we){for(var de=Array(we),ke=0;ke<we;ke++)de[ke]=arguments[ke+2];ge.children=de}return P(q.type,Re,ge)},St.createContext=function(q){return q={$$typeof:o,_currentValue:q,_currentValue2:q,_threadCount:0,Provider:null,Consumer:null},q.Provider=q,q.Consumer={$$typeof:s,_context:q},q},St.createElement=function(q,J,ue){var ge,Re={},we=null;if(J!=null)for(ge in J.key!==void 0&&(we=""+J.key),J)O.call(J,ge)&&ge!=="key"&&ge!=="__self"&&ge!=="__source"&&(Re[ge]=J[ge]);var de=arguments.length-2;if(de===1)Re.children=ue;else if(1<de){for(var ke=Array(de),De=0;De<de;De++)ke[De]=arguments[De+2];Re.children=ke}if(q&&q.defaultProps)for(ge in de=q.defaultProps,de)Re[ge]===void 0&&(Re[ge]=de[ge]);return P(q,we,Re)},St.createRef=function(){return{current:null}},St.forwardRef=function(q){return{$$typeof:a,render:q}},St.isValidElement=j,St.lazy=function(q){return{$$typeof:d,_payload:{_status:-1,_result:q},_init:V}},St.memo=function(q,J){return{$$typeof:l,type:q,compare:J===void 0?null:J}},St.startTransition=function(q){var J=L.T,ue={};L.T=ue;try{var ge=q(),Re=L.S;Re!==null&&Re(ue,ge),typeof ge=="object"&&ge!==null&&typeof ge.then=="function"&&ge.then(T,G)}catch(we){G(we)}finally{J!==null&&ue.types!==null&&(J.types=ue.types),L.T=J}},St.unstable_useCacheRefresh=function(){return L.H.useCacheRefresh()},St.use=function(q){return L.H.use(q)},St.useActionState=function(q,J,ue){return L.H.useActionState(q,J,ue)},St.useCallback=function(q,J){return L.H.useCallback(q,J)},St.useContext=function(q){return L.H.useContext(q)},St.useDebugValue=function(){},St.useDeferredValue=function(q,J){return L.H.useDeferredValue(q,J)},St.useEffect=function(q,J){return L.H.useEffect(q,J)},St.useEffectEvent=function(q){return L.H.useEffectEvent(q)},St.useId=function(){return L.H.useId()},St.useImperativeHandle=function(q,J,ue){return L.H.useImperativeHandle(q,J,ue)},St.useInsertionEffect=function(q,J){return L.H.useInsertionEffect(q,J)},St.useLayoutEffect=function(q,J){return L.H.useLayoutEffect(q,J)},St.useMemo=function(q,J){return L.H.useMemo(q,J)},St.useOptimistic=function(q,J){return L.H.useOptimistic(q,J)},St.useReducer=function(q,J,ue){return L.H.useReducer(q,J,ue)},St.useRef=function(q){return L.H.useRef(q)},St.useState=function(q){return L.H.useState(q)},St.useSyncExternalStore=function(q,J,ue){return L.H.useSyncExternalStore(q,J,ue)},St.useTransition=function(){return L.H.useTransition()},St.version="19.2.3",St}var eH;function EP(){return eH||(eH=1,hx.exports=qbe()),hx.exports}var _=EP();const xe=Dl(_),my=tve({__proto__:null,default:xe},[_]);var px={exports:{}},W0={},mx={exports:{}},gx={};var tH;function Vbe(){return tH||(tH=1,(function(t){function e(F,$){var V=F.length;F.push($);e:for(;0<V;){var G=V-1>>>1,Z=F[G];if(0<i(Z,$))F[G]=$,F[V]=Z,V=G;else break e}}function n(F){return F.length===0?null:F[0]}function r(F){if(F.length===0)return null;var $=F[0],V=F.pop();if(V!==$){F[0]=V;e:for(var G=0,Z=F.length,q=Z>>>1;G<q;){var J=2*(G+1)-1,ue=F[J],ge=J+1,Re=F[ge];if(0>i(ue,V))ge<Z&&0>i(Re,ue)?(F[G]=Re,F[ge]=V,G=ge):(F[G]=ue,F[J]=V,G=J);else if(ge<Z&&0>i(Re,V))F[G]=Re,F[ge]=V,G=ge;else break e}}return $}function i(F,$){var V=F.sortIndex-$.sortIndex;return V!==0?V:F.id-$.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var c=[],l=[],d=1,h=null,m=3,g=!1,y=!1,v=!1,E=!1,w=typeof setTimeout=="function"?setTimeout:null,R=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;function C(F){for(var $=n(l);$!==null;){if($.callback===null)r(l);else if($.startTime<=F)r(l),$.sortIndex=$.expirationTime,e(c,$);else break;$=n(l)}}function k(F){if(v=!1,C(F),!y)if(n(c)!==null)y=!0,T||(T=!0,H());else{var $=n(l);$!==null&&W(k,$.startTime-F)}}var T=!1,L=-1,O=5,P=-1;function D(){return E?!0:!(t.unstable_now()-P<O)}function j(){if(E=!1,T){var F=t.unstable_now();P=F;var $=!0;try{e:{y=!1,v&&(v=!1,R(L),L=-1),g=!0;var V=m;try{t:{for(C(F),h=n(c);h!==null&&!(h.expirationTime>F&&D());){var G=h.callback;if(typeof G=="function"){h.callback=null,m=h.priorityLevel;var Z=G(h.expirationTime<=F);if(F=t.unstable_now(),typeof Z=="function"){h.callback=Z,C(F),$=!0;break t}h===n(c)&&r(c),C(F)}else r(c);h=n(c)}if(h!==null)$=!0;else{var q=n(l);q!==null&&W(k,q.startTime-F),$=!1}}break e}finally{h=null,m=V,g=!1}$=void 0}}finally{$?H():T=!1}}}var H;if(typeof x=="function")H=function(){x(j)};else if(typeof MessageChannel<"u"){var z=new MessageChannel,Y=z.port2;z.port1.onmessage=j,H=function(){Y.postMessage(null)}}else H=function(){w(j,0)};function W(F,$){L=w(function(){F(t.unstable_now())},$)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(F){F.callback=null},t.unstable_forceFrameRate=function(F){0>F||125<F?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):O=0<F?Math.floor(1e3/F):5},t.unstable_getCurrentPriorityLevel=function(){return m},t.unstable_next=function(F){switch(m){case 1:case 2:case 3:var $=3;break;default:$=m}var V=m;m=$;try{return F()}finally{m=V}},t.unstable_requestPaint=function(){E=!0},t.unstable_runWithPriority=function(F,$){switch(F){case 1:case 2:case 3:case 4:case 5:break;default:F=3}var V=m;m=F;try{return $()}finally{m=V}},t.unstable_scheduleCallback=function(F,$,V){var G=t.unstable_now();switch(typeof V=="object"&&V!==null?(V=V.delay,V=typeof V=="number"&&0<V?G+V:G):V=G,F){case 1:var Z=-1;break;case 2:Z=250;break;case 5:Z=1073741823;break;case 4:Z=1e4;break;default:Z=5e3}return Z=V+Z,F={id:d++,callback:$,priorityLevel:F,startTime:V,expirationTime:Z,sortIndex:-1},V>G?(F.sortIndex=V,e(l,F),n(c)===null&&F===n(l)&&(v?(R(L),L=-1):v=!0,W(k,V-G))):(F.sortIndex=Z,e(c,F),y||g||(y=!0,T||(T=!0,H()))),F},t.unstable_shouldYield=D,t.unstable_wrapCallback=function(F){var $=m;return function(){var V=m;m=$;try{return F.apply(this,arguments)}finally{m=V}}}})(gx)),gx}var nH;function Kbe(){return nH||(nH=1,mx.exports=Vbe()),mx.exports}var vx={exports:{}},as={};var rH;function Gbe(){if(rH)return as;rH=1;var t=EP();function e(c){var l="https://react.dev/errors/"+c;if(1<arguments.length){l+="?args[]="+encodeURIComponent(arguments[1]);for(var d=2;d<arguments.length;d++)l+="&args[]="+encodeURIComponent(arguments[d])}return"Minified React error #"+c+"; visit "+l+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var r={d:{f:n,r:function(){throw Error(e(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},i=Symbol.for("react.portal");function s(c,l,d){var h=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:h==null?null:""+h,children:c,containerInfo:l,implementation:d}}var o=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function a(c,l){if(c==="font")return"";if(typeof l=="string")return l==="use-credentials"?l:""}return as.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,as.createPortal=function(c,l){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!l||l.nodeType!==1&&l.nodeType!==9&&l.nodeType!==11)throw Error(e(299));return s(c,l,null,d)},as.flushSync=function(c){var l=o.T,d=r.p;try{if(o.T=null,r.p=2,c)return c()}finally{o.T=l,r.p=d,r.d.f()}},as.preconnect=function(c,l){typeof c=="string"&&(l?(l=l.crossOrigin,l=typeof l=="string"?l==="use-credentials"?l:"":void 0):l=null,r.d.C(c,l))},as.prefetchDNS=function(c){typeof c=="string"&&r.d.D(c)},as.preinit=function(c,l){if(typeof c=="string"&&l&&typeof l.as=="string"){var d=l.as,h=a(d,l.crossOrigin),m=typeof l.integrity=="string"?l.integrity:void 0,g=typeof l.fetchPriority=="string"?l.fetchPriority:void 0;d==="style"?r.d.S(c,typeof l.precedence=="string"?l.precedence:void 0,{crossOrigin:h,integrity:m,fetchPriority:g}):d==="script"&&r.d.X(c,{crossOrigin:h,integrity:m,fetchPriority:g,nonce:typeof l.nonce=="string"?l.nonce:void 0})}},as.preinitModule=function(c,l){if(typeof c=="string")if(typeof l=="object"&&l!==null){if(l.as==null||l.as==="script"){var d=a(l.as,l.crossOrigin);r.d.M(c,{crossOrigin:d,integrity:typeof l.integrity=="string"?l.integrity:void 0,nonce:typeof l.nonce=="string"?l.nonce:void 0})}}else l==null&&r.d.M(c)},as.preload=function(c,l){if(typeof c=="string"&&typeof l=="object"&&l!==null&&typeof l.as=="string"){var d=l.as,h=a(d,l.crossOrigin);r.d.L(c,d,{crossOrigin:h,integrity:typeof l.integrity=="string"?l.integrity:void 0,nonce:typeof l.nonce=="string"?l.nonce:void 0,type:typeof l.type=="string"?l.type:void 0,fetchPriority:typeof l.fetchPriority=="string"?l.fetchPriority:void 0,referrerPolicy:typeof l.referrerPolicy=="string"?l.referrerPolicy:void 0,imageSrcSet:typeof l.imageSrcSet=="string"?l.imageSrcSet:void 0,imageSizes:typeof l.imageSizes=="string"?l.imageSizes:void 0,media:typeof l.media=="string"?l.media:void 0})}},as.preloadModule=function(c,l){if(typeof c=="string")if(l){var d=a(l.as,l.crossOrigin);r.d.m(c,{as:typeof l.as=="string"&&l.as!=="script"?l.as:void 0,crossOrigin:d,integrity:typeof l.integrity=="string"?l.integrity:void 0})}else r.d.m(c)},as.requestFormReset=function(c){r.d.r(c)},as.unstable_batchedUpdates=function(c,l){return c(l)},as.useFormState=function(c,l,d){return o.H.useFormState(c,l,d)},as.useFormStatus=function(){return o.H.useHostTransitionStatus()},as.version="19.2.3",as}var iH;function BQ(){if(iH)return vx.exports;iH=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),vx.exports=Gbe(),vx.exports}var sH;function zbe(){if(sH)return W0;sH=1;var t=Kbe(),e=EP(),n=BQ();function r(u){var f="https://react.dev/errors/"+u;if(1<arguments.length){f+="?args[]="+encodeURIComponent(arguments[1]);for(var p=2;p<arguments.length;p++)f+="&args[]="+encodeURIComponent(arguments[p])}return"Minified React error #"+u+"; visit "+f+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(u){return!(!u||u.nodeType!==1&&u.nodeType!==9&&u.nodeType!==11)}function s(u){var f=u,p=u;if(u.alternate)for(;f.return;)f=f.return;else{u=f;do f=u,(f.flags&4098)!==0&&(p=f.return),u=f.return;while(u)}return f.tag===3?p:null}function o(u){if(u.tag===13){var f=u.memoizedState;if(f===null&&(u=u.alternate,u!==null&&(f=u.memoizedState)),f!==null)return f.dehydrated}return null}function a(u){if(u.tag===31){var f=u.memoizedState;if(f===null&&(u=u.alternate,u!==null&&(f=u.memoizedState)),f!==null)return f.dehydrated}return null}function c(u){if(s(u)!==u)throw Error(r(188))}function l(u){var f=u.alternate;if(!f){if(f=s(u),f===null)throw Error(r(188));return f!==u?null:u}for(var p=u,b=f;;){var I=p.return;if(I===null)break;var A=I.alternate;if(A===null){if(b=I.return,b!==null){p=b;continue}break}if(I.child===A.child){for(A=I.child;A;){if(A===p)return c(I),u;if(A===b)return c(I),f;A=A.sibling}throw Error(r(188))}if(p.return!==b.return)p=I,b=A;else{for(var U=!1,K=I.child;K;){if(K===p){U=!0,p=I,b=A;break}if(K===b){U=!0,b=I,p=A;break}K=K.sibling}if(!U){for(K=A.child;K;){if(K===p){U=!0,p=A,b=I;break}if(K===b){U=!0,b=A,p=I;break}K=K.sibling}if(!U)throw Error(r(189))}}if(p.alternate!==b)throw Error(r(190))}if(p.tag!==3)throw Error(r(188));return p.stateNode.current===p?u:f}function d(u){var f=u.tag;if(f===5||f===26||f===27||f===6)return u;for(u=u.child;u!==null;){if(f=d(u),f!==null)return f;u=u.sibling}return null}var h=Object.assign,m=Symbol.for("react.element"),g=Symbol.for("react.transitional.element"),y=Symbol.for("react.portal"),v=Symbol.for("react.fragment"),E=Symbol.for("react.strict_mode"),w=Symbol.for("react.profiler"),R=Symbol.for("react.consumer"),x=Symbol.for("react.context"),C=Symbol.for("react.forward_ref"),k=Symbol.for("react.suspense"),T=Symbol.for("react.suspense_list"),L=Symbol.for("react.memo"),O=Symbol.for("react.lazy"),P=Symbol.for("react.activity"),D=Symbol.for("react.memo_cache_sentinel"),j=Symbol.iterator;function H(u){return u===null||typeof u!="object"?null:(u=j&&u[j]||u["@@iterator"],typeof u=="function"?u:null)}var z=Symbol.for("react.client.reference");function Y(u){if(u==null)return null;if(typeof u=="function")return u.$$typeof===z?null:u.displayName||u.name||null;if(typeof u=="string")return u;switch(u){case v:return"Fragment";case w:return"Profiler";case E:return"StrictMode";case k:return"Suspense";case T:return"SuspenseList";case P:return"Activity"}if(typeof u=="object")switch(u.$$typeof){case y:return"Portal";case x:return u.displayName||"Context";case R:return(u._context.displayName||"Context")+".Consumer";case C:var f=u.render;return u=u.displayName,u||(u=f.displayName||f.name||"",u=u!==""?"ForwardRef("+u+")":"ForwardRef"),u;case L:return f=u.displayName||null,f!==null?f:Y(u.type)||"Memo";case O:f=u._payload,u=u._init;try{return Y(u(f))}catch{}}return null}var W=Array.isArray,F=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,$=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,V={pending:!1,data:null,method:null,action:null},G=[],Z=-1;function q(u){return{current:u}}function J(u){0>Z||(u.current=G[Z],G[Z]=null,Z--)}function ue(u,f){Z++,G[Z]=u.current,u.current=f}var ge=q(null),Re=q(null),we=q(null),de=q(null);function ke(u,f){switch(ue(we,f),ue(Re,u),ue(ge,null),f.nodeType){case 9:case 11:u=(u=f.documentElement)&&(u=u.namespaceURI)?EF(u):0;break;default:if(u=f.tagName,f=f.namespaceURI)f=EF(f),u=CF(f,u);else switch(u){case"svg":u=1;break;case"math":u=2;break;default:u=0}}J(ge),ue(ge,u)}function De(){J(ge),J(Re),J(we)}function Je(u){u.memoizedState!==null&&ue(de,u);var f=ge.current,p=CF(f,u.type);f!==p&&(ue(Re,u),ue(ge,p))}function vt(u){Re.current===u&&(J(ge),J(Re)),de.current===u&&(J(de),I0._currentValue=V)}var Sr,zn;function ze(u){if(Sr===void 0)try{throw Error()}catch(p){var f=p.stack.trim().match(/\n( *(at )?)/);Sr=f&&f[1]||"",zn=-1<p.stack.indexOf(`
    at`)?" (<anonymous>)":-1<p.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Sr+u+zn}var ys=!1;function bs(u,f){if(!u||ys)return"";ys=!0;var p=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var b={DetermineComponentFrameRoot:function(){try{if(f){var Ee=function(){throw Error()};if(Object.defineProperty(Ee.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Ee,[])}catch(me){var le=me}Reflect.construct(u,[],Ee)}else{try{Ee.call()}catch(me){le=me}u.call(Ee.prototype)}}else{try{throw Error()}catch(me){le=me}(Ee=u())&&typeof Ee.catch=="function"&&Ee.catch(function(){})}}catch(me){if(me&&le&&typeof me.stack=="string")return[me.stack,le.stack]}return[null,null]}};b.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var I=Object.getOwnPropertyDescriptor(b.DetermineComponentFrameRoot,"name");I&&I.configurable&&Object.defineProperty(b.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var A=b.DetermineComponentFrameRoot(),U=A[0],K=A[1];if(U&&K){var Q=U.split(`
`),se=K.split(`
`);for(I=b=0;b<Q.length&&!Q[b].includes("DetermineComponentFrameRoot");)b++;for(;I<se.length&&!se[I].includes("DetermineComponentFrameRoot");)I++;if(b===Q.length||I===se.length)for(b=Q.length-1,I=se.length-1;1<=b&&0<=I&&Q[b]!==se[I];)I--;for(;1<=b&&0<=I;b--,I--)if(Q[b]!==se[I]){if(b!==1||I!==1)do if(b--,I--,0>I||Q[b]!==se[I]){var ye=`
`+Q[b].replace(" at new "," at ");return u.displayName&&ye.includes("<anonymous>")&&(ye=ye.replace("<anonymous>",u.displayName)),ye}while(1<=b&&0<=I);break}}}finally{ys=!1,Error.prepareStackTrace=p}return(p=u?u.displayName||u.name:"")?ze(p):""}function wi(u,f){switch(u.tag){case 26:case 27:case 5:return ze(u.type);case 16:return ze("Lazy");case 13:return u.child!==f&&f!==null?ze("Suspense Fallback"):ze("Suspense");case 19:return ze("SuspenseList");case 0:case 15:return bs(u.type,!1);case 11:return bs(u.type.render,!1);case 1:return bs(u.type,!0);case 31:return ze("Activity");default:return""}}function ql(u){try{var f="",p=null;do f+=wi(u,p),p=u,u=u.return;while(u);return f}catch(b){return`
Error generating stack: `+b.message+`
`+b.stack}}var sc=Object.prototype.hasOwnProperty,_s=t.unstable_scheduleCallback,Ss=t.unstable_cancelCallback,wd=t.unstable_shouldYield,To=t.unstable_requestPaint,wr=t.unstable_now,oc=t.unstable_getCurrentPriorityLevel,Wc=t.unstable_ImmediatePriority,Vl=t.unstable_UserBlockingPriority,Ro=t.unstable_NormalPriority,Yc=t.unstable_LowPriority,Kl=t.unstable_IdlePriority,Ed=t.log,qs=t.unstable_setDisableYieldValue,Ei=null,Gr=null;function Vs(u){if(typeof Ed=="function"&&qs(u),Gr&&typeof Gr.setStrictMode=="function")try{Gr.setStrictMode(Ei,u)}catch{}}var li=Math.clz32?Math.clz32:nt,Cd=Math.log,ko=Math.LN2;function nt(u){return u>>>=0,u===0?32:31-(Cd(u)/ko|0)|0}var Dt=256,Be=262144,rt=4194304;function Mt(u){var f=u&42;if(f!==0)return f;switch(u&-u){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return u&261888;case 262144:case 524288:case 1048576:case 2097152:return u&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return u&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return u}}function Un(u,f,p){var b=u.pendingLanes;if(b===0)return 0;var I=0,A=u.suspendedLanes,U=u.pingedLanes;u=u.warmLanes;var K=b&134217727;return K!==0?(b=K&~A,b!==0?I=Mt(b):(U&=K,U!==0?I=Mt(U):p||(p=K&~u,p!==0&&(I=Mt(p))))):(K=b&~A,K!==0?I=Mt(K):U!==0?I=Mt(U):p||(p=b&~u,p!==0&&(I=Mt(p)))),I===0?0:f!==0&&f!==I&&(f&A)===0&&(A=I&-I,p=f&-f,A>=p||A===32&&(p&4194048)!==0)?f:I}function jn(u,f){return(u.pendingLanes&~(u.suspendedLanes&~u.pingedLanes)&f)===0}function ws(u,f){switch(u){case 1:case 2:case 4:case 8:case 64:return f+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return f+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function zr(){var u=rt;return rt<<=1,(rt&62914560)===0&&(rt=4194304),u}function Es(u){for(var f=[],p=0;31>p;p++)f.push(u);return f}function Ci(u,f){u.pendingLanes|=f,f!==268435456&&(u.suspendedLanes=0,u.pingedLanes=0,u.warmLanes=0)}function os(u,f,p,b,I,A){var U=u.pendingLanes;u.pendingLanes=p,u.suspendedLanes=0,u.pingedLanes=0,u.warmLanes=0,u.expiredLanes&=p,u.entangledLanes&=p,u.errorRecoveryDisabledLanes&=p,u.shellSuspendCounter=0;var K=u.entanglements,Q=u.expirationTimes,se=u.hiddenUpdates;for(p=U&~p;0<p;){var ye=31-li(p),Ee=1<<ye;K[ye]=0,Q[ye]=-1;var le=se[ye];if(le!==null)for(se[ye]=null,ye=0;ye<le.length;ye++){var me=le[ye];me!==null&&(me.lane&=-536870913)}p&=~Ee}b!==0&&ac(u,b,0),A!==0&&I===0&&u.tag!==0&&(u.suspendedLanes|=A&~(U&~f))}function ac(u,f,p){u.pendingLanes|=f,u.suspendedLanes&=~f;var b=31-li(f);u.entangledLanes|=f,u.entanglements[b]=u.entanglements[b]|1073741824|p&261930}function ne(u,f){var p=u.entangledLanes|=f;for(u=u.entanglements;p;){var b=31-li(p),I=1<<b;I&f|u[b]&f&&(u[b]|=f),p&=~I}}function Se(u,f){var p=f&-f;return p=(p&42)!==0?1:Ve(p),(p&(u.suspendedLanes|f))!==0?0:p}function Ve(u){switch(u){case 2:u=1;break;case 8:u=4;break;case 32:u=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:u=128;break;case 268435456:u=134217728;break;default:u=0}return u}function ht(u){return u&=-u,2<u?8<u?(u&134217727)!==0?32:268435456:8:2}function _t(){var u=$.p;return u!==0?u:(u=window.event,u===void 0?32:zF(u.type))}function Wr(u,f){var p=$.p;try{return $.p=u,f()}finally{$.p=p}}var Dr=Math.random().toString(36).slice(2),Nr="__reactFiber$"+Dr,ir="__reactProps$"+Dr,Xc="__reactContainer$"+Dr,_h="__reactEvents$"+Dr,Io="__reactListeners$"+Dr,M4="__reactHandles$"+Dr,LS="__reactResources$"+Dr,Sh="__reactMarker$"+Dr;function wh(u){delete u[Nr],delete u[ir],delete u[_h],delete u[Io],delete u[M4]}function Sm(u){var f=u[Nr];if(f)return f;for(var p=u.parentNode;p;){if(f=p[Xc]||p[Nr]){if(p=f.alternate,f.child!==null||p!==null&&p.child!==null)for(u=LF(u);u!==null;){if(p=u[Nr])return p;u=LF(u)}return f}u=p,p=u.parentNode}return null}function wm(u){if(u=u[Nr]||u[Xc]){var f=u.tag;if(f===5||f===6||f===13||f===31||f===26||f===27||f===3)return u}return null}function Vy(u){var f=u.tag;if(f===5||f===26||f===27||f===6)return u.stateNode;throw Error(r(33))}function Em(u){var f=u[LS];return f||(f=u[LS]={hoistableStyles:new Map,hoistableScripts:new Map}),f}function Ti(u){u[Sh]=!0}var dN=new Set,fN={};function Eh(u,f){Cm(u,f),Cm(u+"Capture",f)}function Cm(u,f){for(fN[u]=f,u=0;u<f.length;u++)dN.add(f[u])}var Gpe=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),hN={},pN={};function zpe(u){return sc.call(pN,u)?!0:sc.call(hN,u)?!1:Gpe.test(u)?pN[u]=!0:(hN[u]=!0,!1)}function MS(u,f,p){if(zpe(f))if(p===null)u.removeAttribute(f);else{switch(typeof p){case"undefined":case"function":case"symbol":u.removeAttribute(f);return;case"boolean":var b=f.toLowerCase().slice(0,5);if(b!=="data-"&&b!=="aria-"){u.removeAttribute(f);return}}u.setAttribute(f,""+p)}}function OS(u,f,p){if(p===null)u.removeAttribute(f);else{switch(typeof p){case"undefined":case"function":case"symbol":case"boolean":u.removeAttribute(f);return}u.setAttribute(f,""+p)}}function Gl(u,f,p,b){if(b===null)u.removeAttribute(p);else{switch(typeof b){case"undefined":case"function":case"symbol":case"boolean":u.removeAttribute(p);return}u.setAttributeNS(f,p,""+b)}}function ua(u){switch(typeof u){case"bigint":case"boolean":case"number":case"string":case"undefined":return u;case"object":return u;default:return""}}function mN(u){var f=u.type;return(u=u.nodeName)&&u.toLowerCase()==="input"&&(f==="checkbox"||f==="radio")}function Wpe(u,f,p){var b=Object.getOwnPropertyDescriptor(u.constructor.prototype,f);if(!u.hasOwnProperty(f)&&typeof b<"u"&&typeof b.get=="function"&&typeof b.set=="function"){var I=b.get,A=b.set;return Object.defineProperty(u,f,{configurable:!0,get:function(){return I.call(this)},set:function(U){p=""+U,A.call(this,U)}}),Object.defineProperty(u,f,{enumerable:b.enumerable}),{getValue:function(){return p},setValue:function(U){p=""+U},stopTracking:function(){u._valueTracker=null,delete u[f]}}}}function O4(u){if(!u._valueTracker){var f=mN(u)?"checked":"value";u._valueTracker=Wpe(u,f,""+u[f])}}function gN(u){if(!u)return!1;var f=u._valueTracker;if(!f)return!0;var p=f.getValue(),b="";return u&&(b=mN(u)?u.checked?"true":"false":u.value),u=b,u!==p?(f.setValue(u),!0):!1}function PS(u){if(u=u||(typeof document<"u"?document:void 0),typeof u>"u")return null;try{return u.activeElement||u.body}catch{return u.body}}var Ype=/[\n"\\]/g;function da(u){return u.replace(Ype,function(f){return"\\"+f.charCodeAt(0).toString(16)+" "})}function P4(u,f,p,b,I,A,U,K){u.name="",U!=null&&typeof U!="function"&&typeof U!="symbol"&&typeof U!="boolean"?u.type=U:u.removeAttribute("type"),f!=null?U==="number"?(f===0&&u.value===""||u.value!=f)&&(u.value=""+ua(f)):u.value!==""+ua(f)&&(u.value=""+ua(f)):U!=="submit"&&U!=="reset"||u.removeAttribute("value"),f!=null?D4(u,U,ua(f)):p!=null?D4(u,U,ua(p)):b!=null&&u.removeAttribute("value"),I==null&&A!=null&&(u.defaultChecked=!!A),I!=null&&(u.checked=I&&typeof I!="function"&&typeof I!="symbol"),K!=null&&typeof K!="function"&&typeof K!="symbol"&&typeof K!="boolean"?u.name=""+ua(K):u.removeAttribute("name")}function vN(u,f,p,b,I,A,U,K){if(A!=null&&typeof A!="function"&&typeof A!="symbol"&&typeof A!="boolean"&&(u.type=A),f!=null||p!=null){if(!(A!=="submit"&&A!=="reset"||f!=null)){O4(u);return}p=p!=null?""+ua(p):"",f=f!=null?""+ua(f):p,K||f===u.value||(u.value=f),u.defaultValue=f}b=b??I,b=typeof b!="function"&&typeof b!="symbol"&&!!b,u.checked=K?u.checked:!!b,u.defaultChecked=!!b,U!=null&&typeof U!="function"&&typeof U!="symbol"&&typeof U!="boolean"&&(u.name=U),O4(u)}function D4(u,f,p){f==="number"&&PS(u.ownerDocument)===u||u.defaultValue===""+p||(u.defaultValue=""+p)}function Tm(u,f,p,b){if(u=u.options,f){f={};for(var I=0;I<p.length;I++)f["$"+p[I]]=!0;for(p=0;p<u.length;p++)I=f.hasOwnProperty("$"+u[p].value),u[p].selected!==I&&(u[p].selected=I),I&&b&&(u[p].defaultSelected=!0)}else{for(p=""+ua(p),f=null,I=0;I<u.length;I++){if(u[I].value===p){u[I].selected=!0,b&&(u[I].defaultSelected=!0);return}f!==null||u[I].disabled||(f=u[I])}f!==null&&(f.selected=!0)}}function yN(u,f,p){if(f!=null&&(f=""+ua(f),f!==u.value&&(u.value=f),p==null)){u.defaultValue!==f&&(u.defaultValue=f);return}u.defaultValue=p!=null?""+ua(p):""}function bN(u,f,p,b){if(f==null){if(b!=null){if(p!=null)throw Error(r(92));if(W(b)){if(1<b.length)throw Error(r(93));b=b[0]}p=b}p==null&&(p=""),f=p}p=ua(f),u.defaultValue=p,b=u.textContent,b===p&&b!==""&&b!==null&&(u.value=b),O4(u)}function Rm(u,f){if(f){var p=u.firstChild;if(p&&p===u.lastChild&&p.nodeType===3){p.nodeValue=f;return}}u.textContent=f}var Xpe=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function _N(u,f,p){var b=f.indexOf("--")===0;p==null||typeof p=="boolean"||p===""?b?u.setProperty(f,""):f==="float"?u.cssFloat="":u[f]="":b?u.setProperty(f,p):typeof p!="number"||p===0||Xpe.has(f)?f==="float"?u.cssFloat=p:u[f]=(""+p).trim():u[f]=p+"px"}function SN(u,f,p){if(f!=null&&typeof f!="object")throw Error(r(62));if(u=u.style,p!=null){for(var b in p)!p.hasOwnProperty(b)||f!=null&&f.hasOwnProperty(b)||(b.indexOf("--")===0?u.setProperty(b,""):b==="float"?u.cssFloat="":u[b]="");for(var I in f)b=f[I],f.hasOwnProperty(I)&&p[I]!==b&&_N(u,I,b)}else for(var A in f)f.hasOwnProperty(A)&&_N(u,A,f[A])}function N4(u){if(u.indexOf("-")===-1)return!1;switch(u){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Jpe=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Qpe=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function DS(u){return Qpe.test(""+u)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":u}function zl(){}var U4=null;function j4(u){return u=u.target||u.srcElement||window,u.correspondingUseElement&&(u=u.correspondingUseElement),u.nodeType===3?u.parentNode:u}var km=null,Im=null;function wN(u){var f=wm(u);if(f&&(u=f.stateNode)){var p=u[ir]||null;e:switch(u=f.stateNode,f.type){case"input":if(P4(u,p.value,p.defaultValue,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name),f=p.name,p.type==="radio"&&f!=null){for(p=u;p.parentNode;)p=p.parentNode;for(p=p.querySelectorAll('input[name="'+da(""+f)+'"][type="radio"]'),f=0;f<p.length;f++){var b=p[f];if(b!==u&&b.form===u.form){var I=b[ir]||null;if(!I)throw Error(r(90));P4(b,I.value,I.defaultValue,I.defaultValue,I.checked,I.defaultChecked,I.type,I.name)}}for(f=0;f<p.length;f++)b=p[f],b.form===u.form&&gN(b)}break e;case"textarea":yN(u,p.value,p.defaultValue);break e;case"select":f=p.value,f!=null&&Tm(u,!!p.multiple,f,!1)}}}var F4=!1;function EN(u,f,p){if(F4)return u(f,p);F4=!0;try{var b=u(f);return b}finally{if(F4=!1,(km!==null||Im!==null)&&(w2(),km&&(f=km,u=Im,Im=km=null,wN(f),u)))for(f=0;f<u.length;f++)wN(u[f])}}function Ky(u,f){var p=u.stateNode;if(p===null)return null;var b=p[ir]||null;if(b===null)return null;p=b[f];e:switch(f){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(b=!b.disabled)||(u=u.type,b=!(u==="button"||u==="input"||u==="select"||u==="textarea")),u=!b;break e;default:u=!1}if(u)return null;if(p&&typeof p!="function")throw Error(r(231,f,typeof p));return p}var Wl=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),$4=!1;if(Wl)try{var Gy={};Object.defineProperty(Gy,"passive",{get:function(){$4=!0}}),window.addEventListener("test",Gy,Gy),window.removeEventListener("test",Gy,Gy)}catch{$4=!1}var Td=null,B4=null,NS=null;function CN(){if(NS)return NS;var u,f=B4,p=f.length,b,I="value"in Td?Td.value:Td.textContent,A=I.length;for(u=0;u<p&&f[u]===I[u];u++);var U=p-u;for(b=1;b<=U&&f[p-b]===I[A-b];b++);return NS=I.slice(u,1<b?1-b:void 0)}function US(u){var f=u.keyCode;return"charCode"in u?(u=u.charCode,u===0&&f===13&&(u=13)):u=f,u===10&&(u=13),32<=u||u===13?u:0}function jS(){return!0}function TN(){return!1}function Ks(u){function f(p,b,I,A,U){this._reactName=p,this._targetInst=I,this.type=b,this.nativeEvent=A,this.target=U,this.currentTarget=null;for(var K in u)u.hasOwnProperty(K)&&(p=u[K],this[K]=p?p(A):A[K]);return this.isDefaultPrevented=(A.defaultPrevented!=null?A.defaultPrevented:A.returnValue===!1)?jS:TN,this.isPropagationStopped=TN,this}return h(f.prototype,{preventDefault:function(){this.defaultPrevented=!0;var p=this.nativeEvent;p&&(p.preventDefault?p.preventDefault():typeof p.returnValue!="unknown"&&(p.returnValue=!1),this.isDefaultPrevented=jS)},stopPropagation:function(){var p=this.nativeEvent;p&&(p.stopPropagation?p.stopPropagation():typeof p.cancelBubble!="unknown"&&(p.cancelBubble=!0),this.isPropagationStopped=jS)},persist:function(){},isPersistent:jS}),f}var Ch={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(u){return u.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},FS=Ks(Ch),zy=h({},Ch,{view:0,detail:0}),Zpe=Ks(zy),H4,q4,Wy,$S=h({},zy,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:K4,button:0,buttons:0,relatedTarget:function(u){return u.relatedTarget===void 0?u.fromElement===u.srcElement?u.toElement:u.fromElement:u.relatedTarget},movementX:function(u){return"movementX"in u?u.movementX:(u!==Wy&&(Wy&&u.type==="mousemove"?(H4=u.screenX-Wy.screenX,q4=u.screenY-Wy.screenY):q4=H4=0,Wy=u),H4)},movementY:function(u){return"movementY"in u?u.movementY:q4}}),RN=Ks($S),eme=h({},$S,{dataTransfer:0}),tme=Ks(eme),nme=h({},zy,{relatedTarget:0}),V4=Ks(nme),rme=h({},Ch,{animationName:0,elapsedTime:0,pseudoElement:0}),ime=Ks(rme),sme=h({},Ch,{clipboardData:function(u){return"clipboardData"in u?u.clipboardData:window.clipboardData}}),ome=Ks(sme),ame=h({},Ch,{data:0}),kN=Ks(ame),cme={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},lme={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ume={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function dme(u){var f=this.nativeEvent;return f.getModifierState?f.getModifierState(u):(u=ume[u])?!!f[u]:!1}function K4(){return dme}var fme=h({},zy,{key:function(u){if(u.key){var f=cme[u.key]||u.key;if(f!=="Unidentified")return f}return u.type==="keypress"?(u=US(u),u===13?"Enter":String.fromCharCode(u)):u.type==="keydown"||u.type==="keyup"?lme[u.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:K4,charCode:function(u){return u.type==="keypress"?US(u):0},keyCode:function(u){return u.type==="keydown"||u.type==="keyup"?u.keyCode:0},which:function(u){return u.type==="keypress"?US(u):u.type==="keydown"||u.type==="keyup"?u.keyCode:0}}),hme=Ks(fme),pme=h({},$S,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),IN=Ks(pme),mme=h({},zy,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:K4}),gme=Ks(mme),vme=h({},Ch,{propertyName:0,elapsedTime:0,pseudoElement:0}),yme=Ks(vme),bme=h({},$S,{deltaX:function(u){return"deltaX"in u?u.deltaX:"wheelDeltaX"in u?-u.wheelDeltaX:0},deltaY:function(u){return"deltaY"in u?u.deltaY:"wheelDeltaY"in u?-u.wheelDeltaY:"wheelDelta"in u?-u.wheelDelta:0},deltaZ:0,deltaMode:0}),_me=Ks(bme),Sme=h({},Ch,{newState:0,oldState:0}),wme=Ks(Sme),Eme=[9,13,27,32],G4=Wl&&"CompositionEvent"in window,Yy=null;Wl&&"documentMode"in document&&(Yy=document.documentMode);var Cme=Wl&&"TextEvent"in window&&!Yy,xN=Wl&&(!G4||Yy&&8<Yy&&11>=Yy),AN=" ",LN=!1;function MN(u,f){switch(u){case"keyup":return Eme.indexOf(f.keyCode)!==-1;case"keydown":return f.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ON(u){return u=u.detail,typeof u=="object"&&"data"in u?u.data:null}var xm=!1;function Tme(u,f){switch(u){case"compositionend":return ON(f);case"keypress":return f.which!==32?null:(LN=!0,AN);case"textInput":return u=f.data,u===AN&&LN?null:u;default:return null}}function Rme(u,f){if(xm)return u==="compositionend"||!G4&&MN(u,f)?(u=CN(),NS=B4=Td=null,xm=!1,u):null;switch(u){case"paste":return null;case"keypress":if(!(f.ctrlKey||f.altKey||f.metaKey)||f.ctrlKey&&f.altKey){if(f.char&&1<f.char.length)return f.char;if(f.which)return String.fromCharCode(f.which)}return null;case"compositionend":return xN&&f.locale!=="ko"?null:f.data;default:return null}}var kme={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function PN(u){var f=u&&u.nodeName&&u.nodeName.toLowerCase();return f==="input"?!!kme[u.type]:f==="textarea"}function DN(u,f,p,b){km?Im?Im.push(b):Im=[b]:km=b,f=x2(f,"onChange"),0<f.length&&(p=new FS("onChange","change",null,p,b),u.push({event:p,listeners:f}))}var Xy=null,Jy=null;function Ime(u){vF(u,0)}function BS(u){var f=Vy(u);if(gN(f))return u}function NN(u,f){if(u==="change")return f}var UN=!1;if(Wl){var z4;if(Wl){var W4="oninput"in document;if(!W4){var jN=document.createElement("div");jN.setAttribute("oninput","return;"),W4=typeof jN.oninput=="function"}z4=W4}else z4=!1;UN=z4&&(!document.documentMode||9<document.documentMode)}function FN(){Xy&&(Xy.detachEvent("onpropertychange",$N),Jy=Xy=null)}function $N(u){if(u.propertyName==="value"&&BS(Jy)){var f=[];DN(f,Jy,u,j4(u)),EN(Ime,f)}}function xme(u,f,p){u==="focusin"?(FN(),Xy=f,Jy=p,Xy.attachEvent("onpropertychange",$N)):u==="focusout"&&FN()}function Ame(u){if(u==="selectionchange"||u==="keyup"||u==="keydown")return BS(Jy)}function Lme(u,f){if(u==="click")return BS(f)}function Mme(u,f){if(u==="input"||u==="change")return BS(f)}function Ome(u,f){return u===f&&(u!==0||1/u===1/f)||u!==u&&f!==f}var xo=typeof Object.is=="function"?Object.is:Ome;function Qy(u,f){if(xo(u,f))return!0;if(typeof u!="object"||u===null||typeof f!="object"||f===null)return!1;var p=Object.keys(u),b=Object.keys(f);if(p.length!==b.length)return!1;for(b=0;b<p.length;b++){var I=p[b];if(!sc.call(f,I)||!xo(u[I],f[I]))return!1}return!0}function BN(u){for(;u&&u.firstChild;)u=u.firstChild;return u}function HN(u,f){var p=BN(u);u=0;for(var b;p;){if(p.nodeType===3){if(b=u+p.textContent.length,u<=f&&b>=f)return{node:p,offset:f-u};u=b}e:{for(;p;){if(p.nextSibling){p=p.nextSibling;break e}p=p.parentNode}p=void 0}p=BN(p)}}function qN(u,f){return u&&f?u===f?!0:u&&u.nodeType===3?!1:f&&f.nodeType===3?qN(u,f.parentNode):"contains"in u?u.contains(f):u.compareDocumentPosition?!!(u.compareDocumentPosition(f)&16):!1:!1}function VN(u){u=u!=null&&u.ownerDocument!=null&&u.ownerDocument.defaultView!=null?u.ownerDocument.defaultView:window;for(var f=PS(u.document);f instanceof u.HTMLIFrameElement;){try{var p=typeof f.contentWindow.location.href=="string"}catch{p=!1}if(p)u=f.contentWindow;else break;f=PS(u.document)}return f}function Y4(u){var f=u&&u.nodeName&&u.nodeName.toLowerCase();return f&&(f==="input"&&(u.type==="text"||u.type==="search"||u.type==="tel"||u.type==="url"||u.type==="password")||f==="textarea"||u.contentEditable==="true")}var Pme=Wl&&"documentMode"in document&&11>=document.documentMode,Am=null,X4=null,Zy=null,J4=!1;function KN(u,f,p){var b=p.window===p?p.document:p.nodeType===9?p:p.ownerDocument;J4||Am==null||Am!==PS(b)||(b=Am,"selectionStart"in b&&Y4(b)?b={start:b.selectionStart,end:b.selectionEnd}:(b=(b.ownerDocument&&b.ownerDocument.defaultView||window).getSelection(),b={anchorNode:b.anchorNode,anchorOffset:b.anchorOffset,focusNode:b.focusNode,focusOffset:b.focusOffset}),Zy&&Qy(Zy,b)||(Zy=b,b=x2(X4,"onSelect"),0<b.length&&(f=new FS("onSelect","select",null,f,p),u.push({event:f,listeners:b}),f.target=Am)))}function Th(u,f){var p={};return p[u.toLowerCase()]=f.toLowerCase(),p["Webkit"+u]="webkit"+f,p["Moz"+u]="moz"+f,p}var Lm={animationend:Th("Animation","AnimationEnd"),animationiteration:Th("Animation","AnimationIteration"),animationstart:Th("Animation","AnimationStart"),transitionrun:Th("Transition","TransitionRun"),transitionstart:Th("Transition","TransitionStart"),transitioncancel:Th("Transition","TransitionCancel"),transitionend:Th("Transition","TransitionEnd")},Q4={},GN={};Wl&&(GN=document.createElement("div").style,"AnimationEvent"in window||(delete Lm.animationend.animation,delete Lm.animationiteration.animation,delete Lm.animationstart.animation),"TransitionEvent"in window||delete Lm.transitionend.transition);function Rh(u){if(Q4[u])return Q4[u];if(!Lm[u])return u;var f=Lm[u],p;for(p in f)if(f.hasOwnProperty(p)&&p in GN)return Q4[u]=f[p];return u}var zN=Rh("animationend"),WN=Rh("animationiteration"),YN=Rh("animationstart"),Dme=Rh("transitionrun"),Nme=Rh("transitionstart"),Ume=Rh("transitioncancel"),XN=Rh("transitionend"),JN=new Map,Z4="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Z4.push("scrollEnd");function cc(u,f){JN.set(u,f),Eh(f,[u])}var HS=typeof reportError=="function"?reportError:function(u){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var f=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof u=="object"&&u!==null&&typeof u.message=="string"?String(u.message):String(u),error:u});if(!window.dispatchEvent(f))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",u);return}console.error(u)},fa=[],Mm=0,ek=0;function qS(){for(var u=Mm,f=ek=Mm=0;f<u;){var p=fa[f];fa[f++]=null;var b=fa[f];fa[f++]=null;var I=fa[f];fa[f++]=null;var A=fa[f];if(fa[f++]=null,b!==null&&I!==null){var U=b.pending;U===null?I.next=I:(I.next=U.next,U.next=I),b.pending=I}A!==0&&QN(p,I,A)}}function VS(u,f,p,b){fa[Mm++]=u,fa[Mm++]=f,fa[Mm++]=p,fa[Mm++]=b,ek|=b,u.lanes|=b,u=u.alternate,u!==null&&(u.lanes|=b)}function tk(u,f,p,b){return VS(u,f,p,b),KS(u)}function kh(u,f){return VS(u,null,null,f),KS(u)}function QN(u,f,p){u.lanes|=p;var b=u.alternate;b!==null&&(b.lanes|=p);for(var I=!1,A=u.return;A!==null;)A.childLanes|=p,b=A.alternate,b!==null&&(b.childLanes|=p),A.tag===22&&(u=A.stateNode,u===null||u._visibility&1||(I=!0)),u=A,A=A.return;return u.tag===3?(A=u.stateNode,I&&f!==null&&(I=31-li(p),u=A.hiddenUpdates,b=u[I],b===null?u[I]=[f]:b.push(f),f.lane=p|536870912),A):null}function KS(u){if(50<S0)throw S0=0,uI=null,Error(r(185));for(var f=u.return;f!==null;)u=f,f=u.return;return u.tag===3?u.stateNode:null}var Om={};function jme(u,f,p,b){this.tag=u,this.key=p,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=f,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=b,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ao(u,f,p,b){return new jme(u,f,p,b)}function nk(u){return u=u.prototype,!(!u||!u.isReactComponent)}function Yl(u,f){var p=u.alternate;return p===null?(p=Ao(u.tag,f,u.key,u.mode),p.elementType=u.elementType,p.type=u.type,p.stateNode=u.stateNode,p.alternate=u,u.alternate=p):(p.pendingProps=f,p.type=u.type,p.flags=0,p.subtreeFlags=0,p.deletions=null),p.flags=u.flags&65011712,p.childLanes=u.childLanes,p.lanes=u.lanes,p.child=u.child,p.memoizedProps=u.memoizedProps,p.memoizedState=u.memoizedState,p.updateQueue=u.updateQueue,f=u.dependencies,p.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext},p.sibling=u.sibling,p.index=u.index,p.ref=u.ref,p.refCleanup=u.refCleanup,p}function ZN(u,f){u.flags&=65011714;var p=u.alternate;return p===null?(u.childLanes=0,u.lanes=f,u.child=null,u.subtreeFlags=0,u.memoizedProps=null,u.memoizedState=null,u.updateQueue=null,u.dependencies=null,u.stateNode=null):(u.childLanes=p.childLanes,u.lanes=p.lanes,u.child=p.child,u.subtreeFlags=0,u.deletions=null,u.memoizedProps=p.memoizedProps,u.memoizedState=p.memoizedState,u.updateQueue=p.updateQueue,u.type=p.type,f=p.dependencies,u.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext}),u}function GS(u,f,p,b,I,A){var U=0;if(b=u,typeof u=="function")nk(u)&&(U=1);else if(typeof u=="string")U=qge(u,p,ge.current)?26:u==="html"||u==="head"||u==="body"?27:5;else e:switch(u){case P:return u=Ao(31,p,f,I),u.elementType=P,u.lanes=A,u;case v:return Ih(p.children,I,A,f);case E:U=8,I|=24;break;case w:return u=Ao(12,p,f,I|2),u.elementType=w,u.lanes=A,u;case k:return u=Ao(13,p,f,I),u.elementType=k,u.lanes=A,u;case T:return u=Ao(19,p,f,I),u.elementType=T,u.lanes=A,u;default:if(typeof u=="object"&&u!==null)switch(u.$$typeof){case x:U=10;break e;case R:U=9;break e;case C:U=11;break e;case L:U=14;break e;case O:U=16,b=null;break e}U=29,p=Error(r(130,u===null?"null":typeof u,"")),b=null}return f=Ao(U,p,f,I),f.elementType=u,f.type=b,f.lanes=A,f}function Ih(u,f,p,b){return u=Ao(7,u,b,f),u.lanes=p,u}function rk(u,f,p){return u=Ao(6,u,null,f),u.lanes=p,u}function eU(u){var f=Ao(18,null,null,0);return f.stateNode=u,f}function ik(u,f,p){return f=Ao(4,u.children!==null?u.children:[],u.key,f),f.lanes=p,f.stateNode={containerInfo:u.containerInfo,pendingChildren:null,implementation:u.implementation},f}var tU=new WeakMap;function ha(u,f){if(typeof u=="object"&&u!==null){var p=tU.get(u);return p!==void 0?p:(f={value:u,source:f,stack:ql(f)},tU.set(u,f),f)}return{value:u,source:f,stack:ql(f)}}var Pm=[],Dm=0,zS=null,e0=0,pa=[],ma=0,Rd=null,Jc=1,Qc="";function Xl(u,f){Pm[Dm++]=e0,Pm[Dm++]=zS,zS=u,e0=f}function nU(u,f,p){pa[ma++]=Jc,pa[ma++]=Qc,pa[ma++]=Rd,Rd=u;var b=Jc;u=Qc;var I=32-li(b)-1;b&=~(1<<I),p+=1;var A=32-li(f)+I;if(30<A){var U=I-I%5;A=(b&(1<<U)-1).toString(32),b>>=U,I-=U,Jc=1<<32-li(f)+I|p<<I|b,Qc=A+u}else Jc=1<<A|p<<I|b,Qc=u}function sk(u){u.return!==null&&(Xl(u,1),nU(u,1,0))}function ok(u){for(;u===zS;)zS=Pm[--Dm],Pm[Dm]=null,e0=Pm[--Dm],Pm[Dm]=null;for(;u===Rd;)Rd=pa[--ma],pa[ma]=null,Qc=pa[--ma],pa[ma]=null,Jc=pa[--ma],pa[ma]=null}function rU(u,f){pa[ma++]=Jc,pa[ma++]=Qc,pa[ma++]=Rd,Jc=f.id,Qc=f.overflow,Rd=u}var Hi=null,Wn=null,zt=!1,kd=null,ga=!1,ak=Error(r(519));function Id(u){var f=Error(r(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw t0(ha(f,u)),ak}function iU(u){var f=u.stateNode,p=u.type,b=u.memoizedProps;switch(f[Nr]=u,f[ir]=b,p){case"dialog":jt("cancel",f),jt("close",f);break;case"iframe":case"object":case"embed":jt("load",f);break;case"video":case"audio":for(p=0;p<E0.length;p++)jt(E0[p],f);break;case"source":jt("error",f);break;case"img":case"image":case"link":jt("error",f),jt("load",f);break;case"details":jt("toggle",f);break;case"input":jt("invalid",f),vN(f,b.value,b.defaultValue,b.checked,b.defaultChecked,b.type,b.name,!0);break;case"select":jt("invalid",f);break;case"textarea":jt("invalid",f),bN(f,b.value,b.defaultValue,b.children)}p=b.children,typeof p!="string"&&typeof p!="number"&&typeof p!="bigint"||f.textContent===""+p||b.suppressHydrationWarning===!0||SF(f.textContent,p)?(b.popover!=null&&(jt("beforetoggle",f),jt("toggle",f)),b.onScroll!=null&&jt("scroll",f),b.onScrollEnd!=null&&jt("scrollend",f),b.onClick!=null&&(f.onclick=zl),f=!0):f=!1,f||Id(u,!0)}function sU(u){for(Hi=u.return;Hi;)switch(Hi.tag){case 5:case 31:case 13:ga=!1;return;case 27:case 3:ga=!0;return;default:Hi=Hi.return}}function Nm(u){if(u!==Hi)return!1;if(!zt)return sU(u),zt=!0,!1;var f=u.tag,p;if((p=f!==3&&f!==27)&&((p=f===5)&&(p=u.type,p=!(p!=="form"&&p!=="button")||TI(u.type,u.memoizedProps)),p=!p),p&&Wn&&Id(u),sU(u),f===13){if(u=u.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(r(317));Wn=AF(u)}else if(f===31){if(u=u.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(r(317));Wn=AF(u)}else f===27?(f=Wn,Hd(u.type)?(u=AI,AI=null,Wn=u):Wn=f):Wn=Hi?ya(u.stateNode.nextSibling):null;return!0}function xh(){Wn=Hi=null,zt=!1}function ck(){var u=kd;return u!==null&&(Ys===null?Ys=u:Ys.push.apply(Ys,u),kd=null),u}function t0(u){kd===null?kd=[u]:kd.push(u)}var lk=q(null),Ah=null,Jl=null;function xd(u,f,p){ue(lk,f._currentValue),f._currentValue=p}function Ql(u){u._currentValue=lk.current,J(lk)}function uk(u,f,p){for(;u!==null;){var b=u.alternate;if((u.childLanes&f)!==f?(u.childLanes|=f,b!==null&&(b.childLanes|=f)):b!==null&&(b.childLanes&f)!==f&&(b.childLanes|=f),u===p)break;u=u.return}}function dk(u,f,p,b){var I=u.child;for(I!==null&&(I.return=u);I!==null;){var A=I.dependencies;if(A!==null){var U=I.child;A=A.firstContext;e:for(;A!==null;){var K=A;A=I;for(var Q=0;Q<f.length;Q++)if(K.context===f[Q]){A.lanes|=p,K=A.alternate,K!==null&&(K.lanes|=p),uk(A.return,p,u),b||(U=null);break e}A=K.next}}else if(I.tag===18){if(U=I.return,U===null)throw Error(r(341));U.lanes|=p,A=U.alternate,A!==null&&(A.lanes|=p),uk(U,p,u),U=null}else U=I.child;if(U!==null)U.return=I;else for(U=I;U!==null;){if(U===u){U=null;break}if(I=U.sibling,I!==null){I.return=U.return,U=I;break}U=U.return}I=U}}function Um(u,f,p,b){u=null;for(var I=f,A=!1;I!==null;){if(!A){if((I.flags&524288)!==0)A=!0;else if((I.flags&262144)!==0)break}if(I.tag===10){var U=I.alternate;if(U===null)throw Error(r(387));if(U=U.memoizedProps,U!==null){var K=I.type;xo(I.pendingProps.value,U.value)||(u!==null?u.push(K):u=[K])}}else if(I===de.current){if(U=I.alternate,U===null)throw Error(r(387));U.memoizedState.memoizedState!==I.memoizedState.memoizedState&&(u!==null?u.push(I0):u=[I0])}I=I.return}u!==null&&dk(f,u,p,b),f.flags|=262144}function WS(u){for(u=u.firstContext;u!==null;){if(!xo(u.context._currentValue,u.memoizedValue))return!0;u=u.next}return!1}function Lh(u){Ah=u,Jl=null,u=u.dependencies,u!==null&&(u.firstContext=null)}function qi(u){return oU(Ah,u)}function YS(u,f){return Ah===null&&Lh(u),oU(u,f)}function oU(u,f){var p=f._currentValue;if(f={context:f,memoizedValue:p,next:null},Jl===null){if(u===null)throw Error(r(308));Jl=f,u.dependencies={lanes:0,firstContext:f},u.flags|=524288}else Jl=Jl.next=f;return p}var Fme=typeof AbortController<"u"?AbortController:function(){var u=[],f=this.signal={aborted:!1,addEventListener:function(p,b){u.push(b)}};this.abort=function(){f.aborted=!0,u.forEach(function(p){return p()})}},$me=t.unstable_scheduleCallback,Bme=t.unstable_NormalPriority,Yr={$$typeof:x,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function fk(){return{controller:new Fme,data:new Map,refCount:0}}function n0(u){u.refCount--,u.refCount===0&&$me(Bme,function(){u.controller.abort()})}var r0=null,hk=0,jm=0,Fm=null;function Hme(u,f){if(r0===null){var p=r0=[];hk=0,jm=gI(),Fm={status:"pending",value:void 0,then:function(b){p.push(b)}}}return hk++,f.then(aU,aU),f}function aU(){if(--hk===0&&r0!==null){Fm!==null&&(Fm.status="fulfilled");var u=r0;r0=null,jm=0,Fm=null;for(var f=0;f<u.length;f++)(0,u[f])()}}function qme(u,f){var p=[],b={status:"pending",value:null,reason:null,then:function(I){p.push(I)}};return u.then(function(){b.status="fulfilled",b.value=f;for(var I=0;I<p.length;I++)(0,p[I])(f)},function(I){for(b.status="rejected",b.reason=I,I=0;I<p.length;I++)(0,p[I])(void 0)}),b}var cU=F.S;F.S=function(u,f){Kj=wr(),typeof f=="object"&&f!==null&&typeof f.then=="function"&&Hme(u,f),cU!==null&&cU(u,f)};var Mh=q(null);function pk(){var u=Mh.current;return u!==null?u:Ln.pooledCache}function XS(u,f){f===null?ue(Mh,Mh.current):ue(Mh,f.pool)}function lU(){var u=pk();return u===null?null:{parent:Yr._currentValue,pool:u}}var $m=Error(r(460)),mk=Error(r(474)),JS=Error(r(542)),QS={then:function(){}};function uU(u){return u=u.status,u==="fulfilled"||u==="rejected"}function dU(u,f,p){switch(p=u[p],p===void 0?u.push(f):p!==f&&(f.then(zl,zl),f=p),f.status){case"fulfilled":return f.value;case"rejected":throw u=f.reason,hU(u),u;default:if(typeof f.status=="string")f.then(zl,zl);else{if(u=Ln,u!==null&&100<u.shellSuspendCounter)throw Error(r(482));u=f,u.status="pending",u.then(function(b){if(f.status==="pending"){var I=f;I.status="fulfilled",I.value=b}},function(b){if(f.status==="pending"){var I=f;I.status="rejected",I.reason=b}})}switch(f.status){case"fulfilled":return f.value;case"rejected":throw u=f.reason,hU(u),u}throw Ph=f,$m}}function Oh(u){try{var f=u._init;return f(u._payload)}catch(p){throw p!==null&&typeof p=="object"&&typeof p.then=="function"?(Ph=p,$m):p}}var Ph=null;function fU(){if(Ph===null)throw Error(r(459));var u=Ph;return Ph=null,u}function hU(u){if(u===$m||u===JS)throw Error(r(483))}var Bm=null,i0=0;function ZS(u){var f=i0;return i0+=1,Bm===null&&(Bm=[]),dU(Bm,u,f)}function s0(u,f){f=f.props.ref,u.ref=f!==void 0?f:null}function e2(u,f){throw f.$$typeof===m?Error(r(525)):(u=Object.prototype.toString.call(f),Error(r(31,u==="[object Object]"?"object with keys {"+Object.keys(f).join(", ")+"}":u)))}function pU(u){function f(re,te){if(u){var ie=re.deletions;ie===null?(re.deletions=[te],re.flags|=16):ie.push(te)}}function p(re,te){if(!u)return null;for(;te!==null;)f(re,te),te=te.sibling;return null}function b(re){for(var te=new Map;re!==null;)re.key!==null?te.set(re.key,re):te.set(re.index,re),re=re.sibling;return te}function I(re,te){return re=Yl(re,te),re.index=0,re.sibling=null,re}function A(re,te,ie){return re.index=ie,u?(ie=re.alternate,ie!==null?(ie=ie.index,ie<te?(re.flags|=67108866,te):ie):(re.flags|=67108866,te)):(re.flags|=1048576,te)}function U(re){return u&&re.alternate===null&&(re.flags|=67108866),re}function K(re,te,ie,_e){return te===null||te.tag!==6?(te=rk(ie,re.mode,_e),te.return=re,te):(te=I(te,ie),te.return=re,te)}function Q(re,te,ie,_e){var tt=ie.type;return tt===v?ye(re,te,ie.props.children,_e,ie.key):te!==null&&(te.elementType===tt||typeof tt=="object"&&tt!==null&&tt.$$typeof===O&&Oh(tt)===te.type)?(te=I(te,ie.props),s0(te,ie),te.return=re,te):(te=GS(ie.type,ie.key,ie.props,null,re.mode,_e),s0(te,ie),te.return=re,te)}function se(re,te,ie,_e){return te===null||te.tag!==4||te.stateNode.containerInfo!==ie.containerInfo||te.stateNode.implementation!==ie.implementation?(te=ik(ie,re.mode,_e),te.return=re,te):(te=I(te,ie.children||[]),te.return=re,te)}function ye(re,te,ie,_e,tt){return te===null||te.tag!==7?(te=Ih(ie,re.mode,_e,tt),te.return=re,te):(te=I(te,ie),te.return=re,te)}function Ee(re,te,ie){if(typeof te=="string"&&te!==""||typeof te=="number"||typeof te=="bigint")return te=rk(""+te,re.mode,ie),te.return=re,te;if(typeof te=="object"&&te!==null){switch(te.$$typeof){case g:return ie=GS(te.type,te.key,te.props,null,re.mode,ie),s0(ie,te),ie.return=re,ie;case y:return te=ik(te,re.mode,ie),te.return=re,te;case O:return te=Oh(te),Ee(re,te,ie)}if(W(te)||H(te))return te=Ih(te,re.mode,ie,null),te.return=re,te;if(typeof te.then=="function")return Ee(re,ZS(te),ie);if(te.$$typeof===x)return Ee(re,YS(re,te),ie);e2(re,te)}return null}function le(re,te,ie,_e){var tt=te!==null?te.key:null;if(typeof ie=="string"&&ie!==""||typeof ie=="number"||typeof ie=="bigint")return tt!==null?null:K(re,te,""+ie,_e);if(typeof ie=="object"&&ie!==null){switch(ie.$$typeof){case g:return ie.key===tt?Q(re,te,ie,_e):null;case y:return ie.key===tt?se(re,te,ie,_e):null;case O:return ie=Oh(ie),le(re,te,ie,_e)}if(W(ie)||H(ie))return tt!==null?null:ye(re,te,ie,_e,null);if(typeof ie.then=="function")return le(re,te,ZS(ie),_e);if(ie.$$typeof===x)return le(re,te,YS(re,ie),_e);e2(re,ie)}return null}function me(re,te,ie,_e,tt){if(typeof _e=="string"&&_e!==""||typeof _e=="number"||typeof _e=="bigint")return re=re.get(ie)||null,K(te,re,""+_e,tt);if(typeof _e=="object"&&_e!==null){switch(_e.$$typeof){case g:return re=re.get(_e.key===null?ie:_e.key)||null,Q(te,re,_e,tt);case y:return re=re.get(_e.key===null?ie:_e.key)||null,se(te,re,_e,tt);case O:return _e=Oh(_e),me(re,te,ie,_e,tt)}if(W(_e)||H(_e))return re=re.get(ie)||null,ye(te,re,_e,tt,null);if(typeof _e.then=="function")return me(re,te,ie,ZS(_e),tt);if(_e.$$typeof===x)return me(re,te,ie,YS(te,_e),tt);e2(te,_e)}return null}function qe(re,te,ie,_e){for(var tt=null,nn=null,We=te,Ot=te=0,Kt=null;We!==null&&Ot<ie.length;Ot++){We.index>Ot?(Kt=We,We=null):Kt=We.sibling;var rn=le(re,We,ie[Ot],_e);if(rn===null){We===null&&(We=Kt);break}u&&We&&rn.alternate===null&&f(re,We),te=A(rn,te,Ot),nn===null?tt=rn:nn.sibling=rn,nn=rn,We=Kt}if(Ot===ie.length)return p(re,We),zt&&Xl(re,Ot),tt;if(We===null){for(;Ot<ie.length;Ot++)We=Ee(re,ie[Ot],_e),We!==null&&(te=A(We,te,Ot),nn===null?tt=We:nn.sibling=We,nn=We);return zt&&Xl(re,Ot),tt}for(We=b(We);Ot<ie.length;Ot++)Kt=me(We,re,Ot,ie[Ot],_e),Kt!==null&&(u&&Kt.alternate!==null&&We.delete(Kt.key===null?Ot:Kt.key),te=A(Kt,te,Ot),nn===null?tt=Kt:nn.sibling=Kt,nn=Kt);return u&&We.forEach(function(zd){return f(re,zd)}),zt&&Xl(re,Ot),tt}function ct(re,te,ie,_e){if(ie==null)throw Error(r(151));for(var tt=null,nn=null,We=te,Ot=te=0,Kt=null,rn=ie.next();We!==null&&!rn.done;Ot++,rn=ie.next()){We.index>Ot?(Kt=We,We=null):Kt=We.sibling;var zd=le(re,We,rn.value,_e);if(zd===null){We===null&&(We=Kt);break}u&&We&&zd.alternate===null&&f(re,We),te=A(zd,te,Ot),nn===null?tt=zd:nn.sibling=zd,nn=zd,We=Kt}if(rn.done)return p(re,We),zt&&Xl(re,Ot),tt;if(We===null){for(;!rn.done;Ot++,rn=ie.next())rn=Ee(re,rn.value,_e),rn!==null&&(te=A(rn,te,Ot),nn===null?tt=rn:nn.sibling=rn,nn=rn);return zt&&Xl(re,Ot),tt}for(We=b(We);!rn.done;Ot++,rn=ie.next())rn=me(We,re,Ot,rn.value,_e),rn!==null&&(u&&rn.alternate!==null&&We.delete(rn.key===null?Ot:rn.key),te=A(rn,te,Ot),nn===null?tt=rn:nn.sibling=rn,nn=rn);return u&&We.forEach(function(eve){return f(re,eve)}),zt&&Xl(re,Ot),tt}function Tn(re,te,ie,_e){if(typeof ie=="object"&&ie!==null&&ie.type===v&&ie.key===null&&(ie=ie.props.children),typeof ie=="object"&&ie!==null){switch(ie.$$typeof){case g:e:{for(var tt=ie.key;te!==null;){if(te.key===tt){if(tt=ie.type,tt===v){if(te.tag===7){p(re,te.sibling),_e=I(te,ie.props.children),_e.return=re,re=_e;break e}}else if(te.elementType===tt||typeof tt=="object"&&tt!==null&&tt.$$typeof===O&&Oh(tt)===te.type){p(re,te.sibling),_e=I(te,ie.props),s0(_e,ie),_e.return=re,re=_e;break e}p(re,te);break}else f(re,te);te=te.sibling}ie.type===v?(_e=Ih(ie.props.children,re.mode,_e,ie.key),_e.return=re,re=_e):(_e=GS(ie.type,ie.key,ie.props,null,re.mode,_e),s0(_e,ie),_e.return=re,re=_e)}return U(re);case y:e:{for(tt=ie.key;te!==null;){if(te.key===tt)if(te.tag===4&&te.stateNode.containerInfo===ie.containerInfo&&te.stateNode.implementation===ie.implementation){p(re,te.sibling),_e=I(te,ie.children||[]),_e.return=re,re=_e;break e}else{p(re,te);break}else f(re,te);te=te.sibling}_e=ik(ie,re.mode,_e),_e.return=re,re=_e}return U(re);case O:return ie=Oh(ie),Tn(re,te,ie,_e)}if(W(ie))return qe(re,te,ie,_e);if(H(ie)){if(tt=H(ie),typeof tt!="function")throw Error(r(150));return ie=tt.call(ie),ct(re,te,ie,_e)}if(typeof ie.then=="function")return Tn(re,te,ZS(ie),_e);if(ie.$$typeof===x)return Tn(re,te,YS(re,ie),_e);e2(re,ie)}return typeof ie=="string"&&ie!==""||typeof ie=="number"||typeof ie=="bigint"?(ie=""+ie,te!==null&&te.tag===6?(p(re,te.sibling),_e=I(te,ie),_e.return=re,re=_e):(p(re,te),_e=rk(ie,re.mode,_e),_e.return=re,re=_e),U(re)):p(re,te)}return function(re,te,ie,_e){try{i0=0;var tt=Tn(re,te,ie,_e);return Bm=null,tt}catch(We){if(We===$m||We===JS)throw We;var nn=Ao(29,We,null,re.mode);return nn.lanes=_e,nn.return=re,nn}}}var Dh=pU(!0),mU=pU(!1),Ad=!1;function gk(u){u.updateQueue={baseState:u.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function vk(u,f){u=u.updateQueue,f.updateQueue===u&&(f.updateQueue={baseState:u.baseState,firstBaseUpdate:u.firstBaseUpdate,lastBaseUpdate:u.lastBaseUpdate,shared:u.shared,callbacks:null})}function Ld(u){return{lane:u,tag:0,payload:null,callback:null,next:null}}function Md(u,f,p){var b=u.updateQueue;if(b===null)return null;if(b=b.shared,(dn&2)!==0){var I=b.pending;return I===null?f.next=f:(f.next=I.next,I.next=f),b.pending=f,f=KS(u),QN(u,null,p),f}return VS(u,b,f,p),KS(u)}function o0(u,f,p){if(f=f.updateQueue,f!==null&&(f=f.shared,(p&4194048)!==0)){var b=f.lanes;b&=u.pendingLanes,p|=b,f.lanes=p,ne(u,p)}}function yk(u,f){var p=u.updateQueue,b=u.alternate;if(b!==null&&(b=b.updateQueue,p===b)){var I=null,A=null;if(p=p.firstBaseUpdate,p!==null){do{var U={lane:p.lane,tag:p.tag,payload:p.payload,callback:null,next:null};A===null?I=A=U:A=A.next=U,p=p.next}while(p!==null);A===null?I=A=f:A=A.next=f}else I=A=f;p={baseState:b.baseState,firstBaseUpdate:I,lastBaseUpdate:A,shared:b.shared,callbacks:b.callbacks},u.updateQueue=p;return}u=p.lastBaseUpdate,u===null?p.firstBaseUpdate=f:u.next=f,p.lastBaseUpdate=f}var bk=!1;function a0(){if(bk){var u=Fm;if(u!==null)throw u}}function c0(u,f,p,b){bk=!1;var I=u.updateQueue;Ad=!1;var A=I.firstBaseUpdate,U=I.lastBaseUpdate,K=I.shared.pending;if(K!==null){I.shared.pending=null;var Q=K,se=Q.next;Q.next=null,U===null?A=se:U.next=se,U=Q;var ye=u.alternate;ye!==null&&(ye=ye.updateQueue,K=ye.lastBaseUpdate,K!==U&&(K===null?ye.firstBaseUpdate=se:K.next=se,ye.lastBaseUpdate=Q))}if(A!==null){var Ee=I.baseState;U=0,ye=se=Q=null,K=A;do{var le=K.lane&-536870913,me=le!==K.lane;if(me?(Vt&le)===le:(b&le)===le){le!==0&&le===jm&&(bk=!0),ye!==null&&(ye=ye.next={lane:0,tag:K.tag,payload:K.payload,callback:null,next:null});e:{var qe=u,ct=K;le=f;var Tn=p;switch(ct.tag){case 1:if(qe=ct.payload,typeof qe=="function"){Ee=qe.call(Tn,Ee,le);break e}Ee=qe;break e;case 3:qe.flags=qe.flags&-65537|128;case 0:if(qe=ct.payload,le=typeof qe=="function"?qe.call(Tn,Ee,le):qe,le==null)break e;Ee=h({},Ee,le);break e;case 2:Ad=!0}}le=K.callback,le!==null&&(u.flags|=64,me&&(u.flags|=8192),me=I.callbacks,me===null?I.callbacks=[le]:me.push(le))}else me={lane:le,tag:K.tag,payload:K.payload,callback:K.callback,next:null},ye===null?(se=ye=me,Q=Ee):ye=ye.next=me,U|=le;if(K=K.next,K===null){if(K=I.shared.pending,K===null)break;me=K,K=me.next,me.next=null,I.lastBaseUpdate=me,I.shared.pending=null}}while(!0);ye===null&&(Q=Ee),I.baseState=Q,I.firstBaseUpdate=se,I.lastBaseUpdate=ye,A===null&&(I.shared.lanes=0),Ud|=U,u.lanes=U,u.memoizedState=Ee}}function gU(u,f){if(typeof u!="function")throw Error(r(191,u));u.call(f)}function vU(u,f){var p=u.callbacks;if(p!==null)for(u.callbacks=null,u=0;u<p.length;u++)gU(p[u],f)}var Hm=q(null),t2=q(0);function yU(u,f){u=au,ue(t2,u),ue(Hm,f),au=u|f.baseLanes}function _k(){ue(t2,au),ue(Hm,Hm.current)}function Sk(){au=t2.current,J(Hm),J(t2)}var Lo=q(null),va=null;function Od(u){var f=u.alternate;ue(Ur,Ur.current&1),ue(Lo,u),va===null&&(f===null||Hm.current!==null||f.memoizedState!==null)&&(va=u)}function wk(u){ue(Ur,Ur.current),ue(Lo,u),va===null&&(va=u)}function bU(u){u.tag===22?(ue(Ur,Ur.current),ue(Lo,u),va===null&&(va=u)):Pd()}function Pd(){ue(Ur,Ur.current),ue(Lo,Lo.current)}function Mo(u){J(Lo),va===u&&(va=null),J(Ur)}var Ur=q(0);function n2(u){for(var f=u;f!==null;){if(f.tag===13){var p=f.memoizedState;if(p!==null&&(p=p.dehydrated,p===null||II(p)||xI(p)))return f}else if(f.tag===19&&(f.memoizedProps.revealOrder==="forwards"||f.memoizedProps.revealOrder==="backwards"||f.memoizedProps.revealOrder==="unstable_legacy-backwards"||f.memoizedProps.revealOrder==="together")){if((f.flags&128)!==0)return f}else if(f.child!==null){f.child.return=f,f=f.child;continue}if(f===u)break;for(;f.sibling===null;){if(f.return===null||f.return===u)return null;f=f.return}f.sibling.return=f.return,f=f.sibling}return null}var Zl=0,xt=null,En=null,Xr=null,r2=!1,qm=!1,Nh=!1,i2=0,l0=0,Vm=null,Vme=0;function Er(){throw Error(r(321))}function Ek(u,f){if(f===null)return!1;for(var p=0;p<f.length&&p<u.length;p++)if(!xo(u[p],f[p]))return!1;return!0}function Ck(u,f,p,b,I,A){return Zl=A,xt=f,f.memoizedState=null,f.updateQueue=null,f.lanes=0,F.H=u===null||u.memoizedState===null?nj:Fk,Nh=!1,A=p(b,I),Nh=!1,qm&&(A=SU(f,p,b,I)),_U(u),A}function _U(u){F.H=f0;var f=En!==null&&En.next!==null;if(Zl=0,Xr=En=xt=null,r2=!1,l0=0,Vm=null,f)throw Error(r(300));u===null||Jr||(u=u.dependencies,u!==null&&WS(u)&&(Jr=!0))}function SU(u,f,p,b){xt=u;var I=0;do{if(qm&&(Vm=null),l0=0,qm=!1,25<=I)throw Error(r(301));if(I+=1,Xr=En=null,u.updateQueue!=null){var A=u.updateQueue;A.lastEffect=null,A.events=null,A.stores=null,A.memoCache!=null&&(A.memoCache.index=0)}F.H=rj,A=f(p,b)}while(qm);return A}function Kme(){var u=F.H,f=u.useState()[0];return f=typeof f.then=="function"?u0(f):f,u=u.useState()[0],(En!==null?En.memoizedState:null)!==u&&(xt.flags|=1024),f}function Tk(){var u=i2!==0;return i2=0,u}function Rk(u,f,p){f.updateQueue=u.updateQueue,f.flags&=-2053,u.lanes&=~p}function kk(u){if(r2){for(u=u.memoizedState;u!==null;){var f=u.queue;f!==null&&(f.pending=null),u=u.next}r2=!1}Zl=0,Xr=En=xt=null,qm=!1,l0=i2=0,Vm=null}function Cs(){var u={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Xr===null?xt.memoizedState=Xr=u:Xr=Xr.next=u,Xr}function jr(){if(En===null){var u=xt.alternate;u=u!==null?u.memoizedState:null}else u=En.next;var f=Xr===null?xt.memoizedState:Xr.next;if(f!==null)Xr=f,En=u;else{if(u===null)throw xt.alternate===null?Error(r(467)):Error(r(310));En=u,u={memoizedState:En.memoizedState,baseState:En.baseState,baseQueue:En.baseQueue,queue:En.queue,next:null},Xr===null?xt.memoizedState=Xr=u:Xr=Xr.next=u}return Xr}function s2(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function u0(u){var f=l0;return l0+=1,Vm===null&&(Vm=[]),u=dU(Vm,u,f),f=xt,(Xr===null?f.memoizedState:Xr.next)===null&&(f=f.alternate,F.H=f===null||f.memoizedState===null?nj:Fk),u}function o2(u){if(u!==null&&typeof u=="object"){if(typeof u.then=="function")return u0(u);if(u.$$typeof===x)return qi(u)}throw Error(r(438,String(u)))}function Ik(u){var f=null,p=xt.updateQueue;if(p!==null&&(f=p.memoCache),f==null){var b=xt.alternate;b!==null&&(b=b.updateQueue,b!==null&&(b=b.memoCache,b!=null&&(f={data:b.data.map(function(I){return I.slice()}),index:0})))}if(f==null&&(f={data:[],index:0}),p===null&&(p=s2(),xt.updateQueue=p),p.memoCache=f,p=f.data[f.index],p===void 0)for(p=f.data[f.index]=Array(u),b=0;b<u;b++)p[b]=D;return f.index++,p}function eu(u,f){return typeof f=="function"?f(u):f}function a2(u){var f=jr();return xk(f,En,u)}function xk(u,f,p){var b=u.queue;if(b===null)throw Error(r(311));b.lastRenderedReducer=p;var I=u.baseQueue,A=b.pending;if(A!==null){if(I!==null){var U=I.next;I.next=A.next,A.next=U}f.baseQueue=I=A,b.pending=null}if(A=u.baseState,I===null)u.memoizedState=A;else{f=I.next;var K=U=null,Q=null,se=f,ye=!1;do{var Ee=se.lane&-536870913;if(Ee!==se.lane?(Vt&Ee)===Ee:(Zl&Ee)===Ee){var le=se.revertLane;if(le===0)Q!==null&&(Q=Q.next={lane:0,revertLane:0,gesture:null,action:se.action,hasEagerState:se.hasEagerState,eagerState:se.eagerState,next:null}),Ee===jm&&(ye=!0);else if((Zl&le)===le){se=se.next,le===jm&&(ye=!0);continue}else Ee={lane:0,revertLane:se.revertLane,gesture:null,action:se.action,hasEagerState:se.hasEagerState,eagerState:se.eagerState,next:null},Q===null?(K=Q=Ee,U=A):Q=Q.next=Ee,xt.lanes|=le,Ud|=le;Ee=se.action,Nh&&p(A,Ee),A=se.hasEagerState?se.eagerState:p(A,Ee)}else le={lane:Ee,revertLane:se.revertLane,gesture:se.gesture,action:se.action,hasEagerState:se.hasEagerState,eagerState:se.eagerState,next:null},Q===null?(K=Q=le,U=A):Q=Q.next=le,xt.lanes|=Ee,Ud|=Ee;se=se.next}while(se!==null&&se!==f);if(Q===null?U=A:Q.next=K,!xo(A,u.memoizedState)&&(Jr=!0,ye&&(p=Fm,p!==null)))throw p;u.memoizedState=A,u.baseState=U,u.baseQueue=Q,b.lastRenderedState=A}return I===null&&(b.lanes=0),[u.memoizedState,b.dispatch]}function Ak(u){var f=jr(),p=f.queue;if(p===null)throw Error(r(311));p.lastRenderedReducer=u;var b=p.dispatch,I=p.pending,A=f.memoizedState;if(I!==null){p.pending=null;var U=I=I.next;do A=u(A,U.action),U=U.next;while(U!==I);xo(A,f.memoizedState)||(Jr=!0),f.memoizedState=A,f.baseQueue===null&&(f.baseState=A),p.lastRenderedState=A}return[A,b]}function wU(u,f,p){var b=xt,I=jr(),A=zt;if(A){if(p===void 0)throw Error(r(407));p=p()}else p=f();var U=!xo((En||I).memoizedState,p);if(U&&(I.memoizedState=p,Jr=!0),I=I.queue,Ok(TU.bind(null,b,I,u),[u]),I.getSnapshot!==f||U||Xr!==null&&Xr.memoizedState.tag&1){if(b.flags|=2048,Km(9,{destroy:void 0},CU.bind(null,b,I,p,f),null),Ln===null)throw Error(r(349));A||(Zl&127)!==0||EU(b,f,p)}return p}function EU(u,f,p){u.flags|=16384,u={getSnapshot:f,value:p},f=xt.updateQueue,f===null?(f=s2(),xt.updateQueue=f,f.stores=[u]):(p=f.stores,p===null?f.stores=[u]:p.push(u))}function CU(u,f,p,b){f.value=p,f.getSnapshot=b,RU(f)&&kU(u)}function TU(u,f,p){return p(function(){RU(f)&&kU(u)})}function RU(u){var f=u.getSnapshot;u=u.value;try{var p=f();return!xo(u,p)}catch{return!0}}function kU(u){var f=kh(u,2);f!==null&&Xs(f,u,2)}function Lk(u){var f=Cs();if(typeof u=="function"){var p=u;if(u=p(),Nh){Vs(!0);try{p()}finally{Vs(!1)}}}return f.memoizedState=f.baseState=u,f.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:eu,lastRenderedState:u},f}function IU(u,f,p,b){return u.baseState=p,xk(u,En,typeof b=="function"?b:eu)}function Gme(u,f,p,b,I){if(u2(u))throw Error(r(485));if(u=f.action,u!==null){var A={payload:I,action:u,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(U){A.listeners.push(U)}};F.T!==null?p(!0):A.isTransition=!1,b(A),p=f.pending,p===null?(A.next=f.pending=A,xU(f,A)):(A.next=p.next,f.pending=p.next=A)}}function xU(u,f){var p=f.action,b=f.payload,I=u.state;if(f.isTransition){var A=F.T,U={};F.T=U;try{var K=p(I,b),Q=F.S;Q!==null&&Q(U,K),AU(u,f,K)}catch(se){Mk(u,f,se)}finally{A!==null&&U.types!==null&&(A.types=U.types),F.T=A}}else try{A=p(I,b),AU(u,f,A)}catch(se){Mk(u,f,se)}}function AU(u,f,p){p!==null&&typeof p=="object"&&typeof p.then=="function"?p.then(function(b){LU(u,f,b)},function(b){return Mk(u,f,b)}):LU(u,f,p)}function LU(u,f,p){f.status="fulfilled",f.value=p,MU(f),u.state=p,f=u.pending,f!==null&&(p=f.next,p===f?u.pending=null:(p=p.next,f.next=p,xU(u,p)))}function Mk(u,f,p){var b=u.pending;if(u.pending=null,b!==null){b=b.next;do f.status="rejected",f.reason=p,MU(f),f=f.next;while(f!==b)}u.action=null}function MU(u){u=u.listeners;for(var f=0;f<u.length;f++)(0,u[f])()}function OU(u,f){return f}function PU(u,f){if(zt){var p=Ln.formState;if(p!==null){e:{var b=xt;if(zt){if(Wn){t:{for(var I=Wn,A=ga;I.nodeType!==8;){if(!A){I=null;break t}if(I=ya(I.nextSibling),I===null){I=null;break t}}A=I.data,I=A==="F!"||A==="F"?I:null}if(I){Wn=ya(I.nextSibling),b=I.data==="F!";break e}}Id(b)}b=!1}b&&(f=p[0])}}return p=Cs(),p.memoizedState=p.baseState=f,b={pending:null,lanes:0,dispatch:null,lastRenderedReducer:OU,lastRenderedState:f},p.queue=b,p=ZU.bind(null,xt,b),b.dispatch=p,b=Lk(!1),A=jk.bind(null,xt,!1,b.queue),b=Cs(),I={state:f,dispatch:null,action:u,pending:null},b.queue=I,p=Gme.bind(null,xt,I,A,p),I.dispatch=p,b.memoizedState=u,[f,p,!1]}function DU(u){var f=jr();return NU(f,En,u)}function NU(u,f,p){if(f=xk(u,f,OU)[0],u=a2(eu)[0],typeof f=="object"&&f!==null&&typeof f.then=="function")try{var b=u0(f)}catch(U){throw U===$m?JS:U}else b=f;f=jr();var I=f.queue,A=I.dispatch;return p!==f.memoizedState&&(xt.flags|=2048,Km(9,{destroy:void 0},zme.bind(null,I,p),null)),[b,A,u]}function zme(u,f){u.action=f}function UU(u){var f=jr(),p=En;if(p!==null)return NU(f,p,u);jr(),f=f.memoizedState,p=jr();var b=p.queue.dispatch;return p.memoizedState=u,[f,b,!1]}function Km(u,f,p,b){return u={tag:u,create:p,deps:b,inst:f,next:null},f=xt.updateQueue,f===null&&(f=s2(),xt.updateQueue=f),p=f.lastEffect,p===null?f.lastEffect=u.next=u:(b=p.next,p.next=u,u.next=b,f.lastEffect=u),u}function jU(){return jr().memoizedState}function c2(u,f,p,b){var I=Cs();xt.flags|=u,I.memoizedState=Km(1|f,{destroy:void 0},p,b===void 0?null:b)}function l2(u,f,p,b){var I=jr();b=b===void 0?null:b;var A=I.memoizedState.inst;En!==null&&b!==null&&Ek(b,En.memoizedState.deps)?I.memoizedState=Km(f,A,p,b):(xt.flags|=u,I.memoizedState=Km(1|f,A,p,b))}function FU(u,f){c2(8390656,8,u,f)}function Ok(u,f){l2(2048,8,u,f)}function Wme(u){xt.flags|=4;var f=xt.updateQueue;if(f===null)f=s2(),xt.updateQueue=f,f.events=[u];else{var p=f.events;p===null?f.events=[u]:p.push(u)}}function $U(u){var f=jr().memoizedState;return Wme({ref:f,nextImpl:u}),function(){if((dn&2)!==0)throw Error(r(440));return f.impl.apply(void 0,arguments)}}function BU(u,f){return l2(4,2,u,f)}function HU(u,f){return l2(4,4,u,f)}function qU(u,f){if(typeof f=="function"){u=u();var p=f(u);return function(){typeof p=="function"?p():f(null)}}if(f!=null)return u=u(),f.current=u,function(){f.current=null}}function VU(u,f,p){p=p!=null?p.concat([u]):null,l2(4,4,qU.bind(null,f,u),p)}function Pk(){}function KU(u,f){var p=jr();f=f===void 0?null:f;var b=p.memoizedState;return f!==null&&Ek(f,b[1])?b[0]:(p.memoizedState=[u,f],u)}function GU(u,f){var p=jr();f=f===void 0?null:f;var b=p.memoizedState;if(f!==null&&Ek(f,b[1]))return b[0];if(b=u(),Nh){Vs(!0);try{u()}finally{Vs(!1)}}return p.memoizedState=[b,f],b}function Dk(u,f,p){return p===void 0||(Zl&1073741824)!==0&&(Vt&261930)===0?u.memoizedState=f:(u.memoizedState=p,u=zj(),xt.lanes|=u,Ud|=u,p)}function zU(u,f,p,b){return xo(p,f)?p:Hm.current!==null?(u=Dk(u,p,b),xo(u,f)||(Jr=!0),u):(Zl&42)===0||(Zl&1073741824)!==0&&(Vt&261930)===0?(Jr=!0,u.memoizedState=p):(u=zj(),xt.lanes|=u,Ud|=u,f)}function WU(u,f,p,b,I){var A=$.p;$.p=A!==0&&8>A?A:8;var U=F.T,K={};F.T=K,jk(u,!1,f,p);try{var Q=I(),se=F.S;if(se!==null&&se(K,Q),Q!==null&&typeof Q=="object"&&typeof Q.then=="function"){var ye=qme(Q,b);d0(u,f,ye,Do(u))}else d0(u,f,b,Do(u))}catch(Ee){d0(u,f,{then:function(){},status:"rejected",reason:Ee},Do())}finally{$.p=A,U!==null&&K.types!==null&&(U.types=K.types),F.T=U}}function Yme(){}function Nk(u,f,p,b){if(u.tag!==5)throw Error(r(476));var I=YU(u).queue;WU(u,I,f,V,p===null?Yme:function(){return XU(u),p(b)})}function YU(u){var f=u.memoizedState;if(f!==null)return f;f={memoizedState:V,baseState:V,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:eu,lastRenderedState:V},next:null};var p={};return f.next={memoizedState:p,baseState:p,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:eu,lastRenderedState:p},next:null},u.memoizedState=f,u=u.alternate,u!==null&&(u.memoizedState=f),f}function XU(u){var f=YU(u);f.next===null&&(f=u.alternate.memoizedState),d0(u,f.next.queue,{},Do())}function Uk(){return qi(I0)}function JU(){return jr().memoizedState}function QU(){return jr().memoizedState}function Xme(u){for(var f=u.return;f!==null;){switch(f.tag){case 24:case 3:var p=Do();u=Ld(p);var b=Md(f,u,p);b!==null&&(Xs(b,f,p),o0(b,f,p)),f={cache:fk()},u.payload=f;return}f=f.return}}function Jme(u,f,p){var b=Do();p={lane:b,revertLane:0,gesture:null,action:p,hasEagerState:!1,eagerState:null,next:null},u2(u)?ej(f,p):(p=tk(u,f,p,b),p!==null&&(Xs(p,u,b),tj(p,f,b)))}function ZU(u,f,p){var b=Do();d0(u,f,p,b)}function d0(u,f,p,b){var I={lane:b,revertLane:0,gesture:null,action:p,hasEagerState:!1,eagerState:null,next:null};if(u2(u))ej(f,I);else{var A=u.alternate;if(u.lanes===0&&(A===null||A.lanes===0)&&(A=f.lastRenderedReducer,A!==null))try{var U=f.lastRenderedState,K=A(U,p);if(I.hasEagerState=!0,I.eagerState=K,xo(K,U))return VS(u,f,I,0),Ln===null&&qS(),!1}catch{}if(p=tk(u,f,I,b),p!==null)return Xs(p,u,b),tj(p,f,b),!0}return!1}function jk(u,f,p,b){if(b={lane:2,revertLane:gI(),gesture:null,action:b,hasEagerState:!1,eagerState:null,next:null},u2(u)){if(f)throw Error(r(479))}else f=tk(u,p,b,2),f!==null&&Xs(f,u,2)}function u2(u){var f=u.alternate;return u===xt||f!==null&&f===xt}function ej(u,f){qm=r2=!0;var p=u.pending;p===null?f.next=f:(f.next=p.next,p.next=f),u.pending=f}function tj(u,f,p){if((p&4194048)!==0){var b=f.lanes;b&=u.pendingLanes,p|=b,f.lanes=p,ne(u,p)}}var f0={readContext:qi,use:o2,useCallback:Er,useContext:Er,useEffect:Er,useImperativeHandle:Er,useLayoutEffect:Er,useInsertionEffect:Er,useMemo:Er,useReducer:Er,useRef:Er,useState:Er,useDebugValue:Er,useDeferredValue:Er,useTransition:Er,useSyncExternalStore:Er,useId:Er,useHostTransitionStatus:Er,useFormState:Er,useActionState:Er,useOptimistic:Er,useMemoCache:Er,useCacheRefresh:Er};f0.useEffectEvent=Er;var nj={readContext:qi,use:o2,useCallback:function(u,f){return Cs().memoizedState=[u,f===void 0?null:f],u},useContext:qi,useEffect:FU,useImperativeHandle:function(u,f,p){p=p!=null?p.concat([u]):null,c2(4194308,4,qU.bind(null,f,u),p)},useLayoutEffect:function(u,f){return c2(4194308,4,u,f)},useInsertionEffect:function(u,f){c2(4,2,u,f)},useMemo:function(u,f){var p=Cs();f=f===void 0?null:f;var b=u();if(Nh){Vs(!0);try{u()}finally{Vs(!1)}}return p.memoizedState=[b,f],b},useReducer:function(u,f,p){var b=Cs();if(p!==void 0){var I=p(f);if(Nh){Vs(!0);try{p(f)}finally{Vs(!1)}}}else I=f;return b.memoizedState=b.baseState=I,u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:u,lastRenderedState:I},b.queue=u,u=u.dispatch=Jme.bind(null,xt,u),[b.memoizedState,u]},useRef:function(u){var f=Cs();return u={current:u},f.memoizedState=u},useState:function(u){u=Lk(u);var f=u.queue,p=ZU.bind(null,xt,f);return f.dispatch=p,[u.memoizedState,p]},useDebugValue:Pk,useDeferredValue:function(u,f){var p=Cs();return Dk(p,u,f)},useTransition:function(){var u=Lk(!1);return u=WU.bind(null,xt,u.queue,!0,!1),Cs().memoizedState=u,[!1,u]},useSyncExternalStore:function(u,f,p){var b=xt,I=Cs();if(zt){if(p===void 0)throw Error(r(407));p=p()}else{if(p=f(),Ln===null)throw Error(r(349));(Vt&127)!==0||EU(b,f,p)}I.memoizedState=p;var A={value:p,getSnapshot:f};return I.queue=A,FU(TU.bind(null,b,A,u),[u]),b.flags|=2048,Km(9,{destroy:void 0},CU.bind(null,b,A,p,f),null),p},useId:function(){var u=Cs(),f=Ln.identifierPrefix;if(zt){var p=Qc,b=Jc;p=(b&~(1<<32-li(b)-1)).toString(32)+p,f="_"+f+"R_"+p,p=i2++,0<p&&(f+="H"+p.toString(32)),f+="_"}else p=Vme++,f="_"+f+"r_"+p.toString(32)+"_";return u.memoizedState=f},useHostTransitionStatus:Uk,useFormState:PU,useActionState:PU,useOptimistic:function(u){var f=Cs();f.memoizedState=f.baseState=u;var p={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return f.queue=p,f=jk.bind(null,xt,!0,p),p.dispatch=f,[u,f]},useMemoCache:Ik,useCacheRefresh:function(){return Cs().memoizedState=Xme.bind(null,xt)},useEffectEvent:function(u){var f=Cs(),p={impl:u};return f.memoizedState=p,function(){if((dn&2)!==0)throw Error(r(440));return p.impl.apply(void 0,arguments)}}},Fk={readContext:qi,use:o2,useCallback:KU,useContext:qi,useEffect:Ok,useImperativeHandle:VU,useInsertionEffect:BU,useLayoutEffect:HU,useMemo:GU,useReducer:a2,useRef:jU,useState:function(){return a2(eu)},useDebugValue:Pk,useDeferredValue:function(u,f){var p=jr();return zU(p,En.memoizedState,u,f)},useTransition:function(){var u=a2(eu)[0],f=jr().memoizedState;return[typeof u=="boolean"?u:u0(u),f]},useSyncExternalStore:wU,useId:JU,useHostTransitionStatus:Uk,useFormState:DU,useActionState:DU,useOptimistic:function(u,f){var p=jr();return IU(p,En,u,f)},useMemoCache:Ik,useCacheRefresh:QU};Fk.useEffectEvent=$U;var rj={readContext:qi,use:o2,useCallback:KU,useContext:qi,useEffect:Ok,useImperativeHandle:VU,useInsertionEffect:BU,useLayoutEffect:HU,useMemo:GU,useReducer:Ak,useRef:jU,useState:function(){return Ak(eu)},useDebugValue:Pk,useDeferredValue:function(u,f){var p=jr();return En===null?Dk(p,u,f):zU(p,En.memoizedState,u,f)},useTransition:function(){var u=Ak(eu)[0],f=jr().memoizedState;return[typeof u=="boolean"?u:u0(u),f]},useSyncExternalStore:wU,useId:JU,useHostTransitionStatus:Uk,useFormState:UU,useActionState:UU,useOptimistic:function(u,f){var p=jr();return En!==null?IU(p,En,u,f):(p.baseState=u,[u,p.queue.dispatch])},useMemoCache:Ik,useCacheRefresh:QU};rj.useEffectEvent=$U;function $k(u,f,p,b){f=u.memoizedState,p=p(b,f),p=p==null?f:h({},f,p),u.memoizedState=p,u.lanes===0&&(u.updateQueue.baseState=p)}var Bk={enqueueSetState:function(u,f,p){u=u._reactInternals;var b=Do(),I=Ld(b);I.payload=f,p!=null&&(I.callback=p),f=Md(u,I,b),f!==null&&(Xs(f,u,b),o0(f,u,b))},enqueueReplaceState:function(u,f,p){u=u._reactInternals;var b=Do(),I=Ld(b);I.tag=1,I.payload=f,p!=null&&(I.callback=p),f=Md(u,I,b),f!==null&&(Xs(f,u,b),o0(f,u,b))},enqueueForceUpdate:function(u,f){u=u._reactInternals;var p=Do(),b=Ld(p);b.tag=2,f!=null&&(b.callback=f),f=Md(u,b,p),f!==null&&(Xs(f,u,p),o0(f,u,p))}};function ij(u,f,p,b,I,A,U){return u=u.stateNode,typeof u.shouldComponentUpdate=="function"?u.shouldComponentUpdate(b,A,U):f.prototype&&f.prototype.isPureReactComponent?!Qy(p,b)||!Qy(I,A):!0}function sj(u,f,p,b){u=f.state,typeof f.componentWillReceiveProps=="function"&&f.componentWillReceiveProps(p,b),typeof f.UNSAFE_componentWillReceiveProps=="function"&&f.UNSAFE_componentWillReceiveProps(p,b),f.state!==u&&Bk.enqueueReplaceState(f,f.state,null)}function Uh(u,f){var p=f;if("ref"in f){p={};for(var b in f)b!=="ref"&&(p[b]=f[b])}if(u=u.defaultProps){p===f&&(p=h({},p));for(var I in u)p[I]===void 0&&(p[I]=u[I])}return p}function oj(u){HS(u)}function aj(u){console.error(u)}function cj(u){HS(u)}function d2(u,f){try{var p=u.onUncaughtError;p(f.value,{componentStack:f.stack})}catch(b){setTimeout(function(){throw b})}}function lj(u,f,p){try{var b=u.onCaughtError;b(p.value,{componentStack:p.stack,errorBoundary:f.tag===1?f.stateNode:null})}catch(I){setTimeout(function(){throw I})}}function Hk(u,f,p){return p=Ld(p),p.tag=3,p.payload={element:null},p.callback=function(){d2(u,f)},p}function uj(u){return u=Ld(u),u.tag=3,u}function dj(u,f,p,b){var I=p.type.getDerivedStateFromError;if(typeof I=="function"){var A=b.value;u.payload=function(){return I(A)},u.callback=function(){lj(f,p,b)}}var U=p.stateNode;U!==null&&typeof U.componentDidCatch=="function"&&(u.callback=function(){lj(f,p,b),typeof I!="function"&&(jd===null?jd=new Set([this]):jd.add(this));var K=b.stack;this.componentDidCatch(b.value,{componentStack:K!==null?K:""})})}function Qme(u,f,p,b,I){if(p.flags|=32768,b!==null&&typeof b=="object"&&typeof b.then=="function"){if(f=p.alternate,f!==null&&Um(f,p,I,!0),p=Lo.current,p!==null){switch(p.tag){case 31:case 13:return va===null?E2():p.alternate===null&&Cr===0&&(Cr=3),p.flags&=-257,p.flags|=65536,p.lanes=I,b===QS?p.flags|=16384:(f=p.updateQueue,f===null?p.updateQueue=new Set([b]):f.add(b),hI(u,b,I)),!1;case 22:return p.flags|=65536,b===QS?p.flags|=16384:(f=p.updateQueue,f===null?(f={transitions:null,markerInstances:null,retryQueue:new Set([b])},p.updateQueue=f):(p=f.retryQueue,p===null?f.retryQueue=new Set([b]):p.add(b)),hI(u,b,I)),!1}throw Error(r(435,p.tag))}return hI(u,b,I),E2(),!1}if(zt)return f=Lo.current,f!==null?((f.flags&65536)===0&&(f.flags|=256),f.flags|=65536,f.lanes=I,b!==ak&&(u=Error(r(422),{cause:b}),t0(ha(u,p)))):(b!==ak&&(f=Error(r(423),{cause:b}),t0(ha(f,p))),u=u.current.alternate,u.flags|=65536,I&=-I,u.lanes|=I,b=ha(b,p),I=Hk(u.stateNode,b,I),yk(u,I),Cr!==4&&(Cr=2)),!1;var A=Error(r(520),{cause:b});if(A=ha(A,p),_0===null?_0=[A]:_0.push(A),Cr!==4&&(Cr=2),f===null)return!0;b=ha(b,p),p=f;do{switch(p.tag){case 3:return p.flags|=65536,u=I&-I,p.lanes|=u,u=Hk(p.stateNode,b,u),yk(p,u),!1;case 1:if(f=p.type,A=p.stateNode,(p.flags&128)===0&&(typeof f.getDerivedStateFromError=="function"||A!==null&&typeof A.componentDidCatch=="function"&&(jd===null||!jd.has(A))))return p.flags|=65536,I&=-I,p.lanes|=I,I=uj(I),dj(I,u,p,b),yk(p,I),!1}p=p.return}while(p!==null);return!1}var qk=Error(r(461)),Jr=!1;function Vi(u,f,p,b){f.child=u===null?mU(f,null,p,b):Dh(f,u.child,p,b)}function fj(u,f,p,b,I){p=p.render;var A=f.ref;if("ref"in b){var U={};for(var K in b)K!=="ref"&&(U[K]=b[K])}else U=b;return Lh(f),b=Ck(u,f,p,U,A,I),K=Tk(),u!==null&&!Jr?(Rk(u,f,I),tu(u,f,I)):(zt&&K&&sk(f),f.flags|=1,Vi(u,f,b,I),f.child)}function hj(u,f,p,b,I){if(u===null){var A=p.type;return typeof A=="function"&&!nk(A)&&A.defaultProps===void 0&&p.compare===null?(f.tag=15,f.type=A,pj(u,f,A,b,I)):(u=GS(p.type,null,b,f,f.mode,I),u.ref=f.ref,u.return=f,f.child=u)}if(A=u.child,!Jk(u,I)){var U=A.memoizedProps;if(p=p.compare,p=p!==null?p:Qy,p(U,b)&&u.ref===f.ref)return tu(u,f,I)}return f.flags|=1,u=Yl(A,b),u.ref=f.ref,u.return=f,f.child=u}function pj(u,f,p,b,I){if(u!==null){var A=u.memoizedProps;if(Qy(A,b)&&u.ref===f.ref)if(Jr=!1,f.pendingProps=b=A,Jk(u,I))(u.flags&131072)!==0&&(Jr=!0);else return f.lanes=u.lanes,tu(u,f,I)}return Vk(u,f,p,b,I)}function mj(u,f,p,b){var I=b.children,A=u!==null?u.memoizedState:null;if(u===null&&f.stateNode===null&&(f.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),b.mode==="hidden"){if((f.flags&128)!==0){if(A=A!==null?A.baseLanes|p:p,u!==null){for(b=f.child=u.child,I=0;b!==null;)I=I|b.lanes|b.childLanes,b=b.sibling;b=I&~A}else b=0,f.child=null;return gj(u,f,A,p,b)}if((p&536870912)!==0)f.memoizedState={baseLanes:0,cachePool:null},u!==null&&XS(f,A!==null?A.cachePool:null),A!==null?yU(f,A):_k(),bU(f);else return b=f.lanes=536870912,gj(u,f,A!==null?A.baseLanes|p:p,p,b)}else A!==null?(XS(f,A.cachePool),yU(f,A),Pd(),f.memoizedState=null):(u!==null&&XS(f,null),_k(),Pd());return Vi(u,f,I,p),f.child}function h0(u,f){return u!==null&&u.tag===22||f.stateNode!==null||(f.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),f.sibling}function gj(u,f,p,b,I){var A=pk();return A=A===null?null:{parent:Yr._currentValue,pool:A},f.memoizedState={baseLanes:p,cachePool:A},u!==null&&XS(f,null),_k(),bU(f),u!==null&&Um(u,f,b,!0),f.childLanes=I,null}function f2(u,f){return f=p2({mode:f.mode,children:f.children},u.mode),f.ref=u.ref,u.child=f,f.return=u,f}function vj(u,f,p){return Dh(f,u.child,null,p),u=f2(f,f.pendingProps),u.flags|=2,Mo(f),f.memoizedState=null,u}function Zme(u,f,p){var b=f.pendingProps,I=(f.flags&128)!==0;if(f.flags&=-129,u===null){if(zt){if(b.mode==="hidden")return u=f2(f,b),f.lanes=536870912,h0(null,u);if(wk(f),(u=Wn)?(u=xF(u,ga),u=u!==null&&u.data==="&"?u:null,u!==null&&(f.memoizedState={dehydrated:u,treeContext:Rd!==null?{id:Jc,overflow:Qc}:null,retryLane:536870912,hydrationErrors:null},p=eU(u),p.return=f,f.child=p,Hi=f,Wn=null)):u=null,u===null)throw Id(f);return f.lanes=536870912,null}return f2(f,b)}var A=u.memoizedState;if(A!==null){var U=A.dehydrated;if(wk(f),I)if(f.flags&256)f.flags&=-257,f=vj(u,f,p);else if(f.memoizedState!==null)f.child=u.child,f.flags|=128,f=null;else throw Error(r(558));else if(Jr||Um(u,f,p,!1),I=(p&u.childLanes)!==0,Jr||I){if(b=Ln,b!==null&&(U=Se(b,p),U!==0&&U!==A.retryLane))throw A.retryLane=U,kh(u,U),Xs(b,u,U),qk;E2(),f=vj(u,f,p)}else u=A.treeContext,Wn=ya(U.nextSibling),Hi=f,zt=!0,kd=null,ga=!1,u!==null&&rU(f,u),f=f2(f,b),f.flags|=4096;return f}return u=Yl(u.child,{mode:b.mode,children:b.children}),u.ref=f.ref,f.child=u,u.return=f,u}function h2(u,f){var p=f.ref;if(p===null)u!==null&&u.ref!==null&&(f.flags|=4194816);else{if(typeof p!="function"&&typeof p!="object")throw Error(r(284));(u===null||u.ref!==p)&&(f.flags|=4194816)}}function Vk(u,f,p,b,I){return Lh(f),p=Ck(u,f,p,b,void 0,I),b=Tk(),u!==null&&!Jr?(Rk(u,f,I),tu(u,f,I)):(zt&&b&&sk(f),f.flags|=1,Vi(u,f,p,I),f.child)}function yj(u,f,p,b,I,A){return Lh(f),f.updateQueue=null,p=SU(f,b,p,I),_U(u),b=Tk(),u!==null&&!Jr?(Rk(u,f,A),tu(u,f,A)):(zt&&b&&sk(f),f.flags|=1,Vi(u,f,p,A),f.child)}function bj(u,f,p,b,I){if(Lh(f),f.stateNode===null){var A=Om,U=p.contextType;typeof U=="object"&&U!==null&&(A=qi(U)),A=new p(b,A),f.memoizedState=A.state!==null&&A.state!==void 0?A.state:null,A.updater=Bk,f.stateNode=A,A._reactInternals=f,A=f.stateNode,A.props=b,A.state=f.memoizedState,A.refs={},gk(f),U=p.contextType,A.context=typeof U=="object"&&U!==null?qi(U):Om,A.state=f.memoizedState,U=p.getDerivedStateFromProps,typeof U=="function"&&($k(f,p,U,b),A.state=f.memoizedState),typeof p.getDerivedStateFromProps=="function"||typeof A.getSnapshotBeforeUpdate=="function"||typeof A.UNSAFE_componentWillMount!="function"&&typeof A.componentWillMount!="function"||(U=A.state,typeof A.componentWillMount=="function"&&A.componentWillMount(),typeof A.UNSAFE_componentWillMount=="function"&&A.UNSAFE_componentWillMount(),U!==A.state&&Bk.enqueueReplaceState(A,A.state,null),c0(f,b,A,I),a0(),A.state=f.memoizedState),typeof A.componentDidMount=="function"&&(f.flags|=4194308),b=!0}else if(u===null){A=f.stateNode;var K=f.memoizedProps,Q=Uh(p,K);A.props=Q;var se=A.context,ye=p.contextType;U=Om,typeof ye=="object"&&ye!==null&&(U=qi(ye));var Ee=p.getDerivedStateFromProps;ye=typeof Ee=="function"||typeof A.getSnapshotBeforeUpdate=="function",K=f.pendingProps!==K,ye||typeof A.UNSAFE_componentWillReceiveProps!="function"&&typeof A.componentWillReceiveProps!="function"||(K||se!==U)&&sj(f,A,b,U),Ad=!1;var le=f.memoizedState;A.state=le,c0(f,b,A,I),a0(),se=f.memoizedState,K||le!==se||Ad?(typeof Ee=="function"&&($k(f,p,Ee,b),se=f.memoizedState),(Q=Ad||ij(f,p,Q,b,le,se,U))?(ye||typeof A.UNSAFE_componentWillMount!="function"&&typeof A.componentWillMount!="function"||(typeof A.componentWillMount=="function"&&A.componentWillMount(),typeof A.UNSAFE_componentWillMount=="function"&&A.UNSAFE_componentWillMount()),typeof A.componentDidMount=="function"&&(f.flags|=4194308)):(typeof A.componentDidMount=="function"&&(f.flags|=4194308),f.memoizedProps=b,f.memoizedState=se),A.props=b,A.state=se,A.context=U,b=Q):(typeof A.componentDidMount=="function"&&(f.flags|=4194308),b=!1)}else{A=f.stateNode,vk(u,f),U=f.memoizedProps,ye=Uh(p,U),A.props=ye,Ee=f.pendingProps,le=A.context,se=p.contextType,Q=Om,typeof se=="object"&&se!==null&&(Q=qi(se)),K=p.getDerivedStateFromProps,(se=typeof K=="function"||typeof A.getSnapshotBeforeUpdate=="function")||typeof A.UNSAFE_componentWillReceiveProps!="function"&&typeof A.componentWillReceiveProps!="function"||(U!==Ee||le!==Q)&&sj(f,A,b,Q),Ad=!1,le=f.memoizedState,A.state=le,c0(f,b,A,I),a0();var me=f.memoizedState;U!==Ee||le!==me||Ad||u!==null&&u.dependencies!==null&&WS(u.dependencies)?(typeof K=="function"&&($k(f,p,K,b),me=f.memoizedState),(ye=Ad||ij(f,p,ye,b,le,me,Q)||u!==null&&u.dependencies!==null&&WS(u.dependencies))?(se||typeof A.UNSAFE_componentWillUpdate!="function"&&typeof A.componentWillUpdate!="function"||(typeof A.componentWillUpdate=="function"&&A.componentWillUpdate(b,me,Q),typeof A.UNSAFE_componentWillUpdate=="function"&&A.UNSAFE_componentWillUpdate(b,me,Q)),typeof A.componentDidUpdate=="function"&&(f.flags|=4),typeof A.getSnapshotBeforeUpdate=="function"&&(f.flags|=1024)):(typeof A.componentDidUpdate!="function"||U===u.memoizedProps&&le===u.memoizedState||(f.flags|=4),typeof A.getSnapshotBeforeUpdate!="function"||U===u.memoizedProps&&le===u.memoizedState||(f.flags|=1024),f.memoizedProps=b,f.memoizedState=me),A.props=b,A.state=me,A.context=Q,b=ye):(typeof A.componentDidUpdate!="function"||U===u.memoizedProps&&le===u.memoizedState||(f.flags|=4),typeof A.getSnapshotBeforeUpdate!="function"||U===u.memoizedProps&&le===u.memoizedState||(f.flags|=1024),b=!1)}return A=b,h2(u,f),b=(f.flags&128)!==0,A||b?(A=f.stateNode,p=b&&typeof p.getDerivedStateFromError!="function"?null:A.render(),f.flags|=1,u!==null&&b?(f.child=Dh(f,u.child,null,I),f.child=Dh(f,null,p,I)):Vi(u,f,p,I),f.memoizedState=A.state,u=f.child):u=tu(u,f,I),u}function _j(u,f,p,b){return xh(),f.flags|=256,Vi(u,f,p,b),f.child}var Kk={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Gk(u){return{baseLanes:u,cachePool:lU()}}function zk(u,f,p){return u=u!==null?u.childLanes&~p:0,f&&(u|=Po),u}function Sj(u,f,p){var b=f.pendingProps,I=!1,A=(f.flags&128)!==0,U;if((U=A)||(U=u!==null&&u.memoizedState===null?!1:(Ur.current&2)!==0),U&&(I=!0,f.flags&=-129),U=(f.flags&32)!==0,f.flags&=-33,u===null){if(zt){if(I?Od(f):Pd(),(u=Wn)?(u=xF(u,ga),u=u!==null&&u.data!=="&"?u:null,u!==null&&(f.memoizedState={dehydrated:u,treeContext:Rd!==null?{id:Jc,overflow:Qc}:null,retryLane:536870912,hydrationErrors:null},p=eU(u),p.return=f,f.child=p,Hi=f,Wn=null)):u=null,u===null)throw Id(f);return xI(u)?f.lanes=32:f.lanes=536870912,null}var K=b.children;return b=b.fallback,I?(Pd(),I=f.mode,K=p2({mode:"hidden",children:K},I),b=Ih(b,I,p,null),K.return=f,b.return=f,K.sibling=b,f.child=K,b=f.child,b.memoizedState=Gk(p),b.childLanes=zk(u,U,p),f.memoizedState=Kk,h0(null,b)):(Od(f),Wk(f,K))}var Q=u.memoizedState;if(Q!==null&&(K=Q.dehydrated,K!==null)){if(A)f.flags&256?(Od(f),f.flags&=-257,f=Yk(u,f,p)):f.memoizedState!==null?(Pd(),f.child=u.child,f.flags|=128,f=null):(Pd(),K=b.fallback,I=f.mode,b=p2({mode:"visible",children:b.children},I),K=Ih(K,I,p,null),K.flags|=2,b.return=f,K.return=f,b.sibling=K,f.child=b,Dh(f,u.child,null,p),b=f.child,b.memoizedState=Gk(p),b.childLanes=zk(u,U,p),f.memoizedState=Kk,f=h0(null,b));else if(Od(f),xI(K)){if(U=K.nextSibling&&K.nextSibling.dataset,U)var se=U.dgst;U=se,b=Error(r(419)),b.stack="",b.digest=U,t0({value:b,source:null,stack:null}),f=Yk(u,f,p)}else if(Jr||Um(u,f,p,!1),U=(p&u.childLanes)!==0,Jr||U){if(U=Ln,U!==null&&(b=Se(U,p),b!==0&&b!==Q.retryLane))throw Q.retryLane=b,kh(u,b),Xs(U,u,b),qk;II(K)||E2(),f=Yk(u,f,p)}else II(K)?(f.flags|=192,f.child=u.child,f=null):(u=Q.treeContext,Wn=ya(K.nextSibling),Hi=f,zt=!0,kd=null,ga=!1,u!==null&&rU(f,u),f=Wk(f,b.children),f.flags|=4096);return f}return I?(Pd(),K=b.fallback,I=f.mode,Q=u.child,se=Q.sibling,b=Yl(Q,{mode:"hidden",children:b.children}),b.subtreeFlags=Q.subtreeFlags&65011712,se!==null?K=Yl(se,K):(K=Ih(K,I,p,null),K.flags|=2),K.return=f,b.return=f,b.sibling=K,f.child=b,h0(null,b),b=f.child,K=u.child.memoizedState,K===null?K=Gk(p):(I=K.cachePool,I!==null?(Q=Yr._currentValue,I=I.parent!==Q?{parent:Q,pool:Q}:I):I=lU(),K={baseLanes:K.baseLanes|p,cachePool:I}),b.memoizedState=K,b.childLanes=zk(u,U,p),f.memoizedState=Kk,h0(u.child,b)):(Od(f),p=u.child,u=p.sibling,p=Yl(p,{mode:"visible",children:b.children}),p.return=f,p.sibling=null,u!==null&&(U=f.deletions,U===null?(f.deletions=[u],f.flags|=16):U.push(u)),f.child=p,f.memoizedState=null,p)}function Wk(u,f){return f=p2({mode:"visible",children:f},u.mode),f.return=u,u.child=f}function p2(u,f){return u=Ao(22,u,null,f),u.lanes=0,u}function Yk(u,f,p){return Dh(f,u.child,null,p),u=Wk(f,f.pendingProps.children),u.flags|=2,f.memoizedState=null,u}function wj(u,f,p){u.lanes|=f;var b=u.alternate;b!==null&&(b.lanes|=f),uk(u.return,f,p)}function Xk(u,f,p,b,I,A){var U=u.memoizedState;U===null?u.memoizedState={isBackwards:f,rendering:null,renderingStartTime:0,last:b,tail:p,tailMode:I,treeForkCount:A}:(U.isBackwards=f,U.rendering=null,U.renderingStartTime=0,U.last=b,U.tail=p,U.tailMode=I,U.treeForkCount=A)}function Ej(u,f,p){var b=f.pendingProps,I=b.revealOrder,A=b.tail;b=b.children;var U=Ur.current,K=(U&2)!==0;if(K?(U=U&1|2,f.flags|=128):U&=1,ue(Ur,U),Vi(u,f,b,p),b=zt?e0:0,!K&&u!==null&&(u.flags&128)!==0)e:for(u=f.child;u!==null;){if(u.tag===13)u.memoizedState!==null&&wj(u,p,f);else if(u.tag===19)wj(u,p,f);else if(u.child!==null){u.child.return=u,u=u.child;continue}if(u===f)break e;for(;u.sibling===null;){if(u.return===null||u.return===f)break e;u=u.return}u.sibling.return=u.return,u=u.sibling}switch(I){case"forwards":for(p=f.child,I=null;p!==null;)u=p.alternate,u!==null&&n2(u)===null&&(I=p),p=p.sibling;p=I,p===null?(I=f.child,f.child=null):(I=p.sibling,p.sibling=null),Xk(f,!1,I,p,A,b);break;case"backwards":case"unstable_legacy-backwards":for(p=null,I=f.child,f.child=null;I!==null;){if(u=I.alternate,u!==null&&n2(u)===null){f.child=I;break}u=I.sibling,I.sibling=p,p=I,I=u}Xk(f,!0,p,null,A,b);break;case"together":Xk(f,!1,null,null,void 0,b);break;default:f.memoizedState=null}return f.child}function tu(u,f,p){if(u!==null&&(f.dependencies=u.dependencies),Ud|=f.lanes,(p&f.childLanes)===0)if(u!==null){if(Um(u,f,p,!1),(p&f.childLanes)===0)return null}else return null;if(u!==null&&f.child!==u.child)throw Error(r(153));if(f.child!==null){for(u=f.child,p=Yl(u,u.pendingProps),f.child=p,p.return=f;u.sibling!==null;)u=u.sibling,p=p.sibling=Yl(u,u.pendingProps),p.return=f;p.sibling=null}return f.child}function Jk(u,f){return(u.lanes&f)!==0?!0:(u=u.dependencies,!!(u!==null&&WS(u)))}function ege(u,f,p){switch(f.tag){case 3:ke(f,f.stateNode.containerInfo),xd(f,Yr,u.memoizedState.cache),xh();break;case 27:case 5:Je(f);break;case 4:ke(f,f.stateNode.containerInfo);break;case 10:xd(f,f.type,f.memoizedProps.value);break;case 31:if(f.memoizedState!==null)return f.flags|=128,wk(f),null;break;case 13:var b=f.memoizedState;if(b!==null)return b.dehydrated!==null?(Od(f),f.flags|=128,null):(p&f.child.childLanes)!==0?Sj(u,f,p):(Od(f),u=tu(u,f,p),u!==null?u.sibling:null);Od(f);break;case 19:var I=(u.flags&128)!==0;if(b=(p&f.childLanes)!==0,b||(Um(u,f,p,!1),b=(p&f.childLanes)!==0),I){if(b)return Ej(u,f,p);f.flags|=128}if(I=f.memoizedState,I!==null&&(I.rendering=null,I.tail=null,I.lastEffect=null),ue(Ur,Ur.current),b)break;return null;case 22:return f.lanes=0,mj(u,f,p,f.pendingProps);case 24:xd(f,Yr,u.memoizedState.cache)}return tu(u,f,p)}function Cj(u,f,p){if(u!==null)if(u.memoizedProps!==f.pendingProps)Jr=!0;else{if(!Jk(u,p)&&(f.flags&128)===0)return Jr=!1,ege(u,f,p);Jr=(u.flags&131072)!==0}else Jr=!1,zt&&(f.flags&1048576)!==0&&nU(f,e0,f.index);switch(f.lanes=0,f.tag){case 16:e:{var b=f.pendingProps;if(u=Oh(f.elementType),f.type=u,typeof u=="function")nk(u)?(b=Uh(u,b),f.tag=1,f=bj(null,f,u,b,p)):(f.tag=0,f=Vk(null,f,u,b,p));else{if(u!=null){var I=u.$$typeof;if(I===C){f.tag=11,f=fj(null,f,u,b,p);break e}else if(I===L){f.tag=14,f=hj(null,f,u,b,p);break e}}throw f=Y(u)||u,Error(r(306,f,""))}}return f;case 0:return Vk(u,f,f.type,f.pendingProps,p);case 1:return b=f.type,I=Uh(b,f.pendingProps),bj(u,f,b,I,p);case 3:e:{if(ke(f,f.stateNode.containerInfo),u===null)throw Error(r(387));b=f.pendingProps;var A=f.memoizedState;I=A.element,vk(u,f),c0(f,b,null,p);var U=f.memoizedState;if(b=U.cache,xd(f,Yr,b),b!==A.cache&&dk(f,[Yr],p,!0),a0(),b=U.element,A.isDehydrated)if(A={element:b,isDehydrated:!1,cache:U.cache},f.updateQueue.baseState=A,f.memoizedState=A,f.flags&256){f=_j(u,f,b,p);break e}else if(b!==I){I=ha(Error(r(424)),f),t0(I),f=_j(u,f,b,p);break e}else for(u=f.stateNode.containerInfo,u.nodeType===9?u=u.body:u=u.nodeName==="HTML"?u.ownerDocument.body:u,Wn=ya(u.firstChild),Hi=f,zt=!0,kd=null,ga=!0,p=mU(f,null,b,p),f.child=p;p;)p.flags=p.flags&-3|4096,p=p.sibling;else{if(xh(),b===I){f=tu(u,f,p);break e}Vi(u,f,b,p)}f=f.child}return f;case 26:return h2(u,f),u===null?(p=DF(f.type,null,f.pendingProps,null))?f.memoizedState=p:zt||(p=f.type,u=f.pendingProps,b=A2(we.current).createElement(p),b[Nr]=f,b[ir]=u,Ki(b,p,u),Ti(b),f.stateNode=b):f.memoizedState=DF(f.type,u.memoizedProps,f.pendingProps,u.memoizedState),null;case 27:return Je(f),u===null&&zt&&(b=f.stateNode=MF(f.type,f.pendingProps,we.current),Hi=f,ga=!0,I=Wn,Hd(f.type)?(AI=I,Wn=ya(b.firstChild)):Wn=I),Vi(u,f,f.pendingProps.children,p),h2(u,f),u===null&&(f.flags|=4194304),f.child;case 5:return u===null&&zt&&((I=b=Wn)&&(b=Age(b,f.type,f.pendingProps,ga),b!==null?(f.stateNode=b,Hi=f,Wn=ya(b.firstChild),ga=!1,I=!0):I=!1),I||Id(f)),Je(f),I=f.type,A=f.pendingProps,U=u!==null?u.memoizedProps:null,b=A.children,TI(I,A)?b=null:U!==null&&TI(I,U)&&(f.flags|=32),f.memoizedState!==null&&(I=Ck(u,f,Kme,null,null,p),I0._currentValue=I),h2(u,f),Vi(u,f,b,p),f.child;case 6:return u===null&&zt&&((u=p=Wn)&&(p=Lge(p,f.pendingProps,ga),p!==null?(f.stateNode=p,Hi=f,Wn=null,u=!0):u=!1),u||Id(f)),null;case 13:return Sj(u,f,p);case 4:return ke(f,f.stateNode.containerInfo),b=f.pendingProps,u===null?f.child=Dh(f,null,b,p):Vi(u,f,b,p),f.child;case 11:return fj(u,f,f.type,f.pendingProps,p);case 7:return Vi(u,f,f.pendingProps,p),f.child;case 8:return Vi(u,f,f.pendingProps.children,p),f.child;case 12:return Vi(u,f,f.pendingProps.children,p),f.child;case 10:return b=f.pendingProps,xd(f,f.type,b.value),Vi(u,f,b.children,p),f.child;case 9:return I=f.type._context,b=f.pendingProps.children,Lh(f),I=qi(I),b=b(I),f.flags|=1,Vi(u,f,b,p),f.child;case 14:return hj(u,f,f.type,f.pendingProps,p);case 15:return pj(u,f,f.type,f.pendingProps,p);case 19:return Ej(u,f,p);case 31:return Zme(u,f,p);case 22:return mj(u,f,p,f.pendingProps);case 24:return Lh(f),b=qi(Yr),u===null?(I=pk(),I===null&&(I=Ln,A=fk(),I.pooledCache=A,A.refCount++,A!==null&&(I.pooledCacheLanes|=p),I=A),f.memoizedState={parent:b,cache:I},gk(f),xd(f,Yr,I)):((u.lanes&p)!==0&&(vk(u,f),c0(f,null,null,p),a0()),I=u.memoizedState,A=f.memoizedState,I.parent!==b?(I={parent:b,cache:b},f.memoizedState=I,f.lanes===0&&(f.memoizedState=f.updateQueue.baseState=I),xd(f,Yr,b)):(b=A.cache,xd(f,Yr,b),b!==I.cache&&dk(f,[Yr],p,!0))),Vi(u,f,f.pendingProps.children,p),f.child;case 29:throw f.pendingProps}throw Error(r(156,f.tag))}function nu(u){u.flags|=4}function Qk(u,f,p,b,I){if((f=(u.mode&32)!==0)&&(f=!1),f){if(u.flags|=16777216,(I&335544128)===I)if(u.stateNode.complete)u.flags|=8192;else if(Jj())u.flags|=8192;else throw Ph=QS,mk}else u.flags&=-16777217}function Tj(u,f){if(f.type!=="stylesheet"||(f.state.loading&4)!==0)u.flags&=-16777217;else if(u.flags|=16777216,!$F(f))if(Jj())u.flags|=8192;else throw Ph=QS,mk}function m2(u,f){f!==null&&(u.flags|=4),u.flags&16384&&(f=u.tag!==22?zr():536870912,u.lanes|=f,Ym|=f)}function p0(u,f){if(!zt)switch(u.tailMode){case"hidden":f=u.tail;for(var p=null;f!==null;)f.alternate!==null&&(p=f),f=f.sibling;p===null?u.tail=null:p.sibling=null;break;case"collapsed":p=u.tail;for(var b=null;p!==null;)p.alternate!==null&&(b=p),p=p.sibling;b===null?f||u.tail===null?u.tail=null:u.tail.sibling=null:b.sibling=null}}function Yn(u){var f=u.alternate!==null&&u.alternate.child===u.child,p=0,b=0;if(f)for(var I=u.child;I!==null;)p|=I.lanes|I.childLanes,b|=I.subtreeFlags&65011712,b|=I.flags&65011712,I.return=u,I=I.sibling;else for(I=u.child;I!==null;)p|=I.lanes|I.childLanes,b|=I.subtreeFlags,b|=I.flags,I.return=u,I=I.sibling;return u.subtreeFlags|=b,u.childLanes=p,f}function tge(u,f,p){var b=f.pendingProps;switch(ok(f),f.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Yn(f),null;case 1:return Yn(f),null;case 3:return p=f.stateNode,b=null,u!==null&&(b=u.memoizedState.cache),f.memoizedState.cache!==b&&(f.flags|=2048),Ql(Yr),De(),p.pendingContext&&(p.context=p.pendingContext,p.pendingContext=null),(u===null||u.child===null)&&(Nm(f)?nu(f):u===null||u.memoizedState.isDehydrated&&(f.flags&256)===0||(f.flags|=1024,ck())),Yn(f),null;case 26:var I=f.type,A=f.memoizedState;return u===null?(nu(f),A!==null?(Yn(f),Tj(f,A)):(Yn(f),Qk(f,I,null,b,p))):A?A!==u.memoizedState?(nu(f),Yn(f),Tj(f,A)):(Yn(f),f.flags&=-16777217):(u=u.memoizedProps,u!==b&&nu(f),Yn(f),Qk(f,I,u,b,p)),null;case 27:if(vt(f),p=we.current,I=f.type,u!==null&&f.stateNode!=null)u.memoizedProps!==b&&nu(f);else{if(!b){if(f.stateNode===null)throw Error(r(166));return Yn(f),null}u=ge.current,Nm(f)?iU(f):(u=MF(I,b,p),f.stateNode=u,nu(f))}return Yn(f),null;case 5:if(vt(f),I=f.type,u!==null&&f.stateNode!=null)u.memoizedProps!==b&&nu(f);else{if(!b){if(f.stateNode===null)throw Error(r(166));return Yn(f),null}if(A=ge.current,Nm(f))iU(f);else{var U=A2(we.current);switch(A){case 1:A=U.createElementNS("http://www.w3.org/2000/svg",I);break;case 2:A=U.createElementNS("http://www.w3.org/1998/Math/MathML",I);break;default:switch(I){case"svg":A=U.createElementNS("http://www.w3.org/2000/svg",I);break;case"math":A=U.createElementNS("http://www.w3.org/1998/Math/MathML",I);break;case"script":A=U.createElement("div"),A.innerHTML="<script><\/script>",A=A.removeChild(A.firstChild);break;case"select":A=typeof b.is=="string"?U.createElement("select",{is:b.is}):U.createElement("select"),b.multiple?A.multiple=!0:b.size&&(A.size=b.size);break;default:A=typeof b.is=="string"?U.createElement(I,{is:b.is}):U.createElement(I)}}A[Nr]=f,A[ir]=b;e:for(U=f.child;U!==null;){if(U.tag===5||U.tag===6)A.appendChild(U.stateNode);else if(U.tag!==4&&U.tag!==27&&U.child!==null){U.child.return=U,U=U.child;continue}if(U===f)break e;for(;U.sibling===null;){if(U.return===null||U.return===f)break e;U=U.return}U.sibling.return=U.return,U=U.sibling}f.stateNode=A;e:switch(Ki(A,I,b),I){case"button":case"input":case"select":case"textarea":b=!!b.autoFocus;break e;case"img":b=!0;break e;default:b=!1}b&&nu(f)}}return Yn(f),Qk(f,f.type,u===null?null:u.memoizedProps,f.pendingProps,p),null;case 6:if(u&&f.stateNode!=null)u.memoizedProps!==b&&nu(f);else{if(typeof b!="string"&&f.stateNode===null)throw Error(r(166));if(u=we.current,Nm(f)){if(u=f.stateNode,p=f.memoizedProps,b=null,I=Hi,I!==null)switch(I.tag){case 27:case 5:b=I.memoizedProps}u[Nr]=f,u=!!(u.nodeValue===p||b!==null&&b.suppressHydrationWarning===!0||SF(u.nodeValue,p)),u||Id(f,!0)}else u=A2(u).createTextNode(b),u[Nr]=f,f.stateNode=u}return Yn(f),null;case 31:if(p=f.memoizedState,u===null||u.memoizedState!==null){if(b=Nm(f),p!==null){if(u===null){if(!b)throw Error(r(318));if(u=f.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(r(557));u[Nr]=f}else xh(),(f.flags&128)===0&&(f.memoizedState=null),f.flags|=4;Yn(f),u=!1}else p=ck(),u!==null&&u.memoizedState!==null&&(u.memoizedState.hydrationErrors=p),u=!0;if(!u)return f.flags&256?(Mo(f),f):(Mo(f),null);if((f.flags&128)!==0)throw Error(r(558))}return Yn(f),null;case 13:if(b=f.memoizedState,u===null||u.memoizedState!==null&&u.memoizedState.dehydrated!==null){if(I=Nm(f),b!==null&&b.dehydrated!==null){if(u===null){if(!I)throw Error(r(318));if(I=f.memoizedState,I=I!==null?I.dehydrated:null,!I)throw Error(r(317));I[Nr]=f}else xh(),(f.flags&128)===0&&(f.memoizedState=null),f.flags|=4;Yn(f),I=!1}else I=ck(),u!==null&&u.memoizedState!==null&&(u.memoizedState.hydrationErrors=I),I=!0;if(!I)return f.flags&256?(Mo(f),f):(Mo(f),null)}return Mo(f),(f.flags&128)!==0?(f.lanes=p,f):(p=b!==null,u=u!==null&&u.memoizedState!==null,p&&(b=f.child,I=null,b.alternate!==null&&b.alternate.memoizedState!==null&&b.alternate.memoizedState.cachePool!==null&&(I=b.alternate.memoizedState.cachePool.pool),A=null,b.memoizedState!==null&&b.memoizedState.cachePool!==null&&(A=b.memoizedState.cachePool.pool),A!==I&&(b.flags|=2048)),p!==u&&p&&(f.child.flags|=8192),m2(f,f.updateQueue),Yn(f),null);case 4:return De(),u===null&&_I(f.stateNode.containerInfo),Yn(f),null;case 10:return Ql(f.type),Yn(f),null;case 19:if(J(Ur),b=f.memoizedState,b===null)return Yn(f),null;if(I=(f.flags&128)!==0,A=b.rendering,A===null)if(I)p0(b,!1);else{if(Cr!==0||u!==null&&(u.flags&128)!==0)for(u=f.child;u!==null;){if(A=n2(u),A!==null){for(f.flags|=128,p0(b,!1),u=A.updateQueue,f.updateQueue=u,m2(f,u),f.subtreeFlags=0,u=p,p=f.child;p!==null;)ZN(p,u),p=p.sibling;return ue(Ur,Ur.current&1|2),zt&&Xl(f,b.treeForkCount),f.child}u=u.sibling}b.tail!==null&&wr()>_2&&(f.flags|=128,I=!0,p0(b,!1),f.lanes=4194304)}else{if(!I)if(u=n2(A),u!==null){if(f.flags|=128,I=!0,u=u.updateQueue,f.updateQueue=u,m2(f,u),p0(b,!0),b.tail===null&&b.tailMode==="hidden"&&!A.alternate&&!zt)return Yn(f),null}else 2*wr()-b.renderingStartTime>_2&&p!==536870912&&(f.flags|=128,I=!0,p0(b,!1),f.lanes=4194304);b.isBackwards?(A.sibling=f.child,f.child=A):(u=b.last,u!==null?u.sibling=A:f.child=A,b.last=A)}return b.tail!==null?(u=b.tail,b.rendering=u,b.tail=u.sibling,b.renderingStartTime=wr(),u.sibling=null,p=Ur.current,ue(Ur,I?p&1|2:p&1),zt&&Xl(f,b.treeForkCount),u):(Yn(f),null);case 22:case 23:return Mo(f),Sk(),b=f.memoizedState!==null,u!==null?u.memoizedState!==null!==b&&(f.flags|=8192):b&&(f.flags|=8192),b?(p&536870912)!==0&&(f.flags&128)===0&&(Yn(f),f.subtreeFlags&6&&(f.flags|=8192)):Yn(f),p=f.updateQueue,p!==null&&m2(f,p.retryQueue),p=null,u!==null&&u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(p=u.memoizedState.cachePool.pool),b=null,f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(b=f.memoizedState.cachePool.pool),b!==p&&(f.flags|=2048),u!==null&&J(Mh),null;case 24:return p=null,u!==null&&(p=u.memoizedState.cache),f.memoizedState.cache!==p&&(f.flags|=2048),Ql(Yr),Yn(f),null;case 25:return null;case 30:return null}throw Error(r(156,f.tag))}function nge(u,f){switch(ok(f),f.tag){case 1:return u=f.flags,u&65536?(f.flags=u&-65537|128,f):null;case 3:return Ql(Yr),De(),u=f.flags,(u&65536)!==0&&(u&128)===0?(f.flags=u&-65537|128,f):null;case 26:case 27:case 5:return vt(f),null;case 31:if(f.memoizedState!==null){if(Mo(f),f.alternate===null)throw Error(r(340));xh()}return u=f.flags,u&65536?(f.flags=u&-65537|128,f):null;case 13:if(Mo(f),u=f.memoizedState,u!==null&&u.dehydrated!==null){if(f.alternate===null)throw Error(r(340));xh()}return u=f.flags,u&65536?(f.flags=u&-65537|128,f):null;case 19:return J(Ur),null;case 4:return De(),null;case 10:return Ql(f.type),null;case 22:case 23:return Mo(f),Sk(),u!==null&&J(Mh),u=f.flags,u&65536?(f.flags=u&-65537|128,f):null;case 24:return Ql(Yr),null;case 25:return null;default:return null}}function Rj(u,f){switch(ok(f),f.tag){case 3:Ql(Yr),De();break;case 26:case 27:case 5:vt(f);break;case 4:De();break;case 31:f.memoizedState!==null&&Mo(f);break;case 13:Mo(f);break;case 19:J(Ur);break;case 10:Ql(f.type);break;case 22:case 23:Mo(f),Sk(),u!==null&&J(Mh);break;case 24:Ql(Yr)}}function m0(u,f){try{var p=f.updateQueue,b=p!==null?p.lastEffect:null;if(b!==null){var I=b.next;p=I;do{if((p.tag&u)===u){b=void 0;var A=p.create,U=p.inst;b=A(),U.destroy=b}p=p.next}while(p!==I)}}catch(K){Sn(f,f.return,K)}}function Dd(u,f,p){try{var b=f.updateQueue,I=b!==null?b.lastEffect:null;if(I!==null){var A=I.next;b=A;do{if((b.tag&u)===u){var U=b.inst,K=U.destroy;if(K!==void 0){U.destroy=void 0,I=f;var Q=p,se=K;try{se()}catch(ye){Sn(I,Q,ye)}}}b=b.next}while(b!==A)}}catch(ye){Sn(f,f.return,ye)}}function kj(u){var f=u.updateQueue;if(f!==null){var p=u.stateNode;try{vU(f,p)}catch(b){Sn(u,u.return,b)}}}function Ij(u,f,p){p.props=Uh(u.type,u.memoizedProps),p.state=u.memoizedState;try{p.componentWillUnmount()}catch(b){Sn(u,f,b)}}function g0(u,f){try{var p=u.ref;if(p!==null){switch(u.tag){case 26:case 27:case 5:var b=u.stateNode;break;case 30:b=u.stateNode;break;default:b=u.stateNode}typeof p=="function"?u.refCleanup=p(b):p.current=b}}catch(I){Sn(u,f,I)}}function Zc(u,f){var p=u.ref,b=u.refCleanup;if(p!==null)if(typeof b=="function")try{b()}catch(I){Sn(u,f,I)}finally{u.refCleanup=null,u=u.alternate,u!=null&&(u.refCleanup=null)}else if(typeof p=="function")try{p(null)}catch(I){Sn(u,f,I)}else p.current=null}function xj(u){var f=u.type,p=u.memoizedProps,b=u.stateNode;try{e:switch(f){case"button":case"input":case"select":case"textarea":p.autoFocus&&b.focus();break e;case"img":p.src?b.src=p.src:p.srcSet&&(b.srcset=p.srcSet)}}catch(I){Sn(u,u.return,I)}}function Zk(u,f,p){try{var b=u.stateNode;Cge(b,u.type,p,f),b[ir]=f}catch(I){Sn(u,u.return,I)}}function Aj(u){return u.tag===5||u.tag===3||u.tag===26||u.tag===27&&Hd(u.type)||u.tag===4}function eI(u){e:for(;;){for(;u.sibling===null;){if(u.return===null||Aj(u.return))return null;u=u.return}for(u.sibling.return=u.return,u=u.sibling;u.tag!==5&&u.tag!==6&&u.tag!==18;){if(u.tag===27&&Hd(u.type)||u.flags&2||u.child===null||u.tag===4)continue e;u.child.return=u,u=u.child}if(!(u.flags&2))return u.stateNode}}function tI(u,f,p){var b=u.tag;if(b===5||b===6)u=u.stateNode,f?(p.nodeType===9?p.body:p.nodeName==="HTML"?p.ownerDocument.body:p).insertBefore(u,f):(f=p.nodeType===9?p.body:p.nodeName==="HTML"?p.ownerDocument.body:p,f.appendChild(u),p=p._reactRootContainer,p!=null||f.onclick!==null||(f.onclick=zl));else if(b!==4&&(b===27&&Hd(u.type)&&(p=u.stateNode,f=null),u=u.child,u!==null))for(tI(u,f,p),u=u.sibling;u!==null;)tI(u,f,p),u=u.sibling}function g2(u,f,p){var b=u.tag;if(b===5||b===6)u=u.stateNode,f?p.insertBefore(u,f):p.appendChild(u);else if(b!==4&&(b===27&&Hd(u.type)&&(p=u.stateNode),u=u.child,u!==null))for(g2(u,f,p),u=u.sibling;u!==null;)g2(u,f,p),u=u.sibling}function Lj(u){var f=u.stateNode,p=u.memoizedProps;try{for(var b=u.type,I=f.attributes;I.length;)f.removeAttributeNode(I[0]);Ki(f,b,p),f[Nr]=u,f[ir]=p}catch(A){Sn(u,u.return,A)}}var ru=!1,Qr=!1,nI=!1,Mj=typeof WeakSet=="function"?WeakSet:Set,Ri=null;function rge(u,f){if(u=u.containerInfo,EI=U2,u=VN(u),Y4(u)){if("selectionStart"in u)var p={start:u.selectionStart,end:u.selectionEnd};else e:{p=(p=u.ownerDocument)&&p.defaultView||window;var b=p.getSelection&&p.getSelection();if(b&&b.rangeCount!==0){p=b.anchorNode;var I=b.anchorOffset,A=b.focusNode;b=b.focusOffset;try{p.nodeType,A.nodeType}catch{p=null;break e}var U=0,K=-1,Q=-1,se=0,ye=0,Ee=u,le=null;t:for(;;){for(var me;Ee!==p||I!==0&&Ee.nodeType!==3||(K=U+I),Ee!==A||b!==0&&Ee.nodeType!==3||(Q=U+b),Ee.nodeType===3&&(U+=Ee.nodeValue.length),(me=Ee.firstChild)!==null;)le=Ee,Ee=me;for(;;){if(Ee===u)break t;if(le===p&&++se===I&&(K=U),le===A&&++ye===b&&(Q=U),(me=Ee.nextSibling)!==null)break;Ee=le,le=Ee.parentNode}Ee=me}p=K===-1||Q===-1?null:{start:K,end:Q}}else p=null}p=p||{start:0,end:0}}else p=null;for(CI={focusedElem:u,selectionRange:p},U2=!1,Ri=f;Ri!==null;)if(f=Ri,u=f.child,(f.subtreeFlags&1028)!==0&&u!==null)u.return=f,Ri=u;else for(;Ri!==null;){switch(f=Ri,A=f.alternate,u=f.flags,f.tag){case 0:if((u&4)!==0&&(u=f.updateQueue,u=u!==null?u.events:null,u!==null))for(p=0;p<u.length;p++)I=u[p],I.ref.impl=I.nextImpl;break;case 11:case 15:break;case 1:if((u&1024)!==0&&A!==null){u=void 0,p=f,I=A.memoizedProps,A=A.memoizedState,b=p.stateNode;try{var qe=Uh(p.type,I);u=b.getSnapshotBeforeUpdate(qe,A),b.__reactInternalSnapshotBeforeUpdate=u}catch(ct){Sn(p,p.return,ct)}}break;case 3:if((u&1024)!==0){if(u=f.stateNode.containerInfo,p=u.nodeType,p===9)kI(u);else if(p===1)switch(u.nodeName){case"HEAD":case"HTML":case"BODY":kI(u);break;default:u.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((u&1024)!==0)throw Error(r(163))}if(u=f.sibling,u!==null){u.return=f.return,Ri=u;break}Ri=f.return}}function Oj(u,f,p){var b=p.flags;switch(p.tag){case 0:case 11:case 15:su(u,p),b&4&&m0(5,p);break;case 1:if(su(u,p),b&4)if(u=p.stateNode,f===null)try{u.componentDidMount()}catch(U){Sn(p,p.return,U)}else{var I=Uh(p.type,f.memoizedProps);f=f.memoizedState;try{u.componentDidUpdate(I,f,u.__reactInternalSnapshotBeforeUpdate)}catch(U){Sn(p,p.return,U)}}b&64&&kj(p),b&512&&g0(p,p.return);break;case 3:if(su(u,p),b&64&&(u=p.updateQueue,u!==null)){if(f=null,p.child!==null)switch(p.child.tag){case 27:case 5:f=p.child.stateNode;break;case 1:f=p.child.stateNode}try{vU(u,f)}catch(U){Sn(p,p.return,U)}}break;case 27:f===null&&b&4&&Lj(p);case 26:case 5:su(u,p),f===null&&b&4&&xj(p),b&512&&g0(p,p.return);break;case 12:su(u,p);break;case 31:su(u,p),b&4&&Nj(u,p);break;case 13:su(u,p),b&4&&Uj(u,p),b&64&&(u=p.memoizedState,u!==null&&(u=u.dehydrated,u!==null&&(p=fge.bind(null,p),Mge(u,p))));break;case 22:if(b=p.memoizedState!==null||ru,!b){f=f!==null&&f.memoizedState!==null||Qr,I=ru;var A=Qr;ru=b,(Qr=f)&&!A?ou(u,p,(p.subtreeFlags&8772)!==0):su(u,p),ru=I,Qr=A}break;case 30:break;default:su(u,p)}}function Pj(u){var f=u.alternate;f!==null&&(u.alternate=null,Pj(f)),u.child=null,u.deletions=null,u.sibling=null,u.tag===5&&(f=u.stateNode,f!==null&&wh(f)),u.stateNode=null,u.return=null,u.dependencies=null,u.memoizedProps=null,u.memoizedState=null,u.pendingProps=null,u.stateNode=null,u.updateQueue=null}var sr=null,Gs=!1;function iu(u,f,p){for(p=p.child;p!==null;)Dj(u,f,p),p=p.sibling}function Dj(u,f,p){if(Gr&&typeof Gr.onCommitFiberUnmount=="function")try{Gr.onCommitFiberUnmount(Ei,p)}catch{}switch(p.tag){case 26:Qr||Zc(p,f),iu(u,f,p),p.memoizedState?p.memoizedState.count--:p.stateNode&&(p=p.stateNode,p.parentNode.removeChild(p));break;case 27:Qr||Zc(p,f);var b=sr,I=Gs;Hd(p.type)&&(sr=p.stateNode,Gs=!1),iu(u,f,p),T0(p.stateNode),sr=b,Gs=I;break;case 5:Qr||Zc(p,f);case 6:if(b=sr,I=Gs,sr=null,iu(u,f,p),sr=b,Gs=I,sr!==null)if(Gs)try{(sr.nodeType===9?sr.body:sr.nodeName==="HTML"?sr.ownerDocument.body:sr).removeChild(p.stateNode)}catch(A){Sn(p,f,A)}else try{sr.removeChild(p.stateNode)}catch(A){Sn(p,f,A)}break;case 18:sr!==null&&(Gs?(u=sr,kF(u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u,p.stateNode),rg(u)):kF(sr,p.stateNode));break;case 4:b=sr,I=Gs,sr=p.stateNode.containerInfo,Gs=!0,iu(u,f,p),sr=b,Gs=I;break;case 0:case 11:case 14:case 15:Dd(2,p,f),Qr||Dd(4,p,f),iu(u,f,p);break;case 1:Qr||(Zc(p,f),b=p.stateNode,typeof b.componentWillUnmount=="function"&&Ij(p,f,b)),iu(u,f,p);break;case 21:iu(u,f,p);break;case 22:Qr=(b=Qr)||p.memoizedState!==null,iu(u,f,p),Qr=b;break;default:iu(u,f,p)}}function Nj(u,f){if(f.memoizedState===null&&(u=f.alternate,u!==null&&(u=u.memoizedState,u!==null))){u=u.dehydrated;try{rg(u)}catch(p){Sn(f,f.return,p)}}}function Uj(u,f){if(f.memoizedState===null&&(u=f.alternate,u!==null&&(u=u.memoizedState,u!==null&&(u=u.dehydrated,u!==null))))try{rg(u)}catch(p){Sn(f,f.return,p)}}function ige(u){switch(u.tag){case 31:case 13:case 19:var f=u.stateNode;return f===null&&(f=u.stateNode=new Mj),f;case 22:return u=u.stateNode,f=u._retryCache,f===null&&(f=u._retryCache=new Mj),f;default:throw Error(r(435,u.tag))}}function v2(u,f){var p=ige(u);f.forEach(function(b){if(!p.has(b)){p.add(b);var I=hge.bind(null,u,b);b.then(I,I)}})}function zs(u,f){var p=f.deletions;if(p!==null)for(var b=0;b<p.length;b++){var I=p[b],A=u,U=f,K=U;e:for(;K!==null;){switch(K.tag){case 27:if(Hd(K.type)){sr=K.stateNode,Gs=!1;break e}break;case 5:sr=K.stateNode,Gs=!1;break e;case 3:case 4:sr=K.stateNode.containerInfo,Gs=!0;break e}K=K.return}if(sr===null)throw Error(r(160));Dj(A,U,I),sr=null,Gs=!1,A=I.alternate,A!==null&&(A.return=null),I.return=null}if(f.subtreeFlags&13886)for(f=f.child;f!==null;)jj(f,u),f=f.sibling}var lc=null;function jj(u,f){var p=u.alternate,b=u.flags;switch(u.tag){case 0:case 11:case 14:case 15:zs(f,u),Ws(u),b&4&&(Dd(3,u,u.return),m0(3,u),Dd(5,u,u.return));break;case 1:zs(f,u),Ws(u),b&512&&(Qr||p===null||Zc(p,p.return)),b&64&&ru&&(u=u.updateQueue,u!==null&&(b=u.callbacks,b!==null&&(p=u.shared.hiddenCallbacks,u.shared.hiddenCallbacks=p===null?b:p.concat(b))));break;case 26:var I=lc;if(zs(f,u),Ws(u),b&512&&(Qr||p===null||Zc(p,p.return)),b&4){var A=p!==null?p.memoizedState:null;if(b=u.memoizedState,p===null)if(b===null)if(u.stateNode===null){e:{b=u.type,p=u.memoizedProps,I=I.ownerDocument||I;t:switch(b){case"title":A=I.getElementsByTagName("title")[0],(!A||A[Sh]||A[Nr]||A.namespaceURI==="http://www.w3.org/2000/svg"||A.hasAttribute("itemprop"))&&(A=I.createElement(b),I.head.insertBefore(A,I.querySelector("head > title"))),Ki(A,b,p),A[Nr]=u,Ti(A),b=A;break e;case"link":var U=jF("link","href",I).get(b+(p.href||""));if(U){for(var K=0;K<U.length;K++)if(A=U[K],A.getAttribute("href")===(p.href==null||p.href===""?null:p.href)&&A.getAttribute("rel")===(p.rel==null?null:p.rel)&&A.getAttribute("title")===(p.title==null?null:p.title)&&A.getAttribute("crossorigin")===(p.crossOrigin==null?null:p.crossOrigin)){U.splice(K,1);break t}}A=I.createElement(b),Ki(A,b,p),I.head.appendChild(A);break;case"meta":if(U=jF("meta","content",I).get(b+(p.content||""))){for(K=0;K<U.length;K++)if(A=U[K],A.getAttribute("content")===(p.content==null?null:""+p.content)&&A.getAttribute("name")===(p.name==null?null:p.name)&&A.getAttribute("property")===(p.property==null?null:p.property)&&A.getAttribute("http-equiv")===(p.httpEquiv==null?null:p.httpEquiv)&&A.getAttribute("charset")===(p.charSet==null?null:p.charSet)){U.splice(K,1);break t}}A=I.createElement(b),Ki(A,b,p),I.head.appendChild(A);break;default:throw Error(r(468,b))}A[Nr]=u,Ti(A),b=A}u.stateNode=b}else FF(I,u.type,u.stateNode);else u.stateNode=UF(I,b,u.memoizedProps);else A!==b?(A===null?p.stateNode!==null&&(p=p.stateNode,p.parentNode.removeChild(p)):A.count--,b===null?FF(I,u.type,u.stateNode):UF(I,b,u.memoizedProps)):b===null&&u.stateNode!==null&&Zk(u,u.memoizedProps,p.memoizedProps)}break;case 27:zs(f,u),Ws(u),b&512&&(Qr||p===null||Zc(p,p.return)),p!==null&&b&4&&Zk(u,u.memoizedProps,p.memoizedProps);break;case 5:if(zs(f,u),Ws(u),b&512&&(Qr||p===null||Zc(p,p.return)),u.flags&32){I=u.stateNode;try{Rm(I,"")}catch(qe){Sn(u,u.return,qe)}}b&4&&u.stateNode!=null&&(I=u.memoizedProps,Zk(u,I,p!==null?p.memoizedProps:I)),b&1024&&(nI=!0);break;case 6:if(zs(f,u),Ws(u),b&4){if(u.stateNode===null)throw Error(r(162));b=u.memoizedProps,p=u.stateNode;try{p.nodeValue=b}catch(qe){Sn(u,u.return,qe)}}break;case 3:if(O2=null,I=lc,lc=L2(f.containerInfo),zs(f,u),lc=I,Ws(u),b&4&&p!==null&&p.memoizedState.isDehydrated)try{rg(f.containerInfo)}catch(qe){Sn(u,u.return,qe)}nI&&(nI=!1,Fj(u));break;case 4:b=lc,lc=L2(u.stateNode.containerInfo),zs(f,u),Ws(u),lc=b;break;case 12:zs(f,u),Ws(u);break;case 31:zs(f,u),Ws(u),b&4&&(b=u.updateQueue,b!==null&&(u.updateQueue=null,v2(u,b)));break;case 13:zs(f,u),Ws(u),u.child.flags&8192&&u.memoizedState!==null!=(p!==null&&p.memoizedState!==null)&&(b2=wr()),b&4&&(b=u.updateQueue,b!==null&&(u.updateQueue=null,v2(u,b)));break;case 22:I=u.memoizedState!==null;var Q=p!==null&&p.memoizedState!==null,se=ru,ye=Qr;if(ru=se||I,Qr=ye||Q,zs(f,u),Qr=ye,ru=se,Ws(u),b&8192)e:for(f=u.stateNode,f._visibility=I?f._visibility&-2:f._visibility|1,I&&(p===null||Q||ru||Qr||jh(u)),p=null,f=u;;){if(f.tag===5||f.tag===26){if(p===null){Q=p=f;try{if(A=Q.stateNode,I)U=A.style,typeof U.setProperty=="function"?U.setProperty("display","none","important"):U.display="none";else{K=Q.stateNode;var Ee=Q.memoizedProps.style,le=Ee!=null&&Ee.hasOwnProperty("display")?Ee.display:null;K.style.display=le==null||typeof le=="boolean"?"":(""+le).trim()}}catch(qe){Sn(Q,Q.return,qe)}}}else if(f.tag===6){if(p===null){Q=f;try{Q.stateNode.nodeValue=I?"":Q.memoizedProps}catch(qe){Sn(Q,Q.return,qe)}}}else if(f.tag===18){if(p===null){Q=f;try{var me=Q.stateNode;I?IF(me,!0):IF(Q.stateNode,!1)}catch(qe){Sn(Q,Q.return,qe)}}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===u)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===u)break e;for(;f.sibling===null;){if(f.return===null||f.return===u)break e;p===f&&(p=null),f=f.return}p===f&&(p=null),f.sibling.return=f.return,f=f.sibling}b&4&&(b=u.updateQueue,b!==null&&(p=b.retryQueue,p!==null&&(b.retryQueue=null,v2(u,p))));break;case 19:zs(f,u),Ws(u),b&4&&(b=u.updateQueue,b!==null&&(u.updateQueue=null,v2(u,b)));break;case 30:break;case 21:break;default:zs(f,u),Ws(u)}}function Ws(u){var f=u.flags;if(f&2){try{for(var p,b=u.return;b!==null;){if(Aj(b)){p=b;break}b=b.return}if(p==null)throw Error(r(160));switch(p.tag){case 27:var I=p.stateNode,A=eI(u);g2(u,A,I);break;case 5:var U=p.stateNode;p.flags&32&&(Rm(U,""),p.flags&=-33);var K=eI(u);g2(u,K,U);break;case 3:case 4:var Q=p.stateNode.containerInfo,se=eI(u);tI(u,se,Q);break;default:throw Error(r(161))}}catch(ye){Sn(u,u.return,ye)}u.flags&=-3}f&4096&&(u.flags&=-4097)}function Fj(u){if(u.subtreeFlags&1024)for(u=u.child;u!==null;){var f=u;Fj(f),f.tag===5&&f.flags&1024&&f.stateNode.reset(),u=u.sibling}}function su(u,f){if(f.subtreeFlags&8772)for(f=f.child;f!==null;)Oj(u,f.alternate,f),f=f.sibling}function jh(u){for(u=u.child;u!==null;){var f=u;switch(f.tag){case 0:case 11:case 14:case 15:Dd(4,f,f.return),jh(f);break;case 1:Zc(f,f.return);var p=f.stateNode;typeof p.componentWillUnmount=="function"&&Ij(f,f.return,p),jh(f);break;case 27:T0(f.stateNode);case 26:case 5:Zc(f,f.return),jh(f);break;case 22:f.memoizedState===null&&jh(f);break;case 30:jh(f);break;default:jh(f)}u=u.sibling}}function ou(u,f,p){for(p=p&&(f.subtreeFlags&8772)!==0,f=f.child;f!==null;){var b=f.alternate,I=u,A=f,U=A.flags;switch(A.tag){case 0:case 11:case 15:ou(I,A,p),m0(4,A);break;case 1:if(ou(I,A,p),b=A,I=b.stateNode,typeof I.componentDidMount=="function")try{I.componentDidMount()}catch(se){Sn(b,b.return,se)}if(b=A,I=b.updateQueue,I!==null){var K=b.stateNode;try{var Q=I.shared.hiddenCallbacks;if(Q!==null)for(I.shared.hiddenCallbacks=null,I=0;I<Q.length;I++)gU(Q[I],K)}catch(se){Sn(b,b.return,se)}}p&&U&64&&kj(A),g0(A,A.return);break;case 27:Lj(A);case 26:case 5:ou(I,A,p),p&&b===null&&U&4&&xj(A),g0(A,A.return);break;case 12:ou(I,A,p);break;case 31:ou(I,A,p),p&&U&4&&Nj(I,A);break;case 13:ou(I,A,p),p&&U&4&&Uj(I,A);break;case 22:A.memoizedState===null&&ou(I,A,p),g0(A,A.return);break;case 30:break;default:ou(I,A,p)}f=f.sibling}}function rI(u,f){var p=null;u!==null&&u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(p=u.memoizedState.cachePool.pool),u=null,f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(u=f.memoizedState.cachePool.pool),u!==p&&(u!=null&&u.refCount++,p!=null&&n0(p))}function iI(u,f){u=null,f.alternate!==null&&(u=f.alternate.memoizedState.cache),f=f.memoizedState.cache,f!==u&&(f.refCount++,u!=null&&n0(u))}function uc(u,f,p,b){if(f.subtreeFlags&10256)for(f=f.child;f!==null;)$j(u,f,p,b),f=f.sibling}function $j(u,f,p,b){var I=f.flags;switch(f.tag){case 0:case 11:case 15:uc(u,f,p,b),I&2048&&m0(9,f);break;case 1:uc(u,f,p,b);break;case 3:uc(u,f,p,b),I&2048&&(u=null,f.alternate!==null&&(u=f.alternate.memoizedState.cache),f=f.memoizedState.cache,f!==u&&(f.refCount++,u!=null&&n0(u)));break;case 12:if(I&2048){uc(u,f,p,b),u=f.stateNode;try{var A=f.memoizedProps,U=A.id,K=A.onPostCommit;typeof K=="function"&&K(U,f.alternate===null?"mount":"update",u.passiveEffectDuration,-0)}catch(Q){Sn(f,f.return,Q)}}else uc(u,f,p,b);break;case 31:uc(u,f,p,b);break;case 13:uc(u,f,p,b);break;case 23:break;case 22:A=f.stateNode,U=f.alternate,f.memoizedState!==null?A._visibility&2?uc(u,f,p,b):v0(u,f):A._visibility&2?uc(u,f,p,b):(A._visibility|=2,Gm(u,f,p,b,(f.subtreeFlags&10256)!==0||!1)),I&2048&&rI(U,f);break;case 24:uc(u,f,p,b),I&2048&&iI(f.alternate,f);break;default:uc(u,f,p,b)}}function Gm(u,f,p,b,I){for(I=I&&((f.subtreeFlags&10256)!==0||!1),f=f.child;f!==null;){var A=u,U=f,K=p,Q=b,se=U.flags;switch(U.tag){case 0:case 11:case 15:Gm(A,U,K,Q,I),m0(8,U);break;case 23:break;case 22:var ye=U.stateNode;U.memoizedState!==null?ye._visibility&2?Gm(A,U,K,Q,I):v0(A,U):(ye._visibility|=2,Gm(A,U,K,Q,I)),I&&se&2048&&rI(U.alternate,U);break;case 24:Gm(A,U,K,Q,I),I&&se&2048&&iI(U.alternate,U);break;default:Gm(A,U,K,Q,I)}f=f.sibling}}function v0(u,f){if(f.subtreeFlags&10256)for(f=f.child;f!==null;){var p=u,b=f,I=b.flags;switch(b.tag){case 22:v0(p,b),I&2048&&rI(b.alternate,b);break;case 24:v0(p,b),I&2048&&iI(b.alternate,b);break;default:v0(p,b)}f=f.sibling}}var y0=8192;function zm(u,f,p){if(u.subtreeFlags&y0)for(u=u.child;u!==null;)Bj(u,f,p),u=u.sibling}function Bj(u,f,p){switch(u.tag){case 26:zm(u,f,p),u.flags&y0&&u.memoizedState!==null&&Vge(p,lc,u.memoizedState,u.memoizedProps);break;case 5:zm(u,f,p);break;case 3:case 4:var b=lc;lc=L2(u.stateNode.containerInfo),zm(u,f,p),lc=b;break;case 22:u.memoizedState===null&&(b=u.alternate,b!==null&&b.memoizedState!==null?(b=y0,y0=16777216,zm(u,f,p),y0=b):zm(u,f,p));break;default:zm(u,f,p)}}function Hj(u){var f=u.alternate;if(f!==null&&(u=f.child,u!==null)){f.child=null;do f=u.sibling,u.sibling=null,u=f;while(u!==null)}}function b0(u){var f=u.deletions;if((u.flags&16)!==0){if(f!==null)for(var p=0;p<f.length;p++){var b=f[p];Ri=b,Vj(b,u)}Hj(u)}if(u.subtreeFlags&10256)for(u=u.child;u!==null;)qj(u),u=u.sibling}function qj(u){switch(u.tag){case 0:case 11:case 15:b0(u),u.flags&2048&&Dd(9,u,u.return);break;case 3:b0(u);break;case 12:b0(u);break;case 22:var f=u.stateNode;u.memoizedState!==null&&f._visibility&2&&(u.return===null||u.return.tag!==13)?(f._visibility&=-3,y2(u)):b0(u);break;default:b0(u)}}function y2(u){var f=u.deletions;if((u.flags&16)!==0){if(f!==null)for(var p=0;p<f.length;p++){var b=f[p];Ri=b,Vj(b,u)}Hj(u)}for(u=u.child;u!==null;){switch(f=u,f.tag){case 0:case 11:case 15:Dd(8,f,f.return),y2(f);break;case 22:p=f.stateNode,p._visibility&2&&(p._visibility&=-3,y2(f));break;default:y2(f)}u=u.sibling}}function Vj(u,f){for(;Ri!==null;){var p=Ri;switch(p.tag){case 0:case 11:case 15:Dd(8,p,f);break;case 23:case 22:if(p.memoizedState!==null&&p.memoizedState.cachePool!==null){var b=p.memoizedState.cachePool.pool;b!=null&&b.refCount++}break;case 24:n0(p.memoizedState.cache)}if(b=p.child,b!==null)b.return=p,Ri=b;else e:for(p=u;Ri!==null;){b=Ri;var I=b.sibling,A=b.return;if(Pj(b),b===p){Ri=null;break e}if(I!==null){I.return=A,Ri=I;break e}Ri=A}}}var sge={getCacheForType:function(u){var f=qi(Yr),p=f.data.get(u);return p===void 0&&(p=u(),f.data.set(u,p)),p},cacheSignal:function(){return qi(Yr).controller.signal}},oge=typeof WeakMap=="function"?WeakMap:Map,dn=0,Ln=null,Ut=null,Vt=0,_n=0,Oo=null,Nd=!1,Wm=!1,sI=!1,au=0,Cr=0,Ud=0,Fh=0,oI=0,Po=0,Ym=0,_0=null,Ys=null,aI=!1,b2=0,Kj=0,_2=1/0,S2=null,jd=null,ui=0,Fd=null,Xm=null,cu=0,cI=0,lI=null,Gj=null,S0=0,uI=null;function Do(){return(dn&2)!==0&&Vt!==0?Vt&-Vt:F.T!==null?gI():_t()}function zj(){if(Po===0)if((Vt&536870912)===0||zt){var u=Be;Be<<=1,(Be&3932160)===0&&(Be=262144),Po=u}else Po=536870912;return u=Lo.current,u!==null&&(u.flags|=32),Po}function Xs(u,f,p){(u===Ln&&(_n===2||_n===9)||u.cancelPendingCommit!==null)&&(Jm(u,0),$d(u,Vt,Po,!1)),Ci(u,p),((dn&2)===0||u!==Ln)&&(u===Ln&&((dn&2)===0&&(Fh|=p),Cr===4&&$d(u,Vt,Po,!1)),el(u))}function Wj(u,f,p){if((dn&6)!==0)throw Error(r(327));var b=!p&&(f&127)===0&&(f&u.expiredLanes)===0||jn(u,f),I=b?lge(u,f):fI(u,f,!0),A=b;do{if(I===0){Wm&&!b&&$d(u,f,0,!1);break}else{if(p=u.current.alternate,A&&!age(p)){I=fI(u,f,!1),A=!1;continue}if(I===2){if(A=f,u.errorRecoveryDisabledLanes&A)var U=0;else U=u.pendingLanes&-536870913,U=U!==0?U:U&536870912?536870912:0;if(U!==0){f=U;e:{var K=u;I=_0;var Q=K.current.memoizedState.isDehydrated;if(Q&&(Jm(K,U).flags|=256),U=fI(K,U,!1),U!==2){if(sI&&!Q){K.errorRecoveryDisabledLanes|=A,Fh|=A,I=4;break e}A=Ys,Ys=I,A!==null&&(Ys===null?Ys=A:Ys.push.apply(Ys,A))}I=U}if(A=!1,I!==2)continue}}if(I===1){Jm(u,0),$d(u,f,0,!0);break}e:{switch(b=u,A=I,A){case 0:case 1:throw Error(r(345));case 4:if((f&4194048)!==f)break;case 6:$d(b,f,Po,!Nd);break e;case 2:Ys=null;break;case 3:case 5:break;default:throw Error(r(329))}if((f&62914560)===f&&(I=b2+300-wr(),10<I)){if($d(b,f,Po,!Nd),Un(b,0,!0)!==0)break e;cu=f,b.timeoutHandle=TF(Yj.bind(null,b,p,Ys,S2,aI,f,Po,Fh,Ym,Nd,A,"Throttled",-0,0),I);break e}Yj(b,p,Ys,S2,aI,f,Po,Fh,Ym,Nd,A,null,-0,0)}}break}while(!0);el(u)}function Yj(u,f,p,b,I,A,U,K,Q,se,ye,Ee,le,me){if(u.timeoutHandle=-1,Ee=f.subtreeFlags,Ee&8192||(Ee&16785408)===16785408){Ee={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:zl},Bj(f,A,Ee);var qe=(A&62914560)===A?b2-wr():(A&4194048)===A?Kj-wr():0;if(qe=Kge(Ee,qe),qe!==null){cu=A,u.cancelPendingCommit=qe(rF.bind(null,u,f,A,p,b,I,U,K,Q,ye,Ee,null,le,me)),$d(u,A,U,!se);return}}rF(u,f,A,p,b,I,U,K,Q)}function age(u){for(var f=u;;){var p=f.tag;if((p===0||p===11||p===15)&&f.flags&16384&&(p=f.updateQueue,p!==null&&(p=p.stores,p!==null)))for(var b=0;b<p.length;b++){var I=p[b],A=I.getSnapshot;I=I.value;try{if(!xo(A(),I))return!1}catch{return!1}}if(p=f.child,f.subtreeFlags&16384&&p!==null)p.return=f,f=p;else{if(f===u)break;for(;f.sibling===null;){if(f.return===null||f.return===u)return!0;f=f.return}f.sibling.return=f.return,f=f.sibling}}return!0}function $d(u,f,p,b){f&=~oI,f&=~Fh,u.suspendedLanes|=f,u.pingedLanes&=~f,b&&(u.warmLanes|=f),b=u.expirationTimes;for(var I=f;0<I;){var A=31-li(I),U=1<<A;b[A]=-1,I&=~U}p!==0&&ac(u,p,f)}function w2(){return(dn&6)===0?(w0(0),!1):!0}function dI(){if(Ut!==null){if(_n===0)var u=Ut.return;else u=Ut,Jl=Ah=null,kk(u),Bm=null,i0=0,u=Ut;for(;u!==null;)Rj(u.alternate,u),u=u.return;Ut=null}}function Jm(u,f){var p=u.timeoutHandle;p!==-1&&(u.timeoutHandle=-1,kge(p)),p=u.cancelPendingCommit,p!==null&&(u.cancelPendingCommit=null,p()),cu=0,dI(),Ln=u,Ut=p=Yl(u.current,null),Vt=f,_n=0,Oo=null,Nd=!1,Wm=jn(u,f),sI=!1,Ym=Po=oI=Fh=Ud=Cr=0,Ys=_0=null,aI=!1,(f&8)!==0&&(f|=f&32);var b=u.entangledLanes;if(b!==0)for(u=u.entanglements,b&=f;0<b;){var I=31-li(b),A=1<<I;f|=u[I],b&=~A}return au=f,qS(),p}function Xj(u,f){xt=null,F.H=f0,f===$m||f===JS?(f=fU(),_n=3):f===mk?(f=fU(),_n=4):_n=f===qk?8:f!==null&&typeof f=="object"&&typeof f.then=="function"?6:1,Oo=f,Ut===null&&(Cr=1,d2(u,ha(f,u.current)))}function Jj(){var u=Lo.current;return u===null?!0:(Vt&4194048)===Vt?va===null:(Vt&62914560)===Vt||(Vt&536870912)!==0?u===va:!1}function Qj(){var u=F.H;return F.H=f0,u===null?f0:u}function Zj(){var u=F.A;return F.A=sge,u}function E2(){Cr=4,Nd||(Vt&4194048)!==Vt&&Lo.current!==null||(Wm=!0),(Ud&134217727)===0&&(Fh&134217727)===0||Ln===null||$d(Ln,Vt,Po,!1)}function fI(u,f,p){var b=dn;dn|=2;var I=Qj(),A=Zj();(Ln!==u||Vt!==f)&&(S2=null,Jm(u,f)),f=!1;var U=Cr;e:do try{if(_n!==0&&Ut!==null){var K=Ut,Q=Oo;switch(_n){case 8:dI(),U=6;break e;case 3:case 2:case 9:case 6:Lo.current===null&&(f=!0);var se=_n;if(_n=0,Oo=null,Qm(u,K,Q,se),p&&Wm){U=0;break e}break;default:se=_n,_n=0,Oo=null,Qm(u,K,Q,se)}}cge(),U=Cr;break}catch(ye){Xj(u,ye)}while(!0);return f&&u.shellSuspendCounter++,Jl=Ah=null,dn=b,F.H=I,F.A=A,Ut===null&&(Ln=null,Vt=0,qS()),U}function cge(){for(;Ut!==null;)eF(Ut)}function lge(u,f){var p=dn;dn|=2;var b=Qj(),I=Zj();Ln!==u||Vt!==f?(S2=null,_2=wr()+500,Jm(u,f)):Wm=jn(u,f);e:do try{if(_n!==0&&Ut!==null){f=Ut;var A=Oo;t:switch(_n){case 1:_n=0,Oo=null,Qm(u,f,A,1);break;case 2:case 9:if(uU(A)){_n=0,Oo=null,tF(f);break}f=function(){_n!==2&&_n!==9||Ln!==u||(_n=7),el(u)},A.then(f,f);break e;case 3:_n=7;break e;case 4:_n=5;break e;case 7:uU(A)?(_n=0,Oo=null,tF(f)):(_n=0,Oo=null,Qm(u,f,A,7));break;case 5:var U=null;switch(Ut.tag){case 26:U=Ut.memoizedState;case 5:case 27:var K=Ut;if(U?$F(U):K.stateNode.complete){_n=0,Oo=null;var Q=K.sibling;if(Q!==null)Ut=Q;else{var se=K.return;se!==null?(Ut=se,C2(se)):Ut=null}break t}}_n=0,Oo=null,Qm(u,f,A,5);break;case 6:_n=0,Oo=null,Qm(u,f,A,6);break;case 8:dI(),Cr=6;break e;default:throw Error(r(462))}}uge();break}catch(ye){Xj(u,ye)}while(!0);return Jl=Ah=null,F.H=b,F.A=I,dn=p,Ut!==null?0:(Ln=null,Vt=0,qS(),Cr)}function uge(){for(;Ut!==null&&!wd();)eF(Ut)}function eF(u){var f=Cj(u.alternate,u,au);u.memoizedProps=u.pendingProps,f===null?C2(u):Ut=f}function tF(u){var f=u,p=f.alternate;switch(f.tag){case 15:case 0:f=yj(p,f,f.pendingProps,f.type,void 0,Vt);break;case 11:f=yj(p,f,f.pendingProps,f.type.render,f.ref,Vt);break;case 5:kk(f);default:Rj(p,f),f=Ut=ZN(f,au),f=Cj(p,f,au)}u.memoizedProps=u.pendingProps,f===null?C2(u):Ut=f}function Qm(u,f,p,b){Jl=Ah=null,kk(f),Bm=null,i0=0;var I=f.return;try{if(Qme(u,I,f,p,Vt)){Cr=1,d2(u,ha(p,u.current)),Ut=null;return}}catch(A){if(I!==null)throw Ut=I,A;Cr=1,d2(u,ha(p,u.current)),Ut=null;return}f.flags&32768?(zt||b===1?u=!0:Wm||(Vt&536870912)!==0?u=!1:(Nd=u=!0,(b===2||b===9||b===3||b===6)&&(b=Lo.current,b!==null&&b.tag===13&&(b.flags|=16384))),nF(f,u)):C2(f)}function C2(u){var f=u;do{if((f.flags&32768)!==0){nF(f,Nd);return}u=f.return;var p=tge(f.alternate,f,au);if(p!==null){Ut=p;return}if(f=f.sibling,f!==null){Ut=f;return}Ut=f=u}while(f!==null);Cr===0&&(Cr=5)}function nF(u,f){do{var p=nge(u.alternate,u);if(p!==null){p.flags&=32767,Ut=p;return}if(p=u.return,p!==null&&(p.flags|=32768,p.subtreeFlags=0,p.deletions=null),!f&&(u=u.sibling,u!==null)){Ut=u;return}Ut=u=p}while(u!==null);Cr=6,Ut=null}function rF(u,f,p,b,I,A,U,K,Q){u.cancelPendingCommit=null;do T2();while(ui!==0);if((dn&6)!==0)throw Error(r(327));if(f!==null){if(f===u.current)throw Error(r(177));if(A=f.lanes|f.childLanes,A|=ek,os(u,p,A,U,K,Q),u===Ln&&(Ut=Ln=null,Vt=0),Xm=f,Fd=u,cu=p,cI=A,lI=I,Gj=b,(f.subtreeFlags&10256)!==0||(f.flags&10256)!==0?(u.callbackNode=null,u.callbackPriority=0,pge(Ro,function(){return cF(),null})):(u.callbackNode=null,u.callbackPriority=0),b=(f.flags&13878)!==0,(f.subtreeFlags&13878)!==0||b){b=F.T,F.T=null,I=$.p,$.p=2,U=dn,dn|=4;try{rge(u,f,p)}finally{dn=U,$.p=I,F.T=b}}ui=1,iF(),sF(),oF()}}function iF(){if(ui===1){ui=0;var u=Fd,f=Xm,p=(f.flags&13878)!==0;if((f.subtreeFlags&13878)!==0||p){p=F.T,F.T=null;var b=$.p;$.p=2;var I=dn;dn|=4;try{jj(f,u);var A=CI,U=VN(u.containerInfo),K=A.focusedElem,Q=A.selectionRange;if(U!==K&&K&&K.ownerDocument&&qN(K.ownerDocument.documentElement,K)){if(Q!==null&&Y4(K)){var se=Q.start,ye=Q.end;if(ye===void 0&&(ye=se),"selectionStart"in K)K.selectionStart=se,K.selectionEnd=Math.min(ye,K.value.length);else{var Ee=K.ownerDocument||document,le=Ee&&Ee.defaultView||window;if(le.getSelection){var me=le.getSelection(),qe=K.textContent.length,ct=Math.min(Q.start,qe),Tn=Q.end===void 0?ct:Math.min(Q.end,qe);!me.extend&&ct>Tn&&(U=Tn,Tn=ct,ct=U);var re=HN(K,ct),te=HN(K,Tn);if(re&&te&&(me.rangeCount!==1||me.anchorNode!==re.node||me.anchorOffset!==re.offset||me.focusNode!==te.node||me.focusOffset!==te.offset)){var ie=Ee.createRange();ie.setStart(re.node,re.offset),me.removeAllRanges(),ct>Tn?(me.addRange(ie),me.extend(te.node,te.offset)):(ie.setEnd(te.node,te.offset),me.addRange(ie))}}}}for(Ee=[],me=K;me=me.parentNode;)me.nodeType===1&&Ee.push({element:me,left:me.scrollLeft,top:me.scrollTop});for(typeof K.focus=="function"&&K.focus(),K=0;K<Ee.length;K++){var _e=Ee[K];_e.element.scrollLeft=_e.left,_e.element.scrollTop=_e.top}}U2=!!EI,CI=EI=null}finally{dn=I,$.p=b,F.T=p}}u.current=f,ui=2}}function sF(){if(ui===2){ui=0;var u=Fd,f=Xm,p=(f.flags&8772)!==0;if((f.subtreeFlags&8772)!==0||p){p=F.T,F.T=null;var b=$.p;$.p=2;var I=dn;dn|=4;try{Oj(u,f.alternate,f)}finally{dn=I,$.p=b,F.T=p}}ui=3}}function oF(){if(ui===4||ui===3){ui=0,To();var u=Fd,f=Xm,p=cu,b=Gj;(f.subtreeFlags&10256)!==0||(f.flags&10256)!==0?ui=5:(ui=0,Xm=Fd=null,aF(u,u.pendingLanes));var I=u.pendingLanes;if(I===0&&(jd=null),ht(p),f=f.stateNode,Gr&&typeof Gr.onCommitFiberRoot=="function")try{Gr.onCommitFiberRoot(Ei,f,void 0,(f.current.flags&128)===128)}catch{}if(b!==null){f=F.T,I=$.p,$.p=2,F.T=null;try{for(var A=u.onRecoverableError,U=0;U<b.length;U++){var K=b[U];A(K.value,{componentStack:K.stack})}}finally{F.T=f,$.p=I}}(cu&3)!==0&&T2(),el(u),I=u.pendingLanes,(p&261930)!==0&&(I&42)!==0?u===uI?S0++:(S0=0,uI=u):S0=0,w0(0)}}function aF(u,f){(u.pooledCacheLanes&=f)===0&&(f=u.pooledCache,f!=null&&(u.pooledCache=null,n0(f)))}function T2(){return iF(),sF(),oF(),cF()}function cF(){if(ui!==5)return!1;var u=Fd,f=cI;cI=0;var p=ht(cu),b=F.T,I=$.p;try{$.p=32>p?32:p,F.T=null,p=lI,lI=null;var A=Fd,U=cu;if(ui=0,Xm=Fd=null,cu=0,(dn&6)!==0)throw Error(r(331));var K=dn;if(dn|=4,qj(A.current),$j(A,A.current,U,p),dn=K,w0(0,!1),Gr&&typeof Gr.onPostCommitFiberRoot=="function")try{Gr.onPostCommitFiberRoot(Ei,A)}catch{}return!0}finally{$.p=I,F.T=b,aF(u,f)}}function lF(u,f,p){f=ha(p,f),f=Hk(u.stateNode,f,2),u=Md(u,f,2),u!==null&&(Ci(u,2),el(u))}function Sn(u,f,p){if(u.tag===3)lF(u,u,p);else for(;f!==null;){if(f.tag===3){lF(f,u,p);break}else if(f.tag===1){var b=f.stateNode;if(typeof f.type.getDerivedStateFromError=="function"||typeof b.componentDidCatch=="function"&&(jd===null||!jd.has(b))){u=ha(p,u),p=uj(2),b=Md(f,p,2),b!==null&&(dj(p,b,f,u),Ci(b,2),el(b));break}}f=f.return}}function hI(u,f,p){var b=u.pingCache;if(b===null){b=u.pingCache=new oge;var I=new Set;b.set(f,I)}else I=b.get(f),I===void 0&&(I=new Set,b.set(f,I));I.has(p)||(sI=!0,I.add(p),u=dge.bind(null,u,f,p),f.then(u,u))}function dge(u,f,p){var b=u.pingCache;b!==null&&b.delete(f),u.pingedLanes|=u.suspendedLanes&p,u.warmLanes&=~p,Ln===u&&(Vt&p)===p&&(Cr===4||Cr===3&&(Vt&62914560)===Vt&&300>wr()-b2?(dn&2)===0&&Jm(u,0):oI|=p,Ym===Vt&&(Ym=0)),el(u)}function uF(u,f){f===0&&(f=zr()),u=kh(u,f),u!==null&&(Ci(u,f),el(u))}function fge(u){var f=u.memoizedState,p=0;f!==null&&(p=f.retryLane),uF(u,p)}function hge(u,f){var p=0;switch(u.tag){case 31:case 13:var b=u.stateNode,I=u.memoizedState;I!==null&&(p=I.retryLane);break;case 19:b=u.stateNode;break;case 22:b=u.stateNode._retryCache;break;default:throw Error(r(314))}b!==null&&b.delete(f),uF(u,p)}function pge(u,f){return _s(u,f)}var R2=null,Zm=null,pI=!1,k2=!1,mI=!1,Bd=0;function el(u){u!==Zm&&u.next===null&&(Zm===null?R2=Zm=u:Zm=Zm.next=u),k2=!0,pI||(pI=!0,gge())}function w0(u,f){if(!mI&&k2){mI=!0;do for(var p=!1,b=R2;b!==null;){if(u!==0){var I=b.pendingLanes;if(I===0)var A=0;else{var U=b.suspendedLanes,K=b.pingedLanes;A=(1<<31-li(42|u)+1)-1,A&=I&~(U&~K),A=A&201326741?A&201326741|1:A?A|2:0}A!==0&&(p=!0,pF(b,A))}else A=Vt,A=Un(b,b===Ln?A:0,b.cancelPendingCommit!==null||b.timeoutHandle!==-1),(A&3)===0||jn(b,A)||(p=!0,pF(b,A));b=b.next}while(p);mI=!1}}function mge(){dF()}function dF(){k2=pI=!1;var u=0;Bd!==0&&Rge()&&(u=Bd);for(var f=wr(),p=null,b=R2;b!==null;){var I=b.next,A=fF(b,f);A===0?(b.next=null,p===null?R2=I:p.next=I,I===null&&(Zm=p)):(p=b,(u!==0||(A&3)!==0)&&(k2=!0)),b=I}ui!==0&&ui!==5||w0(u),Bd!==0&&(Bd=0)}function fF(u,f){for(var p=u.suspendedLanes,b=u.pingedLanes,I=u.expirationTimes,A=u.pendingLanes&-62914561;0<A;){var U=31-li(A),K=1<<U,Q=I[U];Q===-1?((K&p)===0||(K&b)!==0)&&(I[U]=ws(K,f)):Q<=f&&(u.expiredLanes|=K),A&=~K}if(f=Ln,p=Vt,p=Un(u,u===f?p:0,u.cancelPendingCommit!==null||u.timeoutHandle!==-1),b=u.callbackNode,p===0||u===f&&(_n===2||_n===9)||u.cancelPendingCommit!==null)return b!==null&&b!==null&&Ss(b),u.callbackNode=null,u.callbackPriority=0;if((p&3)===0||jn(u,p)){if(f=p&-p,f===u.callbackPriority)return f;switch(b!==null&&Ss(b),ht(p)){case 2:case 8:p=Vl;break;case 32:p=Ro;break;case 268435456:p=Kl;break;default:p=Ro}return b=hF.bind(null,u),p=_s(p,b),u.callbackPriority=f,u.callbackNode=p,f}return b!==null&&b!==null&&Ss(b),u.callbackPriority=2,u.callbackNode=null,2}function hF(u,f){if(ui!==0&&ui!==5)return u.callbackNode=null,u.callbackPriority=0,null;var p=u.callbackNode;if(T2()&&u.callbackNode!==p)return null;var b=Vt;return b=Un(u,u===Ln?b:0,u.cancelPendingCommit!==null||u.timeoutHandle!==-1),b===0?null:(Wj(u,b,f),fF(u,wr()),u.callbackNode!=null&&u.callbackNode===p?hF.bind(null,u):null)}function pF(u,f){if(T2())return null;Wj(u,f,!0)}function gge(){Ige(function(){(dn&6)!==0?_s(Wc,mge):dF()})}function gI(){if(Bd===0){var u=jm;u===0&&(u=Dt,Dt<<=1,(Dt&261888)===0&&(Dt=256)),Bd=u}return Bd}function mF(u){return u==null||typeof u=="symbol"||typeof u=="boolean"?null:typeof u=="function"?u:DS(""+u)}function gF(u,f){var p=f.ownerDocument.createElement("input");return p.name=f.name,p.value=f.value,u.id&&p.setAttribute("form",u.id),f.parentNode.insertBefore(p,f),u=new FormData(u),p.parentNode.removeChild(p),u}function vge(u,f,p,b,I){if(f==="submit"&&p&&p.stateNode===I){var A=mF((I[ir]||null).action),U=b.submitter;U&&(f=(f=U[ir]||null)?mF(f.formAction):U.getAttribute("formAction"),f!==null&&(A=f,U=null));var K=new FS("action","action",null,b,I);u.push({event:K,listeners:[{instance:null,listener:function(){if(b.defaultPrevented){if(Bd!==0){var Q=U?gF(I,U):new FormData(I);Nk(p,{pending:!0,data:Q,method:I.method,action:A},null,Q)}}else typeof A=="function"&&(K.preventDefault(),Q=U?gF(I,U):new FormData(I),Nk(p,{pending:!0,data:Q,method:I.method,action:A},A,Q))},currentTarget:I}]})}}for(var vI=0;vI<Z4.length;vI++){var yI=Z4[vI],yge=yI.toLowerCase(),bge=yI[0].toUpperCase()+yI.slice(1);cc(yge,"on"+bge)}cc(zN,"onAnimationEnd"),cc(WN,"onAnimationIteration"),cc(YN,"onAnimationStart"),cc("dblclick","onDoubleClick"),cc("focusin","onFocus"),cc("focusout","onBlur"),cc(Dme,"onTransitionRun"),cc(Nme,"onTransitionStart"),cc(Ume,"onTransitionCancel"),cc(XN,"onTransitionEnd"),Cm("onMouseEnter",["mouseout","mouseover"]),Cm("onMouseLeave",["mouseout","mouseover"]),Cm("onPointerEnter",["pointerout","pointerover"]),Cm("onPointerLeave",["pointerout","pointerover"]),Eh("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Eh("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Eh("onBeforeInput",["compositionend","keypress","textInput","paste"]),Eh("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Eh("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Eh("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var E0="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),_ge=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(E0));function vF(u,f){f=(f&4)!==0;for(var p=0;p<u.length;p++){var b=u[p],I=b.event;b=b.listeners;e:{var A=void 0;if(f)for(var U=b.length-1;0<=U;U--){var K=b[U],Q=K.instance,se=K.currentTarget;if(K=K.listener,Q!==A&&I.isPropagationStopped())break e;A=K,I.currentTarget=se;try{A(I)}catch(ye){HS(ye)}I.currentTarget=null,A=Q}else for(U=0;U<b.length;U++){if(K=b[U],Q=K.instance,se=K.currentTarget,K=K.listener,Q!==A&&I.isPropagationStopped())break e;A=K,I.currentTarget=se;try{A(I)}catch(ye){HS(ye)}I.currentTarget=null,A=Q}}}}function jt(u,f){var p=f[_h];p===void 0&&(p=f[_h]=new Set);var b=u+"__bubble";p.has(b)||(yF(f,u,2,!1),p.add(b))}function bI(u,f,p){var b=0;f&&(b|=4),yF(p,u,b,f)}var I2="_reactListening"+Math.random().toString(36).slice(2);function _I(u){if(!u[I2]){u[I2]=!0,dN.forEach(function(p){p!=="selectionchange"&&(_ge.has(p)||bI(p,!1,u),bI(p,!0,u))});var f=u.nodeType===9?u:u.ownerDocument;f===null||f[I2]||(f[I2]=!0,bI("selectionchange",!1,f))}}function yF(u,f,p,b){switch(zF(f)){case 2:var I=Wge;break;case 8:I=Yge;break;default:I=DI}p=I.bind(null,f,p,u),I=void 0,!$4||f!=="touchstart"&&f!=="touchmove"&&f!=="wheel"||(I=!0),b?I!==void 0?u.addEventListener(f,p,{capture:!0,passive:I}):u.addEventListener(f,p,!0):I!==void 0?u.addEventListener(f,p,{passive:I}):u.addEventListener(f,p,!1)}function SI(u,f,p,b,I){var A=b;if((f&1)===0&&(f&2)===0&&b!==null)e:for(;;){if(b===null)return;var U=b.tag;if(U===3||U===4){var K=b.stateNode.containerInfo;if(K===I)break;if(U===4)for(U=b.return;U!==null;){var Q=U.tag;if((Q===3||Q===4)&&U.stateNode.containerInfo===I)return;U=U.return}for(;K!==null;){if(U=Sm(K),U===null)return;if(Q=U.tag,Q===5||Q===6||Q===26||Q===27){b=A=U;continue e}K=K.parentNode}}b=b.return}EN(function(){var se=A,ye=j4(p),Ee=[];e:{var le=JN.get(u);if(le!==void 0){var me=FS,qe=u;switch(u){case"keypress":if(US(p)===0)break e;case"keydown":case"keyup":me=hme;break;case"focusin":qe="focus",me=V4;break;case"focusout":qe="blur",me=V4;break;case"beforeblur":case"afterblur":me=V4;break;case"click":if(p.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":me=RN;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":me=tme;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":me=gme;break;case zN:case WN:case YN:me=ime;break;case XN:me=yme;break;case"scroll":case"scrollend":me=Zpe;break;case"wheel":me=_me;break;case"copy":case"cut":case"paste":me=ome;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":me=IN;break;case"toggle":case"beforetoggle":me=wme}var ct=(f&4)!==0,Tn=!ct&&(u==="scroll"||u==="scrollend"),re=ct?le!==null?le+"Capture":null:le;ct=[];for(var te=se,ie;te!==null;){var _e=te;if(ie=_e.stateNode,_e=_e.tag,_e!==5&&_e!==26&&_e!==27||ie===null||re===null||(_e=Ky(te,re),_e!=null&&ct.push(C0(te,_e,ie))),Tn)break;te=te.return}0<ct.length&&(le=new me(le,qe,null,p,ye),Ee.push({event:le,listeners:ct}))}}if((f&7)===0){e:{if(le=u==="mouseover"||u==="pointerover",me=u==="mouseout"||u==="pointerout",le&&p!==U4&&(qe=p.relatedTarget||p.fromElement)&&(Sm(qe)||qe[Xc]))break e;if((me||le)&&(le=ye.window===ye?ye:(le=ye.ownerDocument)?le.defaultView||le.parentWindow:window,me?(qe=p.relatedTarget||p.toElement,me=se,qe=qe?Sm(qe):null,qe!==null&&(Tn=s(qe),ct=qe.tag,qe!==Tn||ct!==5&&ct!==27&&ct!==6)&&(qe=null)):(me=null,qe=se),me!==qe)){if(ct=RN,_e="onMouseLeave",re="onMouseEnter",te="mouse",(u==="pointerout"||u==="pointerover")&&(ct=IN,_e="onPointerLeave",re="onPointerEnter",te="pointer"),Tn=me==null?le:Vy(me),ie=qe==null?le:Vy(qe),le=new ct(_e,te+"leave",me,p,ye),le.target=Tn,le.relatedTarget=ie,_e=null,Sm(ye)===se&&(ct=new ct(re,te+"enter",qe,p,ye),ct.target=ie,ct.relatedTarget=Tn,_e=ct),Tn=_e,me&&qe)t:{for(ct=Sge,re=me,te=qe,ie=0,_e=re;_e;_e=ct(_e))ie++;_e=0;for(var tt=te;tt;tt=ct(tt))_e++;for(;0<ie-_e;)re=ct(re),ie--;for(;0<_e-ie;)te=ct(te),_e--;for(;ie--;){if(re===te||te!==null&&re===te.alternate){ct=re;break t}re=ct(re),te=ct(te)}ct=null}else ct=null;me!==null&&bF(Ee,le,me,ct,!1),qe!==null&&Tn!==null&&bF(Ee,Tn,qe,ct,!0)}}e:{if(le=se?Vy(se):window,me=le.nodeName&&le.nodeName.toLowerCase(),me==="select"||me==="input"&&le.type==="file")var nn=NN;else if(PN(le))if(UN)nn=Mme;else{nn=Ame;var We=xme}else me=le.nodeName,!me||me.toLowerCase()!=="input"||le.type!=="checkbox"&&le.type!=="radio"?se&&N4(se.elementType)&&(nn=NN):nn=Lme;if(nn&&(nn=nn(u,se))){DN(Ee,nn,p,ye);break e}We&&We(u,le,se),u==="focusout"&&se&&le.type==="number"&&se.memoizedProps.value!=null&&D4(le,"number",le.value)}switch(We=se?Vy(se):window,u){case"focusin":(PN(We)||We.contentEditable==="true")&&(Am=We,X4=se,Zy=null);break;case"focusout":Zy=X4=Am=null;break;case"mousedown":J4=!0;break;case"contextmenu":case"mouseup":case"dragend":J4=!1,KN(Ee,p,ye);break;case"selectionchange":if(Pme)break;case"keydown":case"keyup":KN(Ee,p,ye)}var Ot;if(G4)e:{switch(u){case"compositionstart":var Kt="onCompositionStart";break e;case"compositionend":Kt="onCompositionEnd";break e;case"compositionupdate":Kt="onCompositionUpdate";break e}Kt=void 0}else xm?MN(u,p)&&(Kt="onCompositionEnd"):u==="keydown"&&p.keyCode===229&&(Kt="onCompositionStart");Kt&&(xN&&p.locale!=="ko"&&(xm||Kt!=="onCompositionStart"?Kt==="onCompositionEnd"&&xm&&(Ot=CN()):(Td=ye,B4="value"in Td?Td.value:Td.textContent,xm=!0)),We=x2(se,Kt),0<We.length&&(Kt=new kN(Kt,u,null,p,ye),Ee.push({event:Kt,listeners:We}),Ot?Kt.data=Ot:(Ot=ON(p),Ot!==null&&(Kt.data=Ot)))),(Ot=Cme?Tme(u,p):Rme(u,p))&&(Kt=x2(se,"onBeforeInput"),0<Kt.length&&(We=new kN("onBeforeInput","beforeinput",null,p,ye),Ee.push({event:We,listeners:Kt}),We.data=Ot)),vge(Ee,u,se,p,ye)}vF(Ee,f)})}function C0(u,f,p){return{instance:u,listener:f,currentTarget:p}}function x2(u,f){for(var p=f+"Capture",b=[];u!==null;){var I=u,A=I.stateNode;if(I=I.tag,I!==5&&I!==26&&I!==27||A===null||(I=Ky(u,p),I!=null&&b.unshift(C0(u,I,A)),I=Ky(u,f),I!=null&&b.push(C0(u,I,A))),u.tag===3)return b;u=u.return}return[]}function Sge(u){if(u===null)return null;do u=u.return;while(u&&u.tag!==5&&u.tag!==27);return u||null}function bF(u,f,p,b,I){for(var A=f._reactName,U=[];p!==null&&p!==b;){var K=p,Q=K.alternate,se=K.stateNode;if(K=K.tag,Q!==null&&Q===b)break;K!==5&&K!==26&&K!==27||se===null||(Q=se,I?(se=Ky(p,A),se!=null&&U.unshift(C0(p,se,Q))):I||(se=Ky(p,A),se!=null&&U.push(C0(p,se,Q)))),p=p.return}U.length!==0&&u.push({event:f,listeners:U})}var wge=/\r\n?/g,Ege=/\u0000|\uFFFD/g;function _F(u){return(typeof u=="string"?u:""+u).replace(wge,`
`).replace(Ege,"")}function SF(u,f){return f=_F(f),_F(u)===f}function Cn(u,f,p,b,I,A){switch(p){case"children":typeof b=="string"?f==="body"||f==="textarea"&&b===""||Rm(u,b):(typeof b=="number"||typeof b=="bigint")&&f!=="body"&&Rm(u,""+b);break;case"className":OS(u,"class",b);break;case"tabIndex":OS(u,"tabindex",b);break;case"dir":case"role":case"viewBox":case"width":case"height":OS(u,p,b);break;case"style":SN(u,b,A);break;case"data":if(f!=="object"){OS(u,"data",b);break}case"src":case"href":if(b===""&&(f!=="a"||p!=="href")){u.removeAttribute(p);break}if(b==null||typeof b=="function"||typeof b=="symbol"||typeof b=="boolean"){u.removeAttribute(p);break}b=DS(""+b),u.setAttribute(p,b);break;case"action":case"formAction":if(typeof b=="function"){u.setAttribute(p,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof A=="function"&&(p==="formAction"?(f!=="input"&&Cn(u,f,"name",I.name,I,null),Cn(u,f,"formEncType",I.formEncType,I,null),Cn(u,f,"formMethod",I.formMethod,I,null),Cn(u,f,"formTarget",I.formTarget,I,null)):(Cn(u,f,"encType",I.encType,I,null),Cn(u,f,"method",I.method,I,null),Cn(u,f,"target",I.target,I,null)));if(b==null||typeof b=="symbol"||typeof b=="boolean"){u.removeAttribute(p);break}b=DS(""+b),u.setAttribute(p,b);break;case"onClick":b!=null&&(u.onclick=zl);break;case"onScroll":b!=null&&jt("scroll",u);break;case"onScrollEnd":b!=null&&jt("scrollend",u);break;case"dangerouslySetInnerHTML":if(b!=null){if(typeof b!="object"||!("__html"in b))throw Error(r(61));if(p=b.__html,p!=null){if(I.children!=null)throw Error(r(60));u.innerHTML=p}}break;case"multiple":u.multiple=b&&typeof b!="function"&&typeof b!="symbol";break;case"muted":u.muted=b&&typeof b!="function"&&typeof b!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(b==null||typeof b=="function"||typeof b=="boolean"||typeof b=="symbol"){u.removeAttribute("xlink:href");break}p=DS(""+b),u.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",p);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":b!=null&&typeof b!="function"&&typeof b!="symbol"?u.setAttribute(p,""+b):u.removeAttribute(p);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":b&&typeof b!="function"&&typeof b!="symbol"?u.setAttribute(p,""):u.removeAttribute(p);break;case"capture":case"download":b===!0?u.setAttribute(p,""):b!==!1&&b!=null&&typeof b!="function"&&typeof b!="symbol"?u.setAttribute(p,b):u.removeAttribute(p);break;case"cols":case"rows":case"size":case"span":b!=null&&typeof b!="function"&&typeof b!="symbol"&&!isNaN(b)&&1<=b?u.setAttribute(p,b):u.removeAttribute(p);break;case"rowSpan":case"start":b==null||typeof b=="function"||typeof b=="symbol"||isNaN(b)?u.removeAttribute(p):u.setAttribute(p,b);break;case"popover":jt("beforetoggle",u),jt("toggle",u),MS(u,"popover",b);break;case"xlinkActuate":Gl(u,"http://www.w3.org/1999/xlink","xlink:actuate",b);break;case"xlinkArcrole":Gl(u,"http://www.w3.org/1999/xlink","xlink:arcrole",b);break;case"xlinkRole":Gl(u,"http://www.w3.org/1999/xlink","xlink:role",b);break;case"xlinkShow":Gl(u,"http://www.w3.org/1999/xlink","xlink:show",b);break;case"xlinkTitle":Gl(u,"http://www.w3.org/1999/xlink","xlink:title",b);break;case"xlinkType":Gl(u,"http://www.w3.org/1999/xlink","xlink:type",b);break;case"xmlBase":Gl(u,"http://www.w3.org/XML/1998/namespace","xml:base",b);break;case"xmlLang":Gl(u,"http://www.w3.org/XML/1998/namespace","xml:lang",b);break;case"xmlSpace":Gl(u,"http://www.w3.org/XML/1998/namespace","xml:space",b);break;case"is":MS(u,"is",b);break;case"innerText":case"textContent":break;default:(!(2<p.length)||p[0]!=="o"&&p[0]!=="O"||p[1]!=="n"&&p[1]!=="N")&&(p=Jpe.get(p)||p,MS(u,p,b))}}function wI(u,f,p,b,I,A){switch(p){case"style":SN(u,b,A);break;case"dangerouslySetInnerHTML":if(b!=null){if(typeof b!="object"||!("__html"in b))throw Error(r(61));if(p=b.__html,p!=null){if(I.children!=null)throw Error(r(60));u.innerHTML=p}}break;case"children":typeof b=="string"?Rm(u,b):(typeof b=="number"||typeof b=="bigint")&&Rm(u,""+b);break;case"onScroll":b!=null&&jt("scroll",u);break;case"onScrollEnd":b!=null&&jt("scrollend",u);break;case"onClick":b!=null&&(u.onclick=zl);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!fN.hasOwnProperty(p))e:{if(p[0]==="o"&&p[1]==="n"&&(I=p.endsWith("Capture"),f=p.slice(2,I?p.length-7:void 0),A=u[ir]||null,A=A!=null?A[p]:null,typeof A=="function"&&u.removeEventListener(f,A,I),typeof b=="function")){typeof A!="function"&&A!==null&&(p in u?u[p]=null:u.hasAttribute(p)&&u.removeAttribute(p)),u.addEventListener(f,b,I);break e}p in u?u[p]=b:b===!0?u.setAttribute(p,""):MS(u,p,b)}}}function Ki(u,f,p){switch(f){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":jt("error",u),jt("load",u);var b=!1,I=!1,A;for(A in p)if(p.hasOwnProperty(A)){var U=p[A];if(U!=null)switch(A){case"src":b=!0;break;case"srcSet":I=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,f));default:Cn(u,f,A,U,p,null)}}I&&Cn(u,f,"srcSet",p.srcSet,p,null),b&&Cn(u,f,"src",p.src,p,null);return;case"input":jt("invalid",u);var K=A=U=I=null,Q=null,se=null;for(b in p)if(p.hasOwnProperty(b)){var ye=p[b];if(ye!=null)switch(b){case"name":I=ye;break;case"type":U=ye;break;case"checked":Q=ye;break;case"defaultChecked":se=ye;break;case"value":A=ye;break;case"defaultValue":K=ye;break;case"children":case"dangerouslySetInnerHTML":if(ye!=null)throw Error(r(137,f));break;default:Cn(u,f,b,ye,p,null)}}vN(u,A,K,Q,se,U,I,!1);return;case"select":jt("invalid",u),b=U=A=null;for(I in p)if(p.hasOwnProperty(I)&&(K=p[I],K!=null))switch(I){case"value":A=K;break;case"defaultValue":U=K;break;case"multiple":b=K;default:Cn(u,f,I,K,p,null)}f=A,p=U,u.multiple=!!b,f!=null?Tm(u,!!b,f,!1):p!=null&&Tm(u,!!b,p,!0);return;case"textarea":jt("invalid",u),A=I=b=null;for(U in p)if(p.hasOwnProperty(U)&&(K=p[U],K!=null))switch(U){case"value":b=K;break;case"defaultValue":I=K;break;case"children":A=K;break;case"dangerouslySetInnerHTML":if(K!=null)throw Error(r(91));break;default:Cn(u,f,U,K,p,null)}bN(u,b,I,A);return;case"option":for(Q in p)p.hasOwnProperty(Q)&&(b=p[Q],b!=null)&&(Q==="selected"?u.selected=b&&typeof b!="function"&&typeof b!="symbol":Cn(u,f,Q,b,p,null));return;case"dialog":jt("beforetoggle",u),jt("toggle",u),jt("cancel",u),jt("close",u);break;case"iframe":case"object":jt("load",u);break;case"video":case"audio":for(b=0;b<E0.length;b++)jt(E0[b],u);break;case"image":jt("error",u),jt("load",u);break;case"details":jt("toggle",u);break;case"embed":case"source":case"link":jt("error",u),jt("load",u);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(se in p)if(p.hasOwnProperty(se)&&(b=p[se],b!=null))switch(se){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,f));default:Cn(u,f,se,b,p,null)}return;default:if(N4(f)){for(ye in p)p.hasOwnProperty(ye)&&(b=p[ye],b!==void 0&&wI(u,f,ye,b,p,void 0));return}}for(K in p)p.hasOwnProperty(K)&&(b=p[K],b!=null&&Cn(u,f,K,b,p,null))}function Cge(u,f,p,b){switch(f){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var I=null,A=null,U=null,K=null,Q=null,se=null,ye=null;for(me in p){var Ee=p[me];if(p.hasOwnProperty(me)&&Ee!=null)switch(me){case"checked":break;case"value":break;case"defaultValue":Q=Ee;default:b.hasOwnProperty(me)||Cn(u,f,me,null,b,Ee)}}for(var le in b){var me=b[le];if(Ee=p[le],b.hasOwnProperty(le)&&(me!=null||Ee!=null))switch(le){case"type":A=me;break;case"name":I=me;break;case"checked":se=me;break;case"defaultChecked":ye=me;break;case"value":U=me;break;case"defaultValue":K=me;break;case"children":case"dangerouslySetInnerHTML":if(me!=null)throw Error(r(137,f));break;default:me!==Ee&&Cn(u,f,le,me,b,Ee)}}P4(u,U,K,Q,se,ye,A,I);return;case"select":me=U=K=le=null;for(A in p)if(Q=p[A],p.hasOwnProperty(A)&&Q!=null)switch(A){case"value":break;case"multiple":me=Q;default:b.hasOwnProperty(A)||Cn(u,f,A,null,b,Q)}for(I in b)if(A=b[I],Q=p[I],b.hasOwnProperty(I)&&(A!=null||Q!=null))switch(I){case"value":le=A;break;case"defaultValue":K=A;break;case"multiple":U=A;default:A!==Q&&Cn(u,f,I,A,b,Q)}f=K,p=U,b=me,le!=null?Tm(u,!!p,le,!1):!!b!=!!p&&(f!=null?Tm(u,!!p,f,!0):Tm(u,!!p,p?[]:"",!1));return;case"textarea":me=le=null;for(K in p)if(I=p[K],p.hasOwnProperty(K)&&I!=null&&!b.hasOwnProperty(K))switch(K){case"value":break;case"children":break;default:Cn(u,f,K,null,b,I)}for(U in b)if(I=b[U],A=p[U],b.hasOwnProperty(U)&&(I!=null||A!=null))switch(U){case"value":le=I;break;case"defaultValue":me=I;break;case"children":break;case"dangerouslySetInnerHTML":if(I!=null)throw Error(r(91));break;default:I!==A&&Cn(u,f,U,I,b,A)}yN(u,le,me);return;case"option":for(var qe in p)le=p[qe],p.hasOwnProperty(qe)&&le!=null&&!b.hasOwnProperty(qe)&&(qe==="selected"?u.selected=!1:Cn(u,f,qe,null,b,le));for(Q in b)le=b[Q],me=p[Q],b.hasOwnProperty(Q)&&le!==me&&(le!=null||me!=null)&&(Q==="selected"?u.selected=le&&typeof le!="function"&&typeof le!="symbol":Cn(u,f,Q,le,b,me));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var ct in p)le=p[ct],p.hasOwnProperty(ct)&&le!=null&&!b.hasOwnProperty(ct)&&Cn(u,f,ct,null,b,le);for(se in b)if(le=b[se],me=p[se],b.hasOwnProperty(se)&&le!==me&&(le!=null||me!=null))switch(se){case"children":case"dangerouslySetInnerHTML":if(le!=null)throw Error(r(137,f));break;default:Cn(u,f,se,le,b,me)}return;default:if(N4(f)){for(var Tn in p)le=p[Tn],p.hasOwnProperty(Tn)&&le!==void 0&&!b.hasOwnProperty(Tn)&&wI(u,f,Tn,void 0,b,le);for(ye in b)le=b[ye],me=p[ye],!b.hasOwnProperty(ye)||le===me||le===void 0&&me===void 0||wI(u,f,ye,le,b,me);return}}for(var re in p)le=p[re],p.hasOwnProperty(re)&&le!=null&&!b.hasOwnProperty(re)&&Cn(u,f,re,null,b,le);for(Ee in b)le=b[Ee],me=p[Ee],!b.hasOwnProperty(Ee)||le===me||le==null&&me==null||Cn(u,f,Ee,le,b,me)}function wF(u){switch(u){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Tge(){if(typeof performance.getEntriesByType=="function"){for(var u=0,f=0,p=performance.getEntriesByType("resource"),b=0;b<p.length;b++){var I=p[b],A=I.transferSize,U=I.initiatorType,K=I.duration;if(A&&K&&wF(U)){for(U=0,K=I.responseEnd,b+=1;b<p.length;b++){var Q=p[b],se=Q.startTime;if(se>K)break;var ye=Q.transferSize,Ee=Q.initiatorType;ye&&wF(Ee)&&(Q=Q.responseEnd,U+=ye*(Q<K?1:(K-se)/(Q-se)))}if(--b,f+=8*(A+U)/(I.duration/1e3),u++,10<u)break}}if(0<u)return f/u/1e6}return navigator.connection&&(u=navigator.connection.downlink,typeof u=="number")?u:5}var EI=null,CI=null;function A2(u){return u.nodeType===9?u:u.ownerDocument}function EF(u){switch(u){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function CF(u,f){if(u===0)switch(f){case"svg":return 1;case"math":return 2;default:return 0}return u===1&&f==="foreignObject"?0:u}function TI(u,f){return u==="textarea"||u==="noscript"||typeof f.children=="string"||typeof f.children=="number"||typeof f.children=="bigint"||typeof f.dangerouslySetInnerHTML=="object"&&f.dangerouslySetInnerHTML!==null&&f.dangerouslySetInnerHTML.__html!=null}var RI=null;function Rge(){var u=window.event;return u&&u.type==="popstate"?u===RI?!1:(RI=u,!0):(RI=null,!1)}var TF=typeof setTimeout=="function"?setTimeout:void 0,kge=typeof clearTimeout=="function"?clearTimeout:void 0,RF=typeof Promise=="function"?Promise:void 0,Ige=typeof queueMicrotask=="function"?queueMicrotask:typeof RF<"u"?function(u){return RF.resolve(null).then(u).catch(xge)}:TF;function xge(u){setTimeout(function(){throw u})}function Hd(u){return u==="head"}function kF(u,f){var p=f,b=0;do{var I=p.nextSibling;if(u.removeChild(p),I&&I.nodeType===8)if(p=I.data,p==="/$"||p==="/&"){if(b===0){u.removeChild(I),rg(f);return}b--}else if(p==="$"||p==="$?"||p==="$~"||p==="$!"||p==="&")b++;else if(p==="html")T0(u.ownerDocument.documentElement);else if(p==="head"){p=u.ownerDocument.head,T0(p);for(var A=p.firstChild;A;){var U=A.nextSibling,K=A.nodeName;A[Sh]||K==="SCRIPT"||K==="STYLE"||K==="LINK"&&A.rel.toLowerCase()==="stylesheet"||p.removeChild(A),A=U}}else p==="body"&&T0(u.ownerDocument.body);p=I}while(p);rg(f)}function IF(u,f){var p=u;u=0;do{var b=p.nextSibling;if(p.nodeType===1?f?(p._stashedDisplay=p.style.display,p.style.display="none"):(p.style.display=p._stashedDisplay||"",p.getAttribute("style")===""&&p.removeAttribute("style")):p.nodeType===3&&(f?(p._stashedText=p.nodeValue,p.nodeValue=""):p.nodeValue=p._stashedText||""),b&&b.nodeType===8)if(p=b.data,p==="/$"){if(u===0)break;u--}else p!=="$"&&p!=="$?"&&p!=="$~"&&p!=="$!"||u++;p=b}while(p)}function kI(u){var f=u.firstChild;for(f&&f.nodeType===10&&(f=f.nextSibling);f;){var p=f;switch(f=f.nextSibling,p.nodeName){case"HTML":case"HEAD":case"BODY":kI(p),wh(p);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(p.rel.toLowerCase()==="stylesheet")continue}u.removeChild(p)}}function Age(u,f,p,b){for(;u.nodeType===1;){var I=p;if(u.nodeName.toLowerCase()!==f.toLowerCase()){if(!b&&(u.nodeName!=="INPUT"||u.type!=="hidden"))break}else if(b){if(!u[Sh])switch(f){case"meta":if(!u.hasAttribute("itemprop"))break;return u;case"link":if(A=u.getAttribute("rel"),A==="stylesheet"&&u.hasAttribute("data-precedence"))break;if(A!==I.rel||u.getAttribute("href")!==(I.href==null||I.href===""?null:I.href)||u.getAttribute("crossorigin")!==(I.crossOrigin==null?null:I.crossOrigin)||u.getAttribute("title")!==(I.title==null?null:I.title))break;return u;case"style":if(u.hasAttribute("data-precedence"))break;return u;case"script":if(A=u.getAttribute("src"),(A!==(I.src==null?null:I.src)||u.getAttribute("type")!==(I.type==null?null:I.type)||u.getAttribute("crossorigin")!==(I.crossOrigin==null?null:I.crossOrigin))&&A&&u.hasAttribute("async")&&!u.hasAttribute("itemprop"))break;return u;default:return u}}else if(f==="input"&&u.type==="hidden"){var A=I.name==null?null:""+I.name;if(I.type==="hidden"&&u.getAttribute("name")===A)return u}else return u;if(u=ya(u.nextSibling),u===null)break}return null}function Lge(u,f,p){if(f==="")return null;for(;u.nodeType!==3;)if((u.nodeType!==1||u.nodeName!=="INPUT"||u.type!=="hidden")&&!p||(u=ya(u.nextSibling),u===null))return null;return u}function xF(u,f){for(;u.nodeType!==8;)if((u.nodeType!==1||u.nodeName!=="INPUT"||u.type!=="hidden")&&!f||(u=ya(u.nextSibling),u===null))return null;return u}function II(u){return u.data==="$?"||u.data==="$~"}function xI(u){return u.data==="$!"||u.data==="$?"&&u.ownerDocument.readyState!=="loading"}function Mge(u,f){var p=u.ownerDocument;if(u.data==="$~")u._reactRetry=f;else if(u.data!=="$?"||p.readyState!=="loading")f();else{var b=function(){f(),p.removeEventListener("DOMContentLoaded",b)};p.addEventListener("DOMContentLoaded",b),u._reactRetry=b}}function ya(u){for(;u!=null;u=u.nextSibling){var f=u.nodeType;if(f===1||f===3)break;if(f===8){if(f=u.data,f==="$"||f==="$!"||f==="$?"||f==="$~"||f==="&"||f==="F!"||f==="F")break;if(f==="/$"||f==="/&")return null}}return u}var AI=null;function AF(u){u=u.nextSibling;for(var f=0;u;){if(u.nodeType===8){var p=u.data;if(p==="/$"||p==="/&"){if(f===0)return ya(u.nextSibling);f--}else p!=="$"&&p!=="$!"&&p!=="$?"&&p!=="$~"&&p!=="&"||f++}u=u.nextSibling}return null}function LF(u){u=u.previousSibling;for(var f=0;u;){if(u.nodeType===8){var p=u.data;if(p==="$"||p==="$!"||p==="$?"||p==="$~"||p==="&"){if(f===0)return u;f--}else p!=="/$"&&p!=="/&"||f++}u=u.previousSibling}return null}function MF(u,f,p){switch(f=A2(p),u){case"html":if(u=f.documentElement,!u)throw Error(r(452));return u;case"head":if(u=f.head,!u)throw Error(r(453));return u;case"body":if(u=f.body,!u)throw Error(r(454));return u;default:throw Error(r(451))}}function T0(u){for(var f=u.attributes;f.length;)u.removeAttributeNode(f[0]);wh(u)}var ba=new Map,OF=new Set;function L2(u){return typeof u.getRootNode=="function"?u.getRootNode():u.nodeType===9?u:u.ownerDocument}var lu=$.d;$.d={f:Oge,r:Pge,D:Dge,C:Nge,L:Uge,m:jge,X:$ge,S:Fge,M:Bge};function Oge(){var u=lu.f(),f=w2();return u||f}function Pge(u){var f=wm(u);f!==null&&f.tag===5&&f.type==="form"?XU(f):lu.r(u)}var eg=typeof document>"u"?null:document;function PF(u,f,p){var b=eg;if(b&&typeof f=="string"&&f){var I=da(f);I='link[rel="'+u+'"][href="'+I+'"]',typeof p=="string"&&(I+='[crossorigin="'+p+'"]'),OF.has(I)||(OF.add(I),u={rel:u,crossOrigin:p,href:f},b.querySelector(I)===null&&(f=b.createElement("link"),Ki(f,"link",u),Ti(f),b.head.appendChild(f)))}}function Dge(u){lu.D(u),PF("dns-prefetch",u,null)}function Nge(u,f){lu.C(u,f),PF("preconnect",u,f)}function Uge(u,f,p){lu.L(u,f,p);var b=eg;if(b&&u&&f){var I='link[rel="preload"][as="'+da(f)+'"]';f==="image"&&p&&p.imageSrcSet?(I+='[imagesrcset="'+da(p.imageSrcSet)+'"]',typeof p.imageSizes=="string"&&(I+='[imagesizes="'+da(p.imageSizes)+'"]')):I+='[href="'+da(u)+'"]';var A=I;switch(f){case"style":A=tg(u);break;case"script":A=ng(u)}ba.has(A)||(u=h({rel:"preload",href:f==="image"&&p&&p.imageSrcSet?void 0:u,as:f},p),ba.set(A,u),b.querySelector(I)!==null||f==="style"&&b.querySelector(R0(A))||f==="script"&&b.querySelector(k0(A))||(f=b.createElement("link"),Ki(f,"link",u),Ti(f),b.head.appendChild(f)))}}function jge(u,f){lu.m(u,f);var p=eg;if(p&&u){var b=f&&typeof f.as=="string"?f.as:"script",I='link[rel="modulepreload"][as="'+da(b)+'"][href="'+da(u)+'"]',A=I;switch(b){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":A=ng(u)}if(!ba.has(A)&&(u=h({rel:"modulepreload",href:u},f),ba.set(A,u),p.querySelector(I)===null)){switch(b){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(p.querySelector(k0(A)))return}b=p.createElement("link"),Ki(b,"link",u),Ti(b),p.head.appendChild(b)}}}function Fge(u,f,p){lu.S(u,f,p);var b=eg;if(b&&u){var I=Em(b).hoistableStyles,A=tg(u);f=f||"default";var U=I.get(A);if(!U){var K={loading:0,preload:null};if(U=b.querySelector(R0(A)))K.loading=5;else{u=h({rel:"stylesheet",href:u,"data-precedence":f},p),(p=ba.get(A))&&LI(u,p);var Q=U=b.createElement("link");Ti(Q),Ki(Q,"link",u),Q._p=new Promise(function(se,ye){Q.onload=se,Q.onerror=ye}),Q.addEventListener("load",function(){K.loading|=1}),Q.addEventListener("error",function(){K.loading|=2}),K.loading|=4,M2(U,f,b)}U={type:"stylesheet",instance:U,count:1,state:K},I.set(A,U)}}}function $ge(u,f){lu.X(u,f);var p=eg;if(p&&u){var b=Em(p).hoistableScripts,I=ng(u),A=b.get(I);A||(A=p.querySelector(k0(I)),A||(u=h({src:u,async:!0},f),(f=ba.get(I))&&MI(u,f),A=p.createElement("script"),Ti(A),Ki(A,"link",u),p.head.appendChild(A)),A={type:"script",instance:A,count:1,state:null},b.set(I,A))}}function Bge(u,f){lu.M(u,f);var p=eg;if(p&&u){var b=Em(p).hoistableScripts,I=ng(u),A=b.get(I);A||(A=p.querySelector(k0(I)),A||(u=h({src:u,async:!0,type:"module"},f),(f=ba.get(I))&&MI(u,f),A=p.createElement("script"),Ti(A),Ki(A,"link",u),p.head.appendChild(A)),A={type:"script",instance:A,count:1,state:null},b.set(I,A))}}function DF(u,f,p,b){var I=(I=we.current)?L2(I):null;if(!I)throw Error(r(446));switch(u){case"meta":case"title":return null;case"style":return typeof p.precedence=="string"&&typeof p.href=="string"?(f=tg(p.href),p=Em(I).hoistableStyles,b=p.get(f),b||(b={type:"style",instance:null,count:0,state:null},p.set(f,b)),b):{type:"void",instance:null,count:0,state:null};case"link":if(p.rel==="stylesheet"&&typeof p.href=="string"&&typeof p.precedence=="string"){u=tg(p.href);var A=Em(I).hoistableStyles,U=A.get(u);if(U||(I=I.ownerDocument||I,U={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},A.set(u,U),(A=I.querySelector(R0(u)))&&!A._p&&(U.instance=A,U.state.loading=5),ba.has(u)||(p={rel:"preload",as:"style",href:p.href,crossOrigin:p.crossOrigin,integrity:p.integrity,media:p.media,hrefLang:p.hrefLang,referrerPolicy:p.referrerPolicy},ba.set(u,p),A||Hge(I,u,p,U.state))),f&&b===null)throw Error(r(528,""));return U}if(f&&b!==null)throw Error(r(529,""));return null;case"script":return f=p.async,p=p.src,typeof p=="string"&&f&&typeof f!="function"&&typeof f!="symbol"?(f=ng(p),p=Em(I).hoistableScripts,b=p.get(f),b||(b={type:"script",instance:null,count:0,state:null},p.set(f,b)),b):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,u))}}function tg(u){return'href="'+da(u)+'"'}function R0(u){return'link[rel="stylesheet"]['+u+"]"}function NF(u){return h({},u,{"data-precedence":u.precedence,precedence:null})}function Hge(u,f,p,b){u.querySelector('link[rel="preload"][as="style"]['+f+"]")?b.loading=1:(f=u.createElement("link"),b.preload=f,f.addEventListener("load",function(){return b.loading|=1}),f.addEventListener("error",function(){return b.loading|=2}),Ki(f,"link",p),Ti(f),u.head.appendChild(f))}function ng(u){return'[src="'+da(u)+'"]'}function k0(u){return"script[async]"+u}function UF(u,f,p){if(f.count++,f.instance===null)switch(f.type){case"style":var b=u.querySelector('style[data-href~="'+da(p.href)+'"]');if(b)return f.instance=b,Ti(b),b;var I=h({},p,{"data-href":p.href,"data-precedence":p.precedence,href:null,precedence:null});return b=(u.ownerDocument||u).createElement("style"),Ti(b),Ki(b,"style",I),M2(b,p.precedence,u),f.instance=b;case"stylesheet":I=tg(p.href);var A=u.querySelector(R0(I));if(A)return f.state.loading|=4,f.instance=A,Ti(A),A;b=NF(p),(I=ba.get(I))&&LI(b,I),A=(u.ownerDocument||u).createElement("link"),Ti(A);var U=A;return U._p=new Promise(function(K,Q){U.onload=K,U.onerror=Q}),Ki(A,"link",b),f.state.loading|=4,M2(A,p.precedence,u),f.instance=A;case"script":return A=ng(p.src),(I=u.querySelector(k0(A)))?(f.instance=I,Ti(I),I):(b=p,(I=ba.get(A))&&(b=h({},p),MI(b,I)),u=u.ownerDocument||u,I=u.createElement("script"),Ti(I),Ki(I,"link",b),u.head.appendChild(I),f.instance=I);case"void":return null;default:throw Error(r(443,f.type))}else f.type==="stylesheet"&&(f.state.loading&4)===0&&(b=f.instance,f.state.loading|=4,M2(b,p.precedence,u));return f.instance}function M2(u,f,p){for(var b=p.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),I=b.length?b[b.length-1]:null,A=I,U=0;U<b.length;U++){var K=b[U];if(K.dataset.precedence===f)A=K;else if(A!==I)break}A?A.parentNode.insertBefore(u,A.nextSibling):(f=p.nodeType===9?p.head:p,f.insertBefore(u,f.firstChild))}function LI(u,f){u.crossOrigin==null&&(u.crossOrigin=f.crossOrigin),u.referrerPolicy==null&&(u.referrerPolicy=f.referrerPolicy),u.title==null&&(u.title=f.title)}function MI(u,f){u.crossOrigin==null&&(u.crossOrigin=f.crossOrigin),u.referrerPolicy==null&&(u.referrerPolicy=f.referrerPolicy),u.integrity==null&&(u.integrity=f.integrity)}var O2=null;function jF(u,f,p){if(O2===null){var b=new Map,I=O2=new Map;I.set(p,b)}else I=O2,b=I.get(p),b||(b=new Map,I.set(p,b));if(b.has(u))return b;for(b.set(u,null),p=p.getElementsByTagName(u),I=0;I<p.length;I++){var A=p[I];if(!(A[Sh]||A[Nr]||u==="link"&&A.getAttribute("rel")==="stylesheet")&&A.namespaceURI!=="http://www.w3.org/2000/svg"){var U=A.getAttribute(f)||"";U=u+U;var K=b.get(U);K?K.push(A):b.set(U,[A])}}return b}function FF(u,f,p){u=u.ownerDocument||u,u.head.insertBefore(p,f==="title"?u.querySelector("head > title"):null)}function qge(u,f,p){if(p===1||f.itemProp!=null)return!1;switch(u){case"meta":case"title":return!0;case"style":if(typeof f.precedence!="string"||typeof f.href!="string"||f.href==="")break;return!0;case"link":if(typeof f.rel!="string"||typeof f.href!="string"||f.href===""||f.onLoad||f.onError)break;return f.rel==="stylesheet"?(u=f.disabled,typeof f.precedence=="string"&&u==null):!0;case"script":if(f.async&&typeof f.async!="function"&&typeof f.async!="symbol"&&!f.onLoad&&!f.onError&&f.src&&typeof f.src=="string")return!0}return!1}function $F(u){return!(u.type==="stylesheet"&&(u.state.loading&3)===0)}function Vge(u,f,p,b){if(p.type==="stylesheet"&&(typeof b.media!="string"||matchMedia(b.media).matches!==!1)&&(p.state.loading&4)===0){if(p.instance===null){var I=tg(b.href),A=f.querySelector(R0(I));if(A){f=A._p,f!==null&&typeof f=="object"&&typeof f.then=="function"&&(u.count++,u=P2.bind(u),f.then(u,u)),p.state.loading|=4,p.instance=A,Ti(A);return}A=f.ownerDocument||f,b=NF(b),(I=ba.get(I))&&LI(b,I),A=A.createElement("link"),Ti(A);var U=A;U._p=new Promise(function(K,Q){U.onload=K,U.onerror=Q}),Ki(A,"link",b),p.instance=A}u.stylesheets===null&&(u.stylesheets=new Map),u.stylesheets.set(p,f),(f=p.state.preload)&&(p.state.loading&3)===0&&(u.count++,p=P2.bind(u),f.addEventListener("load",p),f.addEventListener("error",p))}}var OI=0;function Kge(u,f){return u.stylesheets&&u.count===0&&N2(u,u.stylesheets),0<u.count||0<u.imgCount?function(p){var b=setTimeout(function(){if(u.stylesheets&&N2(u,u.stylesheets),u.unsuspend){var A=u.unsuspend;u.unsuspend=null,A()}},6e4+f);0<u.imgBytes&&OI===0&&(OI=62500*Tge());var I=setTimeout(function(){if(u.waitingForImages=!1,u.count===0&&(u.stylesheets&&N2(u,u.stylesheets),u.unsuspend)){var A=u.unsuspend;u.unsuspend=null,A()}},(u.imgBytes>OI?50:800)+f);return u.unsuspend=p,function(){u.unsuspend=null,clearTimeout(b),clearTimeout(I)}}:null}function P2(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)N2(this,this.stylesheets);else if(this.unsuspend){var u=this.unsuspend;this.unsuspend=null,u()}}}var D2=null;function N2(u,f){u.stylesheets=null,u.unsuspend!==null&&(u.count++,D2=new Map,f.forEach(Gge,u),D2=null,P2.call(u))}function Gge(u,f){if(!(f.state.loading&4)){var p=D2.get(u);if(p)var b=p.get(null);else{p=new Map,D2.set(u,p);for(var I=u.querySelectorAll("link[data-precedence],style[data-precedence]"),A=0;A<I.length;A++){var U=I[A];(U.nodeName==="LINK"||U.getAttribute("media")!=="not all")&&(p.set(U.dataset.precedence,U),b=U)}b&&p.set(null,b)}I=f.instance,U=I.getAttribute("data-precedence"),A=p.get(U)||b,A===b&&p.set(null,I),p.set(U,I),this.count++,b=P2.bind(this),I.addEventListener("load",b),I.addEventListener("error",b),A?A.parentNode.insertBefore(I,A.nextSibling):(u=u.nodeType===9?u.head:u,u.insertBefore(I,u.firstChild)),f.state.loading|=4}}var I0={$$typeof:x,Provider:null,Consumer:null,_currentValue:V,_currentValue2:V,_threadCount:0};function zge(u,f,p,b,I,A,U,K,Q){this.tag=1,this.containerInfo=u,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Es(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Es(0),this.hiddenUpdates=Es(null),this.identifierPrefix=b,this.onUncaughtError=I,this.onCaughtError=A,this.onRecoverableError=U,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=Q,this.incompleteTransitions=new Map}function BF(u,f,p,b,I,A,U,K,Q,se,ye,Ee){return u=new zge(u,f,p,U,Q,se,ye,Ee,K),f=1,A===!0&&(f|=24),A=Ao(3,null,null,f),u.current=A,A.stateNode=u,f=fk(),f.refCount++,u.pooledCache=f,f.refCount++,A.memoizedState={element:b,isDehydrated:p,cache:f},gk(A),u}function HF(u){return u?(u=Om,u):Om}function qF(u,f,p,b,I,A){I=HF(I),b.context===null?b.context=I:b.pendingContext=I,b=Ld(f),b.payload={element:p},A=A===void 0?null:A,A!==null&&(b.callback=A),p=Md(u,b,f),p!==null&&(Xs(p,u,f),o0(p,u,f))}function VF(u,f){if(u=u.memoizedState,u!==null&&u.dehydrated!==null){var p=u.retryLane;u.retryLane=p!==0&&p<f?p:f}}function PI(u,f){VF(u,f),(u=u.alternate)&&VF(u,f)}function KF(u){if(u.tag===13||u.tag===31){var f=kh(u,67108864);f!==null&&Xs(f,u,67108864),PI(u,67108864)}}function GF(u){if(u.tag===13||u.tag===31){var f=Do();f=Ve(f);var p=kh(u,f);p!==null&&Xs(p,u,f),PI(u,f)}}var U2=!0;function Wge(u,f,p,b){var I=F.T;F.T=null;var A=$.p;try{$.p=2,DI(u,f,p,b)}finally{$.p=A,F.T=I}}function Yge(u,f,p,b){var I=F.T;F.T=null;var A=$.p;try{$.p=8,DI(u,f,p,b)}finally{$.p=A,F.T=I}}function DI(u,f,p,b){if(U2){var I=NI(b);if(I===null)SI(u,f,b,j2,p),WF(u,b);else if(Jge(I,u,f,p,b))b.stopPropagation();else if(WF(u,b),f&4&&-1<Xge.indexOf(u)){for(;I!==null;){var A=wm(I);if(A!==null)switch(A.tag){case 3:if(A=A.stateNode,A.current.memoizedState.isDehydrated){var U=Mt(A.pendingLanes);if(U!==0){var K=A;for(K.pendingLanes|=2,K.entangledLanes|=2;U;){var Q=1<<31-li(U);K.entanglements[1]|=Q,U&=~Q}el(A),(dn&6)===0&&(_2=wr()+500,w0(0))}}break;case 31:case 13:K=kh(A,2),K!==null&&Xs(K,A,2),w2(),PI(A,2)}if(A=NI(b),A===null&&SI(u,f,b,j2,p),A===I)break;I=A}I!==null&&b.stopPropagation()}else SI(u,f,b,null,p)}}function NI(u){return u=j4(u),UI(u)}var j2=null;function UI(u){if(j2=null,u=Sm(u),u!==null){var f=s(u);if(f===null)u=null;else{var p=f.tag;if(p===13){if(u=o(f),u!==null)return u;u=null}else if(p===31){if(u=a(f),u!==null)return u;u=null}else if(p===3){if(f.stateNode.current.memoizedState.isDehydrated)return f.tag===3?f.stateNode.containerInfo:null;u=null}else f!==u&&(u=null)}}return j2=u,null}function zF(u){switch(u){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(oc()){case Wc:return 2;case Vl:return 8;case Ro:case Yc:return 32;case Kl:return 268435456;default:return 32}default:return 32}}var jI=!1,qd=null,Vd=null,Kd=null,x0=new Map,A0=new Map,Gd=[],Xge="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function WF(u,f){switch(u){case"focusin":case"focusout":qd=null;break;case"dragenter":case"dragleave":Vd=null;break;case"mouseover":case"mouseout":Kd=null;break;case"pointerover":case"pointerout":x0.delete(f.pointerId);break;case"gotpointercapture":case"lostpointercapture":A0.delete(f.pointerId)}}function L0(u,f,p,b,I,A){return u===null||u.nativeEvent!==A?(u={blockedOn:f,domEventName:p,eventSystemFlags:b,nativeEvent:A,targetContainers:[I]},f!==null&&(f=wm(f),f!==null&&KF(f)),u):(u.eventSystemFlags|=b,f=u.targetContainers,I!==null&&f.indexOf(I)===-1&&f.push(I),u)}function Jge(u,f,p,b,I){switch(f){case"focusin":return qd=L0(qd,u,f,p,b,I),!0;case"dragenter":return Vd=L0(Vd,u,f,p,b,I),!0;case"mouseover":return Kd=L0(Kd,u,f,p,b,I),!0;case"pointerover":var A=I.pointerId;return x0.set(A,L0(x0.get(A)||null,u,f,p,b,I)),!0;case"gotpointercapture":return A=I.pointerId,A0.set(A,L0(A0.get(A)||null,u,f,p,b,I)),!0}return!1}function YF(u){var f=Sm(u.target);if(f!==null){var p=s(f);if(p!==null){if(f=p.tag,f===13){if(f=o(p),f!==null){u.blockedOn=f,Wr(u.priority,function(){GF(p)});return}}else if(f===31){if(f=a(p),f!==null){u.blockedOn=f,Wr(u.priority,function(){GF(p)});return}}else if(f===3&&p.stateNode.current.memoizedState.isDehydrated){u.blockedOn=p.tag===3?p.stateNode.containerInfo:null;return}}}u.blockedOn=null}function F2(u){if(u.blockedOn!==null)return!1;for(var f=u.targetContainers;0<f.length;){var p=NI(u.nativeEvent);if(p===null){p=u.nativeEvent;var b=new p.constructor(p.type,p);U4=b,p.target.dispatchEvent(b),U4=null}else return f=wm(p),f!==null&&KF(f),u.blockedOn=p,!1;f.shift()}return!0}function XF(u,f,p){F2(u)&&p.delete(f)}function Qge(){jI=!1,qd!==null&&F2(qd)&&(qd=null),Vd!==null&&F2(Vd)&&(Vd=null),Kd!==null&&F2(Kd)&&(Kd=null),x0.forEach(XF),A0.forEach(XF)}function $2(u,f){u.blockedOn===f&&(u.blockedOn=null,jI||(jI=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,Qge)))}var B2=null;function JF(u){B2!==u&&(B2=u,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){B2===u&&(B2=null);for(var f=0;f<u.length;f+=3){var p=u[f],b=u[f+1],I=u[f+2];if(typeof b!="function"){if(UI(b||p)===null)continue;break}var A=wm(p);A!==null&&(u.splice(f,3),f-=3,Nk(A,{pending:!0,data:I,method:p.method,action:b},b,I))}}))}function rg(u){function f(Q){return $2(Q,u)}qd!==null&&$2(qd,u),Vd!==null&&$2(Vd,u),Kd!==null&&$2(Kd,u),x0.forEach(f),A0.forEach(f);for(var p=0;p<Gd.length;p++){var b=Gd[p];b.blockedOn===u&&(b.blockedOn=null)}for(;0<Gd.length&&(p=Gd[0],p.blockedOn===null);)YF(p),p.blockedOn===null&&Gd.shift();if(p=(u.ownerDocument||u).$$reactFormReplay,p!=null)for(b=0;b<p.length;b+=3){var I=p[b],A=p[b+1],U=I[ir]||null;if(typeof A=="function")U||JF(p);else if(U){var K=null;if(A&&A.hasAttribute("formAction")){if(I=A,U=A[ir]||null)K=U.formAction;else if(UI(I)!==null)continue}else K=U.action;typeof K=="function"?p[b+1]=K:(p.splice(b,3),b-=3),JF(p)}}}function QF(){function u(A){A.canIntercept&&A.info==="react-transition"&&A.intercept({handler:function(){return new Promise(function(U){return I=U})},focusReset:"manual",scroll:"manual"})}function f(){I!==null&&(I(),I=null),b||setTimeout(p,20)}function p(){if(!b&&!navigation.transition){var A=navigation.currentEntry;A&&A.url!=null&&navigation.navigate(A.url,{state:A.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var b=!1,I=null;return navigation.addEventListener("navigate",u),navigation.addEventListener("navigatesuccess",f),navigation.addEventListener("navigateerror",f),setTimeout(p,100),function(){b=!0,navigation.removeEventListener("navigate",u),navigation.removeEventListener("navigatesuccess",f),navigation.removeEventListener("navigateerror",f),I!==null&&(I(),I=null)}}}function FI(u){this._internalRoot=u}H2.prototype.render=FI.prototype.render=function(u){var f=this._internalRoot;if(f===null)throw Error(r(409));var p=f.current,b=Do();qF(p,b,u,f,null,null)},H2.prototype.unmount=FI.prototype.unmount=function(){var u=this._internalRoot;if(u!==null){this._internalRoot=null;var f=u.containerInfo;qF(u.current,2,null,u,null,null),w2(),f[Xc]=null}};function H2(u){this._internalRoot=u}H2.prototype.unstable_scheduleHydration=function(u){if(u){var f=_t();u={blockedOn:null,target:u,priority:f};for(var p=0;p<Gd.length&&f!==0&&f<Gd[p].priority;p++);Gd.splice(p,0,u),p===0&&YF(u)}};var ZF=e.version;if(ZF!=="19.2.3")throw Error(r(527,ZF,"19.2.3"));$.findDOMNode=function(u){var f=u._reactInternals;if(f===void 0)throw typeof u.render=="function"?Error(r(188)):(u=Object.keys(u).join(","),Error(r(268,u)));return u=l(f),u=u!==null?d(u):null,u=u===null?null:u.stateNode,u};var Zge={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:F,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var q2=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!q2.isDisabled&&q2.supportsFiber)try{Ei=q2.inject(Zge),Gr=q2}catch{}}return W0.createRoot=function(u,f){if(!i(u))throw Error(r(299));var p=!1,b="",I=oj,A=aj,U=cj;return f!=null&&(f.unstable_strictMode===!0&&(p=!0),f.identifierPrefix!==void 0&&(b=f.identifierPrefix),f.onUncaughtError!==void 0&&(I=f.onUncaughtError),f.onCaughtError!==void 0&&(A=f.onCaughtError),f.onRecoverableError!==void 0&&(U=f.onRecoverableError)),f=BF(u,1,!1,null,null,p,b,null,I,A,U,QF),u[Xc]=f.current,_I(u),new FI(f)},W0.hydrateRoot=function(u,f,p){if(!i(u))throw Error(r(299));var b=!1,I="",A=oj,U=aj,K=cj,Q=null;return p!=null&&(p.unstable_strictMode===!0&&(b=!0),p.identifierPrefix!==void 0&&(I=p.identifierPrefix),p.onUncaughtError!==void 0&&(A=p.onUncaughtError),p.onCaughtError!==void 0&&(U=p.onCaughtError),p.onRecoverableError!==void 0&&(K=p.onRecoverableError),p.formState!==void 0&&(Q=p.formState)),f=BF(u,1,!0,f,p??null,b,I,Q,A,U,K,QF),f.context=HF(null),p=f.current,b=Do(),b=Ve(b),I=Ld(b),I.callback=null,Md(p,I,b),p=b,f.current.lanes=p,Ci(f,p),el(f),u[Xc]=f.current,_I(u),new H2(f)},W0.version="19.2.3",W0}var oH;function Wbe(){if(oH)return px.exports;oH=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),px.exports=zbe(),px.exports}var Ybe=Wbe(),aH={};function Xbe(t,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(r){if(r!=="default"&&!(r in t)){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}})}),Object.freeze(t)}var Jbe=Object.defineProperty,Qbe=(t,e,n)=>e in t?Jbe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,cH=(t,e,n)=>Qbe(t,typeof e!="symbol"?e+"":e,n);let ps=class{constructor(){cH(this,"_locking"),cH(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let e;const n=new Promise(i=>e=()=>{this._locks-=1,i()}),r=this._locking.then(()=>e);return this._locking=this._locking.then(()=>n),r}};function Mr(t,e){if(!t)throw new Error(e)}const Zbe=34028234663852886e22,e_e=-34028234663852886e22,t_e=4294967295,n_e=2147483647,r_e=-2147483648;function SE(t){if(typeof t!="number")throw new Error("invalid int 32: "+typeof t);if(!Number.isInteger(t)||t>n_e||t<r_e)throw new Error("invalid int 32: "+t)}function JA(t){if(typeof t!="number")throw new Error("invalid uint 32: "+typeof t);if(!Number.isInteger(t)||t>t_e||t<0)throw new Error("invalid uint 32: "+t)}function HQ(t){if(typeof t!="number")throw new Error("invalid float 32: "+typeof t);if(Number.isFinite(t)&&(t>Zbe||t<e_e))throw new Error("invalid float 32: "+t)}const qQ=Symbol("@bufbuild/protobuf/enum-type");function i_e(t){const e=t[qQ];return Mr(e,"missing enum type on enum object"),e}function VQ(t,e,n,r){t[qQ]=KQ(e,n.map(i=>({no:i.no,name:i.name,localName:t[i.no]})))}function KQ(t,e,n){const r=Object.create(null),i=Object.create(null),s=[];for(const o of e){const a=GQ(o);s.push(a),r[o.name]=a,i[o.no]=a}return{typeName:t,values:s,findName(o){return r[o]},findNumber(o){return i[o]}}}function s_e(t,e,n){const r={};for(const i of e){const s=GQ(i);r[s.localName]=s.no,r[s.no]=s.localName}return VQ(r,t,e),r}function GQ(t){return"localName"in t?t:Object.assign(Object.assign({},t),{localName:t.name})}let CP=class{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,n){const r=this.getType(),i=r.runtime.bin,s=i.makeReadOptions(n);return i.readMessage(this,s.readerFactory(e),e.byteLength,s),this}fromJson(e,n){const r=this.getType(),i=r.runtime.json,s=i.makeReadOptions(n);return i.readMessage(r,e,s,this),this}fromJsonString(e,n){let r;try{r=JSON.parse(e)}catch(i){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(i instanceof Error?i.message:String(i)))}return this.fromJson(r,n)}toBinary(e){const n=this.getType(),r=n.runtime.bin,i=r.makeWriteOptions(e),s=i.writerFactory();return r.writeMessage(this,s,i),s.finish()}toJson(e){const n=this.getType(),r=n.runtime.json,i=r.makeWriteOptions(e);return r.writeMessage(this,i)}toJsonString(e){var n;const r=this.toJson(e);return JSON.stringify(r,null,(n=e?.prettySpaces)!==null&&n!==void 0?n:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}};function o_e(t,e,n,r){var i;const s=(i=r?.localName)!==null&&i!==void 0?i:e.substring(e.lastIndexOf(".")+1),o={[s]:function(a){t.util.initFields(this),t.util.initPartial(a,this)}}[s];return Object.setPrototypeOf(o.prototype,new CP),Object.assign(o,{runtime:t,typeName:e,fields:t.util.newFieldList(n),fromBinary(a,c){return new o().fromBinary(a,c)},fromJson(a,c){return new o().fromJson(a,c)},fromJsonString(a,c){return new o().fromJsonString(a,c)},equals(a,c){return t.util.equals(o,a,c)}}),o}function a_e(){let t=0,e=0;for(let r=0;r<28;r+=7){let i=this.buf[this.pos++];if(t|=(i&127)<<r,(i&128)==0)return this.assertBounds(),[t,e]}let n=this.buf[this.pos++];if(t|=(n&15)<<28,e=(n&112)>>4,(n&128)==0)return this.assertBounds(),[t,e];for(let r=3;r<=31;r+=7){let i=this.buf[this.pos++];if(e|=(i&127)<<r,(i&128)==0)return this.assertBounds(),[t,e]}throw new Error("invalid varint")}function yx(t,e,n){for(let s=0;s<28;s=s+7){const o=t>>>s,a=!(!(o>>>7)&&e==0),c=(a?o|128:o)&255;if(n.push(c),!a)return}const r=t>>>28&15|(e&7)<<4,i=e>>3!=0;if(n.push((i?r|128:r)&255),!!i){for(let s=3;s<31;s=s+7){const o=e>>>s,a=!!(o>>>7),c=(a?o|128:o)&255;if(n.push(c),!a)return}n.push(e>>>31&1)}}const wE=4294967296;function lH(t){const e=t[0]==="-";e&&(t=t.slice(1));const n=1e6;let r=0,i=0;function s(o,a){const c=Number(t.slice(o,a));i*=n,r=r*n+c,r>=wE&&(i=i+(r/wE|0),r=r%wE)}return s(-24,-18),s(-18,-12),s(-12,-6),s(-6),e?WQ(r,i):TP(r,i)}function c_e(t,e){let n=TP(t,e);const r=n.hi&2147483648;r&&(n=WQ(n.lo,n.hi));const i=zQ(n.lo,n.hi);return r?"-"+i:i}function zQ(t,e){if({lo:t,hi:e}=l_e(t,e),e<=2097151)return String(wE*e+t);const n=t&16777215,r=(t>>>24|e<<8)&16777215,i=e>>16&65535;let s=n+r*6777216+i*6710656,o=r+i*8147497,a=i*2;const c=1e7;return s>=c&&(o+=Math.floor(s/c),s%=c),o>=c&&(a+=Math.floor(o/c),o%=c),a.toString()+uH(o)+uH(s)}function l_e(t,e){return{lo:t>>>0,hi:e>>>0}}function TP(t,e){return{lo:t|0,hi:e|0}}function WQ(t,e){return e=~e,t?t=~t+1:e+=1,TP(t,e)}const uH=t=>{const e=String(t);return"0000000".slice(e.length)+e};function dH(t,e){if(t>=0){for(;t>127;)e.push(t&127|128),t=t>>>7;e.push(t)}else{for(let n=0;n<9;n++)e.push(t&127|128),t=t>>7;e.push(1)}}function u_e(){let t=this.buf[this.pos++],e=t&127;if((t&128)==0)return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<7,(t&128)==0)return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<14,(t&128)==0)return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<21,(t&128)==0)return this.assertBounds(),e;t=this.buf[this.pos++],e|=(t&15)<<28;for(let n=5;(t&128)!==0&&n<10;n++)t=this.buf[this.pos++];if((t&128)!=0)throw new Error("invalid varint");return this.assertBounds(),e>>>0}function d_e(){const t=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof t.getBigInt64=="function"&&typeof t.getBigUint64=="function"&&typeof t.setBigInt64=="function"&&typeof t.setBigUint64=="function"&&(typeof process!="object"||typeof aH!="object"||aH.BUF_BIGINT_DISABLE!=="1")){const i=BigInt("-9223372036854775808"),s=BigInt("9223372036854775807"),o=BigInt("0"),a=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(c){const l=typeof c=="bigint"?c:BigInt(c);if(l>s||l<i)throw new Error("int64 invalid: ".concat(c));return l},uParse(c){const l=typeof c=="bigint"?c:BigInt(c);if(l>a||l<o)throw new Error("uint64 invalid: ".concat(c));return l},enc(c){return t.setBigInt64(0,this.parse(c),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},uEnc(c){return t.setBigInt64(0,this.uParse(c),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},dec(c,l){return t.setInt32(0,c,!0),t.setInt32(4,l,!0),t.getBigInt64(0,!0)},uDec(c,l){return t.setInt32(0,c,!0),t.setInt32(4,l,!0),t.getBigUint64(0,!0)}}}const n=i=>Mr(/^-?[0-9]+$/.test(i),"int64 invalid: ".concat(i)),r=i=>Mr(/^[0-9]+$/.test(i),"uint64 invalid: ".concat(i));return{zero:"0",supported:!1,parse(i){return typeof i!="string"&&(i=i.toString()),n(i),i},uParse(i){return typeof i!="string"&&(i=i.toString()),r(i),i},enc(i){return typeof i!="string"&&(i=i.toString()),n(i),lH(i)},uEnc(i){return typeof i!="string"&&(i=i.toString()),r(i),lH(i)},dec(i,s){return c_e(i,s)},uDec(i,s){return zQ(i,s)}}}const lr=d_e();var Ce;(function(t){t[t.DOUBLE=1]="DOUBLE",t[t.FLOAT=2]="FLOAT",t[t.INT64=3]="INT64",t[t.UINT64=4]="UINT64",t[t.INT32=5]="INT32",t[t.FIXED64=6]="FIXED64",t[t.FIXED32=7]="FIXED32",t[t.BOOL=8]="BOOL",t[t.STRING=9]="STRING",t[t.BYTES=12]="BYTES",t[t.UINT32=13]="UINT32",t[t.SFIXED32=15]="SFIXED32",t[t.SFIXED64=16]="SFIXED64",t[t.SINT32=17]="SINT32",t[t.SINT64=18]="SINT64"})(Ce||(Ce={}));var Vf;(function(t){t[t.BIGINT=0]="BIGINT",t[t.STRING=1]="STRING"})(Vf||(Vf={}));function Xd(t,e,n){if(e===n)return!0;if(t==Ce.BYTES){if(!(e instanceof Uint8Array)||!(n instanceof Uint8Array)||e.length!==n.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==n[r])return!1;return!0}switch(t){case Ce.UINT64:case Ce.FIXED64:case Ce.INT64:case Ce.SFIXED64:case Ce.SINT64:return e==n}return!1}function Ov(t,e){switch(t){case Ce.BOOL:return!1;case Ce.UINT64:case Ce.FIXED64:case Ce.INT64:case Ce.SFIXED64:case Ce.SINT64:return e==0?lr.zero:"0";case Ce.DOUBLE:case Ce.FLOAT:return 0;case Ce.BYTES:return new Uint8Array(0);case Ce.STRING:return"";default:return 0}}function YQ(t,e){switch(t){case Ce.BOOL:return e===!1;case Ce.STRING:return e==="";case Ce.BYTES:return e instanceof Uint8Array&&!e.byteLength;default:return e==0}}var Br;(function(t){t[t.Varint=0]="Varint",t[t.Bit64=1]="Bit64",t[t.LengthDelimited=2]="LengthDelimited",t[t.StartGroup=3]="StartGroup",t[t.EndGroup=4]="EndGroup",t[t.Bit32=5]="Bit32"})(Br||(Br={}));class f_e{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let i=0;i<this.chunks.length;i++)e+=this.chunks[i].length;let n=new Uint8Array(e),r=0;for(let i=0;i<this.chunks.length;i++)n.set(this.chunks[i],r),r+=this.chunks[i].length;return this.chunks=[],n}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),n=this.stack.pop();if(!n)throw new Error("invalid state, fork stack empty");return this.chunks=n.chunks,this.buf=n.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,n){return this.uint32((e<<3|n)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(JA(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return SE(e),dH(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let n=this.textEncoder.encode(e);return this.uint32(n.byteLength),this.raw(n)}float(e){HQ(e);let n=new Uint8Array(4);return new DataView(n.buffer).setFloat32(0,e,!0),this.raw(n)}double(e){let n=new Uint8Array(8);return new DataView(n.buffer).setFloat64(0,e,!0),this.raw(n)}fixed32(e){JA(e);let n=new Uint8Array(4);return new DataView(n.buffer).setUint32(0,e,!0),this.raw(n)}sfixed32(e){SE(e);let n=new Uint8Array(4);return new DataView(n.buffer).setInt32(0,e,!0),this.raw(n)}sint32(e){return SE(e),e=(e<<1^e>>31)>>>0,dH(e,this.buf),this}sfixed64(e){let n=new Uint8Array(8),r=new DataView(n.buffer),i=lr.enc(e);return r.setInt32(0,i.lo,!0),r.setInt32(4,i.hi,!0),this.raw(n)}fixed64(e){let n=new Uint8Array(8),r=new DataView(n.buffer),i=lr.uEnc(e);return r.setInt32(0,i.lo,!0),r.setInt32(4,i.hi,!0),this.raw(n)}int64(e){let n=lr.enc(e);return yx(n.lo,n.hi,this.buf),this}sint64(e){let n=lr.enc(e),r=n.hi>>31,i=n.lo<<1^r,s=(n.hi<<1|n.lo>>>31)^r;return yx(i,s,this.buf),this}uint64(e){let n=lr.uEnc(e);return yx(n.lo,n.hi,this.buf),this}}class h_e{constructor(e,n){this.varint64=a_e,this.uint32=u_e,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=n??new TextDecoder}tag(){let e=this.uint32(),n=e>>>3,r=e&7;if(n<=0||r<0||r>5)throw new Error("illegal tag: field no "+n+" wire type "+r);return[n,r]}skip(e,n){let r=this.pos;switch(e){case Br.Varint:for(;this.buf[this.pos++]&128;);break;case Br.Bit64:this.pos+=4;case Br.Bit32:this.pos+=4;break;case Br.LengthDelimited:let i=this.uint32();this.pos+=i;break;case Br.StartGroup:for(;;){const[s,o]=this.tag();if(o===Br.EndGroup){if(n!==void 0&&s!==n)throw new Error("invalid end group tag");break}this.skip(o,s)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(r,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return lr.dec(...this.varint64())}uint64(){return lr.uDec(...this.varint64())}sint64(){let[e,n]=this.varint64(),r=-(e&1);return e=(e>>>1|(n&1)<<31)^r,n=n>>>1^r,lr.dec(e,n)}bool(){let[e,n]=this.varint64();return e!==0||n!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return lr.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return lr.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),n=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(n,n+e)}string(){return this.textDecoder.decode(this.bytes())}}function p_e(t,e,n,r){let i;return{typeName:e,extendee:n,get field(){if(!i){const s=typeof r=="function"?r():r;s.name=e.split(".").pop(),s.jsonName="[".concat(e,"]"),i=t.util.newFieldList([s]).list()[0]}return i},runtime:t}}function XQ(t){const e=t.field.localName,n=Object.create(null);return n[e]=m_e(t),[n,()=>n[e]]}function m_e(t){const e=t.field;if(e.repeated)return[];if(e.default!==void 0)return e.default;switch(e.kind){case"enum":return e.T.values[0].no;case"scalar":return Ov(e.T,e.L);case"message":const n=e.T,r=new n;return n.fieldWrapper?n.fieldWrapper.unwrapField(r):r;case"map":throw"map fields are not allowed to be extensions"}}function g_e(t,e){if(!e.repeated&&(e.kind=="enum"||e.kind=="scalar")){for(let n=t.length-1;n>=0;--n)if(t[n].no==e.no)return[t[n]];return[]}return t.filter(n=>n.no===e.no)}let Lu="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),MT=[];for(let t=0;t<Lu.length;t++)MT[Lu[t].charCodeAt(0)]=t;MT[45]=Lu.indexOf("+");MT[95]=Lu.indexOf("/");const JQ={dec(t){let e=t.length*3/4;t[t.length-2]=="="?e-=2:t[t.length-1]=="="&&(e-=1);let n=new Uint8Array(e),r=0,i=0,s,o=0;for(let a=0;a<t.length;a++){if(s=MT[t.charCodeAt(a)],s===void 0)switch(t[a]){case"=":i=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(i){case 0:o=s,i=1;break;case 1:n[r++]=o<<2|(s&48)>>4,o=s,i=2;break;case 2:n[r++]=(o&15)<<4|(s&60)>>2,o=s,i=3;break;case 3:n[r++]=(o&3)<<6|s,i=0;break}}if(i==1)throw Error("invalid base64 string.");return n.subarray(0,r)},enc(t){let e="",n=0,r,i=0;for(let s=0;s<t.length;s++)switch(r=t[s],n){case 0:e+=Lu[r>>2],i=(r&3)<<4,n=1;break;case 1:e+=Lu[i|r>>4],i=(r&15)<<2,n=2;break;case 2:e+=Lu[i|r>>6],e+=Lu[r&63],n=0;break}return n&&(e+=Lu[i],e+="=",n==1&&(e+="=")),e}};function v_e(t,e,n){ZQ(e,t);const r=e.runtime.bin.makeReadOptions(n),i=g_e(t.getType().runtime.bin.listUnknownFields(t),e.field),[s,o]=XQ(e);for(const a of i)e.runtime.bin.readField(s,r.readerFactory(a.data),e.field,a.wireType,r);return o()}function y_e(t,e,n,r){ZQ(e,t);const i=e.runtime.bin.makeReadOptions(r),s=e.runtime.bin.makeWriteOptions(r);if(QQ(t,e)){const l=t.getType().runtime.bin.listUnknownFields(t).filter(d=>d.no!=e.field.no);t.getType().runtime.bin.discardUnknownFields(t);for(const d of l)t.getType().runtime.bin.onUnknownField(t,d.no,d.wireType,d.data)}const o=s.writerFactory();let a=e.field;!a.opt&&!a.repeated&&(a.kind=="enum"||a.kind=="scalar")&&(a=Object.assign(Object.assign({},e.field),{opt:!0})),e.runtime.bin.writeField(a,n,o,s);const c=i.readerFactory(o.finish());for(;c.pos<c.len;){const[l,d]=c.tag(),h=c.skip(d,l);t.getType().runtime.bin.onUnknownField(t,l,d,h)}}function QQ(t,e){const n=t.getType();return e.extendee.typeName===n.typeName&&!!n.runtime.bin.listUnknownFields(t).find(r=>r.no==e.field.no)}function ZQ(t,e){Mr(t.extendee.typeName==e.getType().typeName,"extension ".concat(t.typeName," can only be applied to message ").concat(t.extendee.typeName))}function eZ(t,e){const n=t.localName;if(t.repeated)return e[n].length>0;if(t.oneof)return e[t.oneof.localName].case===n;switch(t.kind){case"enum":case"scalar":return t.opt||t.req?e[n]!==void 0:t.kind=="enum"?e[n]!==t.T.values[0].no:!YQ(t.T,e[n]);case"message":return e[n]!==void 0;case"map":return Object.keys(e[n]).length>0}}function fH(t,e){const n=t.localName,r=!t.opt&&!t.req;if(t.repeated)e[n]=[];else if(t.oneof)e[t.oneof.localName]={case:void 0};else switch(t.kind){case"map":e[n]={};break;case"enum":e[n]=r?t.T.values[0].no:void 0;break;case"scalar":e[n]=r?Ov(t.T,t.L):void 0;break;case"message":e[n]=void 0;break}}function Mu(t,e){if(t===null||typeof t!="object"||!Object.getOwnPropertyNames(CP.prototype).every(r=>r in t&&typeof t[r]=="function"))return!1;const n=t.getType();return n===null||typeof n!="function"||!("typeName"in n)||typeof n.typeName!="string"?!1:e===void 0?!0:n.typeName==e.typeName}function tZ(t,e){return Mu(e)||!t.fieldWrapper?e:t.fieldWrapper.wrapField(e)}Ce.DOUBLE,Ce.FLOAT,Ce.INT64,Ce.UINT64,Ce.INT32,Ce.UINT32,Ce.BOOL,Ce.STRING,Ce.BYTES;const hH={ignoreUnknownFields:!1},pH={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function b_e(t){return t?Object.assign(Object.assign({},hH),t):hH}function __e(t){return t?Object.assign(Object.assign({},pH),t):pH}const jC=Symbol(),EE=Symbol();function S_e(){return{makeReadOptions:b_e,makeWriteOptions:__e,readMessage(t,e,n,r){if(e==null||Array.isArray(e)||typeof e!="object")throw new Error("cannot decode message ".concat(t.typeName," from JSON: ").concat(gl(e)));r=r??new t;const i=new Map,s=n.typeRegistry;for(const[o,a]of Object.entries(e)){const c=t.fields.findJsonName(o);if(c){if(c.oneof){if(a===null&&c.kind=="scalar")continue;const l=i.get(c.oneof);if(l!==void 0)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: multiple keys for oneof "').concat(c.oneof.name,'" present: "').concat(l,'", "').concat(o,'"'));i.set(c.oneof,o)}mH(r,a,c,n,t)}else{let l=!1;if(s?.findExtension&&o.startsWith("[")&&o.endsWith("]")){const d=s.findExtension(o.substring(1,o.length-1));if(d&&d.extendee.typeName==t.typeName){l=!0;const[h,m]=XQ(d);mH(h,a,d.field,n,d),y_e(r,d,m(),n)}}if(!l&&!n.ignoreUnknownFields)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: key "').concat(o,'" is unknown'))}}return r},writeMessage(t,e){const n=t.getType(),r={};let i;try{for(i of n.fields.byNumber()){if(!eZ(i,t)){if(i.req)throw"required field not set";if(!e.emitDefaultValues||!E_e(i))continue}const o=i.oneof?t[i.oneof.localName].value:t[i.localName],a=gH(i,o,e);a!==void 0&&(r[e.useProtoFieldName?i.name:i.jsonName]=a)}const s=e.typeRegistry;if(s?.findExtensionFor)for(const o of n.runtime.bin.listUnknownFields(t)){const a=s.findExtensionFor(n.typeName,o.no);if(a&&QQ(t,a)){const c=v_e(t,a,e),l=gH(a.field,c,e);l!==void 0&&(r[a.field.jsonName]=l)}}}catch(s){const o=i?"cannot encode field ".concat(n.typeName,".").concat(i.name," to JSON"):"cannot encode message ".concat(n.typeName," to JSON"),a=s instanceof Error?s.message:String(s);throw new Error(o+(a.length>0?": ".concat(a):""))}return r},readScalar(t,e,n){return z1(t,e,n??Vf.BIGINT,!0)},writeScalar(t,e,n){if(e!==void 0&&(n||YQ(t,e)))return CE(t,e)},debug:gl}}function gl(t){if(t===null)return"null";switch(typeof t){case"object":return Array.isArray(t)?"array":"object";case"string":return t.length>100?"string":'"'.concat(t.split('"').join('\\"'),'"');default:return String(t)}}function mH(t,e,n,r,i){let s=n.localName;if(n.repeated){if(Mr(n.kind!="map"),e===null)return;if(!Array.isArray(e))throw new Error("cannot decode field ".concat(i.typeName,".").concat(n.name," from JSON: ").concat(gl(e)));const o=t[s];for(const a of e){if(a===null)throw new Error("cannot decode field ".concat(i.typeName,".").concat(n.name," from JSON: ").concat(gl(a)));switch(n.kind){case"message":o.push(n.T.fromJson(a,r));break;case"enum":const c=bx(n.T,a,r.ignoreUnknownFields,!0);c!==EE&&o.push(c);break;case"scalar":try{o.push(z1(n.T,a,n.L,!0))}catch(l){let d="cannot decode field ".concat(i.typeName,".").concat(n.name," from JSON: ").concat(gl(a));throw l instanceof Error&&l.message.length>0&&(d+=": ".concat(l.message)),new Error(d)}break}}}else if(n.kind=="map"){if(e===null)return;if(typeof e!="object"||Array.isArray(e))throw new Error("cannot decode field ".concat(i.typeName,".").concat(n.name," from JSON: ").concat(gl(e)));const o=t[s];for(const[a,c]of Object.entries(e)){if(c===null)throw new Error("cannot decode field ".concat(i.typeName,".").concat(n.name," from JSON: map value null"));let l;try{l=w_e(n.K,a)}catch(d){let h="cannot decode map key for field ".concat(i.typeName,".").concat(n.name," from JSON: ").concat(gl(e));throw d instanceof Error&&d.message.length>0&&(h+=": ".concat(d.message)),new Error(h)}switch(n.V.kind){case"message":o[l]=n.V.T.fromJson(c,r);break;case"enum":const d=bx(n.V.T,c,r.ignoreUnknownFields,!0);d!==EE&&(o[l]=d);break;case"scalar":try{o[l]=z1(n.V.T,c,Vf.BIGINT,!0)}catch(h){let m="cannot decode map value for field ".concat(i.typeName,".").concat(n.name," from JSON: ").concat(gl(e));throw h instanceof Error&&h.message.length>0&&(m+=": ".concat(h.message)),new Error(m)}break}}}else switch(n.oneof&&(t=t[n.oneof.localName]={case:s},s="value"),n.kind){case"message":const o=n.T;if(e===null&&o.typeName!="google.protobuf.Value")return;let a=t[s];Mu(a)?a.fromJson(e,r):(t[s]=a=o.fromJson(e,r),o.fieldWrapper&&!n.oneof&&(t[s]=o.fieldWrapper.unwrapField(a)));break;case"enum":const c=bx(n.T,e,r.ignoreUnknownFields,!1);switch(c){case jC:fH(n,t);break;case EE:break;default:t[s]=c;break}break;case"scalar":try{const l=z1(n.T,e,n.L,!1);l===jC?fH(n,t):t[s]=l}catch(l){let d="cannot decode field ".concat(i.typeName,".").concat(n.name," from JSON: ").concat(gl(e));throw l instanceof Error&&l.message.length>0&&(d+=": ".concat(l.message)),new Error(d)}break}}function w_e(t,e){if(t===Ce.BOOL)switch(e){case"true":e=!0;break;case"false":e=!1;break}return z1(t,e,Vf.BIGINT,!0).toString()}function z1(t,e,n,r){if(e===null)return r?Ov(t,n):jC;switch(t){case Ce.DOUBLE:case Ce.FLOAT:if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""||typeof e=="string"&&e.trim().length!==e.length||typeof e!="string"&&typeof e!="number")break;const i=Number(e);if(Number.isNaN(i)||!Number.isFinite(i))break;return t==Ce.FLOAT&&HQ(i),i;case Ce.INT32:case Ce.FIXED32:case Ce.SFIXED32:case Ce.SINT32:case Ce.UINT32:let s;if(typeof e=="number"?s=e:typeof e=="string"&&e.length>0&&e.trim().length===e.length&&(s=Number(e)),s===void 0)break;return t==Ce.UINT32||t==Ce.FIXED32?JA(s):SE(s),s;case Ce.INT64:case Ce.SFIXED64:case Ce.SINT64:if(typeof e!="number"&&typeof e!="string")break;const o=lr.parse(e);return n?o.toString():o;case Ce.FIXED64:case Ce.UINT64:if(typeof e!="number"&&typeof e!="string")break;const a=lr.uParse(e);return n?a.toString():a;case Ce.BOOL:if(typeof e!="boolean")break;return e;case Ce.STRING:if(typeof e!="string")break;try{encodeURIComponent(e)}catch{throw new Error("invalid UTF8")}return e;case Ce.BYTES:if(e==="")return new Uint8Array(0);if(typeof e!="string")break;return JQ.dec(e)}throw new Error}function bx(t,e,n,r){if(e===null)return t.typeName=="google.protobuf.NullValue"?0:r?t.values[0].no:jC;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const i=t.findName(e);if(i!==void 0)return i.no;if(n)return EE;break}throw new Error("cannot decode enum ".concat(t.typeName," from JSON: ").concat(gl(e)))}function E_e(t){return t.repeated||t.kind=="map"?!0:!(t.oneof||t.kind=="message"||t.opt||t.req)}function gH(t,e,n){if(t.kind=="map"){Mr(typeof e=="object"&&e!=null);const r={},i=Object.entries(e);switch(t.V.kind){case"scalar":for(const[o,a]of i)r[o.toString()]=CE(t.V.T,a);break;case"message":for(const[o,a]of i)r[o.toString()]=a.toJson(n);break;case"enum":const s=t.V.T;for(const[o,a]of i)r[o.toString()]=_x(s,a,n.enumAsInteger);break}return n.emitDefaultValues||i.length>0?r:void 0}if(t.repeated){Mr(Array.isArray(e));const r=[];switch(t.kind){case"scalar":for(let i=0;i<e.length;i++)r.push(CE(t.T,e[i]));break;case"enum":for(let i=0;i<e.length;i++)r.push(_x(t.T,e[i],n.enumAsInteger));break;case"message":for(let i=0;i<e.length;i++)r.push(e[i].toJson(n));break}return n.emitDefaultValues||r.length>0?r:void 0}switch(t.kind){case"scalar":return CE(t.T,e);case"enum":return _x(t.T,e,n.enumAsInteger);case"message":return tZ(t.T,e).toJson(n)}}function _x(t,e,n){var r;if(Mr(typeof e=="number"),t.typeName=="google.protobuf.NullValue")return null;if(n)return e;const i=t.findNumber(e);return(r=i?.name)!==null&&r!==void 0?r:e}function CE(t,e){switch(t){case Ce.INT32:case Ce.SFIXED32:case Ce.SINT32:case Ce.FIXED32:case Ce.UINT32:return Mr(typeof e=="number"),e;case Ce.FLOAT:case Ce.DOUBLE:return Mr(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e;case Ce.STRING:return Mr(typeof e=="string"),e;case Ce.BOOL:return Mr(typeof e=="boolean"),e;case Ce.UINT64:case Ce.FIXED64:case Ce.INT64:case Ce.SFIXED64:case Ce.SINT64:return Mr(typeof e=="bigint"||typeof e=="string"||typeof e=="number"),e.toString();case Ce.BYTES:return Mr(e instanceof Uint8Array),JQ.enc(e)}}const dg=Symbol("@bufbuild/protobuf/unknown-fields"),vH={readUnknownFields:!0,readerFactory:t=>new h_e(t)},yH={writeUnknownFields:!0,writerFactory:()=>new f_e};function C_e(t){return t?Object.assign(Object.assign({},vH),t):vH}function T_e(t){return t?Object.assign(Object.assign({},yH),t):yH}function R_e(){return{makeReadOptions:C_e,makeWriteOptions:T_e,listUnknownFields(t){var e;return(e=t[dg])!==null&&e!==void 0?e:[]},discardUnknownFields(t){delete t[dg]},writeUnknownFields(t,e){const r=t[dg];if(r)for(const i of r)e.tag(i.no,i.wireType).raw(i.data)},onUnknownField(t,e,n,r){const i=t;Array.isArray(i[dg])||(i[dg]=[]),i[dg].push({no:e,wireType:n,data:r})},readMessage(t,e,n,r,i){const s=t.getType(),o=i?e.len:e.pos+n;let a,c;for(;e.pos<o&&([a,c]=e.tag(),!(i===!0&&c==Br.EndGroup));){const l=s.fields.find(a);if(!l){const d=e.skip(c,a);r.readUnknownFields&&this.onUnknownField(t,a,c,d);continue}bH(t,e,l,c,r)}if(i&&(c!=Br.EndGroup||a!==n))throw new Error("invalid end group tag")},readField:bH,writeMessage(t,e,n){const r=t.getType();for(const i of r.fields.byNumber()){if(!eZ(i,t)){if(i.req)throw new Error("cannot encode field ".concat(r.typeName,".").concat(i.name," to binary: required field not set"));continue}const s=i.oneof?t[i.oneof.localName].value:t[i.localName];_H(i,s,e,n)}return n.writeUnknownFields&&this.writeUnknownFields(t,e),e},writeField(t,e,n,r){e!==void 0&&_H(t,e,n,r)}}}function bH(t,e,n,r,i){let{repeated:s,localName:o}=n;switch(n.oneof&&(t=t[n.oneof.localName],t.case!=o&&delete t.value,t.case=o,o="value"),n.kind){case"scalar":case"enum":const a=n.kind=="enum"?Ce.INT32:n.T;let c=FC;if(n.kind=="scalar"&&n.L>0&&(c=I_e),s){let m=t[o];if(r==Br.LengthDelimited&&a!=Ce.STRING&&a!=Ce.BYTES){let y=e.uint32()+e.pos;for(;e.pos<y;)m.push(c(e,a))}else m.push(c(e,a))}else t[o]=c(e,a);break;case"message":const l=n.T;s?t[o].push(TE(e,new l,i,n)):Mu(t[o])?TE(e,t[o],i,n):(t[o]=TE(e,new l,i,n),l.fieldWrapper&&!n.oneof&&!n.repeated&&(t[o]=l.fieldWrapper.unwrapField(t[o])));break;case"map":let[d,h]=k_e(n,e,i);t[o][d]=h;break}}function TE(t,e,n,r){const i=e.getType().runtime.bin,s=r?.delimited;return i.readMessage(e,t,s?r.no:t.uint32(),n,s),e}function k_e(t,e,n){const r=e.uint32(),i=e.pos+r;let s,o;for(;e.pos<i;){const[a]=e.tag();switch(a){case 1:s=FC(e,t.K);break;case 2:switch(t.V.kind){case"scalar":o=FC(e,t.V.T);break;case"enum":o=e.int32();break;case"message":o=TE(e,new t.V.T,n,void 0);break}break}}if(s===void 0&&(s=Ov(t.K,Vf.BIGINT)),typeof s!="string"&&typeof s!="number"&&(s=s.toString()),o===void 0)switch(t.V.kind){case"scalar":o=Ov(t.V.T,Vf.BIGINT);break;case"enum":o=t.V.T.values[0].no;break;case"message":o=new t.V.T;break}return[s,o]}function I_e(t,e){const n=FC(t,e);return typeof n=="bigint"?n.toString():n}function FC(t,e){switch(e){case Ce.STRING:return t.string();case Ce.BOOL:return t.bool();case Ce.DOUBLE:return t.double();case Ce.FLOAT:return t.float();case Ce.INT32:return t.int32();case Ce.INT64:return t.int64();case Ce.UINT64:return t.uint64();case Ce.FIXED64:return t.fixed64();case Ce.BYTES:return t.bytes();case Ce.FIXED32:return t.fixed32();case Ce.SFIXED32:return t.sfixed32();case Ce.SFIXED64:return t.sfixed64();case Ce.SINT64:return t.sint64();case Ce.UINT32:return t.uint32();case Ce.SINT32:return t.sint32()}}function _H(t,e,n,r){Mr(e!==void 0);const i=t.repeated;switch(t.kind){case"scalar":case"enum":let s=t.kind=="enum"?Ce.INT32:t.T;if(i)if(Mr(Array.isArray(e)),t.packed)A_e(n,s,t.no,e);else for(const o of e)W1(n,s,t.no,o);else W1(n,s,t.no,e);break;case"message":if(i){Mr(Array.isArray(e));for(const o of e)SH(n,r,t,o)}else SH(n,r,t,e);break;case"map":Mr(typeof e=="object"&&e!=null);for(const[o,a]of Object.entries(e))x_e(n,r,t,o,a);break}}function x_e(t,e,n,r,i){t.tag(n.no,Br.LengthDelimited),t.fork();let s=r;switch(n.K){case Ce.INT32:case Ce.FIXED32:case Ce.UINT32:case Ce.SFIXED32:case Ce.SINT32:s=Number.parseInt(r);break;case Ce.BOOL:Mr(r=="true"||r=="false"),s=r=="true";break}switch(W1(t,n.K,1,s),n.V.kind){case"scalar":W1(t,n.V.T,2,i);break;case"enum":W1(t,Ce.INT32,2,i);break;case"message":Mr(i!==void 0),t.tag(2,Br.LengthDelimited).bytes(i.toBinary(e));break}t.join()}function SH(t,e,n,r){const i=tZ(n.T,r);n.delimited?t.tag(n.no,Br.StartGroup).raw(i.toBinary(e)).tag(n.no,Br.EndGroup):t.tag(n.no,Br.LengthDelimited).bytes(i.toBinary(e))}function W1(t,e,n,r){Mr(r!==void 0);let[i,s]=nZ(e);t.tag(n,i)[s](r)}function A_e(t,e,n,r){if(!r.length)return;t.tag(n,Br.LengthDelimited).fork();let[,i]=nZ(e);for(let s=0;s<r.length;s++)t[i](r[s]);t.join()}function nZ(t){let e=Br.Varint;switch(t){case Ce.BYTES:case Ce.STRING:e=Br.LengthDelimited;break;case Ce.DOUBLE:case Ce.FIXED64:case Ce.SFIXED64:e=Br.Bit64;break;case Ce.FIXED32:case Ce.SFIXED32:case Ce.FLOAT:e=Br.Bit32;break}const n=Ce[t].toLowerCase();return[e,n]}function L_e(){return{setEnumType:VQ,initPartial(t,e){if(t===void 0)return;const n=e.getType();for(const r of n.fields.byMember()){const i=r.localName,s=e,o=t;if(o[i]!=null)switch(r.kind){case"oneof":const a=o[i].case;if(a===void 0)continue;const c=r.findField(a);let l=o[i].value;c&&c.kind=="message"&&!Mu(l,c.T)?l=new c.T(l):c&&c.kind==="scalar"&&c.T===Ce.BYTES&&(l=Y0(l)),s[i]={case:a,value:l};break;case"scalar":case"enum":let d=o[i];r.T===Ce.BYTES&&(d=r.repeated?d.map(Y0):Y0(d)),s[i]=d;break;case"map":switch(r.V.kind){case"scalar":case"enum":if(r.V.T===Ce.BYTES)for(const[g,y]of Object.entries(o[i]))s[i][g]=Y0(y);else Object.assign(s[i],o[i]);break;case"message":const m=r.V.T;for(const g of Object.keys(o[i])){let y=o[i][g];m.fieldWrapper||(y=new m(y)),s[i][g]=y}break}break;case"message":const h=r.T;if(r.repeated)s[i]=o[i].map(m=>Mu(m,h)?m:new h(m));else{const m=o[i];h.fieldWrapper?h.typeName==="google.protobuf.BytesValue"?s[i]=Y0(m):s[i]=m:s[i]=Mu(m,h)?m:new h(m)}break}}},equals(t,e,n){return e===n?!0:!e||!n?!1:t.fields.byMember().every(r=>{const i=e[r.localName],s=n[r.localName];if(r.repeated){if(i.length!==s.length)return!1;switch(r.kind){case"message":return i.every((o,a)=>r.T.equals(o,s[a]));case"scalar":return i.every((o,a)=>Xd(r.T,o,s[a]));case"enum":return i.every((o,a)=>Xd(Ce.INT32,o,s[a]))}throw new Error("repeated cannot contain ".concat(r.kind))}switch(r.kind){case"message":let o=i,a=s;return r.T.fieldWrapper&&(o!==void 0&&!Mu(o)&&(o=r.T.fieldWrapper.wrapField(o)),a!==void 0&&!Mu(a)&&(a=r.T.fieldWrapper.wrapField(a))),r.T.equals(o,a);case"enum":return Xd(Ce.INT32,i,s);case"scalar":return Xd(r.T,i,s);case"oneof":if(i.case!==s.case)return!1;const c=r.findField(i.case);if(c===void 0)return!0;switch(c.kind){case"message":return c.T.equals(i.value,s.value);case"enum":return Xd(Ce.INT32,i.value,s.value);case"scalar":return Xd(c.T,i.value,s.value)}throw new Error("oneof cannot contain ".concat(c.kind));case"map":const l=Object.keys(i).concat(Object.keys(s));switch(r.V.kind){case"message":const d=r.V.T;return l.every(m=>d.equals(i[m],s[m]));case"enum":return l.every(m=>Xd(Ce.INT32,i[m],s[m]));case"scalar":const h=r.V.T;return l.every(m=>Xd(h,i[m],s[m]))}break}})},clone(t){const e=t.getType(),n=new e,r=n;for(const i of e.fields.byMember()){const s=t[i.localName];let o;if(i.repeated)o=s.map(sw);else if(i.kind=="map"){o=r[i.localName];for(const[a,c]of Object.entries(s))o[a]=sw(c)}else i.kind=="oneof"?o=i.findField(s.case)?{case:s.case,value:sw(s.value)}:{case:void 0}:o=sw(s);r[i.localName]=o}for(const i of e.runtime.bin.listUnknownFields(t))e.runtime.bin.onUnknownField(r,i.no,i.wireType,i.data);return n}}}function sw(t){if(t===void 0)return t;if(Mu(t))return t.clone();if(t instanceof Uint8Array){const e=new Uint8Array(t.byteLength);return e.set(t),e}return t}function Y0(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function M_e(t,e,n){return{syntax:t,json:S_e(),bin:R_e(),util:Object.assign(Object.assign({},L_e()),{newFieldList:e,initFields:n}),makeMessageType(r,i,s){return o_e(this,r,i,s)},makeEnum:s_e,makeEnumType:KQ,getEnumType:i_e,makeExtension(r,i,s){return p_e(this,r,i,s)}}}class O_e{constructor(e,n){this._fields=e,this._normalizer=n}findJsonName(e){if(!this.jsonNames){const n={};for(const r of this.list())n[r.jsonName]=n[r.name]=r;this.jsonNames=n}return this.jsonNames[e]}find(e){if(!this.numbers){const n={};for(const r of this.list())n[r.no]=r;this.numbers=n}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,n)=>e.no-n.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let n;for(const r of this.list())r.oneof?r.oneof!==n&&(n=r.oneof,e.push(n)):e.push(r)}return this.members}}function rZ(t,e){const n=iZ(t);return e?n:F_e(j_e(n))}function P_e(t){return rZ(t,!1)}const D_e=iZ;function iZ(t){let e=!1;const n=[];for(let r=0;r<t.length;r++){let i=t.charAt(r);switch(i){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n.push(i),e=!1;break;default:e&&(e=!1,i=i.toUpperCase()),n.push(i);break}}return n.join("")}const N_e=new Set(["constructor","toString","toJSON","valueOf"]),U_e=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),sZ=t=>"".concat(t,"$"),j_e=t=>U_e.has(t)?sZ(t):t,F_e=t=>N_e.has(t)?sZ(t):t;class $_e{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=P_e(e)}addField(e){Mr(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let n=0;n<this.fields.length;n++)this._lookup[this.fields[n].localName]=this.fields[n]}return this._lookup[e]}}function B_e(t,e){var n,r,i,s,o,a;const c=[];let l;for(const d of typeof t=="function"?t():t){const h=d;if(h.localName=rZ(d.name,d.oneof!==void 0),h.jsonName=(n=d.jsonName)!==null&&n!==void 0?n:D_e(d.name),h.repeated=(r=d.repeated)!==null&&r!==void 0?r:!1,d.kind=="scalar"&&(h.L=(i=d.L)!==null&&i!==void 0?i:Vf.BIGINT),h.delimited=(s=d.delimited)!==null&&s!==void 0?s:!1,h.req=(o=d.req)!==null&&o!==void 0?o:!1,h.opt=(a=d.opt)!==null&&a!==void 0?a:!1,d.packed===void 0&&(h.packed=d.kind=="enum"||d.kind=="scalar"&&d.T!=Ce.BYTES&&d.T!=Ce.STRING),d.oneof!==void 0){const m=typeof d.oneof=="string"?d.oneof:d.oneof.name;(!l||l.name!=m)&&(l=new $_e(m)),h.oneof=l,l.addField(h)}c.push(h)}return c}const oe=M_e("proto3",t=>new O_e(t,e=>B_e(e)),t=>{for(const e of t.getType().fields.byMember()){if(e.opt)continue;const n=e.localName,r=t;if(e.repeated){r[n]=[];continue}switch(e.kind){case"oneof":r[n]={case:void 0};break;case"enum":r[n]=0;break;case"map":r[n]={};break;case"scalar":r[n]=Ov(e.T,e.L);break}}});class ro extends CP{constructor(e){super(),this.seconds=lr.zero,this.nanos=0,oe.util.initPartial(e,this)}fromJson(e,n){if(typeof e!="string")throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(oe.json.debug(e)));const r=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!r)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const i=Date.parse(r[1]+"-"+r[2]+"-"+r[3]+"T"+r[4]+":"+r[5]+":"+r[6]+(r[8]?r[8]:"Z"));if(Number.isNaN(i))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(i<Date.parse("0001-01-01T00:00:00Z")||i>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=lr.parse(i/1e3),this.nanos=0,r[7]&&(this.nanos=parseInt("1"+r[7]+"0".repeat(9-r[7].length))-1e9),this}toJson(e){const n=Number(this.seconds)*1e3;if(n<Date.parse("0001-01-01T00:00:00Z")||n>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let r="Z";if(this.nanos>0){const i=(this.nanos+1e9).toString().substring(1);i.substring(3)==="000000"?r="."+i.substring(0,3)+"Z":i.substring(6)==="000"?r="."+i.substring(0,6)+"Z":r="."+i+"Z"}return new Date(n).toISOString().replace(".000Z",r)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return ro.fromDate(new Date)}static fromDate(e){const n=e.getTime();return new ro({seconds:lr.parse(Math.floor(n/1e3)),nanos:n%1e3*1e6})}static fromBinary(e,n){return new ro().fromBinary(e,n)}static fromJson(e,n){return new ro().fromJson(e,n)}static fromJsonString(e,n){return new ro().fromJsonString(e,n)}static equals(e,n){return oe.util.equals(ro,e,n)}}ro.runtime=oe;ro.typeName="google.protobuf.Timestamp";ro.fields=oe.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);const H_e=oe.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:ro},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:q_e,repeated:!0},{no:5,name:"events",kind:"message",T:K_e,repeated:!0}]),q_e=oe.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:V_e,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]),V_e=oe.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:ro},{no:3,name:"value",kind:"scalar",T:2}]),K_e=oe.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:ro},{no:7,name:"normalized_end_timestamp",kind:"message",T:ro,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]),oZ=oe.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"PREFER_REGRESSION"},{no:1,name:"SIMULCAST"},{no:2,name:"REGRESSION"}]),Tc=oe.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),ni=oe.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),RP=oe.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),x1=oe.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),$b=oe.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),xc=oe.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"},{no:14,name:"CONNECTION_TIMEOUT"},{no:15,name:"MEDIA_FAILURE"}]),ip=oe.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),G_e=oe.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),Di=oe.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"},{no:6,name:"TF_PRECONNECT_BUFFER"}]),OT=oe.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:$C,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:bZ}]),$C=oe.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),z_e=oe.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:oe.getEnumType(ni),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),Ap=oe.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:oe.getEnumType(tv)},{no:4,name:"tracks",kind:"message",T:Ug,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:z_e},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:oe.getEnumType(Bb)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:oe.getEnumType(xc)},{no:18,name:"kind_details",kind:"enum",T:oe.getEnumType(W_e),repeated:!0}]),tv=oe.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),Bb=oe.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"},{no:7,name:"CONNECTOR"}]),W_e=oe.makeEnum("livekit.ParticipantInfo.KindDetail",[{no:0,name:"CLOUD_AGENT"},{no:1,name:"FORWARDED"}]),vi=oe.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),Y_e=oe.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:Lf,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:oe.getEnumType(aZ)},{no:6,name:"sdp_cid",kind:"scalar",T:9}]),Ug=oe.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:oe.getEnumType(Tc)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:oe.getEnumType(ni)},{no:10,name:"layers",kind:"message",T:Lf,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:Y_e,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:oe.getEnumType(vi)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:bZ},{no:19,name:"audio_features",kind:"enum",T:oe.getEnumType(Di),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:oe.getEnumType(oZ)}]),Lf=oe.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:oe.getEnumType(RP)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13},{no:6,name:"spatial_layer",kind:"scalar",T:5},{no:7,name:"rid",kind:"scalar",T:9}]),aZ=oe.makeEnum("livekit.VideoLayer.Mode",[{no:0,name:"MODE_UNUSED"},{no:1,name:"ONE_SPATIAL_LAYER_PER_STREAM"},{no:2,name:"MULTIPLE_SPATIAL_LAYERS_PER_STREAM"},{no:3,name:"ONE_SPATIAL_LAYER_PER_STREAM_INCOMPLETE_RTCP_SR"}]),Ls=oe.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:oe.getEnumType($t)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:kP,oneof:"value"},{no:3,name:"speaker",kind:"message",T:X_e,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:dZ,oneof:"value"},{no:7,name:"transcription",kind:"message",T:J_e,oneof:"value"},{no:8,name:"metrics",kind:"message",T:H_e,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:BC,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:IP,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:xP,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:AP,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:HC,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:qC,oneof:"value"},{no:15,name:"stream_trailer",kind:"message",T:VC,oneof:"value"},{no:18,name:"encrypted_packet",kind:"message",T:cZ,oneof:"value"},{no:16,name:"sequence",kind:"scalar",T:13},{no:17,name:"participant_sid",kind:"scalar",T:9}]),$t=oe.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),cZ=oe.makeMessageType("livekit.EncryptedPacket",()=>[{no:1,name:"encryption_type",kind:"enum",T:oe.getEnumType(vi)},{no:2,name:"iv",kind:"scalar",T:12},{no:3,name:"key_index",kind:"scalar",T:13},{no:4,name:"encrypted_value",kind:"scalar",T:12}]),lZ=oe.makeMessageType("livekit.EncryptedPacketPayload",()=>[{no:1,name:"user",kind:"message",T:kP,oneof:"value"},{no:3,name:"chat_message",kind:"message",T:BC,oneof:"value"},{no:4,name:"rpc_request",kind:"message",T:IP,oneof:"value"},{no:5,name:"rpc_ack",kind:"message",T:xP,oneof:"value"},{no:6,name:"rpc_response",kind:"message",T:AP,oneof:"value"},{no:7,name:"stream_header",kind:"message",T:HC,oneof:"value"},{no:8,name:"stream_chunk",kind:"message",T:qC,oneof:"value"},{no:9,name:"stream_trailer",kind:"message",T:VC,oneof:"value"}]),X_e=oe.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:uZ,repeated:!0}]),uZ=oe.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),kP=oe.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0},{no:11,name:"nonce",kind:"scalar",T:12}]),dZ=oe.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),J_e=oe.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:Q_e,repeated:!0}]),Q_e=oe.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),BC=oe.makeMessageType("livekit.ChatMessage",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]),IP=oe.makeMessageType("livekit.RpcRequest",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]),xP=oe.makeMessageType("livekit.RpcAck",()=>[{no:1,name:"request_id",kind:"scalar",T:9}]),AP=oe.makeMessageType("livekit.RpcResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:fZ,oneof:"value"}]),fZ=oe.makeMessageType("livekit.RpcError",()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]),hZ=oe.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),pZ=oe.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:oe.getEnumType(mZ)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),mZ=oe.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),gZ=oe.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:oe.getEnumType(vZ)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]),vZ=oe.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"},{no:13,name:"UNREAL"},{no:14,name:"ESP32"}]),yZ=oe.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:wH},{no:2,name:"screen",kind:"message",T:wH},{no:3,name:"resume_connection",kind:"enum",T:oe.getEnumType($b)},{no:4,name:"disabled_codecs",kind:"message",T:Z_e},{no:5,name:"force_relay",kind:"enum",T:oe.getEnumType($b)}]),wH=oe.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:oe.getEnumType($b)}]),Z_e=oe.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:$C,repeated:!0},{no:2,name:"publish",kind:"message",T:$C,repeated:!0}]),bZ=oe.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),QA=oe.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),_Z=oe.makeMessageType("livekit.DataStream.TextHeader",()=>[{no:1,name:"operation_type",kind:"enum",T:oe.getEnumType(QA)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}],{localName:"DataStream_TextHeader"}),SZ=oe.makeMessageType("livekit.DataStream.ByteHeader",()=>[{no:1,name:"name",kind:"scalar",T:9}],{localName:"DataStream_ByteHeader"}),HC=oe.makeMessageType("livekit.DataStream.Header",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:oe.getEnumType(vi)},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:_Z,oneof:"content_header"},{no:10,name:"byte_header",kind:"message",T:SZ,oneof:"content_header"}],{localName:"DataStream_Header"}),qC=oe.makeMessageType("livekit.DataStream.Chunk",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"version",kind:"scalar",T:5},{no:5,name:"iv",kind:"scalar",T:12,opt:!0}],{localName:"DataStream_Chunk"}),VC=oe.makeMessageType("livekit.DataStream.Trailer",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"DataStream_Trailer"}),eSe=oe.makeMessageType("livekit.SubscribedAudioCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"enabled",kind:"scalar",T:8}]),Rc=oe.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),ZA=oe.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),tSe=oe.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),nSe=oe.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:Kf,oneof:"message"},{no:2,name:"answer",kind:"message",T:Kf,oneof:"message"},{no:3,name:"trickle",kind:"message",T:PT,oneof:"message"},{no:4,name:"add_track",kind:"message",T:Hb,oneof:"message"},{no:5,name:"mute",kind:"message",T:DT,oneof:"message"},{no:6,name:"subscription",kind:"message",T:NT,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:wZ,oneof:"message"},{no:8,name:"leave",kind:"message",T:UT,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:CZ,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:kZ,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:DP,oneof:"message"},{no:13,name:"simulate",kind:"message",T:fl,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:OP,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:AZ,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:MP,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:EZ,oneof:"message"}]),EH=oe.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:rSe,oneof:"message"},{no:2,name:"answer",kind:"message",T:Kf,oneof:"message"},{no:3,name:"offer",kind:"message",T:Kf,oneof:"message"},{no:4,name:"trickle",kind:"message",T:PT,oneof:"message"},{no:5,name:"update",kind:"message",T:oSe,oneof:"message"},{no:6,name:"track_published",kind:"message",T:LP,oneof:"message"},{no:8,name:"leave",kind:"message",T:UT,oneof:"message"},{no:9,name:"mute",kind:"message",T:DT,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:aSe,oneof:"message"},{no:11,name:"room_update",kind:"message",T:cSe,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:uSe,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:fSe,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:pSe,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:gSe,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:sSe,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:iSe,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:ySe,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:SSe,oneof:"message"},{no:22,name:"request_response",kind:"message",T:wSe,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:ESe,oneof:"message"},{no:24,name:"room_moved",kind:"message",T:vSe,oneof:"message"},{no:25,name:"media_sections_requirement",kind:"message",T:kSe,oneof:"message"},{no:26,name:"subscribed_audio_codec_update",kind:"message",T:mSe,oneof:"message"}]),eL=oe.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:Lf,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:oe.getEnumType(aZ)}]),Hb=oe.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:oe.getEnumType(Tc)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:oe.getEnumType(ni)},{no:9,name:"layers",kind:"message",T:Lf,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:eL,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:oe.getEnumType(vi)},{no:15,name:"stream",kind:"scalar",T:9},{no:16,name:"backup_codec_policy",kind:"enum",T:oe.getEnumType(oZ)},{no:17,name:"audio_features",kind:"enum",T:oe.getEnumType(Di),repeated:!0}]),PT=oe.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:oe.getEnumType(Rc)},{no:3,name:"final",kind:"scalar",T:8}]),DT=oe.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),rSe=oe.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:OT},{no:2,name:"participant",kind:"message",T:Ap},{no:3,name:"other_participants",kind:"message",T:Ap,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:TZ,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:yZ},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:pZ},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:$C,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),iSe=oe.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:TZ,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:yZ},{no:3,name:"server_info",kind:"message",T:pZ},{no:4,name:"last_message_seq",kind:"scalar",T:13}]),LP=oe.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:Ug}]),sSe=oe.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),Kf=oe.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9},{no:3,name:"id",kind:"scalar",T:13},{no:4,name:"mid_to_track_id",kind:"map",K:9,V:{kind:"scalar",T:9}}]),oSe=oe.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:Ap,repeated:!0}]),NT=oe.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:hZ,repeated:!0}]),wZ=oe.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:oe.getEnumType(RP)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),MP=oe.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:oe.getEnumType(Di),repeated:!0}]),EZ=oe.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),UT=oe.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:oe.getEnumType(xc)},{no:3,name:"action",kind:"enum",T:oe.getEnumType(nv)},{no:4,name:"regions",kind:"message",T:bSe}]),nv=oe.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),CZ=oe.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:Lf,repeated:!0}]),OP=oe.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),TZ=oe.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),aSe=oe.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:uZ,repeated:!0}]),cSe=oe.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:OT}]),lSe=oe.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:oe.getEnumType(x1)},{no:3,name:"score",kind:"scalar",T:2}]),uSe=oe.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:lSe,repeated:!0}]),dSe=oe.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:oe.getEnumType(ZA)}]),fSe=oe.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:dSe,repeated:!0}]),PP=oe.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:oe.getEnumType(RP)},{no:2,name:"enabled",kind:"scalar",T:8}]),hSe=oe.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:PP,repeated:!0}]),pSe=oe.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:PP,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:hSe,repeated:!0}]),mSe=oe.makeMessageType("livekit.SubscribedAudioCodecUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_audio_codecs",kind:"message",T:eSe,repeated:!0}]),RZ=oe.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),kZ=oe.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:RZ,repeated:!0}]),gSe=oe.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),vSe=oe.makeMessageType("livekit.RoomMovedResponse",()=>[{no:1,name:"room",kind:"message",T:OT},{no:2,name:"token",kind:"scalar",T:9},{no:3,name:"participant",kind:"message",T:Ap},{no:4,name:"other_participants",kind:"message",T:Ap,repeated:!0}]),DP=oe.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:Kf},{no:2,name:"subscription",kind:"message",T:NT},{no:3,name:"publish_tracks",kind:"message",T:LP,repeated:!0},{no:4,name:"data_channels",kind:"message",T:xZ,repeated:!0},{no:5,name:"offer",kind:"message",T:Kf},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0},{no:7,name:"datachannel_receive_states",kind:"message",T:IZ,repeated:!0}]),IZ=oe.makeMessageType("livekit.DataChannelReceiveState",()=>[{no:1,name:"publisher_sid",kind:"scalar",T:9},{no:2,name:"last_seq",kind:"scalar",T:13}]),xZ=oe.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:oe.getEnumType(Rc)}]),fl=oe.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:oe.getEnumType(tSe),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),AZ=oe.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),ySe=oe.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),bSe=oe.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:_Se,repeated:!0}]),_Se=oe.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),SSe=oe.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:oe.getEnumType(G_e)}]),wSe=oe.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:oe.getEnumType(NP)},{no:3,name:"message",kind:"scalar",T:9},{no:4,name:"trickle",kind:"message",T:PT,oneof:"request"},{no:5,name:"add_track",kind:"message",T:Hb,oneof:"request"},{no:6,name:"mute",kind:"message",T:DT,oneof:"request"},{no:7,name:"update_metadata",kind:"message",T:OP,oneof:"request"},{no:8,name:"update_audio_track",kind:"message",T:MP,oneof:"request"},{no:9,name:"update_video_track",kind:"message",T:EZ,oneof:"request"}]),NP=oe.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"},{no:4,name:"QUEUED"},{no:5,name:"UNSUPPORTED_TYPE"},{no:6,name:"UNCLASSIFIED_ERROR"}]),ESe=oe.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),LZ=oe.makeMessageType("livekit.ConnectionSettings",()=>[{no:1,name:"auto_subscribe",kind:"scalar",T:8},{no:2,name:"adaptive_stream",kind:"scalar",T:8},{no:3,name:"subscriber_allow_pause",kind:"scalar",T:8,opt:!0},{no:4,name:"disable_ice_lite",kind:"scalar",T:8}]),CSe=oe.makeMessageType("livekit.JoinRequest",()=>[{no:1,name:"client_info",kind:"message",T:gZ},{no:2,name:"connection_settings",kind:"message",T:LZ},{no:3,name:"metadata",kind:"scalar",T:9},{no:4,name:"participant_attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:5,name:"add_track_requests",kind:"message",T:Hb,repeated:!0},{no:6,name:"publisher_offer",kind:"message",T:Kf},{no:7,name:"reconnect",kind:"scalar",T:8},{no:8,name:"reconnect_reason",kind:"enum",T:oe.getEnumType(ip)},{no:9,name:"participant_sid",kind:"scalar",T:9},{no:10,name:"sync_state",kind:"message",T:DP}]),TSe=oe.makeMessageType("livekit.WrappedJoinRequest",()=>[{no:1,name:"compression",kind:"enum",T:oe.getEnumType(RSe)},{no:2,name:"join_request",kind:"scalar",T:12}]),RSe=oe.makeEnum("livekit.WrappedJoinRequest.Compression",[{no:0,name:"NONE"},{no:1,name:"GZIP"}]),kSe=oe.makeMessageType("livekit.MediaSectionsRequirement",()=>[{no:1,name:"num_audios",kind:"scalar",T:13},{no:2,name:"num_videos",kind:"scalar",T:13}]);function ISe(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var RE={exports:{}},xSe=RE.exports,CH;function ASe(){return CH||(CH=1,(function(t){(function(e,n){t.exports?t.exports=n():e.log=n()})(xSe,function(){var e=function(){},n="undefined",r=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"],s={},o=null;function a(v,E){var w=v[E];if(typeof w.bind=="function")return w.bind(v);try{return Function.prototype.bind.call(w,v)}catch{return function(){return Function.prototype.apply.apply(w,[v,arguments])}}}function c(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(v){return v==="debug"&&(v="log"),typeof console===n?!1:v==="trace"&&r?c:console[v]!==void 0?a(console,v):console.log!==void 0?a(console,"log"):e}function d(){for(var v=this.getLevel(),E=0;E<i.length;E++){var w=i[E];this[w]=E<v?e:this.methodFactory(w,v,this.name)}if(this.log=this.debug,typeof console===n&&v<this.levels.SILENT)return"No console available for logging"}function h(v){return function(){typeof console!==n&&(d.call(this),this[v].apply(this,arguments))}}function m(v,E,w){return l(v)||h.apply(this,arguments)}function g(v,E){var w=this,R,x,C,k="loglevel";typeof v=="string"?k+=":"+v:typeof v=="symbol"&&(k=void 0);function T(j){var H=(i[j]||"silent").toUpperCase();if(!(typeof window===n||!k)){try{window.localStorage[k]=H;return}catch{}try{window.document.cookie=encodeURIComponent(k)+"="+H+";"}catch{}}}function L(){var j;if(!(typeof window===n||!k)){try{j=window.localStorage[k]}catch{}if(typeof j===n)try{var H=window.document.cookie,z=encodeURIComponent(k),Y=H.indexOf(z+"=");Y!==-1&&(j=/^([^;]+)/.exec(H.slice(Y+z.length+1))[1])}catch{}return w.levels[j]===void 0&&(j=void 0),j}}function O(){if(!(typeof window===n||!k)){try{window.localStorage.removeItem(k)}catch{}try{window.document.cookie=encodeURIComponent(k)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function P(j){var H=j;if(typeof H=="string"&&w.levels[H.toUpperCase()]!==void 0&&(H=w.levels[H.toUpperCase()]),typeof H=="number"&&H>=0&&H<=w.levels.SILENT)return H;throw new TypeError("log.setLevel() called with invalid level: "+j)}w.name=v,w.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},w.methodFactory=E||m,w.getLevel=function(){return C??x??R},w.setLevel=function(j,H){return C=P(j),H!==!1&&T(C),d.call(w)},w.setDefaultLevel=function(j){x=P(j),L()||w.setLevel(j,!1)},w.resetLevel=function(){C=null,O(),d.call(w)},w.enableAll=function(j){w.setLevel(w.levels.TRACE,j)},w.disableAll=function(j){w.setLevel(w.levels.SILENT,j)},w.rebuild=function(){if(o!==w&&(R=P(o.getLevel())),d.call(w),o===w)for(var j in s)s[j].rebuild()},R=P(o?o.getLevel():"WARN");var D=L();D!=null&&(C=P(D)),d.call(w)}o=new g,o.getLogger=function(E){if(typeof E!="symbol"&&typeof E!="string"||E==="")throw new TypeError("You must supply a name when creating a logger.");var w=s[E];return w||(w=s[E]=new g(E,o.methodFactory)),w};var y=typeof window!==n?window.log:void 0;return o.noConflict=function(){return typeof window!==n&&window.log===o&&(window.log=y),o},o.getLoggers=function(){return s},o.default=o,o})})(RE)),RE.exports}var U_=ASe(),qb;(function(t){t[t.trace=0]="trace",t[t.debug=1]="debug",t[t.info=2]="info",t[t.warn=3]="warn",t[t.error=4]="error",t[t.silent=5]="silent"})(qb||(qb={}));var Nc;(function(t){t.Default="livekit",t.Room="livekit-room",t.TokenSource="livekit-token-source",t.Participant="livekit-participant",t.Track="livekit-track",t.Publication="livekit-track-publication",t.Engine="livekit-engine",t.Signal="livekit-signal",t.PCManager="livekit-pc-manager",t.PCTransport="livekit-pc-transport",t.E2EE="lk-e2ee"})(Nc||(Nc={}));let kt=U_.getLogger("livekit");const MZ=Object.values(Nc).map(t=>U_.getLogger(t));kt.setDefaultLevel(qb.info);function ed(t){const e=U_.getLogger(t);return e.setDefaultLevel(kt.getLevel()),e}function OZ(t,e){if(e)U_.getLogger(e).setLevel(t);else for(const n of MZ)n.setLevel(t)}function LSe(t,e){MZ.forEach(r=>{const i=r.methodFactory;r.methodFactory=(s,o,a)=>{const c=i(s,o,a),l=qb[s],d=l>=o&&l<qb.silent;return(h,m)=>{m?c(h,m):c(h),d&&t(l,h,m)}},r.setLevel(r.getLevel())})}const MSe=U_.getLogger("lk-e2ee"),X0=7e3,OSe=[0,300,4*300,9*300,16*300,X0,X0,X0,X0,X0];class PZ{constructor(e){this._retryDelays=e!==void 0?[...e]:OSe}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const n=this._retryDelays[e.retryCount];return e.retryCount<=1?n:n+Math.random()*1e3}}function PSe(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}function X(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(d){try{l(r.next(d))}catch(h){o(h)}}function c(d){try{l(r.throw(d))}catch(h){o(h)}}function l(d){d.done?s(d.value):i(d.value).then(a,c)}l((r=r.apply(t,e||[])).next())})}function TH(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ou(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof TH=="function"?TH(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(s){n[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(l){s({value:l,done:a})},o)}}var ow={exports:{}},RH;function DSe(){if(RH)return ow.exports;RH=1;var t=typeof Reflect=="object"?Reflect:null,e=t&&typeof t.apply=="function"?t.apply:function(k,T,L){return Function.prototype.apply.call(k,T,L)},n;t&&typeof t.ownKeys=="function"?n=t.ownKeys:Object.getOwnPropertySymbols?n=function(k){return Object.getOwnPropertyNames(k).concat(Object.getOwnPropertySymbols(k))}:n=function(k){return Object.getOwnPropertyNames(k)};function r(C){console&&console.warn&&console.warn(C)}var i=Number.isNaN||function(k){return k!==k};function s(){s.init.call(this)}ow.exports=s,ow.exports.once=w,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function a(C){if(typeof C!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof C)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(C){if(typeof C!="number"||C<0||i(C))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+C+".");o=C}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(k){if(typeof k!="number"||k<0||i(k))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+k+".");return this._maxListeners=k,this};function c(C){return C._maxListeners===void 0?s.defaultMaxListeners:C._maxListeners}s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(k){for(var T=[],L=1;L<arguments.length;L++)T.push(arguments[L]);var O=k==="error",P=this._events;if(P!==void 0)O=O&&P.error===void 0;else if(!O)return!1;if(O){var D;if(T.length>0&&(D=T[0]),D instanceof Error)throw D;var j=new Error("Unhandled error."+(D?" ("+D.message+")":""));throw j.context=D,j}var H=P[k];if(H===void 0)return!1;if(typeof H=="function")e(H,this,T);else for(var z=H.length,Y=y(H,z),L=0;L<z;++L)e(Y[L],this,T);return!0};function l(C,k,T,L){var O,P,D;if(a(T),P=C._events,P===void 0?(P=C._events=Object.create(null),C._eventsCount=0):(P.newListener!==void 0&&(C.emit("newListener",k,T.listener?T.listener:T),P=C._events),D=P[k]),D===void 0)D=P[k]=T,++C._eventsCount;else if(typeof D=="function"?D=P[k]=L?[T,D]:[D,T]:L?D.unshift(T):D.push(T),O=c(C),O>0&&D.length>O&&!D.warned){D.warned=!0;var j=new Error("Possible EventEmitter memory leak detected. "+D.length+" "+String(k)+" listeners added. Use emitter.setMaxListeners() to increase limit");j.name="MaxListenersExceededWarning",j.emitter=C,j.type=k,j.count=D.length,r(j)}return C}s.prototype.addListener=function(k,T){return l(this,k,T,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(k,T){return l(this,k,T,!0)};function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(C,k,T){var L={fired:!1,wrapFn:void 0,target:C,type:k,listener:T},O=d.bind(L);return O.listener=T,L.wrapFn=O,O}s.prototype.once=function(k,T){return a(T),this.on(k,h(this,k,T)),this},s.prototype.prependOnceListener=function(k,T){return a(T),this.prependListener(k,h(this,k,T)),this},s.prototype.removeListener=function(k,T){var L,O,P,D,j;if(a(T),O=this._events,O===void 0)return this;if(L=O[k],L===void 0)return this;if(L===T||L.listener===T)--this._eventsCount===0?this._events=Object.create(null):(delete O[k],O.removeListener&&this.emit("removeListener",k,L.listener||T));else if(typeof L!="function"){for(P=-1,D=L.length-1;D>=0;D--)if(L[D]===T||L[D].listener===T){j=L[D].listener,P=D;break}if(P<0)return this;P===0?L.shift():v(L,P),L.length===1&&(O[k]=L[0]),O.removeListener!==void 0&&this.emit("removeListener",k,j||T)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(k){var T,L,O;if(L=this._events,L===void 0)return this;if(L.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):L[k]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete L[k]),this;if(arguments.length===0){var P=Object.keys(L),D;for(O=0;O<P.length;++O)D=P[O],D!=="removeListener"&&this.removeAllListeners(D);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(T=L[k],typeof T=="function")this.removeListener(k,T);else if(T!==void 0)for(O=T.length-1;O>=0;O--)this.removeListener(k,T[O]);return this};function m(C,k,T){var L=C._events;if(L===void 0)return[];var O=L[k];return O===void 0?[]:typeof O=="function"?T?[O.listener||O]:[O]:T?E(O):y(O,O.length)}s.prototype.listeners=function(k){return m(this,k,!0)},s.prototype.rawListeners=function(k){return m(this,k,!1)},s.listenerCount=function(C,k){return typeof C.listenerCount=="function"?C.listenerCount(k):g.call(C,k)},s.prototype.listenerCount=g;function g(C){var k=this._events;if(k!==void 0){var T=k[C];if(typeof T=="function")return 1;if(T!==void 0)return T.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function y(C,k){for(var T=new Array(k),L=0;L<k;++L)T[L]=C[L];return T}function v(C,k){for(;k+1<C.length;k++)C[k]=C[k+1];C.pop()}function E(C){for(var k=new Array(C.length),T=0;T<k.length;++T)k[T]=C[T].listener||C[T];return k}function w(C,k){return new Promise(function(T,L){function O(D){C.removeListener(k,P),L(D)}function P(){typeof C.removeListener=="function"&&C.removeListener("error",O),T([].slice.call(arguments))}x(C,k,P,{once:!0}),k!=="error"&&R(C,O,{once:!0})})}function R(C,k,T){typeof C.on=="function"&&x(C,"error",k,T)}function x(C,k,T,L){if(typeof C.on=="function")L.once?C.once(k,T):C.on(k,T);else if(typeof C.addEventListener=="function")C.addEventListener(k,function O(P){L.once&&C.removeEventListener(k,O),T(P)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof C)}return ow.exports}var jl=DSe();let DZ=!0,NZ=!0;function A1(t,e,n){const r=t.match(e);return r&&r.length>=n&&parseFloat(r[n],10)}function Zp(t,e,n){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(o,a){if(o!==e)return i.apply(this,arguments);const c=l=>{const d=n(l);d&&(a.handleEvent?a.handleEvent(d):a(d))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(a,c),i.apply(this,[o,c])};const s=r.removeEventListener;r.removeEventListener=function(o,a){if(o!==e||!this._eventMap||!this._eventMap[e])return s.apply(this,arguments);if(!this._eventMap[e].has(a))return s.apply(this,arguments);const c=this._eventMap[e].get(a);return this._eventMap[e].delete(a),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[o,c])},Object.defineProperty(r,"on"+e,{get(){return this["_on"+e]},set(o){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),o&&this.addEventListener(e,this["_on"+e]=o)},enumerable:!0,configurable:!0})}function NSe(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(DZ=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function USe(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(NZ=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function UZ(){if(typeof window=="object"){if(DZ)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function UP(t,e){NZ&&console.warn(t+" is deprecated, please use "+e+" instead.")}function jSe(t){const e={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:n}=t;if(n.userAgentData&&n.userAgentData.brands){const r=n.userAgentData.brands.find(i=>i.brand==="Chromium");if(r)return{browser:"chrome",version:parseInt(r.version,10)}}if(n.mozGetUserMedia)e.browser="firefox",e.version=parseInt(A1(n.userAgent,/Firefox\/(\d+)\./,1));else if(n.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)e.browser="chrome",e.version=parseInt(A1(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(t.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=parseInt(A1(n.userAgent,/AppleWebKit\/(\d+)\./,1)),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype,e._safariVersion=A1(n.userAgent,/Version\/(\d+(\.?\d+))/,1);else return e.browser="Not a supported browser.",e;return e}function kH(t){return Object.prototype.toString.call(t)==="[object Object]"}function jZ(t){return kH(t)?Object.keys(t).reduce(function(e,n){const r=kH(t[n]),i=r?jZ(t[n]):t[n],s=r&&!Object.keys(i).length;return i===void 0||s?e:Object.assign(e,{[n]:i})},{}):t}function tL(t,e,n){!e||n.has(e.id)||(n.set(e.id,e),Object.keys(e).forEach(r=>{r.endsWith("Id")?tL(t,t.get(e[r]),n):r.endsWith("Ids")&&e[r].forEach(i=>{tL(t,t.get(i),n)})}))}function IH(t,e,n){const r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(e===null)return i;const s=[];return t.forEach(o=>{o.type==="track"&&o.trackIdentifier===e.id&&s.push(o)}),s.forEach(o=>{t.forEach(a=>{a.type===r&&a.trackId===o.id&&tL(t,a,i)})}),i}const xH=UZ;function FZ(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const r=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;const c={};return Object.keys(a).forEach(l=>{if(l==="require"||l==="advanced"||l==="mediaSource")return;const d=typeof a[l]=="object"?a[l]:{ideal:a[l]};d.exact!==void 0&&typeof d.exact=="number"&&(d.min=d.max=d.exact);const h=function(m,g){return m?m+g.charAt(0).toUpperCase()+g.slice(1):g==="deviceId"?"sourceId":g};if(d.ideal!==void 0){c.optional=c.optional||[];let m={};typeof d.ideal=="number"?(m[h("min",l)]=d.ideal,c.optional.push(m),m={},m[h("max",l)]=d.ideal,c.optional.push(m)):(m[h("",l)]=d.ideal,c.optional.push(m))}d.exact!==void 0&&typeof d.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[h("",l)]=d.exact):["min","max"].forEach(m=>{d[m]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[h(m,l)]=d[m])})}),a.advanced&&(c.optional=(c.optional||[]).concat(a.advanced)),c},i=function(a,c){if(e.version>=61)return c(a);if(a=JSON.parse(JSON.stringify(a)),a&&typeof a.audio=="object"){const l=function(d,h,m){h in d&&!(m in d)&&(d[m]=d[h],delete d[h])};a=JSON.parse(JSON.stringify(a)),l(a.audio,"autoGainControl","googAutoGainControl"),l(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=r(a.audio)}if(a&&typeof a.video=="object"){let l=a.video.facingMode;l=l&&(typeof l=="object"?l:{ideal:l});const d=e.version<66;if(l&&(l.exact==="user"||l.exact==="environment"||l.ideal==="user"||l.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!d)){delete a.video.facingMode;let h;if(l.exact==="environment"||l.ideal==="environment"?h=["back","rear"]:(l.exact==="user"||l.ideal==="user")&&(h=["front"]),h)return n.mediaDevices.enumerateDevices().then(m=>{m=m.filter(y=>y.kind==="videoinput");let g=m.find(y=>h.some(v=>y.label.toLowerCase().includes(v)));return!g&&m.length&&h.includes("back")&&(g=m[m.length-1]),g&&(a.video.deviceId=l.exact?{exact:g.deviceId}:{ideal:g.deviceId}),a.video=r(a.video),xH("chrome: "+JSON.stringify(a)),c(a)})}a.video=r(a.video)}return xH("chrome: "+JSON.stringify(a)),c(a)},s=function(a){return e.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(a,c,l){i(a,d=>{n.webkitGetUserMedia(d,c,h=>{l&&l(s(h))})})};if(n.getUserMedia=o.bind(n),n.mediaDevices.getUserMedia){const a=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(c){return i(c,l=>a(l).then(d=>{if(l.audio&&!d.getAudioTracks().length||l.video&&!d.getVideoTracks().length)throw d.getTracks().forEach(h=>{h.stop()}),new DOMException("","NotFoundError");return d},d=>Promise.reject(s(d))))}}}function $Z(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function BZ(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",i=>{let s;t.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===i.track.id):s={track:i.track};const o=new Event("track");o.track=i.track,o.receiver=s,o.transceiver={receiver:s},o.streams=[r.stream],this.dispatchEvent(o)}),r.stream.getTracks().forEach(i=>{let s;t.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===i.id):s={track:i};const o=new Event("track");o.track=i,o.receiver=s,o.transceiver={receiver:s},o.streams=[r.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else Zp(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function HZ(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(i,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=i.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:i}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(a,c){let l=i.apply(this,arguments);return l||(l=e(this,a),this._senders.push(l)),l};const s=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(a){s.apply(this,arguments);const c=this._senders.indexOf(a);c!==-1&&this._senders.splice(c,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],n.apply(this,[s]),s.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],r.apply(this,[s]),s.getTracks().forEach(o=>{const a=this._senders.find(c=>c.track===o);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(i=>i._pc=this),r},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function qZ(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const s=n.apply(this,[]);return s.forEach(o=>o._pc=this),s});const r=t.RTCPeerConnection.prototype.addTrack;r&&(t.RTCPeerConnection.prototype.addTrack=function(){const s=r.apply(this,arguments);return s._pc=this,s}),t.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then(o=>IH(o,s.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const i=n.apply(this,[]);return i.forEach(s=>s._pc=this),i}),Zp(t,"track",r=>(r.receiver._pc=r.srcElement,r)),t.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(s=>IH(s,i.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const r=arguments[0];let i,s,o;return this.getSenders().forEach(a=>{a.track===r&&(i?o=!0:i=a)}),this.getReceivers().forEach(a=>(a.track===r&&(s?o=!0:s=a),a.track===r)),o||i&&s?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():s?s.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function VZ(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(o,a){if(!a)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=e.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(c)===-1&&this._shimmedLocalStreams[a.id].push(c):this._shimmedLocalStreams[a.id]=[a,c],c};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(l=>{if(this.getSenders().find(h=>h.track===l))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();n.apply(this,arguments);const c=this.getSenders().filter(l=>a.indexOf(l)===-1);this._shimmedLocalStreams[o.id]=[o].concat(c)};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],r.apply(this,arguments)};const i=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const c=this._shimmedLocalStreams[a].indexOf(o);c!==-1&&this._shimmedLocalStreams[a].splice(c,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),i.apply(this,arguments)}}function KZ(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return VZ(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const d=n.apply(this);return this._reverseStreams=this._reverseStreams||{},d.map(h=>this._reverseStreams[h.id])};const r=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(d){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},d.getTracks().forEach(h=>{if(this.getSenders().find(g=>g.track===h))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[d.id]){const h=new t.MediaStream(d.getTracks());this._streams[d.id]=h,this._reverseStreams[h.id]=d,d=h}r.apply(this,[d])};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(d){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[d.id]||d]),delete this._reverseStreams[this._streams[d.id]?this._streams[d.id].id:d.id],delete this._streams[d.id]},t.RTCPeerConnection.prototype.addTrack=function(d,h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const m=[].slice.call(arguments,1);if(m.length!==1||!m[0].getTracks().find(v=>v===d))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(v=>v.track===d))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const y=this._streams[h.id];if(y)y.addTrack(d),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const v=new t.MediaStream([d]);this._streams[h.id]=v,this._reverseStreams[v.id]=h,this.addStream(v)}return this.getSenders().find(v=>v.track===d)};function s(l,d){let h=d.sdp;return Object.keys(l._reverseStreams||[]).forEach(m=>{const g=l._reverseStreams[m],y=l._streams[g.id];h=h.replace(new RegExp(y.id,"g"),g.id)}),new RTCSessionDescription({type:d.type,sdp:h})}function o(l,d){let h=d.sdp;return Object.keys(l._reverseStreams||[]).forEach(m=>{const g=l._reverseStreams[m],y=l._streams[g.id];h=h.replace(new RegExp(g.id,"g"),y.id)}),new RTCSessionDescription({type:d.type,sdp:h})}["createOffer","createAnswer"].forEach(function(l){const d=t.RTCPeerConnection.prototype[l],h={[l](){const m=arguments;return arguments.length&&typeof arguments[0]=="function"?d.apply(this,[y=>{const v=s(this,y);m[0].apply(null,[v])},y=>{m[1]&&m[1].apply(null,y)},arguments[2]]):d.apply(this,arguments).then(y=>s(this,y))}};t.RTCPeerConnection.prototype[l]=h[l]});const a=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?a.apply(this,arguments):(arguments[0]=o(this,arguments[0]),a.apply(this,arguments))};const c=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const l=c.get.apply(this);return l.type===""?l:s(this,l)}}),t.RTCPeerConnection.prototype.removeTrack=function(d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!d._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(d._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let m;Object.keys(this._streams).forEach(g=>{this._streams[g].getTracks().find(v=>d.track===v)&&(m=this._streams[g])}),m&&(m.getTracks().length===1?this.removeStream(this._reverseStreams[m.id]):m.removeTrack(d.track),this.dispatchEvent(new Event("negotiationneeded")))}}function nL(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const r=t.RTCPeerConnection.prototype[n],i={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=i[n]})}function GZ(t,e){Zp(t,"negotiationneeded",n=>{const r=n.target;if(!((e.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")&&r.signalingState!=="stable"))return n})}var AH=Object.freeze({__proto__:null,fixNegotiationNeeded:GZ,shimAddTrackRemoveTrack:KZ,shimAddTrackRemoveTrackWithNative:VZ,shimGetSendersWithDtmf:HZ,shimGetUserMedia:FZ,shimMediaStream:$Z,shimOnTrack:BZ,shimPeerConnection:nL,shimSenderReceiverGetStats:qZ});function zZ(t,e){const n=t&&t.navigator,r=t&&t.MediaStreamTrack;if(n.getUserMedia=function(i,s,o){UP("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(i).then(s,o)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const i=function(o,a,c){a in o&&!(c in o)&&(o[c]=o[a],delete o[a])},s=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),i(o.audio,"autoGainControl","mozAutoGainControl"),i(o.audio,"noiseSuppression","mozNoiseSuppression")),s(o)},r&&r.prototype.getSettings){const o=r.prototype.getSettings;r.prototype.getSettings=function(){const a=o.apply(this,arguments);return i(a,"mozAutoGainControl","autoGainControl"),i(a,"mozNoiseSuppression","noiseSuppression"),a}}if(r&&r.prototype.applyConstraints){const o=r.prototype.applyConstraints;r.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),i(a,"autoGainControl","mozAutoGainControl"),i(a,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[a])}}}}function FSe(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(r){if(!(r&&r.video)){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Promise.reject(i)}return r.video===!0?r.video={mediaSource:e}:r.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(r)})}function WZ(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function rL(t,e){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const s=t.RTCPeerConnection.prototype[i],o={[i](){return arguments[0]=new(i==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};t.RTCPeerConnection.prototype[i]=o[i]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[s,o,a]=arguments;return r.apply(this,[s||null]).then(c=>{if(e.version<53&&!o)try{c.forEach(l=>{l.type=n[l.type]||l.type})}catch(l){if(l.name!=="TypeError")throw l;c.forEach((d,h)=>{c.set(h,Object.assign({},d,{type:n[d.type]||d.type}))})}return c}).then(o,a)}}function YZ(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(s=>s._pc=this),i});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const i=n.apply(this,arguments);return i._pc=this,i}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function XZ(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const r=e.apply(this,[]);return r.forEach(i=>i._pc=this),r}),Zp(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function JZ(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){UP("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&n.getTracks().includes(r.track)&&this.removeTrack(r)})})}function QZ(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function ZZ(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];const i=r.length>0;i&&r.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const s=e.apply(this,arguments);if(i){const{sender:o}=s,a=o.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=r,o.sendEncodings=r,this.setParametersPromises.push(o.setParameters(a).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return s})}function eee(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const r=e.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function tee(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function nee(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var LH=Object.freeze({__proto__:null,shimAddTransceiver:ZZ,shimCreateAnswer:nee,shimCreateOffer:tee,shimGetDisplayMedia:FSe,shimGetParameters:eee,shimGetUserMedia:zZ,shimOnTrack:WZ,shimPeerConnection:rL,shimRTCDataChannel:QZ,shimReceiverGetStats:XZ,shimRemoveStream:JZ,shimSenderGetStats:YZ});function ree(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(i=>e.call(this,i,r)),r.getVideoTracks().forEach(i=>e.call(this,i,r))},t.RTCPeerConnection.prototype.addTrack=function(r){for(var i=arguments.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];return s&&s.forEach(a=>{this._localStreams?this._localStreams.includes(a)||this._localStreams.push(a):this._localStreams=[a]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(n);if(r===-1)return;this._localStreams.splice(r,1);const i=n.getTracks();this.getSenders().forEach(s=>{i.includes(s.track)&&this.removeTrack(s)})})}}function iee(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(i=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(i))return;this._remoteStreams.push(i);const s=new Event("addstream");s.stream=i,this.dispatchEvent(s)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(s=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(s)>=0)return;r._remoteStreams.push(s);const o=new Event("addstream");o.stream=s,r.dispatchEvent(o)})}),e.apply(r,arguments)}}}function see(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,r=e.createAnswer,i=e.setLocalDescription,s=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(l,d){const h=arguments.length>=2?arguments[2]:arguments[0],m=n.apply(this,[h]);return d?(m.then(l,d),Promise.resolve()):m},e.createAnswer=function(l,d){const h=arguments.length>=2?arguments[2]:arguments[0],m=r.apply(this,[h]);return d?(m.then(l,d),Promise.resolve()):m};let a=function(c,l,d){const h=i.apply(this,[c]);return d?(h.then(l,d),Promise.resolve()):h};e.setLocalDescription=a,a=function(c,l,d){const h=s.apply(this,[c]);return d?(h.then(l,d),Promise.resolve()):h},e.setRemoteDescription=a,a=function(c,l,d){const h=o.apply(this,[c]);return d?(h.then(l,d),Promise.resolve()):h},e.addIceCandidate=a}function oee(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,r=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=i=>r(aee(i))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(r,i,s){e.mediaDevices.getUserMedia(r).then(i,s)}).bind(e))}function aee(t){return t&&t.video!==void 0?Object.assign({},t,{video:jZ(t.video)}):t}function cee(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(r,i){if(r&&r.iceServers){const s=[];for(let o=0;o<r.iceServers.length;o++){let a=r.iceServers[o];a.urls===void 0&&a.url?(UP("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,s.push(a)):s.push(r.iceServers[o])}r.iceServers=s}return new e(r,i)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function lee(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function uee(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(r){if(r){typeof r.offerToReceiveAudio<"u"&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const i=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):r.offerToReceiveAudio===!0&&!i&&this.addTransceiver("audio",{direction:"recvonly"}),typeof r.offerToReceiveVideo<"u"&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const s=this.getTransceivers().find(o=>o.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):r.offerToReceiveVideo===!0&&!s&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function dee(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var MH=Object.freeze({__proto__:null,shimAudioContext:dee,shimCallbacksAPI:see,shimConstraints:aee,shimCreateOfferLegacy:uee,shimGetUserMedia:oee,shimLocalStreamsAPI:ree,shimRTCIceServerUrls:cee,shimRemoteStreamsAPI:iee,shimTrackEventTransceiver:lee}),Sx={exports:{}},OH;function $Se(){return OH||(OH=1,(function(t){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(r=>r.trim())},e.splitSections=function(n){return n.split(`
m=`).map((i,s)=>(s>0?"m="+i:i).trim()+`\r
`)},e.getDescription=function(n){const r=e.splitSections(n);return r&&r[0]},e.getMediaSections=function(n){const r=e.splitSections(n);return r.shift(),r},e.matchPrefix=function(n,r){return e.splitLines(n).filter(i=>i.indexOf(r)===0)},e.parseCandidate=function(n){let r;n.indexOf("a=candidate:")===0?r=n.substring(12).split(" "):r=n.substring(10).split(" ");const i={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let s=8;s<r.length;s+=2)switch(r[s]){case"raddr":i.relatedAddress=r[s+1];break;case"rport":i.relatedPort=parseInt(r[s+1],10);break;case"tcptype":i.tcpType=r[s+1];break;case"ufrag":i.ufrag=r[s+1],i.usernameFragment=r[s+1];break;default:i[r[s]]===void 0&&(i[r[s]]=r[s+1]);break}return i},e.writeCandidate=function(n){const r=[];r.push(n.foundation);const i=n.component;i==="rtp"?r.push(1):i==="rtcp"?r.push(2):r.push(i),r.push(n.protocol.toUpperCase()),r.push(n.priority),r.push(n.address||n.ip),r.push(n.port);const s=n.type;return r.push("typ"),r.push(s),s!=="host"&&n.relatedAddress&&n.relatedPort&&(r.push("raddr"),r.push(n.relatedAddress),r.push("rport"),r.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(r.push("ufrag"),r.push(n.usernameFragment||n.ufrag)),"candidate:"+r.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let r=n.substring(9).split(" ");const i={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),i.name=r[0],i.clockRate=parseInt(r[1],10),i.channels=r.length===3?parseInt(r[2],10):1,i.numChannels=i.channels,i},e.writeRtpMap=function(n){let r=n.payloadType;n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType);const i=n.channels||n.numChannels||1;return"a=rtpmap:"+r+" "+n.name+"/"+n.clockRate+(i!==1?"/"+i:"")+`\r
`},e.parseExtmap=function(n){const r=n.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const r={};let i;const s=n.substring(n.indexOf(" ")+1).split(";");for(let o=0;o<s.length;o++)i=s[o].trim().split("="),r[i[0].trim()]=i[1];return r},e.writeFmtp=function(n){let r="",i=n.payloadType;if(n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const s=[];Object.keys(n.parameters).forEach(o=>{n.parameters[o]!==void 0?s.push(o+"="+n.parameters[o]):s.push(o)}),r+="a=fmtp:"+i+" "+s.join(";")+`\r
`}return r},e.parseRtcpFb=function(n){const r=n.substring(n.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},e.writeRtcpFb=function(n){let r="",i=n.payloadType;return n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(s=>{r+="a=rtcp-fb:"+i+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),r},e.parseSsrcMedia=function(n){const r=n.indexOf(" "),i={ssrc:parseInt(n.substring(7,r),10)},s=n.indexOf(":",r);return s>-1?(i.attribute=n.substring(r+1,s),i.value=n.substring(s+1)):i.attribute=n.substring(r+1),i},e.parseSsrcGroup=function(n){const r=n.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(i=>parseInt(i,10))}},e.getMid=function(n){const r=e.matchPrefix(n,"a=mid:")[0];if(r)return r.substring(6)},e.parseFingerprint=function(n){const r=n.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},e.getDtlsParameters=function(n,r){return{role:"auto",fingerprints:e.matchPrefix(n+r,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,r){let i="a=setup:"+r+`\r
`;return n.fingerprints.forEach(s=>{i+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),i},e.parseCryptoLine=function(n){const r=n.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const r=n.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,r){return e.matchPrefix(n+r,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,r){const i=e.matchPrefix(n+r,"a=ice-ufrag:")[0],s=e.matchPrefix(n+r,"a=ice-pwd:")[0];return i&&s?{usernameFragment:i.substring(12),password:s.substring(10)}:null},e.writeIceParameters=function(n){let r="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(r+=`a=ice-lite\r
`),r},e.parseRtpParameters=function(n){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=e.splitLines(n)[0].split(" ");r.profile=s[2];for(let a=3;a<s.length;a++){const c=s[a],l=e.matchPrefix(n,"a=rtpmap:"+c+" ")[0];if(l){const d=e.parseRtpMap(l),h=e.matchPrefix(n,"a=fmtp:"+c+" ");switch(d.parameters=h.length?e.parseFmtp(h[0]):{},d.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+c+" ").map(e.parseRtcpFb),r.codecs.push(d),d.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(d.name.toUpperCase());break}}}e.matchPrefix(n,"a=extmap:").forEach(a=>{r.headerExtensions.push(e.parseExtmap(a))});const o=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return r.codecs.forEach(a=>{o.forEach(c=>{a.rtcpFeedback.find(d=>d.type===c.type&&d.parameter===c.parameter)||a.rtcpFeedback.push(c)})}),r},e.writeRtpDescription=function(n,r){let i="";i+="m="+n+" ",i+=r.codecs.length>0?"9":"0",i+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=r.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,i+=`c=IN IP4 0.0.0.0\r
`,i+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(o=>{i+=e.writeRtpMap(o),i+=e.writeFmtp(o),i+=e.writeRtcpFb(o)});let s=0;return r.codecs.forEach(o=>{o.maxptime>s&&(s=o.maxptime)}),s>0&&(i+="a=maxptime:"+s+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(o=>{i+=e.writeExtmap(o)}),i},e.parseRtpEncodingParameters=function(n){const r=[],i=e.parseRtpParameters(n),s=i.fecMechanisms.indexOf("RED")!==-1,o=i.fecMechanisms.indexOf("ULPFEC")!==-1,a=e.matchPrefix(n,"a=ssrc:").map(m=>e.parseSsrcMedia(m)).filter(m=>m.attribute==="cname"),c=a.length>0&&a[0].ssrc;let l;const d=e.matchPrefix(n,"a=ssrc-group:FID").map(m=>m.substring(17).split(" ").map(y=>parseInt(y,10)));d.length>0&&d[0].length>1&&d[0][0]===c&&(l=d[0][1]),i.codecs.forEach(m=>{if(m.name.toUpperCase()==="RTX"&&m.parameters.apt){let g={ssrc:c,codecPayloadType:parseInt(m.parameters.apt,10)};c&&l&&(g.rtx={ssrc:l}),r.push(g),s&&(g=JSON.parse(JSON.stringify(g)),g.fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},r.push(g))}}),r.length===0&&c&&r.push({ssrc:c});let h=e.matchPrefix(n,"b=");return h.length&&(h[0].indexOf("b=TIAS:")===0?h=parseInt(h[0].substring(7),10):h[0].indexOf("b=AS:")===0?h=parseInt(h[0].substring(5),10)*1e3*.95-2e3*8:h=void 0,r.forEach(m=>{m.maxBitrate=h})),r},e.parseRtcpParameters=function(n){const r={},i=e.matchPrefix(n,"a=ssrc:").map(a=>e.parseSsrcMedia(a)).filter(a=>a.attribute==="cname")[0];i&&(r.cname=i.value,r.ssrc=i.ssrc);const s=e.matchPrefix(n,"a=rtcp-rsize");r.reducedSize=s.length>0,r.compound=s.length===0;const o=e.matchPrefix(n,"a=rtcp-mux");return r.mux=o.length>0,r},e.writeRtcpParameters=function(n){let r="";return n.reducedSize&&(r+=`a=rtcp-rsize\r
`),n.mux&&(r+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(r+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),r},e.parseMsid=function(n){let r;const i=e.matchPrefix(n,"a=msid:");if(i.length===1)return r=i[0].substring(7).split(" "),{stream:r[0],track:r[1]};const s=e.matchPrefix(n,"a=ssrc:").map(o=>e.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");if(s.length>0)return r=s[0].value.split(" "),{stream:r[0],track:r[1]}},e.parseSctpDescription=function(n){const r=e.parseMLine(n),i=e.matchPrefix(n,"a=max-message-size:");let s;i.length>0&&(s=parseInt(i[0].substring(19),10)),isNaN(s)&&(s=65536);const o=e.matchPrefix(n,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:r.fmt,maxMessageSize:s};const a=e.matchPrefix(n,"a=sctpmap:");if(a.length>0){const c=a[0].substring(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:s}}},e.writeSctpDescription=function(n,r){let i=[];return n.protocol!=="DTLS/SCTP"?i=["m="+n.kind+" 9 "+n.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:i=["m="+n.kind+" 9 "+n.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&i.push("a=max-message-size:"+r.maxMessageSize+`\r
`),i.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,r,i){let s;const o=r!==void 0?r:2;return n?s=n:s=e.generateSessionId(),`v=0\r
o=`+(i||"thisisadapterortc")+" "+s+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,r){const i=e.splitLines(n);for(let s=0;s<i.length;s++)switch(i[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[s].substring(2)}return r?e.getDirection(r):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const i=e.splitLines(n)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},e.parseOLine=function(n){const i=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const r=e.splitLines(n);for(let i=0;i<r.length;i++)if(r[i].length<2||r[i].charAt(1)!=="=")return!1;return!0},t.exports=e})(Sx)),Sx.exports}var fee=$Se(),rv=ISe(fee),BSe=Xbe({__proto__:null,default:rv},[fee]);function kE(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&(r=JSON.parse(JSON.stringify(r)),r.candidate=r.candidate.substring(2)),r.candidate&&r.candidate.length){const i=new e(r),s=rv.parseCandidate(r.candidate);for(const o in s)o in i||Object.defineProperty(i,o,{value:s[o]});return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new e(r)},t.RTCIceCandidate.prototype=e.prototype,Zp(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function iL(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||Zp(t,"icecandidate",e=>{if(e.candidate){const n=rv.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function IE(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(a){if(!a||!a.sdp)return!1;const c=rv.splitSections(a.sdp);return c.shift(),c.some(l=>{const d=rv.parseMLine(l);return d&&d.kind==="application"&&d.protocol.indexOf("SCTP")!==-1})},r=function(a){const c=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const l=parseInt(c[1],10);return l!==l?-1:l},i=function(a){let c=65536;return e.browser==="firefox"&&(e.version<57?a===-1?c=16384:c=2147483637:e.version<60?c=e.version===57?65535:65536:c=2147483637),c},s=function(a,c){let l=65536;e.browser==="firefox"&&e.version===57&&(l=65535);const d=rv.matchPrefix(a.sdp,"a=max-message-size:");return d.length>0?l=parseInt(d[0].substring(19),10):e.browser==="firefox"&&c!==-1&&(l=2147483637),l},o=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const c=r(arguments[0]),l=i(c),d=s(arguments[0],c);let h;l===0&&d===0?h=Number.POSITIVE_INFINITY:l===0||d===0?h=Math.max(l,d):h=Math.min(l,d);const m={};Object.defineProperty(m,"maxMessageSize",{get(){return h}}),this._sctp=m}return o.apply(this,arguments)}}function xE(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function e(r,i){const s=r.send;r.send=function(){const a=arguments[0],c=a.length||a.size||a.byteLength;if(r.readyState==="open"&&i.sctp&&c>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return s.apply(r,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const i=n.apply(this,arguments);return e(i,this),i},Zp(t,"datachannel",r=>(e(r.channel,r.target),r))}function sL(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const r=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{const s=i.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const o=new Event("connectionstatechange",i);s.dispatchEvent(o)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function oL(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e._safariVersion>=13.1)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const s=i.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&i instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:i.type,sdp:s}):i.sdp=s}return n.apply(this,arguments)}}function AE(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function LE(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return n.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer";break}return i.sdp||i.type!=="offer"&&i.type!=="answer"?n.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>n.apply(this,[o]))})}var HSe=Object.freeze({__proto__:null,removeExtmapAllowMixed:oL,shimAddIceCandidateNullOrEmpty:AE,shimConnectionState:sL,shimMaxMessageSize:IE,shimParameterlessSetLocalDescription:LE,shimRTCIceCandidate:kE,shimRTCIceCandidateRelayProtocol:iL,shimSendThrowTypeError:xE});function qSe(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=UZ,r=jSe(t),i={browserDetails:r,commonShim:HSe,extractVersion:A1,disableLog:NSe,disableWarnings:USe,sdp:BSe};switch(r.browser){case"chrome":if(!AH||!nL||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),i;if(r.version===null)return n("Chrome shim can not determine version, not shimming."),i;n("adapter.js shimming chrome."),i.browserShim=AH,AE(t,r),LE(t),FZ(t,r),$Z(t),nL(t,r),BZ(t),KZ(t,r),HZ(t),qZ(t),GZ(t,r),kE(t),iL(t),sL(t),IE(t,r),xE(t),oL(t,r);break;case"firefox":if(!LH||!rL||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),i;n("adapter.js shimming firefox."),i.browserShim=LH,AE(t,r),LE(t),zZ(t,r),rL(t,r),WZ(t),JZ(t),YZ(t),XZ(t),QZ(t),ZZ(t),eee(t),tee(t),nee(t),kE(t),sL(t),IE(t,r),xE(t);break;case"safari":if(!MH||!e.shimSafari)return n("Safari shim is not included in this adapter release."),i;n("adapter.js shimming safari."),i.browserShim=MH,AE(t,r),LE(t),cee(t),uee(t),see(t),ree(t),iee(t),lee(t),oee(t),dee(t),kE(t),iL(t),IE(t,r),xE(t),oL(t,r);break;default:n("Unsupported browser!");break}return i}qSe({window:typeof window>"u"?void 0:window});const VSe=10,J0="lk_e2ee",KSe="LKFrameEncryptionKey",GSe={sharedKey:!1,ratchetSalt:KSe,ratchetWindowSize:8,failureTolerance:VSe,keyringSize:16};var Mf;(function(t){t.SetKey="setKey",t.RatchetRequest="ratchetRequest",t.KeyRatcheted="keyRatcheted"})(Mf||(Mf={}));var PH;(function(t){t.KeyRatcheted="keyRatcheted"})(PH||(PH={}));var Sf;(function(t){t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError"})(Sf||(Sf={}));var DH;(function(t){t.Error="cryptorError"})(DH||(DH={}));function hee(){return zSe()||aL()}function aL(){return typeof window.RTCRtpScriptTransform<"u"}function zSe(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}function WSe(t){return X(this,void 0,void 0,function*(){let e=new TextEncoder;return yield crypto.subtle.importKey("raw",e.encode(t),{name:"PBKDF2"},!1,["deriveBits","deriveKey"])})}function YSe(t){return X(this,void 0,void 0,function*(){return yield crypto.subtle.importKey("raw",t,"HKDF",!1,["deriveBits","deriveKey"])})}function XSe(t){var e,n,r,i,s;if(((e=t.value)===null||e===void 0?void 0:e.case)!=="sipDtmf"&&((n=t.value)===null||n===void 0?void 0:n.case)!=="metrics"&&((r=t.value)===null||r===void 0?void 0:r.case)!=="speaker"&&((i=t.value)===null||i===void 0?void 0:i.case)!=="transcription"&&((s=t.value)===null||s===void 0?void 0:s.case)!=="encryptedPacket")return new lZ({value:t.value})}class pee extends jl.EventEmitter{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.onKeyRatcheted=(n,r,i)=>{kt.debug("key ratcheted event received",{ratchetResult:n,participantId:r,keyIndex:i})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},GSe),e),this.on(Mf.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(e,n,r){const i={key:e,participantIdentity:n,keyIndex:r};if(!this.options.sharedKey&&!n)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(n??"shared","-").concat(r??0),i),this.emit(Mf.SetKey,i)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(e,n){this.emit(Mf.RatchetRequest,e,n)}}class JSe extends pee{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=Object.assign(Object.assign({},e),{sharedKey:!0,ratchetWindowSize:0,failureTolerance:-1});super(n)}setKey(e){return X(this,void 0,void 0,function*(){const n=typeof e=="string"?yield WSe(e):yield YSe(e);this.onSetEncryptionKey(n)})}}class pd extends Error{constructor(e,n){super(n||"an error has occured"),this.name="LiveKitError",this.code=e}}var wt;(function(t){t[t.NotAllowed=0]="NotAllowed",t[t.ServerUnreachable=1]="ServerUnreachable",t[t.InternalError=2]="InternalError",t[t.Cancelled=3]="Cancelled",t[t.LeaveRequest=4]="LeaveRequest",t[t.Timeout=5]="Timeout"})(wt||(wt={}));class Bt extends pd{constructor(e,n,r,i){super(1,e),this.name="ConnectionError",this.status=r,this.reason=n,this.context=i,this.reasonName=wt[n]}}class jP extends pd{constructor(e){super(21,e??"device is unsupported"),this.name="DeviceUnsupportedError"}}class Pu extends pd{constructor(e){super(20,e??"track is invalid"),this.name="TrackInvalidError"}}class QSe extends pd{constructor(e){super(10,e??"unsupported server"),this.name="UnsupportedServer"}}class di extends pd{constructor(e){super(12,e??"unexpected connection state"),this.name="UnexpectedConnectionState"}}class cL extends pd{constructor(e){super(13,e??"unable to negotiate"),this.name="NegotiationError"}}class NH extends pd{constructor(e,n){super(15,e),this.name="PublishTrackError",this.status=n}}class UH extends pd{constructor(e,n){super(15,e),this.reason=n,this.reasonName=typeof n=="string"?n:NP[n]}}var ks;(function(t){t[t.AlreadyOpened=0]="AlreadyOpened",t[t.AbnormalEnd=1]="AbnormalEnd",t[t.DecodeFailed=2]="DecodeFailed",t[t.LengthExceeded=3]="LengthExceeded",t[t.Incomplete=4]="Incomplete",t[t.HandlerAlreadyRegistered=7]="HandlerAlreadyRegistered",t[t.EncryptionTypeMismatch=8]="EncryptionTypeMismatch"})(ks||(ks={}));class ka extends pd{constructor(e,n){super(16,e),this.name="DataStreamError",this.reason=n,this.reasonName=ks[n]}}var Vb;(function(t){t.PermissionDenied="PermissionDenied",t.NotFound="NotFound",t.DeviceInUse="DeviceInUse",t.Other="Other"})(Vb||(Vb={}));(function(t){function e(n){if(n&&"name"in n)return n.name==="NotFoundError"||n.name==="DevicesNotFoundError"?t.NotFound:n.name==="NotAllowedError"||n.name==="PermissionDeniedError"?t.PermissionDenied:n.name==="NotReadableError"||n.name==="TrackStartError"?t.DeviceInUse:t.Other}t.getFailure=e})(Vb||(Vb={}));var jH;(function(t){t[t.InvalidKey=0]="InvalidKey",t[t.MissingKey=1]="MissingKey",t[t.InternalError=2]="InternalError"})(jH||(jH={}));var he;(function(t){t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting",t.Reconnected="reconnected",t.Disconnected="disconnected",t.ConnectionStateChanged="connectionStateChanged",t.Moved="moved",t.MediaDevicesChanged="mediaDevicesChanged",t.ParticipantConnected="participantConnected",t.ParticipantDisconnected="participantDisconnected",t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalAudioSilenceDetected="localAudioSilenceDetected",t.ActiveSpeakersChanged="activeSpeakersChanged",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.ParticipantAttributesChanged="participantAttributesChanged",t.ParticipantActive="participantActive",t.RoomMetadataChanged="roomMetadataChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.AudioPlaybackStatusChanged="audioPlaybackChanged",t.VideoPlaybackStatusChanged="videoPlaybackChanged",t.MediaDevicesError="mediaDevicesError",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.SignalConnected="signalConnected",t.RecordingStatusChanged="recordingStatusChanged",t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ActiveDeviceChanged="activeDeviceChanged",t.ChatMessage="chatMessage",t.LocalTrackSubscribed="localTrackSubscribed",t.MetricsReceived="metricsReceived"})(he||(he={}));var ae;(function(t){t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackCpuConstrained="localTrackCpuConstrained",t.LocalSenderCreated="localSenderCreated",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.IsSpeakingChanged="isSpeakingChanged",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.TrackCpuConstrained="trackCpuConstrained",t.MediaDevicesError="mediaDevicesError",t.AudioStreamAcquired="audioStreamAcquired",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.PCTrackAdded="pcTrackAdded",t.AttributesChanged="attributesChanged",t.LocalTrackSubscribed="localTrackSubscribed",t.ChatMessage="chatMessage",t.Active="active"})(ae||(ae={}));var Ne;(function(t){t.TransportsCreated="transportsCreated",t.Connected="connected",t.Disconnected="disconnected",t.Resuming="resuming",t.Resumed="resumed",t.Restarting="restarting",t.Restarted="restarted",t.SignalResumed="signalResumed",t.SignalRestarted="signalRestarted",t.Closing="closing",t.MediaTrackAdded="mediaTrackAdded",t.ActiveSpeakersUpdate="activeSpeakersUpdate",t.DataPacketReceived="dataPacketReceived",t.RTPVideoMapUpdate="rtpVideoMapUpdate",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ParticipantUpdate="participantUpdate",t.RoomUpdate="roomUpdate",t.SpeakersChanged="speakersChanged",t.StreamStateChanged="streamStateChanged",t.ConnectionQualityUpdate="connectionQualityUpdate",t.SubscriptionError="subscriptionError",t.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",t.RemoteMute="remoteMute",t.SubscribedQualityUpdate="subscribedQualityUpdate",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackSubscribed="localTrackSubscribed",t.Offline="offline",t.SignalRequestResponse="signalRequestResponse",t.SignalConnected="signalConnected",t.RoomMoved="roomMoved"})(Ne||(Ne={}));var Ae;(function(t){t.Message="message",t.Muted="muted",t.Unmuted="unmuted",t.Restarted="restarted",t.Ended="ended",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed",t.CpuConstrained="cpuConstrained",t.UpdateSettings="updateSettings",t.UpdateSubscription="updateSubscription",t.AudioPlaybackStarted="audioPlaybackStarted",t.AudioPlaybackFailed="audioPlaybackFailed",t.AudioSilenceDetected="audioSilenceDetected",t.VisibilityChanged="visibilityChanged",t.VideoDimensionsChanged="videoDimensionsChanged",t.VideoPlaybackStarted="videoPlaybackStarted",t.VideoPlaybackFailed="videoPlaybackFailed",t.ElementAttached="elementAttached",t.ElementDetached="elementDetached",t.UpstreamPaused="upstreamPaused",t.UpstreamResumed="upstreamResumed",t.SubscriptionPermissionChanged="subscriptionPermissionChanged",t.SubscriptionStatusChanged="subscriptionStatusChanged",t.SubscriptionFailed="subscriptionFailed",t.TrackProcessorUpdate="trackProcessorUpdate",t.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",t.TranscriptionReceived="transcriptionReceived",t.TimeSyncUpdate="timeSyncUpdate",t.PreConnectBufferFlushed="preConnectBufferFlushed"})(Ae||(Ae={}));function ZSe(t){return typeof t>"u"?t:typeof structuredClone=="function"?typeof t=="object"&&t!==null?structuredClone(Object.assign({},t)):structuredClone(t):JSON.parse(JSON.stringify(t))}const e2e=/version\/(\d+(\.?_?\d+)+)/i;let wx;function ho(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(typeof navigator>"u")return;const n=navigator.userAgent.toLowerCase();if(wx===void 0||e){const r=t2e.find(i=>{let{test:s}=i;return s.test(n)});wx=r?.describe(n)}return wx}const t2e=[{test:/firefox|iceweasel|fxios/i,describe(t){return{name:"Firefox",version:ME(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:Ex(t)}}},{test:/chrom|crios|crmo/i,describe(t){return{name:"Chrome",version:ME(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("crios")?"iOS":void 0,osVersion:Ex(t)}}},{test:/safari|applewebkit/i,describe(t){return{name:"Safari",version:ME(e2e,t),os:t.includes("mobile/")?"iOS":"macOS",osVersion:Ex(t)}}}];function ME(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const r=e.match(t);return r&&r.length>=n&&r[n]||""}function Ex(t){return t.includes("mac os")?ME(/\(.+?(\d+_\d+(:?_\d+)?)/,t,1).replace(/_/g,"."):void 0}var n2e="2.16.0";const r2e=n2e,i2e=16;class ts{}ts.setTimeout=function(){return setTimeout(...arguments)};ts.setInterval=function(){return setInterval(...arguments)};ts.clearTimeout=function(){return clearTimeout(...arguments)};ts.clearInterval=function(){return clearInterval(...arguments)};const s2e=5e3,Q0=[];var Xo;(function(t){t[t.LOW=0]="LOW",t[t.MEDIUM=1]="MEDIUM",t[t.HIGH=2]="HIGH"})(Xo||(Xo={}));let pe=class Lg extends jl.EventEmitter{get streamState(){return this._streamState}setStreamState(e){this._streamState=e}constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var i;super(),this.attachedElements=[],this.isMuted=!1,this._streamState=Lg.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=kt,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),s2e):this.handleAppVisibilityChanged()},this.log=ed((i=r.loggerName)!==null&&i!==void 0?i:Nc.Track),this.loggerContextCb=r.loggerContextCb,this.setMaxListeners(100),this.kind=n,this._mediaStreamTrack=e,this._mediaStreamID=e.id,this.source=Lg.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),Ft(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(e){let n="audio";this.kind===Lg.Kind.Video&&(n="video"),this.attachedElements.length===0&&this.kind===Lg.Kind.Video&&this.addAppVisibilityListener(),e||(n==="audio"&&(Q0.forEach(s=>{s.parentElement===null&&!e&&(e=s)}),e&&Q0.splice(Q0.indexOf(e),1)),e||(e=document.createElement(n))),this.attachedElements.includes(e)||this.attachedElements.push(e),jg(this.mediaStreamTrack,e);const r=e.srcObject.getTracks(),i=r.some(s=>s.kind==="audio");return e.play().then(()=>{this.emit(i?Ae.AudioPlaybackStarted:Ae.VideoPlaybackStarted)}).catch(s=>{s.name==="NotAllowedError"?this.emit(i?Ae.AudioPlaybackFailed:Ae.VideoPlaybackFailed,s):s.name==="AbortError"?kt.debug("".concat(i?"audio":"video"," playback aborted, likely due to new play request")):kt.warn("could not playback ".concat(i?"audio":"video"),s),i&&e&&r.some(o=>o.kind==="video")&&s.name==="NotAllowedError"&&(e.muted=!0,e.play().catch(()=>{}))}),this.emit(Ae.ElementAttached,e),e}detach(e){try{if(e){iv(this.mediaStreamTrack,e);const r=this.attachedElements.indexOf(e);return r>=0&&(this.attachedElements.splice(r,1),this.recycleElement(e),this.emit(Ae.ElementDetached,e)),e}const n=[];return this.attachedElements.forEach(r=>{iv(this.mediaStreamTrack,r),n.push(r),this.recycleElement(r),this.emit(Ae.ElementDetached,r)}),this.attachedElements=[],n}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(e){e.loggerName&&(this.log=ed(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let n=!0;e.pause(),Q0.forEach(r=>{r.parentElement||(n=!1)}),n&&Q0.push(e)}}handleAppVisibilityChanged(){return X(this,void 0,void 0,function*(){this.isInBackground=document.visibilityState==="hidden",!this.isInBackground&&this.kind===Lg.Kind.Video&&setTimeout(()=>this.attachedElements.forEach(e=>e.play().catch(()=>{})),0)})}addAppVisibilityListener(){co()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){co()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}};function jg(t,e){let n;e.srcObject instanceof MediaStream?n=e.srcObject:n=new MediaStream;let r;t.kind==="audio"?r=n.getAudioTracks():r=n.getVideoTracks(),r.includes(t)||(r.forEach(i=>{n.removeTrack(i)}),n.addTrack(t)),(!Mp()||!(e instanceof HTMLVideoElement))&&(e.autoplay=!0),e.muted=n.getAudioTracks().length===0,e instanceof HTMLVideoElement&&(e.playsInline=!0),e.srcObject!==n&&(e.srcObject=n,(Mp()||Lp())&&e instanceof HTMLVideoElement&&setTimeout(()=>{e.srcObject=n,e.play().catch(()=>{})},0))}function iv(t,e){if(e.srcObject instanceof MediaStream){const n=e.srcObject;n.removeTrack(t),n.getTracks().length>0?e.srcObject=n:e.srcObject=null}}(function(t){let e;(function(l){l.Audio="audio",l.Video="video",l.Unknown="unknown"})(e=t.Kind||(t.Kind={}));let n;(function(l){l.Camera="camera",l.Microphone="microphone",l.ScreenShare="screen_share",l.ScreenShareAudio="screen_share_audio",l.Unknown="unknown"})(n=t.Source||(t.Source={}));let r;(function(l){l.Active="active",l.Paused="paused",l.Unknown="unknown"})(r=t.StreamState||(t.StreamState={}));function i(l){switch(l){case e.Audio:return Tc.AUDIO;case e.Video:return Tc.VIDEO;default:return Tc.DATA}}t.kindToProto=i;function s(l){switch(l){case Tc.AUDIO:return e.Audio;case Tc.VIDEO:return e.Video;default:return e.Unknown}}t.kindFromProto=s;function o(l){switch(l){case n.Camera:return ni.CAMERA;case n.Microphone:return ni.MICROPHONE;case n.ScreenShare:return ni.SCREEN_SHARE;case n.ScreenShareAudio:return ni.SCREEN_SHARE_AUDIO;default:return ni.UNKNOWN}}t.sourceToProto=o;function a(l){switch(l){case ni.CAMERA:return n.Camera;case ni.MICROPHONE:return n.Microphone;case ni.SCREEN_SHARE:return n.ScreenShare;case ni.SCREEN_SHARE_AUDIO:return n.ScreenShareAudio;default:return n.Unknown}}t.sourceFromProto=a;function c(l){switch(l){case ZA.ACTIVE:return r.Active;case ZA.PAUSED:return r.Paused;default:return r.Unknown}}t.streamStateFromProto=c})(pe||(pe={}));class kn{constructor(e,n,r,i,s){if(typeof e=="object")this.width=e.width,this.height=e.height,this.aspectRatio=e.aspectRatio,this.encoding={maxBitrate:e.maxBitrate,maxFramerate:e.maxFramerate,priority:e.priority};else if(n!==void 0&&r!==void 0)this.width=e,this.height=n,this.aspectRatio=e/n,this.encoding={maxBitrate:r,maxFramerate:i,priority:s};else throw new TypeError("Unsupported options: provide at least width, height and maxBitrate")}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const o2e=["vp8","h264"],a2e=["vp8","h264","vp9","av1","h265"];function c2e(t){return!!o2e.find(e=>e===t)}const l2e=c2e;var FH;(function(t){t[t.PREFER_REGRESSION=0]="PREFER_REGRESSION",t[t.SIMULCAST=1]="SIMULCAST",t[t.REGRESSION=2]="REGRESSION"})(FH||(FH={}));var KC;(function(t){t.telephone={maxBitrate:12e3},t.speech={maxBitrate:24e3},t.music={maxBitrate:48e3},t.musicStereo={maxBitrate:64e3},t.musicHighQuality={maxBitrate:96e3},t.musicHighQualityStereo={maxBitrate:128e3}})(KC||(KC={}));const Sl={h90:new kn(160,90,9e4,20),h180:new kn(320,180,16e4,20),h216:new kn(384,216,18e4,20),h360:new kn(640,360,45e4,20),h540:new kn(960,540,8e5,25),h720:new kn(1280,720,17e5,30),h1080:new kn(1920,1080,3e6,30),h1440:new kn(2560,1440,5e6,30),h2160:new kn(3840,2160,8e6,30)},lL={h120:new kn(160,120,7e4,20),h180:new kn(240,180,125e3,20),h240:new kn(320,240,14e4,20),h360:new kn(480,360,33e4,20),h480:new kn(640,480,5e5,20),h540:new kn(720,540,6e5,25),h720:new kn(960,720,13e5,30),h1080:new kn(1440,1080,23e5,30),h1440:new kn(1920,1440,38e5,30)},jT={h360fps3:new kn(640,360,2e5,3,"medium"),h360fps15:new kn(640,360,4e5,15,"medium"),h720fps5:new kn(1280,720,8e5,5,"medium"),h720fps15:new kn(1280,720,15e5,15,"medium"),h720fps30:new kn(1280,720,2e6,30,"medium"),h1080fps15:new kn(1920,1080,25e5,15,"medium"),h1080fps30:new kn(1920,1080,5e6,30,"medium"),original:new kn(0,0,7e6,30,"medium")},u2e="|",$H="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function d2e(t){const e=t.split(u2e);return e.length>1?[e[0],t.substr(e[0].length+1)]:[t,""]}function ns(t){return X(this,void 0,void 0,function*(){return new Promise(e=>ts.setTimeout(e,t))})}function uL(){return"addTransceiver"in RTCPeerConnection.prototype}function dL(){return"addTrack"in RTCPeerConnection.prototype}function f2e(){if(!("getCapabilities"in RTCRtpSender)||Mp()||Lp())return!1;const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType.toLowerCase()==="video/av1"){e=!0;break}}return e}function h2e(){if(!("getCapabilities"in RTCRtpSender)||Lp())return!1;if(Mp()){const n=ho();if(n?.version&&xl(n.version,"16")<0||n?.os==="iOS"&&n?.osVersion&&xl(n.osVersion,"16")<0)return!1}const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType.toLowerCase()==="video/vp9"){e=!0;break}}return e}function kc(t){return t==="av1"||t==="vp9"}function fL(t){return!document||Kb()?!1:(t||(t=document.createElement("audio")),"setSinkId"in t)}function p2e(){return typeof RTCPeerConnection>"u"?!1:uL()||dL()}function Lp(){var t;return((t=ho())===null||t===void 0?void 0:t.name)==="Firefox"}function BH(){const t=ho();return!!t&&t.name==="Chrome"&&t.os!=="iOS"}function Mp(){var t;return((t=ho())===null||t===void 0?void 0:t.name)==="Safari"}function Kb(){const t=ho();return t?.name==="Safari"||t?.os==="iOS"}function m2e(){const t=ho();return t?.name==="Safari"&&t.version.startsWith("17.")||t?.os==="iOS"&&!!t?.osVersion&&xl(t.osVersion,"17")>=0}function g2e(t){return t||(t=ho()),t?.name==="Safari"&&xl(t.version,"18.3")>0||t?.os==="iOS"&&!!t?.osVersion&&xl(t.osVersion,"18.3")>0}function mee(){var t,e;return co()?(e=(t=navigator.userAgentData)===null||t===void 0?void 0:t.mobile)!==null&&e!==void 0?e:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function v2e(){const t=ho(),e="17.2";if(t)return t.name!=="Safari"&&t.os!=="iOS"||t.os==="iOS"&&t.osVersion&&xl(t.osVersion,e)>=0?!0:t.name==="Safari"&&xl(t.version,e)>=0}function co(){return typeof document<"u"}function Il(){return navigator.product=="ReactNative"}function GC(t){return t.hostname.endsWith(".livekit.cloud")||t.hostname.endsWith(".livekit.run")}function Cx(t){return GC(t)?t.hostname.split(".")[0]:null}function gee(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function vee(){if(!Il())return;let t=gee();if(t)return t.platform}function HH(){if(co())return window.devicePixelRatio;if(Il()){let t=gee();if(t)return t.devicePixelRatio}return 1}function xl(t,e){const n=t.split("."),r=e.split("."),i=Math.min(n.length,r.length);for(let s=0;s<i;++s){const o=parseInt(n[s],10),a=parseInt(r[s],10);if(o>a)return 1;if(o<a)return-1;if(s===i-1&&o===a)return 0}return t===""&&e!==""?-1:e===""?1:n.length==r.length?0:n.length<r.length?-1:1}function y2e(t){for(const e of t)e.target.handleResize(e)}function b2e(t){for(const e of t)e.target.handleVisibilityChanged(e)}let Tx=null;const qH=()=>(Tx||(Tx=new ResizeObserver(y2e)),Tx);let Rx=null;const VH=()=>(Rx||(Rx=new IntersectionObserver(b2e,{root:null,rootMargin:"0px"})),Rx);function _2e(){var t;const e=new gZ({sdk:vZ.JS,protocol:i2e,version:r2e});return Il()&&(e.os=(t=vee())!==null&&t!==void 0?t:""),e}function KH(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const i=document.createElement("canvas");i.width=t,i.height=e;const s=i.getContext("2d");s?.fillRect(0,0,i.width,i.height),r&&s&&(s.beginPath(),s.arc(t/2,e/2,50,0,Math.PI*2,!0),s.closePath(),s.fillStyle="grey",s.fill());const o=i.captureStream(),[a]=o.getTracks();if(!a)throw Error("Could not get empty media stream video track");return a.enabled=n,a}let Z0;function kx(){if(!Z0){const t=new AudioContext,e=t.createOscillator(),n=t.createGain();n.gain.setValueAtTime(0,0);const r=t.createMediaStreamDestination();if(e.connect(n),n.connect(r),e.start(),[Z0]=r.stream.getAudioTracks(),!Z0)throw Error("Could not get empty media stream audio track");Z0.enabled=!1}return Z0.clone()}class Na{get isResolved(){return this._isResolved}constructor(e,n){this._isResolved=!1,this.onFinally=n,this.promise=new Promise((r,i)=>X(this,void 0,void 0,function*(){this.resolve=r,this.reject=i,e&&(yield e(r,i))})).finally(()=>{var r;this._isResolved=!0,(r=this.onFinally)===null||r===void 0||r.call(this)})}}function S2e(t){return a2e.includes(t)}function Of(t){if(typeof t=="string"||typeof t=="number")return t;if(Array.isArray(t))return t[0];if(t.exact!==void 0)return Array.isArray(t.exact)?t.exact[0]:t.exact;if(t.ideal!==void 0)return Array.isArray(t.ideal)?t.ideal[0]:t.ideal;throw Error("could not unwrap constraint")}function w2e(t){return t.startsWith("http")?t.replace(/^(http)/,"ws"):t}function Gb(t){return t.startsWith("ws")?t.replace(/^(ws)/,"http"):t}function E2e(t,e){return t.segments.map(n=>{let{id:r,text:i,language:s,startTime:o,endTime:a,final:c}=n;var l;const d=(l=e.get(r))!==null&&l!==void 0?l:Date.now(),h=Date.now();return c?e.delete(r):e.set(r,d),{id:r,text:i,startTime:Number.parseInt(o.toString()),endTime:Number.parseInt(a.toString()),final:c,language:s,firstReceivedTime:d,lastReceivedTime:h}})}function C2e(t){const{id:e,timestamp:n,message:r,editTimestamp:i}=t;return{id:e,timestamp:Number.parseInt(n.toString()),editTimestamp:i?Number.parseInt(i.toString()):void 0,message:r}}function GH(t){switch(t.reason){case wt.LeaveRequest:return t.context;case wt.Cancelled:return xc.CLIENT_INITIATED;case wt.NotAllowed:return xc.USER_REJECTED;case wt.ServerUnreachable:return xc.JOIN_FAILURE;default:return xc.UNKNOWN_REASON}}function OE(t){return t!==void 0?Number(t):void 0}function sp(t){return t!==void 0?BigInt(t):void 0}function yp(t){return!!t&&!(t instanceof MediaStreamTrack)&&t.isLocal}function Cl(t){return!!t&&t.kind==pe.Kind.Audio}function ah(t){return!!t&&t.kind==pe.Kind.Video}function Jd(t){return yp(t)&&ah(t)}function mu(t){return yp(t)&&Cl(t)}function hL(t){return!!t&&!t.isLocal}function T2e(t){return!!t&&!t.isLocal}function Ix(t){return hL(t)&&ah(t)}function R2e(t){return t.isLocal}function k2e(t,e){const n=[];let r=new TextEncoder().encode(t);for(;r.length>e;){let i=e;for(;i>0;){const s=r[i];if(s!==void 0&&(s&192)!==128)break;i--}n.push(r.slice(0,i)),r=r.slice(i)}return r.length>0&&n.push(r),n}function I2e(t){var e;const n=t.get("Cache-Control");if(n){const r=(e=n.match(/(?:^|[,\s])max-age=(\d+)/))===null||e===void 0?void 0:e[1];if(r)return parseInt(r,10)}}function yee(t,e,n){var r,i,s,o;const{optionsWithoutProcessor:a,audioProcessor:c,videoProcessor:l}=See(t??{}),d=e?.processor,h=n?.processor,m=a??{};return m.audio===!0&&(m.audio={}),m.video===!0&&(m.video={}),m.audio&&(pL(m.audio,e),(r=(s=m.audio).deviceId)!==null&&r!==void 0||(s.deviceId={ideal:"default"}),(c||d)&&(m.audio.processor=c??d)),m.video&&(pL(m.video,n),(i=(o=m.video).deviceId)!==null&&i!==void 0||(o.deviceId={ideal:"default"}),(l||h)&&(m.video.processor=l??h)),m}function pL(t,e){return Object.keys(e).forEach(n=>{t[n]===void 0&&(t[n]=e[n])}),t}function FP(t){var e,n,r,i;const s={};if(t.video)if(typeof t.video=="object"){const o={},a=o,c=t.video;Object.keys(c).forEach(l=>{l==="resolution"?pL(a,c.resolution):a[l]=c[l]}),s.video=o,(e=(r=s.video).deviceId)!==null&&e!==void 0||(r.deviceId={ideal:"default"})}else s.video=t.video?{deviceId:{ideal:"default"}}:!1;else s.video=!1;return t.audio?typeof t.audio=="object"?(s.audio=t.audio,(n=(i=s.audio).deviceId)!==null&&n!==void 0||(i.deviceId={ideal:"default"})):s.audio={deviceId:{ideal:"default"}}:s.audio=!1,s}function bee(t){return X(this,arguments,void 0,function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return(function*(){const r=_ee();if(r){const i=r.createAnalyser();i.fftSize=2048;const s=i.frequencyBinCount,o=new Uint8Array(s);r.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(i),yield ns(n),i.getByteTimeDomainData(o);const c=o.some(l=>l!==128&&l!==0);return r.close(),!c}return!1})()})}function _ee(){var t;const e=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(e){const n=new e({latencyHint:"interactive"});if(n.state==="suspended"&&typeof window<"u"&&(!((t=window.document)===null||t===void 0)&&t.body)){const r=()=>X(this,void 0,void 0,function*(){var i;try{n.state==="suspended"&&(yield n.resume())}catch(s){console.warn("Error trying to auto-resume audio context",s)}finally{(i=window.document.body)===null||i===void 0||i.removeEventListener("click",r)}});n.addEventListener("statechange",()=>{var i;n.state==="closed"&&((i=window.document.body)===null||i===void 0||i.removeEventListener("click",r))}),window.document.body.addEventListener("click",r)}return n}}function x2e(t){return t==="audioinput"?pe.Source.Microphone:t==="videoinput"?pe.Source.Camera:pe.Source.Unknown}function mL(t){return t===pe.Source.Microphone?"audioinput":t===pe.Source.Camera?"videoinput":void 0}function A2e(t){var e,n;let r=(e=t.video)!==null&&e!==void 0?e:!0;return t.resolution&&t.resolution.width>0&&t.resolution.height>0&&(r=typeof r=="boolean"?{}:r,Mp()?r=Object.assign(Object.assign({},r),{width:{max:t.resolution.width},height:{max:t.resolution.height},frameRate:t.resolution.frameRate}):r=Object.assign(Object.assign({},r),{width:{ideal:t.resolution.width},height:{ideal:t.resolution.height},frameRate:t.resolution.frameRate})),{audio:(n=t.audio)!==null&&n!==void 0?n:!1,video:r,controller:t.controller,selfBrowserSurface:t.selfBrowserSurface,surfaceSwitching:t.surfaceSwitching,systemAudio:t.systemAudio,preferCurrentTab:t.preferCurrentTab}}function Y1(t){return t.split("/")[1].toLowerCase()}function L2e(t){const e=[];return t.forEach(n=>{n.track!==void 0&&e.push(new LP({cid:n.track.mediaStreamID,track:n.trackInfo}))}),e}function Ft(t){return"mediaStreamTrack"in t?{trackID:t.sid,source:t.source,muted:t.isMuted,enabled:t.mediaStreamTrack.enabled,kind:t.kind,streamID:t.mediaStreamID,streamTrackID:t.mediaStreamTrack.id}:{trackID:t.trackSid,enabled:t.isEnabled,muted:t.isMuted,trackInfo:Object.assign({mimeType:t.mimeType,name:t.trackName,encrypted:t.isEncrypted,kind:t.kind,source:t.source},t.track?Ft(t.track):{})}}function M2e(){return typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver}function O2e(t,e){var n;t===void 0&&(t={}),e===void 0&&(e={});const r=[...Object.keys(e),...Object.keys(t)],i={};for(const s of r)t[s]!==e[s]&&(i[s]=(n=e[s])!==null&&n!==void 0?n:"");return i}function See(t){const e=Object.assign({},t);let n,r;return typeof e.audio=="object"&&e.audio.processor&&(n=e.audio.processor,e.audio=Object.assign(Object.assign({},e.audio),{processor:void 0})),typeof e.video=="object"&&e.video.processor&&(r=e.video.processor,e.video=Object.assign(Object.assign({},e.video),{processor:void 0})),{audioProcessor:n,videoProcessor:r,optionsWithoutProcessor:ZSe(e)}}function P2e(t){switch(t){case ni.CAMERA:return pe.Source.Camera;case ni.MICROPHONE:return pe.Source.Microphone;case ni.SCREEN_SHARE:return pe.Source.ScreenShare;case ni.SCREEN_SHARE_AUDIO:return pe.Source.ScreenShareAudio;default:return pe.Source.Unknown}}function zH(t,e){return t.width*t.height<e.width*e.height}function D2e(t,e){var n;return(n=t.layers)===null||n===void 0?void 0:n.find(r=>r.quality===e)}class N2e extends jl.EventEmitter{constructor(e,n){super(),this.decryptDataRequests=new Map,this.encryptDataRequests=new Map,this.onWorkerMessage=r=>{var i,s;const{kind:o,data:a}=r.data;switch(o){case"error":if(kt.error(a.error.message),a.uuid){const d=this.decryptDataRequests.get(a.uuid);if(d?.reject){d.reject(a.error);break}const h=this.encryptDataRequests.get(a.uuid);if(h?.reject){h.reject(a.error);break}}this.emit(Sf.EncryptionError,a.error,a.participantIdentity);break;case"initAck":a.enabled&&this.keyProvider.getKeys().forEach(d=>{this.postKey(d)});break;case"enable":if(a.enabled&&this.keyProvider.getKeys().forEach(d=>{this.postKey(d)}),this.encryptionEnabled!==a.enabled&&a.participantIdentity===((i=this.room)===null||i===void 0?void 0:i.localParticipant.identity))this.emit(Sf.ParticipantEncryptionStatusChanged,a.enabled,this.room.localParticipant),this.encryptionEnabled=a.enabled;else if(a.participantIdentity){const d=(s=this.room)===null||s===void 0?void 0:s.getParticipantByIdentity(a.participantIdentity);if(!d)throw TypeError("couldn't set encryption status, participant not found".concat(a.participantIdentity));this.emit(Sf.ParticipantEncryptionStatusChanged,a.enabled,d)}break;case"ratchetKey":this.keyProvider.emit(Mf.KeyRatcheted,a.ratchetResult,a.participantIdentity,a.keyIndex);break;case"decryptDataResponse":const c=this.decryptDataRequests.get(a.uuid);c?.resolve&&c.resolve(a);break;case"encryptDataResponse":const l=this.encryptDataRequests.get(a.uuid);l?.resolve&&l.resolve(a);break}},this.onWorkerError=r=>{kt.error("e2ee worker encountered an error:",{error:r.error}),this.emit(Sf.EncryptionError,r.error,void 0)},this.keyProvider=e.keyProvider,this.worker=e.worker,this.encryptionEnabled=!1,this.dataChannelEncryptionEnabled=n}get isEnabled(){return this.encryptionEnabled}get isDataChannelEncryptionEnabled(){return this.isEnabled&&this.dataChannelEncryptionEnabled}setup(e){if(!hee())throw new jP("tried to setup end-to-end encryption on an unsupported browser");if(kt.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const n={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:MSe.getLevel()}};this.worker&&(kt.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(n))}}setParticipantCryptorEnabled(e,n){kt.debug("set e2ee to ".concat(e," for participant ").concat(n)),this.postEnable(e,n)}setSifTrailer(e){!e||e.length===0?kt.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(e)}setupEngine(e){e.on(Ne.RTPVideoMapUpdate,n=>{this.postRTPMap(n)})}setupEventListeners(e,n){e.on(he.TrackPublished,(r,i)=>this.setParticipantCryptorEnabled(r.trackInfo.encryption!==vi.NONE,i.identity)),e.on(he.ConnectionStateChanged,r=>{r===Xt.Connected&&e.remoteParticipants.forEach(i=>{i.trackPublications.forEach(s=>{this.setParticipantCryptorEnabled(s.trackInfo.encryption!==vi.NONE,i.identity)})})}).on(he.TrackUnsubscribed,(r,i,s)=>{var o;const a={kind:"removeTransform",data:{participantIdentity:s.identity,trackId:r.mediaStreamID}};(o=this.worker)===null||o===void 0||o.postMessage(a)}).on(he.TrackSubscribed,(r,i,s)=>{this.setupE2EEReceiver(r,s.identity,i.trackInfo)}).on(he.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");n.getKeys().forEach(r=>{this.postKey(r)}),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)}),e.localParticipant.on(ae.LocalSenderCreated,(r,i)=>X(this,void 0,void 0,function*(){this.setupE2EESender(i,r)})),e.localParticipant.on(ae.LocalTrackPublished,r=>{if(!ah(r.track)||!Kb())return;const i={kind:"updateCodec",data:{trackId:r.track.mediaStreamID,codec:Y1(r.trackInfo.codecs[0].mimeType),participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(i)}),n.on(Mf.SetKey,r=>this.postKey(r)).on(Mf.RatchetRequest,(r,i)=>this.postRatchetRequest(r,i))}encryptData(e){return X(this,void 0,void 0,function*(){if(!this.worker)throw Error("could not encrypt data, worker is missing");const n=crypto.randomUUID(),r={kind:"encryptDataRequest",data:{uuid:n,payload:e,participantIdentity:this.room.localParticipant.identity}},i=new Na;return i.onFinally=()=>{this.encryptDataRequests.delete(n)},this.encryptDataRequests.set(n,i),this.worker.postMessage(r),i.promise})}handleEncryptedData(e,n,r,i){if(!this.worker)throw Error("could not handle encrypted data, worker is missing");const s=crypto.randomUUID(),o={kind:"decryptDataRequest",data:{uuid:s,payload:e,iv:n,participantIdentity:r,keyIndex:i}},a=new Na;return a.onFinally=()=>{this.decryptDataRequests.delete(s)},this.decryptDataRequests.set(s,a),this.worker.postMessage(o),a.promise}postRatchetRequest(e,n){if(!this.worker)throw Error("could not ratchet key, worker is missing");const r={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:n}};this.worker.postMessage(r)}postKey(e){let{key:n,participantIdentity:r,keyIndex:i}=e;var s;if(!this.worker)throw Error("could not set key, worker is missing");const o={kind:"setKey",data:{participantIdentity:r,isPublisher:r===((s=this.room)===null||s===void 0?void 0:s.localParticipant.identity),key:n,keyIndex:i}};this.worker.postMessage(o)}postEnable(e,n){if(this.worker){const r={kind:"enable",data:{enabled:e,participantIdentity:n}};this.worker.postMessage(r)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}postRTPMap(e){var n;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((n=this.room)===null||n===void 0)&&n.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const r={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(r)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const n={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(n)}setupE2EEReceiver(e,n,r){if(e.receiver){if(!r?.mimeType||r.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,n,e.kind==="video"?Y1(r.mimeType):void 0)}}setupE2EESender(e,n){if(!yp(e)||!n){n||kt.warn("early return because sender is not ready");return}this.handleSender(n,e.mediaStreamID,void 0)}handleReceiver(e,n,r,i){return X(this,void 0,void 0,function*(){if(this.worker){if(aL()&&!BH()){const s={kind:"decode",participantIdentity:r,trackId:n,codec:i};e.transform=new RTCRtpScriptTransform(this.worker,s)}else{if(J0 in e&&i){const c={kind:"updateCodec",data:{trackId:n,codec:i,participantIdentity:r}};this.worker.postMessage(c);return}let s=e.writableStream,o=e.readableStream;if(!s||!o){const c=e.createEncodedStreams();e.writableStream=c.writable,s=c.writable,e.readableStream=c.readable,o=c.readable}const a={kind:"decode",data:{readableStream:o,writableStream:s,trackId:n,codec:i,participantIdentity:r,isReuse:J0 in e}};this.worker.postMessage(a,[o,s])}e[J0]=!0}})}handleSender(e,n,r){var i;if(!(J0 in e||!this.worker)){if(!(!((i=this.room)===null||i===void 0)&&i.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(aL()&&!BH()){kt.info("initialize script transform");const s={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:n,codec:r};e.transform=new RTCRtpScriptTransform(this.worker,s)}else{kt.info("initialize encoded streams");const s=e.createEncodedStreams(),o={kind:"encode",data:{readableStream:s.readable,writableStream:s.writable,codec:r,trackId:n,participantIdentity:this.room.localParticipant.identity,isReuse:!1}};this.worker.postMessage(o,[s.readable,s.writable])}e[J0]=!0}}}const U2e=500,j2e=15e3;class sv{constructor(){this.failedConnectionAttempts=new Map,this.backOffPromises=new Map}static getInstance(){return this._instance||(this._instance=new sv),this._instance}addFailedConnectionAttempt(e){var n;const r=new URL(e),i=Cx(r);if(!i)return;let s=(n=this.failedConnectionAttempts.get(i))!==null&&n!==void 0?n:0;this.failedConnectionAttempts.set(i,s+1),this.backOffPromises.set(i,ns(Math.min(U2e*Math.pow(2,s),j2e)))}getBackOffPromise(e){const n=new URL(e),r=n&&Cx(n);return r&&this.backOffPromises.get(r)||Promise.resolve()}resetFailedConnectionAttempts(e){const n=new URL(e),r=n&&Cx(n);r&&(this.failedConnectionAttempts.set(r,0),this.backOffPromises.set(r,Promise.resolve()))}resetAll(){this.backOffPromises.clear(),this.failedConnectionAttempts.clear()}}sv._instance=null;const xx="default";class Ni{constructor(){this._previousDevices=[]}static getInstance(){return this.instance===void 0&&(this.instance=new Ni),this.instance}get previousDevices(){return this._previousDevices}getDevices(e){return X(this,arguments,void 0,function(n){var r=this;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var s;if(((s=Ni.userMediaPromiseMap)===null||s===void 0?void 0:s.size)>0){kt.debug("awaiting getUserMedia promise");try{n?yield Ni.userMediaPromiseMap.get(n):yield Promise.all(Ni.userMediaPromiseMap.values())}catch{kt.warn("error waiting for media permissons")}}let o=yield navigator.mediaDevices.enumerateDevices();if(i&&!(Mp()&&r.hasDeviceInUse(n))&&(o.filter(c=>c.kind===n).length===0||o.some(c=>{const l=c.label==="",d=n?c.kind===n:!0;return l&&d}))){const c={video:n!=="audioinput"&&n!=="audiooutput",audio:n!=="videoinput"&&{deviceId:{ideal:"default"}}},l=yield navigator.mediaDevices.getUserMedia(c);o=yield navigator.mediaDevices.enumerateDevices(),l.getTracks().forEach(d=>{d.stop()})}return r._previousDevices=o,n&&(o=o.filter(a=>a.kind===n)),o})()})}normalizeDeviceId(e,n,r){return X(this,void 0,void 0,function*(){if(n!==xx)return n;const i=yield this.getDevices(e),s=i.find(a=>a.deviceId===xx);if(!s){kt.warn("could not reliably determine default device");return}const o=i.find(a=>a.deviceId!==xx&&a.groupId===(r??s.groupId));if(!o){kt.warn("could not reliably determine default device");return}return o?.deviceId})}hasDeviceInUse(e){return e?Ni.userMediaPromiseMap.has(e):Ni.userMediaPromiseMap.size>0}}Ni.mediaDeviceKinds=["audioinput","audiooutput","videoinput"];Ni.userMediaPromiseMap=new Map;var X1;(function(t){t[t.WAITING=0]="WAITING",t[t.RUNNING=1]="RUNNING",t[t.COMPLETED=2]="COMPLETED"})(X1||(X1={}));class F2e{constructor(){this.pendingTasks=new Map,this.taskMutex=new ps,this.nextTaskIndex=0}run(e){return X(this,void 0,void 0,function*(){const n={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:X1.WAITING};this.pendingTasks.set(n.id,n);const r=yield this.taskMutex.lock();try{return n.executedAt=Date.now(),n.status=X1.RUNNING,yield e()}finally{n.status=X1.COMPLETED,this.pendingTasks.delete(n.id),r()}})}flush(){return X(this,void 0,void 0,function*(){return this.run(()=>X(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}class $2e{get readyState(){return this.ws.readyState}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var r,i;if(!((r=n.signal)===null||r===void 0)&&r.aborted)throw new DOMException("This operation was aborted","AbortError");this.url=e;const s=new WebSocket(e,(i=n.protocols)!==null&&i!==void 0?i:[]);s.binaryType="arraybuffer",this.ws=s;const o=function(){let{closeCode:a,reason:c}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return s.close(a,c)};this.opened=new Promise((a,c)=>{s.onopen=()=>{a({readable:new ReadableStream({start(l){s.onmessage=d=>{let{data:h}=d;return l.enqueue(h)},s.onerror=d=>l.error(d)},cancel:o}),writable:new WritableStream({write(l){s.send(l)},abort(){s.close()},close:o}),protocol:s.protocol,extensions:s.extensions}),s.removeEventListener("error",c)},s.addEventListener("error",c)}),this.closed=new Promise((a,c)=>{const l=()=>X(this,void 0,void 0,function*(){const d=new Promise(m=>{s.readyState!==WebSocket.CLOSED&&s.addEventListener("close",g=>{m(g)},{once:!0})}),h=yield Promise.race([ns(250),d]);h?a(h):c(new Error("Encountered unspecified websocket error without a timely close event"))});s.onclose=d=>{let{code:h,reason:m}=d;a({closeCode:h,reason:m}),s.removeEventListener("error",l)},s.addEventListener("error",l)}),n.signal&&(n.signal.onabort=()=>s.close()),this.close=o}}function B2e(t,e){const n=new URL(w2e(t));return e.forEach((r,i)=>{n.searchParams.set(i,r)}),wee(n,"rtc")}function H2e(t){const e=new URL(Gb(t));return wee(e,"validate")}function q2e(t){return t.endsWith("/")?t:"".concat(t,"/")}function wee(t,e){return t.pathname="".concat(q2e(t.pathname)).concat(e),t.toString()}function WH(t){if(typeof t=="string")return EH.fromJson(JSON.parse(t),{ignoreUnknownFields:!0});if(t instanceof ArrayBuffer)return EH.fromBinary(new Uint8Array(t));throw new Error("could not decode websocket message: ".concat(typeof t))}function V2e(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Unknown reason";if(!(t instanceof AbortSignal))return e;const n=t.reason;switch(typeof n){case"string":return n;case"object":return n instanceof Error?n.message:e;default:return"toString"in n?n.toString():e}}const K2e=["syncState","trickle","offer","answer","simulate","leave"];function G2e(t){const e=K2e.indexOf(t.case)>=0;return kt.trace("request allowed to bypass queue:",{canPass:e,req:t}),e}var Pn;(function(t){t[t.CONNECTING=0]="CONNECTING",t[t.CONNECTED=1]="CONNECTED",t[t.RECONNECTING=2]="RECONNECTING",t[t.DISCONNECTING=3]="DISCONNECTING",t[t.DISCONNECTED=4]="DISCONNECTED"})(Pn||(Pn={}));const z2e=250;class $P{get currentState(){return this.state}get isDisconnected(){return this.state===Pn.DISCONNECTING||this.state===Pn.DISCONNECTED}get isEstablishingConnection(){return this.state===Pn.CONNECTING||this.state===Pn.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var r;this.rtt=0,this.state=Pn.DISCONNECTED,this.log=kt,this._requestId=0,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0,this.onMediaSectionsRequirement=void 0},this.log=ed((r=n.loggerName)!==null&&r!==void 0?r:Nc.Signal),this.loggerContextCb=n.loggerContextCb,this.useJSON=e,this.requestQueue=new F2e,this.queuedRequests=[],this.closingLock=new ps,this.connectionLock=new ps,this.state=Pn.DISCONNECTED}get logContext(){var e,n;return(n=(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this))!==null&&n!==void 0?n:{}}join(e,n,r,i){return X(this,void 0,void 0,function*(){return this.state=Pn.CONNECTING,this.options=r,yield this.connect(e,n,r,i)})}reconnect(e,n,r,i){return X(this,void 0,void 0,function*(){if(!this.options){this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);return}return this.state=Pn.RECONNECTING,this.clearPingInterval(),yield this.connect(e,n,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:r,reconnectReason:i}))})}connect(e,n,r,i){return X(this,void 0,void 0,function*(){const s=yield this.connectionLock.lock();this.connectOptions=r;const o=_2e(),a=r.singlePeerConnection?Y2e(n,o,r):W2e(n,o,r),c=B2e(e,a),l=H2e(c);return new Promise((d,h)=>X(this,void 0,void 0,function*(){var m,g;try{let y=!1;const v=C=>X(this,void 0,void 0,function*(){if(y)return;y=!0;const k=C instanceof Event?C.currentTarget:C,T=V2e(k,"Abort handler called");this.streamWriter&&!this.isDisconnected?this.sendLeave().then(()=>this.close(T)).catch(L=>{this.log.error(L),this.close()}):this.close(),E(),h(k instanceof AbortSignal?k.reason:k)});i?.addEventListener("abort",v);const E=()=>{clearTimeout(w),i?.removeEventListener("abort",v)},w=setTimeout(()=>{v(new Bt("room connection has timed out (signal)",wt.ServerUnreachable))},r.websocketTimeout),R=(C,k)=>{this.handleSignalConnected(C,w,k)},x=new URL(c);x.searchParams.has("access_token")&&x.searchParams.set("access_token","<redacted>"),this.log.debug("connecting to ".concat(x),Object.assign({reconnect:r.reconnect,reconnectReason:r.reconnectReason},this.logContext)),this.ws&&(yield this.close(!1)),this.ws=new $2e(c);try{this.ws.closed.then(D=>{var j;this.isEstablishingConnection&&h(new Bt("Websocket got closed during a (re)connection attempt: ".concat(D.reason),wt.InternalError)),D.closeCode!==1e3&&(this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:D.reason,code:D.closeCode,wasClean:D.closeCode===1e3,state:this.state})),this.state===Pn.CONNECTED&&this.handleOnClose((j=D.reason)!==null&&j!==void 0?j:"Unexpected WS error"))}).catch(D=>{this.isEstablishingConnection&&h(new Bt("Websocket error during a (re)connection attempt: ".concat(D),wt.InternalError))});const C=yield this.ws.opened.catch(D=>X(this,void 0,void 0,function*(){if(this.state!==Pn.CONNECTED){this.state=Pn.DISCONNECTED,clearTimeout(w);const j=yield this.handleConnectionError(D,l);h(j);return}this.handleWSError(D),h(D)}));if(clearTimeout(w),!C)return;const k=C.readable.getReader();this.streamWriter=C.writable.getWriter();const T=yield k.read();if(k.releaseLock(),!T.value)throw new Bt("no message received as first message",wt.InternalError);const L=WH(T.value),O=this.validateFirstMessage(L,(m=r.reconnect)!==null&&m!==void 0?m:!1);if(!O.isValid){h(O.error);return}((g=L.message)===null||g===void 0?void 0:g.case)==="join"&&(this.pingTimeoutDuration=L.message.value.pingTimeout,this.pingIntervalDuration=L.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})));const P=O.shouldProcessFirstMessage?L:void 0;R(C,P),d(O.response)}catch(C){h(C)}finally{E()}}finally{s()}}))})}startReadingLoop(e,n){return X(this,void 0,void 0,function*(){for(n&&this.handleSignalResponse(n);;){this.signalLatency&&(yield ns(this.signalLatency));const{done:r,value:i}=yield e.read();if(r)break;const s=WH(i);this.handleSignalResponse(s)}})}close(){return X(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Close method called on signal client";return(function*(){if([Pn.DISCONNECTING||Pn.DISCONNECTED].includes(e.state)){e.log.debug("ignoring signal close as it's already in disconnecting state");return}const i=yield e.closingLock.lock();try{if(e.clearPingInterval(),n&&(e.state=Pn.DISCONNECTING),e.ws){e.ws.close({closeCode:1e3,reason:r});const s=e.ws.closed;e.ws=void 0,e.streamWriter=void 0,yield Promise.race([s,ns(z2e)])}}catch(s){e.log.debug("websocket error while closing",Object.assign(Object.assign({},e.logContext),{error:s}))}finally{n&&(e.state=Pn.DISCONNECTED),i()}})()})}sendOffer(e,n){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:Fg(e,n)})}sendAnswer(e,n){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:Fg(e,n)})}sendIceCandidate(e,n){return this.log.debug("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new PT({candidateInit:JSON.stringify(e),target:n})})}sendMuteTrack(e,n){return this.sendRequest({case:"mute",value:new DT({sid:e,muted:n})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,n){return X(this,arguments,void 0,function(r,i){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return(function*(){const a=s.getNextRequestId();return yield s.sendRequest({case:"updateMetadata",value:new OP({requestId:a,metadata:r,name:i,attributes:o})}),a})()})}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,n){return this.sendRequest({case:"updateLayers",value:new CZ({trackSid:e,layers:n})})}sendUpdateSubscriptionPermissions(e,n){return this.sendRequest({case:"subscriptionPermission",value:new kZ({allParticipants:e,trackPermissions:n})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:lr.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new AZ({timestamp:lr.parse(Date.now()),rtt:lr.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(e,n){return this.sendRequest({case:"updateAudioTrack",value:new MP({trackSid:e,features:n})})}sendLeave(){return this.sendRequest({case:"leave",value:new UT({reason:xc.CLIENT_INITIATED,action:nv.DISCONNECT})})}sendRequest(e){return X(this,arguments,void 0,function(n){var r=this;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return(function*(){if(!i&&!G2e(n)&&r.state===Pn.RECONNECTING){r.queuedRequests.push(()=>X(r,void 0,void 0,function*(){yield this.sendRequest(n,!0)}));return}if(i||(yield r.requestQueue.flush()),r.signalLatency&&(yield ns(r.signalLatency)),r.isDisconnected){r.log.debug("skipping signal request (type: ".concat(n.case,") - SignalClient disconnected"));return}if(!r.streamWriter){r.log.error("cannot send signal request before connected, type: ".concat(n?.case),r.logContext);return}const o=new nSe({message:n});try{r.useJSON?yield r.streamWriter.write(o.toJsonString()):yield r.streamWriter.write(o.toBinary())}catch(a){r.log.error("error sending signal message",Object.assign(Object.assign({},r.logContext),{error:a}))}})()})}handleSignalResponse(e){var n,r;const i=e.message;if(i==null){this.log.debug("received unsupported message",this.logContext);return}let s=!1;if(i.case==="answer"){const o=YH(i.value);this.onAnswer&&this.onAnswer(o,i.value.id,i.value.midToTrackId)}else if(i.case==="offer"){const o=YH(i.value);this.onOffer&&this.onOffer(o,i.value.id,i.value.midToTrackId)}else if(i.case==="trickle"){const o=JSON.parse(i.value.candidateInit);this.onTrickle&&this.onTrickle(o,i.value.target)}else i.case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((n=i.value.participants)!==null&&n!==void 0?n:[]):i.case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(i.value):i.case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((r=i.value.speakers)!==null&&r!==void 0?r:[]):i.case==="leave"?this.onLeave&&this.onLeave(i.value):i.case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(i.value.sid,i.value.muted):i.case==="roomUpdate"?this.onRoomUpdate&&i.value.room&&this.onRoomUpdate(i.value.room):i.case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(i.value):i.case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(i.value):i.case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(i.value):i.case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(i.value):i.case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(i.value):i.case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(i.value):i.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(i.value):i.case==="pong"||(i.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(i.value.lastPingTimestamp.toString()),this.resetPingTimeout(),s=!0):i.case==="requestResponse"?this.onRequestResponse&&this.onRequestResponse(i.value):i.case==="trackSubscribed"?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(i.value.trackSid):i.case==="roomMoved"?(this.onTokenRefresh&&this.onTokenRefresh(i.value.token),this.onRoomMoved&&this.onRoomMoved(i.value)):i.case==="mediaSectionsRequirement"?this.onMediaSectionsRequirement&&this.onMediaSectionsRequirement(i.value):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:i.case})));s||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}handleOnClose(e){return X(this,void 0,void 0,function*(){if(this.state===Pn.DISCONNECTED)return;const n=this.onClose;yield this.close(void 0,e),this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),n&&n(e)})}handleWSError(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){this.log.warn("ping timeout duration not set",this.logContext);return}this.pingTimeout=ts.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&ts.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){this.log.warn("ping interval duration not set",this.logContext);return}this.log.debug("start ping interval",this.logContext),this.pingInterval=ts.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&ts.clearInterval(this.pingInterval)}handleSignalConnected(e,n,r){this.state=Pn.CONNECTED,clearTimeout(n),this.startPingInterval(),this.startReadingLoop(e.readable.getReader(),r)}validateFirstMessage(e,n){var r,i,s,o,a;return((r=e.message)===null||r===void 0?void 0:r.case)==="join"?{isValid:!0,response:e.message.value}:this.state===Pn.RECONNECTING&&((i=e.message)===null||i===void 0?void 0:i.case)!=="leave"?((s=e.message)===null||s===void 0?void 0:s.case)==="reconnect"?{isValid:!0,response:e.message.value}:(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),{isValid:!0,response:void 0,shouldProcessFirstMessage:!0}):this.isEstablishingConnection&&((o=e.message)===null||o===void 0?void 0:o.case)==="leave"?{isValid:!1,error:new Bt("Received leave request while trying to (re)connect",wt.LeaveRequest,void 0,e.message.value.reason)}:n?{isValid:!1,error:new Bt("Unexpected first message",wt.InternalError)}:{isValid:!1,error:new Bt("did not receive join response, got ".concat((a=e.message)===null||a===void 0?void 0:a.case," instead"),wt.InternalError)}}handleConnectionError(e,n){return X(this,void 0,void 0,function*(){try{const r=yield fetch(n);if(r.status.toFixed(0).startsWith("4")){const i=yield r.text();return new Bt(i,wt.NotAllowed,r.status)}else return e instanceof Bt?e:new Bt("Encountered unknown websocket error during connection: ".concat(e),wt.InternalError,r.status)}catch(r){return r instanceof Bt?r:new Bt(r instanceof Error?r.message:"server was not reachable",wt.ServerUnreachable)}})}}function YH(t){const e={type:"offer",sdp:t.sdp};switch(t.type){case"answer":case"offer":case"pranswer":case"rollback":e.type=t.type;break}return e}function Fg(t,e){return new Kf({sdp:t.sdp,type:t.type,id:e})}function W2e(t,e,n){var r;const i=new URLSearchParams;return i.set("access_token",t),n.reconnect&&(i.set("reconnect","1"),n.sid&&i.set("sid",n.sid)),i.set("auto_subscribe",n.autoSubscribe?"1":"0"),i.set("sdk",Il()?"reactnative":"js"),i.set("version",e.version),i.set("protocol",e.protocol.toString()),e.deviceModel&&i.set("device_model",e.deviceModel),e.os&&i.set("os",e.os),e.osVersion&&i.set("os_version",e.osVersion),e.browser&&i.set("browser",e.browser),e.browserVersion&&i.set("browser_version",e.browserVersion),n.adaptiveStream&&i.set("adaptive_stream","1"),n.reconnectReason&&i.set("reconnect_reason",n.reconnectReason.toString()),!((r=navigator.connection)===null||r===void 0)&&r.type&&i.set("network",navigator.connection.type),i}function Y2e(t,e,n){const r=new URLSearchParams;r.set("access_token",t);const i=new CSe({clientInfo:e,connectionSettings:new LZ({autoSubscribe:!!n.autoSubscribe,adaptiveStream:!!n.adaptiveStream}),reconnect:!!n.reconnect,participantSid:n.sid?n.sid:void 0});n.reconnectReason&&(i.reconnectReason=n.reconnectReason);const s=new TSe({joinRequest:i.toBinary()});return r.set("join_request",btoa(new TextDecoder("utf-8").decode(s.toBinary()))),r}class XH{constructor(){this.buffer=[],this._totalSize=0}push(e){this.buffer.push(e),this._totalSize+=e.data.byteLength}pop(){const e=this.buffer.shift();return e&&(this._totalSize-=e.data.byteLength),e}getAll(){return this.buffer.slice()}popToSequence(e){for(;this.buffer.length>0&&this.buffer[0].sequence<=e;)this.pop()}alignBufferedAmount(e){for(;this.buffer.length>0;){const n=this.buffer[0];if(this._totalSize-n.data.byteLength<=e)break;this.pop()}}get length(){return this.buffer.length}}class X2e{constructor(e){this._map=new Map,this._lastCleanup=0,this.ttl=e}set(e,n){const r=Date.now();r-this._lastCleanup>this.ttl/2&&this.cleanup();const i=r+this.ttl;return this._map.set(e,{value:n,expiresAt:i}),this}get(e){const n=this._map.get(e);if(n){if(n.expiresAt<Date.now()){this._map.delete(e);return}return n.value}}has(e){const n=this._map.get(e);return n?n.expiresAt<Date.now()?(this._map.delete(e),!1):!0:!1}delete(e){return this._map.delete(e)}clear(){this._map.clear()}cleanup(){const e=Date.now();for(const[n,r]of this._map.entries())r.expiresAt<e&&this._map.delete(n);this._lastCleanup=e}get size(){return this.cleanup(),this._map.size}forEach(e){this.cleanup();for(const[n,r]of this._map.entries())r.expiresAt>=Date.now()&&e(r.value,n,this.asValueMap())}map(e){this.cleanup();const n=[],r=this.asValueMap();for(const[i,s]of r.entries())n.push(e(s,i,r));return n}asValueMap(){const e=new Map;for(const[n,r]of this._map.entries())r.expiresAt>=Date.now()&&e.set(n,r.value);return e}}var hc={},Ax={},Lx={exports:{}},JH;function BP(){if(JH)return Lx.exports;JH=1;var t=Lx.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var n="candidate:%s %d %s %d %s %d typ %s";return n+=e.raddr!=null?" raddr %s rport %d":"%v%v",n+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(n+=" generation %d"),n+=e["network-id"]!=null?" network-id %d":"%v",n+=e["network-cost"]!=null?" network-cost %d":"%v",n}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var n="ssrc:%d";return e.attribute!=null&&(n+=" %s",e.value!=null&&(n+=":%s")),n}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var n="mediaclk:";return n+=e.id!=null?"id=%s %s":"%v%s",n+=e.mediaClockValue!=null?"=%s":"",n+=e.rateNumerator!=null?" rate=%s":"",n+=e.rateDenominator!=null?"/%s":"",n}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(t).forEach(function(e){var n=t[e];n.forEach(function(r){r.reg||(r.reg=/(.*)/),r.format||(r.format="%s")})}),Lx.exports}var QH;function J2e(){return QH||(QH=1,(function(t){var e=function(a){return String(Number(a))===a?Number(a):a},n=function(a,c,l,d){if(d&&!l)c[d]=e(a[1]);else for(var h=0;h<l.length;h+=1)a[h+1]!=null&&(c[l[h]]=e(a[h+1]))},r=function(a,c,l){var d=a.name&&a.names;a.push&&!c[a.push]?c[a.push]=[]:d&&!c[a.name]&&(c[a.name]={});var h=a.push?{}:d?c[a.name]:c;n(l.match(a.reg),h,a.names,a.name),a.push&&c[a.push].push(h)},i=BP(),s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(a){var c={},l=[],d=c;return a.split(/(\r\n|\r|\n)/).filter(s).forEach(function(h){var m=h[0],g=h.slice(2);m==="m"&&(l.push({rtp:[],fmtp:[]}),d=l[l.length-1]);for(var y=0;y<(i[m]||[]).length;y+=1){var v=i[m][y];if(v.reg.test(g))return r(v,d,g)}}),c.media=l,c};var o=function(a,c){var l=c.split(/=(.+)/,2);return l.length===2?a[l[0]]=e(l[1]):l.length===1&&c.length>1&&(a[l[0]]=void 0),a};t.parseParams=function(a){return a.split(/;\s?/).reduce(o,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(a){return a.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(a){for(var c=[],l=a.split(" ").map(e),d=0;d<l.length;d+=3)c.push({component:l[d],ip:l[d+1],port:l[d+2]});return c},t.parseImageAttributes=function(a){return a.split(" ").map(function(c){return c.substring(1,c.length-1).split(",").reduce(o,{})})},t.parseSimulcastStreamList=function(a){return a.split(";").map(function(c){return c.split(",").map(function(l){var d,h=!1;return l[0]!=="~"?d=e(l):(d=e(l.substring(1,l.length)),h=!0),{scid:d,paused:h}})})}})(Ax)),Ax}var Mx,ZH;function Q2e(){if(ZH)return Mx;ZH=1;var t=BP(),e=/%[sdv%]/g,n=function(o){var a=1,c=arguments,l=c.length;return o.replace(e,function(d){if(a>=l)return d;var h=c[a];switch(a+=1,d){case"%%":return"%";case"%s":return String(h);case"%d":return Number(h);case"%v":return""}})},r=function(o,a,c){var l=a.format instanceof Function?a.format(a.push?c:c[a.name]):a.format,d=[o+"="+l];if(a.names)for(var h=0;h<a.names.length;h+=1){var m=a.names[h];a.name?d.push(c[a.name][m]):d.push(c[a.names[h]])}else d.push(c[a.name]);return n.apply(null,d)},i=["v","o","s","i","u","e","p","c","b","t","r","z","a"],s=["i","c","b","a"];return Mx=function(o,a){a=a||{},o.version==null&&(o.version=0),o.name==null&&(o.name=" "),o.media.forEach(function(h){h.payloads==null&&(h.payloads="")});var c=a.outerOrder||i,l=a.innerOrder||s,d=[];return c.forEach(function(h){t[h].forEach(function(m){m.name in o&&o[m.name]!=null?d.push(r(h,m,o)):m.push in o&&o[m.push]!=null&&o[m.push].forEach(function(g){d.push(r(h,m,g))})})}),o.media.forEach(function(h){d.push(r("m",t.m[0],h)),l.forEach(function(m){t[m].forEach(function(g){g.name in h&&h[g.name]!=null?d.push(r(m,g,h)):g.push in h&&h[g.push]!=null&&h[g.push].forEach(function(y){d.push(r(m,g,y))})})})}),d.join(`\r
`)+`\r
`},Mx}var eq;function Z2e(){if(eq)return hc;eq=1;var t=J2e(),e=Q2e(),n=BP();return hc.grammar=n,hc.write=e,hc.parse=t.parse,hc.parseParams=t.parseParams,hc.parseFmtpConfig=t.parseFmtpConfig,hc.parsePayloads=t.parsePayloads,hc.parseRemoteCandidates=t.parseRemoteCandidates,hc.parseImageAttributes=t.parseImageAttributes,hc.parseSimulcastStreamList=t.parseSimulcastStreamList,hc}var sf=Z2e();function HP(t,e,n){var r,i,s;e===void 0&&(e=50),n===void 0&&(n={});var o=(r=n.isImmediate)!=null&&r,a=(i=n.callback)!=null&&i,c=n.maxWait,l=Date.now(),d=[];function h(){if(c!==void 0){var g=Date.now()-l;if(g+e>=c)return c-g}return e}var m=function(){var g=[].slice.call(arguments),y=this;return new Promise(function(v,E){var w=o&&s===void 0;if(s!==void 0&&clearTimeout(s),s=setTimeout(function(){if(s=void 0,l=Date.now(),!o){var x=t.apply(y,g);a&&a(x),d.forEach(function(C){return(0,C.resolve)(x)}),d=[]}},h()),w){var R=t.apply(y,g);return a&&a(R),v(R)}d.push({resolve:v,reject:E})})};return m.cancel=function(g){s!==void 0&&clearTimeout(s),d.forEach(function(y){return(0,y.reject)(g)}),d=[]},m}const ewe=.7,twe=20,ov={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class tq extends jl.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var r;super(),this.log=kt,this.ddExtID=0,this.latestOfferId=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=HP(i=>X(this,void 0,void 0,function*(){this.emit(ov.NegotiationStarted);try{yield this.createAndSendOffer()}catch(s){if(i)i(s);else throw s}}),twe),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=ed((r=n.loggerName)!==null&&r!==void 0?r:Nc.PCTransport),this.loggerOptions=n,this.config=e,this._pc=this.createPC(),this.offerLock=new ps}createPC(){const e=new RTCPeerConnection(this.config);return e.onicecandidate=n=>{var r;n.candidate&&((r=this.onIceCandidate)===null||r===void 0||r.call(this,n.candidate))},e.onicecandidateerror=n=>{var r;(r=this.onIceCandidateError)===null||r===void 0||r.call(this,n)},e.oniceconnectionstatechange=()=>{var n;(n=this.onIceConnectionStateChange)===null||n===void 0||n.call(this,e.iceConnectionState)},e.onsignalingstatechange=()=>{var n;(n=this.onSignalingStatechange)===null||n===void 0||n.call(this,e.signalingState)},e.onconnectionstatechange=()=>{var n;(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,e.connectionState)},e.ondatachannel=n=>{var r;(r=this.onDataChannel)===null||r===void 0||r.call(this,n)},e.ontrack=n=>{var r;(r=this.onTrack)===null||r===void 0||r.call(this,n)},e}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isICEConnected(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}addIceCandidate(e){return X(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)})}setRemoteDescription(e,n){return X(this,void 0,void 0,function*(){var r;if(e.type==="answer"&&this.latestOfferId>0&&n>0&&n!==this.latestOfferId)return this.log.warn("ignoring answer for old offer",Object.assign(Object.assign({},this.logContext),{offerId:n,latestOfferId:this.latestOfferId})),!1;let i;if(e.type==="offer"){let{stereoMids:s,nackMids:o}=nwe(e);this.remoteStereoMids=s,this.remoteNackMids=o}else if(e.type==="answer"){const s=sf.parse((r=e.sdp)!==null&&r!==void 0?r:"");s.media.forEach(o=>{const a=qP(o.mid);o.type==="audio"&&this.trackBitrates.some(c=>{if(!c.transceiver||a!=c.transceiver.mid)return!1;let l=0;if(o.rtp.some(h=>h.codec.toUpperCase()===c.codec.toUpperCase()?(l=h.payload,!0):!1),l===0)return!0;let d=!1;for(const h of o.fmtp)if(h.payload===l){h.config=h.config.split(";").filter(m=>!m.includes("maxaveragebitrate")).join(";"),c.maxbr>0&&(h.config+=";maxaveragebitrate=".concat(c.maxbr*1e3)),d=!0;break}return d||c.maxbr>0&&o.fmtp.push({payload:l,config:"maxaveragebitrate=".concat(c.maxbr*1e3)}),!0})}),i=sf.write(s)}return yield this.setMungedSDP(e,i,!0),this.pendingCandidates.forEach(s=>{this.pc.addIceCandidate(s)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):e.type==="answer"&&(this.emit(ov.NegotiationComplete),e.sdp&&sf.parse(e.sdp).media.forEach(o=>{o.type==="video"&&this.emit(ov.RTPVideoPayloadTypes,o.rtp)})),!0})}createAndSendOffer(e){return X(this,void 0,void 0,function*(){var n;const r=yield this.offerLock.lock();try{if(this.onOffer===void 0)return;if(e?.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&this._pc.signalingState==="have-local-offer"){const a=this._pc.remoteDescription;if(e?.iceRestart&&a)yield this._pc.setRemoteDescription(a);else{this.renegotiate=!0;return}}else if(!this._pc||this._pc.signalingState==="closed"){this.log.warn("could not createOffer with closed peer connection",this.logContext);return}this.log.debug("starting to negotiate",this.logContext);const i=this.latestOfferId+1;this.latestOfferId=i;const s=yield this.pc.createOffer(e);this.log.debug("original offer",Object.assign({sdp:s.sdp},this.logContext));const o=sf.parse((n=s.sdp)!==null&&n!==void 0?n:"");if(o.media.forEach(a=>{rq(a),a.type==="audio"?nq(a,["all"],[]):a.type==="video"&&this.trackBitrates.some(c=>{if(!a.msid||!c.cid||!a.msid.includes(c.cid))return!1;let l=0;if(a.rtp.some(h=>h.codec.toUpperCase()===c.codec.toUpperCase()?(l=h.payload,!0):!1),l===0||(kc(c.codec)&&!Mp()&&this.ensureVideoDDExtensionForSVC(a,o),!kc(c.codec)))return!0;const d=Math.round(c.maxbr*ewe);for(const h of a.fmtp)if(h.payload===l){h.config.includes("x-google-start-bitrate")||(h.config+=";x-google-start-bitrate=".concat(d));break}return!0})}),this.latestOfferId>i){this.log.warn("latestOfferId mismatch",Object.assign(Object.assign({},this.logContext),{latestOfferId:this.latestOfferId,offerId:i}));return}yield this.setMungedSDP(s,sf.write(o)),this.onOffer(s,this.latestOfferId)}finally{r()}})}createAndSetAnswer(){return X(this,void 0,void 0,function*(){var e;const n=yield this.pc.createAnswer(),r=sf.parse((e=n.sdp)!==null&&e!==void 0?e:"");return r.media.forEach(i=>{rq(i),i.type==="audio"&&nq(i,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(n,sf.write(r)),n})}createDataChannel(e,n){return this.pc.createDataChannel(e,n)}addTransceiver(e,n){return this.pc.addTransceiver(e,n)}addTransceiverOfKind(e,n){return this.pc.addTransceiver(e,n)}addTrack(e){if(!this._pc)throw new di("PC closed, cannot add track");return this._pc.addTrack(e)}setTrackCodecBitrate(e){this.trackBitrates.push(e)}setConfiguration(e){var n;if(!this._pc)throw new di("PC closed, cannot configure");return(n=this._pc)===null||n===void 0?void 0:n.setConfiguration(e)}canRemoveTrack(){var e;return!!(!((e=this._pc)===null||e===void 0)&&e.removeTrack)}removeTrack(e){var n;return(n=this._pc)===null||n===void 0?void 0:n.removeTrack(e)}getConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.connectionState)!==null&&n!==void 0?n:"closed"}getICEConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.iceConnectionState)!==null&&n!==void 0?n:"closed"}getSignallingState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.signalingState)!==null&&n!==void 0?n:"closed"}getTransceivers(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getTransceivers())!==null&&n!==void 0?n:[]}getSenders(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getSenders())!==null&&n!==void 0?n:[]}getLocalDescription(){var e;return(e=this._pc)===null||e===void 0?void 0:e.localDescription}getRemoteDescription(){var e;return(e=this.pc)===null||e===void 0?void 0:e.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return X(this,void 0,void 0,function*(){var e;if(!this._pc)return;let n="";const r=new Map,i=new Map;if((yield this._pc.getStats()).forEach(a=>{switch(a.type){case"transport":n=a.selectedCandidatePairId;break;case"candidate-pair":n===""&&a.selected&&(n=a.id),r.set(a.id,a);break;case"remote-candidate":i.set(a.id,"".concat(a.address,":").concat(a.port));break}}),n==="")return;const o=(e=r.get(n))===null||e===void 0?void 0:e.remoteCandidateId;if(o!==void 0)return i.get(o)})}setMungedSDP(e,n,r){return X(this,void 0,void 0,function*(){if(n){const i=e.sdp;e.sdp=n;try{this.log.debug("setting munged ".concat(r?"remote":"local"," description"),this.logContext),r?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e);return}catch(s){this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:s,sdp:n})),e.sdp=i}}try{r?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(i){let s="unknown error";i instanceof Error?s=i.message:typeof i=="string"&&(s=i);const o={error:s,sdp:e.sdp};throw!r&&this.pc.remoteDescription&&(o.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:o})),new cL(s)}})}ensureVideoDDExtensionForSVC(e,n){var r,i;if(!((r=e.ext)===null||r===void 0?void 0:r.some(o=>o.uri===$H))){if(this.ddExtID===0){let o=0;n.media.forEach(a=>{var c;a.type==="video"&&((c=a.ext)===null||c===void 0||c.forEach(l=>{l.value>o&&(o=l.value)}))}),this.ddExtID=o+1}(i=e.ext)===null||i===void 0||i.push({value:this.ddExtID,uri:$H})}}}function nq(t,e,n){const r=qP(t.mid);let i=0;t.rtp.some(s=>s.codec==="opus"?(i=s.payload,!0):!1),i>0&&(t.rtcpFb||(t.rtcpFb=[]),n.includes(r)&&!t.rtcpFb.some(s=>s.payload===i&&s.type==="nack")&&t.rtcpFb.push({payload:i,type:"nack"}),(e.includes(r)||e.length===1&&e[0]==="all")&&t.fmtp.some(s=>s.payload===i?(s.config.includes("stereo=1")||(s.config+=";stereo=1"),!0):!1))}function nwe(t){var e;const n=[],r=[],i=sf.parse((e=t.sdp)!==null&&e!==void 0?e:"");let s=0;return i.media.forEach(o=>{var a;const c=qP(o.mid);o.type==="audio"&&(o.rtp.some(l=>l.codec==="opus"?(s=l.payload,!0):!1),!((a=o.rtcpFb)===null||a===void 0)&&a.some(l=>l.payload===s&&l.type==="nack")&&r.push(c),o.fmtp.some(l=>l.payload===s?(l.config.includes("sprop-stereo=1")&&n.push(c),!0):!1))}),{stereoMids:n,nackMids:r}}function rq(t){if(t.connection){const e=t.connection.ip.indexOf(":")>=0;(t.connection.version===4&&e||t.connection.version===6&&!e)&&(t.connection.ip="0.0.0.0",t.connection.version=4)}}function qP(t){return typeof t=="number"?t.toFixed(0):t}const gL="vp8",rwe={audioPreset:KC.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:jT.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:gL,backupCodec:!0,preConnectBuffer:!1},Eee={deviceId:{ideal:"default"},autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},Cee={deviceId:{ideal:"default"},resolution:Sl.h720.resolution},iwe={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new PZ,disconnectOnPageLeave:!0,webAudioMix:!1,singlePeerConnection:!1},VP={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var xr;(function(t){t[t.NEW=0]="NEW",t[t.CONNECTING=1]="CONNECTING",t[t.CONNECTED=2]="CONNECTED",t[t.FAILED=3]="FAILED",t[t.CLOSING=4]="CLOSING",t[t.CLOSED=5]="CLOSED"})(xr||(xr={}));class swe{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}constructor(e,n,r){var i;this.peerConnectionTimeout=VP.peerConnectionTimeout,this.log=kt,this.updateState=()=>{var s,o;const a=this.state,c=this.requiredTransports.map(l=>l.getConnectionState());c.every(l=>l==="connected")?this.state=xr.CONNECTED:c.some(l=>l==="failed")?this.state=xr.FAILED:c.some(l=>l==="connecting")?this.state=xr.CONNECTING:c.every(l=>l==="closed")?this.state=xr.CLOSED:c.some(l=>l==="closed")?this.state=xr.CLOSING:c.every(l=>l==="new")&&(this.state=xr.NEW),a!==this.state&&(this.log.debug("pc state change: from ".concat(xr[a]," to ").concat(xr[this.state]),this.logContext),(s=this.onStateChange)===null||s===void 0||s.call(this,this.state,this.publisher.getConnectionState(),(o=this.subscriber)===null||o===void 0?void 0:o.getConnectionState()))},this.log=ed((i=r.loggerName)!==null&&i!==void 0?i:Nc.PCManager),this.loggerOptions=r,this.isPublisherConnectionRequired=n!=="subscriber-primary",this.isSubscriberConnectionRequired=n==="subscriber-primary",this.publisher=new tq(e,r),n!=="publisher-only"&&(this.subscriber=new tq(e,r),this.subscriber.onConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.subscriber.onIceCandidate=s=>{var o;(o=this.onIceCandidate)===null||o===void 0||o.call(this,s,Rc.SUBSCRIBER)},this.subscriber.onDataChannel=s=>{var o;(o=this.onDataChannel)===null||o===void 0||o.call(this,s)},this.subscriber.onTrack=s=>{var o;(o=this.onTrack)===null||o===void 0||o.call(this,s)}),this.publisher.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=s=>{var o;(o=this.onIceCandidate)===null||o===void 0||o.call(this,s,Rc.PUBLISHER)},this.publisher.onTrack=s=>{var o;(o=this.onTrack)===null||o===void 0||o.call(this,s)},this.publisher.onOffer=(s,o)=>{var a;(a=this.onPublisherOffer)===null||a===void 0||a.call(this,s,o)},this.state=xr.NEW,this.connectionLock=new ps,this.remoteOfferLock=new ps}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}requirePublisher(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isPublisherConnectionRequired=e,this.updateState()}createAndSendPublisherOffer(e){return this.publisher.createAndSendOffer(e)}setPublisherAnswer(e,n){return this.publisher.setRemoteDescription(e,n)}removeTrack(e){return this.publisher.removeTrack(e)}close(){return X(this,void 0,void 0,function*(){var e;if(this.publisher&&this.publisher.getSignallingState()!=="closed"){const n=this.publisher;for(const r of n.getSenders())try{n.canRemoveTrack()&&n.removeTrack(r)}catch(i){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:i}))}}yield Promise.all([this.publisher.close(),(e=this.subscriber)===null||e===void 0?void 0:e.close()]),this.updateState()})}triggerIceRestart(){return X(this,void 0,void 0,function*(){this.subscriber&&(this.subscriber.restartingIce=!0),this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(e,n){return X(this,void 0,void 0,function*(){var r;n===Rc.PUBLISHER?yield this.publisher.addIceCandidate(e):yield(r=this.subscriber)===null||r===void 0?void 0:r.addIceCandidate(e)})}createSubscriberAnswerFromOffer(e,n){return X(this,void 0,void 0,function*(){var r,i,s;this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:(r=this.subscriber)===null||r===void 0?void 0:r.getSignallingState().toString()}));const o=yield this.remoteOfferLock.lock();try{return(yield(i=this.subscriber)===null||i===void 0?void 0:i.setRemoteDescription(e,n))?yield(s=this.subscriber)===null||s===void 0?void 0:s.createAndSetAnswer():void 0}finally{o()}})}updateConfiguration(e,n){var r;this.publisher.setConfiguration(e),(r=this.subscriber)===null||r===void 0||r.setConfiguration(e),n&&this.triggerIceRestart()}ensurePCTransportConnection(e,n){return X(this,void 0,void 0,function*(){var r;const i=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&this.publisher.getConnectionState()!=="connected"&&this.publisher.getConnectionState()!=="connecting"&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all((r=this.requiredTransports)===null||r===void 0?void 0:r.map(s=>this.ensureTransportConnected(s,e,n)))}finally{i()}})}negotiate(e){return X(this,void 0,void 0,function*(){return new Promise((n,r)=>X(this,void 0,void 0,function*(){const i=setTimeout(()=>{r("negotiation timed out")},this.peerConnectionTimeout),s=()=>{clearTimeout(i),r("negotiation aborted")};e.signal.addEventListener("abort",s),this.publisher.once(ov.NegotiationStarted,()=>{e.signal.aborted||this.publisher.once(ov.NegotiationComplete,()=>{clearTimeout(i),n()})}),yield this.publisher.negotiate(o=>{clearTimeout(i),r(o)})}))})}addPublisherTransceiver(e,n){return this.publisher.addTransceiver(e,n)}addPublisherTransceiverOfKind(e,n){return this.publisher.addTransceiverOfKind(e,n)}getMidForReceiver(e){const r=(this.subscriber?this.subscriber.getTransceivers():this.publisher.getTransceivers()).find(i=>i.receiver===e);return r?.mid}addPublisherTrack(e){return this.publisher.addTrack(e)}createPublisherDataChannel(e,n){return this.publisher.createDataChannel(e,n)}getConnectedAddress(e){return e===Rc.PUBLISHER?this.publisher.getConnectedAddress():e===Rc.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&this.subscriber&&e.push(this.subscriber),e}ensureTransportConnected(e,n){return X(this,arguments,void 0,function(r,i){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.peerConnectionTimeout;return(function*(){if(r.getConnectionState()!=="connected")return new Promise((c,l)=>X(s,void 0,void 0,function*(){const d=()=>{this.log.warn("abort transport connection",this.logContext),ts.clearTimeout(h),l(new Bt("room connection has been cancelled",wt.Cancelled))};i?.signal.aborted&&d(),i?.signal.addEventListener("abort",d);const h=ts.setTimeout(()=>{i?.signal.removeEventListener("abort",d),l(new Bt("could not establish pc connection",wt.InternalError))},o);for(;this.state!==xr.CONNECTED;)if(yield ns(50),i?.signal.aborted){l(new Bt("room connection has been cancelled",wt.Cancelled));return}ts.clearTimeout(h),i?.signal.removeEventListener("abort",d),c()}))})()})}}const Tee=5e3,owe=3e4;class fn{static fetchRegionSettings(e,n,r){return X(this,void 0,void 0,function*(){const i=yield fn.fetchLock.lock();try{const s=yield fetch("".concat(awe(e),"/regions"),{headers:{authorization:"Bearer ".concat(n)},signal:r});if(s.ok){const o=I2e(s.headers),a=o?o*1e3:Tee;return{regionSettings:yield s.json(),updatedAtInMs:Date.now(),maxAgeInMs:a}}else throw new Bt("Could not fetch region settings: ".concat(s.statusText),s.status===401?wt.NotAllowed:wt.InternalError,s.status)}catch(s){throw s instanceof Bt?s:r?.aborted?new Bt("Region fetching was aborted",wt.Cancelled):new Bt("Could not fetch region settings, ".concat(s instanceof Error?"".concat(s.name,": ").concat(s.message):s),wt.ServerUnreachable,500)}finally{i()}})}static scheduleRefetch(e,n,r){return X(this,void 0,void 0,function*(){const i=fn.settingsTimeouts.get(e.hostname);clearTimeout(i),fn.settingsTimeouts.set(e.hostname,setTimeout(()=>X(this,void 0,void 0,function*(){try{const s=yield fn.fetchRegionSettings(e,n);fn.updateCachedRegionSettings(e,n,s)}catch(s){if(s instanceof Bt&&s.reason===wt.NotAllowed){kt.debug("token is not valid, cancelling auto region refresh");return}kt.debug("auto refetching of region settings failed",{error:s}),fn.scheduleRefetch(e,n,r)}}),r))})}static updateCachedRegionSettings(e,n,r){fn.cache.set(e.hostname,r),fn.scheduleRefetch(e,n,r.maxAgeInMs)}static stopRefetch(e){const n=fn.settingsTimeouts.get(e);n&&(clearTimeout(n),fn.settingsTimeouts.delete(e))}static scheduleCleanup(e){let n=fn.connectionTrackers.get(e);n&&(n.cleanupTimeout&&clearTimeout(n.cleanupTimeout),n.cleanupTimeout=setTimeout(()=>{const r=fn.connectionTrackers.get(e);r&&r.connectionCount===0&&(kt.debug("stopping region refetch after disconnect delay",{hostname:e}),fn.stopRefetch(e)),r&&(r.cleanupTimeout=void 0)},owe))}static cancelCleanup(e){const n=fn.connectionTrackers.get(e);n?.cleanupTimeout&&(clearTimeout(n.cleanupTimeout),n.cleanupTimeout=void 0)}notifyConnected(){const e=this.serverUrl.hostname;let n=fn.connectionTrackers.get(e);n||(n={connectionCount:0},fn.connectionTrackers.set(e,n)),n.connectionCount++,fn.cancelCleanup(e)}notifyDisconnected(){const e=this.serverUrl.hostname,n=fn.connectionTrackers.get(e);n&&(n.connectionCount=Math.max(0,n.connectionCount-1),n.connectionCount===0&&fn.scheduleCleanup(e))}constructor(e,n){this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=n}updateToken(e){this.token=e}isCloud(){return GC(this.serverUrl)}getServerUrl(){return this.serverUrl}fetchRegionSettings(e){return X(this,void 0,void 0,function*(){return fn.fetchRegionSettings(this.serverUrl,this.token,e)})}getNextBestRegionUrl(e){return X(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");let n=fn.cache.get(this.serverUrl.hostname);(!n||Date.now()-n.updatedAtInMs>n.maxAgeInMs)&&(n=yield this.fetchRegionSettings(e),fn.updateCachedRegionSettings(this.serverUrl,this.token,n));const r=n.regionSettings.regions.filter(i=>!this.attemptedRegions.find(s=>s.url===i.url));if(r.length>0){const i=r[0];return this.attemptedRegions.push(i),kt.debug("next region: ".concat(i.region)),i.url}else return null})}resetAttempts(){this.attemptedRegions=[]}setServerReportedRegions(e){fn.updateCachedRegionSettings(this.serverUrl,this.token,e)}}fn.cache=new Map;fn.settingsTimeouts=new Map;fn.connectionTrackers=new Map;fn.fetchLock=new ps;function awe(t){return"".concat(t.protocol.replace("ws","http"),"//").concat(t.host,"/settings")}class Or extends Error{constructor(e,n,r){super(n),this.code=e,this.message=iq(n,Or.MAX_MESSAGE_BYTES),this.data=r?iq(r,Or.MAX_DATA_BYTES):void 0}static fromProto(e){return new Or(e.code,e.message,e.data)}toProto(){return new fZ({code:this.code,message:this.message,data:this.data})}static builtIn(e,n){return new Or(Or.ErrorCode[e],Or.ErrorMessage[e],n)}}Or.MAX_MESSAGE_BYTES=256;Or.MAX_DATA_BYTES=15360;Or.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404};Or.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};const Ree=15360;function KP(t){return new TextEncoder().encode(t).length}function iq(t,e){if(KP(t)<=e)return t;let n=0,r=t.length;const i=new TextEncoder;for(;n<r;){const s=Math.floor((n+r+1)/2);i.encode(t.slice(0,s)).length<=e?n=s:r=s-1}return t.slice(0,n)}const GP=2e3;function FT(t,e){if(!e)return 0;let n,r;return"bytesReceived"in t?(n=t.bytesReceived,r=e.bytesReceived):"bytesSent"in t&&(n=t.bytesSent,r=e.bytesSent),n===void 0||r===void 0||t.timestamp===void 0||e.timestamp===void 0?0:(n-r)*8*1e3/(t.timestamp-e.timestamp)}const zP=typeof MediaRecorder<"u";class cwe{constructor(){throw new Error("MediaRecorder is not available in this environment")}}const lwe=zP?MediaRecorder:cwe;class uwe extends lwe{constructor(e,n){if(!zP)throw new Error("MediaRecorder is not available in this environment");super(new MediaStream([e.mediaStreamTrack]),n);let r,i;const s=()=>i===void 0,o=()=>{this.removeEventListener("dataavailable",r),this.removeEventListener("stop",o),this.removeEventListener("error",a),i?.close(),i=void 0},a=c=>{i?.error(c),this.removeEventListener("dataavailable",r),this.removeEventListener("stop",o),this.removeEventListener("error",a),i=void 0};this.byteStream=new ReadableStream({start:c=>{i=c,r=l=>X(this,void 0,void 0,function*(){let d;if(l.data.arrayBuffer){const h=yield l.data.arrayBuffer();d=new Uint8Array(h)}else if(l.data.byteArray)d=l.data.byteArray;else throw new Error("no data available!");s()||c.enqueue(d)}),this.addEventListener("dataavailable",r)},cancel:()=>{o()}}),this.addEventListener("stop",o),this.addEventListener("error",a)}}function dwe(){return zP}const fwe=1e3,hwe=1e4;class WP extends pe{get sender(){return this._sender}set sender(e){this._sender=e}get constraints(){return this._constraints}get hasPreConnectBuffer(){return!!this.localTrackRecorder}constructor(e,n,r){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,s=arguments.length>4?arguments[4]:void 0;super(e,n,s),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=HP(()=>X(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>X(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(Ae.Ended,this)},this.reacquireTrack=!1,this.providedByUser=i,this.muteLock=new ps,this.pauseUpstreamLock=new ps,this.trackChangeLock=new ps,this.trackChangeLock.lock().then(o=>X(this,void 0,void 0,function*(){try{yield this.setMediaStreamTrack(e,!0)}finally{o()}})),this._constraints=e.getConstraints(),r&&(this._constraints=r)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==pe.Kind.Video)return;const{width:e,height:n}=this._mediaStreamTrack.getSettings();if(e&&n)return{width:e,height:n}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,n;return(n=(e=this.processor)===null||e===void 0?void 0:e.processedTrack)!==null&&n!==void 0?n:this._mediaStreamTrack}get isLocal(){return!0}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(e,n){return X(this,void 0,void 0,function*(){var r;if(e===this._mediaStreamTrack&&!n)return;this._mediaStreamTrack&&(this.attachedElements.forEach(s=>{iv(this._mediaStreamTrack,s)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints());let i;if(this.processor&&e){if(this.log.debug("restarting processor",this.logContext),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(jg(e,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),i=this.processor.processedTrack}this.sender&&((r=this.sender.transport)===null||r===void 0?void 0:r.state)!=="closed"&&(yield this.sender.replaceTrack(i??e)),!this.providedByUser&&this._mediaStreamTrack!==e&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(s=>{jg(i??e,s)}))})}waitForDimensions(){return X(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:fwe;return(function*(){var r;if(e.kind===pe.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");((r=ho())===null||r===void 0?void 0:r.os)==="iOS"&&(yield ns(10));const i=Date.now();for(;Date.now()-i<n;){const s=e.dimensions;if(s)return s;yield ns(50)}throw new Pu("unable to get track dimensions after timeout")})()})}setDeviceId(e){return X(this,void 0,void 0,function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===Of(e)||(this._constraints.deviceId=e,this.isMuted)?!0:(yield this.restartTrack(),Of(e)===this._mediaStreamTrack.getSettings().deviceId)})}getDeviceId(){return X(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){if(e.source===pe.Source.ScreenShare)return;const{deviceId:r,groupId:i}=e._mediaStreamTrack.getSettings(),s=e.kind===pe.Kind.Audio?"audioinput":"videoinput";return n?Ni.getInstance().normalizeDeviceId(s,r,i):r})()})}mute(){return X(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return X(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(e,n){return X(this,void 0,void 0,function*(){const r=yield this.trackChangeLock.lock();try{if(!this.sender)throw new Pu("unable to replace an unpublished track");let i,s;return typeof n=="boolean"?i=n:n!==void 0&&(i=n.userProvidedTrack,s=n.stopProcessor),this.providedByUser=i??!0,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(e),s&&this.processor&&(yield this.internalStopProcessor()),this}finally{r()}})}restart(e){return X(this,void 0,void 0,function*(){this.manuallyStopped=!1;const n=yield this.trackChangeLock.lock();try{e||(e=this._constraints);const{deviceId:r,facingMode:i}=e,s=PSe(e,["deviceId","facingMode"]);this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:e}));const o={audio:!1,video:!1};this.kind===pe.Kind.Video?o.video=r||i?{deviceId:r,facingMode:i}:!0:o.audio=r?Object.assign({deviceId:r},s):!0,this.attachedElements.forEach(l=>{iv(this.mediaStreamTrack,l)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const c=(yield navigator.mediaDevices.getUserMedia(o)).getTracks()[0];return this.kind===pe.Kind.Video&&(yield c.applyConstraints(s)),c.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(c),this._constraints=e,this.emit(Ae.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{n()}})}setTrackMuted(e){this.log.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted"),this.logContext),!(this.isMuted===e&&this._mediaStreamTrack.enabled!==e)&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?Ae.Muted:Ae.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return X(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),mee()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var e;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(e=this.processor)===null||e===void 0||e.destroy(),this.processor=void 0}pauseUpstream(){return X(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!0)return;if(!this.sender){this.log.warn("unable to pause upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!0,this.emit(Ae.UpstreamPaused,this);const r=ho();if(r?.name==="Safari"&&xl(r.version,"12.0")<0)throw new jP("pauseUpstream is not supported on Safari < 12.");((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(null))}finally{n()}})}resumeUpstream(){return X(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!1)return;if(!this.sender){this.log.warn("unable to resume upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!1,this.emit(Ae.UpstreamResumed,this),((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(this.mediaStreamTrack))}finally{n()}})}getRTCStatsReport(){return X(this,void 0,void 0,function*(){var e;return!((e=this.sender)===null||e===void 0)&&e.getStats?yield this.sender.getStats():void 0})}setProcessor(e){return X(this,arguments,void 0,function(n){var r=this;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var s;const o=yield r.trackChangeLock.lock();try{r.log.debug("setting up processor",r.logContext);const a=document.createElement(r.kind),c={kind:r.kind,track:r._mediaStreamTrack,element:a,audioContext:r.audioContext};if(yield n.init(c),r.log.debug("processor initialized",r.logContext),r.processor&&(yield r.internalStopProcessor()),r.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");if(jg(r._mediaStreamTrack,a),a.muted=!0,a.play().catch(l=>{l instanceof DOMException&&l.name==="AbortError"?(r.log.warn("failed to play processor element, retrying",Object.assign(Object.assign({},r.logContext),{error:l})),setTimeout(()=>{a.play().catch(d=>{r.log.error("failed to play processor element",Object.assign(Object.assign({},r.logContext),{err:d}))})},100)):r.log.error("failed to play processor element",Object.assign(Object.assign({},r.logContext),{error:l}))}),r.processor=n,r.processorElement=a,r.processor.processedTrack){for(const l of r.attachedElements)l!==r.processorElement&&i&&(iv(r._mediaStreamTrack,l),jg(r.processor.processedTrack,l));yield(s=r.sender)===null||s===void 0?void 0:s.replaceTrack(r.processor.processedTrack)}r.emit(Ae.TrackProcessorUpdate,r.processor)}finally{o()}})()})}getProcessor(){return this.processor}stopProcessor(){return X(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){const r=yield e.trackChangeLock.lock();try{yield e.internalStopProcessor(n)}finally{r()}})()})}internalStopProcessor(){return X(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){var r,i;e.processor&&(e.log.debug("stopping processor",e.logContext),(r=e.processor.processedTrack)===null||r===void 0||r.stop(),yield e.processor.destroy(),e.processor=void 0,n||((i=e.processorElement)===null||i===void 0||i.remove(),e.processorElement=void 0),yield e._mediaStreamTrack.applyConstraints(e._constraints),yield e.setMediaStreamTrack(e._mediaStreamTrack,!0),e.emit(Ae.TrackProcessorUpdate))})()})}startPreConnectBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;if(!dwe()){this.log.warn("MediaRecorder is not available, cannot start preconnect buffer",this.logContext);return}if(this.localTrackRecorder){this.log.warn("preconnect buffer already started");return}else{let n="audio/webm;codecs=opus";MediaRecorder.isTypeSupported(n)||(n="video/mp4"),this.localTrackRecorder=new uwe(this,{mimeType:n})}this.localTrackRecorder.start(e),this.autoStopPreConnectBuffer=setTimeout(()=>{this.log.warn("preconnect buffer timed out, stopping recording automatically",this.logContext),this.stopPreConnectBuffer()},hwe)}stopPreConnectBuffer(){clearTimeout(this.autoStopPreConnectBuffer),this.localTrackRecorder&&(this.localTrackRecorder.stop(),this.localTrackRecorder=void 0)}getPreConnectBuffer(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.byteStream}getPreConnectBufferMimeType(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.mimeType}}class zC extends WP{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,i=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;super(e,pe.Kind.Audio,n,r,s),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>X(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let o;try{o=yield this.getSenderStats()}catch(a){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:a}));return}o&&this.prevStats&&(this._currentBitrate=FT(o,this.prevStats)),this.prevStats=o}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(Ae.AudioTrackFeatureUpdate,this,Di.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(Ae.AudioTrackFeatureUpdate,this,Di.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=i,this.checkForSilence()}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return X(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===pe.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return X(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const r=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==Of(this._constraints.deviceId);return this.source===pe.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||r)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{n()}})}restartTrack(e){return X(this,void 0,void 0,function*(){let n;if(e){const r=FP({audio:e});typeof r.audio!="boolean"&&(n=r.audio)}yield this.restart(n)})}restart(e){const n=Object.create(null,{restart:{get:()=>super.restart}});return X(this,void 0,void 0,function*(){const r=yield n.restart.call(this,e);return this.checkForSilence(),r})}startMonitor(){co()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},GP)))}setProcessor(e){return X(this,void 0,void 0,function*(){var n;const r=yield this.trackChangeLock.lock();try{if(!Il()&&!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.internalStopProcessor());const i={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(e.name),this.logContext),yield e.init(i),this.processor=e,this.processor.processedTrack&&(yield(n=this.sender)===null||n===void 0?void 0:n.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(Ae.TrackProcessorUpdate,this.processor)}finally{r()}})}setAudioContext(e){this.audioContext=e}getSenderStats(){return X(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return;const n=yield this.sender.getStats();let r;return n.forEach(i=>{i.type==="outbound-rtp"&&(r={type:"audio",streamId:i.id,packetsSent:i.packetsSent,packetsLost:i.packetsLost,bytesSent:i.bytesSent,timestamp:i.timestamp,roundTripTime:i.roundTripTime,jitter:i.jitter})}),r})}checkForSilence(){return X(this,void 0,void 0,function*(){const e=yield bee(this);return e&&(this.isMuted||this.log.debug("silence detected on local audio track",this.logContext),this.emit(Ae.AudioSilenceDetected)),e})}}function pwe(t,e,n){switch(t.kind){case"audio":return new zC(t,e,!1,void 0,n);case"video":return new Pv(t,e,!1,n);default:throw new Pu("unsupported track type: ".concat(t.kind))}}const mwe=Object.values(Sl),gwe=Object.values(lL),vwe=Object.values(jT),ywe=[Sl.h180,Sl.h360],bwe=[lL.h180,lL.h360],_we=t=>[{scaleResolutionDownBy:2,fps:t.encoding.maxFramerate}].map(n=>{var r,i;return new kn(Math.floor(t.width/n.scaleResolutionDownBy),Math.floor(t.height/n.scaleResolutionDownBy),Math.max(15e4,Math.floor(t.encoding.maxBitrate/(Math.pow(n.scaleResolutionDownBy,2)*(((r=t.encoding.maxFramerate)!==null&&r!==void 0?r:30)/((i=n.fps)!==null&&i!==void 0?i:30))))),n.fps,t.encoding.priority)}),vL=["q","h","f"];function yL(t,e,n,r){var i,s;let o=r?.videoEncoding;t&&(o=r?.screenShareEncoding);const a=r?.simulcast,c=r?.scalabilityMode,l=r?.videoCodec;if(!o&&!a&&!c||!e||!n)return[{}];o||(o=wwe(t,e,n,l),kt.debug("using video encoding",o));const d=o.maxFramerate,h=new kn(e,n,o.maxBitrate,o.maxFramerate,o.priority);if(c&&kc(l)){const y=new kee(c),v=[];if(y.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(c));const E=ho();if(Kb()||Il()||E?.name==="Chrome"&&xl(E?.version,"113")<0){const w=y.suffix=="h"?2:3,R=g2e(E);for(let x=0;x<y.spatial;x+=1)v.push({rid:vL[2-x],maxBitrate:o.maxBitrate/Math.pow(w,x),maxFramerate:h.encoding.maxFramerate,scaleResolutionDownBy:R?Math.pow(2,x):void 0});v[0].scalabilityMode=c}else v.push({maxBitrate:o.maxBitrate,maxFramerate:h.encoding.maxFramerate,scalabilityMode:c});return h.encoding.priority&&(v[0].priority=h.encoding.priority,v[0].networkPriority=h.encoding.priority),kt.debug("using svc encoding",{encodings:v}),v}if(!a)return[o];let m=[];t?m=(i=oq(r?.screenShareSimulcastLayers))!==null&&i!==void 0?i:sq(t,h):m=(s=oq(r?.videoSimulcastLayers))!==null&&s!==void 0?s:sq(t,h);let g;if(m.length>0){const y=m[0];m.length>1&&([,g]=m);const v=Math.max(e,n);if(v>=960&&g)return Ox(e,n,[y,g,h],d);if(v>=480)return Ox(e,n,[y,h],d)}return Ox(e,n,[h])}function Swe(t,e,n){var r,i,s,o;if(!n.backupCodec||n.backupCodec===!0||n.backupCodec.codec===n.videoCodec)return;e!==n.backupCodec.codec&&kt.warn("requested a different codec than specified as backup",{serverRequested:e,backup:n.backupCodec.codec}),n.videoCodec=e,n.videoEncoding=n.backupCodec.encoding;const a=t.mediaStreamTrack.getSettings(),c=(r=a.width)!==null&&r!==void 0?r:(i=t.dimensions)===null||i===void 0?void 0:i.width,l=(s=a.height)!==null&&s!==void 0?s:(o=t.dimensions)===null||o===void 0?void 0:o.height;return t.source===pe.Source.ScreenShare&&n.simulcast&&(n.simulcast=!1),yL(t.source===pe.Source.ScreenShare,c,l,n)}function wwe(t,e,n,r){const i=Ewe(t,e,n);let{encoding:s}=i[0];const o=Math.max(e,n);for(let a=0;a<i.length;a+=1){const c=i[a];if(s=c.encoding,c.width>=o)break}if(r)switch(r){case"av1":case"h265":s=Object.assign({},s),s.maxBitrate=s.maxBitrate*.7;break;case"vp9":s=Object.assign({},s),s.maxBitrate=s.maxBitrate*.85;break}return s}function Ewe(t,e,n){if(t)return vwe;const r=e>n?e/n:n/e;return Math.abs(r-16/9)<Math.abs(r-4/3)?mwe:gwe}function sq(t,e){if(t)return _we(e);const{width:n,height:r}=e,i=n>r?n/r:r/n;return Math.abs(i-16/9)<Math.abs(i-4/3)?ywe:bwe}function Ox(t,e,n,r){const i=[];if(n.forEach((s,o)=>{if(o>=vL.length)return;const a=Math.min(t,e),l={rid:vL[o],scaleResolutionDownBy:Math.max(1,a/Math.min(s.width,s.height)),maxBitrate:s.encoding.maxBitrate},d=r&&s.encoding.maxFramerate?Math.min(r,s.encoding.maxFramerate):s.encoding.maxFramerate;d&&(l.maxFramerate=d);const h=Lp()||o===0;s.encoding.priority&&h&&(l.priority=s.encoding.priority,l.networkPriority=s.encoding.priority),i.push(l)}),Il()&&vee()==="ios"){let s;i.forEach(a=>{s?a.maxFramerate&&a.maxFramerate>s&&(s=a.maxFramerate):s=a.maxFramerate});let o=!0;i.forEach(a=>{var c;a.maxFramerate!=s&&(o&&(o=!1,kt.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),kt.info('Setting framerate of encoding "'.concat((c=a.rid)!==null&&c!==void 0?c:"",'" to ').concat(s)),a.maxFramerate=s)})}return i}function oq(t){if(t)return t.sort((e,n)=>{const{encoding:r}=e,{encoding:i}=n;return r.maxBitrate>i.maxBitrate?1:r.maxBitrate<i.maxBitrate?-1:r.maxBitrate===i.maxBitrate&&r.maxFramerate&&i.maxFramerate?r.maxFramerate>i.maxFramerate?1:-1:0})}class kee{constructor(e){const n=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!n)throw new Error("invalid scalability mode");if(this.spatial=parseInt(n[1]),this.temporal=parseInt(n[2]),n.length>3)switch(n[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=n[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat((e=this.suffix)!==null&&e!==void 0?e:"")}}function Cwe(t){return t.source===pe.Source.ScreenShare||t.constraints.height&&Of(t.constraints.height)>=1080?"maintain-resolution":"balanced"}const Twe=5e3;class Pv extends WP{get sender(){return this._sender}set sender(e){this._sender=e,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,i=arguments.length>3?arguments[3]:void 0;super(e,pe.Kind.Video,n,r,i),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.isCpuConstrained=!1,this.optimizeForPerformance=!1,this.monitorSender=()=>X(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let s;try{s=yield this.getSenderStats()}catch(c){this.log.error("could not get video sender stats",Object.assign(Object.assign({},this.logContext),{error:c}));return}const o=new Map(s.map(c=>[c.rid,c])),a=s.some(c=>c.qualityLimitationReason==="cpu");if(a!==this.isCpuConstrained&&(this.isCpuConstrained=a,this.isCpuConstrained&&this.emit(Ae.CpuConstrained)),this.prevStats){let c=0;o.forEach((l,d)=>{var h;const m=(h=this.prevStats)===null||h===void 0?void 0:h.get(d);c+=FT(l,m)}),this._currentBitrate=c}this.prevStats=o}),this.senderLock=new ps}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var n;if(this.signalClient=e,!co())return;const r=(n=this.sender)===null||n===void 0?void 0:n.getParameters();r&&(this.encodings=r.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},GP))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(e=>{e.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return X(this,void 0,void 0,function*(){var n,r,i,s,o;yield e.pauseUpstream.call(this);try{for(var a=!0,c=Ou(this.simulcastCodecs.values()),l;l=yield c.next(),n=l.done,!n;a=!0)s=l.value,a=!1,yield(o=s.sender)===null||o===void 0?void 0:o.replaceTrack(null)}catch(d){r={error:d}}finally{try{!a&&!n&&(i=c.return)&&(yield i.call(c))}finally{if(r)throw r.error}}})}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return X(this,void 0,void 0,function*(){var n,r,i,s,o;yield e.resumeUpstream.call(this);try{for(var a=!0,c=Ou(this.simulcastCodecs.values()),l;l=yield c.next(),n=l.done,!n;a=!0){s=l.value,a=!1;const d=s;yield(o=d.sender)===null||o===void 0?void 0:o.replaceTrack(d.mediaStreamTrack)}}catch(d){r={error:d}}finally{try{!a&&!n&&(i=c.return)&&(yield i.call(c))}finally{if(r)throw r.error}}})}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return X(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===pe.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return X(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.source===pe.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{n()}})}setTrackMuted(e){super.setTrackMuted(e);for(const n of this.simulcastCodecs.values())n.mediaStreamTrack.enabled=!e}getSenderStats(){return X(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return[];const n=[],r=yield this.sender.getStats();return r.forEach(i=>{var s;if(i.type==="outbound-rtp"){const o={type:"video",streamId:i.id,frameHeight:i.frameHeight,frameWidth:i.frameWidth,framesPerSecond:i.framesPerSecond,framesSent:i.framesSent,firCount:i.firCount,pliCount:i.pliCount,nackCount:i.nackCount,packetsSent:i.packetsSent,bytesSent:i.bytesSent,qualityLimitationReason:i.qualityLimitationReason,qualityLimitationDurations:i.qualityLimitationDurations,qualityLimitationResolutionChanges:i.qualityLimitationResolutionChanges,rid:(s=i.rid)!==null&&s!==void 0?s:i.id,retransmittedPacketsSent:i.retransmittedPacketsSent,targetBitrate:i.targetBitrate,timestamp:i.timestamp},a=r.get(i.remoteId);a&&(o.jitter=a.jitter,o.packetsLost=a.packetsLost,o.roundTripTime=a.roundTripTime),n.push(o)}}),n.sort((i,s)=>{var o,a;return((o=s.frameWidth)!==null&&o!==void 0?o:0)-((a=i.frameWidth)!==null&&a!==void 0?a:0)}),n})}setPublishingQuality(e){const n=[];for(let r=Xo.LOW;r<=Xo.HIGH;r+=1)n.push(new PP({quality:r,enabled:r<=e}));this.log.debug("setting publishing quality. max quality ".concat(e),this.logContext),this.setPublishingLayers(kc(this.codec),n)}restartTrack(e){return X(this,void 0,void 0,function*(){var n,r,i,s,o;let a;if(e){const h=FP({video:e});typeof h.video!="boolean"&&(a=h.video)}yield this.restart(a),this.isCpuConstrained=!1;try{for(var c=!0,l=Ou(this.simulcastCodecs.values()),d;d=yield l.next(),n=d.done,!n;c=!0){s=d.value,c=!1;const h=s;h.sender&&((o=h.sender.transport)===null||o===void 0?void 0:o.state)!=="closed"&&(h.mediaStreamTrack=this.mediaStreamTrack.clone(),yield h.sender.replaceTrack(h.mediaStreamTrack))}}catch(h){r={error:h}}finally{try{!c&&!n&&(i=l.return)&&(yield i.call(l))}finally{if(r)throw r.error}}})}setProcessor(e){const n=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return X(this,arguments,void 0,function(r){var i=this;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){var o,a,c,l,d,h;if(yield n.setProcessor.call(i,r,s),!((d=i.processor)===null||d===void 0)&&d.processedTrack)try{for(var m=!0,g=Ou(i.simulcastCodecs.values()),y;y=yield g.next(),o=y.done,!o;m=!0)l=y.value,m=!1,yield(h=l.sender)===null||h===void 0?void 0:h.replaceTrack(i.processor.processedTrack)}catch(v){a={error:v}}finally{try{!m&&!o&&(c=g.return)&&(yield c.call(g))}finally{if(a)throw a.error}}})()})}setDegradationPreference(e){return X(this,void 0,void 0,function*(){if(this.degradationPreference=e,this.sender)try{this.log.debug("setting degradationPreference to ".concat(e),this.logContext);const n=this.sender.getParameters();n.degradationPreference=e,this.sender.setParameters(n)}catch(n){this.log.warn("failed to set degradationPreference",Object.assign({error:n},this.logContext))}})}addSimulcastTrack(e,n){if(this.simulcastCodecs.has(e)){this.log.error("".concat(e," already added, skipping adding simulcast codec"),this.logContext);return}const r={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:n};return this.simulcastCodecs.set(e,r),r}setSimulcastTrackSender(e,n){const r=this.simulcastCodecs.get(e);r&&(r.sender=n,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},Twe))}setPublishingCodecs(e){return X(this,void 0,void 0,function*(){var n,r,i,s,o,a,c;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!this.codec&&e.length>0)return yield this.setPublishingLayers(kc(e[0].codec),e[0].qualities),[];this.subscribedCodecs=e;const l=[];try{for(n=!0,r=Ou(e);i=yield r.next(),s=i.done,!s;n=!0){c=i.value,n=!1;const d=c;if(!this.codec||this.codec===d.codec)yield this.setPublishingLayers(kc(d.codec),d.qualities);else{const h=this.simulcastCodecs.get(d.codec);if(this.log.debug("try setPublishingCodec for ".concat(d.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:h})),!h||!h.sender){for(const m of d.qualities)if(m.enabled){l.push(d.codec);break}}else h.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(d.codec),this.logContext),yield aq(h.sender,h.encodings,d.qualities,this.senderLock,kc(d.codec),this.log,this.logContext))}}}catch(d){o={error:d}}finally{try{!n&&!s&&(a=r.return)&&(yield a.call(r))}finally{if(o)throw o.error}}return l})}setPublishingLayers(e,n){return X(this,void 0,void 0,function*(){if(this.optimizeForPerformance){this.log.info("skipping setPublishingLayers due to optimized publishing performance",Object.assign(Object.assign({},this.logContext),{qualities:n}));return}this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:n})),!(!this.sender||!this.encodings)&&(yield aq(this.sender,this.encodings,n,this.senderLock,e,this.log,this.logContext))})}prioritizePerformance(){return X(this,void 0,void 0,function*(){if(!this.sender)throw new Error("sender not found");const e=yield this.senderLock.lock();try{this.optimizeForPerformance=!0;const n=this.sender.getParameters();n.encodings=n.encodings.map((r,i)=>{var s;return Object.assign(Object.assign({},r),{active:i===0,scaleResolutionDownBy:Math.max(1,Math.ceil(((s=this.mediaStreamTrack.getSettings().height)!==null&&s!==void 0?s:360)/360)),scalabilityMode:i===0&&kc(this.codec)?"L1T3":void 0,maxFramerate:i===0?15:0,maxBitrate:i===0?r.maxBitrate:0})}),this.log.debug("setting performance optimised encodings",Object.assign(Object.assign({},this.logContext),{encodings:n.encodings})),this.encodings=n.encodings,yield this.sender.setParameters(n)}catch(n){this.log.error("failed to set performance optimised encodings",Object.assign(Object.assign({},this.logContext),{error:n})),this.optimizeForPerformance=!1}finally{e()}})}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return X(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),mee()&&this.isInBackground&&this.source===pe.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function aq(t,e,n,r,i,s,o){return X(this,void 0,void 0,function*(){const a=yield r.lock();s.debug("setPublishingLayersForSender",Object.assign(Object.assign({},o),{sender:t,qualities:n,senderEncodings:e}));try{const c=t.getParameters(),{encodings:l}=c;if(!l)return;if(l.length!==e.length){s.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},o),{encodings:l,senderEncodings:e}));return}let d=!1;!1&&l[0].scalabilityMode||(i&&n.some(g=>g.enabled)&&n.forEach(g=>g.enabled=!0),l.forEach((m,g)=>{var y;let v=(y=m.rid)!==null&&y!==void 0?y:"";v===""&&(v="q");const E=Iee(v),w=n.find(R=>R.quality===E);w&&m.active!==w.enabled&&(d=!0,m.active=w.enabled,s.debug("setting layer ".concat(w.quality," to ").concat(m.active?"enabled":"disabled"),o),Lp()&&(w.enabled?(m.scaleResolutionDownBy=e[g].scaleResolutionDownBy,m.maxBitrate=e[g].maxBitrate,m.maxFrameRate=e[g].maxFrameRate):(m.scaleResolutionDownBy=4,m.maxBitrate=10,m.maxFrameRate=2)))})),d&&(c.encodings=l,s.debug("setting encodings",Object.assign(Object.assign({},o),{encodings:c.encodings})),yield t.setParameters(c))}finally{a()}})}function Iee(t){switch(t){case"f":return Xo.HIGH;case"h":return Xo.MEDIUM;case"q":return Xo.LOW;default:return Xo.HIGH}}function cq(t,e,n,r){if(!n)return[new Lf({quality:Xo.HIGH,width:t,height:e,bitrate:0,ssrc:0})];if(r){const i=n[0].scalabilityMode,s=new kee(i),o=[],a=s.suffix=="h"?1.5:2,c=s.suffix=="h"?2:3;for(let l=0;l<s.spatial;l+=1)o.push(new Lf({quality:Math.min(Xo.HIGH,s.spatial-1)-l,width:Math.ceil(t/Math.pow(a,l)),height:Math.ceil(e/Math.pow(a,l)),bitrate:n[0].maxBitrate?Math.ceil(n[0].maxBitrate/Math.pow(c,l)):0,ssrc:0}));return o}return n.map(i=>{var s,o,a;const c=(s=i.scaleResolutionDownBy)!==null&&s!==void 0?s:1;let l=Iee((o=i.rid)!==null&&o!==void 0?o:"");return new Lf({quality:l,width:Math.ceil(t/c),height:Math.ceil(e/c),bitrate:(a=i.maxBitrate)!==null&&a!==void 0?a:0,ssrc:0})})}const lq="_lossy",uq="_reliable",Rwe=2*1e3,Px="leave-reconnect",kwe=3e4;var Ra;(function(t){t[t.New=0]="New",t[t.Connected=1]="Connected",t[t.Disconnected=2]="Disconnected",t[t.Reconnecting=3]="Reconnecting",t[t.Closed=4]="Closed"})(Ra||(Ra={}));class Iwe extends jl.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(e){var n;super(),this.options=e,this.rtcConfig={},this.peerConnectionTimeout=VP.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.latestRemoteOfferId=0,this.subscriberPrimary=!1,this.pcState=Ra.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=kt,this.reliableDataSequence=1,this.reliableMessageBuffer=new XH,this.reliableReceivedState=new X2e(kwe),this.midToTrackId={},this.isWaitingForNetworkReconnect=!1,this.handleDataChannel=r=>X(this,[r],void 0,function(i){var s=this;let{channel:o}=i;return(function*(){if(o){if(o.label===uq)s.reliableDCSub=o;else if(o.label===lq)s.lossyDCSub=o;else return;s.log.debug("on data channel ".concat(o.id,", ").concat(o.label),s.logContext),o.onmessage=s.handleDataMessage}})()}),this.handleDataMessage=r=>X(this,void 0,void 0,function*(){var i,s,o,a,c;const l=yield this.dataProcessLock.lock();try{let d;if(r.data instanceof ArrayBuffer)d=r.data;else if(r.data instanceof Blob)d=yield r.data.arrayBuffer();else{this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:r.data}));return}const h=Ls.fromBinary(new Uint8Array(d));if(h.sequence>0&&h.participantSid!==""){const m=this.reliableReceivedState.get(h.participantSid);if(m&&h.sequence<=m)return;this.reliableReceivedState.set(h.participantSid,h.sequence)}if(((i=h.value)===null||i===void 0?void 0:i.case)==="speaker")this.emit(Ne.ActiveSpeakersUpdate,h.value.value.speakers);else if(((s=h.value)===null||s===void 0?void 0:s.case)==="encryptedPacket"){if(!this.e2eeManager){this.log.error("Received encrypted packet but E2EE not set up",this.logContext);return}const m=yield(o=this.e2eeManager)===null||o===void 0?void 0:o.handleEncryptedData(h.value.value.encryptedValue,h.value.value.iv,h.participantIdentity,h.value.value.keyIndex),g=lZ.fromBinary(m.payload),y=new Ls({value:g.value,participantIdentity:h.participantIdentity,participantSid:h.participantSid});((a=y.value)===null||a===void 0?void 0:a.case)==="user"&&dq(y,y.value.value),this.emit(Ne.DataPacketReceived,y,h.value.value.encryptionType)}else((c=h.value)===null||c===void 0?void 0:c.case)==="user"&&dq(h,h.value.value),this.emit(Ne.DataPacketReceived,h,vi.NONE)}finally{l()}}),this.handleDataError=r=>{const s=r.currentTarget.maxRetransmits===0?"lossy":"reliable";if(r instanceof ErrorEvent&&r.error){const{error:o}=r.error;this.log.error("DataChannel error on ".concat(s,": ").concat(r.message),Object.assign(Object.assign({},this.logContext),{error:o}))}else this.log.error("Unknown DataChannel error on ".concat(s),Object.assign(Object.assign({},this.logContext),{event:r}))},this.handleBufferedAmountLow=r=>{const s=r.currentTarget.maxRetransmits===0?$t.LOSSY:$t.RELIABLE;this.updateAndEmitDCBufferStatus(s)},this.handleDisconnect=(r,i)=>{if(this._isClosed)return;this.log.warn("".concat(r," disconnected"),this.logContext),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const s=c=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(c,"ms. giving up"),this.logContext),this.emit(Ne.Disconnected),this.close()},o=Date.now()-this.reconnectStart;let a=this.getNextRetryDelay({elapsedMs:o,retryCount:this.reconnectAttempts});if(a===null){s(o);return}r===Px&&(a=0),this.log.debug("reconnecting in ".concat(a,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=ts.setTimeout(()=>this.attemptReconnect(i).finally(()=>this.reconnectTimeout=void 0),a)},this.waitForRestarted=()=>new Promise((r,i)=>{this.pcState===Ra.Connected&&r();const s=()=>{this.off(Ne.Disconnected,o),r()},o=()=>{this.off(Ne.Restarted,s),i()};this.once(Ne.Restarted,s),this.once(Ne.Disconnected,o)}),this.updateAndEmitDCBufferStatus=r=>{if(r===$t.RELIABLE){const s=this.dataChannelForKind(r);s&&this.reliableMessageBuffer.alignBufferedAmount(s.bufferedAmount)}const i=this.isBufferStatusLow(r);typeof i<"u"&&i!==this.dcBufferStatus.get(r)&&(this.dcBufferStatus.set(r,i),this.emit(Ne.DCBufferStatusChanged,i,r))},this.isBufferStatusLow=r=>{const i=this.dataChannelForKind(r);if(i)return i.bufferedAmount<=i.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>X(this,void 0,void 0,function*(){!this.url||!(yield fetch(Gb(this.url),{method:"HEAD"}).then(i=>i.ok).catch(()=>!1))||(this.log.info("detected network reconnected"),(this.client.currentState===Pn.RECONNECTING||this.isWaitingForNetworkReconnect&&this.client.currentState===Pn.CONNECTED)&&(this.clearReconnectTimeout(),this.attemptReconnect(ip.RR_SIGNAL_DISCONNECTED),this.isWaitingForNetworkReconnect=!1))}),this.handleBrowserOffline=()=>X(this,void 0,void 0,function*(){if(this.url)try{yield Promise.race([fetch(Gb(this.url),{method:"HEAD"}),ns(4e3).then(()=>Promise.reject())])}catch{window.navigator.onLine===!1&&(this.log.info("detected network interruption"),this.isWaitingForNetworkReconnect=!0)}}),this.log=ed((n=e.loggerName)!==null&&n!==void 0?n:Nc.Engine),this.loggerOptions={loggerName:e.loggerName,loggerContextCb:()=>this.logContext},this.client=new $P(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.closingLock=new ps,this.dataProcessLock=new ps,this.dcBufferStatus=new Map([[$t.LOSSY,!0],[$t.RELIABLE,!0]]),this.client.onParticipantUpdate=r=>this.emit(Ne.ParticipantUpdate,r),this.client.onConnectionQuality=r=>this.emit(Ne.ConnectionQualityUpdate,r),this.client.onRoomUpdate=r=>this.emit(Ne.RoomUpdate,r),this.client.onSubscriptionError=r=>this.emit(Ne.SubscriptionError,r),this.client.onSubscriptionPermissionUpdate=r=>this.emit(Ne.SubscriptionPermissionUpdate,r),this.client.onSpeakersChanged=r=>this.emit(Ne.SpeakersChanged,r),this.client.onStreamStateUpdate=r=>this.emit(Ne.StreamStateChanged,r),this.client.onRequestResponse=r=>this.emit(Ne.SignalRequestResponse,r)}get logContext(){var e,n,r,i,s,o;return{room:(n=(e=this.latestJoinResponse)===null||e===void 0?void 0:e.room)===null||n===void 0?void 0:n.name,roomID:(i=(r=this.latestJoinResponse)===null||r===void 0?void 0:r.room)===null||i===void 0?void 0:i.sid,participant:(o=(s=this.latestJoinResponse)===null||s===void 0?void 0:s.participant)===null||o===void 0?void 0:o.identity,pID:this.participantSid}}join(e,n,r,i){return X(this,void 0,void 0,function*(){this.url=e,this.token=n,this.signalOpts=r,this.maxJoinAttempts=r.maxRetries;try{this.joinAttempts+=1,this.setupSignalClientCallbacks();const s=yield this.client.join(e,n,r,i);return this._isClosed=!1,this.latestJoinResponse=s,this.subscriberPrimary=s.subscriberPrimary,this.pcManager||(yield this.configure(s)),(!this.subscriberPrimary||s.fastPublish)&&this.negotiate().catch(o=>{kt.error(o,this.logContext)}),this.registerOnLineListener(),this.clientConfiguration=s.clientConfiguration,this.emit(Ne.SignalConnected,s),s}catch(s){if(s instanceof Bt&&s.reason===wt.ServerUnreachable&&(this.log.warn("Couldn't connect to server, attempt ".concat(this.joinAttempts," of ").concat(this.maxJoinAttempts),this.logContext),this.joinAttempts<this.maxJoinAttempts))return this.join(e,n,r,i);throw s}})}close(){return X(this,void 0,void 0,function*(){const e=yield this.closingLock.lock();if(this.isClosed){e();return}try{this._isClosed=!0,this.joinAttempts=0,this.emit(Ne.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{e()}})}cleanupPeerConnections(){return X(this,void 0,void 0,function*(){var e;yield(e=this.pcManager)===null||e===void 0?void 0:e.close(),this.pcManager=void 0;const n=r=>{r&&(r.close(),r.onbufferedamountlow=null,r.onclose=null,r.onclosing=null,r.onerror=null,r.onmessage=null,r.onopen=null)};n(this.lossyDC),n(this.lossyDCSub),n(this.reliableDC),n(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0,this.reliableMessageBuffer=new XH,this.reliableDataSequence=1,this.reliableReceivedState.clear()})}cleanupClient(){return X(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(e){if(this.pendingTrackResolvers[e.cid])throw new Pu("a track with the same ID has already been published");return new Promise((n,r)=>{const i=setTimeout(()=>{delete this.pendingTrackResolvers[e.cid],r(new Bt("publication of local track timed out, no response from server",wt.Timeout))},1e4);this.pendingTrackResolvers[e.cid]={resolve:s=>{clearTimeout(i),n(s)},reject:()=>{clearTimeout(i),r(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(e)})}removeTrack(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:n}=this.pendingTrackResolvers[e.track.id];n&&n(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(n){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:n}))}return!1}updateMuteStatus(e,n){this.client.sendMuteTrack(e,n)}get dataSubscriberReadyState(){var e;return(e=this.reliableDCSub)===null||e===void 0?void 0:e.readyState}getConnectedServerAddress(){return X(this,void 0,void 0,function*(){var e;return(e=this.pcManager)===null||e===void 0?void 0:e.getConnectedAddress()})}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(e){return X(this,void 0,void 0,function*(){var n,r;if(this.pcManager&&this.pcManager.currentState!==xr.NEW)return;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid;const i=this.makeRTCConfiguration(e);this.pcManager=new swe(i,this.options.singlePeerConnection?"publisher-only":e.subscriberPrimary?"subscriber-primary":"publisher-primary",this.loggerOptions),this.emit(Ne.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(s,o)=>{this.client.sendIceCandidate(s,o)},this.pcManager.onPublisherOffer=(s,o)=>{this.client.sendOffer(s,o)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(s,o,a)=>X(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(s),this.logContext),["closed","disconnected","failed"].includes(o)&&(this.publisherConnectionPromise=void 0),s===xr.CONNECTED){const d=this.pcState===Ra.New;this.pcState=Ra.Connected,d&&this.emit(Ne.Connected,e)}else s===xr.FAILED&&(this.pcState===Ra.Connected||this.pcState===Ra.Reconnecting)&&(this.pcState=Ra.Disconnected,this.handleDisconnect("peerconnection failed",a==="failed"?ip.RR_SUBSCRIBER_FAILED:ip.RR_PUBLISHER_FAILED));const c=this.client.isDisconnected||this.client.currentState===Pn.RECONNECTING,l=[xr.FAILED,xr.CLOSING,xr.CLOSED].includes(s);c&&l&&!this._isClosed&&this.emit(Ne.Offline)}),this.pcManager.onTrack=s=>{s.streams.length!==0&&this.emit(Ne.MediaTrackAdded,s.track,s.streams[0],s.receiver)},xwe((r=e.serverInfo)===null||r===void 0?void 0:r.protocol)||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=(e,n,r)=>X(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,midToTrackId:r})),this.midToTrackId=r,yield this.pcManager.setPublisherAnswer(e,n))}),this.client.onTrickle=(e,n)=>{this.pcManager&&(this.log.debug("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:e,target:n})),this.pcManager.addIceCandidate(e,n))},this.client.onOffer=(e,n,r)=>X(this,void 0,void 0,function*(){if(this.latestRemoteOfferId=n,!this.pcManager)return;this.midToTrackId=r;const i=yield this.pcManager.createSubscriberAnswerFromOffer(e,n);i&&this.client.sendAnswer(i,n)}),this.client.onLocalTrackPublished=e=>{var n;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:e.cid,track:(n=e.track)===null||n===void 0?void 0:n.sid})),!this.pendingTrackResolvers[e.cid]){this.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},this.logContext),{cid:e.cid}));return}const{resolve:r}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],r(e.track)},this.client.onLocalTrackUnpublished=e=>{this.emit(Ne.LocalTrackUnpublished,e)},this.client.onLocalTrackSubscribed=e=>{this.emit(Ne.LocalTrackSubscribed,e)},this.client.onTokenRefresh=e=>{var n;this.token=e,(n=this.regionUrlProvider)===null||n===void 0||n.updateToken(e)},this.client.onRemoteMuteChanged=(e,n)=>{this.emit(Ne.RemoteMute,e,n)},this.client.onSubscribedQualityUpdate=e=>{this.emit(Ne.SubscribedQualityUpdate,e)},this.client.onRoomMoved=e=>{var n;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid,this.latestJoinResponse&&(this.latestJoinResponse.room=e.room),this.emit(Ne.RoomMoved,e)},this.client.onMediaSectionsRequirement=e=>{var n,r;const i={direction:"recvonly"};for(let s=0;s<e.numAudios;s++)(n=this.pcManager)===null||n===void 0||n.addPublisherTransceiverOfKind("audio",i);for(let s=0;s<e.numVideos;s++)(r=this.pcManager)===null||r===void 0||r.addPublisherTransceiverOfKind("video",i);this.negotiate()},this.client.onClose=()=>{this.handleDisconnect("signal",ip.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=e=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:e?.reason})),e.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions({updatedAtInMs:Date.now(),maxAgeInMs:Tee,regionSettings:e.regions})),e.action){case nv.DISCONNECT:this.emit(Ne.Disconnected,e?.reason),this.close();break;case nv.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(Px);break;case nv.RESUME:this.handleDisconnect(Px)}}}makeRTCConfiguration(e){var n;const r=Object.assign({},this.rtcConfig);if(!((n=this.signalOpts)===null||n===void 0)&&n.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),r.encodedInsertableStreams=!0),e.iceServers&&!r.iceServers){const i=[];e.iceServers.forEach(s=>{const o={urls:s.urls};s.username&&(o.username=s.username),s.credential&&(o.credential=s.credential),i.push(o)}),r.iceServers=i}return e.clientConfiguration&&e.clientConfiguration.forceRelay===$b.ENABLED&&(r.iceTransportPolicy="relay"),r.sdpSemantics="unified-plan",r.continualGatheringPolicy="gather_continually",r}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(lq,{ordered:!1,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(uq,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow)}createSender(e,n,r){return X(this,void 0,void 0,function*(){if(uL())return yield this.createTransceiverRTCRtpSender(e,n,r);if(dL())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(e.mediaStreamTrack);throw new di("Required webRTC APIs not supported on this device")})}createSimulcastSender(e,n,r,i){return X(this,void 0,void 0,function*(){if(uL())return this.createSimulcastTransceiverSender(e,n,r,i);if(dL())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(e.mediaStreamTrack);throw new di("Cannot stream on this device")})}createTransceiverRTCRtpSender(e,n,r){return X(this,void 0,void 0,function*(){if(!this.pcManager)throw new di("publisher is closed");const i=[];e.mediaStream&&i.push(e.mediaStream),ah(e)&&(e.codec=n.videoCodec);const s={direction:"sendonly",streams:i};return r&&(s.sendEncodings=r),(yield this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,s)).sender})}createSimulcastTransceiverSender(e,n,r,i){return X(this,void 0,void 0,function*(){if(!this.pcManager)throw new di("publisher is closed");const s={direction:"sendonly"};i&&(s.sendEncodings=i);const o=yield this.pcManager.addPublisherTransceiver(n.mediaStreamTrack,s);if(r.videoCodec)return e.setSimulcastTrackSender(r.videoCodec,o.sender),o.sender})}createRTCRtpSender(e){return X(this,void 0,void 0,function*(){if(!this.pcManager)throw new di("publisher is closed");return this.pcManager.addPublisherTrack(e)})}attemptReconnect(e){return X(this,void 0,void 0,function*(){var n,r,i;if(!this._isClosed){if(this.attemptingReconnect){kt.warn("already attempting reconnect, returning early",this.logContext);return}(((n=this.clientConfiguration)===null||n===void 0?void 0:n.resumeConnection)===$b.DISABLED||((i=(r=this.pcManager)===null||r===void 0?void 0:r.currentState)!==null&&i!==void 0?i:xr.NEW)===xr.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(e),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(s){this.reconnectAttempts+=1;let o=!0;s instanceof di?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:s})),o=!1):s instanceof fg||(this.fullReconnectOnNext=!0),o?this.handleDisconnect("reconnect",ip.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(Ne.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(n){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:n}))}return null}restartConnection(e){return X(this,void 0,void 0,function*(){var n,r,i;try{if(!this.url||!this.token)throw new di("could not reconnect, url or token not saved");this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(Ne.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();let s;try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new fg;s=yield this.join(e??this.url,this.token,this.signalOpts)}catch(o){throw o instanceof Bt&&o.reason===wt.NotAllowed?new di("could not reconnect, token might be expired"):new fg}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(Ne.SignalRestarted,s),yield this.waitForPCReconnected(),this.client.currentState!==Pn.CONNECTED)throw new fg("Signal connection got severed during reconnect");(n=this.regionUrlProvider)===null||n===void 0||n.resetAttempts(),this.emit(Ne.Restarted)}catch(s){const o=yield(r=this.regionUrlProvider)===null||r===void 0?void 0:r.getNextBestRegionUrl();if(o){yield this.restartConnection(o);return}else throw(i=this.regionUrlProvider)===null||i===void 0||i.resetAttempts(),s}})}resumeConnection(e){return X(this,void 0,void 0,function*(){var n;if(!this.url||!this.token)throw new di("could not reconnect, url or token not saved");if(!this.pcManager)throw new di("publisher and subscriber connections unset");this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(Ne.Resuming);let r;try{this.setupSignalClientCallbacks(),r=yield this.client.reconnect(this.url,this.token,this.participantSid,e)}catch(i){let s="";throw i instanceof Error&&(s=i.message,this.log.error(i.message,Object.assign(Object.assign({},this.logContext),{error:i}))),i instanceof Bt&&i.reason===wt.NotAllowed?new di("could not reconnect, token might be expired"):i instanceof Bt&&i.reason===wt.LeaveRequest?i:new fg(s)}if(this.emit(Ne.SignalResumed),r){const i=this.makeRTCConfiguration(r);this.pcManager.updateConfiguration(i),this.latestJoinResponse&&(this.latestJoinResponse.serverInfo=r.serverInfo)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==Pn.CONNECTED)throw new fg("Signal connection got severed during reconnect");this.client.setReconnected(),((n=this.reliableDC)===null||n===void 0?void 0:n.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),r?.lastMessageSeq&&this.resendReliableMessagesForResume(r.lastMessageSeq),this.emit(Ne.Resumed)})}waitForPCInitialConnection(e,n){return X(this,void 0,void 0,function*(){if(!this.pcManager)throw new di("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(n,e)})}waitForPCReconnected(){return X(this,void 0,void 0,function*(){this.pcState=Ra.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield ns(Rwe),!this.pcManager)throw new di("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=Ra.Connected}catch(e){throw this.pcState=Ra.Disconnected,new Bt("could not establish PC connection, ".concat(e.message),wt.InternalError)}})}publishRpcResponse(e,n,r,i){return X(this,void 0,void 0,function*(){const s=new Ls({destinationIdentities:[e],kind:$t.RELIABLE,value:{case:"rpcResponse",value:new AP({requestId:n,value:i?{case:"error",value:i.toProto()}:{case:"payload",value:r??""}})}});yield this.sendDataPacket(s,$t.RELIABLE)})}publishRpcAck(e,n){return X(this,void 0,void 0,function*(){const r=new Ls({destinationIdentities:[e],kind:$t.RELIABLE,value:{case:"rpcAck",value:new xP({requestId:n})}});yield this.sendDataPacket(r,$t.RELIABLE)})}sendDataPacket(e,n){return X(this,void 0,void 0,function*(){if(yield this.ensurePublisherConnected(n),this.e2eeManager&&this.e2eeManager.isDataChannelEncryptionEnabled){const s=XSe(e);if(s){const o=yield this.e2eeManager.encryptData(s.toBinary());e.value={case:"encryptedPacket",value:new cZ({encryptedValue:o.payload,iv:o.iv,keyIndex:o.keyIndex})}}}n===$t.RELIABLE&&(e.sequence=this.reliableDataSequence,this.reliableDataSequence+=1);const r=e.toBinary();yield this.waitForBufferStatusLow(n);const i=this.dataChannelForKind(n);if(i){if(n===$t.RELIABLE&&this.reliableMessageBuffer.push({data:r,sequence:e.sequence}),this.attemptingReconnect)return;i.send(r)}this.updateAndEmitDCBufferStatus(n)})}resendReliableMessagesForResume(e){return X(this,void 0,void 0,function*(){yield this.ensurePublisherConnected($t.RELIABLE);const n=this.dataChannelForKind($t.RELIABLE);n&&(this.reliableMessageBuffer.popToSequence(e),this.reliableMessageBuffer.getAll().forEach(r=>{n.send(r.data)})),this.updateAndEmitDCBufferStatus($t.RELIABLE)})}waitForBufferStatusLow(e){return new Promise((n,r)=>X(this,void 0,void 0,function*(){if(this.isBufferStatusLow(e))n();else{const i=()=>r("Engine closed");for(this.once(Ne.Closing,i);!this.dcBufferStatus.get(e);)yield ns(10);this.off(Ne.Closing,i),n()}}))}ensureDataTransportConnected(e){return X(this,arguments,void 0,function(n){var r=this;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;return(function*(){var s;if(!r.pcManager)throw new di("PC manager is closed");const o=i?r.pcManager.subscriber:r.pcManager.publisher,a=i?"Subscriber":"Publisher";if(!o)throw new Bt("".concat(a," connection not set"),wt.InternalError);let c=!1;!i&&!r.dataChannelForKind(n,i)&&(r.createDataChannels(),c=!0),!c&&!i&&!r.pcManager.publisher.isICEConnected&&r.pcManager.publisher.getICEConnectionState()!=="checking"&&(c=!0),c&&r.negotiate().catch(h=>{kt.error(h,r.logContext)});const l=r.dataChannelForKind(n,i);if(l?.readyState==="open")return;const d=new Date().getTime()+r.peerConnectionTimeout;for(;new Date().getTime()<d;){if(o.isICEConnected&&((s=r.dataChannelForKind(n,i))===null||s===void 0?void 0:s.readyState)==="open")return;yield ns(50)}throw new Bt("could not establish ".concat(a," connection, state: ").concat(o.getICEConnectionState()),wt.InternalError)})()})}ensurePublisherConnected(e){return X(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(e,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!(!this.pcManager||this.pcManager.currentState!==xr.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return X(this,void 0,void 0,function*(){return new Promise((e,n)=>X(this,void 0,void 0,function*(){if(!this.pcManager){n(new cL("PC manager is closed"));return}this.pcManager.requirePublisher(),this.pcManager.publisher.getTransceivers().length==0&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels();const r=new AbortController,i=()=>{r.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),e()};this.isClosed&&n("cannot negotiate on closed engine"),this.on(Ne.Closing,i),this.pcManager.publisher.once(ov.RTPVideoPayloadTypes,s=>{const o=new Map;s.forEach(a=>{const c=a.codec.toLowerCase();S2e(c)&&o.set(a.payload,c)}),this.emit(Ne.RTPVideoMapUpdate,o)});try{yield this.pcManager.negotiate(r),e()}catch(s){s instanceof cL&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",ip.RR_UNKNOWN),n(s)}finally{this.off(Ne.Closing,i)}}))})}dataChannelForKind(e,n){if(n){if(e===$t.LOSSY)return this.lossyDCSub;if(e===$t.RELIABLE)return this.reliableDCSub}else{if(e===$t.LOSSY)return this.lossyDC;if(e===$t.RELIABLE)return this.reliableDC}}sendSyncState(e,n){var r,i,s,o;if(!this.pcManager){this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);return}const a=this.pcManager.publisher.getLocalDescription(),c=this.pcManager.publisher.getRemoteDescription(),l=(r=this.pcManager.subscriber)===null||r===void 0?void 0:r.getRemoteDescription(),d=(i=this.pcManager.subscriber)===null||i===void 0?void 0:i.getLocalDescription(),h=(o=(s=this.signalOpts)===null||s===void 0?void 0:s.autoSubscribe)!==null&&o!==void 0?o:!0,m=new Array,g=new Array;e.forEach(y=>{y.isDesired!==h&&m.push(y.trackSid),y.isEnabled||g.push(y.trackSid)}),this.client.sendSyncState(new DP({answer:this.options.singlePeerConnection?c?Fg({sdp:c.sdp,type:c.type}):void 0:d?Fg({sdp:d.sdp,type:d.type}):void 0,offer:this.options.singlePeerConnection?a?Fg({sdp:a.sdp,type:a.type}):void 0:l?Fg({sdp:l.sdp,type:l.type}):void 0,subscription:new NT({trackSids:m,subscribe:!h,participantTracks:[]}),publishTracks:L2e(n),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:g,datachannelReceiveStates:this.reliableReceivedState.map((y,v)=>new IZ({publisherSid:v,lastSeq:y}))}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const e=[],n=(r,i)=>{r?.id!==void 0&&r.id!==null&&e.push(new xZ({label:r.label,id:r.id,target:i}))};return n(this.dataChannelForKind($t.LOSSY),Rc.PUBLISHER),n(this.dataChannelForKind($t.RELIABLE),Rc.PUBLISHER),n(this.dataChannelForKind($t.LOSSY,!0),Rc.SUBSCRIBER),n(this.dataChannelForKind($t.RELIABLE,!0),Rc.SUBSCRIBER),e}clearReconnectTimeout(){this.reconnectTimeout&&ts.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){co()&&(window.addEventListener("online",this.handleBrowserOnLine),window.addEventListener("offline",this.handleBrowserOffline))}deregisterOnLineListener(){co()&&(window.removeEventListener("online",this.handleBrowserOnLine),window.removeEventListener("offline",this.handleBrowserOffline))}getTrackIdForReceiver(e){var n;const r=(n=this.pcManager)===null||n===void 0?void 0:n.getMidForReceiver(e);if(r){const i=Object.entries(this.midToTrackId).find(s=>{let[o]=s;return o===r});if(i)return i[1]}}}class fg extends Error{}function xwe(t){return t!==void 0&&t>13}function dq(t,e){const n=t.participantIdentity?t.participantIdentity:e.participantIdentity;t.participantIdentity=n,e.participantIdentity=n;const r=t.destinationIdentities.length!==0?t.destinationIdentities:e.destinationIdentities;t.destinationIdentities=r,e.destinationIdentities=r}class xee{get info(){return this._info}validateBytesReceived(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(!(typeof this.totalByteSize!="number"||this.totalByteSize===0)){if(e&&this.bytesReceived<this.totalByteSize)throw new ka("Not enough chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, only received ").concat(this.bytesReceived," bytes"),ks.Incomplete);if(this.bytesReceived>this.totalByteSize)throw new ka("Extra chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, received ").concat(this.bytesReceived," bytes"),ks.LengthExceeded)}}constructor(e,n,r,i){this.reader=n,this.totalByteSize=r,this._info=e,this.bytesReceived=0,this.outOfBandFailureRejectingFuture=i}}class Awe extends xee{handleChunkReceived(e){var n;this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const r=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,r)}[Symbol.asyncIterator](){const e=this.reader.getReader();let n=new Na,r=null,i=null;if(this.signal){const o=this.signal;i=()=>{var a;(a=n.reject)===null||a===void 0||a.call(n,o.reason)},o.addEventListener("abort",i),r=o}const s=()=>{e.releaseLock(),r&&i&&r.removeEventListener("abort",i),this.signal=void 0};return{next:()=>X(this,void 0,void 0,function*(){var o,a;try{const{done:c,value:l}=yield Promise.race([e.read(),n.promise,(a=(o=this.outOfBandFailureRejectingFuture)===null||o===void 0?void 0:o.promise)!==null&&a!==void 0?a:new Promise(()=>{})]);return c?(this.validateBytesReceived(!0),{done:!0,value:void 0}):(this.handleChunkReceived(l),{done:!1,value:l.content})}catch(c){throw s(),c}}),return(){return X(this,void 0,void 0,function*(){return s(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return X(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(function*(){var r,i,s,o;let a=new Set;const c=n.signal?e.withAbortSignal(n.signal):e;try{for(var l=!0,d=Ou(c),h;h=yield d.next(),r=h.done,!r;l=!0){o=h.value,l=!1;const m=o;a.add(m)}}catch(m){i={error:m}}finally{try{!l&&!r&&(s=d.return)&&(yield s.call(d))}finally{if(i)throw i.error}}return Array.from(a)})()})}}class Lwe extends xee{constructor(e,n,r,i){super(e,n,r,i),this.receivedChunks=new Map}handleChunkReceived(e){var n;const r=OE(e.chunkIndex),i=this.receivedChunks.get(r);if(i&&i.version>e.version)return;this.receivedChunks.set(r,e),this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const s=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,s)}[Symbol.asyncIterator](){const e=this.reader.getReader(),n=new TextDecoder("utf-8",{fatal:!0});let r=new Na,i=null,s=null;if(this.signal){const a=this.signal;s=()=>{var c;(c=r.reject)===null||c===void 0||c.call(r,a.reason)},a.addEventListener("abort",s),i=a}const o=()=>{e.releaseLock(),i&&s&&i.removeEventListener("abort",s),this.signal=void 0};return{next:()=>X(this,void 0,void 0,function*(){var a,c;try{const{done:l,value:d}=yield Promise.race([e.read(),r.promise,(c=(a=this.outOfBandFailureRejectingFuture)===null||a===void 0?void 0:a.promise)!==null&&c!==void 0?c:new Promise(()=>{})]);if(l)return this.validateBytesReceived(!0),{done:!0,value:void 0};{this.handleChunkReceived(d);let h;try{h=n.decode(d.content)}catch(m){throw new ka("Cannot decode datastream chunk ".concat(d.chunkIndex," as text: ").concat(m),ks.DecodeFailed)}return{done:!1,value:h}}}catch(l){throw o(),l}}),return(){return X(this,void 0,void 0,function*(){return o(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return X(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(function*(){var r,i,s,o;let a="";const c=n.signal?e.withAbortSignal(n.signal):e;try{for(var l=!0,d=Ou(c),h;h=yield d.next(),r=h.done,!r;l=!0)o=h.value,l=!1,a+=o}catch(m){i={error:m}}finally{try{!l&&!r&&(s=d.return)&&(yield s.call(d))}finally{if(i)throw i.error}}return a})()})}}class Mwe{constructor(){this.log=kt,this.byteStreamControllers=new Map,this.textStreamControllers=new Map,this.byteStreamHandlers=new Map,this.textStreamHandlers=new Map}registerTextStreamHandler(e,n){if(this.textStreamHandlers.has(e))throw new ka('A text stream handler for topic "'.concat(e,'" has already been set.'),ks.HandlerAlreadyRegistered);this.textStreamHandlers.set(e,n)}unregisterTextStreamHandler(e){this.textStreamHandlers.delete(e)}registerByteStreamHandler(e,n){if(this.byteStreamHandlers.has(e))throw new ka('A byte stream handler for topic "'.concat(e,'" has already been set.'),ks.HandlerAlreadyRegistered);this.byteStreamHandlers.set(e,n)}unregisterByteStreamHandler(e){this.byteStreamHandlers.delete(e)}clearControllers(){this.byteStreamControllers.clear(),this.textStreamControllers.clear()}validateParticipantHasNoActiveDataStreams(e){var n,r,i,s;const o=Array.from(this.textStreamControllers.entries()).filter(c=>c[1].sendingParticipantIdentity===e),a=Array.from(this.byteStreamControllers.entries()).filter(c=>c[1].sendingParticipantIdentity===e);if(o.length>0||a.length>0){const c=new ka("Participant ".concat(e," unexpectedly disconnected in the middle of sending data"),ks.AbnormalEnd);for(const[l,d]of a)(r=(n=d.outOfBandFailureRejectingFuture).reject)===null||r===void 0||r.call(n,c),this.byteStreamControllers.delete(l);for(const[l,d]of o)(s=(i=d.outOfBandFailureRejectingFuture).reject)===null||s===void 0||s.call(i,c),this.textStreamControllers.delete(l)}}handleDataStreamPacket(e,n){return X(this,void 0,void 0,function*(){switch(e.value.case){case"streamHeader":return this.handleStreamHeader(e.value.value,e.participantIdentity,n);case"streamChunk":return this.handleStreamChunk(e.value.value,n);case"streamTrailer":return this.handleStreamTrailer(e.value.value,n);default:throw new Error('DataPacket of value "'.concat(e.value.case,'" is not data stream related!'))}})}handleStreamHeader(e,n,r){return X(this,void 0,void 0,function*(){var i;if(e.contentHeader.case==="byteHeader"){const s=this.byteStreamHandlers.get(e.topic);if(!s){this.log.debug("ignoring incoming byte stream due to no handler for topic",e.topic);return}let o;const a=new Na;a.promise.catch(d=>{this.log.error(d)});const c={id:e.streamId,name:(i=e.contentHeader.value.name)!==null&&i!==void 0?i:"unknown",mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:OE(e.timestamp),attributes:e.attributes,encryptionType:r},l=new ReadableStream({start:d=>{if(o=d,this.textStreamControllers.has(e.streamId))throw new ka("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),ks.AlreadyOpened);this.byteStreamControllers.set(e.streamId,{info:c,controller:o,startTime:Date.now(),sendingParticipantIdentity:n,outOfBandFailureRejectingFuture:a})}});s(new Awe(c,l,OE(e.totalLength),a),{identity:n})}else if(e.contentHeader.case==="textHeader"){const s=this.textStreamHandlers.get(e.topic);if(!s){this.log.debug("ignoring incoming text stream due to no handler for topic",e.topic);return}let o;const a=new Na;a.promise.catch(d=>{this.log.error(d)});const c={id:e.streamId,mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Number(e.timestamp),attributes:e.attributes,encryptionType:r},l=new ReadableStream({start:d=>{if(o=d,this.textStreamControllers.has(e.streamId))throw new ka("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),ks.AlreadyOpened);this.textStreamControllers.set(e.streamId,{info:c,controller:o,startTime:Date.now(),sendingParticipantIdentity:n,outOfBandFailureRejectingFuture:a})}});s(new Lwe(c,l,OE(e.totalLength),a),{identity:n})}})}handleStreamChunk(e,n){const r=this.byteStreamControllers.get(e.streamId);r&&(r.info.encryptionType!==n?(r.controller.error(new ka("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(r.info.encryptionType),ks.EncryptionTypeMismatch)),this.byteStreamControllers.delete(e.streamId)):e.content.length>0&&r.controller.enqueue(e));const i=this.textStreamControllers.get(e.streamId);i&&(i.info.encryptionType!==n?(i.controller.error(new ka("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(i.info.encryptionType),ks.EncryptionTypeMismatch)),this.textStreamControllers.delete(e.streamId)):e.content.length>0&&i.controller.enqueue(e))}handleStreamTrailer(e,n){const r=this.textStreamControllers.get(e.streamId);r&&(r.info.encryptionType!==n?r.controller.error(new ka("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(r.info.encryptionType),ks.EncryptionTypeMismatch)):(r.info.attributes=Object.assign(Object.assign({},r.info.attributes),e.attributes),r.controller.close(),this.textStreamControllers.delete(e.streamId)));const i=this.byteStreamControllers.get(e.streamId);i&&(i.info.encryptionType!==n?i.controller.error(new ka("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(i.info.encryptionType),ks.EncryptionTypeMismatch)):(i.info.attributes=Object.assign(Object.assign({},i.info.attributes),e.attributes),i.controller.close()),this.byteStreamControllers.delete(e.streamId))}}class Aee{constructor(e,n,r){this.writableStream=e,this.defaultWriter=e.getWriter(),this.onClose=r,this.info=n}write(e){return this.defaultWriter.write(e)}close(){return X(this,void 0,void 0,function*(){var e;yield this.defaultWriter.close(),this.defaultWriter.releaseLock(),(e=this.onClose)===null||e===void 0||e.call(this)})}}class Owe extends Aee{}class Pwe extends Aee{}const fq=15e3;class Dwe{constructor(e,n){this.engine=e,this.log=n}setupEngine(e){this.engine=e}sendText(e,n){return X(this,void 0,void 0,function*(){var r;const i=crypto.randomUUID(),o=new TextEncoder().encode(e).byteLength,a=(r=n?.attachments)===null||r===void 0?void 0:r.map(()=>crypto.randomUUID()),c=new Array(a?a.length+1:1).fill(0),l=(h,m)=>{var g;c[m]=h;const y=c.reduce((v,E)=>v+E,0);(g=n?.onProgress)===null||g===void 0||g.call(n,y)},d=yield this.streamText({streamId:i,totalSize:o,destinationIdentities:n?.destinationIdentities,topic:n?.topic,attachedStreamIds:a,attributes:n?.attributes});return yield d.write(e),l(1,0),yield d.close(),n?.attachments&&a&&(yield Promise.all(n.attachments.map((h,m)=>X(this,void 0,void 0,function*(){return this._sendFile(a[m],h,{topic:n.topic,mimeType:h.type,onProgress:g=>{l(g,m+1)}})})))),d.info})}streamText(e){return X(this,void 0,void 0,function*(){var n,r,i;const s=(n=e?.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),o={id:s,mimeType:"text/plain",timestamp:Date.now(),topic:(r=e?.topic)!==null&&r!==void 0?r:"",size:e?.totalSize,attributes:e?.attributes,encryptionType:!((i=this.engine.e2eeManager)===null||i===void 0)&&i.isDataChannelEncryptionEnabled?vi.GCM:vi.NONE},a=new HC({streamId:s,mimeType:o.mimeType,topic:o.topic,timestamp:sp(o.timestamp),totalLength:sp(e?.totalSize),attributes:o.attributes,contentHeader:{case:"textHeader",value:new _Z({version:e?.version,attachedStreamIds:e?.attachedStreamIds,replyToStreamId:e?.replyToStreamId,operationType:e?.type==="update"?QA.UPDATE:QA.CREATE})}}),c=e?.destinationIdentities,l=new Ls({destinationIdentities:c,value:{case:"streamHeader",value:a}});yield this.engine.sendDataPacket(l,$t.RELIABLE);let d=0;const h=this.engine,m=new WritableStream({write(v){return X(this,void 0,void 0,function*(){for(const E of k2e(v,fq)){const w=new qC({content:E,streamId:s,chunkIndex:sp(d)}),R=new Ls({destinationIdentities:c,value:{case:"streamChunk",value:w}});yield h.sendDataPacket(R,$t.RELIABLE),d+=1}})},close(){return X(this,void 0,void 0,function*(){const v=new VC({streamId:s}),E=new Ls({destinationIdentities:c,value:{case:"streamTrailer",value:v}});yield h.sendDataPacket(E,$t.RELIABLE)})},abort(v){console.log("Sink error:",v)}});let g=()=>X(this,void 0,void 0,function*(){yield y.close()});h.once(Ne.Closing,g);const y=new Owe(m,o,()=>this.engine.off(Ne.Closing,g));return y})}sendFile(e,n){return X(this,void 0,void 0,function*(){const r=crypto.randomUUID();return yield this._sendFile(r,e,n),{id:r}})}_sendFile(e,n,r){return X(this,void 0,void 0,function*(){var i;const s=yield this.streamBytes({streamId:e,totalSize:n.size,name:n.name,mimeType:(i=r?.mimeType)!==null&&i!==void 0?i:n.type,topic:r?.topic,destinationIdentities:r?.destinationIdentities}),o=n.stream().getReader();for(;;){const{done:a,value:c}=yield o.read();if(a)break;yield s.write(c)}return yield s.close(),s.info})}streamBytes(e){return X(this,void 0,void 0,function*(){var n,r,i,s,o,a;const c=(n=e?.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),l=e?.destinationIdentities,d={id:c,mimeType:(r=e?.mimeType)!==null&&r!==void 0?r:"application/octet-stream",topic:(i=e?.topic)!==null&&i!==void 0?i:"",timestamp:Date.now(),attributes:e?.attributes,size:e?.totalSize,name:(s=e?.name)!==null&&s!==void 0?s:"unknown",encryptionType:!((o=this.engine.e2eeManager)===null||o===void 0)&&o.isDataChannelEncryptionEnabled?vi.GCM:vi.NONE},h=new HC({totalLength:sp((a=d.size)!==null&&a!==void 0?a:0),mimeType:d.mimeType,streamId:c,topic:d.topic,timestamp:sp(Date.now()),attributes:d.attributes,contentHeader:{case:"byteHeader",value:new SZ({name:d.name})}}),m=new Ls({destinationIdentities:l,value:{case:"streamHeader",value:h}});yield this.engine.sendDataPacket(m,$t.RELIABLE);let g=0;const y=new ps,v=this.engine,E=this.log,w=new WritableStream({write(x){return X(this,void 0,void 0,function*(){const C=yield y.lock();let k=0;try{for(;k<x.byteLength;){const T=x.slice(k,k+fq),L=new Ls({destinationIdentities:l,value:{case:"streamChunk",value:new qC({content:T,streamId:c,chunkIndex:sp(g)})}});yield v.sendDataPacket(L,$t.RELIABLE),g+=1,k+=T.byteLength}}finally{C()}})},close(){return X(this,void 0,void 0,function*(){const x=new VC({streamId:c}),C=new Ls({destinationIdentities:l,value:{case:"streamTrailer",value:x}});yield v.sendDataPacket(C,$t.RELIABLE)})},abort(x){E.error("Sink error:",x)}});return new Pwe(w,d)})}}class YP extends pe{constructor(e,n,r,i,s){super(e,r,s),this.sid=n,this.receiver=i}get isLocal(){return!1}setMuted(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?Ae.Muted:Ae.Unmuted,this))}setMediaStream(e){this.mediaStream=e;const n=r=>{r.track===this._mediaStreamTrack&&(e.removeEventListener("removetrack",n),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(Ae.Ended,this))};e.addEventListener("removetrack",n)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return X(this,void 0,void 0,function*(){var e;return!((e=this.receiver)===null||e===void 0)&&e.getStats?yield this.receiver.getStats():void 0})}setPlayoutDelay(e){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=e:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),GP)),M2e()&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const e=()=>{var n;this.timeSyncHandle=requestAnimationFrame(()=>e());const r=(n=this.receiver)===null||n===void 0?void 0:n.getSynchronizationSources()[0];if(r){const{timestamp:i,rtpTimestamp:s}=r;s&&this.rtpTimestamp!==s&&(this.emit(Ae.TimeSyncUpdate,{timestamp:i,rtpTimestamp:s}),this.rtpTimestamp=s)}};e()}}class Lee extends YP{constructor(e,n,r,i,s,o){super(e,n,pe.Kind.Audio,r,o),this.monitorReceiver=()=>X(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const a=yield this.getReceiverStats();a&&this.prevStats&&this.receiver&&(this._currentBitrate=FT(a,this.prevStats)),this.prevStats=a}),this.audioContext=i,this.webAudioPluginNodes=[],s&&(this.sinkId=s.deviceId)}setVolume(e){var n;for(const r of this.attachedElements)this.audioContext?(n=this.gainNode)===null||n===void 0||n.gain.setTargetAtTime(e,0,.1):r.volume=e;Il()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(Il())return 1;let e=0;return this.attachedElements.forEach(n=>{n.volume>e&&(e=n.volume)}),e}setSinkId(e){return X(this,void 0,void 0,function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map(n=>{if(fL(n))return n.setSinkId(e)}))})}attach(e){const n=this.attachedElements.length===0;return e?super.attach(e):e=super.attach(),this.sinkId&&fL(e)&&e.setSinkId(this.sinkId).catch(r=>{this.log.error("Failed to set sink id on remote audio track",r,this.logContext)}),this.audioContext&&n&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}detach(e){let n;return e?(n=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(n=super.detach(),this.disconnectWebAudio()),n}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(e,n){this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(n.srcObject);let r=this.sourceNode;this.webAudioPluginNodes.forEach(i=>{r.connect(i),r=i}),this.gainNode=e.createGain(),r.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),e.state!=="running"&&e.resume().then(()=>{e.state!=="running"&&this.emit(Ae.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(i=>{this.emit(Ae.AudioPlaybackFailed,i)})}disconnectWebAudio(){var e,n;(e=this.gainNode)===null||e===void 0||e.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return X(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n;return e.forEach(r=>{r.type==="inbound-rtp"&&(n={type:"audio",streamId:r.id,timestamp:r.timestamp,jitter:r.jitter,bytesReceived:r.bytesReceived,concealedSamples:r.concealedSamples,concealmentEvents:r.concealmentEvents,silentConcealedSamples:r.silentConcealedSamples,silentConcealmentEvents:r.silentConcealmentEvents,totalAudioEnergy:r.totalAudioEnergy,totalSamplesDuration:r.totalSamplesDuration})}),n})}}const Dx=100;class Nwe extends YP{constructor(e,n,r,i,s){super(e,n,pe.Kind.Video,r,s),this.elementInfos=[],this.monitorReceiver=()=>X(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const o=yield this.getReceiverStats();o&&this.prevStats&&this.receiver&&(this._currentBitrate=FT(o,this.prevStats)),this.prevStats=o}),this.debouncedHandleResize=HP(()=>{this.updateDimensions()},Dx),this.adaptiveStreamSettings=i}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}setStreamState(e){super.setStreamState(e),this.log.debug("setStreamState",e),this.isAdaptiveStream&&e===pe.StreamState.Active&&this.updateVisibility()}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach(n=>{e?iv(this._mediaStreamTrack,n):jg(this._mediaStreamTrack,n)})}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(n=>n.element===e)===void 0){const n=new Uwe(e);this.observeElementInfo(n)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&this.elementInfos.find(n=>n===e)===void 0?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(e){if(!this.isAdaptiveStream){this.log.warn("stopObservingElementInfo ignored",this.logContext);return}const n=this.elementInfos.filter(r=>r===e);for(const r of n)r.stopObserving();this.elementInfos=this.elementInfos.filter(r=>r!==e),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let n=[];if(e)return this.stopObservingElement(e),super.detach(e);n=super.detach();for(const r of n)this.stopObservingElement(r);return n}getDecoderImplementation(){var e;return(e=this.prevStats)===null||e===void 0?void 0:e.decoderImplementation}getReceiverStats(){return X(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n,r="",i=new Map;return e.forEach(s=>{s.type==="inbound-rtp"?(r=s.codecId,n={type:"video",streamId:s.id,framesDecoded:s.framesDecoded,framesDropped:s.framesDropped,framesReceived:s.framesReceived,packetsReceived:s.packetsReceived,packetsLost:s.packetsLost,frameWidth:s.frameWidth,frameHeight:s.frameHeight,pliCount:s.pliCount,firCount:s.firCount,nackCount:s.nackCount,jitter:s.jitter,timestamp:s.timestamp,bytesReceived:s.bytesReceived,decoderImplementation:s.decoderImplementation}):s.type==="codec"&&i.set(s.id,s)}),n&&r!==""&&i.get(r)&&(n.mimeType=i.get(r).mimeType),n})}stopObservingElement(e){const n=this.elementInfos.filter(r=>r.element===e);for(const r of n)this.stopObservingElementInfo(r)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return X(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(e){var n,r;const i=this.elementInfos.reduce((c,l)=>Math.max(c,l.visibilityChangedAt||0),0),s=!((r=(n=this.adaptiveStreamSettings)===null||n===void 0?void 0:n.pauseVideoInBackground)!==null&&r!==void 0)||r?this.isInBackground:!1,o=this.elementInfos.some(c=>c.pictureInPicture),a=this.elementInfos.some(c=>c.visible)&&!s||o;if(!(this.lastVisible===a&&!e)){if(!a&&Date.now()-i<Dx){ts.setTimeout(()=>{this.updateVisibility()},Dx);return}this.lastVisible=a,this.emit(Ae.VisibilityChanged,a,this)}}updateDimensions(){var e,n;let r=0,i=0;const s=this.getPixelDensity();for(const o of this.elementInfos){const a=o.width()*s,c=o.height()*s;a+c>r+i&&(r=a,i=c)}((e=this.lastDimensions)===null||e===void 0?void 0:e.width)===r&&((n=this.lastDimensions)===null||n===void 0?void 0:n.height)===i||(this.lastDimensions={width:r,height:i},this.emit(Ae.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const n=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pixelDensity;return n==="screen"?HH():n||(HH()>2?2:1)}}class Uwe{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,n){this.onVisibilityChanged=r=>{var i;const{target:s,isIntersecting:o}=r;s===this.element&&(this.isIntersecting=o,this.isPiP=e1(this.element),this.visibilityChangedAt=Date.now(),(i=this.handleVisibilityChanged)===null||i===void 0||i.call(this))},this.onEnterPiP=()=>{var r,i,s;(i=(r=window.documentPictureInPicture)===null||r===void 0?void 0:r.window)===null||i===void 0||i.addEventListener("pagehide",this.onLeavePiP),this.isPiP=e1(this.element),(s=this.handleVisibilityChanged)===null||s===void 0||s.call(this)},this.onLeavePiP=()=>{var r;this.isPiP=e1(this.element),(r=this.handleVisibilityChanged)===null||r===void 0||r.call(this)},this.element=e,this.isIntersecting=n??bL(e),this.isPiP=co()&&e1(e),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var e,n,r;this.isIntersecting=bL(this.element),this.isPiP=e1(this.element),this.element.handleResize=()=>{var i;(i=this.handleResize)===null||i===void 0||i.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,VH().observe(this.element),qH().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),(e=window.documentPictureInPicture)===null||e===void 0||e.addEventListener("enter",this.onEnterPiP),(r=(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window)===null||r===void 0||r.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var e,n,r,i,s;(e=VH())===null||e===void 0||e.unobserve(this.element),(n=qH())===null||n===void 0||n.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),(r=window.documentPictureInPicture)===null||r===void 0||r.removeEventListener("enter",this.onEnterPiP),(s=(i=window.documentPictureInPicture)===null||i===void 0?void 0:i.window)===null||s===void 0||s.removeEventListener("pagehide",this.onLeavePiP)}}function e1(t){var e,n;return document.pictureInPictureElement===t?!0:!((e=window.documentPictureInPicture)===null||e===void 0)&&e.window?bL(t,(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window):!1}function bL(t,e){const n=e||window;let r=t.offsetTop,i=t.offsetLeft;const s=t.offsetWidth,o=t.offsetHeight,{hidden:a}=t,{display:c}=getComputedStyle(t);for(;t.offsetParent;)t=t.offsetParent,r+=t.offsetTop,i+=t.offsetLeft;return r<n.pageYOffset+n.innerHeight&&i<n.pageXOffset+n.innerWidth&&r+o>n.pageYOffset&&i+s>n.pageXOffset&&!a&&c!=="none"}class Tu extends jl.EventEmitter{constructor(e,n,r,i){var s;super(),this.metadataMuted=!1,this.encryption=vi.NONE,this.log=kt,this.handleMuted=()=>{this.emit(Ae.Muted)},this.handleUnmuted=()=>{this.emit(Ae.Unmuted)},this.log=ed((s=i?.loggerName)!==null&&s!==void 0?s:Nc.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=e,this.trackSid=n,this.trackName=r,this.source=pe.Source.Unknown}setTrack(e){this.track&&(this.track.off(Ae.Muted,this.handleMuted),this.track.off(Ae.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on(Ae.Muted,this.handleMuted),e.on(Ae.Unmuted,this.handleUnmuted))}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),Ft(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get isEncrypted(){return this.encryption!==vi.NONE}get audioTrack(){if(Cl(this.track))return this.track}get videoTrack(){if(ah(this.track))return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=pe.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===pe.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}(function(t){(function(e){e.Desired="desired",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed"})(t.SubscriptionStatus||(t.SubscriptionStatus={})),(function(e){e.Allowed="allowed",e.NotAllowed="not_allowed"})(t.PermissionStatus||(t.PermissionStatus={}))})(Tu||(Tu={}));class _L extends Tu{get isUpstreamPaused(){var e;return(e=this.track)===null||e===void 0?void 0:e.isUpstreamPaused}constructor(e,n,r,i){super(e,n.sid,n.name,i),this.track=void 0,this.handleTrackEnded=()=>{this.emit(Ae.Ended)},this.handleCpuConstrained=()=>{this.track&&ah(this.track)&&this.emit(Ae.CpuConstrained,this.track)},this.updateInfo(n),this.setTrack(r)}setTrack(e){this.track&&(this.track.off(Ae.Ended,this.handleTrackEnded),this.track.off(Ae.CpuConstrained,this.handleCpuConstrained)),super.setTrack(e),e&&(e.on(Ae.Ended,this.handleTrackEnded),e.on(Ae.CpuConstrained,this.handleCpuConstrained))}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}get isLocal(){return!0}mute(){return X(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.mute()})}unmute(){return X(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.unmute()})}pauseUpstream(){return X(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.pauseUpstream()})}resumeUpstream(){return X(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.resumeUpstream()})}getTrackFeatures(){var e;if(Cl(this.track)){const n=this.track.getSourceTrackSettings(),r=new Set;return n.autoGainControl&&r.add(Di.TF_AUTO_GAIN_CONTROL),n.echoCancellation&&r.add(Di.TF_ECHO_CANCELLATION),n.noiseSuppression&&r.add(Di.TF_NOISE_SUPPRESSION),n.channelCount&&n.channelCount>1&&r.add(Di.TF_STEREO),!((e=this.options)===null||e===void 0)&&e.dtx||r.add(Di.TF_NO_DTX),this.track.enhancedNoiseCancellation&&r.add(Di.TF_ENHANCED_NOISE_CANCELLATION),Array.from(r.values())}else return[]}}function j_(t,e){return X(this,void 0,void 0,function*(){t??(t={});let n=!1;const{audioProcessor:r,videoProcessor:i,optionsWithoutProcessor:s}=See(t);let o=s.audio,a=s.video;if(r&&typeof s.audio=="object"&&(s.audio.processor=r),i&&typeof s.video=="object"&&(s.video.processor=i),t.audio&&typeof s.audio=="object"&&typeof s.audio.deviceId=="string"){const h=s.audio.deviceId;s.audio.deviceId={exact:h},n=!0,o=Object.assign(Object.assign({},s.audio),{deviceId:{ideal:h}})}if(s.video&&typeof s.video=="object"&&typeof s.video.deviceId=="string"){const h=s.video.deviceId;s.video.deviceId={exact:h},n=!0,a=Object.assign(Object.assign({},s.video),{deviceId:{ideal:h}})}s.audio===!0?s.audio={deviceId:"default"}:typeof s.audio=="object"&&s.audio!==null&&(s.audio=Object.assign(Object.assign({},s.audio),{deviceId:s.audio.deviceId||"default"})),s.video===!0?s.video={deviceId:"default"}:typeof s.video=="object"&&!s.video.deviceId&&(s.video.deviceId="default");const c=yee(s,Eee,Cee),l=FP(c),d=navigator.mediaDevices.getUserMedia(l);s.audio&&(Ni.userMediaPromiseMap.set("audioinput",d),d.catch(()=>Ni.userMediaPromiseMap.delete("audioinput"))),s.video&&(Ni.userMediaPromiseMap.set("videoinput",d),d.catch(()=>Ni.userMediaPromiseMap.delete("videoinput")));try{const h=yield d;return yield Promise.all(h.getTracks().map(m=>X(this,void 0,void 0,function*(){const g=m.kind==="audio";let y=g?c.audio:c.video;(typeof y=="boolean"||!y)&&(y={});let v;const E=g?l.audio:l.video;typeof E!="boolean"&&(v=E);const w=m.getSettings().deviceId;v?.deviceId&&Of(v.deviceId)!==w?v.deviceId=w:v||(v={deviceId:w});const R=pwe(m,v,e);return R.kind===pe.Kind.Video?R.source=pe.Source.Camera:R.kind===pe.Kind.Audio&&(R.source=pe.Source.Microphone),R.mediaStream=h,Cl(R)&&r?yield R.setProcessor(r):ah(R)&&i&&(yield R.setProcessor(i)),R})))}catch(h){if(!n)throw h;return j_(Object.assign(Object.assign({},t),{audio:o,video:a}),e)}})}function jwe(t){return X(this,void 0,void 0,function*(){return(yield j_({audio:!1,video:!0}))[0]})}function Fwe(t){return X(this,void 0,void 0,function*(){return(yield j_({audio:!0,video:!1}))[0]})}var gf;(function(t){t.Excellent="excellent",t.Good="good",t.Poor="poor",t.Lost="lost",t.Unknown="unknown"})(gf||(gf={}));function $we(t){switch(t){case x1.EXCELLENT:return gf.Excellent;case x1.GOOD:return gf.Good;case x1.POOR:return gf.Poor;case x1.LOST:return gf.Lost;default:return gf.Unknown}}class Mee extends jl.EventEmitter{get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions)===null||e===void 0?void 0:e.loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(e=>e.isEncrypted)}get isAgent(){var e;return((e=this.permissions)===null||e===void 0?void 0:e.agent)||this.kind===Bb.AGENT}get isActive(){var e;return((e=this.participantInfo)===null||e===void 0?void 0:e.state)===tv.ACTIVE}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(e,n,r,i,s,o){let a=arguments.length>6&&arguments[6]!==void 0?arguments[6]:Bb.STANDARD;var c;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=gf.Unknown,this.log=kt,this.log=ed((c=o?.loggerName)!==null&&c!==void 0?c:Nc.Participant),this.loggerOptions=o,this.setMaxListeners(100),this.sid=e,this.identity=n,this.name=r,this.metadata=i,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=a,this._attributes=s??{}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(e){for(const[,n]of this.trackPublications)if(n.source===e)return n}getTrackPublicationByName(e){for(const[,n]of this.trackPublications)if(n.trackName===e)return n}waitUntilActive(){return this.isActive?Promise.resolve():this.activeFuture?this.activeFuture.promise:(this.activeFuture=new Na,this.once(ae.Active,()=>{var e,n;(n=(e=this.activeFuture)===null||e===void 0?void 0:e.resolve)===null||n===void 0||n.call(e),this.activeFuture=void 0}),this.activeFuture.promise)}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const n=this.getTrackPublication(pe.Source.Camera);return!(!((e=n?.isMuted)!==null&&e!==void 0)||e)}get isMicrophoneEnabled(){var e;const n=this.getTrackPublication(pe.Source.Microphone);return!(!((e=n?.isMuted)!==null&&e!==void 0)||e)}get isScreenShareEnabled(){return!!this.getTrackPublication(pe.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}updateInfo(e){var n;return this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version?!1:(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),this._setAttributes(e.attributes),e.state===tv.ACTIVE&&((n=this.participantInfo)===null||n===void 0?void 0:n.state)!==tv.ACTIVE&&this.emit(ae.Active),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,!0)}_setMetadata(e){const n=this.metadata!==e,r=this.metadata;this.metadata=e,n&&this.emit(ae.ParticipantMetadataChanged,r)}_setName(e){const n=this.name!==e;this.name=e,n&&this.emit(ae.ParticipantNameChanged,e)}_setAttributes(e){const n=O2e(this.attributes,e);this._attributes=e,Object.keys(n).length>0&&this.emit(ae.AttributesChanged,n)}setPermissions(e){var n,r,i,s,o,a;const c=this.permissions,l=e.canPublish!==((n=this.permissions)===null||n===void 0?void 0:n.canPublish)||e.canSubscribe!==((r=this.permissions)===null||r===void 0?void 0:r.canSubscribe)||e.canPublishData!==((i=this.permissions)===null||i===void 0?void 0:i.canPublishData)||e.hidden!==((s=this.permissions)===null||s===void 0?void 0:s.hidden)||e.recorder!==((o=this.permissions)===null||o===void 0?void 0:o.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some((d,h)=>{var m;return d!==((m=this.permissions)===null||m===void 0?void 0:m.canPublishSources[h])})||e.canSubscribeMetrics!==((a=this.permissions)===null||a===void 0?void 0:a.canSubscribeMetrics);return this.permissions=e,l&&this.emit(ae.ParticipantPermissionsChanged,c),l}setIsSpeaking(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit(ae.IsSpeakingChanged,e))}setConnectionQuality(e){const n=this._connectionQuality;this._connectionQuality=$we(e),n!==this._connectionQuality&&this.emit(ae.ConnectionQualityChanged,this._connectionQuality)}setDisconnected(){var e,n;this.activeFuture&&((n=(e=this.activeFuture).reject)===null||n===void 0||n.call(e,new Error("Participant disconnected")),this.activeFuture=void 0)}setAudioContext(e){this.audioContext=e,this.audioTrackPublications.forEach(n=>Cl(n.track)&&n.track.setAudioContext(e))}addTrackPublication(e){e.on(Ae.Muted,()=>{this.emit(ae.TrackMuted,e)}),e.on(Ae.Unmuted,()=>{this.emit(ae.TrackUnmuted,e)});const n=e;switch(n.track&&(n.track.sid=e.trackSid),this.trackPublications.set(e.trackSid,e),e.kind){case pe.Kind.Audio:this.audioTrackPublications.set(e.trackSid,e);break;case pe.Kind.Video:this.videoTrackPublications.set(e.trackSid,e);break}}}function Bwe(t){var e,n,r;if(!t.participantSid&&!t.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new RZ({participantIdentity:(e=t.participantIdentity)!==null&&e!==void 0?e:"",participantSid:(n=t.participantSid)!==null&&n!==void 0?n:"",allTracks:(r=t.allowAll)!==null&&r!==void 0?r:!1,trackSids:t.allowedTrackSids||[]})}class Hwe extends Mee{constructor(e,n,r,i,s,o){super(e,n,void 0,void 0,void 0,{loggerName:i.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=vi.NONE,this.enabledPublishVideoCodecs=[],this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new Na)},this.handleReconnected=()=>{var a,c;(c=(a=this.reconnectFuture)===null||a===void 0?void 0:a.resolve)===null||c===void 0||c.call(a),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleClosing=()=>{var a,c,l,d,h,m;this.reconnectFuture&&(this.reconnectFuture.promise.catch(g=>this.log.warn(g.message,this.logContext)),(c=(a=this.reconnectFuture)===null||a===void 0?void 0:a.reject)===null||c===void 0||c.call(a,new Error("Got disconnected during reconnection attempt")),this.reconnectFuture=void 0),this.signalConnectedFuture&&((d=(l=this.signalConnectedFuture).reject)===null||d===void 0||d.call(l,new Error("Got disconnected without signal connected")),this.signalConnectedFuture=void 0),(m=(h=this.activeAgentFuture)===null||h===void 0?void 0:h.reject)===null||m===void 0||m.call(h,new Error("Got disconnected without active agent present")),this.activeAgentFuture=void 0,this.firstActiveAgent=void 0},this.handleSignalConnected=a=>{var c,l;a.participant&&this.updateInfo(a.participant),this.signalConnectedFuture||(this.signalConnectedFuture=new Na),(l=(c=this.signalConnectedFuture).resolve)===null||l===void 0||l.call(c)},this.handleSignalRequestResponse=a=>{const{requestId:c,reason:l,message:d}=a,h=this.pendingSignalRequests.get(c);h&&(l!==NP.OK&&h.reject(new UH(d,l)),this.pendingSignalRequests.delete(c))},this.handleDataPacket=a=>{switch(a.value.case){case"rpcResponse":let c=a.value.value,l=null,d=null;c.value.case==="payload"?l=c.value.value:c.value.case==="error"&&(d=Or.fromProto(c.value.value)),this.handleIncomingRpcResponse(c.requestId,l,d);break;case"rpcAck":let h=a.value.value;this.handleIncomingRpcAck(h.requestId);break}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(a=>Bwe(a)))},this.onTrackUnmuted=a=>{this.onTrackMuted(a,a.isUpstreamPaused)},this.onTrackMuted=(a,c)=>{if(c===void 0&&(c=!0),!a.sid){this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),Ft(a)));return}this.engine.updateMuteStatus(a.sid,c)},this.onTrackUpstreamPaused=a=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),Ft(a))),this.onTrackMuted(a,!0)},this.onTrackUpstreamResumed=a=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),Ft(a))),this.onTrackMuted(a,a.isMuted)},this.onTrackFeatureUpdate=a=>{const c=this.audioTrackPublications.get(a.sid);if(!c){this.log.warn("Could not update local audio track settings, missing publication for track ".concat(a.sid),this.logContext);return}this.engine.client.sendUpdateLocalAudioTrack(c.trackSid,c.getTrackFeatures())},this.onTrackCpuConstrained=(a,c)=>{this.log.debug("track cpu constrained",Object.assign(Object.assign({},this.logContext),Ft(c))),this.emit(ae.LocalTrackCpuConstrained,a,c)},this.handleSubscribedQualityUpdate=a=>X(this,void 0,void 0,function*(){var c,l,d,h,m;if(!(!((m=this.roomOptions)===null||m===void 0)&&m.dynacast))return;const g=this.videoTrackPublications.get(a.trackSid);if(!g){this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:a.trackSid}));return}if(!g.videoTrack)return;const y=yield g.videoTrack.setPublishingCodecs(a.subscribedCodecs);try{for(var v=!0,E=Ou(y),w;w=yield E.next(),c=w.done,!c;v=!0){h=w.value,v=!1;const R=h;l2e(R)&&(this.log.debug("publish ".concat(R," for ").concat(g.videoTrack.sid),Object.assign(Object.assign({},this.logContext),Ft(g))),yield this.publishAdditionalCodecForTrack(g.videoTrack,R,g.options))}}catch(R){l={error:R}}finally{try{!v&&!c&&(d=E.return)&&(yield d.call(E))}finally{if(l)throw l.error}}}),this.handleLocalTrackUnpublished=a=>{const c=this.trackPublications.get(a.trackSid);if(!c){this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:a.trackSid}));return}this.unpublishTrack(c.track)},this.handleTrackEnded=a=>X(this,void 0,void 0,function*(){if(a.source===pe.Source.ScreenShare||a.source===pe.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),Ft(a))),this.unpublishTrack(a);else if(a.isUserProvided)yield a.mute();else if(mu(a)||Jd(a))try{if(co())try{const c=yield navigator?.permissions.query({name:a.source===pe.Source.Camera?"camera":"microphone"});if(c&&c.state==="denied")throw this.log.warn("user has revoked access to ".concat(a.source),Object.assign(Object.assign({},this.logContext),Ft(a))),c.onchange=()=>{c.state!=="denied"&&(a.isMuted||a.restartTrack(),c.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}a.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),Ft(a))),mu(a)?yield a.restartTrack({deviceId:"default"}):yield a.restartTrack())}catch{this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),Ft(a))),yield a.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=r,this.roomOptions=i,this.setupEngine(r),this.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),this.pendingSignalRequests=new Map,this.rpcHandlers=s,this.roomOutgoingDataStreamManager=o}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==vi.NONE}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setupEngine(e){var n;this.engine=e,this.engine.on(Ne.RemoteMute,(r,i)=>{const s=this.trackPublications.get(r);!s||!s.track||(i?s.mute():s.unmute())}),!((n=this.signalConnectedFuture)===null||n===void 0)&&n.isResolved&&(this.signalConnectedFuture=void 0),this.engine.on(Ne.Connected,this.handleReconnected).on(Ne.SignalConnected,this.handleSignalConnected).on(Ne.SignalRestarted,this.handleReconnected).on(Ne.SignalResumed,this.handleReconnected).on(Ne.Restarting,this.handleReconnecting).on(Ne.Resuming,this.handleReconnecting).on(Ne.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(Ne.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(Ne.Closing,this.handleClosing).on(Ne.SignalRequestResponse,this.handleSignalRequestResponse).on(Ne.DataPacketReceived,this.handleDataPacket)}setMetadata(e){return X(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:e})})}setName(e){return X(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:e})})}setAttributes(e){return X(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:e})})}requestMetadataUpdate(e){return X(this,arguments,void 0,function(n){var r=this;let{metadata:i,name:s,attributes:o}=n;return(function*(){return new Promise((a,c)=>X(r,void 0,void 0,function*(){var l,d;try{let h=!1;const m=yield this.engine.client.sendUpdateLocalMetadata((l=i??this.metadata)!==null&&l!==void 0?l:"",(d=s??this.name)!==null&&d!==void 0?d:"",o),g=performance.now();for(this.pendingSignalRequests.set(m,{resolve:a,reject:y=>{c(y),h=!0},values:{name:s,metadata:i,attributes:o}});performance.now()-g<5e3&&!h;){if((!s||this.name===s)&&(!i||this.metadata===i)&&(!o||Object.entries(o).every(y=>{let[v,E]=y;return this.attributes[v]===E||E===""&&!this.attributes[v]}))){this.pendingSignalRequests.delete(m),a();return}yield ns(50)}c(new UH("Request to update local metadata timed out","TimeoutError"))}catch(h){h instanceof Error&&c(h)}}))})()})}setCameraEnabled(e,n,r){return this.setTrackEnabled(pe.Source.Camera,e,n,r)}setMicrophoneEnabled(e,n,r){return this.setTrackEnabled(pe.Source.Microphone,e,n,r)}setScreenShareEnabled(e,n,r){return this.setTrackEnabled(pe.Source.ScreenShare,e,n,r)}setE2EEEnabled(e){return X(this,void 0,void 0,function*(){this.encryptionType=e?vi.GCM:vi.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(e,n,r,i){return X(this,void 0,void 0,function*(){var s,o;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:e,enabled:n})),this.republishPromise&&(yield this.republishPromise);let a=this.getTrackPublication(e);if(n)if(a)yield a.unmute();else{let c;if(this.pendingPublishing.has(e)){const l=yield this.waitForPendingPublicationOfSource(e);return l||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e})),yield l?.unmute(),l}this.pendingPublishing.add(e);try{switch(e){case pe.Source.Camera:c=yield this.createTracks({video:(s=r)!==null&&s!==void 0?s:!0});break;case pe.Source.Microphone:c=yield this.createTracks({audio:(o=r)!==null&&o!==void 0?o:!0});break;case pe.Source.ScreenShare:c=yield this.createScreenTracks(Object.assign({},r));break;default:throw new Pu(e)}}catch(l){throw c?.forEach(d=>{d.stop()}),l instanceof Error&&this.emit(ae.MediaDevicesError,l,mL(e)),this.pendingPublishing.delete(e),l}for(const l of c){const d=Object.assign(Object.assign({},this.roomOptions.publishDefaults),r);e===pe.Source.Microphone&&Cl(l)&&d.preConnectBuffer&&(this.log.info("starting preconnect buffer for microphone",Object.assign({},this.logContext)),l.startPreConnectBuffer())}try{const l=[];for(const h of c)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),Ft(h))),l.push(this.publishTrack(h,i));[a]=yield Promise.all(l)}catch(l){throw c?.forEach(d=>{d.stop()}),l}finally{this.pendingPublishing.delete(e)}}else if(!a?.track&&this.pendingPublishing.has(e)&&(a=yield this.waitForPendingPublicationOfSource(e),a||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e}))),a&&a.track)if(e===pe.Source.ScreenShare){a=yield this.unpublishTrack(a.track);const c=this.getTrackPublication(pe.Source.ScreenShareAudio);c&&c.track&&this.unpublishTrack(c.track)}else yield a.mute();return a})}enableCameraAndMicrophone(){return X(this,void 0,void 0,function*(){if(!(this.pendingPublishing.has(pe.Source.Camera)||this.pendingPublishing.has(pe.Source.Microphone))){this.pendingPublishing.add(pe.Source.Camera),this.pendingPublishing.add(pe.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map(n=>this.publishTrack(n)))}finally{this.pendingPublishing.delete(pe.Source.Camera),this.pendingPublishing.delete(pe.Source.Microphone)}}})}createTracks(e){return X(this,void 0,void 0,function*(){var n,r;e??(e={});const i=yee(e,(n=this.roomOptions)===null||n===void 0?void 0:n.audioCaptureDefaults,(r=this.roomOptions)===null||r===void 0?void 0:r.videoCaptureDefaults);try{return(yield j_(i,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext})).map(a=>(Cl(a)&&(this.microphoneError=void 0,a.setAudioContext(this.audioContext),a.source=pe.Source.Microphone,this.emit(ae.AudioStreamAcquired)),ah(a)&&(this.cameraError=void 0,a.source=pe.Source.Camera),a))}catch(s){throw s instanceof Error&&(e.audio&&(this.microphoneError=s),e.video&&(this.cameraError=s)),s}})}createScreenTracks(e){return X(this,void 0,void 0,function*(){if(e===void 0&&(e={}),navigator.mediaDevices.getDisplayMedia===void 0)throw new jP("getDisplayMedia not supported");e.resolution===void 0&&!m2e()&&(e.resolution=jT.h1080fps30.resolution);const n=A2e(e),r=yield navigator.mediaDevices.getDisplayMedia(n),i=r.getVideoTracks();if(i.length===0)throw new Pu("no video track found");const s=new Pv(i[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});s.source=pe.Source.ScreenShare,e.contentHint&&(s.mediaStreamTrack.contentHint=e.contentHint);const o=[s];if(r.getAudioTracks().length>0){this.emit(ae.AudioStreamAcquired);const a=new zC(r.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});a.source=pe.Source.ScreenShareAudio,o.push(a)}return o})}publishTrack(e,n){return X(this,void 0,void 0,function*(){return this.publishOrRepublishTrack(e,n)})}publishOrRepublishTrack(e,n){return X(this,arguments,void 0,function(r,i){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return(function*(){var a,c,l,d;mu(r)&&r.setAudioContext(s.audioContext),yield(a=s.reconnectFuture)===null||a===void 0?void 0:a.promise,s.republishPromise&&!o&&(yield s.republishPromise),yp(r)&&s.pendingPublishPromises.has(r)&&(yield s.pendingPublishPromises.get(r));let h;if(r instanceof MediaStreamTrack)h=r.getConstraints();else{h=r.constraints;let w;switch(r.source){case pe.Source.Microphone:w="audioinput";break;case pe.Source.Camera:w="videoinput"}w&&s.activeDeviceMap.has(w)&&(h=Object.assign(Object.assign({},h),{deviceId:s.activeDeviceMap.get(w)}))}if(r instanceof MediaStreamTrack)switch(r.kind){case"audio":r=new zC(r,h,!0,s.audioContext,{loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});break;case"video":r=new Pv(r,h,!0,{loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});break;default:throw new Pu("unsupported MediaStreamTrack kind ".concat(r.kind))}else r.updateLoggerOptions({loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});let m;if(s.trackPublications.forEach(w=>{w.track&&w.track===r&&(m=w)}),m)return s.log.warn("track has already been published, skipping",Object.assign(Object.assign({},s.logContext),Ft(m))),m;const g=Object.assign(Object.assign({},s.roomOptions.publishDefaults),i),y="channelCount"in r.mediaStreamTrack.getSettings()&&r.mediaStreamTrack.getSettings().channelCount===2||r.mediaStreamTrack.getConstraints().channelCount===2,v=(c=g.forceStereo)!==null&&c!==void 0?c:y;v&&(g.dtx===void 0&&s.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},s.logContext),Ft(r))),g.red===void 0&&s.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(l=g.dtx)!==null&&l!==void 0||(g.dtx=!1),(d=g.red)!==null&&d!==void 0||(g.red=!1)),!v2e()&&s.roomOptions.e2ee&&(s.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},s.logContext)),g.simulcast=!1),g.source&&(r.source=g.source);const E=new Promise((w,R)=>X(s,void 0,void 0,function*(){try{if(this.engine.client.currentState!==Pn.CONNECTED){this.log.debug("deferring track publication until signal is connected",Object.assign(Object.assign({},this.logContext),{track:Ft(r)}));let x=!1;const C=setTimeout(()=>{x=!0,r.stop(),R(new NH("publishing rejected as engine not connected within timeout",408))},15e3);if(yield this.waitUntilEngineConnected(),clearTimeout(C),x)return;const k=yield this.publish(r,g,v);w(k)}else try{const x=yield this.publish(r,g,v);w(x)}catch(x){R(x)}}catch(x){R(x)}}));s.pendingPublishPromises.set(r,E);try{return yield E}catch(w){throw w}finally{s.pendingPublishPromises.delete(r)}})()})}waitUntilEngineConnected(){return this.signalConnectedFuture||(this.signalConnectedFuture=new Na),this.signalConnectedFuture.promise}hasPermissionsToPublish(e){if(!this.permissions)return this.log.warn("no permissions present for publishing track",Object.assign(Object.assign({},this.logContext),Ft(e))),!1;const{canPublish:n,canPublishSources:r}=this.permissions;return n&&(r.length===0||r.map(i=>P2e(i)).includes(e.source))?!0:(this.log.warn("insufficient permissions to publish",Object.assign(Object.assign({},this.logContext),Ft(e))),!1)}publish(e,n,r){return X(this,void 0,void 0,function*(){var i,s,o,a,c,l,d,h,m,g;if(!this.hasPermissionsToPublish(e))throw new NH("failed to publish track, insufficient permissions",403);Array.from(this.trackPublications.values()).find(P=>yp(e)&&P.source===e.source)&&e.source!==pe.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(e.source),Object.assign(Object.assign({},this.logContext),Ft(e))),n.stopMicTrackOnMute&&Cl(e)&&(e.stopOnMute=!0),e.source===pe.Source.ScreenShare&&Lp()&&(n.simulcast=!1),n.videoCodec==="av1"&&!f2e()&&(n.videoCodec=void 0),n.videoCodec==="vp9"&&!h2e()&&(n.videoCodec=void 0),n.videoCodec===void 0&&(n.videoCodec=gL),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(P=>n.videoCodec===Y1(P.mime))||(n.videoCodec=Y1(this.enabledPublishVideoCodecs[0].mime)));const v=n.videoCodec;e.on(Ae.Muted,this.onTrackMuted),e.on(Ae.Unmuted,this.onTrackUnmuted),e.on(Ae.Ended,this.handleTrackEnded),e.on(Ae.UpstreamPaused,this.onTrackUpstreamPaused),e.on(Ae.UpstreamResumed,this.onTrackUpstreamResumed),e.on(Ae.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const E=[],w=!(!((i=n.dtx)!==null&&i!==void 0)||i),R=e.getSourceTrackSettings();R.autoGainControl&&E.push(Di.TF_AUTO_GAIN_CONTROL),R.echoCancellation&&E.push(Di.TF_ECHO_CANCELLATION),R.noiseSuppression&&E.push(Di.TF_NOISE_SUPPRESSION),R.channelCount&&R.channelCount>1&&E.push(Di.TF_STEREO),w&&E.push(Di.TF_NO_DTX),mu(e)&&e.hasPreConnectBuffer&&E.push(Di.TF_PRECONNECT_BUFFER);const x=new Hb({cid:e.mediaStreamTrack.id,name:n.name,type:pe.kindToProto(e.kind),muted:e.isMuted,source:pe.sourceToProto(e.source),disableDtx:w,encryption:this.encryptionType,stereo:r,disableRed:this.isE2EEEnabled||!(!((s=n.red)!==null&&s!==void 0)||s),stream:n?.stream,backupCodecPolicy:n?.backupCodecPolicy,audioFeatures:E});let C;if(e.kind===pe.Kind.Video){let P={width:0,height:0};try{P=yield e.waitForDimensions()}catch{const j=(a=(o=this.roomOptions.videoCaptureDefaults)===null||o===void 0?void 0:o.resolution)!==null&&a!==void 0?a:Sl.h720.resolution;P={width:j.width,height:j.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),Ft(e)),{dims:P}))}x.width=P.width,x.height=P.height,Jd(e)&&(kc(v)&&(e.source===pe.Source.ScreenShare&&(n.scalabilityMode="L1T3","contentHint"in e.mediaStreamTrack&&(e.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),Ft(e))))),n.scalabilityMode=(c=n.scalabilityMode)!==null&&c!==void 0?c:"L3T3_KEY"),x.simulcastCodecs=[new eL({codec:v,cid:e.mediaStreamTrack.id})],n.backupCodec===!0&&(n.backupCodec={codec:gL}),n.backupCodec&&v!==n.backupCodec.codec&&x.encryption===vi.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),x.simulcastCodecs.push(new eL({codec:n.backupCodec.codec,cid:""})))),C=yL(e.source===pe.Source.ScreenShare,x.width,x.height,n),x.layers=cq(x.width,x.height,C,kc(n.videoCodec))}else e.kind===pe.Kind.Audio&&(C=[{maxBitrate:(l=n.audioPreset)===null||l===void 0?void 0:l.maxBitrate,priority:(h=(d=n.audioPreset)===null||d===void 0?void 0:d.priority)!==null&&h!==void 0?h:"high",networkPriority:(g=(m=n.audioPreset)===null||m===void 0?void 0:m.priority)!==null&&g!==void 0?g:"high"}]);if(!this.engine||this.engine.isClosed)throw new di("cannot publish track when not connected");const k=()=>X(this,void 0,void 0,function*(){var P,D,j;if(!this.engine.pcManager)throw new di("pcManager is not ready");if(e.sender=yield this.engine.createSender(e,n,C),this.emit(ae.LocalSenderCreated,e.sender,e),Jd(e)&&((P=n.degradationPreference)!==null&&P!==void 0||(n.degradationPreference=Cwe(e)),e.setDegradationPreference(n.degradationPreference)),C)if(Lp()&&e.kind===pe.Kind.Audio){let H;for(const z of this.engine.pcManager.publisher.getTransceivers())if(z.sender===e.sender){H=z;break}H&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:H,codec:"opus",maxbr:!((D=C[0])===null||D===void 0)&&D.maxBitrate?C[0].maxBitrate/1e3:0})}else e.codec&&kc(e.codec)&&(!((j=C[0])===null||j===void 0)&&j.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:x.cid,codec:e.codec,maxbr:C[0].maxBitrate/1e3});yield this.engine.negotiate()});let T;const L=new Promise((P,D)=>X(this,void 0,void 0,function*(){var j;try{T=yield this.engine.addTrack(x),P(T)}catch(H){e.sender&&(!((j=this.engine.pcManager)===null||j===void 0)&&j.publisher)&&(this.engine.pcManager.publisher.removeTrack(e.sender),yield this.engine.negotiate().catch(z=>{this.log.error("failed to negotiate after removing track due to failed add track request",Object.assign(Object.assign(Object.assign({},this.logContext),Ft(e)),{error:z}))})),D(H)}}));if(this.enabledPublishVideoCodecs.length>0)T=(yield Promise.all([L,k()]))[0];else{T=yield L;let P;if(T.codecs.forEach(D=>{P===void 0&&(P=D.mimeType)}),P&&e.kind===pe.Kind.Video){const D=Y1(P);D!==v&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),Ft(e)),{codec:D})),n.videoCodec=D,C=yL(e.source===pe.Source.ScreenShare,x.width,x.height,n))}yield k()}const O=new _L(e.kind,T,e,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});if(O.on(Ae.CpuConstrained,P=>this.onTrackCpuConstrained(P,O)),O.options=n,e.sid=T.sid,this.log.debug("publishing ".concat(e.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:C,trackInfo:T})),Jd(e)?e.startMonitor(this.engine.client):mu(e)&&e.startMonitor(),this.addTrackPublication(O),this.emit(ae.LocalTrackPublished,O),mu(e)&&T.audioFeatures.includes(Di.TF_PRECONNECT_BUFFER)){const P=e.getPreConnectBuffer(),D=e.getPreConnectBufferMimeType();this.on(ae.LocalTrackSubscribed,j=>{if(j.trackSid===T.sid){if(!e.hasPreConnectBuffer){this.log.warn("subscribe event came to late, buffer already closed",this.logContext);return}this.log.debug("finished recording preconnect buffer",Object.assign(Object.assign({},this.logContext),Ft(e))),e.stopPreConnectBuffer()}}),P&&new Promise((H,z)=>X(this,void 0,void 0,function*(){var Y,W,F,$,V,G;try{this.log.debug("waiting for agent",Object.assign(Object.assign({},this.logContext),Ft(e)));const ue=setTimeout(()=>{z(new Error("agent not active within 10 seconds"))},1e4),ge=yield this.waitUntilActiveAgentPresent();clearTimeout(ue),this.log.debug("sending preconnect buffer",Object.assign(Object.assign({},this.logContext),Ft(e)));const Re=yield this.streamBytes({name:"preconnect-buffer",mimeType:D,topic:"lk.agent.pre-connect-audio-buffer",destinationIdentities:[ge.identity],attributes:{trackId:O.trackSid,sampleRate:String((V=R.sampleRate)!==null&&V!==void 0?V:"48000"),channels:String((G=R.channelCount)!==null&&G!==void 0?G:"1")}});try{for(var Z=!0,q=Ou(P),J;J=yield q.next(),Y=J.done,!Y;Z=!0){$=J.value,Z=!1;const we=$;yield Re.write(we)}}catch(we){W={error:we}}finally{try{!Z&&!Y&&(F=q.return)&&(yield F.call(q))}finally{if(W)throw W.error}}yield Re.close(),H()}catch(ue){z(ue)}})).then(()=>{this.log.debug("preconnect buffer sent successfully",Object.assign(Object.assign({},this.logContext),Ft(e)))}).catch(H=>{this.log.error("error sending preconnect buffer",Object.assign(Object.assign(Object.assign({},this.logContext),Ft(e)),{error:H}))})}return O})}get isLocal(){return!0}publishAdditionalCodecForTrack(e,n,r){return X(this,void 0,void 0,function*(){var i;if(this.encryptionType!==vi.NONE)return;let s;if(this.trackPublications.forEach(g=>{g.track&&g.track===e&&(s=g)}),!s)throw new Pu("track is not published");if(!Jd(e))throw new Pu("track is not a video track");const o=Object.assign(Object.assign({},(i=this.roomOptions)===null||i===void 0?void 0:i.publishDefaults),r),a=Swe(e,n,o);if(!a){this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),Ft(e)));return}const c=e.addSimulcastTrack(n,a);if(!c)return;const l=new Hb({cid:c.mediaStreamTrack.id,type:pe.kindToProto(e.kind),muted:e.isMuted,source:pe.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:o.videoCodec,cid:c.mediaStreamTrack.id}]});if(l.layers=cq(l.width,l.height,a),!this.engine||this.engine.isClosed)throw new di("cannot publish track when not connected");const d=()=>X(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(e,c,o,a),yield this.engine.negotiate()}),m=(yield Promise.all([this.engine.addTrack(l),d()]))[0];this.log.debug("published ".concat(n," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:a,trackInfo:m}))})}unpublishTrack(e,n){return X(this,void 0,void 0,function*(){var r,i;if(yp(e)){const l=this.pendingPublishPromises.get(e);l&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),Ft(e))),yield l)}const s=this.getPublicationForTrack(e),o=s?Ft(s):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),o)),!s||!s.track){this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),o));return}e=s.track,e.off(Ae.Muted,this.onTrackMuted),e.off(Ae.Unmuted,this.onTrackUnmuted),e.off(Ae.Ended,this.handleTrackEnded),e.off(Ae.UpstreamPaused,this.onTrackUpstreamPaused),e.off(Ae.UpstreamResumed,this.onTrackUpstreamResumed),e.off(Ae.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),n===void 0&&(n=(i=(r=this.roomOptions)===null||r===void 0?void 0:r.stopLocalTrackOnUnpublish)!==null&&i!==void 0?i:!0),n?e.stop():e.stopMonitor();let a=!1;const c=e.sender;if(e.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<xr.FAILED&&c)try{for(const l of this.engine.pcManager.publisher.getTransceivers())l.sender===c&&(l.direction="inactive",a=!0);if(this.engine.removeTrack(c)&&(a=!0),Jd(e)){for(const[,l]of e.simulcastCodecs)l.sender&&(this.engine.removeTrack(l.sender)&&(a=!0),l.sender=void 0);e.simulcastCodecs.clear()}}catch(l){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),o),{error:l}))}switch(this.trackPublications.delete(s.trackSid),s.kind){case pe.Kind.Audio:this.audioTrackPublications.delete(s.trackSid);break;case pe.Kind.Video:this.videoTrackPublications.delete(s.trackSid);break}return this.emit(ae.LocalTrackUnpublished,s),s.setTrack(void 0),a&&(yield this.engine.negotiate()),s})}unpublishTracks(e){return X(this,void 0,void 0,function*(){return(yield Promise.all(e.map(r=>this.unpublishTrack(r)))).filter(r=>!!r)})}republishAllTracks(e){return X(this,arguments,void 0,function(n){var r=this;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(function*(){r.republishPromise&&(yield r.republishPromise),r.republishPromise=new Promise((s,o)=>X(r,void 0,void 0,function*(){try{const a=[];this.trackPublications.forEach(c=>{c.track&&(n&&(c.options=Object.assign(Object.assign({},c.options),n)),a.push(c))}),yield Promise.all(a.map(c=>X(this,void 0,void 0,function*(){const l=c.track;yield this.unpublishTrack(l,!1),i&&!l.isMuted&&l.source!==pe.Source.ScreenShare&&l.source!==pe.Source.ScreenShareAudio&&(mu(l)||Jd(l))&&!l.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:c.trackSid})),yield l.restartTrack()),yield this.publishOrRepublishTrack(l,c.options,!0)}))),s()}catch(a){o(a)}finally{this.republishPromise=void 0}})),yield r.republishPromise})()})}publishData(e){return X(this,arguments,void 0,function(n){var r=this;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(function*(){const s=i.reliable?$t.RELIABLE:$t.LOSSY,o=i.destinationIdentities,a=i.topic;let c=new kP({participantIdentity:r.identity,payload:n,destinationIdentities:o,topic:a});const l=new Ls({kind:s,value:{case:"user",value:c}});yield r.engine.sendDataPacket(l,s)})()})}publishDtmf(e,n){return X(this,void 0,void 0,function*(){const r=new Ls({kind:$t.RELIABLE,value:{case:"sipDtmf",value:new dZ({code:e,digit:n})}});yield this.engine.sendDataPacket(r,$t.RELIABLE)})}sendChatMessage(e,n){return X(this,void 0,void 0,function*(){const r={id:crypto.randomUUID(),message:e,timestamp:Date.now(),attachedFiles:n?.attachments},i=new Ls({value:{case:"chatMessage",value:new BC(Object.assign(Object.assign({},r),{timestamp:lr.parse(r.timestamp)}))}});return yield this.engine.sendDataPacket(i,$t.RELIABLE),this.emit(ae.ChatMessage,r),r})}editChatMessage(e,n){return X(this,void 0,void 0,function*(){const r=Object.assign(Object.assign({},n),{message:e,editTimestamp:Date.now()}),i=new Ls({value:{case:"chatMessage",value:new BC(Object.assign(Object.assign({},r),{timestamp:lr.parse(r.timestamp),editTimestamp:lr.parse(r.editTimestamp)}))}});return yield this.engine.sendDataPacket(i,$t.RELIABLE),this.emit(ae.ChatMessage,r),r})}sendText(e,n){return X(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendText(e,n)})}streamText(e){return X(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamText(e)})}sendFile(e,n){return X(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendFile(e,n)})}streamBytes(e){return X(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamBytes(e)})}performRpc(e){return X(this,arguments,void 0,function(n){var r=this;let{destinationIdentity:i,method:s,payload:o,responseTimeout:a=15e3}=n;return(function*(){return new Promise((d,h)=>X(r,void 0,void 0,function*(){var m,g,y,v;if(KP(o)>Ree){h(Or.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));return}if(!((g=(m=this.engine.latestJoinResponse)===null||m===void 0?void 0:m.serverInfo)===null||g===void 0)&&g.version&&xl((v=(y=this.engine.latestJoinResponse)===null||y===void 0?void 0:y.serverInfo)===null||v===void 0?void 0:v.version,"1.8.0")<0){h(Or.builtIn("UNSUPPORTED_SERVER"));return}const E=Math.max(a,8e3),w=crypto.randomUUID();yield this.publishRpcRequest(i,w,s,o,E);const R=setTimeout(()=>{this.pendingAcks.delete(w),h(Or.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(w),clearTimeout(x)},7e3);this.pendingAcks.set(w,{resolve:()=>{clearTimeout(R)},participantIdentity:i});const x=setTimeout(()=>{this.pendingResponses.delete(w),h(Or.builtIn("RESPONSE_TIMEOUT"))},a);this.pendingResponses.set(w,{resolve:(C,k)=>{clearTimeout(x),this.pendingAcks.has(w)&&(console.warn("RPC response received before ack",w),this.pendingAcks.delete(w),clearTimeout(R)),k?h(k):d(C??"")},participantIdentity:i})}))})()})}registerRpcMethod(e,n){this.rpcHandlers.has(e)&&this.log.warn("you're overriding the RPC handler for method ".concat(e,", in the future this will throw an error")),this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setTrackSubscriptionPermissions(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=n,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(e){const n=this.pendingAcks.get(e);n?(n.resolve(),this.pendingAcks.delete(e)):console.error("Ack received for unexpected RPC request",e)}handleIncomingRpcResponse(e,n,r){const i=this.pendingResponses.get(e);i?(i.resolve(n,r),this.pendingResponses.delete(e)):console.error("Response received for unexpected RPC request",e)}publishRpcRequest(e,n,r,i,s){return X(this,void 0,void 0,function*(){const o=new Ls({destinationIdentities:[e],kind:$t.RELIABLE,value:{case:"rpcRequest",value:new IP({id:n,method:r,payload:i,responseTimeoutMs:s,version:1})}});yield this.engine.sendDataPacket(o,$t.RELIABLE)})}handleParticipantDisconnected(e){for(const[n,{participantIdentity:r}]of this.pendingAcks)r===e&&this.pendingAcks.delete(n);for(const[n,{participantIdentity:r,resolve:i}]of this.pendingResponses)r===e&&(i(null,Or.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(n))}setEnabledPublishCodecs(e){this.enabledPublishVideoCodecs=e.filter(n=>n.mime.split("/")[0].toLowerCase()==="video")}updateInfo(e){return super.updateInfo(e)?(e.tracks.forEach(n=>{var r,i;const s=this.trackPublications.get(n.sid);if(s){const o=s.isMuted||((i=(r=s.track)===null||r===void 0?void 0:r.isUpstreamPaused)!==null&&i!==void 0?i:!1);o!==n.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),Ft(s)),{mutedOnServer:o})),this.engine.client.sendMuteTrack(n.sid,o))}}),!0):!1}setActiveAgent(e){var n,r,i,s;this.firstActiveAgent=e,e&&!this.firstActiveAgent&&(this.firstActiveAgent=e),e?(r=(n=this.activeAgentFuture)===null||n===void 0?void 0:n.resolve)===null||r===void 0||r.call(n,e):(s=(i=this.activeAgentFuture)===null||i===void 0?void 0:i.reject)===null||s===void 0||s.call(i,new Error("Agent disconnected")),this.activeAgentFuture=void 0}waitUntilActiveAgentPresent(){return this.firstActiveAgent?Promise.resolve(this.firstActiveAgent):(this.activeAgentFuture||(this.activeAgentFuture=new Na),this.activeAgentFuture.promise)}getPublicationForTrack(e){let n;return this.trackPublications.forEach(r=>{const i=r.track;i&&(e instanceof MediaStreamTrack?(mu(i)||Jd(i))&&i.mediaStreamTrack===e&&(n=r):e===i&&(n=r))}),n}waitForPendingPublicationOfSource(e){return X(this,void 0,void 0,function*(){const r=Date.now();for(;Date.now()<r+1e4;){const i=Array.from(this.pendingPublishPromises.entries()).find(s=>{let[o]=s;return o.source===e});if(i)return i[1];yield ns(20)}})}}class WC extends Tu{constructor(e,n,r,i){super(e,n.sid,n.name,i),this.track=void 0,this.allowed=!0,this.requestedDisabled=void 0,this.visible=!0,this.handleEnded=s=>{this.setTrack(void 0),this.emit(Ae.Ended,s)},this.handleVisibilityChange=s=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(s),this.logContext),this.visible=s,this.emitTrackUpdate()},this.handleVideoDimensionsChange=s=>{this.log.debug("adaptivestream video dimensions ".concat(s.width,"x").concat(s.height),this.logContext),this.videoDimensionsAdaptiveStream=s,this.emitTrackUpdate()},this.subscribed=r,this.updateInfo(n)}setSubscribed(e){const n=this.subscriptionStatus,r=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);const i=new NT({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new hZ({participantSid:"",trackSids:[this.trackSid]})]});this.emit(Ae.UpdateSubscription,i),this.emitSubscriptionUpdateIfChanged(n),this.emitPermissionUpdateIfChanged(r)}get subscriptionStatus(){return this.subscribed===!1?Tu.SubscriptionStatus.Unsubscribed:super.isSubscribed?Tu.SubscriptionStatus.Subscribed:Tu.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?Tu.PermissionStatus.Allowed:Tu.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return this.requestedDisabled!==void 0?!this.requestedDisabled:this.isAdaptiveStream?this.visible:!0}get isLocal(){return!1}setEnabled(e){!this.isManualOperationAllowed()||this.requestedDisabled===!e||(this.requestedDisabled=!e,this.emitTrackUpdate())}setVideoQuality(e){!this.isManualOperationAllowed()||this.requestedMaxQuality===e||(this.requestedMaxQuality=e,this.requestedVideoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var n,r;this.isManualOperationAllowed()&&(((n=this.requestedVideoDimensions)===null||n===void 0?void 0:n.width)===e.width&&((r=this.requestedVideoDimensions)===null||r===void 0?void 0:r.height)===e.height||(Ix(this.track)&&(this.requestedVideoDimensions=e),this.requestedMaxQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&Ix(this.track)&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){var e;return(e=this.requestedMaxQuality)!==null&&e!==void 0?e:Xo.HIGH}setTrack(e){const n=this.subscriptionStatus,r=this.permissionStatus,i=this.track;i!==e&&(i&&(i.off(Ae.VideoDimensionsChanged,this.handleVideoDimensionsChange),i.off(Ae.VisibilityChanged,this.handleVisibilityChange),i.off(Ae.Ended,this.handleEnded),i.detach(),i.stopMonitor(),this.emit(Ae.Unsubscribed,i)),super.setTrack(e),e&&(e.sid=this.trackSid,e.on(Ae.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on(Ae.VisibilityChanged,this.handleVisibilityChange),e.on(Ae.Ended,this.handleEnded),this.emit(Ae.Subscribed,e)),this.emitPermissionUpdateIfChanged(r),this.emitSubscriptionUpdateIfChanged(n))}setAllowed(e){const n=this.subscriptionStatus,r=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(r),this.emitSubscriptionUpdateIfChanged(n)}setSubscriptionError(e){this.emit(Ae.SubscriptionFailed,e)}updateInfo(e){super.updateInfo(e);const n=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):n!==e.muted&&this.emit(e.muted?Ae.Muted:Ae.Unmuted)}emitSubscriptionUpdateIfChanged(e){const n=this.subscriptionStatus;e!==n&&this.emit(Ae.SubscriptionStatusChanged,n,e)}emitPermissionUpdateIfChanged(e){this.permissionStatus!==e&&this.emit(Ae.SubscriptionPermissionChanged,this.permissionStatus,e)}isManualOperationAllowed(){return this.isDesired?!0:(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return Ix(this.track)&&this.track.isAdaptiveStream}emitTrackUpdate(){const e=new wZ({trackSids:[this.trackSid],disabled:!this.isEnabled,fps:this.fps});if(this.kind===pe.Kind.Video){let n=this.requestedVideoDimensions;if(this.videoDimensionsAdaptiveStream!==void 0)if(n)zH(this.videoDimensionsAdaptiveStream,n)&&(this.log.debug("using adaptive stream dimensions instead of requested",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream);else if(this.requestedMaxQuality!==void 0&&this.trackInfo){const r=D2e(this.trackInfo,this.requestedMaxQuality);r&&zH(this.videoDimensionsAdaptiveStream,r)&&(this.log.debug("using adaptive stream dimensions instead of max quality layer",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream)}else this.log.debug("using adaptive stream dimensions",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream;n?(e.width=Math.ceil(n.width),e.height=Math.ceil(n.height)):this.requestedMaxQuality!==void 0?(this.log.debug("using requested max quality",Object.assign(Object.assign({},this.logContext),{quality:this.requestedMaxQuality})),e.quality=this.requestedMaxQuality):(this.log.debug("using default quality",Object.assign(Object.assign({},this.logContext),{quality:Xo.HIGH})),e.quality=Xo.HIGH)}this.emit(Ae.UpdateSettings,e)}}class YC extends Mee{static fromParticipantInfo(e,n,r){return new YC(e,n.sid,n.identity,n.name,n.metadata,n.attributes,r,n.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(e,n,r,i,s,o,a){let c=arguments.length>7&&arguments[7]!==void 0?arguments[7]:Bb.STANDARD;super(n,r||"",i,s,o,a,c),this.signalClient=e,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(e){super.addTrackPublication(e),e.on(Ae.UpdateSettings,n=>{this.log.debug("send update settings",Object.assign(Object.assign(Object.assign({},this.logContext),Ft(e)),{settings:n})),this.signalClient.sendUpdateTrackSettings(n)}),e.on(Ae.UpdateSubscription,n=>{n.participantTracks.forEach(r=>{r.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(n)}),e.on(Ae.SubscriptionPermissionChanged,n=>{this.emit(ae.TrackSubscriptionPermissionChanged,e,n)}),e.on(Ae.SubscriptionStatusChanged,n=>{this.emit(ae.TrackSubscriptionStatusChanged,e,n)}),e.on(Ae.Subscribed,n=>{this.emit(ae.TrackSubscribed,n,e)}),e.on(Ae.Unsubscribed,n=>{this.emit(ae.TrackUnsubscribed,n,e)}),e.on(Ae.SubscriptionFailed,n=>{this.emit(ae.TrackSubscriptionFailed,e.trackSid,n)})}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setVolume(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:pe.Source.Microphone;this.volumeMap.set(n,e);const r=this.getTrackPublication(n);r&&r.track&&r.track.setVolume(e)}getVolume(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:pe.Source.Microphone;const n=this.getTrackPublication(e);return n&&n.track?n.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(e,n,r,i,s,o){let a=this.getTrackPublicationBySid(n);if(a||n.startsWith("TR")||this.trackPublications.forEach(d=>{!a&&e.kind===d.kind.toString()&&(a=d)}),!a){if(o===0){this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:n})),this.emit(ae.TrackSubscriptionFailed,n);return}o===void 0&&(o=20),setTimeout(()=>{this.addSubscribedMediaTrack(e,n,r,i,s,o-1)},150);return}if(e.readyState==="ended"){this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),Ft(a))),this.emit(ae.TrackSubscriptionFailed,n);return}const c=e.kind==="video";let l;return c?l=new Nwe(e,n,i,s):l=new Lee(e,n,i,this.audioContext,this.audioOutput),l.source=a.source,l.isMuted=a.isMuted,l.setMediaStream(r),l.start(),a.setTrack(l),this.volumeMap.has(a.source)&&hL(l)&&Cl(l)&&l.setVolume(this.volumeMap.get(a.source)),a}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(e){return this.trackPublications.get(e)}updateInfo(e){if(!super.updateInfo(e))return!1;const n=new Map,r=new Map;return e.tracks.forEach(i=>{var s,o;let a=this.getTrackPublicationBySid(i.sid);if(a)a.updateInfo(i);else{const c=pe.kindFromProto(i.type);if(!c)return;a=new WC(c,i,(s=this.signalClient.connectOptions)===null||s===void 0?void 0:s.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:(o=this.loggerOptions)===null||o===void 0?void 0:o.loggerName}),a.updateInfo(i),r.set(i.sid,a);const l=Array.from(this.trackPublications.values()).find(d=>d.source===a?.source);l&&a.source!==pe.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(a.source),Object.assign(Object.assign({},this.logContext),{oldTrack:Ft(l),newTrack:Ft(a)})),this.addTrackPublication(a)}n.set(i.sid,a)}),this.trackPublications.forEach(i=>{n.has(i.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),Ft(i))),this.unpublishTrack(i.trackSid,!0))}),r.forEach(i=>{this.emit(ae.TrackPublished,i)}),!0}unpublishTrack(e,n){const r=this.trackPublications.get(e);if(!r)return;const{track:i}=r;switch(i&&(i.stop(),r.setTrack(void 0)),this.trackPublications.delete(e),r.kind){case pe.Kind.Audio:this.audioTrackPublications.delete(e);break;case pe.Kind.Video:this.videoTrackPublications.delete(e);break}n&&this.emit(ae.TrackUnpublished,r)}setAudioOutput(e){return X(this,void 0,void 0,function*(){this.audioOutput=e;const n=[];this.audioTrackPublications.forEach(r=>{var i;Cl(r.track)&&hL(r.track)&&n.push(r.track.setSinkId((i=e.deviceId)!==null&&i!==void 0?i:"default"))}),yield Promise.all(n)})}emit(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:r})),super.emit(e,...r)}}var Xt;(function(t){t.Disconnected="disconnected",t.Connecting="connecting",t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting"})(Xt||(Xt={}));const qwe=4*1e3;class td extends jl.EventEmitter{get hasE2EESetup(){return this.e2eeManager!==void 0}constructor(e){var n,r,i,s;if(super(),n=this,this.state=Xt.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=kt,this.bufferedEvents=[],this.isResuming=!1,this.rpcHandlers=new Map,this.connect=(o,a,c)=>X(this,void 0,void 0,function*(){var l;if(!p2e())throw Il()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const d=yield this.disconnectLock.lock();if(this.state===Xt.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),d(),Promise.resolve();if(this.connectFuture)return d(),this.connectFuture.promise;this.setAndEmitConnectionState(Xt.Connecting),((l=this.regionUrlProvider)===null||l===void 0?void 0:l.getServerUrl().toString())!==o&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),GC(new URL(o))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new fn(o,a):this.regionUrlProvider.updateToken(a),this.regionUrlProvider.fetchRegionSettings().then(g=>{var y;(y=this.regionUrlProvider)===null||y===void 0||y.setServerReportedRegions(g)}).catch(g=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:g}))}));const h=(g,y,v)=>X(this,void 0,void 0,function*(){var E,w;this.abortController&&this.abortController.abort();const R=new AbortController;this.abortController=R,d?.();try{if(yield sv.getInstance().getBackOffPromise(o),R.signal.aborted)throw new Bt("Connection attempt aborted",wt.Cancelled);yield this.attemptConnection(v??o,a,c,R),this.abortController=void 0,g()}catch(x){if(this.regionUrlProvider&&x instanceof Bt&&x.reason!==wt.Cancelled&&x.reason!==wt.NotAllowed){let C=null;try{this.log.debug("Fetching next region"),C=yield this.regionUrlProvider.getNextBestRegionUrl((E=this.abortController)===null||E===void 0?void 0:E.signal)}catch(k){if(k instanceof Bt&&(k.status===401||k.reason===wt.Cancelled)){this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),y(k);return}}[wt.InternalError,wt.ServerUnreachable,wt.Timeout].includes(x.reason)&&(this.log.debug("Adding failed connection attempt to back off"),sv.getInstance().addFailedConnectionAttempt(o)),C&&!(!((w=this.abortController)===null||w===void 0)&&w.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(x.message,". Retrying with another region: ").concat(C),this.logContext),this.recreateEngine(),yield h(g,y,C)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,GH(x)),y(x))}else{let C=xc.UNKNOWN_REASON;x instanceof Bt&&(C=GH(x)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,C),y(x)}}}),m=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new Na((g,y)=>{h(g,y,m)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(o,a,c,l,d,h)=>X(this,void 0,void 0,function*(){var m,g,y;const v=yield c.join(o,a,{autoSubscribe:l.autoSubscribe,adaptiveStream:typeof d.adaptiveStream=="object"?!0:d.adaptiveStream,maxRetries:l.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:l.websocketTimeout,singlePeerConnection:d.singlePeerConnection},h.signal);let E=v.serverInfo;if(E||(E={version:v.serverVersion,region:v.serverRegion}),this.serverInfo=E,this.log.debug("connected to Livekit Server ".concat(Object.entries(E).map(w=>{let[R,x]=w;return"".concat(R,": ").concat(x)}).join(", ")),{room:(m=v.room)===null||m===void 0?void 0:m.name,roomSid:(g=v.room)===null||g===void 0?void 0:g.sid,identity:(y=v.participant)===null||y===void 0?void 0:y.identity}),!E.version)throw new QSe("unknown server version");return E.version==="0.15.1"&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),d.dynacast=!1),v}),this.applyJoinResponse=o=>{const a=o.participant;if(this.localParticipant.sid=a.sid,this.localParticipant.identity=a.identity,this.localParticipant.setEnabledPublishCodecs(o.enabledPublishCodecs),this.e2eeManager)try{this.e2eeManager.setSifTrailer(o.sifTrailer)}catch(c){this.log.error(c instanceof Error?c.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:c}))}this.handleParticipantUpdates([a,...o.otherParticipants]),o.room&&this.handleRoomUpdate(o.room)},this.attemptConnection=(o,a,c,l)=>X(this,void 0,void 0,function*(){var d,h;this.state===Xt.Reconnecting||this.isResuming||!((d=this.engine)===null||d===void 0)&&d.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!((h=this.regionUrlProvider)===null||h===void 0)&&h.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},VP),c),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const m=yield this.connectSignal(o,a,this.engine,this.connOptions,this.options,l);this.applyJoinResponse(m),this.setupLocalParticipantEvents(),this.emit(he.SignalConnected)}catch(m){yield this.engine.close(),this.recreateEngine();const g=new Bt("could not establish signal connection",l.signal.aborted?wt.Cancelled:wt.ServerUnreachable);throw m instanceof Error&&(g.message="".concat(g.message,": ").concat(m.message)),m instanceof Bt&&(g.reason=m.reason,g.status=m.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:m})),g}if(l.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),new Bt("Connection attempt aborted",wt.Cancelled);try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,l)}catch(m){throw yield this.engine.close(),this.recreateEngine(),m}co()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),co()&&document.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(Xt.Connected),this.emit(he.Connected),sv.getInstance().resetFailedConnectionAttempts(o),this.registerConnectionReconcile(),this.regionUrlProvider&&this.regionUrlProvider.notifyConnected()}),this.disconnect=function(){for(var o=arguments.length,a=new Array(o),c=0;c<o;c++)a[c]=arguments[c];return X(n,[...a],void 0,function(){var l=this;let d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return(function*(){var h,m,g;const y=yield l.disconnectLock.lock();try{if(l.state===Xt.Disconnected){l.log.debug("already disconnected",l.logContext);return}if(l.log.info("disconnect from room",Object.assign({},l.logContext)),l.state===Xt.Connecting||l.state===Xt.Reconnecting||l.isResuming){const v="Abort connection attempt due to user initiated disconnect";l.log.warn(v,l.logContext),(h=l.abortController)===null||h===void 0||h.abort(v),(g=(m=l.connectFuture)===null||m===void 0?void 0:m.reject)===null||g===void 0||g.call(m,new Bt("Client initiated disconnect",wt.Cancelled)),l.connectFuture=void 0}l.engine&&(l.engine.client.isDisconnected||(yield l.engine.client.sendLeave()),yield l.engine.close()),l.handleDisconnect(d,xc.CLIENT_INITIATED),l.engine=void 0}finally{y()}})()})},this.onPageLeave=()=>X(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>X(this,void 0,void 0,function*(){const o=[],a=ho();if(a&&a.os==="iOS"){const c="livekit-dummy-audio-el";let l=document.getElementById(c);if(!l){l=document.createElement("audio"),l.id=c,l.autoplay=!0,l.hidden=!0;const d=kx();d.enabled=!0;const h=new MediaStream([d]);l.srcObject=h,document.addEventListener("visibilitychange",()=>{l&&(l.srcObject=document.hidden?null:h,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(l),this.once(he.Disconnected,()=>{l?.remove(),l=null})}o.push(l)}this.remoteParticipants.forEach(c=>{c.audioTrackPublications.forEach(l=>{l.track&&l.track.attachedElements.forEach(d=>{o.push(d)})})});try{yield Promise.all([this.acquireAudioContext(),...o.map(c=>(c.muted=!1,c.play()))]),this.handleAudioPlaybackStarted()}catch(c){throw this.handleAudioPlaybackFailed(c),c}}),this.startVideo=()=>X(this,void 0,void 0,function*(){const o=[];for(const a of this.remoteParticipants.values())a.videoTrackPublications.forEach(c=>{var l;(l=c.track)===null||l===void 0||l.attachedElements.forEach(d=>{o.includes(d)||o.push(d)})});yield Promise.all(o.map(a=>a.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(a=>{a.name==="NotAllowedError"?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const o of this.remoteParticipants.values())this.handleParticipantDisconnected(o.identity,o);this.setAndEmitConnectionState(Xt.Reconnecting)&&this.emit(he.Reconnecting)},this.handleSignalRestarted=o=>X(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(o.serverRegion),Object.assign(Object.assign({},this.logContext),{region:o.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(o);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(a){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:a}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:o.serverRegion}))}catch{return}this.setAndEmitConnectionState(Xt.Connected),this.emit(he.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=o=>{o.forEach(a=>{var c;if(a.identity===this.localParticipant.identity){this.localParticipant.updateInfo(a);return}a.identity===""&&(a.identity=(c=this.sidToIdentity.get(a.sid))!==null&&c!==void 0?c:"");let l=this.remoteParticipants.get(a.identity);a.state===tv.DISCONNECTED?this.handleParticipantDisconnected(a.identity,l):l=this.getOrCreateParticipant(a.identity,a)})},this.handleActiveSpeakersUpdate=o=>{const a=[],c={};o.forEach(l=>{if(c[l.sid]=!0,l.sid===this.localParticipant.sid)this.localParticipant.audioLevel=l.level,this.localParticipant.setIsSpeaking(!0),a.push(this.localParticipant);else{const d=this.getRemoteParticipantBySid(l.sid);d&&(d.audioLevel=l.level,d.setIsSpeaking(!0),a.push(d))}}),c[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(l=>{c[l.sid]||(l.audioLevel=0,l.setIsSpeaking(!1))}),this.activeSpeakers=a,this.emitWhenConnected(he.ActiveSpeakersChanged,a)},this.handleSpeakersChanged=o=>{const a=new Map;this.activeSpeakers.forEach(l=>{const d=this.remoteParticipants.get(l.identity);d&&d.sid!==l.sid||a.set(l.sid,l)}),o.forEach(l=>{let d=this.getRemoteParticipantBySid(l.sid);l.sid===this.localParticipant.sid&&(d=this.localParticipant),d&&(d.audioLevel=l.level,d.setIsSpeaking(l.active),l.active?a.set(l.sid,d):a.delete(l.sid))});const c=Array.from(a.values());c.sort((l,d)=>d.audioLevel-l.audioLevel),this.activeSpeakers=c,this.emitWhenConnected(he.ActiveSpeakersChanged,c)},this.handleStreamStateUpdate=o=>{o.streamStates.forEach(a=>{const c=this.getRemoteParticipantBySid(a.participantSid);if(!c)return;const l=c.getTrackPublicationBySid(a.trackSid);if(!l||!l.track)return;const d=pe.streamStateFromProto(a.state);l.track.setStreamState(d),d!==l.track.streamState&&(c.emit(ae.TrackStreamStateChanged,l,l.track.streamState),this.emitWhenConnected(he.TrackStreamStateChanged,l,l.track.streamState,c))})},this.handleSubscriptionPermissionUpdate=o=>{const a=this.getRemoteParticipantBySid(o.participantSid);if(!a)return;const c=a.getTrackPublicationBySid(o.trackSid);c&&c.setAllowed(o.allowed)},this.handleSubscriptionError=o=>{const a=Array.from(this.remoteParticipants.values()).find(l=>l.trackPublications.has(o.trackSid));if(!a)return;const c=a.getTrackPublicationBySid(o.trackSid);c&&c.setSubscriptionError(o.err)},this.handleDataPacket=(o,a)=>{const c=this.remoteParticipants.get(o.participantIdentity);if(o.value.case==="user")this.handleUserPacket(c,o.value.value,o.kind,a);else if(o.value.case==="transcription")this.handleTranscription(c,o.value.value);else if(o.value.case==="sipDtmf")this.handleSipDtmf(c,o.value.value);else if(o.value.case==="chatMessage")this.handleChatMessage(c,o.value.value);else if(o.value.case==="metrics")this.handleMetrics(o.value.value,c);else if(o.value.case==="streamHeader"||o.value.case==="streamChunk"||o.value.case==="streamTrailer")this.handleDataStream(o,a);else if(o.value.case==="rpcRequest"){const l=o.value.value;this.handleIncomingRpcRequest(o.participantIdentity,l.id,l.method,l.payload,l.responseTimeoutMs,l.version)}},this.handleUserPacket=(o,a,c,l)=>{this.emit(he.DataReceived,a.payload,o,c,a.topic,l),o?.emit(ae.DataReceived,a.payload,c,l)},this.handleSipDtmf=(o,a)=>{this.emit(he.SipDTMFReceived,a,o),o?.emit(ae.SipDTMFReceived,a)},this.handleTranscription=(o,a)=>{const c=a.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(a.transcribedParticipantIdentity),l=c?.trackPublications.get(a.trackId),d=E2e(a,this.transcriptionReceivedTimes);l?.emit(Ae.TranscriptionReceived,d),c?.emit(ae.TranscriptionReceived,d,l),this.emit(he.TranscriptionReceived,d,c,l)},this.handleChatMessage=(o,a)=>{const c=C2e(a);this.emit(he.ChatMessage,c,o)},this.handleMetrics=(o,a)=>{this.emit(he.MetricsReceived,o,a)},this.handleDataStream=(o,a)=>{this.incomingDataStreamManager.handleDataStreamPacket(o,a)},this.bufferedSegments=new Map,this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(he.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=o=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:o})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(he.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(he.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(he.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>X(this,void 0,void 0,function*(){var o;((o=ho())===null||o===void 0?void 0:o.os)!=="iOS"&&(yield this.selectDefaultDevices()),this.emit(he.MediaDevicesChanged)}),this.handleRoomUpdate=o=>{const a=this.roomInfo;this.roomInfo=o,a&&a.metadata!==o.metadata&&this.emitWhenConnected(he.RoomMetadataChanged,o.metadata),a?.activeRecording!==o.activeRecording&&this.emitWhenConnected(he.RecordingStatusChanged,o.activeRecording)},this.handleConnectionQualityUpdate=o=>{o.updates.forEach(a=>{if(a.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(a.quality);return}const c=this.getRemoteParticipantBySid(a.participantSid);c&&c.setConnectionQuality(a.quality)})},this.onLocalParticipantMetadataChanged=o=>{this.emit(he.ParticipantMetadataChanged,o,this.localParticipant)},this.onLocalParticipantNameChanged=o=>{this.emit(he.ParticipantNameChanged,o,this.localParticipant)},this.onLocalAttributesChanged=o=>{this.emit(he.ParticipantAttributesChanged,o,this.localParticipant)},this.onLocalTrackMuted=o=>{this.emit(he.TrackMuted,o,this.localParticipant)},this.onLocalTrackUnmuted=o=>{this.emit(he.TrackUnmuted,o,this.localParticipant)},this.onTrackProcessorUpdate=o=>{var a;(a=o?.onPublish)===null||a===void 0||a.call(o,this)},this.onLocalTrackPublished=o=>X(this,void 0,void 0,function*(){var a,c,l,d,h,m;(a=o.track)===null||a===void 0||a.on(Ae.TrackProcessorUpdate,this.onTrackProcessorUpdate),(c=o.track)===null||c===void 0||c.on(Ae.Restarted,this.onLocalTrackRestarted),(h=(d=(l=o.track)===null||l===void 0?void 0:l.getProcessor())===null||d===void 0?void 0:d.onPublish)===null||h===void 0||h.call(d,this),this.emit(he.LocalTrackPublished,o,this.localParticipant),mu(o.track)&&(yield o.track.checkForSilence())&&this.emit(he.LocalAudioSilenceDetected,o);const g=yield(m=o.track)===null||m===void 0?void 0:m.getDeviceId(!1),y=mL(o.source);y&&g&&g!==this.localParticipant.activeDeviceMap.get(y)&&(this.localParticipant.activeDeviceMap.set(y,g),this.emit(he.ActiveDeviceChanged,y,g))}),this.onLocalTrackUnpublished=o=>{var a,c;(a=o.track)===null||a===void 0||a.off(Ae.TrackProcessorUpdate,this.onTrackProcessorUpdate),(c=o.track)===null||c===void 0||c.off(Ae.Restarted,this.onLocalTrackRestarted),this.emit(he.LocalTrackUnpublished,o,this.localParticipant)},this.onLocalTrackRestarted=o=>X(this,void 0,void 0,function*(){const a=yield o.getDeviceId(!1),c=mL(o.source);c&&a&&a!==this.localParticipant.activeDeviceMap.get(c)&&(this.log.debug("local track restarted, setting ".concat(c," ").concat(a," active"),this.logContext),this.localParticipant.activeDeviceMap.set(c,a),this.emit(he.ActiveDeviceChanged,c,a))}),this.onLocalConnectionQualityChanged=o=>{this.emit(he.ConnectionQualityChanged,o,this.localParticipant)},this.onMediaDevicesError=(o,a)=>{this.emit(he.MediaDevicesError,o,a)},this.onLocalParticipantPermissionsChanged=o=>{this.emit(he.ParticipantPermissionsChanged,o,this.localParticipant)},this.onLocalChatMessageSent=o=>{this.emit(he.ChatMessage,o,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},iwe),e),this.log=ed((r=this.options.loggerName)!==null&&r!==void 0?r:Nc.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},Eee),e?.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},Cee),e?.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},rwe),e?.publishDefaults),this.maybeCreateEngine(),this.incomingDataStreamManager=new Mwe,this.outgoingDataStreamManager=new Dwe(this.engine,this.log),this.disconnectLock=new ps,this.localParticipant=new Hwe("","",this.engine,this.options,this.rpcHandlers,this.outgoingDataStreamManager),(this.options.e2ee||this.options.encryption)&&this.setupE2EE(),this.engine.e2eeManager=this.e2eeManager,this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",Of(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",Of(this.options.audioCaptureDefaults.deviceId)),!((i=this.options.audioOutput)===null||i===void 0)&&i.deviceId&&this.switchActiveDevice("audiooutput",Of(this.options.audioOutput.deviceId)).catch(o=>this.log.warn("Could not set audio output: ".concat(o.message),this.logContext)),co()){const o=new AbortController;(s=navigator.mediaDevices)===null||s===void 0||s.addEventListener("devicechange",this.handleDeviceChange,{signal:o.signal}),td.cleanupRegistry&&td.cleanupRegistry.register(this,()=>{o.abort()})}}registerTextStreamHandler(e,n){return this.incomingDataStreamManager.registerTextStreamHandler(e,n)}unregisterTextStreamHandler(e){return this.incomingDataStreamManager.unregisterTextStreamHandler(e)}registerByteStreamHandler(e,n){return this.incomingDataStreamManager.registerByteStreamHandler(e,n)}unregisterByteStreamHandler(e){return this.incomingDataStreamManager.unregisterByteStreamHandler(e)}registerRpcMethod(e,n){if(this.rpcHandlers.has(e))throw Error("RPC handler already registered for method ".concat(e,", unregisterRpcMethod before trying to register again"));this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setE2EEEnabled(e){return X(this,void 0,void 0,function*(){if(this.e2eeManager)yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity);else throw Error("e2ee not configured, please set e2ee settings within the room options")})}setupE2EE(){var e;const n=!!this.options.encryption,r=this.options.encryption||this.options.e2ee;r&&("e2eeManager"in r?(this.e2eeManager=r.e2eeManager,this.e2eeManager.isDataChannelEncryptionEnabled=n):this.e2eeManager=new N2e(r,n),this.e2eeManager.on(Sf.ParticipantEncryptionStatusChanged,(i,s)=>{R2e(s)&&(this.isE2EEEnabled=i),this.emit(he.ParticipantEncryptionStatusChanged,i,s)}),this.e2eeManager.on(Sf.EncryptionError,(i,s)=>{const o=s?this.getParticipantByIdentity(s):void 0;this.emit(he.EncryptionError,i,o)}),(e=this.e2eeManager)===null||e===void 0||e.setup(this))}get logContext(){var e;return{room:this.name,roomID:(e=this.roomInfo)===null||e===void 0?void 0:e.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.activeRecording)!==null&&n!==void 0?n:!1}getSid(){return X(this,void 0,void 0,function*(){return this.state===Xt.Disconnected?"":this.roomInfo&&this.roomInfo.sid!==""?this.roomInfo.sid:new Promise((e,n)=>{const r=i=>{i.sid!==""&&(this.engine.off(Ne.RoomUpdate,r),e(i.sid))};this.engine.on(Ne.RoomUpdate,r),this.once(he.Disconnected,()=>{this.engine.off(Ne.RoomUpdate,r),n("Room disconnected before room server id was available")})})})}get name(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.name)!==null&&n!==void 0?n:""}get metadata(){var e;return(e=this.roomInfo)===null||e===void 0?void 0:e.metadata}get numParticipants(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numParticipants)!==null&&n!==void 0?n:0}get numPublishers(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numPublishers)!==null&&n!==void 0?n:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new Iwe(this.options),this.engine.e2eeManager=this.e2eeManager,this.engine.on(Ne.ParticipantUpdate,this.handleParticipantUpdates).on(Ne.RoomUpdate,this.handleRoomUpdate).on(Ne.SpeakersChanged,this.handleSpeakersChanged).on(Ne.StreamStateChanged,this.handleStreamStateUpdate).on(Ne.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(Ne.SubscriptionError,this.handleSubscriptionError).on(Ne.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(Ne.MediaTrackAdded,(e,n,r)=>{this.onTrackAdded(e,n,r)}).on(Ne.Disconnected,e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)}).on(Ne.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(Ne.DataPacketReceived,this.handleDataPacket).on(Ne.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(Xt.SignalReconnecting)&&this.emit(he.SignalReconnecting)}).on(Ne.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(Xt.Connected)&&this.emit(he.Reconnected)}).on(Ne.SignalResumed,()=>{this.bufferedEvents=[],(this.state===Xt.Reconnecting||this.isResuming)&&this.sendSyncState()}).on(Ne.Restarting,this.handleRestarting).on(Ne.SignalRestarted,this.handleSignalRestarted).on(Ne.Offline,()=>{this.setAndEmitConnectionState(Xt.Reconnecting)&&this.emit(he.Reconnecting)}).on(Ne.DCBufferStatusChanged,(e,n)=>{this.emit(he.DCBufferStatusChanged,e,n)}).on(Ne.LocalTrackSubscribed,e=>{const n=this.localParticipant.getTrackPublications().find(r=>{let{trackSid:i}=r;return i===e});if(!n){this.log.warn("could not find local track subscription for subscribed event",this.logContext);return}this.localParticipant.emit(ae.LocalTrackSubscribed,n),this.emitWhenConnected(he.LocalTrackSubscribed,n,this.localParticipant)}).on(Ne.RoomMoved,e=>{this.log.debug("room moved",e),e.room&&this.handleRoomUpdate(e.room),this.remoteParticipants.forEach((n,r)=>{this.handleParticipantDisconnected(r,n)}),this.emit(he.Moved,e.room.name),e.participant?this.handleParticipantUpdates([e.participant,...e.otherParticipants]):this.handleParticipantUpdates(e.otherParticipants)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine),this.outgoingDataStreamManager&&this.outgoingDataStreamManager.setupEngine(this.engine))}static getLocalDevices(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return Ni.getInstance().getDevices(e,n)}prepareConnection(e,n){return X(this,void 0,void 0,function*(){if(this.state===Xt.Disconnected){this.log.debug("prepareConnection to ".concat(e),this.logContext);try{if(GC(new URL(e))&&n){this.regionUrlProvider=new fn(e,n);const r=yield this.regionUrlProvider.getNextBestRegionUrl();r&&this.state===Xt.Disconnected&&(this.regionUrl=r,yield fetch(Gb(r),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(r),this.logContext))}else yield fetch(Gb(e),{method:"HEAD"})}catch(r){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:r}))}}})}getParticipantByIdentity(e){return this.localParticipant.identity===e?this.localParticipant:this.remoteParticipants.get(e)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,n){return X(this,void 0,void 0,function*(){let r=()=>X(this,void 0,void 0,function*(){}),i;switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":i=new fl({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":i=new fl({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":i=new fl({scenario:{case:"serverLeave",value:!0}});break;case"migration":i=new fl({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":r=()=>X(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),i=new fl({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":r=()=>X(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),i=new fl({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":i=new fl({scenario:{case:"switchCandidateProtocol",value:e==="force-tls"?2:1}}),r=()=>X(this,void 0,void 0,function*(){const s=this.engine.client.onLeave;s&&s(new UT({reason:xc.CLIENT_INITIATED,action:nv.RECONNECT}))});break;case"subscriber-bandwidth":if(n===void 0||typeof n!="number")throw new Error("subscriber-bandwidth requires a number as argument");i=new fl({scenario:{case:"subscriberBandwidth",value:sp(n)}});break;case"leave-full-reconnect":i=new fl({scenario:{case:"leaveRequestFullReconnect",value:!0}})}i&&(yield this.engine.client.sendSimulateScenario(i),yield r())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(e,n){return X(this,arguments,void 0,function(r,i){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return(function*(){var a,c,l,d,h,m,g;let y=!0,v=!1;const E=o?{exact:i}:i;if(r==="audioinput"){v=s.localParticipant.audioTrackPublications.size===0;const w=(a=s.getActiveDevice(r))!==null&&a!==void 0?a:s.options.audioCaptureDefaults.deviceId;s.options.audioCaptureDefaults.deviceId=E;const R=Array.from(s.localParticipant.audioTrackPublications.values()).filter(C=>C.source===pe.Source.Microphone);try{y=(yield Promise.all(R.map(C=>{var k;return(k=C.audioTrack)===null||k===void 0?void 0:k.setDeviceId(E)}))).every(C=>C===!0)}catch(C){throw s.options.audioCaptureDefaults.deviceId=w,C}const x=R.some(C=>{var k,T;return(T=(k=C.track)===null||k===void 0?void 0:k.isMuted)!==null&&T!==void 0?T:!1});y&&x&&(v=!0)}else if(r==="videoinput"){v=s.localParticipant.videoTrackPublications.size===0;const w=(c=s.getActiveDevice(r))!==null&&c!==void 0?c:s.options.videoCaptureDefaults.deviceId;s.options.videoCaptureDefaults.deviceId=E;const R=Array.from(s.localParticipant.videoTrackPublications.values()).filter(C=>C.source===pe.Source.Camera);try{y=(yield Promise.all(R.map(C=>{var k;return(k=C.videoTrack)===null||k===void 0?void 0:k.setDeviceId(E)}))).every(C=>C===!0)}catch(C){throw s.options.videoCaptureDefaults.deviceId=w,C}const x=R.some(C=>{var k,T;return(T=(k=C.track)===null||k===void 0?void 0:k.isMuted)!==null&&T!==void 0?T:!1});y&&x&&(v=!0)}else if(r==="audiooutput"){if(v=!0,!fL()&&!s.options.webAudioMix||s.options.webAudioMix&&s.audioContext&&!("setSinkId"in s.audioContext))throw new Error("cannot switch audio output, the current browser does not support it");s.options.webAudioMix&&(i=(l=yield Ni.getInstance().normalizeDeviceId("audiooutput",i))!==null&&l!==void 0?l:""),(d=(g=s.options).audioOutput)!==null&&d!==void 0||(g.audioOutput={});const w=(h=s.getActiveDevice(r))!==null&&h!==void 0?h:s.options.audioOutput.deviceId;s.options.audioOutput.deviceId=i;try{s.options.webAudioMix&&((m=s.audioContext)===null||m===void 0||m.setSinkId(i)),yield Promise.all(Array.from(s.remoteParticipants.values()).map(R=>R.setAudioOutput({deviceId:i})))}catch(R){throw s.options.audioOutput.deviceId=w,R}}return v&&(s.localParticipant.activeDeviceMap.set(r,i),s.emit(he.ActiveDeviceChanged,r,i)),y})()})}setupLocalParticipantEvents(){this.localParticipant.on(ae.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(ae.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(ae.AttributesChanged,this.onLocalAttributesChanged).on(ae.TrackMuted,this.onLocalTrackMuted).on(ae.TrackUnmuted,this.onLocalTrackUnmuted).on(ae.LocalTrackPublished,this.onLocalTrackPublished).on(ae.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(ae.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(ae.MediaDevicesError,this.onMediaDevicesError).on(ae.AudioStreamAcquired,this.startAudio).on(ae.ChatMessage,this.onLocalChatMessageSent).on(ae.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;(e=this.engine)===null||e===void 0||e.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(e,n,r){if(this.state===Xt.Connecting||this.state===Xt.Reconnecting){const h=()=>{this.log.debug("deferring on track for later",{mediaTrackId:e.id,mediaStreamId:n.id,tracksInStream:n.getTracks().map(g=>g.id)}),this.onTrackAdded(e,n,r),m()},m=()=>{this.off(he.Reconnected,h),this.off(he.Connected,h),this.off(he.Disconnected,m)};this.once(he.Reconnected,h),this.once(he.Connected,h),this.once(he.Disconnected,m);return}if(this.state===Xt.Disconnected){this.log.warn("skipping incoming track after Room disconnected",this.logContext);return}if(e.readyState==="ended"){this.log.info("skipping incoming track as it already ended",this.logContext);return}const i=d2e(n.id),s=i[0];let o=i[1],a=e.id;if(o&&o.startsWith("TR")&&(a=o),s===this.localParticipant.sid){this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);return}const c=Array.from(this.remoteParticipants.values()).find(h=>h.sid===s);if(!c){this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(s),this.logContext);return}if(!a.startsWith("TR")){const h=this.engine.getTrackIdForReceiver(r);if(!h){this.log.error("Tried to add a track whose 'sid' could not be found for a participant, that's not present. Sid: ".concat(s),this.logContext);return}a=h}a.startsWith("TR")||this.log.warn("Tried to add a track whose 'sid' could not be determined for a participant, that's not present. Sid: ".concat(s,", streamId: ").concat(o,", trackId: ").concat(a),Object.assign(Object.assign({},this.logContext),{rpID:s,streamId:o,trackId:a}));let l;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?l=this.options.adaptiveStream:l={});const d=c.addSubscribedMediaTrack(e,a,n,r,l);d?.isEncrypted&&!this.e2eeManager&&this.emit(he.EncryptionError,new Error("Encrypted ".concat(d.source," track received from participant ").concat(c.sid,", but room does not have encryption enabled!")))}handleDisconnect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,n=arguments.length>1?arguments[1]:void 0;var r;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.incomingDataStreamManager.clearControllers(),this.state!==Xt.Disconnected){this.regionUrl=void 0,this.regionUrlProvider&&this.regionUrlProvider.notifyDisconnected();try{this.remoteParticipants.forEach(i=>{i.trackPublications.forEach(s=>{i.unpublishTrack(s.trackSid)})}),this.localParticipant.trackPublications.forEach(i=>{var s,o,a;i.track&&this.localParticipant.unpublishTrack(i.track,e),e?((s=i.track)===null||s===void 0||s.detach(),(o=i.track)===null||o===void 0||o.stop()):(a=i.track)===null||a===void 0||a.stopMonitor()}),this.localParticipant.off(ae.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(ae.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(ae.AttributesChanged,this.onLocalAttributesChanged).off(ae.TrackMuted,this.onLocalTrackMuted).off(ae.TrackUnmuted,this.onLocalTrackUnmuted).off(ae.LocalTrackPublished,this.onLocalTrackPublished).off(ae.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(ae.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(ae.MediaDevicesError,this.onMediaDevicesError).off(ae.AudioStreamAcquired,this.startAudio).off(ae.ChatMessage,this.onLocalChatMessageSent).off(ae.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.webAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),co()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(r=navigator.mediaDevices)===null||r===void 0||r.removeEventListener("devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(Xt.Disconnected),this.emit(he.Disconnected,n)}}}handleParticipantDisconnected(e,n){var r;this.remoteParticipants.delete(e),n&&(this.incomingDataStreamManager.validateParticipantHasNoActiveDataStreams(e),n.trackPublications.forEach(i=>{n.unpublishTrack(i.trackSid,!0)}),this.emit(he.ParticipantDisconnected,n),n.setDisconnected(),(r=this.localParticipant)===null||r===void 0||r.handleParticipantDisconnected(n.identity))}handleIncomingRpcRequest(e,n,r,i,s,o){return X(this,void 0,void 0,function*(){if(yield this.engine.publishRpcAck(e,n),o!==1){yield this.engine.publishRpcResponse(e,n,null,Or.builtIn("UNSUPPORTED_VERSION"));return}const a=this.rpcHandlers.get(r);if(!a){yield this.engine.publishRpcResponse(e,n,null,Or.builtIn("UNSUPPORTED_METHOD"));return}let c=null,l=null;try{const d=yield a({requestId:n,callerIdentity:e,payload:i,responseTimeout:s});KP(d)>Ree?(c=Or.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),console.warn("RPC Response payload too large for ".concat(r))):l=d}catch(d){d instanceof Or?c=d:(console.warn("Uncaught error returned by RPC handler for ".concat(r,". Returning APPLICATION_ERROR instead."),d),c=Or.builtIn("APPLICATION_ERROR"))}yield this.engine.publishRpcResponse(e,n,l,c)})}selectDefaultDevices(){return X(this,void 0,void 0,function*(){var e,n,r;const i=Ni.getInstance().previousDevices,s=yield Ni.getInstance().getDevices(void 0,!1),o=ho();if(o?.name==="Chrome"&&o.os!=="iOS")for(let c of s){const l=i.find(d=>d.deviceId===c.deviceId);l&&l.label!==""&&l.kind===c.kind&&l.label!==c.label&&this.getActiveDevice(c.kind)==="default"&&this.emit(he.ActiveDeviceChanged,c.kind,c.deviceId)}const a=["audiooutput","audioinput","videoinput"];for(let c of a){const l=x2e(c),d=this.localParticipant.getTrackPublication(l);if(d&&(!((e=d.track)===null||e===void 0)&&e.isUserProvided))continue;const h=s.filter(g=>g.kind===c),m=this.getActiveDevice(c);if(m===((n=i.filter(g=>g.kind===c)[0])===null||n===void 0?void 0:n.deviceId)&&h.length>0&&((r=h[0])===null||r===void 0?void 0:r.deviceId)!==m){yield this.switchActiveDevice(c,h[0].deviceId);continue}c==="audioinput"&&!Kb()||c==="videoinput"||h.length>0&&!h.find(g=>g.deviceId===this.getActiveDevice(c))&&(c!=="audiooutput"||!Kb())&&(yield this.switchActiveDevice(c,h[0].deviceId))}})}acquireAudioContext(){return X(this,void 0,void 0,function*(){var e,n;if(typeof this.options.webAudioMix!="boolean"&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(e=_ee())!==null&&e!==void 0?e:void 0),this.options.webAudioMix&&this.remoteParticipants.forEach(i=>i.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext),this.audioContext&&this.audioContext.state==="suspended")try{yield Promise.race([this.audioContext.resume(),ns(200)])}catch(i){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:i}))}const r=((n=this.audioContext)===null||n===void 0?void 0:n.state)==="running";r!==this.canPlaybackAudio&&(this.audioEnabled=r,this.emit(he.AudioPlaybackStatusChanged,r))})}createParticipant(e,n){var r;let i;return n?i=YC.fromParticipantInfo(this.engine.client,n,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):i=new YC(this.engine.client,"",e,void 0,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&i.setAudioContext(this.audioContext),!((r=this.options.audioOutput)===null||r===void 0)&&r.deviceId&&i.setAudioOutput(this.options.audioOutput).catch(s=>this.log.warn("Could not set audio output: ".concat(s.message),this.logContext)),i}getOrCreateParticipant(e,n){if(this.remoteParticipants.has(e)){const i=this.remoteParticipants.get(e);return n&&i.updateInfo(n)&&this.sidToIdentity.set(n.sid,n.identity),i}const r=this.createParticipant(e,n);return this.remoteParticipants.set(e,r),this.sidToIdentity.set(n.sid,n.identity),this.emitWhenConnected(he.ParticipantConnected,r),r.on(ae.TrackPublished,i=>{this.emitWhenConnected(he.TrackPublished,i,r)}).on(ae.TrackSubscribed,(i,s)=>{i.kind===pe.Kind.Audio?(i.on(Ae.AudioPlaybackStarted,this.handleAudioPlaybackStarted),i.on(Ae.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):i.kind===pe.Kind.Video&&(i.on(Ae.VideoPlaybackFailed,this.handleVideoPlaybackFailed),i.on(Ae.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(he.TrackSubscribed,i,s,r)}).on(ae.TrackUnpublished,i=>{this.emit(he.TrackUnpublished,i,r)}).on(ae.TrackUnsubscribed,(i,s)=>{this.emit(he.TrackUnsubscribed,i,s,r)}).on(ae.TrackMuted,i=>{this.emitWhenConnected(he.TrackMuted,i,r)}).on(ae.TrackUnmuted,i=>{this.emitWhenConnected(he.TrackUnmuted,i,r)}).on(ae.ParticipantMetadataChanged,i=>{this.emitWhenConnected(he.ParticipantMetadataChanged,i,r)}).on(ae.ParticipantNameChanged,i=>{this.emitWhenConnected(he.ParticipantNameChanged,i,r)}).on(ae.AttributesChanged,i=>{this.emitWhenConnected(he.ParticipantAttributesChanged,i,r)}).on(ae.ConnectionQualityChanged,i=>{this.emitWhenConnected(he.ConnectionQualityChanged,i,r)}).on(ae.ParticipantPermissionsChanged,i=>{this.emitWhenConnected(he.ParticipantPermissionsChanged,i,r)}).on(ae.TrackSubscriptionStatusChanged,(i,s)=>{this.emitWhenConnected(he.TrackSubscriptionStatusChanged,i,s,r)}).on(ae.TrackSubscriptionFailed,(i,s)=>{this.emit(he.TrackSubscriptionFailed,i,r,s)}).on(ae.TrackSubscriptionPermissionChanged,(i,s)=>{this.emitWhenConnected(he.TrackSubscriptionPermissionChanged,i,s,r)}).on(ae.Active,()=>{this.emitWhenConnected(he.ParticipantActive,r),r.kind===Bb.AGENT&&this.localParticipant.setActiveAgent(r)}),n&&r.updateInfo(n),r}sendSyncState(){const e=Array.from(this.remoteParticipants.values()).reduce((r,i)=>(r.push(...i.getTrackPublications()),r),[]),n=this.localParticipant.getTrackPublications();this.engine.sendSyncState(e,n)}updateSubscriptions(){for(const e of this.remoteParticipants.values())for(const n of e.videoTrackPublications.values())n.isSubscribed&&T2e(n)&&n.emitTrackUpdate()}getRemoteParticipantBySid(e){const n=this.sidToIdentity.get(e);if(n)return this.remoteParticipants.get(n)}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=ts.setInterval(()=>{!this.engine||this.engine.isClosed||!this.engine.verifyTransport()?(e++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:e,engine:this.engine?{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}:void 0})),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,xc.STATE_MISMATCH))):e=0},qwe)}clearConnectionReconcile(){this.connectionReconcileInterval&&ts.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(e){return e===this.state?!1:(this.state=e,this.emit(he.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(e=>{let[n,r]=e;this.emit(n,...r)}),this.bufferedEvents=[]}emitWhenConnected(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];if(this.state===Xt.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([e,r]);else if(this.state===Xt.Connected)return this.emit(e,...r);return!1}simulateParticipants(e){return X(this,void 0,void 0,function*(){var n,r;const i=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),s=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants);if(this.handleDisconnect(),this.roomInfo=new OT({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:lr.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new Ap({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(he.SignalConnected),this.emit(he.Connected),this.setAndEmitConnectionState(Xt.Connected),i.video){const o=new _L(pe.Kind.Video,new Ug({source:ni.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:Tc.AUDIO,name:"video-dummy"}),new Pv(i.useRealTracks?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:KH(160*((n=s.aspectRatios[0])!==null&&n!==void 0?n:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(o),this.localParticipant.emit(ae.LocalTrackPublished,o)}if(i.audio){const o=new _L(pe.Kind.Audio,new Ug({source:ni.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:Tc.AUDIO}),new zC(i.useRealTracks?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:kx(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(o),this.localParticipant.emit(ae.LocalTrackPublished,o)}for(let o=0;o<s.count-1;o+=1){let a=new Ap({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(o),state:tv.ACTIVE,tracks:[],joinedAt:lr.parse(Date.now())});const c=this.getOrCreateParticipant(a.identity,a);if(s.video){const l=KH(160*((r=s.aspectRatios[o%s.aspectRatios.length])!==null&&r!==void 0?r:1),160,!1,!0),d=new Ug({source:ni.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:Tc.AUDIO});c.addSubscribedMediaTrack(l,d.sid,new MediaStream([l]),new RTCRtpReceiver),a.tracks=[...a.tracks,d]}if(s.audio){const l=kx(),d=new Ug({source:ni.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:Tc.AUDIO});c.addSubscribedMediaTrack(l,d.sid,new MediaStream([l]),new RTCRtpReceiver),a.tracks=[...a.tracks,d]}c.updateInfo(a)}})}emit(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];if(e!==he.ActiveSpeakersChanged&&e!==he.TranscriptionReceived){const s=Oee(r).filter(o=>o!==void 0);(e===he.TrackSubscribed||e===he.TrackUnsubscribed)&&this.log.trace("subscribe trace: ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:s})),this.log.debug("room event ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:s}))}return super.emit(e,...r)}}td.cleanupRegistry=typeof FinalizationRegistry<"u"&&new FinalizationRegistry(t=>{t()});function Oee(t){return t.map(e=>{if(e)return Array.isArray(e)?Oee(e):typeof e=="object"?"logContext"in e?e.logContext:void 0:e})}var Sc;(function(t){t[t.IDLE=0]="IDLE",t[t.RUNNING=1]="RUNNING",t[t.SKIPPED=2]="SKIPPED",t[t.SUCCESS=3]="SUCCESS",t[t.FAILED=4]="FAILED"})(Sc||(Sc={}));class ch extends jl.EventEmitter{constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=Sc.IDLE,this.logs=[],this.options={},this.url=e,this.token=n,this.name=this.constructor.name,this.room=new td(r.roomOptions),this.connectOptions=r.connectOptions,this.options=r}run(e){return X(this,void 0,void 0,function*(){if(this.status!==Sc.IDLE)throw Error("check is running already");this.setStatus(Sc.RUNNING);try{yield this.perform()}catch(n){n instanceof Error&&(this.options.errorsAsWarnings?this.appendWarning(n.message):this.appendError(n.message))}return yield this.disconnect(),yield new Promise(n=>setTimeout(n,500)),this.status!==Sc.SKIPPED&&this.setStatus(this.isSuccess()?Sc.SUCCESS:Sc.FAILED),e&&e(),this.getInfo()})}isSuccess(){return!this.logs.some(e=>e.level==="error")}connect(e){return X(this,void 0,void 0,function*(){return this.room.state===Xt.Connected?this.room:(e||(e=this.url),yield this.room.connect(e,this.token,this.connectOptions),this.room)})}disconnect(){return X(this,void 0,void 0,function*(){this.room&&this.room.state!==Xt.Disconnected&&(yield this.room.disconnect(),yield new Promise(e=>setTimeout(e,500)))})}skip(){this.setStatus(Sc.SKIPPED)}switchProtocol(e){return X(this,void 0,void 0,function*(){let n=!1,r=!1;if(this.room.on(he.Reconnecting,()=>{n=!0}),this.room.once(he.Reconnected,()=>{r=!0}),this.room.simulateScenario("force-".concat(e)),yield new Promise(s=>setTimeout(s,1e3)),!n)return;const i=Date.now()+1e4;for(;Date.now()<i;){if(r)return;yield ns(100)}throw new Error("Could not reconnect using ".concat(e," protocol after 10 seconds"))})}appendMessage(e){this.logs.push({level:"info",message:e}),this.emit("update",this.getInfo())}appendWarning(e){this.logs.push({level:"warning",message:e}),this.emit("update",this.getInfo())}appendError(e){this.logs.push({level:"error",message:e}),this.emit("update",this.getInfo())}setStatus(e){this.status=e,this.emit("update",this.getInfo())}get engine(){var e;return(e=this.room)===null||e===void 0?void 0:e.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}class Vwe extends ch{get description(){return"Cloud regions"}perform(){return X(this,void 0,void 0,function*(){const e=new fn(this.url,this.token);if(!e.isCloud()){this.skip();return}const n=[],r=new Set;for(let s=0;s<3;s++){const o=yield e.getNextBestRegionUrl();if(!o)break;if(r.has(o))continue;r.add(o);const a=yield this.checkCloudRegion(o);this.appendMessage("".concat(a.region," RTT: ").concat(a.rtt,"ms, duration: ").concat(a.duration,"ms")),n.push(a)}n.sort((s,o)=>(s.duration-o.duration)*.5+(s.rtt-o.rtt)*.5);const i=n[0];this.bestStats=i,this.appendMessage("best Cloud region: ".concat(i.region))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkCloudRegion(e){return X(this,void 0,void 0,function*(){var n,r;yield this.connect(e),this.options.protocol==="tcp"&&(yield this.switchProtocol("tcp"));const i=(n=this.room.serverInfo)===null||n===void 0?void 0:n.region;if(!i)throw new Error("Region not found");const s=yield this.room.localParticipant.streamText({topic:"test"}),o=1e3,c=1e6/o,l="A".repeat(o),d=Date.now();for(let y=0;y<c;y++)yield s.write(l);yield s.close();const h=Date.now(),m=yield(r=this.room.engine.pcManager)===null||r===void 0?void 0:r.publisher.getStats(),g={region:i,rtt:1e4,duration:h-d};return m?.forEach(y=>{y.type==="candidate-pair"&&y.nominated&&(g.rtt=y.currentRoundTripTime*1e3)}),yield this.disconnect(),g})}}const Nx=1e4;class Kwe extends ch{get description(){return"Connection via UDP vs TCP"}perform(){return X(this,void 0,void 0,function*(){const e=yield this.checkConnectionProtocol("udp"),n=yield this.checkConnectionProtocol("tcp");this.bestStats=e,e.qualityLimitationDurations.bandwidth-n.qualityLimitationDurations.bandwidth>.5||(e.packetsLost-n.packetsLost)/e.packetsSent>.01?(this.appendMessage("best connection quality via tcp"),this.bestStats=n):this.appendMessage("best connection quality via udp");const r=this.bestStats;this.appendMessage("upstream bitrate: ".concat((r.bitrateTotal/r.count/1e3/1e3).toFixed(2)," mbps")),this.appendMessage("RTT: ".concat((r.rttTotal/r.count*1e3).toFixed(2)," ms")),this.appendMessage("jitter: ".concat((r.jitterTotal/r.count*1e3).toFixed(2)," ms")),r.packetsLost>0&&this.appendWarning("packets lost: ".concat((r.packetsLost/r.packetsSent*100).toFixed(2),"%")),r.qualityLimitationDurations.bandwidth>1&&this.appendWarning("bandwidth limited ".concat((r.qualityLimitationDurations.bandwidth/(Nx/1e3)*100).toFixed(2),"%")),r.qualityLimitationDurations.cpu>0&&this.appendWarning("cpu limited ".concat((r.qualityLimitationDurations.cpu/(Nx/1e3)*100).toFixed(2),"%"))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkConnectionProtocol(e){return X(this,void 0,void 0,function*(){yield this.connect(),e==="tcp"?yield this.switchProtocol("tcp"):yield this.switchProtocol("udp");const n=document.createElement("canvas");n.width=1280,n.height=720;const r=n.getContext("2d");if(!r)throw new Error("Could not get canvas context");let i=0;const s=()=>{i=(i+1)%360,r.fillStyle="hsl(".concat(i,", 100%, 50%)"),r.fillRect(0,0,n.width,n.height),requestAnimationFrame(s)};s();const a=n.captureStream(30).getVideoTracks()[0],l=(yield this.room.localParticipant.publishTrack(a,{simulcast:!1,degradationPreference:"maintain-resolution",videoEncoding:{maxBitrate:2e6}})).track,d={protocol:e,packetsLost:0,packetsSent:0,qualityLimitationDurations:{},rttTotal:0,jitterTotal:0,bitrateTotal:0,count:0},h=setInterval(()=>X(this,void 0,void 0,function*(){const m=yield l.getRTCStatsReport();m?.forEach(g=>{g.type==="outbound-rtp"?(d.packetsSent=g.packetsSent,d.qualityLimitationDurations=g.qualityLimitationDurations,d.bitrateTotal+=g.targetBitrate,d.count++):g.type==="remote-inbound-rtp"&&(d.packetsLost=g.packetsLost,d.rttTotal+=g.roundTripTime,d.jitterTotal+=g.jitter)})}),1e3);return yield new Promise(m=>setTimeout(m,Nx)),clearInterval(h),a.stop(),n.remove(),yield this.disconnect(),d})}}class Gwe extends ch{get description(){return"Can publish audio"}perform(){return X(this,void 0,void 0,function*(){var e;const n=yield this.connect(),r=yield Fwe();if(yield bee(r,1e3))throw new Error("unable to detect audio from microphone");this.appendMessage("detected audio from microphone"),n.localParticipant.publishTrack(r),yield new Promise(a=>setTimeout(a,3e3));const s=yield(e=r.sender)===null||e===void 0?void 0:e.getStats();if(!s)throw new Error("Could not get RTCStats");let o=0;if(s.forEach(a=>{a.type==="outbound-rtp"&&(a.kind==="audio"||!a.kind&&a.mediaType==="audio")&&(o=a.packetsSent)}),o===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(o," audio packets"))})}}class zwe extends ch{get description(){return"Can publish video"}perform(){return X(this,void 0,void 0,function*(){var e;const n=yield this.connect(),r=yield jwe();yield this.checkForVideo(r.mediaStreamTrack),n.localParticipant.publishTrack(r),yield new Promise(o=>setTimeout(o,5e3));const i=yield(e=r.sender)===null||e===void 0?void 0:e.getStats();if(!i)throw new Error("Could not get RTCStats");let s=0;if(i.forEach(o=>{o.type==="outbound-rtp"&&(o.kind==="video"||!o.kind&&o.mediaType==="video")&&(s+=o.packetsSent)}),s===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(s," video packets"))})}checkForVideo(e){return X(this,void 0,void 0,function*(){const n=new MediaStream;n.addTrack(e.clone());const r=document.createElement("video");r.srcObject=n,r.muted=!0,r.autoplay=!0,r.playsInline=!0,r.setAttribute("playsinline","true"),document.body.appendChild(r),yield new Promise(i=>{r.onplay=()=>{setTimeout(()=>{var s,o,a,c;const l=document.createElement("canvas"),d=e.getSettings(),h=(o=(s=d.width)!==null&&s!==void 0?s:r.videoWidth)!==null&&o!==void 0?o:1280,m=(c=(a=d.height)!==null&&a!==void 0?a:r.videoHeight)!==null&&c!==void 0?c:720;l.width=h,l.height=m;const g=l.getContext("2d");g.drawImage(r,0,0);const v=g.getImageData(0,0,l.width,l.height).data;let E=!0;for(let w=0;w<v.length;w+=4)if(v[w]!==0||v[w+1]!==0||v[w+2]!==0){E=!1;break}E?this.appendError("camera appears to be producing only black frames"):this.appendMessage("received video frames"),i()},1e3)},r.play()}),n.getTracks().forEach(i=>i.stop()),r.remove()})}}class Wwe extends ch{get description(){return"Resuming connection after interruption"}perform(){return X(this,void 0,void 0,function*(){var e;const n=yield this.connect();let r=!1,i=!1,s;const o=new Promise(l=>{setTimeout(l,5e3),s=l}),a=()=>{r=!0};n.on(he.SignalReconnecting,a).on(he.Reconnecting,a).on(he.Reconnected,()=>{i=!0,s(!0)}),(e=n.engine.client.ws)===null||e===void 0||e.close();const c=n.engine.client.onClose;if(c&&c(""),yield o,r){if(!i||n.state!==Xt.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}else throw new Error("Did not attempt to reconnect")})}}class Ywe extends ch{get description(){return"Can connect via TURN"}perform(){return X(this,void 0,void 0,function*(){var e,n;const r=new $P,i=yield r.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3,singlePeerConnection:!1});let s=!1,o=!1,a=!1;for(let c of i.iceServers)for(let l of c.urls)l.startsWith("turn:")?(o=!0,a=!0):l.startsWith("turns:")&&(o=!0,a=!0,s=!0),l.startsWith("stun:")&&(a=!0);a?o&&!s&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield r.close(),!((n=(e=this.connectOptions)===null||e===void 0?void 0:e.rtcConfig)===null||n===void 0)&&n.iceServers||o?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(c=>setTimeout(c,0)))})}}class Xwe extends ch{get description(){return"Establishing WebRTC connection"}perform(){return X(this,void 0,void 0,function*(){let e=!1,n=!1;this.room.on(he.SignalConnected,()=>{var r;const i=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(s,o)=>{if(s.candidate){const a=new RTCIceCandidate(s);let c="".concat(a.protocol," ").concat(a.address,":").concat(a.port," ").concat(a.type);a.address&&(Jwe(a.address)?c+=" (private)":a.protocol==="tcp"&&a.tcpType==="passive"?(e=!0,c+=" (passive)"):a.protocol==="udp"&&(n=!0)),this.appendMessage(c)}i&&i(s,o)},!((r=this.room.engine.pcManager)===null||r===void 0)&&r.subscriber&&(this.room.engine.pcManager.subscriber.onIceCandidateError=s=>{s instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(s.errorCode," ").concat(s.errorText," ").concat(s.url))})});try{yield this.connect(),kt.info("now the room is connected")}catch(r){throw this.appendWarning("ports need to be open on firewall in order to connect."),r}e||this.appendWarning("Server is not configured for ICE/TCP"),n||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function Jwe(t){const e=t.split(".");if(e.length===4){if(e[0]==="10")return!0;if(e[0]==="192"&&e[1]==="168")return!0;if(e[0]==="172"){const n=parseInt(e[1],10);if(n>=16&&n<=31)return!0}}return!1}class Qwe extends ch{get description(){return"Connecting to signal connection via WebSocket"}perform(){return X(this,void 0,void 0,function*(){var e,n,r;(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let i=new $P;const s=yield i.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3,singlePeerConnection:!1});this.appendMessage("Connected to server, version ".concat(s.serverVersion,".")),((e=s.serverInfo)===null||e===void 0?void 0:e.edition)===mZ.Cloud&&(!((n=s.serverInfo)===null||n===void 0)&&n.region)&&this.appendMessage("LiveKit Cloud: ".concat((r=s.serverInfo)===null||r===void 0?void 0:r.region)),yield i.close()})}}class qot extends jl.EventEmitter{constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.options={},this.checkResults=new Map,this.url=e,this.token=n,this.options=r}getNextCheckId(){const e=this.checkResults.size;return this.checkResults.set(e,{logs:[],status:Sc.IDLE,name:"",description:""}),e}updateCheck(e,n){this.checkResults.set(e,n),this.emit("checkUpdate",e,n)}isSuccess(){return Array.from(this.checkResults.values()).every(e=>e.status!==Sc.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(e){return X(this,void 0,void 0,function*(){const n=this.getNextCheckId(),r=new e(this.url,this.token,this.options),i=o=>{this.updateCheck(n,o)};r.on("update",i);const s=yield r.run();return r.off("update",i),s})}checkWebsocket(){return X(this,void 0,void 0,function*(){return this.createAndRunCheck(Qwe)})}checkWebRTC(){return X(this,void 0,void 0,function*(){return this.createAndRunCheck(Xwe)})}checkTURN(){return X(this,void 0,void 0,function*(){return this.createAndRunCheck(Ywe)})}checkReconnect(){return X(this,void 0,void 0,function*(){return this.createAndRunCheck(Wwe)})}checkPublishAudio(){return X(this,void 0,void 0,function*(){return this.createAndRunCheck(Gwe)})}checkPublishVideo(){return X(this,void 0,void 0,function*(){return this.createAndRunCheck(zwe)})}checkConnectionProtocol(){return X(this,void 0,void 0,function*(){const e=yield this.createAndRunCheck(Kwe);if(e.data&&"protocol"in e.data){const n=e.data;this.options.protocol=n.protocol}return e})}checkCloudRegion(){return X(this,void 0,void 0,function*(){return this.createAndRunCheck(Vwe)})}}function Ht(t,e,n){return(e=eEe(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Zwe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function eEe(t){var e=Zwe(t,"string");return typeof e=="symbol"?e:e+""}new TextEncoder;new TextDecoder;class js extends Error{constructor(e,n){var r;super(e,n),Ht(this,"code","ERR_JOSE_GENERIC"),this.name=this.constructor.name,(r=Error.captureStackTrace)===null||r===void 0||r.call(Error,this,this.constructor)}}Ht(js,"code","ERR_JOSE_GENERIC");class tEe extends js{constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(e,{cause:{claim:r,reason:i,payload:n}}),Ht(this,"code","ERR_JWT_CLAIM_VALIDATION_FAILED"),Ht(this,"claim",void 0),Ht(this,"reason",void 0),Ht(this,"payload",void 0),this.claim=r,this.reason=i,this.payload=n}}Ht(tEe,"code","ERR_JWT_CLAIM_VALIDATION_FAILED");class nEe extends js{constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(e,{cause:{claim:r,reason:i,payload:n}}),Ht(this,"code","ERR_JWT_EXPIRED"),Ht(this,"claim",void 0),Ht(this,"reason",void 0),Ht(this,"payload",void 0),this.claim=r,this.reason=i,this.payload=n}}Ht(nEe,"code","ERR_JWT_EXPIRED");class rEe extends js{constructor(){super(...arguments),Ht(this,"code","ERR_JOSE_ALG_NOT_ALLOWED")}}Ht(rEe,"code","ERR_JOSE_ALG_NOT_ALLOWED");class iEe extends js{constructor(){super(...arguments),Ht(this,"code","ERR_JOSE_NOT_SUPPORTED")}}Ht(iEe,"code","ERR_JOSE_NOT_SUPPORTED");class sEe extends js{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"decryption operation failed",n=arguments.length>1?arguments[1]:void 0;super(e,n),Ht(this,"code","ERR_JWE_DECRYPTION_FAILED")}}Ht(sEe,"code","ERR_JWE_DECRYPTION_FAILED");class oEe extends js{constructor(){super(...arguments),Ht(this,"code","ERR_JWE_INVALID")}}Ht(oEe,"code","ERR_JWE_INVALID");class aEe extends js{constructor(){super(...arguments),Ht(this,"code","ERR_JWS_INVALID")}}Ht(aEe,"code","ERR_JWS_INVALID");class cEe extends js{constructor(){super(...arguments),Ht(this,"code","ERR_JWT_INVALID")}}Ht(cEe,"code","ERR_JWT_INVALID");class lEe extends js{constructor(){super(...arguments),Ht(this,"code","ERR_JWK_INVALID")}}Ht(lEe,"code","ERR_JWK_INVALID");class uEe extends js{constructor(){super(...arguments),Ht(this,"code","ERR_JWKS_INVALID")}}Ht(uEe,"code","ERR_JWKS_INVALID");class dEe extends js{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"no applicable key found in the JSON Web Key Set",n=arguments.length>1?arguments[1]:void 0;super(e,n),Ht(this,"code","ERR_JWKS_NO_MATCHING_KEY")}}Ht(dEe,"code","ERR_JWKS_NO_MATCHING_KEY");class fEe extends js{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"multiple matching keys found in the JSON Web Key Set",n=arguments.length>1?arguments[1]:void 0;super(e,n),Ht(this,Symbol.asyncIterator,void 0),Ht(this,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS")}}Ht(fEe,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS");class hEe extends js{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"request timed out",n=arguments.length>1?arguments[1]:void 0;super(e,n),Ht(this,"code","ERR_JWKS_TIMEOUT")}}Ht(hEe,"code","ERR_JWKS_TIMEOUT");class pEe extends js{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"signature verification failed",n=arguments.length>1?arguments[1]:void 0;super(e,n),Ht(this,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED")}}Ht(pEe,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED");function SL(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var n;const r=yp(t)?t.mediaStreamTrack:t,i=r.getSettings();let s={facingMode:(n=e.defaultFacingMode)!==null&&n!==void 0?n:"user",confidence:"low"};if("facingMode"in i){const o=i.facingMode;kt.trace("rawFacingMode",{rawFacingMode:o}),o&&typeof o=="string"&&vEe(o)&&(s={facingMode:o,confidence:"high"})}if(["low","medium"].includes(s.confidence)){kt.trace("Try to get facing mode from device label: (".concat(r.label,")"));const o=gEe(r.label);o!==void 0&&(s=o)}return s}const hq=new Map([["obs virtual camera",{facingMode:"environment",confidence:"medium"}]]),mEe=new Map([["iphone",{facingMode:"environment",confidence:"medium"}],["ipad",{facingMode:"environment",confidence:"medium"}]]);function gEe(t){var e;const n=t.trim().toLowerCase();if(n!=="")return hq.has(n)?hq.get(n):(e=Array.from(mEe.entries()).find(r=>{let[i]=r;return n.includes(i)}))===null||e===void 0?void 0:e[1]}function vEe(t){return t===void 0||["user","environment","left","right"].includes(t)}var pq="popstate";function yEe(t={}){function e(r,i){let{pathname:s,search:o,hash:a}=r.location;return wL("",{pathname:s,search:o,hash:a},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function n(r,i){return typeof i=="string"?i:zb(i)}return _Ee(e,n,null,t)}function vr(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Uc(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function bEe(){return Math.random().toString(36).substring(2,10)}function mq(t,e){return{usr:t.state,key:t.key,idx:e}}function wL(t,e,n=null,r){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?gy(e):e,state:n,key:e&&e.key||r||bEe()}}function zb({pathname:t="/",search:e="",hash:n=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function gy(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substring(n),t=t.substring(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substring(r),t=t.substring(0,r)),t&&(e.pathname=t)}return e}function _Ee(t,e,n,r={}){let{window:i=document.defaultView,v5Compat:s=!1}=r,o=i.history,a="POP",c=null,l=d();l==null&&(l=0,o.replaceState({...o.state,idx:l},""));function d(){return(o.state||{idx:null}).idx}function h(){a="POP";let E=d(),w=E==null?null:E-l;l=E,c&&c({action:a,location:v.location,delta:w})}function m(E,w){a="PUSH";let R=wL(v.location,E,w);l=d()+1;let x=mq(R,l),C=v.createHref(R);try{o.pushState(x,"",C)}catch(k){if(k instanceof DOMException&&k.name==="DataCloneError")throw k;i.location.assign(C)}s&&c&&c({action:a,location:v.location,delta:1})}function g(E,w){a="REPLACE";let R=wL(v.location,E,w);l=d();let x=mq(R,l),C=v.createHref(R);o.replaceState(x,"",C),s&&c&&c({action:a,location:v.location,delta:0})}function y(E){return SEe(E)}let v={get action(){return a},get location(){return t(i,o)},listen(E){if(c)throw new Error("A history only accepts one active listener");return i.addEventListener(pq,h),c=E,()=>{i.removeEventListener(pq,h),c=null}},createHref(E){return e(i,E)},createURL:y,encodeLocation(E){let w=y(E);return{pathname:w.pathname,search:w.search,hash:w.hash}},push:m,replace:g,go(E){return o.go(E)}};return v}function SEe(t,e=!1){let n="http://localhost";typeof window<"u"&&(n=window.location.origin!=="null"?window.location.origin:window.location.href),vr(n,"No window.location.(origin|href) available to create URL");let r=typeof t=="string"?t:zb(t);return r=r.replace(/ $/,"%20"),!e&&r.startsWith("//")&&(r=n+r),new URL(r,n)}function XP(t,e,n="/"){return wEe(t,e,n,!1)}function wEe(t,e,n,r){let i=typeof e=="string"?gy(e):e,s=nd(i.pathname||"/",n);if(s==null)return null;let o=Pee(t);EEe(o);let a=null;for(let c=0;a==null&&c<o.length;++c){let l=PEe(s);a=MEe(o[c],l,r)}return a}function Pee(t,e=[],n=[],r="",i=!1){let s=(o,a,c=i,l)=>{let d={relativePath:l===void 0?o.path||"":l,caseSensitive:o.caseSensitive===!0,childrenIndex:a,route:o};if(d.relativePath.startsWith("/")){if(!d.relativePath.startsWith(r)&&c)return;vr(d.relativePath.startsWith(r),`Absolute route path "${d.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),d.relativePath=d.relativePath.slice(r.length)}let h=Vu([r,d.relativePath]),m=n.concat(d);o.children&&o.children.length>0&&(vr(o.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${h}".`),Pee(o.children,e,m,h,c)),!(o.path==null&&!o.index)&&e.push({path:h,score:AEe(h,o.index),routesMeta:m})};return t.forEach((o,a)=>{if(o.path===""||!o.path?.includes("?"))s(o,a);else for(let c of Dee(o.path))s(o,a,!0,c)}),e}function Dee(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,i=n.endsWith("?"),s=n.replace(/\?$/,"");if(r.length===0)return i?[s,""]:[s];let o=Dee(r.join("/")),a=[];return a.push(...o.map(c=>c===""?s:[s,c].join("/"))),i&&a.push(...o),a.map(c=>t.startsWith("/")&&c===""?"/":c)}function EEe(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:LEe(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}var CEe=/^:[\w-]+$/,TEe=3,REe=2,kEe=1,IEe=10,xEe=-2,gq=t=>t==="*";function AEe(t,e){let n=t.split("/"),r=n.length;return n.some(gq)&&(r+=xEe),e&&(r+=REe),n.filter(i=>!gq(i)).reduce((i,s)=>i+(CEe.test(s)?TEe:s===""?kEe:IEe),r)}function LEe(t,e){return t.length===e.length&&t.slice(0,-1).every((r,i)=>r===e[i])?t[t.length-1]-e[e.length-1]:0}function MEe(t,e,n=!1){let{routesMeta:r}=t,i={},s="/",o=[];for(let a=0;a<r.length;++a){let c=r[a],l=a===r.length-1,d=s==="/"?e:e.slice(s.length)||"/",h=XC({path:c.relativePath,caseSensitive:c.caseSensitive,end:l},d),m=c.route;if(!h&&l&&n&&!r[r.length-1].route.index&&(h=XC({path:c.relativePath,caseSensitive:c.caseSensitive,end:!1},d)),!h)return null;Object.assign(i,h.params),o.push({params:i,pathname:Vu([s,h.pathname]),pathnameBase:jEe(Vu([s,h.pathnameBase])),route:m}),h.pathnameBase!=="/"&&(s=Vu([s,h.pathnameBase]))}return o}function XC(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=OEe(t.path,t.caseSensitive,t.end),i=e.match(n);if(!i)return null;let s=i[0],o=s.replace(/(.)\/+$/,"$1"),a=i.slice(1);return{params:r.reduce((l,{paramName:d,isOptional:h},m)=>{if(d==="*"){let y=a[m]||"";o=s.slice(0,s.length-y.length).replace(/(.)\/+$/,"$1")}const g=a[m];return h&&!g?l[d]=void 0:l[d]=(g||"").replace(/%2F/g,"/"),l},{}),pathname:s,pathnameBase:o,pattern:t}}function OEe(t,e=!1,n=!0){Uc(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let r=[],i="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,a,c)=>(r.push({paramName:a,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return t.endsWith("*")?(r.push({paramName:"*"}),i+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":t!==""&&t!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),r]}function PEe(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Uc(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function nd(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}var Nee=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,DEe=t=>Nee.test(t);function NEe(t,e="/"){let{pathname:n,search:r="",hash:i=""}=typeof t=="string"?gy(t):t,s;if(n)if(DEe(n))s=n;else{if(n.includes("//")){let o=n;n=n.replace(/\/\/+/g,"/"),Uc(!1,`Pathnames cannot have embedded double slashes - normalizing ${o} -> ${n}`)}n.startsWith("/")?s=vq(n.substring(1),"/"):s=vq(n,e)}else s=e;return{pathname:s,search:FEe(r),hash:$Ee(i)}}function vq(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(i=>{i===".."?n.length>1&&n.pop():i!=="."&&n.push(i)}),n.length>1?n.join("/"):"/"}function Ux(t,e,n,r){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function UEe(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function Uee(t){let e=UEe(t);return e.map((n,r)=>r===e.length-1?n.pathname:n.pathnameBase)}function jee(t,e,n,r=!1){let i;typeof t=="string"?i=gy(t):(i={...t},vr(!i.pathname||!i.pathname.includes("?"),Ux("?","pathname","search",i)),vr(!i.pathname||!i.pathname.includes("#"),Ux("#","pathname","hash",i)),vr(!i.search||!i.search.includes("#"),Ux("#","search","hash",i)));let s=t===""||i.pathname==="",o=s?"/":i.pathname,a;if(o==null)a=n;else{let h=e.length-1;if(!r&&o.startsWith("..")){let m=o.split("/");for(;m[0]==="..";)m.shift(),h-=1;i.pathname=m.join("/")}a=h>=0?e[h]:"/"}let c=NEe(i,a),l=o&&o!=="/"&&o.endsWith("/"),d=(s||o===".")&&n.endsWith("/");return!c.pathname.endsWith("/")&&(l||d)&&(c.pathname+="/"),c}var Vu=t=>t.join("/").replace(/\/\/+/g,"/"),jEe=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),FEe=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,$Ee=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t,BEe=class{constructor(t,e,n,r=!1){this.status=t,this.statusText=e||"",this.internal=r,n instanceof Error?(this.data=n.toString(),this.error=n):this.data=n}};function HEe(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}function qEe(t){return t.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var Fee=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function $ee(t,e){let n=t;if(typeof n!="string"||!Nee.test(n))return{absoluteURL:void 0,isExternal:!1,to:n};let r=n,i=!1;if(Fee)try{let s=new URL(window.location.href),o=n.startsWith("//")?new URL(s.protocol+n):new URL(n),a=nd(o.pathname,e);o.origin===s.origin&&a!=null?n=a+o.search+o.hash:i=!0}catch{Uc(!1,`<Link to="${n}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:r,isExternal:i,to:n}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var Bee=["POST","PUT","PATCH","DELETE"];new Set(Bee);var VEe=["GET",...Bee];new Set(VEe);var vy=_.createContext(null);vy.displayName="DataRouter";var $T=_.createContext(null);$T.displayName="DataRouterState";var KEe=_.createContext(!1),Hee=_.createContext({isTransitioning:!1});Hee.displayName="ViewTransition";var GEe=_.createContext(new Map);GEe.displayName="Fetchers";var zEe=_.createContext(null);zEe.displayName="Await";var tc=_.createContext(null);tc.displayName="Navigation";var yy=_.createContext(null);yy.displayName="Location";var md=_.createContext({outlet:null,matches:[],isDataRoute:!1});md.displayName="Route";var JP=_.createContext(null);JP.displayName="RouteError";var qee="REACT_ROUTER_ERROR",WEe="REDIRECT",YEe="ROUTE_ERROR_RESPONSE";function XEe(t){if(t.startsWith(`${qee}:${WEe}:{`))try{let e=JSON.parse(t.slice(28));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.location=="string"&&typeof e.reloadDocument=="boolean"&&typeof e.replace=="boolean")return e}catch{}}function JEe(t){if(t.startsWith(`${qee}:${YEe}:{`))try{let e=JSON.parse(t.slice(40));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string")return new BEe(e.status,e.statusText,e.data)}catch{}}function Vee(t,{relative:e}={}){vr(F_(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:r}=_.useContext(tc),{hash:i,pathname:s,search:o}=$_(t,{relative:e}),a=s;return n!=="/"&&(a=s==="/"?n:Vu([n,s])),r.createHref({pathname:a,search:o,hash:i})}function F_(){return _.useContext(yy)!=null}function vs(){return vr(F_(),"useLocation() may be used only in the context of a <Router> component."),_.useContext(yy).location}function QEe(){return _.useContext(yy).navigationType}var Kee="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function Gee(t){_.useContext(tc).static||_.useLayoutEffect(t)}function Fl(){let{isDataRoute:t}=_.useContext(md);return t?dCe():ZEe()}function ZEe(){vr(F_(),"useNavigate() may be used only in the context of a <Router> component.");let t=_.useContext(vy),{basename:e,navigator:n}=_.useContext(tc),{matches:r}=_.useContext(md),{pathname:i}=vs(),s=JSON.stringify(Uee(r)),o=_.useRef(!1);return Gee(()=>{o.current=!0}),_.useCallback((c,l={})=>{if(Uc(o.current,Kee),!o.current)return;if(typeof c=="number"){n.go(c);return}let d=jee(c,JSON.parse(s),i,l.relative==="path");t==null&&e!=="/"&&(d.pathname=d.pathname==="/"?e:Vu([e,d.pathname])),(l.replace?n.replace:n.push)(d,l.state,l)},[e,n,s,i,t])}_.createContext(null);function $_(t,{relative:e}={}){let{matches:n}=_.useContext(md),{pathname:r}=vs(),i=JSON.stringify(Uee(n));return _.useMemo(()=>jee(t,JSON.parse(i),r,e==="path"),[t,i,r,e])}function eCe(t,e){return zee(t,e)}function zee(t,e,n,r,i){vr(F_(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:s}=_.useContext(tc),{matches:o}=_.useContext(md),a=o[o.length-1],c=a?a.params:{},l=a?a.pathname:"/",d=a?a.pathnameBase:"/",h=a&&a.route;{let R=h&&h.path||"";Yee(l,!h||R.endsWith("*")||R.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${l}" (under <Route path="${R}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${R}"> to <Route path="${R==="/"?"*":`${R}/*`}">.`)}let m=vs(),g;if(e){let R=typeof e=="string"?gy(e):e;vr(d==="/"||R.pathname?.startsWith(d),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${d}" but pathname "${R.pathname}" was given in the \`location\` prop.`),g=R}else g=m;let y=g.pathname||"/",v=y;if(d!=="/"){let R=d.replace(/^\//,"").split("/");v="/"+y.replace(/^\//,"").split("/").slice(R.length).join("/")}let E=XP(t,{pathname:v});Uc(h||E!=null,`No routes matched location "${g.pathname}${g.search}${g.hash}" `),Uc(E==null||E[E.length-1].route.element!==void 0||E[E.length-1].route.Component!==void 0||E[E.length-1].route.lazy!==void 0,`Matched leaf route at location "${g.pathname}${g.search}${g.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let w=sCe(E&&E.map(R=>Object.assign({},R,{params:Object.assign({},c,R.params),pathname:Vu([d,s.encodeLocation?s.encodeLocation(R.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:R.pathname]),pathnameBase:R.pathnameBase==="/"?d:Vu([d,s.encodeLocation?s.encodeLocation(R.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:R.pathnameBase])})),o,n,r,i);return e&&w?_.createElement(yy.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...g},navigationType:"POP"}},w):w}function tCe(){let t=uCe(),e=HEe(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:r},s={padding:"2px 4px",backgroundColor:r},o=null;return console.error("Error handled by React Router default ErrorBoundary:",t),o=_.createElement(_.Fragment,null,_.createElement("p",null,"💿 Hey developer 👋"),_.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",_.createElement("code",{style:s},"ErrorBoundary")," or"," ",_.createElement("code",{style:s},"errorElement")," prop on your route.")),_.createElement(_.Fragment,null,_.createElement("h2",null,"Unexpected Application Error!"),_.createElement("h3",{style:{fontStyle:"italic"}},e),n?_.createElement("pre",{style:i},n):null,o)}var nCe=_.createElement(tCe,null),Wee=class extends _.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){this.props.onError?this.props.onError(t,e):console.error("React Router caught the following error during render",t)}render(){let t=this.state.error;if(this.context&&typeof t=="object"&&t&&"digest"in t&&typeof t.digest=="string"){const n=JEe(t.digest);n&&(t=n)}let e=t!==void 0?_.createElement(md.Provider,{value:this.props.routeContext},_.createElement(JP.Provider,{value:t,children:this.props.component})):this.props.children;return this.context?_.createElement(rCe,{error:t},e):e}};Wee.contextType=KEe;var jx=new WeakMap;function rCe({children:t,error:e}){let{basename:n}=_.useContext(tc);if(typeof e=="object"&&e&&"digest"in e&&typeof e.digest=="string"){let r=XEe(e.digest);if(r){let i=jx.get(e);if(i)throw i;let s=$ee(r.location,n);if(Fee&&!jx.get(e))if(s.isExternal||r.reloadDocument)window.location.href=s.absoluteURL||s.to;else{const o=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(s.to,{replace:r.replace}));throw jx.set(e,o),o}return _.createElement("meta",{httpEquiv:"refresh",content:`0;url=${s.absoluteURL||s.to}`})}}return t}function iCe({routeContext:t,match:e,children:n}){let r=_.useContext(vy);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),_.createElement(md.Provider,{value:t},n)}function sCe(t,e=[],n=null,r=null,i=null){if(t==null){if(!n)return null;if(n.errors)t=n.matches;else if(e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let s=t,o=n?.errors;if(o!=null){let d=s.findIndex(h=>h.route.id&&o?.[h.route.id]!==void 0);vr(d>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(o).join(",")}`),s=s.slice(0,Math.min(s.length,d+1))}let a=!1,c=-1;if(n)for(let d=0;d<s.length;d++){let h=s[d];if((h.route.HydrateFallback||h.route.hydrateFallbackElement)&&(c=d),h.route.id){let{loaderData:m,errors:g}=n,y=h.route.loader&&!m.hasOwnProperty(h.route.id)&&(!g||g[h.route.id]===void 0);if(h.route.lazy||y){a=!0,c>=0?s=s.slice(0,c+1):s=[s[0]];break}}}let l=n&&r?(d,h)=>{r(d,{location:n.location,params:n.matches?.[0]?.params??{},unstable_pattern:qEe(n.matches),errorInfo:h})}:void 0;return s.reduceRight((d,h,m)=>{let g,y=!1,v=null,E=null;n&&(g=o&&h.route.id?o[h.route.id]:void 0,v=h.route.errorElement||nCe,a&&(c<0&&m===0?(Yee("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),y=!0,E=null):c===m&&(y=!0,E=h.route.hydrateFallbackElement||null)));let w=e.concat(s.slice(0,m+1)),R=()=>{let x;return g?x=v:y?x=E:h.route.Component?x=_.createElement(h.route.Component,null):h.route.element?x=h.route.element:x=d,_.createElement(iCe,{match:h,routeContext:{outlet:d,matches:w,isDataRoute:n!=null},children:x})};return n&&(h.route.ErrorBoundary||h.route.errorElement||m===0)?_.createElement(Wee,{location:n.location,revalidation:n.revalidation,component:v,error:g,children:R(),routeContext:{outlet:null,matches:w,isDataRoute:!0},onError:l}):R()},null)}function QP(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function oCe(t){let e=_.useContext(vy);return vr(e,QP(t)),e}function aCe(t){let e=_.useContext($T);return vr(e,QP(t)),e}function cCe(t){let e=_.useContext(md);return vr(e,QP(t)),e}function ZP(t){let e=cCe(t),n=e.matches[e.matches.length-1];return vr(n.route.id,`${t} can only be used on routes that contain a unique "id"`),n.route.id}function lCe(){return ZP("useRouteId")}function uCe(){let t=_.useContext(JP),e=aCe("useRouteError"),n=ZP("useRouteError");return t!==void 0?t:e.errors?.[n]}function dCe(){let{router:t}=oCe("useNavigate"),e=ZP("useNavigate"),n=_.useRef(!1);return Gee(()=>{n.current=!0}),_.useCallback(async(i,s={})=>{Uc(n.current,Kee),n.current&&(typeof i=="number"?await t.navigate(i):await t.navigate(i,{fromRouteId:e,...s}))},[t,e])}var yq={};function Yee(t,e,n){!e&&!yq[t]&&(yq[t]=!0,Uc(!1,n))}_.memo(fCe);function fCe({routes:t,future:e,state:n,onError:r}){return zee(t,void 0,n,r,e)}function Xee(t){vr(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function hCe({basename:t="/",children:e=null,location:n,navigationType:r="POP",navigator:i,static:s=!1,unstable_useTransitions:o}){vr(!F_(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let a=t.replace(/^\/*/,"/"),c=_.useMemo(()=>({basename:a,navigator:i,static:s,unstable_useTransitions:o,future:{}}),[a,i,s,o]);typeof n=="string"&&(n=gy(n));let{pathname:l="/",search:d="",hash:h="",state:m=null,key:g="default"}=n,y=_.useMemo(()=>{let v=nd(l,a);return v==null?null:{location:{pathname:v,search:d,hash:h,state:m,key:g},navigationType:r}},[a,l,d,h,m,g,r]);return Uc(y!=null,`<Router basename="${a}"> is not able to match the URL "${l}${d}${h}" because it does not start with the basename, so the <Router> won't render anything.`),y==null?null:_.createElement(tc.Provider,{value:c},_.createElement(yy.Provider,{children:e,value:y}))}function pCe({children:t,location:e}){return eCe(JC(t),e)}function JC(t,e=[]){let n=[];return _.Children.forEach(t,(r,i)=>{if(!_.isValidElement(r))return;let s=[...e,i];if(r.type===_.Fragment){n.push.apply(n,JC(r.props.children,s));return}vr(r.type===Xee,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),vr(!r.props.index||!r.props.children,"An index route cannot have child routes.");let o={id:r.props.id||s.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,middleware:r.props.middleware,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(o.children=JC(r.props.children,s)),n.push(o)}),n}var PE="get",DE="application/x-www-form-urlencoded";function BT(t){return typeof HTMLElement<"u"&&t instanceof HTMLElement}function mCe(t){return BT(t)&&t.tagName.toLowerCase()==="button"}function gCe(t){return BT(t)&&t.tagName.toLowerCase()==="form"}function vCe(t){return BT(t)&&t.tagName.toLowerCase()==="input"}function yCe(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function bCe(t,e){return t.button===0&&(!e||e==="_self")&&!yCe(t)}var aw=null;function _Ce(){if(aw===null)try{new FormData(document.createElement("form"),0),aw=!1}catch{aw=!0}return aw}var SCe=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Fx(t){return t!=null&&!SCe.has(t)?(Uc(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${DE}"`),null):t}function wCe(t,e){let n,r,i,s,o;if(gCe(t)){let a=t.getAttribute("action");r=a?nd(a,e):null,n=t.getAttribute("method")||PE,i=Fx(t.getAttribute("enctype"))||DE,s=new FormData(t)}else if(mCe(t)||vCe(t)&&(t.type==="submit"||t.type==="image")){let a=t.form;if(a==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let c=t.getAttribute("formaction")||a.getAttribute("action");if(r=c?nd(c,e):null,n=t.getAttribute("formmethod")||a.getAttribute("method")||PE,i=Fx(t.getAttribute("formenctype"))||Fx(a.getAttribute("enctype"))||DE,s=new FormData(a,t),!_Ce()){let{name:l,type:d,value:h}=t;if(d==="image"){let m=l?`${l}.`:"";s.append(`${m}x`,"0"),s.append(`${m}y`,"0")}else l&&s.append(l,h)}}else{if(BT(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=PE,r=null,i=DE,o=t}return s&&i==="text/plain"&&(o=s,s=void 0),{action:r,method:n.toLowerCase(),encType:i,formData:s,body:o}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function e7(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function ECe(t,e,n){let r=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return r.pathname==="/"?r.pathname=`_root.${n}`:e&&nd(r.pathname,e)==="/"?r.pathname=`${e.replace(/\/$/,"")}/_root.${n}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${n}`,r}async function CCe(t,e){if(t.id in e)return e[t.id];try{let n=await import(t.module);return e[t.id]=n,n}catch(n){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function TCe(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function RCe(t,e,n){let r=await Promise.all(t.map(async i=>{let s=e.routes[i.route.id];if(s){let o=await CCe(s,n);return o.links?o.links():[]}return[]}));return ACe(r.flat(1).filter(TCe).filter(i=>i.rel==="stylesheet"||i.rel==="preload").map(i=>i.rel==="stylesheet"?{...i,rel:"prefetch",as:"style"}:{...i,rel:"prefetch"}))}function bq(t,e,n,r,i,s){let o=(c,l)=>n[l]?c.route.id!==n[l].route.id:!0,a=(c,l)=>n[l].pathname!==c.pathname||n[l].route.path?.endsWith("*")&&n[l].params["*"]!==c.params["*"];return s==="assets"?e.filter((c,l)=>o(c,l)||a(c,l)):s==="data"?e.filter((c,l)=>{let d=r.routes[c.route.id];if(!d||!d.hasLoader)return!1;if(o(c,l)||a(c,l))return!0;if(c.route.shouldRevalidate){let h=c.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:n[0]?.params||{},nextUrl:new URL(t,window.origin),nextParams:c.params,defaultShouldRevalidate:!0});if(typeof h=="boolean")return h}return!0}):[]}function kCe(t,e,{includeHydrateFallback:n}={}){return ICe(t.map(r=>{let i=e.routes[r.route.id];if(!i)return[];let s=[i.module];return i.clientActionModule&&(s=s.concat(i.clientActionModule)),i.clientLoaderModule&&(s=s.concat(i.clientLoaderModule)),n&&i.hydrateFallbackModule&&(s=s.concat(i.hydrateFallbackModule)),i.imports&&(s=s.concat(i.imports)),s}).flat(1))}function ICe(t){return[...new Set(t)]}function xCe(t){let e={},n=Object.keys(t).sort();for(let r of n)e[r]=t[r];return e}function ACe(t,e){let n=new Set;return new Set(e),t.reduce((r,i)=>{let s=JSON.stringify(xCe(i));return n.has(s)||(n.add(s),r.push({key:s,link:i})),r},[])}function Jee(){let t=_.useContext(vy);return e7(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function LCe(){let t=_.useContext($T);return e7(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var t7=_.createContext(void 0);t7.displayName="FrameworkContext";function Qee(){let t=_.useContext(t7);return e7(t,"You must render this element inside a <HydratedRouter> element"),t}function MCe(t,e){let n=_.useContext(t7),[r,i]=_.useState(!1),[s,o]=_.useState(!1),{onFocus:a,onBlur:c,onMouseEnter:l,onMouseLeave:d,onTouchStart:h}=e,m=_.useRef(null);_.useEffect(()=>{if(t==="render"&&o(!0),t==="viewport"){let v=w=>{w.forEach(R=>{o(R.isIntersecting)})},E=new IntersectionObserver(v,{threshold:.5});return m.current&&E.observe(m.current),()=>{E.disconnect()}}},[t]),_.useEffect(()=>{if(r){let v=setTimeout(()=>{o(!0)},100);return()=>{clearTimeout(v)}}},[r]);let g=()=>{i(!0)},y=()=>{i(!1),o(!1)};return n?t!=="intent"?[s,m,{}]:[s,m,{onFocus:t1(a,g),onBlur:t1(c,y),onMouseEnter:t1(l,g),onMouseLeave:t1(d,y),onTouchStart:t1(h,g)}]:[!1,m,{}]}function t1(t,e){return n=>{t&&t(n),n.defaultPrevented||e(n)}}function OCe({page:t,...e}){let{router:n}=Jee(),r=_.useMemo(()=>XP(n.routes,t,n.basename),[n.routes,t,n.basename]);return r?_.createElement(DCe,{page:t,matches:r,...e}):null}function PCe(t){let{manifest:e,routeModules:n}=Qee(),[r,i]=_.useState([]);return _.useEffect(()=>{let s=!1;return RCe(t,e,n).then(o=>{s||i(o)}),()=>{s=!0}},[t,e,n]),r}function DCe({page:t,matches:e,...n}){let r=vs(),{manifest:i,routeModules:s}=Qee(),{basename:o}=Jee(),{loaderData:a,matches:c}=LCe(),l=_.useMemo(()=>bq(t,e,c,i,r,"data"),[t,e,c,i,r]),d=_.useMemo(()=>bq(t,e,c,i,r,"assets"),[t,e,c,i,r]),h=_.useMemo(()=>{if(t===r.pathname+r.search+r.hash)return[];let y=new Set,v=!1;if(e.forEach(w=>{let R=i.routes[w.route.id];!R||!R.hasLoader||(!l.some(x=>x.route.id===w.route.id)&&w.route.id in a&&s[w.route.id]?.shouldRevalidate||R.hasClientLoader?v=!0:y.add(w.route.id))}),y.size===0)return[];let E=ECe(t,o,"data");return v&&y.size>0&&E.searchParams.set("_routes",e.filter(w=>y.has(w.route.id)).map(w=>w.route.id).join(",")),[E.pathname+E.search]},[o,a,r,i,l,e,t,s]),m=_.useMemo(()=>kCe(d,i),[d,i]),g=PCe(d);return _.createElement(_.Fragment,null,h.map(y=>_.createElement("link",{key:y,rel:"prefetch",as:"fetch",href:y,...n})),m.map(y=>_.createElement("link",{key:y,rel:"modulepreload",href:y,...n})),g.map(({key:y,link:v})=>_.createElement("link",{key:y,nonce:n.nonce,...v})))}function NCe(...t){return e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}var UCe=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{UCe&&(window.__reactRouterVersion="7.11.0")}catch{}function jCe({basename:t,children:e,unstable_useTransitions:n,window:r}){let i=_.useRef();i.current==null&&(i.current=yEe({window:r,v5Compat:!0}));let s=i.current,[o,a]=_.useState({action:s.action,location:s.location}),c=_.useCallback(l=>{n===!1?a(l):_.startTransition(()=>a(l))},[n]);return _.useLayoutEffect(()=>s.listen(c),[s,c]),_.createElement(hCe,{basename:t,children:e,location:o.location,navigationType:o.action,navigator:s,unstable_useTransitions:n})}var Zee=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,HT=_.forwardRef(function({onClick:e,discover:n="render",prefetch:r="none",relative:i,reloadDocument:s,replace:o,state:a,target:c,to:l,preventScrollReset:d,viewTransition:h,unstable_defaultShouldRevalidate:m,...g},y){let{basename:v,unstable_useTransitions:E}=_.useContext(tc),w=typeof l=="string"&&Zee.test(l),R=$ee(l,v);l=R.to;let x=Vee(l,{relative:i}),[C,k,T]=MCe(r,g),L=tte(l,{replace:o,state:a,target:c,preventScrollReset:d,relative:i,viewTransition:h,unstable_defaultShouldRevalidate:m,unstable_useTransitions:E});function O(D){e&&e(D),D.defaultPrevented||L(D)}let P=_.createElement("a",{...g,...T,href:R.absoluteURL||x,onClick:R.isExternal||s?e:O,ref:NCe(y,k),target:c,"data-discover":!w&&n==="render"?"true":void 0});return C&&!w?_.createElement(_.Fragment,null,P,_.createElement(OCe,{page:x})):P});HT.displayName="Link";var FCe=_.forwardRef(function({"aria-current":e="page",caseSensitive:n=!1,className:r="",end:i=!1,style:s,to:o,viewTransition:a,children:c,...l},d){let h=$_(o,{relative:l.relative}),m=vs(),g=_.useContext($T),{navigator:y,basename:v}=_.useContext(tc),E=g!=null&&GCe(h)&&a===!0,w=y.encodeLocation?y.encodeLocation(h).pathname:h.pathname,R=m.pathname,x=g&&g.navigation&&g.navigation.location?g.navigation.location.pathname:null;n||(R=R.toLowerCase(),x=x?x.toLowerCase():null,w=w.toLowerCase()),x&&v&&(x=nd(x,v)||x);const C=w!=="/"&&w.endsWith("/")?w.length-1:w.length;let k=R===w||!i&&R.startsWith(w)&&R.charAt(C)==="/",T=x!=null&&(x===w||!i&&x.startsWith(w)&&x.charAt(w.length)==="/"),L={isActive:k,isPending:T,isTransitioning:E},O=k?e:void 0,P;typeof r=="function"?P=r(L):P=[r,k?"active":null,T?"pending":null,E?"transitioning":null].filter(Boolean).join(" ");let D=typeof s=="function"?s(L):s;return _.createElement(HT,{...l,"aria-current":O,className:P,ref:d,style:D,to:o,viewTransition:a},typeof c=="function"?c(L):c)});FCe.displayName="NavLink";var $Ce=_.forwardRef(({discover:t="render",fetcherKey:e,navigate:n,reloadDocument:r,replace:i,state:s,method:o=PE,action:a,onSubmit:c,relative:l,preventScrollReset:d,viewTransition:h,unstable_defaultShouldRevalidate:m,...g},y)=>{let{unstable_useTransitions:v}=_.useContext(tc),E=VCe(),w=KCe(a,{relative:l}),R=o.toLowerCase()==="get"?"get":"post",x=typeof a=="string"&&Zee.test(a),C=k=>{if(c&&c(k),k.defaultPrevented)return;k.preventDefault();let T=k.nativeEvent.submitter,L=T?.getAttribute("formmethod")||o,O=()=>E(T||k.currentTarget,{fetcherKey:e,method:L,navigate:n,replace:i,state:s,relative:l,preventScrollReset:d,viewTransition:h,unstable_defaultShouldRevalidate:m});v&&n!==!1?_.startTransition(()=>O()):O()};return _.createElement("form",{ref:y,method:R,action:w,onSubmit:r?c:C,...g,"data-discover":!x&&t==="render"?"true":void 0})});$Ce.displayName="Form";function BCe(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function ete(t){let e=_.useContext(vy);return vr(e,BCe(t)),e}function tte(t,{target:e,replace:n,state:r,preventScrollReset:i,relative:s,viewTransition:o,unstable_defaultShouldRevalidate:a,unstable_useTransitions:c}={}){let l=Fl(),d=vs(),h=$_(t,{relative:s});return _.useCallback(m=>{if(bCe(m,e)){m.preventDefault();let g=n!==void 0?n:zb(d)===zb(h),y=()=>l(t,{replace:g,state:r,preventScrollReset:i,relative:s,viewTransition:o,unstable_defaultShouldRevalidate:a});c?_.startTransition(()=>y()):y()}},[d,l,h,n,r,e,t,i,s,o,a,c])}var HCe=0,qCe=()=>`__${String(++HCe)}__`;function VCe(){let{router:t}=ete("useSubmit"),{basename:e}=_.useContext(tc),n=lCe(),r=t.fetch,i=t.navigate;return _.useCallback(async(s,o={})=>{let{action:a,method:c,encType:l,formData:d,body:h}=wCe(s,e);if(o.navigate===!1){let m=o.fetcherKey||qCe();await r(m,n,o.action||a,{unstable_defaultShouldRevalidate:o.unstable_defaultShouldRevalidate,preventScrollReset:o.preventScrollReset,formData:d,body:h,formMethod:o.method||c,formEncType:o.encType||l,flushSync:o.flushSync})}else await i(o.action||a,{unstable_defaultShouldRevalidate:o.unstable_defaultShouldRevalidate,preventScrollReset:o.preventScrollReset,formData:d,body:h,formMethod:o.method||c,formEncType:o.encType||l,replace:o.replace,state:o.state,fromRouteId:n,flushSync:o.flushSync,viewTransition:o.viewTransition})},[r,i,e,n])}function KCe(t,{relative:e}={}){let{basename:n}=_.useContext(tc),r=_.useContext(md);vr(r,"useFormAction must be used inside a RouteContext");let[i]=r.matches.slice(-1),s={...$_(t||".",{relative:e})},o=vs();if(t==null){s.search=o.search;let a=new URLSearchParams(s.search),c=a.getAll("index");if(c.some(d=>d==="")){a.delete("index"),c.filter(h=>h).forEach(h=>a.append("index",h));let d=a.toString();s.search=d?`?${d}`:""}}return(!t||t===".")&&i.route.index&&(s.search=s.search?s.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(s.pathname=s.pathname==="/"?n:Vu([n,s.pathname])),zb(s)}function GCe(t,{relative:e}={}){let n=_.useContext(Hee);vr(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=ete("useViewTransitionState"),i=$_(t,{relative:e});if(!n.isTransitioning)return!1;let s=nd(n.currentLocation.pathname,r)||n.currentLocation.pathname,o=nd(n.nextLocation.pathname,r)||n.nextLocation.pathname;return XC(i.pathname,o)!=null||XC(i.pathname,s)!=null}var em=BQ();const nte=Dl(em),Lt=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,bp="8.55.0",cn=globalThis;function qT(t,e,n){const r=n||cn,i=r.__SENTRY__=r.__SENTRY__||{},s=i[bp]=i[bp]||{};return s[t]||(s[t]=e())}const lh=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,zCe="Sentry Logger ",EL=["debug","info","warn","error","log","assert","trace"],QC={};function tm(t){if(!("console"in cn))return t();const e=cn.console,n={},r=Object.keys(QC);r.forEach(i=>{const s=QC[i];n[i]=e[i],e[i]=s});try{return t()}finally{r.forEach(i=>{e[i]=n[i]})}}function WCe(){let t=!1;const e={enable:()=>{t=!0},disable:()=>{t=!1},isEnabled:()=>t};return lh?EL.forEach(n=>{e[n]=(...r)=>{t&&tm(()=>{cn.console[n](`${zCe}[${n}]:`,...r)})}}):EL.forEach(n=>{e[n]=()=>{}}),e}const je=qT("logger",WCe),rte=50,Op="?",_q=/\(error: (.*)\)/,Sq=/captureMessage|captureException/;function ite(...t){const e=t.sort((n,r)=>n[0]-r[0]).map(n=>n[1]);return(n,r=0,i=0)=>{const s=[],o=n.split(`
`);for(let a=r;a<o.length;a++){const c=o[a];if(c.length>1024)continue;const l=_q.test(c)?c.replace(_q,"$1"):c;if(!l.match(/\S*Error: /)){for(const d of e){const h=d(l);if(h){s.push(h);break}}if(s.length>=rte+i)break}}return XCe(s.slice(i))}}function YCe(t){return Array.isArray(t)?ite(...t):t}function XCe(t){if(!t.length)return[];const e=Array.from(t);return/sentryWrapped/.test(cw(e).function||"")&&e.pop(),e.reverse(),Sq.test(cw(e).function||"")&&(e.pop(),Sq.test(cw(e).function||"")&&e.pop()),e.slice(0,rte).map(n=>({...n,filename:n.filename||cw(e).filename,function:n.function||Op}))}function cw(t){return t[t.length-1]||{}}const $x="<anonymous>";function rd(t){try{return!t||typeof t!="function"?$x:t.name||$x}catch{return $x}}function wq(t){const e=t.exception;if(e){const n=[];try{return e.values.forEach(r=>{r.stacktrace.frames&&n.push(...r.stacktrace.frames)}),n}catch{return}}}const NE={},Eq={};function uh(t,e){NE[t]=NE[t]||[],NE[t].push(e)}function dh(t,e){if(!Eq[t]){Eq[t]=!0;try{e()}catch(n){lh&&je.error(`Error while instrumenting ${t}`,n)}}}function Ba(t,e){const n=t&&NE[t];if(n)for(const r of n)try{r(e)}catch(i){lh&&je.error(`Error while triggering instrumentation handler.
Type: ${t}
Name: ${rd(r)}
Error:`,i)}}let Bx=null;function ste(t){const e="error";uh(e,t),dh(e,JCe)}function JCe(){Bx=cn.onerror,cn.onerror=function(t,e,n,r,i){return Ba("error",{column:r,error:i,line:n,msg:t,url:e}),Bx?Bx.apply(this,arguments):!1},cn.onerror.__SENTRY_INSTRUMENTED__=!0}let Hx=null;function ote(t){const e="unhandledrejection";uh(e,t),dh(e,QCe)}function QCe(){Hx=cn.onunhandledrejection,cn.onunhandledrejection=function(t){return Ba("unhandledrejection",t),Hx?Hx.apply(this,arguments):!0},cn.onunhandledrejection.__SENTRY_INSTRUMENTED__=!0}function nm(){return n7(cn),cn}function n7(t){const e=t.__SENTRY__=t.__SENTRY__||{};return e.version=e.version||bp,e[bp]=e[bp]||{}}const ate=Object.prototype.toString;function VT(t){switch(ate.call(t)){case"[object Error]":case"[object Exception]":case"[object DOMException]":case"[object WebAssembly.Exception]":return!0;default:return id(t,Error)}}function by(t,e){return ate.call(t)===`[object ${e}]`}function cte(t){return by(t,"ErrorEvent")}function Cq(t){return by(t,"DOMError")}function ZCe(t){return by(t,"DOMException")}function Ku(t){return by(t,"String")}function r7(t){return typeof t=="object"&&t!==null&&"__sentry_template_string__"in t&&"__sentry_template_values__"in t}function i7(t){return t===null||r7(t)||typeof t!="object"&&typeof t!="function"}function Dv(t){return by(t,"Object")}function KT(t){return typeof Event<"u"&&id(t,Event)}function e3e(t){return typeof Element<"u"&&id(t,Element)}function t3e(t){return by(t,"RegExp")}function GT(t){return!!(t&&t.then&&typeof t.then=="function")}function n3e(t){return Dv(t)&&"nativeEvent"in t&&"preventDefault"in t&&"stopPropagation"in t}function id(t,e){try{return t instanceof e}catch{return!1}}function lte(t){return!!(typeof t=="object"&&t!==null&&(t.__isVue||t._isVue))}const av=cn,r3e=80;function Pp(t,e={}){if(!t)return"<unknown>";try{let n=t;const r=5,i=[];let s=0,o=0;const a=" > ",c=a.length;let l;const d=Array.isArray(e)?e:e.keyAttrs,h=!Array.isArray(e)&&e.maxStringLength||r3e;for(;n&&s++<r&&(l=i3e(n,d),!(l==="html"||s>1&&o+i.length*c+l.length>=h));)i.push(l),o+=l.length,n=n.parentNode;return i.reverse().join(a)}catch{return"<unknown>"}}function i3e(t,e){const n=t,r=[];if(!n||!n.tagName)return"";if(av.HTMLElement&&n instanceof HTMLElement&&n.dataset){if(n.dataset.sentryComponent)return n.dataset.sentryComponent;if(n.dataset.sentryElement)return n.dataset.sentryElement}r.push(n.tagName.toLowerCase());const i=e&&e.length?e.filter(o=>n.getAttribute(o)).map(o=>[o,n.getAttribute(o)]):null;if(i&&i.length)i.forEach(o=>{r.push(`[${o[0]}="${o[1]}"]`)});else{n.id&&r.push(`#${n.id}`);const o=n.className;if(o&&Ku(o)){const a=o.split(/\s+/);for(const c of a)r.push(`.${c}`)}}const s=["aria-label","type","name","title","alt"];for(const o of s){const a=n.getAttribute(o);a&&r.push(`[${o}="${a}"]`)}return r.join("")}function s3e(){try{return av.document.location.href}catch{return""}}function o3e(t){return av.document&&av.document.querySelector?av.document.querySelector(t):null}function ute(t){if(!av.HTMLElement)return null;let e=t;const n=5;for(let r=0;r<n;r++){if(!e)return null;if(e instanceof HTMLElement){if(e.dataset.sentryComponent)return e.dataset.sentryComponent;if(e.dataset.sentryElement)return e.dataset.sentryElement}e=e.parentNode}return null}function cv(t,e=0){return typeof t!="string"||e===0||t.length<=e?t:`${t.slice(0,e)}...`}function Tq(t,e){if(!Array.isArray(t))return"";const n=[];for(let r=0;r<t.length;r++){const i=t[r];try{lte(i)?n.push("[VueViewModel]"):n.push(String(i))}catch{n.push("[value cannot be serialized]")}}return n.join(e)}function a3e(t,e,n=!1){return Ku(t)?t3e(e)?e.test(t):Ku(e)?n?t===e:t.includes(e):!1:!1}function _p(t,e=[],n=!1){return e.some(r=>a3e(t,r,n))}function Jo(t,e,n){if(!(e in t))return;const r=t[e],i=n(r);typeof i=="function"&&dte(i,r);try{t[e]=i}catch{lh&&je.log(`Failed to replace method "${e}" in object`,t)}}function Wa(t,e,n){try{Object.defineProperty(t,e,{value:n,writable:!0,configurable:!0})}catch{lh&&je.log(`Failed to add non-enumerable property "${e}" to object`,t)}}function dte(t,e){try{const n=e.prototype||{};t.prototype=e.prototype=n,Wa(t,"__sentry_original__",e)}catch{}}function s7(t){return t.__sentry_original__}function fte(t){if(VT(t))return{message:t.message,name:t.name,stack:t.stack,...kq(t)};if(KT(t)){const e={type:t.type,target:Rq(t.target),currentTarget:Rq(t.currentTarget),...kq(t)};return typeof CustomEvent<"u"&&id(t,CustomEvent)&&(e.detail=t.detail),e}else return t}function Rq(t){try{return e3e(t)?Pp(t):Object.prototype.toString.call(t)}catch{return"<unknown>"}}function kq(t){if(typeof t=="object"&&t!==null){const e={};for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}else return{}}function c3e(t,e=40){const n=Object.keys(fte(t));n.sort();const r=n[0];if(!r)return"[object has no keys]";if(r.length>=e)return cv(r,e);for(let i=n.length;i>0;i--){const s=n.slice(0,i).join(", ");if(!(s.length>e))return i===n.length?s:cv(s,e)}return""}function rs(t){return CL(t,new Map)}function CL(t,e){if(l3e(t)){const n=e.get(t);if(n!==void 0)return n;const r={};e.set(t,r);for(const i of Object.getOwnPropertyNames(t))typeof t[i]<"u"&&(r[i]=CL(t[i],e));return r}if(Array.isArray(t)){const n=e.get(t);if(n!==void 0)return n;const r=[];return e.set(t,r),t.forEach(i=>{r.push(CL(i,e))}),r}return t}function l3e(t){if(!Dv(t))return!1;try{const e=Object.getPrototypeOf(t).constructor.name;return!e||e==="Object"}catch{return!0}}const hte=1e3;function B_(){return Date.now()/hte}function u3e(){const{performance:t}=cn;if(!t||!t.now)return B_;const e=Date.now()-t.now(),n=t.timeOrigin==null?e:t.timeOrigin;return()=>(n+t.now())/hte}const Ds=u3e(),bo=(()=>{const{performance:t}=cn;if(!t||!t.now)return;const e=3600*1e3,n=t.now(),r=Date.now(),i=t.timeOrigin?Math.abs(t.timeOrigin+n-r):e,s=i<e,o=t.timing&&t.timing.navigationStart,c=typeof o=="number"?Math.abs(o+n-r):e,l=c<e;return s||l?i<=c?t.timeOrigin:o:r})();function Ha(){const t=cn,e=t.crypto||t.msCrypto;let n=()=>Math.random()*16;try{if(e&&e.randomUUID)return e.randomUUID().replace(/-/g,"");e&&e.getRandomValues&&(n=()=>{const r=new Uint8Array(1);return e.getRandomValues(r),r[0]})}catch{}return("10000000100040008000"+1e11).replace(/[018]/g,r=>(r^(n()&15)>>r/4).toString(16))}function pte(t){return t.exception&&t.exception.values?t.exception.values[0]:void 0}function df(t){const{message:e,event_id:n}=t;if(e)return e;const r=pte(t);return r?r.type&&r.value?`${r.type}: ${r.value}`:r.type||r.value||n||"<unknown>":n||"<unknown>"}function TL(t,e,n){const r=t.exception=t.exception||{},i=r.values=r.values||[],s=i[0]=i[0]||{};s.value||(s.value=e||""),s.type||(s.type="Error")}function Nv(t,e){const n=pte(t);if(!n)return;const r={type:"generic",handled:!0},i=n.mechanism;if(n.mechanism={...r,...i,...e},e&&"data"in e){const s={...i&&i.data,...e.data};n.mechanism.data=s}}function Iq(t){if(d3e(t))return!0;try{Wa(t,"__sentry_captured__",!0)}catch{}return!1}function d3e(t){try{return t.__sentry_captured__}catch{}}var bu;(function(t){t[t.PENDING=0]="PENDING";const n=1;t[t.RESOLVED=n]="RESOLVED";const r=2;t[t.REJECTED=r]="REJECTED"})(bu||(bu={}));function Dp(t){return new xa(e=>{e(t)})}function ZC(t){return new xa((e,n)=>{n(t)})}class xa{constructor(e){xa.prototype.__init.call(this),xa.prototype.__init2.call(this),xa.prototype.__init3.call(this),xa.prototype.__init4.call(this),this._state=bu.PENDING,this._handlers=[];try{e(this._resolve,this._reject)}catch(n){this._reject(n)}}then(e,n){return new xa((r,i)=>{this._handlers.push([!1,s=>{if(!e)r(s);else try{r(e(s))}catch(o){i(o)}},s=>{if(!n)i(s);else try{r(n(s))}catch(o){i(o)}}]),this._executeHandlers()})}catch(e){return this.then(n=>n,e)}finally(e){return new xa((n,r)=>{let i,s;return this.then(o=>{s=!1,i=o,e&&e()},o=>{s=!0,i=o,e&&e()}).then(()=>{if(s){r(i);return}n(i)})})}__init(){this._resolve=e=>{this._setResult(bu.RESOLVED,e)}}__init2(){this._reject=e=>{this._setResult(bu.REJECTED,e)}}__init3(){this._setResult=(e,n)=>{if(this._state===bu.PENDING){if(GT(n)){n.then(this._resolve,this._reject);return}this._state=e,this._value=n,this._executeHandlers()}}}__init4(){this._executeHandlers=()=>{if(this._state===bu.PENDING)return;const e=this._handlers.slice();this._handlers=[],e.forEach(n=>{n[0]||(this._state===bu.RESOLVED&&n[1](this._value),this._state===bu.REJECTED&&n[2](this._value),n[0]=!0)})}}}function f3e(t){const e=Ds(),n={sid:Ha(),init:!0,timestamp:e,started:e,duration:0,status:"ok",errors:0,ignoreDuration:!1,toJSON:()=>p3e(n)};return t&&Uv(n,t),n}function Uv(t,e={}){if(e.user&&(!t.ipAddress&&e.user.ip_address&&(t.ipAddress=e.user.ip_address),!t.did&&!e.did&&(t.did=e.user.id||e.user.email||e.user.username)),t.timestamp=e.timestamp||Ds(),e.abnormal_mechanism&&(t.abnormal_mechanism=e.abnormal_mechanism),e.ignoreDuration&&(t.ignoreDuration=e.ignoreDuration),e.sid&&(t.sid=e.sid.length===32?e.sid:Ha()),e.init!==void 0&&(t.init=e.init),!t.did&&e.did&&(t.did=`${e.did}`),typeof e.started=="number"&&(t.started=e.started),t.ignoreDuration)t.duration=void 0;else if(typeof e.duration=="number")t.duration=e.duration;else{const n=t.timestamp-t.started;t.duration=n>=0?n:0}e.release&&(t.release=e.release),e.environment&&(t.environment=e.environment),!t.ipAddress&&e.ipAddress&&(t.ipAddress=e.ipAddress),!t.userAgent&&e.userAgent&&(t.userAgent=e.userAgent),typeof e.errors=="number"&&(t.errors=e.errors),e.status&&(t.status=e.status)}function h3e(t,e){let n={};t.status==="ok"&&(n={status:"exited"}),Uv(t,n)}function p3e(t){return rs({sid:`${t.sid}`,init:t.init,started:new Date(t.started*1e3).toISOString(),timestamp:new Date(t.timestamp*1e3).toISOString(),status:t.status,errors:t.errors,did:typeof t.did=="number"||typeof t.did=="string"?`${t.did}`:void 0,duration:t.duration,abnormal_mechanism:t.abnormal_mechanism,attrs:{release:t.release,environment:t.environment,ip_address:t.ipAddress,user_agent:t.userAgent}})}function Gf(){return Ha()}function zf(){return Ha().substring(16)}function zT(t,e,n=2){if(!e||typeof e!="object"||n<=0)return e;if(t&&e&&Object.keys(e).length===0)return t;const r={...t};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=zT(r[i],e[i],n-1));return r}const RL="_sentrySpan";function Wb(t,e){e?Wa(t,RL,e):delete t[RL]}function e3(t){return t[RL]}const m3e=100;class o7{constructor(){this._notifyingListeners=!1,this._scopeListeners=[],this._eventProcessors=[],this._breadcrumbs=[],this._attachments=[],this._user={},this._tags={},this._extra={},this._contexts={},this._sdkProcessingMetadata={},this._propagationContext={traceId:Gf(),spanId:zf()}}clone(){const e=new o7;return e._breadcrumbs=[...this._breadcrumbs],e._tags={...this._tags},e._extra={...this._extra},e._contexts={...this._contexts},this._contexts.flags&&(e._contexts.flags={values:[...this._contexts.flags.values]}),e._user=this._user,e._level=this._level,e._session=this._session,e._transactionName=this._transactionName,e._fingerprint=this._fingerprint,e._eventProcessors=[...this._eventProcessors],e._requestSession=this._requestSession,e._attachments=[...this._attachments],e._sdkProcessingMetadata={...this._sdkProcessingMetadata},e._propagationContext={...this._propagationContext},e._client=this._client,e._lastEventId=this._lastEventId,Wb(e,e3(this)),e}setClient(e){this._client=e}setLastEventId(e){this._lastEventId=e}getClient(){return this._client}lastEventId(){return this._lastEventId}addScopeListener(e){this._scopeListeners.push(e)}addEventProcessor(e){return this._eventProcessors.push(e),this}setUser(e){return this._user=e||{email:void 0,id:void 0,ip_address:void 0,username:void 0},this._session&&Uv(this._session,{user:e}),this._notifyScopeListeners(),this}getUser(){return this._user}getRequestSession(){return this._requestSession}setRequestSession(e){return this._requestSession=e,this}setTags(e){return this._tags={...this._tags,...e},this._notifyScopeListeners(),this}setTag(e,n){return this._tags={...this._tags,[e]:n},this._notifyScopeListeners(),this}setExtras(e){return this._extra={...this._extra,...e},this._notifyScopeListeners(),this}setExtra(e,n){return this._extra={...this._extra,[e]:n},this._notifyScopeListeners(),this}setFingerprint(e){return this._fingerprint=e,this._notifyScopeListeners(),this}setLevel(e){return this._level=e,this._notifyScopeListeners(),this}setTransactionName(e){return this._transactionName=e,this._notifyScopeListeners(),this}setContext(e,n){return n===null?delete this._contexts[e]:this._contexts[e]=n,this._notifyScopeListeners(),this}setSession(e){return e?this._session=e:delete this._session,this._notifyScopeListeners(),this}getSession(){return this._session}update(e){if(!e)return this;const n=typeof e=="function"?e(this):e,[r,i]=n instanceof Wf?[n.getScopeData(),n.getRequestSession()]:Dv(n)?[e,e.requestSession]:[],{tags:s,extra:o,user:a,contexts:c,level:l,fingerprint:d=[],propagationContext:h}=r||{};return this._tags={...this._tags,...s},this._extra={...this._extra,...o},this._contexts={...this._contexts,...c},a&&Object.keys(a).length&&(this._user=a),l&&(this._level=l),d.length&&(this._fingerprint=d),h&&(this._propagationContext=h),i&&(this._requestSession=i),this}clear(){return this._breadcrumbs=[],this._tags={},this._extra={},this._user={},this._contexts={},this._level=void 0,this._transactionName=void 0,this._fingerprint=void 0,this._requestSession=void 0,this._session=void 0,Wb(this,void 0),this._attachments=[],this.setPropagationContext({traceId:Gf()}),this._notifyScopeListeners(),this}addBreadcrumb(e,n){const r=typeof n=="number"?n:m3e;if(r<=0)return this;const i={timestamp:B_(),...e};return this._breadcrumbs.push(i),this._breadcrumbs.length>r&&(this._breadcrumbs=this._breadcrumbs.slice(-r),this._client&&this._client.recordDroppedEvent("buffer_overflow","log_item")),this._notifyScopeListeners(),this}getLastBreadcrumb(){return this._breadcrumbs[this._breadcrumbs.length-1]}clearBreadcrumbs(){return this._breadcrumbs=[],this._notifyScopeListeners(),this}addAttachment(e){return this._attachments.push(e),this}clearAttachments(){return this._attachments=[],this}getScopeData(){return{breadcrumbs:this._breadcrumbs,attachments:this._attachments,contexts:this._contexts,tags:this._tags,extra:this._extra,user:this._user,level:this._level,fingerprint:this._fingerprint||[],eventProcessors:this._eventProcessors,propagationContext:this._propagationContext,sdkProcessingMetadata:this._sdkProcessingMetadata,transactionName:this._transactionName,span:e3(this)}}setSDKProcessingMetadata(e){return this._sdkProcessingMetadata=zT(this._sdkProcessingMetadata,e,2),this}setPropagationContext(e){return this._propagationContext={spanId:zf(),...e},this}getPropagationContext(){return this._propagationContext}captureException(e,n){const r=n&&n.event_id?n.event_id:Ha();if(!this._client)return je.warn("No client configured on scope - will not capture exception!"),r;const i=new Error("Sentry syntheticException");return this._client.captureException(e,{originalException:e,syntheticException:i,...n,event_id:r},this),r}captureMessage(e,n,r){const i=r&&r.event_id?r.event_id:Ha();if(!this._client)return je.warn("No client configured on scope - will not capture message!"),i;const s=new Error(e);return this._client.captureMessage(e,n,{originalException:e,syntheticException:s,...r,event_id:i},this),i}captureEvent(e,n){const r=n&&n.event_id?n.event_id:Ha();return this._client?(this._client.captureEvent(e,{...n,event_id:r},this),r):(je.warn("No client configured on scope - will not capture event!"),r)}_notifyScopeListeners(){this._notifyingListeners||(this._notifyingListeners=!0,this._scopeListeners.forEach(e=>{e(this)}),this._notifyingListeners=!1)}}const Wf=o7;function g3e(){return qT("defaultCurrentScope",()=>new Wf)}function v3e(){return qT("defaultIsolationScope",()=>new Wf)}class y3e{constructor(e,n){let r;e?r=e:r=new Wf;let i;n?i=n:i=new Wf,this._stack=[{scope:r}],this._isolationScope=i}withScope(e){const n=this._pushScope();let r;try{r=e(n)}catch(i){throw this._popScope(),i}return GT(r)?r.then(i=>(this._popScope(),i),i=>{throw this._popScope(),i}):(this._popScope(),r)}getClient(){return this.getStackTop().client}getScope(){return this.getStackTop().scope}getIsolationScope(){return this._isolationScope}getStackTop(){return this._stack[this._stack.length-1]}_pushScope(){const e=this.getScope().clone();return this._stack.push({client:this.getClient(),scope:e}),e}_popScope(){return this._stack.length<=1?!1:!!this._stack.pop()}}function jv(){const t=nm(),e=n7(t);return e.stack=e.stack||new y3e(g3e(),v3e())}function b3e(t){return jv().withScope(t)}function _3e(t,e){const n=jv();return n.withScope(()=>(n.getStackTop().scope=t,e(t)))}function xq(t){return jv().withScope(()=>t(jv().getIsolationScope()))}function S3e(){return{withIsolationScope:xq,withScope:b3e,withSetScope:_3e,withSetIsolationScope:(t,e)=>xq(e),getCurrentScope:()=>jv().getScope(),getIsolationScope:()=>jv().getIsolationScope()}}function _y(t){const e=n7(t);return e.acs?e.acs:S3e()}function Kn(){const t=nm();return _y(t).getCurrentScope()}function $l(){const t=nm();return _y(t).getIsolationScope()}function w3e(){return qT("globalScope",()=>new Wf)}function WT(...t){const e=nm(),n=_y(e);if(t.length===2){const[r,i]=t;return r?n.withSetScope(r,i):n.withScope(i)}return n.withScope(t[0])}function mn(){return Kn().getClient()}function E3e(t){const e=t.getPropagationContext(),{traceId:n,spanId:r,parentSpanId:i}=e;return rs({trace_id:n,span_id:r,parent_span_id:i})}const C3e="_sentryMetrics";function kL(t){const e=t[C3e];if(!e)return;const n={};for(const[,[r,i]]of e)(n[r]||(n[r]=[])).push(rs(i));return n}const Ua="sentry.source",mte="sentry.sample_rate",sd="sentry.op",ai="sentry.origin",IL="sentry.idle_span_finish_reason",YT="sentry.measurement_unit",XT="sentry.measurement_value",Aq="sentry.custom_span_name",T3e="sentry.profile_id",a7="sentry.exclusive_time",R3e=0,gte=1,Ai=2;function k3e(t){if(t<400&&t>=100)return{code:gte};if(t>=400&&t<500)switch(t){case 401:return{code:Ai,message:"unauthenticated"};case 403:return{code:Ai,message:"permission_denied"};case 404:return{code:Ai,message:"not_found"};case 409:return{code:Ai,message:"already_exists"};case 413:return{code:Ai,message:"failed_precondition"};case 429:return{code:Ai,message:"resource_exhausted"};case 499:return{code:Ai,message:"cancelled"};default:return{code:Ai,message:"invalid_argument"}}if(t>=500&&t<600)switch(t){case 501:return{code:Ai,message:"unimplemented"};case 503:return{code:Ai,message:"unavailable"};case 504:return{code:Ai,message:"deadline_exceeded"};default:return{code:Ai,message:"internal_error"}}return{code:Ai,message:"unknown_error"}}function vte(t,e){t.setAttribute("http.response.status_code",e);const n=k3e(e);n.message!=="unknown_error"&&t.setStatus(n)}const c7="sentry-",I3e=/^sentry-/,x3e=8192;function yte(t){const e=L3e(t);if(!e)return;const n=Object.entries(e).reduce((r,[i,s])=>{if(i.match(I3e)){const o=i.slice(c7.length);r[o]=s}return r},{});if(Object.keys(n).length>0)return n}function A3e(t){if(!t)return;const e=Object.entries(t).reduce((n,[r,i])=>(i&&(n[`${c7}${r}`]=i),n),{});return M3e(e)}function L3e(t){if(!(!t||!Ku(t)&&!Array.isArray(t)))return Array.isArray(t)?t.reduce((e,n)=>{const r=Lq(n);return Object.entries(r).forEach(([i,s])=>{e[i]=s}),e},{}):Lq(t)}function Lq(t){return t.split(",").map(e=>e.split("=").map(n=>decodeURIComponent(n.trim()))).reduce((e,[n,r])=>(n&&r&&(e[n]=r),e),{})}function M3e(t){if(Object.keys(t).length!==0)return Object.entries(t).reduce((e,[n,r],i)=>{const s=`${encodeURIComponent(n)}=${encodeURIComponent(r)}`,o=i===0?s:`${e},${s}`;return o.length>x3e?(lh&&je.warn(`Not adding key: ${n} with val: ${r} to baggage header due to exceeding baggage size limits.`),e):o},"")}const bte=new RegExp("^[ \\t]*([0-9a-f]{32})?-?([0-9a-f]{16})?-?([01])?[ \\t]*$");function O3e(t){if(!t)return;const e=t.match(bte);if(!e)return;let n;return e[3]==="1"?n=!0:e[3]==="0"&&(n=!1),{traceId:e[1],parentSampled:n,parentSpanId:e[2]}}function P3e(t,e){const n=O3e(t),r=yte(e);if(!n||!n.traceId)return{traceId:Gf(),spanId:zf()};const{traceId:i,parentSpanId:s,parentSampled:o}=n,a=zf();return{traceId:i,parentSpanId:s,spanId:a,sampled:o,dsc:r||{}}}function _te(t=Gf(),e=zf(),n){let r="";return n!==void 0&&(r=n?"-1":"-0"),`${t}-${e}${r}`}const Ste=0,wte=1;let Mq=!1;function D3e(t){const{spanId:e,traceId:n}=t.spanContext(),{data:r,op:i,parent_span_id:s,status:o,origin:a}=hn(t);return rs({parent_span_id:s,span_id:e,trace_id:n,data:r,op:i,status:o,origin:a})}function N3e(t){const{spanId:e,traceId:n,isRemote:r}=t.spanContext(),i=r?e:hn(t).parent_span_id,s=r?zf():e;return rs({parent_span_id:i,span_id:s,trace_id:n})}function U3e(t){const{traceId:e,spanId:n}=t.spanContext(),r=rm(t);return _te(e,n,r)}function Sp(t){return typeof t=="number"?Oq(t):Array.isArray(t)?t[0]+t[1]/1e9:t instanceof Date?Oq(t.getTime()):Ds()}function Oq(t){return t>9999999999?t/1e3:t}function hn(t){if(F3e(t))return t.getSpanJSON();try{const{spanId:e,traceId:n}=t.spanContext();if(j3e(t)){const{attributes:r,startTime:i,name:s,endTime:o,parentSpanId:a,status:c}=t;return rs({span_id:e,trace_id:n,data:r,description:s,parent_span_id:a,start_timestamp:Sp(i),timestamp:Sp(o)||void 0,status:Ete(c),op:r[sd],origin:r[ai],_metrics_summary:kL(t)})}return{span_id:e,trace_id:n}}catch{return{}}}function j3e(t){const e=t;return!!e.attributes&&!!e.startTime&&!!e.name&&!!e.endTime&&!!e.status}function F3e(t){return typeof t.getSpanJSON=="function"}function rm(t){const{traceFlags:e}=t.spanContext();return e===wte}function Ete(t){if(!(!t||t.code===R3e))return t.code===gte?"ok":t.message||"unknown_error"}const wp="_sentryChildSpans",xL="_sentryRootSpan";function Cte(t,e){const n=t[xL]||t;Wa(e,xL,n),t[wp]?t[wp].add(e):Wa(t,wp,new Set([e]))}function $3e(t,e){t[wp]&&t[wp].delete(e)}function UE(t){const e=new Set;function n(r){if(!e.has(r)&&rm(r)){e.add(r);const i=r[wp]?Array.from(r[wp]):[];for(const s of i)n(s)}}return n(t),Array.from(e)}function is(t){return t[xL]||t}function ss(){const t=nm(),e=_y(t);return e.getActiveSpan?e.getActiveSpan():e3(Kn())}function Tte(){Mq||(tm(()=>{console.warn("[Sentry] Deprecation warning: Returning null from `beforeSendSpan` will be disallowed from SDK version 9.0.0 onwards. The callback will only support mutating spans. To drop certain spans, configure the respective integrations directly.")}),Mq=!0)}let Pq=!1;function B3e(){Pq||(Pq=!0,ste(AL),ote(AL))}function AL(){const t=ss(),e=t&&is(t);if(e){const n="internal_error";Lt&&je.log(`[Tracing] Root span: ${n} -> Global error occurred`),e.setStatus({code:Ai,message:n})}}AL.tag="sentry_tracingErrorCallback";const Rte="_sentryScope",kte="_sentryIsolationScope";function H3e(t,e,n){t&&(Wa(t,kte,n),Wa(t,Rte,e))}function Dq(t){return{scope:t[Rte],isolationScope:t[kte]}}function Yf(t){if(typeof __SENTRY_TRACING__=="boolean"&&!__SENTRY_TRACING__)return!1;const e=mn(),n=t||e&&e.getOptions();return!!n&&(n.enableTracing||"tracesSampleRate"in n||"tracesSampler"in n)}class Sy{constructor(e={}){this._traceId=e.traceId||Gf(),this._spanId=e.spanId||zf()}spanContext(){return{spanId:this._spanId,traceId:this._traceId,traceFlags:Ste}}end(e){}setAttribute(e,n){return this}setAttributes(e){return this}setStatus(e){return this}updateName(e){return this}isRecording(){return!1}addEvent(e,n,r){return this}addLink(e){return this}addLinks(e){return this}recordException(e,n){}}const l7="production",Ite="_frozenDsc";function Nq(t,e){Wa(t,Ite,e)}function xte(t,e){const n=e.getOptions(),{publicKey:r}=e.getDsn()||{},i=rs({environment:n.environment||l7,release:n.release,public_key:r,trace_id:t});return e.emit("createDsc",i),i}function Ate(t,e){const n=e.getPropagationContext();return n.dsc||xte(n.traceId,t)}function wy(t){const e=mn();if(!e)return{};const n=is(t),r=n[Ite];if(r)return r;const i=n.spanContext().traceState,s=i&&i.get("sentry.dsc"),o=s&&yte(s);if(o)return o;const a=xte(t.spanContext().traceId,e),c=hn(n),l=c.data||{},d=l[mte];d!=null&&(a.sample_rate=`${d}`);const h=l[Ua],m=c.description;return h!=="url"&&m&&(a.transaction=m),Yf()&&(a.sampled=String(rm(n))),e.emit("createDsc",a,n),a}function q3e(t){if(!Lt)return;const{description:e="< unknown name >",op:n="< unknown op >",parent_span_id:r}=hn(t),{spanId:i}=t.spanContext(),s=rm(t),o=is(t),a=o===t,c=`[Tracing] Starting ${s?"sampled":"unsampled"} ${a?"root ":""}span`,l=[`op: ${n}`,`name: ${e}`,`ID: ${i}`];if(r&&l.push(`parent ID: ${r}`),!a){const{op:d,description:h}=hn(o);l.push(`root ID: ${o.spanContext().spanId}`),d&&l.push(`root op: ${d}`),h&&l.push(`root description: ${h}`)}je.log(`${c}
  ${l.join(`
  `)}`)}function V3e(t){if(!Lt)return;const{description:e="< unknown name >",op:n="< unknown op >"}=hn(t),{spanId:r}=t.spanContext(),s=is(t)===t,o=`[Tracing] Finishing "${n}" ${s?"root ":""}span "${e}" with ID ${r}`;je.log(o)}function Lte(t){if(typeof t=="boolean")return Number(t);const e=typeof t=="string"?parseFloat(t):t;if(typeof e!="number"||isNaN(e)||e<0||e>1){Lt&&je.warn(`[Tracing] Given sample rate is invalid. Sample rate must be a boolean or a number between 0 and 1. Got ${JSON.stringify(t)} of type ${JSON.stringify(typeof t)}.`);return}return e}function K3e(t,e){if(!Yf(t))return[!1];const n=$l().getScopeData().sdkProcessingMetadata.normalizedRequest,r={...e,normalizedRequest:e.normalizedRequest||n};let i;typeof t.tracesSampler=="function"?i=t.tracesSampler(r):r.parentSampled!==void 0?i=r.parentSampled:typeof t.tracesSampleRate<"u"?i=t.tracesSampleRate:i=1;const s=Lte(i);return s===void 0?(Lt&&je.warn("[Tracing] Discarding transaction because of invalid sample rate."),[!1]):s?Math.random()<s?[!0,s]:(Lt&&je.log(`[Tracing] Discarding transaction because it's not included in the random sample (sampling rate = ${Number(i)})`),[!1,s]):(Lt&&je.log(`[Tracing] Discarding transaction because ${typeof t.tracesSampler=="function"?"tracesSampler returned 0 or false":"a negative sampling decision was inherited or tracesSampleRate is set to 0"}`),[!1,s])}const G3e=/^(?:(\w+):)\/\/(?:(\w+)(?::(\w+)?)?@)([\w.-]+)(?::(\d+))?\/(.+)/;function z3e(t){return t==="http"||t==="https"}function Ey(t,e=!1){const{host:n,path:r,pass:i,port:s,projectId:o,protocol:a,publicKey:c}=t;return`${a}://${c}${e&&i?`:${i}`:""}@${n}${s?`:${s}`:""}/${r&&`${r}/`}${o}`}function W3e(t){const e=G3e.exec(t);if(!e){tm(()=>{console.error(`Invalid Sentry Dsn: ${t}`)});return}const[n,r,i="",s="",o="",a=""]=e.slice(1);let c="",l=a;const d=l.split("/");if(d.length>1&&(c=d.slice(0,-1).join("/"),l=d.pop()),l){const h=l.match(/^\d+/);h&&(l=h[0])}return Mte({host:s,pass:i,path:c,projectId:l,port:o,protocol:n,publicKey:r})}function Mte(t){return{protocol:t.protocol,publicKey:t.publicKey||"",pass:t.pass||"",host:t.host,port:t.port||"",path:t.path||"",projectId:t.projectId}}function Y3e(t){if(!lh)return!0;const{port:e,projectId:n,protocol:r}=t;return["protocol","publicKey","host","projectId"].find(o=>t[o]?!1:(je.error(`Invalid Sentry Dsn: ${o} missing`),!0))?!1:n.match(/^\d+$/)?z3e(r)?e&&isNaN(parseInt(e,10))?(je.error(`Invalid Sentry Dsn: Invalid port ${e}`),!1):!0:(je.error(`Invalid Sentry Dsn: Invalid protocol ${r}`),!1):(je.error(`Invalid Sentry Dsn: Invalid projectId ${n}`),!1)}function Ote(t){const e=typeof t=="string"?W3e(t):Mte(t);if(!(!e||!Y3e(e)))return e}function X3e(){const t=typeof WeakSet=="function",e=t?new WeakSet:[];function n(i){if(t)return e.has(i)?!0:(e.add(i),!1);for(let s=0;s<e.length;s++)if(e[s]===i)return!0;return e.push(i),!1}function r(i){if(t)e.delete(i);else for(let s=0;s<e.length;s++)if(e[s]===i){e.splice(s,1);break}}return[n,r]}function _u(t,e=100,n=1/0){try{return LL("",t,e,n)}catch(r){return{ERROR:`**non-serializable** (${r})`}}}function Pte(t,e=3,n=100*1024){const r=_u(t,e);return eTe(r)>n?Pte(t,e-1,n):r}function LL(t,e,n=1/0,r=1/0,i=X3e()){const[s,o]=i;if(e==null||["boolean","string"].includes(typeof e)||typeof e=="number"&&Number.isFinite(e))return e;const a=J3e(t,e);if(!a.startsWith("[object "))return a;if(e.__sentry_skip_normalization__)return e;const c=typeof e.__sentry_override_normalization_depth__=="number"?e.__sentry_override_normalization_depth__:n;if(c===0)return a.replace("object ","");if(s(e))return"[Circular ~]";const l=e;if(l&&typeof l.toJSON=="function")try{const g=l.toJSON();return LL("",g,c-1,r,i)}catch{}const d=Array.isArray(e)?[]:{};let h=0;const m=fte(e);for(const g in m){if(!Object.prototype.hasOwnProperty.call(m,g))continue;if(h>=r){d[g]="[MaxProperties ~]";break}const y=m[g];d[g]=LL(g,y,c-1,r,i),h++}return o(e),d}function J3e(t,e){try{if(t==="domain"&&e&&typeof e=="object"&&e._events)return"[Domain]";if(t==="domainEmitter")return"[DomainEmitter]";if(typeof global<"u"&&e===global)return"[Global]";if(typeof window<"u"&&e===window)return"[Window]";if(typeof document<"u"&&e===document)return"[Document]";if(lte(e))return"[VueViewModel]";if(n3e(e))return"[SyntheticEvent]";if(typeof e=="number"&&!Number.isFinite(e))return`[${e}]`;if(typeof e=="function")return`[Function: ${rd(e)}]`;if(typeof e=="symbol")return`[${String(e)}]`;if(typeof e=="bigint")return`[BigInt: ${String(e)}]`;const n=Q3e(e);return/^HTML(\w*)Element$/.test(n)?`[HTMLElement: ${n}]`:`[object ${n}]`}catch(n){return`**non-serializable** (${n})`}}function Q3e(t){const e=Object.getPrototypeOf(t);return e?e.constructor.name:"null prototype"}function Z3e(t){return~-encodeURI(t).split(/%..|./).length}function eTe(t){return Z3e(JSON.stringify(t))}function Cy(t,e=[]){return[t,e]}function tTe(t,e){const[n,r]=t;return[n,[...r,e]]}function Uq(t,e){const n=t[1];for(const r of n){const i=r[0].type;if(e(r,i))return!0}return!1}function ML(t){return cn.__SENTRY__&&cn.__SENTRY__.encodePolyfill?cn.__SENTRY__.encodePolyfill(t):new TextEncoder().encode(t)}function nTe(t){const[e,n]=t;let r=JSON.stringify(e);function i(s){typeof r=="string"?r=typeof s=="string"?r+s:[ML(r),s]:r.push(typeof s=="string"?ML(s):s)}for(const s of n){const[o,a]=s;if(i(`
${JSON.stringify(o)}
`),typeof a=="string"||a instanceof Uint8Array)i(a);else{let c;try{c=JSON.stringify(a)}catch{c=JSON.stringify(_u(a))}i(c)}}return typeof r=="string"?r:rTe(r)}function rTe(t){const e=t.reduce((i,s)=>i+s.length,0),n=new Uint8Array(e);let r=0;for(const i of t)n.set(i,r),r+=i.length;return n}function iTe(t){return[{type:"span"},t]}function sTe(t){const e=typeof t.data=="string"?ML(t.data):t.data;return[rs({type:"attachment",length:e.length,filename:t.filename,content_type:t.contentType,attachment_type:t.attachmentType}),e]}const oTe={session:"session",sessions:"session",attachment:"attachment",transaction:"transaction",event:"error",client_report:"internal",user_report:"default",profile:"profile",profile_chunk:"profile",replay_event:"replay",replay_recording:"replay",check_in:"monitor",feedback:"feedback",span:"span",statsd:"metric_bucket",raw_security:"security"};function jq(t){return oTe[t]}function Dte(t){if(!t||!t.sdk)return;const{name:e,version:n}=t.sdk;return{name:e,version:n}}function aTe(t,e,n,r){const i=t.sdkProcessingMetadata&&t.sdkProcessingMetadata.dynamicSamplingContext;return{event_id:t.event_id,sent_at:new Date().toISOString(),...e&&{sdk:e},...!!n&&r&&{dsn:Ey(r)},...i&&{trace:rs({...i})}}}function cTe(t,e){return e&&(t.sdk=t.sdk||{},t.sdk.name=t.sdk.name||e.name,t.sdk.version=t.sdk.version||e.version,t.sdk.integrations=[...t.sdk.integrations||[],...e.integrations||[]],t.sdk.packages=[...t.sdk.packages||[],...e.packages||[]]),t}function lTe(t,e,n,r){const i=Dte(n),s={sent_at:new Date().toISOString(),...i&&{sdk:i},...!!r&&e&&{dsn:Ey(e)}},o="aggregates"in t?[{type:"sessions"},t]:[{type:"session"},t.toJSON()];return Cy(s,[o])}function uTe(t,e,n,r){const i=Dte(n),s=t.type&&t.type!=="replay_event"?t.type:"event";cTe(t,n&&n.sdk);const o=aTe(t,i,r,e);return delete t.sdkProcessingMetadata,Cy(o,[[{type:s},t]])}function dTe(t,e){function n(d){return!!d.trace_id&&!!d.public_key}const r=wy(t[0]),i=e&&e.getDsn(),s=e&&e.getOptions().tunnel,o={sent_at:new Date().toISOString(),...n(r)&&{trace:r},...!!s&&i&&{dsn:Ey(i)}},a=e&&e.getOptions().beforeSendSpan,c=a?d=>{const h=a(hn(d));return h||Tte(),h}:d=>hn(d),l=[];for(const d of t){const h=c(d);h&&l.push(iTe(h))}return Cy(o,l)}function fTe(t,e,n,r=ss()){const i=r&&is(r);i&&(Lt&&je.log(`[Measurement] Setting measurement on root span: ${t} = ${e} ${n}`),i.addEvent(t,{[XT]:e,[YT]:n}))}function Fq(t){if(!t||t.length===0)return;const e={};return t.forEach(n=>{const r=n.attributes||{},i=r[YT],s=r[XT];typeof i=="string"&&typeof s=="number"&&(e[n.name]={value:s,unit:i})}),e}const $q=1e3;class u7{constructor(e={}){this._traceId=e.traceId||Gf(),this._spanId=e.spanId||zf(),this._startTime=e.startTimestamp||Ds(),this._attributes={},this.setAttributes({[ai]:"manual",[sd]:e.op,...e.attributes}),this._name=e.name,e.parentSpanId&&(this._parentSpanId=e.parentSpanId),"sampled"in e&&(this._sampled=e.sampled),e.endTimestamp&&(this._endTime=e.endTimestamp),this._events=[],this._isStandaloneSpan=e.isStandalone,this._endTime&&this._onSpanEnded()}addLink(e){return this}addLinks(e){return this}recordException(e,n){}spanContext(){const{_spanId:e,_traceId:n,_sampled:r}=this;return{spanId:e,traceId:n,traceFlags:r?wte:Ste}}setAttribute(e,n){return n===void 0?delete this._attributes[e]:this._attributes[e]=n,this}setAttributes(e){return Object.keys(e).forEach(n=>this.setAttribute(n,e[n])),this}updateStartTime(e){this._startTime=Sp(e)}setStatus(e){return this._status=e,this}updateName(e){return this._name=e,this.setAttribute(Ua,"custom"),this}end(e){this._endTime||(this._endTime=Sp(e),V3e(this),this._onSpanEnded())}getSpanJSON(){return rs({data:this._attributes,description:this._name,op:this._attributes[sd],parent_span_id:this._parentSpanId,span_id:this._spanId,start_timestamp:this._startTime,status:Ete(this._status),timestamp:this._endTime,trace_id:this._traceId,origin:this._attributes[ai],_metrics_summary:kL(this),profile_id:this._attributes[T3e],exclusive_time:this._attributes[a7],measurements:Fq(this._events),is_segment:this._isStandaloneSpan&&is(this)===this||void 0,segment_id:this._isStandaloneSpan?is(this).spanContext().spanId:void 0})}isRecording(){return!this._endTime&&!!this._sampled}addEvent(e,n,r){Lt&&je.log("[Tracing] Adding an event to span:",e);const i=Bq(n)?n:r||Ds(),s=Bq(n)?{}:n||{},o={name:e,time:Sp(i),attributes:s};return this._events.push(o),this}isStandaloneSpan(){return!!this._isStandaloneSpan}_onSpanEnded(){const e=mn();if(e&&e.emit("spanEnd",this),!(this._isStandaloneSpan||this===is(this)))return;if(this._isStandaloneSpan){this._sampled?pTe(dTe([this],e)):(Lt&&je.log("[Tracing] Discarding standalone span because its trace was not chosen to be sampled."),e&&e.recordDroppedEvent("sample_rate","span"));return}const r=this._convertSpanToTransaction();r&&(Dq(this).scope||Kn()).captureEvent(r)}_convertSpanToTransaction(){if(!Hq(hn(this)))return;this._name||(Lt&&je.warn("Transaction has no name, falling back to `<unlabeled transaction>`."),this._name="<unlabeled transaction>");const{scope:e,isolationScope:n}=Dq(this),i=(e||Kn()).getClient()||mn();if(this._sampled!==!0){Lt&&je.log("[Tracing] Discarding transaction because its trace was not chosen to be sampled."),i&&i.recordDroppedEvent("sample_rate","transaction");return}const o=UE(this).filter(h=>h!==this&&!hTe(h)).map(h=>hn(h)).filter(Hq),a=this._attributes[Ua];delete this._attributes[Aq],o.forEach(h=>{h.data&&delete h.data[Aq]});const c={contexts:{trace:D3e(this)},spans:o.length>$q?o.sort((h,m)=>h.start_timestamp-m.start_timestamp).slice(0,$q):o,start_timestamp:this._startTime,timestamp:this._endTime,transaction:this._name,type:"transaction",sdkProcessingMetadata:{capturedSpanScope:e,capturedSpanIsolationScope:n,...rs({dynamicSamplingContext:wy(this)})},_metrics_summary:kL(this),...a&&{transaction_info:{source:a}}},l=Fq(this._events);return l&&Object.keys(l).length&&(Lt&&je.log("[Measurements] Adding measurements to transaction event",JSON.stringify(l,void 0,2)),c.measurements=l),c}}function Bq(t){return t&&typeof t=="number"||t instanceof Date||Array.isArray(t)}function Hq(t){return!!t.start_timestamp&&!!t.timestamp&&!!t.span_id&&!!t.trace_id}function hTe(t){return t instanceof u7&&t.isStandaloneSpan()}function pTe(t){const e=mn();if(!e)return;const n=t[1];if(!n||n.length===0){e.recordDroppedEvent("before_send","span");return}e.sendEnvelope(t)}const Nte="__SENTRY_SUPPRESS_TRACING__";function H_(t){const e=jte();if(e.startInactiveSpan)return e.startInactiveSpan(t);const n=gTe(t),{forceTransaction:r,parentSpan:i}=t;return(t.scope?o=>WT(t.scope,o):i!==void 0?o=>Ute(i,o):o=>o())(()=>{const o=Kn(),a=yTe(o);return t.onlyIfParent&&!a?new Sy:mTe({parentSpan:a,spanArguments:n,forceTransaction:r,scope:o})})}function Ute(t,e){const n=jte();return n.withActiveSpan?n.withActiveSpan(t,e):WT(r=>(Wb(r,t||void 0),e(r)))}function mTe({parentSpan:t,spanArguments:e,forceTransaction:n,scope:r}){if(!Yf())return new Sy;const i=$l();let s;if(t&&!n)s=vTe(t,r,e),Cte(t,s);else if(t){const o=wy(t),{traceId:a,spanId:c}=t.spanContext(),l=rm(t);s=qq({traceId:a,parentSpanId:c,...e},r,l),Nq(s,o)}else{const{traceId:o,dsc:a,parentSpanId:c,sampled:l}={...i.getPropagationContext(),...r.getPropagationContext()};s=qq({traceId:o,parentSpanId:c,...e},r,l),a&&Nq(s,a)}return q3e(s),H3e(s,r,i),s}function gTe(t){const n={isStandalone:(t.experimental||{}).standalone,...t};if(t.startTime){const r={...n};return r.startTimestamp=Sp(t.startTime),delete r.startTime,r}return n}function jte(){const t=nm();return _y(t)}function qq(t,e,n){const r=mn(),i=r&&r.getOptions()||{},{name:s="",attributes:o}=t,[a,c]=e.getScopeData().sdkProcessingMetadata[Nte]?[!1]:K3e(i,{name:s,parentSampled:n,attributes:o,transactionContext:{name:s,parentSampled:n}}),l=new u7({...t,attributes:{[Ua]:"custom",...t.attributes},sampled:a});return c!==void 0&&l.setAttribute(mte,c),r&&r.emit("spanStart",l),l}function vTe(t,e,n){const{spanId:r,traceId:i}=t.spanContext(),s=e.getScopeData().sdkProcessingMetadata[Nte]?!1:rm(t),o=s?new u7({...n,parentSpanId:r,traceId:i,sampled:s}):new Sy({traceId:i});Cte(t,o);const a=mn();return a&&(a.emit("spanStart",o),n.endTimestamp&&a.emit("spanEnd",o)),o}function yTe(t){const e=e3(t);if(!e)return;const n=mn();return(n?n.getOptions():{}).parentSpanIsAlwaysRootSpan?is(e):e}const jE={idleTimeout:1e3,finalTimeout:3e4,childSpanTimeout:15e3},bTe="heartbeatFailed",_Te="idleTimeout",STe="finalTimeout",wTe="externalFinish";function Fte(t,e={}){const n=new Map;let r=!1,i,s=wTe,o=!e.disableAutoFinish;const a=[],{idleTimeout:c=jE.idleTimeout,finalTimeout:l=jE.finalTimeout,childSpanTimeout:d=jE.childSpanTimeout,beforeSpanEnd:h}=e,m=mn();if(!m||!Yf())return new Sy;const g=Kn(),y=ss(),v=ETe(t);v.end=new Proxy(v.end,{apply(T,L,O){h&&h(v);const[P,...D]=O,j=P||Ds(),H=Sp(j),z=UE(v).filter(V=>V!==v);if(!z.length)return k(H),Reflect.apply(T,L,[H,...D]);const Y=z.map(V=>hn(V).timestamp).filter(V=>!!V),W=Y.length?Math.max(...Y):void 0,F=hn(v).start_timestamp,$=Math.min(F?F+l/1e3:1/0,Math.max(F||-1/0,Math.min(H,W||1/0)));return k($),Reflect.apply(T,L,[$,...D])}});function E(){i&&(clearTimeout(i),i=void 0)}function w(T){E(),i=setTimeout(()=>{!r&&n.size===0&&o&&(s=_Te,v.end(T))},c)}function R(T){i=setTimeout(()=>{!r&&o&&(s=bTe,v.end(T))},d)}function x(T){E(),n.set(T,!0);const L=Ds();R(L+d/1e3)}function C(T){if(n.has(T)&&n.delete(T),n.size===0){const L=Ds();w(L+c/1e3)}}function k(T){r=!0,n.clear(),a.forEach(H=>H()),Wb(g,y);const L=hn(v),{start_timestamp:O}=L;if(!O)return;(L.data||{})[IL]||v.setAttribute(IL,s),je.log(`[Tracing] Idle span "${L.op}" finished`);const D=UE(v).filter(H=>H!==v);let j=0;D.forEach(H=>{H.isRecording()&&(H.setStatus({code:Ai,message:"cancelled"}),H.end(T),Lt&&je.log("[Tracing] Cancelling span since span ended early",JSON.stringify(H,void 0,2)));const z=hn(H),{timestamp:Y=0,start_timestamp:W=0}=z,F=W<=T,$=(l+c)/1e3,V=Y-W<=$;if(Lt){const G=JSON.stringify(H,void 0,2);F?V||je.log("[Tracing] Discarding span since it finished after idle span final timeout",G):je.log("[Tracing] Discarding span since it happened after idle span was finished",G)}(!V||!F)&&($3e(v,H),j++)}),j>0&&v.setAttribute("sentry.idle_span_discarded_spans",j)}return a.push(m.on("spanStart",T=>{if(r||T===v||hn(T).timestamp)return;UE(v).includes(T)&&x(T.spanContext().spanId)})),a.push(m.on("spanEnd",T=>{r||C(T.spanContext().spanId)})),a.push(m.on("idleSpanEnableAutoFinish",T=>{T===v&&(o=!0,w(),n.size&&R())})),e.disableAutoFinish||w(),setTimeout(()=>{r||(v.setStatus({code:Ai,message:"deadline_exceeded"}),s=STe,v.end())},l),v}function ETe(t){const e=H_(t);return Wb(Kn(),e),Lt&&je.log("[Tracing] Started span is an idle span"),e}function OL(t,e,n,r=0){return new xa((i,s)=>{const o=t[r];if(e===null||typeof o!="function")i(e);else{const a=o({...e},n);Lt&&o.id&&a===null&&je.log(`Event processor "${o.id}" dropped event`),GT(a)?a.then(c=>OL(t,c,n,r+1).then(i)).then(null,s):OL(t,a,n,r+1).then(i).then(null,s)}})}let lw,Vq,uw;function CTe(t){const e=cn._sentryDebugIds;if(!e)return{};const n=Object.keys(e);return uw&&n.length===Vq||(Vq=n.length,uw=n.reduce((r,i)=>{lw||(lw={});const s=lw[i];if(s)r[s[0]]=s[1];else{const o=t(i);for(let a=o.length-1;a>=0;a--){const c=o[a],l=c&&c.filename,d=e[i];if(l&&d){r[l]=d,lw[i]=[l,d];break}}}return r},{})),uw}function TTe(t,e){const{fingerprint:n,span:r,breadcrumbs:i,sdkProcessingMetadata:s}=e;RTe(t,e),r&&xTe(t,r),ATe(t,n),kTe(t,i),ITe(t,s)}function Kq(t,e){const{extra:n,tags:r,user:i,contexts:s,level:o,sdkProcessingMetadata:a,breadcrumbs:c,fingerprint:l,eventProcessors:d,attachments:h,propagationContext:m,transactionName:g,span:y}=e;dw(t,"extra",n),dw(t,"tags",r),dw(t,"user",i),dw(t,"contexts",s),t.sdkProcessingMetadata=zT(t.sdkProcessingMetadata,a,2),o&&(t.level=o),g&&(t.transactionName=g),y&&(t.span=y),c.length&&(t.breadcrumbs=[...t.breadcrumbs,...c]),l.length&&(t.fingerprint=[...t.fingerprint,...l]),d.length&&(t.eventProcessors=[...t.eventProcessors,...d]),h.length&&(t.attachments=[...t.attachments,...h]),t.propagationContext={...t.propagationContext,...m}}function dw(t,e,n){t[e]=zT(t[e],n,1)}function RTe(t,e){const{extra:n,tags:r,user:i,contexts:s,level:o,transactionName:a}=e,c=rs(n);c&&Object.keys(c).length&&(t.extra={...c,...t.extra});const l=rs(r);l&&Object.keys(l).length&&(t.tags={...l,...t.tags});const d=rs(i);d&&Object.keys(d).length&&(t.user={...d,...t.user});const h=rs(s);h&&Object.keys(h).length&&(t.contexts={...h,...t.contexts}),o&&(t.level=o),a&&t.type!=="transaction"&&(t.transaction=a)}function kTe(t,e){const n=[...t.breadcrumbs||[],...e];t.breadcrumbs=n.length?n:void 0}function ITe(t,e){t.sdkProcessingMetadata={...t.sdkProcessingMetadata,...e}}function xTe(t,e){t.contexts={trace:N3e(e),...t.contexts},t.sdkProcessingMetadata={dynamicSamplingContext:wy(e),...t.sdkProcessingMetadata};const n=is(e),r=hn(n).description;r&&!t.transaction&&t.type==="transaction"&&(t.transaction=r)}function ATe(t,e){t.fingerprint=t.fingerprint?Array.isArray(t.fingerprint)?t.fingerprint:[t.fingerprint]:[],e&&(t.fingerprint=t.fingerprint.concat(e)),t.fingerprint&&!t.fingerprint.length&&delete t.fingerprint}function LTe(t,e,n,r,i,s){const{normalizeDepth:o=3,normalizeMaxBreadth:a=1e3}=t,c={...e,event_id:e.event_id||n.event_id||Ha(),timestamp:e.timestamp||B_()},l=n.integrations||t.integrations.map(E=>E.name);MTe(c,t),DTe(c,l),i&&i.emit("applyFrameMetadata",e),e.type===void 0&&OTe(c,t.stackParser);const d=UTe(r,n.captureContext);n.mechanism&&Nv(c,n.mechanism);const h=i?i.getEventProcessors():[],m=w3e().getScopeData();if(s){const E=s.getScopeData();Kq(m,E)}if(d){const E=d.getScopeData();Kq(m,E)}const g=[...n.attachments||[],...m.attachments];g.length&&(n.attachments=g),TTe(c,m);const y=[...h,...m.eventProcessors];return OL(y,c,n).then(E=>(E&&PTe(E),typeof o=="number"&&o>0?NTe(E,o,a):E))}function MTe(t,e){const{environment:n,release:r,dist:i,maxValueLength:s=250}=e;t.environment=t.environment||n||l7,!t.release&&r&&(t.release=r),!t.dist&&i&&(t.dist=i),t.message&&(t.message=cv(t.message,s));const o=t.exception&&t.exception.values&&t.exception.values[0];o&&o.value&&(o.value=cv(o.value,s));const a=t.request;a&&a.url&&(a.url=cv(a.url,s))}function OTe(t,e){const n=CTe(e);try{t.exception.values.forEach(r=>{r.stacktrace.frames.forEach(i=>{n&&i.filename&&(i.debug_id=n[i.filename])})})}catch{}}function PTe(t){const e={};try{t.exception.values.forEach(r=>{r.stacktrace.frames.forEach(i=>{i.debug_id&&(i.abs_path?e[i.abs_path]=i.debug_id:i.filename&&(e[i.filename]=i.debug_id),delete i.debug_id)})})}catch{}if(Object.keys(e).length===0)return;t.debug_meta=t.debug_meta||{},t.debug_meta.images=t.debug_meta.images||[];const n=t.debug_meta.images;Object.entries(e).forEach(([r,i])=>{n.push({type:"sourcemap",code_file:r,debug_id:i})})}function DTe(t,e){e.length>0&&(t.sdk=t.sdk||{},t.sdk.integrations=[...t.sdk.integrations||[],...e])}function NTe(t,e,n){if(!t)return null;const r={...t,...t.breadcrumbs&&{breadcrumbs:t.breadcrumbs.map(i=>({...i,...i.data&&{data:_u(i.data,e,n)}}))},...t.user&&{user:_u(t.user,e,n)},...t.contexts&&{contexts:_u(t.contexts,e,n)},...t.extra&&{extra:_u(t.extra,e,n)}};return t.contexts&&t.contexts.trace&&r.contexts&&(r.contexts.trace=t.contexts.trace,t.contexts.trace.data&&(r.contexts.trace.data=_u(t.contexts.trace.data,e,n))),t.spans&&(r.spans=t.spans.map(i=>({...i,...i.data&&{data:_u(i.data,e,n)}}))),t.contexts&&t.contexts.flags&&r.contexts&&(r.contexts.flags=_u(t.contexts.flags,3,n)),r}function UTe(t,e){if(!e)return t;const n=t?t.clone():new Wf;return n.update(e),n}function jTe(t){if(t)return FTe(t)?{captureContext:t}:BTe(t)?{captureContext:t}:t}function FTe(t){return t instanceof Wf||typeof t=="function"}const $Te=["user","level","extra","contexts","tags","fingerprint","requestSession","propagationContext"];function BTe(t){return Object.keys(t).some(e=>$Te.includes(e))}function JT(t,e){return Kn().captureException(t,jTe(e))}function $te(t,e){return Kn().captureEvent(t,e)}function HTe(t,e){$l().setContext(t,e)}function qTe(){return $l().lastEventId()}function VTe(){const t=mn();return!!t&&t.getOptions().enabled!==!1&&!!t.getTransport()}function Gq(t){const e=mn(),n=$l(),r=Kn(),{release:i,environment:s=l7}=e&&e.getOptions()||{},{userAgent:o}=cn.navigator||{},a=f3e({release:i,environment:s,user:r.getUser()||n.getUser(),...o&&{userAgent:o},...t}),c=n.getSession();return c&&c.status==="ok"&&Uv(c,{status:"exited"}),Bte(),n.setSession(a),r.setSession(a),a}function Bte(){const t=$l(),e=Kn(),n=e.getSession()||t.getSession();n&&h3e(n),Hte(),t.setSession(),e.setSession()}function Hte(){const t=$l(),e=Kn(),n=mn(),r=e.getSession()||t.getSession();r&&n&&n.captureSession(r)}function zq(t=!1){if(t){Bte();return}Hte()}const KTe="7";function qte(t){const e=t.protocol?`${t.protocol}:`:"",n=t.port?`:${t.port}`:"";return`${e}//${t.host}${n}${t.path?`/${t.path}`:""}/api/`}function GTe(t){return`${qte(t)}${t.projectId}/envelope/`}function zTe(t,e){const n={sentry_version:KTe};return t.publicKey&&(n.sentry_key=t.publicKey),e&&(n.sentry_client=`${e.name}/${e.version}`),new URLSearchParams(n).toString()}function WTe(t,e,n){return e||`${GTe(t)}?${zTe(t,n)}`}function YTe(t,e){const n=Ote(t);if(!n)return"";const r=`${qte(n)}embed/error-page/`;let i=`dsn=${Ey(n)}`;for(const s in e)if(s!=="dsn"&&s!=="onClose")if(s==="user"){const o=e.user;if(!o)continue;o.name&&(i+=`&name=${encodeURIComponent(o.name)}`),o.email&&(i+=`&email=${encodeURIComponent(o.email)}`)}else i+=`&${encodeURIComponent(s)}=${encodeURIComponent(e[s])}`;return`${r}?${i}`}const Wq=[];function XTe(t){const e={};return t.forEach(n=>{const{name:r}=n,i=e[r];i&&!i.isDefaultInstance&&n.isDefaultInstance||(e[r]=n)}),Object.values(e)}function JTe(t){const e=t.defaultIntegrations||[],n=t.integrations;e.forEach(o=>{o.isDefaultInstance=!0});let r;if(Array.isArray(n))r=[...e,...n];else if(typeof n=="function"){const o=n(e);r=Array.isArray(o)?o:[o]}else r=e;const i=XTe(r),s=i.findIndex(o=>o.name==="Debug");if(s>-1){const[o]=i.splice(s,1);i.push(o)}return i}function QTe(t,e){const n={};return e.forEach(r=>{r&&Vte(t,r,n)}),n}function Yq(t,e){for(const n of e)n&&n.afterAllSetup&&n.afterAllSetup(t)}function Vte(t,e,n){if(n[e.name]){Lt&&je.log(`Integration skipped because it was already installed: ${e.name}`);return}if(n[e.name]=e,Wq.indexOf(e.name)===-1&&typeof e.setupOnce=="function"&&(e.setupOnce(),Wq.push(e.name)),e.setup&&typeof e.setup=="function"&&e.setup(t),typeof e.preprocessEvent=="function"){const r=e.preprocessEvent.bind(e);t.on("preprocessEvent",(i,s)=>r(i,s,t))}if(typeof e.processEvent=="function"){const r=e.processEvent.bind(e),i=Object.assign((s,o)=>r(s,o,t),{id:e.name});t.addEventProcessor(i)}Lt&&je.log(`Integration installed: ${e.name}`)}function ZTe(t,e,n){const r=[{type:"client_report"},{timestamp:B_(),discarded_events:t}];return Cy(e?{dsn:e}:{},[r])}class Ec extends Error{constructor(e,n="warn"){super(e),this.message=e,this.logLevel=n}}const Xq="Not capturing exception because it's already been captured.";class eRe{constructor(e){if(this._options=e,this._integrations={},this._numProcessing=0,this._outcomes={},this._hooks={},this._eventProcessors=[],e.dsn?this._dsn=Ote(e.dsn):Lt&&je.warn("No DSN provided, client will not send events."),this._dsn){const i=WTe(this._dsn,e.tunnel,e._metadata?e._metadata.sdk:void 0);this._transport=e.transport({tunnel:this._options.tunnel,recordDroppedEvent:this.recordDroppedEvent.bind(this),...e.transportOptions,url:i})}const r=["enableTracing","tracesSampleRate","tracesSampler"].find(i=>i in e&&e[i]==null);r&&tm(()=>{console.warn(`[Sentry] Deprecation warning: \`${r}\` is set to undefined, which leads to tracing being enabled. In v9, a value of \`undefined\` will result in tracing being disabled.`)})}captureException(e,n,r){const i=Ha();if(Iq(e))return Lt&&je.log(Xq),i;const s={event_id:i,...n};return this._process(this.eventFromException(e,s).then(o=>this._captureEvent(o,s,r))),s.event_id}captureMessage(e,n,r,i){const s={event_id:Ha(),...r},o=r7(e)?e:String(e),a=i7(e)?this.eventFromMessage(o,n,s):this.eventFromException(e,s);return this._process(a.then(c=>this._captureEvent(c,s,i))),s.event_id}captureEvent(e,n,r){const i=Ha();if(n&&n.originalException&&Iq(n.originalException))return Lt&&je.log(Xq),i;const s={event_id:i,...n},a=(e.sdkProcessingMetadata||{}).capturedSpanScope;return this._process(this._captureEvent(e,s,a||r)),s.event_id}captureSession(e){typeof e.release!="string"?Lt&&je.warn("Discarded session because of missing or non-string release"):(this.sendSession(e),Uv(e,{init:!1}))}getDsn(){return this._dsn}getOptions(){return this._options}getSdkMetadata(){return this._options._metadata}getTransport(){return this._transport}flush(e){const n=this._transport;return n?(this.emit("flush"),this._isClientDoneProcessing(e).then(r=>n.flush(e).then(i=>r&&i))):Dp(!0)}close(e){return this.flush(e).then(n=>(this.getOptions().enabled=!1,this.emit("close"),n))}getEventProcessors(){return this._eventProcessors}addEventProcessor(e){this._eventProcessors.push(e)}init(){(this._isEnabled()||this._options.integrations.some(({name:e})=>e.startsWith("Spotlight")))&&this._setupIntegrations()}getIntegrationByName(e){return this._integrations[e]}addIntegration(e){const n=this._integrations[e.name];Vte(this,e,this._integrations),n||Yq(this,[e])}sendEvent(e,n={}){this.emit("beforeSendEvent",e,n);let r=uTe(e,this._dsn,this._options._metadata,this._options.tunnel);for(const s of n.attachments||[])r=tTe(r,sTe(s));const i=this.sendEnvelope(r);i&&i.then(s=>this.emit("afterSendEvent",e,s),null)}sendSession(e){const n=lTe(e,this._dsn,this._options._metadata,this._options.tunnel);this.sendEnvelope(n)}recordDroppedEvent(e,n,r){if(this._options.sendClientReports){const i=typeof r=="number"?r:1,s=`${e}:${n}`;Lt&&je.log(`Recording outcome: "${s}"${i>1?` (${i} times)`:""}`),this._outcomes[s]=(this._outcomes[s]||0)+i}}on(e,n){const r=this._hooks[e]=this._hooks[e]||[];return r.push(n),()=>{const i=r.indexOf(n);i>-1&&r.splice(i,1)}}emit(e,...n){const r=this._hooks[e];r&&r.forEach(i=>i(...n))}sendEnvelope(e){return this.emit("beforeEnvelope",e),this._isEnabled()&&this._transport?this._transport.send(e).then(null,n=>(Lt&&je.error("Error while sending envelope:",n),n)):(Lt&&je.error("Transport disabled"),Dp({}))}_setupIntegrations(){const{integrations:e}=this._options;this._integrations=QTe(this,e),Yq(this,e)}_updateSessionFromEvent(e,n){let r=n.level==="fatal",i=!1;const s=n.exception&&n.exception.values;if(s){i=!0;for(const c of s){const l=c.mechanism;if(l&&l.handled===!1){r=!0;break}}}const o=e.status==="ok";(o&&e.errors===0||o&&r)&&(Uv(e,{...r&&{status:"crashed"},errors:e.errors||Number(i||r)}),this.captureSession(e))}_isClientDoneProcessing(e){return new xa(n=>{let r=0;const i=1,s=setInterval(()=>{this._numProcessing==0?(clearInterval(s),n(!0)):(r+=i,e&&r>=e&&(clearInterval(s),n(!1)))},i)})}_isEnabled(){return this.getOptions().enabled!==!1&&this._transport!==void 0}_prepareEvent(e,n,r=Kn(),i=$l()){const s=this.getOptions(),o=Object.keys(this._integrations);return!n.integrations&&o.length>0&&(n.integrations=o),this.emit("preprocessEvent",e,n),e.type||i.setLastEventId(e.event_id||n.event_id),LTe(s,e,n,r,this,i).then(a=>{if(a===null)return a;a.contexts={trace:E3e(r),...a.contexts};const c=Ate(this,r);return a.sdkProcessingMetadata={dynamicSamplingContext:c,...a.sdkProcessingMetadata},a})}_captureEvent(e,n={},r){return this._processEvent(e,n,r).then(i=>i.event_id,i=>{Lt&&(i instanceof Ec&&i.logLevel==="log"?je.log(i.message):je.warn(i))})}_processEvent(e,n,r){const i=this.getOptions(),{sampleRate:s}=i,o=Gte(e),a=Kte(e),c=e.type||"error",l=`before send for type \`${c}\``,d=typeof s>"u"?void 0:Lte(s);if(a&&typeof d=="number"&&Math.random()>d)return this.recordDroppedEvent("sample_rate","error",e),ZC(new Ec(`Discarding event because it's not included in the random sample (sampling rate = ${s})`,"log"));const h=c==="replay_event"?"replay":c,g=(e.sdkProcessingMetadata||{}).capturedSpanIsolationScope;return this._prepareEvent(e,n,r,g).then(y=>{if(y===null)throw this.recordDroppedEvent("event_processor",h,e),new Ec("An event processor returned `null`, will not send event.","log");if(n.data&&n.data.__sentry__===!0)return y;const E=nRe(this,i,y,n);return tRe(E,l)}).then(y=>{if(y===null){if(this.recordDroppedEvent("before_send",h,e),o){const R=1+(e.spans||[]).length;this.recordDroppedEvent("before_send","span",R)}throw new Ec(`${l} returned \`null\`, will not send event.`,"log")}const v=r&&r.getSession();if(!o&&v&&this._updateSessionFromEvent(v,y),o){const w=y.sdkProcessingMetadata&&y.sdkProcessingMetadata.spanCountBeforeProcessing||0,R=y.spans?y.spans.length:0,x=w-R;x>0&&this.recordDroppedEvent("before_send","span",x)}const E=y.transaction_info;if(o&&E&&y.transaction!==e.transaction){const w="custom";y.transaction_info={...E,source:w}}return this.sendEvent(y,n),y}).then(null,y=>{throw y instanceof Ec?y:(this.captureException(y,{data:{__sentry__:!0},originalException:y}),new Ec(`Event processing pipeline threw an error, original event will not be sent. Details have been sent as a new event.
Reason: ${y}`))})}_process(e){this._numProcessing++,e.then(n=>(this._numProcessing--,n),n=>(this._numProcessing--,n))}_clearOutcomes(){const e=this._outcomes;return this._outcomes={},Object.entries(e).map(([n,r])=>{const[i,s]=n.split(":");return{reason:i,category:s,quantity:r}})}_flushOutcomes(){Lt&&je.log("Flushing outcomes...");const e=this._clearOutcomes();if(e.length===0){Lt&&je.log("No outcomes to send");return}if(!this._dsn){Lt&&je.log("No dsn provided, will not send outcomes");return}Lt&&je.log("Sending outcomes:",e);const n=ZTe(e,this._options.tunnel&&Ey(this._dsn));this.sendEnvelope(n)}}function tRe(t,e){const n=`${e} must return \`null\` or a valid event.`;if(GT(t))return t.then(r=>{if(!Dv(r)&&r!==null)throw new Ec(n);return r},r=>{throw new Ec(`${e} rejected with ${r}`)});if(!Dv(t)&&t!==null)throw new Ec(n);return t}function nRe(t,e,n,r){const{beforeSend:i,beforeSendTransaction:s,beforeSendSpan:o}=e;if(Kte(n)&&i)return i(n,r);if(Gte(n)){if(n.spans&&o){const a=[];for(const c of n.spans){const l=o(c);l?a.push(l):(Tte(),t.recordDroppedEvent("before_send","span"))}n.spans=a}if(s){if(n.spans){const a=n.spans.length;n.sdkProcessingMetadata={...n.sdkProcessingMetadata,spanCountBeforeProcessing:a}}return s(n,r)}}return n}function Kte(t){return t.type===void 0}function Gte(t){return t.type==="transaction"}function rRe(t,e){e.debug===!0&&(Lt?je.enable():tm(()=>{console.warn("[Sentry] Cannot initialize SDK with `debug` option using a non-debug bundle.")})),Kn().update(e.initialScope);const r=new t(e);return iRe(r),r.init(),r}function iRe(t){Kn().setClient(t)}function sRe(t){const e=[];function n(){return t===void 0||e.length<t}function r(o){return e.splice(e.indexOf(o),1)[0]||Promise.resolve(void 0)}function i(o){if(!n())return ZC(new Ec("Not adding Promise because buffer limit was reached."));const a=o();return e.indexOf(a)===-1&&e.push(a),a.then(()=>r(a)).then(null,()=>r(a).then(null,()=>{})),a}function s(o){return new xa((a,c)=>{let l=e.length;if(!l)return a(!0);const d=setTimeout(()=>{o&&o>0&&a(!1)},o);e.forEach(h=>{Dp(h).then(()=>{--l||(clearTimeout(d),a(!0))},c)})})}return{$:e,add:i,drain:s}}const oRe=60*1e3;function aRe(t,e=Date.now()){const n=parseInt(`${t}`,10);if(!isNaN(n))return n*1e3;const r=Date.parse(`${t}`);return isNaN(r)?oRe:r-e}function cRe(t,e){return t[e]||t.all||0}function lRe(t,e,n=Date.now()){return cRe(t,e)>n}function uRe(t,{statusCode:e,headers:n},r=Date.now()){const i={...t},s=n&&n["x-sentry-rate-limits"],o=n&&n["retry-after"];if(s)for(const a of s.trim().split(",")){const[c,l,,,d]=a.split(":",5),h=parseInt(c,10),m=(isNaN(h)?60:h)*1e3;if(!l)i.all=r+m;else for(const g of l.split(";"))g==="metric_bucket"?(!d||d.split(";").includes("custom"))&&(i[g]=r+m):i[g]=r+m}else o?i.all=r+aRe(o,r):e===429&&(i.all=r+60*1e3);return i}const dRe=64;function fRe(t,e,n=sRe(t.bufferSize||dRe)){let r={};const i=o=>n.drain(o);function s(o){const a=[];if(Uq(o,(h,m)=>{const g=jq(m);if(lRe(r,g)){const y=Jq(h,m);t.recordDroppedEvent("ratelimit_backoff",g,y)}else a.push(h)}),a.length===0)return Dp({});const c=Cy(o[0],a),l=h=>{Uq(c,(m,g)=>{const y=Jq(m,g);t.recordDroppedEvent(h,jq(g),y)})},d=()=>e({body:nTe(c)}).then(h=>(h.statusCode!==void 0&&(h.statusCode<200||h.statusCode>=300)&&Lt&&je.warn(`Sentry responded with status code ${h.statusCode} to sent event.`),r=uRe(r,h),h),h=>{throw l("network_error"),h});return n.add(d).then(h=>h,h=>{if(h instanceof Ec)return Lt&&je.error("Skipped sending event because buffer is full."),l("queue_overflow"),Dp({});throw h})}return{send:s,flush:i}}function Jq(t,e){if(!(e!=="event"&&e!=="transaction"))return Array.isArray(t)?t[1]:void 0}function zte(t,e,n=[e],r="npm"){const i=t._metadata||{};i.sdk||(i.sdk={name:`sentry.javascript.${e}`,packages:n.map(s=>({name:`${r}:@sentry/${s}`,version:bp})),version:bp}),t._metadata=i}function Wte(t={}){const e=mn();if(!VTe()||!e)return{};const n=nm(),r=_y(n);if(r.getTraceData)return r.getTraceData(t);const i=Kn(),s=t.span||ss(),o=s?U3e(s):hRe(i),a=s?wy(s):Ate(e,i),c=A3e(a);return bte.test(o)?{"sentry-trace":o,baggage:c}:(je.warn("Invalid sentry-trace data. Cannot generate trace data"),{})}function hRe(t){const{traceId:e,sampled:n,spanId:r}=t.getPropagationContext();return _te(e,r,n)}const pRe=100;function Np(t,e){const n=mn(),r=$l();if(!n)return;const{beforeBreadcrumb:i=null,maxBreadcrumbs:s=pRe}=n.getOptions();if(s<=0)return;const a={timestamp:B_(),...t},c=i?tm(()=>i(a,e)):a;c!==null&&(n.emit&&n.emit("beforeAddBreadcrumb",c,e),r.addBreadcrumb(c,s))}let Qq;const mRe="FunctionToString",Zq=new WeakMap,gRe=(()=>({name:mRe,setupOnce(){Qq=Function.prototype.toString;try{Function.prototype.toString=function(...t){const e=s7(this),n=Zq.has(mn())&&e!==void 0?e:this;return Qq.apply(n,t)}}catch{}},setup(t){Zq.set(t,!0)}})),vRe=gRe,yRe=[/^Script error\.?$/,/^Javascript error: Script error\.? on line 0$/,/^ResizeObserver loop completed with undelivered notifications.$/,/^Cannot redefine property: googletag$/,"undefined is not an object (evaluating 'a.L')",`can't redefine non-configurable property "solana"`,"vv().getRestrictions is not a function. (In 'vv().getRestrictions(1,a)', 'vv().getRestrictions' is undefined)","Can't find variable: _AutofillCallbackHandler",/^Non-Error promise rejection captured with value: Object Not Found Matching Id:\d+, MethodName:simulateEvent, ParamCount:\d+$/],bRe="InboundFilters",_Re=((t={})=>({name:bRe,processEvent(e,n,r){const i=r.getOptions(),s=wRe(t,i);return ERe(e,s)?null:e}})),SRe=_Re;function wRe(t={},e={}){return{allowUrls:[...t.allowUrls||[],...e.allowUrls||[]],denyUrls:[...t.denyUrls||[],...e.denyUrls||[]],ignoreErrors:[...t.ignoreErrors||[],...e.ignoreErrors||[],...t.disableErrorDefaults?[]:yRe],ignoreTransactions:[...t.ignoreTransactions||[],...e.ignoreTransactions||[]],ignoreInternal:t.ignoreInternal!==void 0?t.ignoreInternal:!0}}function ERe(t,e){return e.ignoreInternal&&xRe(t)?(Lt&&je.warn(`Event dropped due to being internal Sentry Error.
Event: ${df(t)}`),!0):CRe(t,e.ignoreErrors)?(Lt&&je.warn(`Event dropped due to being matched by \`ignoreErrors\` option.
Event: ${df(t)}`),!0):LRe(t)?(Lt&&je.warn(`Event dropped due to not having an error message, error type or stacktrace.
Event: ${df(t)}`),!0):TRe(t,e.ignoreTransactions)?(Lt&&je.warn(`Event dropped due to being matched by \`ignoreTransactions\` option.
Event: ${df(t)}`),!0):RRe(t,e.denyUrls)?(Lt&&je.warn(`Event dropped due to being matched by \`denyUrls\` option.
Event: ${df(t)}.
Url: ${t3(t)}`),!0):kRe(t,e.allowUrls)?!1:(Lt&&je.warn(`Event dropped due to not being matched by \`allowUrls\` option.
Event: ${df(t)}.
Url: ${t3(t)}`),!0)}function CRe(t,e){return t.type||!e||!e.length?!1:IRe(t).some(n=>_p(n,e))}function TRe(t,e){if(t.type!=="transaction"||!e||!e.length)return!1;const n=t.transaction;return n?_p(n,e):!1}function RRe(t,e){if(!e||!e.length)return!1;const n=t3(t);return n?_p(n,e):!1}function kRe(t,e){if(!e||!e.length)return!0;const n=t3(t);return n?_p(n,e):!0}function IRe(t){const e=[];t.message&&e.push(t.message);let n;try{n=t.exception.values[t.exception.values.length-1]}catch{}return n&&n.value&&(e.push(n.value),n.type&&e.push(`${n.type}: ${n.value}`)),e}function xRe(t){try{return t.exception.values[0].type==="SentryError"}catch{}return!1}function ARe(t=[]){for(let e=t.length-1;e>=0;e--){const n=t[e];if(n&&n.filename!=="<anonymous>"&&n.filename!=="[native code]")return n.filename||null}return null}function t3(t){try{let e;try{e=t.exception.values[0].stacktrace.frames}catch{}return e?ARe(e):null}catch{return Lt&&je.error(`Cannot extract url for event ${df(t)}`),null}}function LRe(t){return t.type||!t.exception||!t.exception.values||t.exception.values.length===0?!1:!t.message&&!t.exception.values.some(e=>e.stacktrace||e.type&&e.type!=="Error"||e.value)}function MRe(t,e,n=250,r,i,s,o){if(!s.exception||!s.exception.values||!o||!id(o.originalException,Error))return;const a=s.exception.values.length>0?s.exception.values[s.exception.values.length-1]:void 0;a&&(s.exception.values=ORe(PL(t,e,i,o.originalException,r,s.exception.values,a,0),n))}function PL(t,e,n,r,i,s,o,a){if(s.length>=n+1)return s;let c=[...s];if(id(r[i],Error)){eV(o,a);const l=t(e,r[i]),d=c.length;tV(l,i,d,a),c=PL(t,e,n,r[i],i,[l,...c],l,d)}return Array.isArray(r.errors)&&r.errors.forEach((l,d)=>{if(id(l,Error)){eV(o,a);const h=t(e,l),m=c.length;tV(h,`errors[${d}]`,m,a),c=PL(t,e,n,l,i,[h,...c],h,m)}}),c}function eV(t,e){t.mechanism=t.mechanism||{type:"generic",handled:!0},t.mechanism={...t.mechanism,...t.type==="AggregateError"&&{is_exception_group:!0},exception_id:e}}function tV(t,e,n,r){t.mechanism=t.mechanism||{type:"generic",handled:!0},t.mechanism={...t.mechanism,type:"chained",source:e,exception_id:n,parent_id:r}}function ORe(t,e){return t.map(n=>(n.value&&(n.value=cv(n.value,e)),n))}function Ep(t){if(!t)return{};const e=t.match(/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/);if(!e)return{};const n=e[6]||"",r=e[8]||"";return{host:e[4],path:e[5],protocol:e[2],search:n,hash:r,relative:e[5]+n+r}}function nV(t){return t.split(/\\?\//).filter(e=>e.length>0&&e!==",").length}function PRe(t){const e="console";uh(e,t),dh(e,DRe)}function DRe(){"console"in cn&&EL.forEach(function(t){t in cn.console&&Jo(cn.console,t,function(e){return QC[t]=e,function(...n){Ba("console",{args:n,level:t});const i=QC[t];i&&i.apply(cn.console,n)}})})}function NRe(t){return t==="warn"?"warning":["fatal","error","warning","log","info","debug"].includes(t)?t:"log"}const URe="Dedupe",jRe=(()=>{let t;return{name:URe,processEvent(e){if(e.type)return e;try{if($Re(e,t))return Lt&&je.warn("Event dropped due to being a duplicate of previously captured event."),null}catch{}return t=e}}}),FRe=jRe;function $Re(t,e){return e?!!(BRe(t,e)||HRe(t,e)):!1}function BRe(t,e){const n=t.message,r=e.message;return!(!n&&!r||n&&!r||!n&&r||n!==r||!Xte(t,e)||!Yte(t,e))}function HRe(t,e){const n=rV(e),r=rV(t);return!(!n||!r||n.type!==r.type||n.value!==r.value||!Xte(t,e)||!Yte(t,e))}function Yte(t,e){let n=wq(t),r=wq(e);if(!n&&!r)return!0;if(n&&!r||!n&&r||(n=n,r=r,r.length!==n.length))return!1;for(let i=0;i<r.length;i++){const s=r[i],o=n[i];if(s.filename!==o.filename||s.lineno!==o.lineno||s.colno!==o.colno||s.function!==o.function)return!1}return!0}function Xte(t,e){let n=t.fingerprint,r=e.fingerprint;if(!n&&!r)return!0;if(n&&!r||!n&&r)return!1;n=n,r=r;try{return n.join("")===r.join("")}catch{return!1}}function rV(t){return t.exception&&t.exception.values&&t.exception.values[0]}function qRe(t,e,n,r,i="auto.http.browser"){if(!t.fetchData)return;const s=Yf()&&e(t.fetchData.url);if(t.endTimestamp&&s){const m=t.fetchData.__span;if(!m)return;const g=r[m];g&&(GRe(g,t),delete r[m]);return}const{method:o,url:a}=t.fetchData,c=KRe(a),l=c?Ep(c).host:void 0,d=!!ss(),h=s&&d?H_({name:`${o} ${a}`,attributes:{url:a,type:"fetch","http.method":o,"http.url":c,"server.address":l,[ai]:i,[sd]:"http.client"}}):new Sy;if(t.fetchData.__span=h.spanContext().spanId,r[h.spanContext().spanId]=h,n(t.fetchData.url)){const m=t.args[0],g=t.args[1]||{},y=VRe(m,g,Yf()&&d?h:void 0);y&&(t.args[1]=g,g.headers=y)}return h}function VRe(t,e,n){const r=Wte({span:n}),i=r["sentry-trace"],s=r.baggage;if(!i)return;const o=e.headers||(zRe(t)?t.headers:void 0);if(o)if(WRe(o)){const a=new Headers(o);if(a.set("sentry-trace",i),s){const c=a.get("baggage");if(c){const l=fw(c);a.set("baggage",l?`${l},${s}`:s)}else a.set("baggage",s)}return a}else if(Array.isArray(o)){const a=[...o.filter(c=>!(Array.isArray(c)&&c[0]==="sentry-trace")).map(c=>{if(Array.isArray(c)&&c[0]==="baggage"&&typeof c[1]=="string"){const[l,d,...h]=c;return[l,fw(d),...h]}else return c}),["sentry-trace",i]];return s&&a.push(["baggage",s]),a}else{const a="baggage"in o?o.baggage:void 0;let c=[];return Array.isArray(a)?c=a.map(l=>typeof l=="string"?fw(l):l).filter(l=>l===""):a&&c.push(fw(a)),s&&c.push(s),{...o,"sentry-trace":i,baggage:c.length>0?c.join(","):void 0}}else return{...r}}function KRe(t){try{return new URL(t).href}catch{return}}function GRe(t,e){if(e.response){vte(t,e.response.status);const n=e.response&&e.response.headers&&e.response.headers.get("content-length");if(n){const r=parseInt(n);r>0&&t.setAttribute("http.response_content_length",r)}}else e.error&&t.setStatus({code:Ai,message:"internal_error"});t.end()}function fw(t){return t.split(",").filter(e=>!e.split("=")[0].startsWith(c7)).join(",")}function zRe(t){return typeof Request<"u"&&id(t,Request)}function WRe(t){return typeof Headers<"u"&&id(t,Headers)}function Jte(t){if(t!==void 0)return t>=400&&t<500?"warning":t>=500?"error":void 0}const DL=cn;function Qte(){if(!("fetch"in DL))return!1;try{return new Headers,new Request("http://www.example.com"),new Response,!0}catch{return!1}}function NL(t){return t&&/^function\s+\w+\(\)\s+\{\s+\[native code\]\s+\}$/.test(t.toString())}function YRe(){if(typeof EdgeRuntime=="string")return!0;if(!Qte())return!1;if(NL(DL.fetch))return!0;let t=!1;const e=DL.document;if(e&&typeof e.createElement=="function")try{const n=e.createElement("iframe");n.hidden=!0,e.head.appendChild(n),n.contentWindow&&n.contentWindow.fetch&&(t=NL(n.contentWindow.fetch)),e.head.removeChild(n)}catch(n){lh&&je.warn("Could not create sandbox iframe for pure fetch check, bailing to window.fetch: ",n)}return t}function Zte(t,e){const n="fetch";uh(n,t),dh(n,()=>ene(void 0,e))}function XRe(t){const e="fetch-body-resolved";uh(e,t),dh(e,()=>ene(QRe))}function ene(t,e=!1){e&&!YRe()||Jo(cn,"fetch",function(n){return function(...r){const i=new Error,{method:s,url:o}=ZRe(r),a={args:r,fetchData:{method:s,url:o},startTimestamp:Ds()*1e3,virtualError:i};return t||Ba("fetch",{...a}),n.apply(cn,r).then(async c=>(t?t(c):Ba("fetch",{...a,endTimestamp:Ds()*1e3,response:c}),c),c=>{throw Ba("fetch",{...a,endTimestamp:Ds()*1e3,error:c}),VT(c)&&c.stack===void 0&&(c.stack=i.stack,Wa(c,"framesToPop",1)),c})}})}async function JRe(t,e){if(t&&t.body){const n=t.body,r=n.getReader(),i=setTimeout(()=>{n.cancel().then(null,()=>{})},90*1e3);let s=!0;for(;s;){let o;try{o=setTimeout(()=>{n.cancel().then(null,()=>{})},5e3);const{done:a}=await r.read();clearTimeout(o),a&&(e(),s=!1)}catch{s=!1}finally{clearTimeout(o)}}clearTimeout(i),r.releaseLock(),n.cancel().then(null,()=>{})}}function QRe(t){let e;try{e=t.clone()}catch{return}JRe(e,()=>{Ba("fetch-body-resolved",{endTimestamp:Ds()*1e3,response:t})})}function UL(t,e){return!!t&&typeof t=="object"&&!!t[e]}function iV(t){return typeof t=="string"?t:t?UL(t,"url")?t.url:t.toString?t.toString():"":""}function ZRe(t){if(t.length===0)return{method:"GET",url:""};if(t.length===2){const[n,r]=t;return{url:iV(n),method:UL(r,"method")?String(r.method).toUpperCase():"GET"}}const e=t[0];return{url:iV(e),method:UL(e,"method")?String(e.method).toUpperCase():"GET"}}function e4e(){return"npm"}const hw=cn;function t4e(){const t=hw.chrome,e=t&&t.app&&t.app.runtime,n="history"in hw&&!!hw.history.pushState&&!!hw.history.replaceState;return!e&&n}const at=cn;let jL=0;function tne(){return jL>0}function n4e(){jL++,setTimeout(()=>{jL--})}function Fv(t,e={}){function n(i){return typeof i=="function"}if(!n(t))return t;try{const i=t.__sentry_wrapped__;if(i)return typeof i=="function"?i:t;if(s7(t))return t}catch{return t}const r=function(...i){try{const s=i.map(o=>Fv(o,e));return t.apply(this,s)}catch(s){throw n4e(),WT(o=>{o.addEventProcessor(a=>(e.mechanism&&(TL(a,void 0),Nv(a,e.mechanism)),a.extra={...a.extra,arguments:i},a)),JT(s)}),s}};try{for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}catch{}dte(r,t),Wa(t,"__sentry_wrapped__",r);try{Object.getOwnPropertyDescriptor(r,"name").configurable&&Object.defineProperty(r,"name",{get(){return t.name}})}catch{}return r}const Zo=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__;function d7(t,e){const n=f7(t,e),r={type:a4e(e),value:c4e(e)};return n.length&&(r.stacktrace={frames:n}),r.type===void 0&&r.value===""&&(r.value="Unrecoverable error caught"),r}function r4e(t,e,n,r){const i=mn(),s=i&&i.getOptions().normalizeDepth,o=h4e(e),a={__serialized__:Pte(e,s)};if(o)return{exception:{values:[d7(t,o)]},extra:a};const c={exception:{values:[{type:KT(e)?e.constructor.name:r?"UnhandledRejection":"Error",value:d4e(e,{isUnhandledRejection:r})}]},extra:a};if(n){const l=f7(t,n);l.length&&(c.exception.values[0].stacktrace={frames:l})}return c}function qx(t,e){return{exception:{values:[d7(t,e)]}}}function f7(t,e){const n=e.stacktrace||e.stack||"",r=s4e(e),i=o4e(e);try{return t(n,r,i)}catch{}return[]}const i4e=/Minified React error #\d+;/i;function s4e(t){return t&&i4e.test(t.message)?1:0}function o4e(t){return typeof t.framesToPop=="number"?t.framesToPop:0}function nne(t){return typeof WebAssembly<"u"&&typeof WebAssembly.Exception<"u"?t instanceof WebAssembly.Exception:!1}function a4e(t){const e=t&&t.name;return!e&&nne(t)?t.message&&Array.isArray(t.message)&&t.message.length==2?t.message[0]:"WebAssembly.Exception":e}function c4e(t){const e=t&&t.message;return e?e.error&&typeof e.error.message=="string"?e.error.message:nne(t)&&Array.isArray(t.message)&&t.message.length==2?t.message[1]:e:"No error message"}function l4e(t,e,n,r){const i=n&&n.syntheticException||void 0,s=h7(t,e,i,r);return Nv(s),s.level="error",n&&n.event_id&&(s.event_id=n.event_id),Dp(s)}function u4e(t,e,n="info",r,i){const s=r&&r.syntheticException||void 0,o=FL(t,e,s,i);return o.level=n,r&&r.event_id&&(o.event_id=r.event_id),Dp(o)}function h7(t,e,n,r,i){let s;if(cte(e)&&e.error)return qx(t,e.error);if(Cq(e)||ZCe(e)){const o=e;if("stack"in e)s=qx(t,e);else{const a=o.name||(Cq(o)?"DOMError":"DOMException"),c=o.message?`${a}: ${o.message}`:a;s=FL(t,c,n,r),TL(s,c)}return"code"in o&&(s.tags={...s.tags,"DOMException.code":`${o.code}`}),s}return VT(e)?qx(t,e):Dv(e)||KT(e)?(s=r4e(t,e,n,i),Nv(s,{synthetic:!0}),s):(s=FL(t,e,n,r),TL(s,`${e}`),Nv(s,{synthetic:!0}),s)}function FL(t,e,n,r){const i={};if(r&&n){const s=f7(t,n);s.length&&(i.exception={values:[{value:e,stacktrace:{frames:s}}]}),Nv(i,{synthetic:!0})}if(r7(e)){const{__sentry_template_string__:s,__sentry_template_values__:o}=e;return i.logentry={message:s,params:o},i}return i.message=e,i}function d4e(t,{isUnhandledRejection:e}){const n=c3e(t),r=e?"promise rejection":"exception";return cte(t)?`Event \`ErrorEvent\` captured as ${r} with message \`${t.message}\``:KT(t)?`Event \`${f4e(t)}\` (type=${t.type}) captured as ${r}`:`Object captured as ${r} with keys: ${n}`}function f4e(t){try{const e=Object.getPrototypeOf(t);return e?e.constructor.name:void 0}catch{}}function h4e(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e)){const n=t[e];if(n instanceof Error)return n}}function p4e(t,{metadata:e,tunnel:n,dsn:r}){const i={event_id:t.event_id,sent_at:new Date().toISOString(),...e&&e.sdk&&{sdk:{name:e.sdk.name,version:e.sdk.version}},...!!n&&!!r&&{dsn:Ey(r)}},s=m4e(t);return Cy(i,[s])}function m4e(t){return[{type:"user_report"},t]}class g4e extends eRe{constructor(e){const n={parentSpanIsAlwaysRootSpan:!0,...e},r=at.SENTRY_SDK_SOURCE||e4e();zte(n,"browser",["browser"],r),super(n),n.sendClientReports&&at.document&&at.document.addEventListener("visibilitychange",()=>{at.document.visibilityState==="hidden"&&this._flushOutcomes()})}eventFromException(e,n){return l4e(this._options.stackParser,e,n,this._options.attachStacktrace)}eventFromMessage(e,n="info",r){return u4e(this._options.stackParser,e,n,r,this._options.attachStacktrace)}captureUserFeedback(e){if(!this._isEnabled()){Zo&&je.warn("SDK not enabled, will not capture user feedback.");return}const n=p4e(e,{metadata:this.getSdkMetadata(),dsn:this.getDsn(),tunnel:this.getOptions().tunnel});this.sendEnvelope(n)}_prepareEvent(e,n,r){return e.platform=e.platform||"javascript",super._prepareEvent(e,n,r)}}const p7=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,v4e=(t,e)=>t>e[1]?"poor":t>e[0]?"needs-improvement":"good",Ty=(t,e,n,r)=>{let i,s;return o=>{e.value>=0&&(o||r)&&(s=e.value-(i||0),(s||i===void 0)&&(i=e.value,e.delta=s,e.rating=v4e(e.value,n),t(e)))}},ut=cn,y4e=()=>`v4-${Date.now()}-${Math.floor(Math.random()*(9e12-1))+1e12}`,q_=(t=!0)=>{const e=ut.performance&&ut.performance.getEntriesByType&&ut.performance.getEntriesByType("navigation")[0];if(!t||e&&e.responseStart>0&&e.responseStart<performance.now())return e},V_=()=>{const t=q_();return t&&t.activationStart||0},Ry=(t,e)=>{const n=q_();let r="navigate";return n&&(ut.document&&ut.document.prerendering||V_()>0?r="prerender":ut.document&&ut.document.wasDiscarded?r="restore":n.type&&(r=n.type.replace(/_/g,"-"))),{name:t,value:typeof e>"u"?-1:e,rating:"good",delta:0,entries:[],id:y4e(),navigationType:r}},im=(t,e,n)=>{try{if(PerformanceObserver.supportedEntryTypes.includes(t)){const r=new PerformanceObserver(i=>{Promise.resolve().then(()=>{e(i.getEntries())})});return r.observe(Object.assign({type:t,buffered:!0},n||{})),r}}catch{}},ky=t=>{const e=n=>{(n.type==="pagehide"||ut.document&&ut.document.visibilityState==="hidden")&&t(n)};ut.document&&(addEventListener("visibilitychange",e,!0),addEventListener("pagehide",e,!0))},QT=t=>{let e=!1;return()=>{e||(t(),e=!0)}};let J1=-1;const b4e=()=>ut.document.visibilityState==="hidden"&&!ut.document.prerendering?0:1/0,n3=t=>{ut.document.visibilityState==="hidden"&&J1>-1&&(J1=t.type==="visibilitychange"?t.timeStamp:0,S4e())},_4e=()=>{addEventListener("visibilitychange",n3,!0),addEventListener("prerenderingchange",n3,!0)},S4e=()=>{removeEventListener("visibilitychange",n3,!0),removeEventListener("prerenderingchange",n3,!0)},ZT=()=>(ut.document&&J1<0&&(J1=b4e(),_4e()),{get firstHiddenTime(){return J1}}),K_=t=>{ut.document&&ut.document.prerendering?addEventListener("prerenderingchange",()=>t(),!0):t()},w4e=[1800,3e3],E4e=(t,e={})=>{K_(()=>{const n=ZT(),r=Ry("FCP");let i;const o=im("paint",a=>{a.forEach(c=>{c.name==="first-contentful-paint"&&(o.disconnect(),c.startTime<n.firstHiddenTime&&(r.value=Math.max(c.startTime-V_(),0),r.entries.push(c),i(!0)))})});o&&(i=Ty(t,r,w4e,e.reportAllChanges))})},C4e=[.1,.25],T4e=(t,e={})=>{E4e(QT(()=>{const n=Ry("CLS",0);let r,i=0,s=[];const o=c=>{c.forEach(l=>{if(!l.hadRecentInput){const d=s[0],h=s[s.length-1];i&&d&&h&&l.startTime-h.startTime<1e3&&l.startTime-d.startTime<5e3?(i+=l.value,s.push(l)):(i=l.value,s=[l])}}),i>n.value&&(n.value=i,n.entries=s,r())},a=im("layout-shift",o);a&&(r=Ty(t,n,C4e,e.reportAllChanges),ky(()=>{o(a.takeRecords()),r(!0)}),setTimeout(r,0))}))},R4e=[100,300],k4e=(t,e={})=>{K_(()=>{const n=ZT(),r=Ry("FID");let i;const s=c=>{c.startTime<n.firstHiddenTime&&(r.value=c.processingStart-c.startTime,r.entries.push(c),i(!0))},o=c=>{c.forEach(s)},a=im("first-input",o);i=Ty(t,r,R4e,e.reportAllChanges),a&&ky(QT(()=>{o(a.takeRecords()),a.disconnect()}))})};let rne=0,Vx=1/0,pw=0;const I4e=t=>{t.forEach(e=>{e.interactionId&&(Vx=Math.min(Vx,e.interactionId),pw=Math.max(pw,e.interactionId),rne=pw?(pw-Vx)/7+1:0)})};let $L;const x4e=()=>$L?rne:performance.interactionCount||0,A4e=()=>{"interactionCount"in performance||$L||($L=im("event",I4e,{type:"event",buffered:!0,durationThreshold:0}))},Su=[],Kx=new Map,L4e=40;let M4e=0;const O4e=()=>x4e()-M4e,P4e=()=>{const t=Math.min(Su.length-1,Math.floor(O4e()/50));return Su[t]},Gx=10,D4e=[],N4e=t=>{if(D4e.forEach(r=>r(t)),!(t.interactionId||t.entryType==="first-input"))return;const e=Su[Su.length-1],n=Kx.get(t.interactionId);if(n||Su.length<Gx||e&&t.duration>e.latency){if(n)t.duration>n.latency?(n.entries=[t],n.latency=t.duration):t.duration===n.latency&&t.startTime===(n.entries[0]&&n.entries[0].startTime)&&n.entries.push(t);else{const r={id:t.interactionId,latency:t.duration,entries:[t]};Kx.set(r.id,r),Su.push(r)}Su.sort((r,i)=>i.latency-r.latency),Su.length>Gx&&Su.splice(Gx).forEach(r=>Kx.delete(r.id))}},ine=t=>{const e=ut.requestIdleCallback||ut.setTimeout;let n=-1;return t=QT(t),ut.document&&ut.document.visibilityState==="hidden"?t():(n=e(t),ky(t)),n},U4e=[200,500],j4e=(t,e={})=>{"PerformanceEventTiming"in ut&&"interactionId"in PerformanceEventTiming.prototype&&K_(()=>{A4e();const n=Ry("INP");let r;const i=o=>{ine(()=>{o.forEach(N4e);const a=P4e();a&&a.latency!==n.value&&(n.value=a.latency,n.entries=a.entries,r())})},s=im("event",i,{durationThreshold:e.durationThreshold!=null?e.durationThreshold:L4e});r=Ty(t,n,U4e,e.reportAllChanges),s&&(s.observe({type:"first-input",buffered:!0}),ky(()=>{i(s.takeRecords()),r(!0)}))})},F4e=[2500,4e3],sV={},$4e=(t,e={})=>{K_(()=>{const n=ZT(),r=Ry("LCP");let i;const s=a=>{e.reportAllChanges||(a=a.slice(-1)),a.forEach(c=>{c.startTime<n.firstHiddenTime&&(r.value=Math.max(c.startTime-V_(),0),r.entries=[c],i())})},o=im("largest-contentful-paint",s);if(o){i=Ty(t,r,F4e,e.reportAllChanges);const a=QT(()=>{sV[r.id]||(s(o.takeRecords()),o.disconnect(),sV[r.id]=!0,i(!0))});["keydown","click"].forEach(c=>{ut.document&&addEventListener(c,()=>ine(a),{once:!0,capture:!0})}),ky(a)}})},B4e=[800,1800],BL=t=>{ut.document&&ut.document.prerendering?K_(()=>BL(t)):ut.document&&ut.document.readyState!=="complete"?addEventListener("load",()=>BL(t),!0):setTimeout(t,0)},H4e=(t,e={})=>{const n=Ry("TTFB"),r=Ty(t,n,B4e,e.reportAllChanges);BL(()=>{const i=q_();i&&(n.value=Math.max(i.responseStart-V_(),0),n.entries=[i],r(!0))})},Q1={},r3={};let sne,one,ane,cne,lne;function une(t,e=!1){return G_("cls",t,z4e,sne,e)}function q4e(t,e=!1){return G_("lcp",t,Y4e,ane,e)}function V4e(t){return G_("fid",t,W4e,one)}function K4e(t){return G_("ttfb",t,X4e,cne)}function G4e(t){return G_("inp",t,J4e,lne)}function Yb(t,e){return dne(t,e),r3[t]||(Q4e(t),r3[t]=!0),fne(t,e)}function Iy(t,e){const n=Q1[t];if(!(!n||!n.length))for(const r of n)try{r(e)}catch(i){p7&&je.error(`Error while triggering instrumentation handler.
Type: ${t}
Name: ${rd(r)}
Error:`,i)}}function z4e(){return T4e(t=>{Iy("cls",{metric:t}),sne=t},{reportAllChanges:!0})}function W4e(){return k4e(t=>{Iy("fid",{metric:t}),one=t})}function Y4e(){return $4e(t=>{Iy("lcp",{metric:t}),ane=t},{reportAllChanges:!0})}function X4e(){return H4e(t=>{Iy("ttfb",{metric:t}),cne=t})}function J4e(){return j4e(t=>{Iy("inp",{metric:t}),lne=t})}function G_(t,e,n,r,i=!1){dne(t,e);let s;return r3[t]||(s=n(),r3[t]=!0),r&&e({metric:r}),fne(t,e,i?s:void 0)}function Q4e(t){const e={};t==="event"&&(e.durationThreshold=0),im(t,n=>{Iy(t,{entries:n})},e)}function dne(t,e){Q1[t]=Q1[t]||[],Q1[t].push(e)}function fne(t,e,n){return()=>{n&&n();const r=Q1[t];if(!r)return;const i=r.indexOf(e);i!==-1&&r.splice(i,1)}}function Z4e(t){return"duration"in t}function zx(t){return typeof t=="number"&&isFinite(t)}function od(t,e,n,{...r}){const i=hn(t).start_timestamp;return i&&i>e&&typeof t.updateStartTime=="function"&&t.updateStartTime(e),Ute(t,()=>{const s=H_({startTime:e,...r});return s&&s.end(n),s})}function hne(t){const e=mn();if(!e)return;const{name:n,transaction:r,attributes:i,startTime:s}=t,{release:o,environment:a}=e.getOptions(),c=e.getIntegrationByName("Replay"),l=c&&c.getReplayId(),d=Kn(),h=d.getUser(),m=h!==void 0?h.email||h.id||h.ip_address:void 0;let g;try{g=d.getScopeData().contexts.profile.profile_id}catch{}const y={release:o,environment:a,user:m||void 0,profile_id:g||void 0,replay_id:l||void 0,transaction:r,"user_agent.original":ut.navigator&&ut.navigator.userAgent,...i};return H_({name:n,attributes:y,startTime:s,experimental:{standalone:!0}})}function m7(){return ut&&ut.addEventListener&&ut.performance}function Hr(t){return t/1e3}function pne(t){let e="unknown",n="unknown",r="";for(const i of t){if(i==="/"){[e,n]=t.split("/");break}if(!isNaN(Number(i))){e=r==="h"?"http":r,n=t.split(r)[1];break}r+=i}return r===t&&(e=r),{name:e,version:n}}function eke(){let t=0,e,n;if(!nke())return;let r=!1;function i(){r||(r=!0,n&&tke(t,e,n),s())}const s=une(({metric:o})=>{const a=o.entries[o.entries.length-1];a&&(t=o.value,e=a)},!0);ky(()=>{i()}),setTimeout(()=>{const o=mn();if(!o)return;const a=o.on("startNavigationSpan",()=>{i(),a&&a()}),c=ss(),l=c&&is(c),d=l&&hn(l);d&&d.op==="pageload"&&(n=l.spanContext().spanId)},0)}function tke(t,e,n){p7&&je.log(`Sending CLS span (${t})`);const r=Hr((bo||0)+(e&&e.startTime||0)),i=Kn().getScopeData().transactionName,s=e?Pp(e.sources[0]&&e.sources[0].node):"Layout shift",o=rs({[ai]:"auto.http.browser.cls",[sd]:"ui.webvital.cls",[a7]:e&&e.duration||0,"sentry.pageload.span_id":n}),a=hne({name:s,transaction:i,attributes:o,startTime:r});a&&(a.addEvent("cls",{[YT]:"",[XT]:t}),a.end(r))}function nke(){try{return PerformanceObserver.supportedEntryTypes.includes("layout-shift")}catch{return!1}}const rke=2147483647;let oV=0,Wi={},Zs,Z1;function ike({recordClsStandaloneSpans:t}){const e=m7();if(e&&bo){e.mark&&ut.performance.mark("sentry-tracing-init");const n=uke(),r=lke(),i=dke(),s=t?eke():cke();return()=>{n(),r(),i(),s&&s()}}return()=>{}}function ske(){Yb("longtask",({entries:t})=>{const e=ss();if(!e)return;const{op:n,start_timestamp:r}=hn(e);for(const i of t){const s=Hr(bo+i.startTime),o=Hr(i.duration);n==="navigation"&&r&&s<r||od(e,s,s+o,{name:"Main UI thread blocked",op:"ui.long-task",attributes:{[ai]:"auto.ui.browser.metrics"}})}})}function oke(){new PerformanceObserver(e=>{const n=ss();if(n)for(const r of e.getEntries()){if(!r.scripts[0])continue;const i=Hr(bo+r.startTime),{start_timestamp:s,op:o}=hn(n);if(o==="navigation"&&s&&i<s)continue;const a=Hr(r.duration),c={[ai]:"auto.ui.browser.metrics"},l=r.scripts[0],{invoker:d,invokerType:h,sourceURL:m,sourceFunctionName:g,sourceCharPosition:y}=l;c["browser.script.invoker"]=d,c["browser.script.invoker_type"]=h,m&&(c["code.filepath"]=m),g&&(c["code.function"]=g),y!==-1&&(c["browser.script.source_char_position"]=y),od(n,i,i+a,{name:"Main UI thread blocked",op:"ui.long-animation-frame",attributes:c})}}).observe({type:"long-animation-frame",buffered:!0})}function ake(){Yb("event",({entries:t})=>{const e=ss();if(e){for(const n of t)if(n.name==="click"){const r=Hr(bo+n.startTime),i=Hr(n.duration),s={name:Pp(n.target),op:`ui.interaction.${n.name}`,startTime:r,attributes:{[ai]:"auto.ui.browser.metrics"}},o=ute(n.target);o&&(s.attributes["ui.component_name"]=o),od(e,r,r+i,s)}}})}function cke(){return une(({metric:t})=>{const e=t.entries[t.entries.length-1];e&&(Wi.cls={value:t.value,unit:""},Z1=e)},!0)}function lke(){return q4e(({metric:t})=>{const e=t.entries[t.entries.length-1];e&&(Wi.lcp={value:t.value,unit:"millisecond"},Zs=e)},!0)}function uke(){return V4e(({metric:t})=>{const e=t.entries[t.entries.length-1];if(!e)return;const n=Hr(bo),r=Hr(e.startTime);Wi.fid={value:t.value,unit:"millisecond"},Wi["mark.fid"]={value:n+r,unit:"second"}})}function dke(){return K4e(({metric:t})=>{t.entries[t.entries.length-1]&&(Wi.ttfb={value:t.value,unit:"millisecond"})})}function fke(t,e){const n=m7();if(!n||!n.getEntries||!bo)return;const r=Hr(bo),i=n.getEntries(),{op:s,start_timestamp:o}=hn(t);if(i.slice(oV).forEach(a=>{const c=Hr(a.startTime),l=Hr(Math.max(0,a.duration));if(!(s==="navigation"&&o&&r+c<o))switch(a.entryType){case"navigation":{pke(t,a,r);break}case"mark":case"paint":case"measure":{hke(t,a,c,l,r);const d=ZT(),h=a.startTime<d.firstHiddenTime;a.name==="first-paint"&&h&&(Wi.fp={value:a.startTime,unit:"millisecond"}),a.name==="first-contentful-paint"&&h&&(Wi.fcp={value:a.startTime,unit:"millisecond"});break}case"resource":{vke(t,a,a.name,c,l,r);break}}}),oV=Math.max(i.length-1,0),yke(t),s==="pageload"){_ke(Wi);const a=Wi["mark.fid"];a&&Wi.fid&&(od(t,a.value,a.value+Hr(Wi.fid.value),{name:"first input delay",op:"ui.action",attributes:{[ai]:"auto.ui.browser.metrics"}}),delete Wi["mark.fid"]),(!("fcp"in Wi)||!e.recordClsOnPageloadSpan)&&delete Wi.cls,Object.entries(Wi).forEach(([c,l])=>{fTe(c,l.value,l.unit)}),t.setAttribute("performance.timeOrigin",r),t.setAttribute("performance.activationStart",V_()),bke(t)}Zs=void 0,Z1=void 0,Wi={}}function hke(t,e,n,r,i){const s=q_(!1),o=Hr(s?s.requestStart:0),a=i+Math.max(n,o),c=i+n,l=c+r,d={[ai]:"auto.resource.browser.metrics"};return a!==c&&(d["sentry.browser.measure_happened_before_request"]=!0,d["sentry.browser.measure_start_time"]=a),od(t,a,l,{name:e.name,op:e.entryType,attributes:d}),a}function pke(t,e,n){["unloadEvent","redirect","domContentLoadedEvent","loadEvent","connect"].forEach(r=>{mw(t,e,r,n)}),mw(t,e,"secureConnection",n,"TLS/SSL"),mw(t,e,"fetch",n,"cache"),mw(t,e,"domainLookup",n,"DNS"),gke(t,e,n)}function mw(t,e,n,r,i=n){const s=mke(n),o=e[s],a=e[`${n}Start`];!a||!o||od(t,r+Hr(a),r+Hr(o),{op:`browser.${i}`,name:e.name,attributes:{[ai]:"auto.ui.browser.metrics"}})}function mke(t){return t==="secureConnection"?"connectEnd":t==="fetch"?"domainLookupStart":`${t}End`}function gke(t,e,n){const r=n+Hr(e.requestStart),i=n+Hr(e.responseEnd),s=n+Hr(e.responseStart);e.responseEnd&&(od(t,r,i,{op:"browser.request",name:e.name,attributes:{[ai]:"auto.ui.browser.metrics"}}),od(t,s,i,{op:"browser.response",name:e.name,attributes:{[ai]:"auto.ui.browser.metrics"}}))}function vke(t,e,n,r,i,s){if(e.initiatorType==="xmlhttprequest"||e.initiatorType==="fetch")return;const o=Ep(n),a={[ai]:"auto.resource.browser.metrics"};Wx(a,e,"transferSize","http.response_transfer_size"),Wx(a,e,"encodedBodySize","http.response_content_length"),Wx(a,e,"decodedBodySize","http.decoded_response_content_length");const c=e.deliveryType;c!=null&&(a["http.response_delivery_type"]=c);const l=e.renderBlockingStatus;l&&(a["resource.render_blocking_status"]=l),o.protocol&&(a["url.scheme"]=o.protocol.split(":").pop()),o.host&&(a["server.address"]=o.host),a["url.same_origin"]=n.includes(ut.location.origin);const{name:d,version:h}=pne(e.nextHopProtocol);a["network.protocol.name"]=d,a["network.protocol.version"]=h;const m=s+r,g=m+i;od(t,m,g,{name:n.replace(ut.location.origin,""),op:e.initiatorType?`resource.${e.initiatorType}`:"resource.other",attributes:a})}function yke(t){const e=ut.navigator;if(!e)return;const n=e.connection;n&&(n.effectiveType&&t.setAttribute("effectiveConnectionType",n.effectiveType),n.type&&t.setAttribute("connectionType",n.type),zx(n.rtt)&&(Wi["connection.rtt"]={value:n.rtt,unit:"millisecond"})),zx(e.deviceMemory)&&t.setAttribute("deviceMemory",`${e.deviceMemory} GB`),zx(e.hardwareConcurrency)&&t.setAttribute("hardwareConcurrency",String(e.hardwareConcurrency))}function bke(t){Zs&&(Zs.element&&t.setAttribute("lcp.element",Pp(Zs.element)),Zs.id&&t.setAttribute("lcp.id",Zs.id),Zs.url&&t.setAttribute("lcp.url",Zs.url.trim().slice(0,200)),Zs.loadTime!=null&&t.setAttribute("lcp.loadTime",Zs.loadTime),Zs.renderTime!=null&&t.setAttribute("lcp.renderTime",Zs.renderTime),t.setAttribute("lcp.size",Zs.size)),Z1&&Z1.sources&&Z1.sources.forEach((e,n)=>t.setAttribute(`cls.source.${n+1}`,Pp(e.node)))}function Wx(t,e,n,r){const i=e[n];i!=null&&i<rke&&(t[r]=i)}function _ke(t){const e=q_(!1);if(!e)return;const{responseStart:n,requestStart:r}=e;r<=n&&(t["ttfb.requestTime"]={value:n-r,unit:"millisecond"})}const Ske=1e3;let aV,HL,qL;function wke(t){uh("dom",t),dh("dom",Eke)}function Eke(){if(!ut.document)return;const t=Ba.bind(null,"dom"),e=cV(t,!0);ut.document.addEventListener("click",e,!1),ut.document.addEventListener("keypress",e,!1),["EventTarget","Node"].forEach(n=>{const i=ut[n],s=i&&i.prototype;!s||!s.hasOwnProperty||!s.hasOwnProperty("addEventListener")||(Jo(s,"addEventListener",function(o){return function(a,c,l){if(a==="click"||a=="keypress")try{const d=this.__sentry_instrumentation_handlers__=this.__sentry_instrumentation_handlers__||{},h=d[a]=d[a]||{refCount:0};if(!h.handler){const m=cV(t);h.handler=m,o.call(this,a,m,l)}h.refCount++}catch{}return o.call(this,a,c,l)}}),Jo(s,"removeEventListener",function(o){return function(a,c,l){if(a==="click"||a=="keypress")try{const d=this.__sentry_instrumentation_handlers__||{},h=d[a];h&&(h.refCount--,h.refCount<=0&&(o.call(this,a,h.handler,l),h.handler=void 0,delete d[a]),Object.keys(d).length===0&&delete this.__sentry_instrumentation_handlers__)}catch{}return o.call(this,a,c,l)}}))})}function Cke(t){if(t.type!==HL)return!1;try{if(!t.target||t.target._sentryId!==qL)return!1}catch{}return!0}function Tke(t,e){return t!=="keypress"?!1:!e||!e.tagName?!0:!(e.tagName==="INPUT"||e.tagName==="TEXTAREA"||e.isContentEditable)}function cV(t,e=!1){return n=>{if(!n||n._sentryCaptured)return;const r=Rke(n);if(Tke(n.type,r))return;Wa(n,"_sentryCaptured",!0),r&&!r._sentryId&&Wa(r,"_sentryId",Ha());const i=n.type==="keypress"?"input":n.type;Cke(n)||(t({event:n,name:i,global:e}),HL=n.type,qL=r?r._sentryId:void 0),clearTimeout(aV),aV=ut.setTimeout(()=>{qL=void 0,HL=void 0},Ske)}}function Rke(t){try{return t.target}catch{return null}}let gw;function g7(t){const e="history";uh(e,t),dh(e,kke)}function kke(){if(!t4e())return;const t=ut.onpopstate;ut.onpopstate=function(...n){const r=ut.location.href,i=gw;if(gw=r,Ba("history",{from:i,to:r}),t)try{return t.apply(this,n)}catch{}};function e(n){return function(...r){const i=r.length>2?r[2]:void 0;if(i){const s=gw,o=String(i);gw=o,Ba("history",{from:s,to:o})}return n.apply(this,r)}}Jo(ut.history,"pushState",e),Jo(ut.history,"replaceState",e)}const FE={};function Ike(t){const e=FE[t];if(e)return e;let n=ut[t];if(NL(n))return FE[t]=n.bind(ut);const r=ut.document;if(r&&typeof r.createElement=="function")try{const i=r.createElement("iframe");i.hidden=!0,r.head.appendChild(i);const s=i.contentWindow;s&&s[t]&&(n=s[t]),r.head.removeChild(i)}catch(i){p7&&je.warn(`Could not create sandbox iframe for ${t} check, bailing to window.${t}: `,i)}return n&&(FE[t]=n.bind(ut))}function lV(t){FE[t]=void 0}const $g="__sentry_xhr_v3__";function mne(t){uh("xhr",t),dh("xhr",xke)}function xke(){if(!ut.XMLHttpRequest)return;const t=XMLHttpRequest.prototype;t.open=new Proxy(t.open,{apply(e,n,r){const i=new Error,s=Ds()*1e3,o=Ku(r[0])?r[0].toUpperCase():void 0,a=Ake(r[1]);if(!o||!a)return e.apply(n,r);n[$g]={method:o,url:a,request_headers:{}},o==="POST"&&a.match(/sentry_key/)&&(n.__sentry_own_request__=!0);const c=()=>{const l=n[$g];if(l&&n.readyState===4){try{l.status_code=n.status}catch{}const d={endTimestamp:Ds()*1e3,startTimestamp:s,xhr:n,virtualError:i};Ba("xhr",d)}};return"onreadystatechange"in n&&typeof n.onreadystatechange=="function"?n.onreadystatechange=new Proxy(n.onreadystatechange,{apply(l,d,h){return c(),l.apply(d,h)}}):n.addEventListener("readystatechange",c),n.setRequestHeader=new Proxy(n.setRequestHeader,{apply(l,d,h){const[m,g]=h,y=d[$g];return y&&Ku(m)&&Ku(g)&&(y.request_headers[m.toLowerCase()]=g),l.apply(d,h)}}),e.apply(n,r)}}),t.send=new Proxy(t.send,{apply(e,n,r){const i=n[$g];if(!i)return e.apply(n,r);r[0]!==void 0&&(i.body=r[0]);const s={startTimestamp:Ds()*1e3,xhr:n};return Ba("xhr",s),e.apply(n,r)}})}function Ake(t){if(Ku(t))return t;try{return t.toString()}catch{}}const Yx=[],$E=new Map;function Lke(){if(m7()&&bo){const e=Mke();return()=>{e()}}return()=>{}}const uV={click:"click",pointerdown:"click",pointerup:"click",mousedown:"click",mouseup:"click",touchstart:"click",touchend:"click",mouseover:"hover",mouseout:"hover",mouseenter:"hover",mouseleave:"hover",pointerover:"hover",pointerout:"hover",pointerenter:"hover",pointerleave:"hover",dragstart:"drag",dragend:"drag",drag:"drag",dragenter:"drag",dragleave:"drag",dragover:"drag",drop:"drag",keydown:"press",keyup:"press",keypress:"press",input:"press"};function Mke(){return G4e(({metric:t})=>{if(t.value==null)return;const e=t.entries.find(y=>y.duration===t.value&&uV[y.name]);if(!e)return;const{interactionId:n}=e,r=uV[e.name],i=Hr(bo+e.startTime),s=Hr(t.value),o=ss(),a=o?is(o):void 0,l=(n!=null?$E.get(n):void 0)||a,d=l?hn(l).description:Kn().getScopeData().transactionName,h=Pp(e.target),m=rs({[ai]:"auto.http.browser.inp",[sd]:`ui.interaction.${r}`,[a7]:e.duration}),g=hne({name:h,transaction:d,attributes:m,startTime:i});g&&(g.addEvent("inp",{[YT]:"millisecond",[XT]:t.value}),g.end(i+s))})}function Oke(t){const e=({entries:n})=>{const r=ss(),i=r&&is(r);n.forEach(s=>{if(!Z4e(s)||!i)return;const o=s.interactionId;if(o!=null&&!$E.has(o)){if(Yx.length>10){const a=Yx.shift();$E.delete(a)}Yx.push(o),$E.set(o,i)}})};Yb("event",e),Yb("first-input",e)}function Pke(t,e=Ike("fetch")){let n=0,r=0;function i(s){const o=s.body.length;n+=o,r++;const a={body:s.body,method:"POST",referrerPolicy:"origin",headers:t.headers,keepalive:n<=6e4&&r<15,...t.fetchOptions};if(!e)return lV("fetch"),ZC("No fetch implementation available");try{return e(t.url,a).then(c=>(n-=o,r--,{statusCode:c.status,headers:{"x-sentry-rate-limits":c.headers.get("X-Sentry-Rate-Limits"),"retry-after":c.headers.get("Retry-After")}}))}catch(c){return lV("fetch"),n-=o,r--,ZC(c)}}return fRe(t,i)}const Dke=30,Nke=50;function VL(t,e,n,r){const i={filename:t,function:e==="<anonymous>"?Op:e,in_app:!0};return n!==void 0&&(i.lineno=n),r!==void 0&&(i.colno=r),i}const Uke=/^\s*at (\S+?)(?::(\d+))(?::(\d+))\s*$/i,jke=/^\s*at (?:(.+?\)(?: \[.+\])?|.*?) ?\((?:address at )?)?(?:async )?((?:<anonymous>|[-a-z]+:|.*bundle|\/)?.*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,Fke=/\((\S*)(?::(\d+))(?::(\d+))\)/,$ke=t=>{const e=Uke.exec(t);if(e){const[,r,i,s]=e;return VL(r,Op,+i,+s)}const n=jke.exec(t);if(n){if(n[2]&&n[2].indexOf("eval")===0){const o=Fke.exec(n[2]);o&&(n[2]=o[1],n[3]=o[2],n[4]=o[3])}const[i,s]=gne(n[1]||Op,n[2]);return VL(s,i,n[3]?+n[3]:void 0,n[4]?+n[4]:void 0)}},Bke=[Dke,$ke],Hke=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)?((?:[-a-z]+)?:\/.*?|\[native code\]|[^@]*(?:bundle|\d+\.js)|\/[\w\-. /=]+)(?::(\d+))?(?::(\d+))?\s*$/i,qke=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,Vke=t=>{const e=Hke.exec(t);if(e){if(e[3]&&e[3].indexOf(" > eval")>-1){const s=qke.exec(e[3]);s&&(e[1]=e[1]||"eval",e[3]=s[1],e[4]=s[2],e[5]="")}let r=e[3],i=e[1]||Op;return[i,r]=gne(i,r),VL(r,i,e[4]?+e[4]:void 0,e[5]?+e[5]:void 0)}},Kke=[Nke,Vke],Gke=[Bke,Kke],zke=ite(...Gke),gne=(t,e)=>{const n=t.indexOf("safari-extension")!==-1,r=t.indexOf("safari-web-extension")!==-1;return n||r?[t.indexOf("@")!==-1?t.split("@")[0]:Op,n?`safari-extension:${e}`:`safari-web-extension:${e}`]:[t,e]},vw=1024,Wke="Breadcrumbs",Yke=((t={})=>{const e={console:!0,dom:!0,fetch:!0,history:!0,sentry:!0,xhr:!0,...t};return{name:Wke,setup(n){e.console&&PRe(Zke(n)),e.dom&&wke(Qke(n,e.dom)),e.xhr&&mne(eIe(n)),e.fetch&&Zte(tIe(n)),e.history&&g7(nIe(n)),e.sentry&&n.on("beforeSendEvent",Jke(n))}}}),Xke=Yke;function Jke(t){return function(n){mn()===t&&Np({category:`sentry.${n.type==="transaction"?"transaction":"event"}`,event_id:n.event_id,level:n.level,message:df(n)},{event:n})}}function Qke(t,e){return function(r){if(mn()!==t)return;let i,s,o=typeof e=="object"?e.serializeAttribute:void 0,a=typeof e=="object"&&typeof e.maxStringLength=="number"?e.maxStringLength:void 0;a&&a>vw&&(Zo&&je.warn(`\`dom.maxStringLength\` cannot exceed ${vw}, but a value of ${a} was configured. Sentry will use ${vw} instead.`),a=vw),typeof o=="string"&&(o=[o]);try{const l=r.event,d=rIe(l)?l.target:l;i=Pp(d,{keyAttrs:o,maxStringLength:a}),s=ute(d)}catch{i="<unknown>"}if(i.length===0)return;const c={category:`ui.${r.name}`,message:i};s&&(c.data={"ui.component_name":s}),Np(c,{event:r.event,name:r.name,global:r.global})}}function Zke(t){return function(n){if(mn()!==t)return;const r={category:"console",data:{arguments:n.args,logger:"console"},level:NRe(n.level),message:Tq(n.args," ")};if(n.level==="assert")if(n.args[0]===!1)r.message=`Assertion failed: ${Tq(n.args.slice(1)," ")||"console.assert"}`,r.data.arguments=n.args.slice(1);else return;Np(r,{input:n.args,level:n.level})}}function eIe(t){return function(n){if(mn()!==t)return;const{startTimestamp:r,endTimestamp:i}=n,s=n.xhr[$g];if(!r||!i||!s)return;const{method:o,url:a,status_code:c,body:l}=s,d={method:o,url:a,status_code:c},h={xhr:n.xhr,input:l,startTimestamp:r,endTimestamp:i},m=Jte(c);Np({category:"xhr",data:d,type:"http",level:m},h)}}function tIe(t){return function(n){if(mn()!==t)return;const{startTimestamp:r,endTimestamp:i}=n;if(i&&!(n.fetchData.url.match(/sentry_key/)&&n.fetchData.method==="POST"))if(n.error){const s=n.fetchData,o={data:n.error,input:n.args,startTimestamp:r,endTimestamp:i};Np({category:"fetch",data:s,level:"error",type:"http"},o)}else{const s=n.response,o={...n.fetchData,status_code:s&&s.status},a={input:n.args,response:s,startTimestamp:r,endTimestamp:i},c=Jte(o.status_code);Np({category:"fetch",data:o,type:"http",level:c},a)}}}function nIe(t){return function(n){if(mn()!==t)return;let r=n.from,i=n.to;const s=Ep(at.location.href);let o=r?Ep(r):void 0;const a=Ep(i);(!o||!o.path)&&(o=s),s.protocol===a.protocol&&s.host===a.host&&(i=a.relative),s.protocol===o.protocol&&s.host===o.host&&(r=o.relative),Np({category:"navigation",data:{from:r,to:i}})}}function rIe(t){return!!t&&!!t.target}const iIe=["EventTarget","Window","Node","ApplicationCache","AudioTrackList","BroadcastChannel","ChannelMergerNode","CryptoOperation","EventSource","FileReader","HTMLUnknownElement","IDBDatabase","IDBRequest","IDBTransaction","KeyOperation","MediaController","MessagePort","ModalWindow","Notification","SVGElementInstance","Screen","SharedWorker","TextTrack","TextTrackCue","TextTrackList","WebSocket","WebSocketWorker","Worker","XMLHttpRequest","XMLHttpRequestEventTarget","XMLHttpRequestUpload"],sIe="BrowserApiErrors",oIe=((t={})=>{const e={XMLHttpRequest:!0,eventTarget:!0,requestAnimationFrame:!0,setInterval:!0,setTimeout:!0,...t};return{name:sIe,setupOnce(){e.setTimeout&&Jo(at,"setTimeout",dV),e.setInterval&&Jo(at,"setInterval",dV),e.requestAnimationFrame&&Jo(at,"requestAnimationFrame",cIe),e.XMLHttpRequest&&"XMLHttpRequest"in at&&Jo(XMLHttpRequest.prototype,"send",lIe);const n=e.eventTarget;n&&(Array.isArray(n)?n:iIe).forEach(uIe)}}}),aIe=oIe;function dV(t){return function(...e){const n=e[0];return e[0]=Fv(n,{mechanism:{data:{function:rd(t)},handled:!1,type:"instrument"}}),t.apply(this,e)}}function cIe(t){return function(e){return t.apply(this,[Fv(e,{mechanism:{data:{function:"requestAnimationFrame",handler:rd(t)},handled:!1,type:"instrument"}})])}}function lIe(t){return function(...e){const n=this;return["onload","onerror","onprogress","onreadystatechange"].forEach(i=>{i in n&&typeof n[i]=="function"&&Jo(n,i,function(s){const o={mechanism:{data:{function:i,handler:rd(s)},handled:!1,type:"instrument"}},a=s7(s);return a&&(o.mechanism.data.handler=rd(a)),Fv(s,o)})}),t.apply(this,e)}}function uIe(t){const n=at[t],r=n&&n.prototype;!r||!r.hasOwnProperty||!r.hasOwnProperty("addEventListener")||(Jo(r,"addEventListener",function(i){return function(s,o,a){try{dIe(o)&&(o.handleEvent=Fv(o.handleEvent,{mechanism:{data:{function:"handleEvent",handler:rd(o),target:t},handled:!1,type:"instrument"}}))}catch{}return i.apply(this,[s,Fv(o,{mechanism:{data:{function:"addEventListener",handler:rd(o),target:t},handled:!1,type:"instrument"}}),a])}}),Jo(r,"removeEventListener",function(i){return function(s,o,a){try{const c=o.__sentry_wrapped__;c&&i.call(this,s,c,a)}catch{}return i.call(this,s,o,a)}}))}function dIe(t){return typeof t.handleEvent=="function"}const fIe=()=>({name:"BrowserSession",setupOnce(){if(typeof at.document>"u"){Zo&&je.warn("Using the `browserSessionIntegration` in non-browser environments is not supported.");return}Gq({ignoreDuration:!0}),zq(),g7(({from:t,to:e})=>{t!==void 0&&t!==e&&(Gq({ignoreDuration:!0}),zq())})}}),hIe="GlobalHandlers",pIe=((t={})=>{const e={onerror:!0,onunhandledrejection:!0,...t};return{name:hIe,setupOnce(){Error.stackTraceLimit=50},setup(n){e.onerror&&(gIe(n),fV("onerror")),e.onunhandledrejection&&(vIe(n),fV("onunhandledrejection"))}}}),mIe=pIe;function gIe(t){ste(e=>{const{stackParser:n,attachStacktrace:r}=vne();if(mn()!==t||tne())return;const{msg:i,url:s,line:o,column:a,error:c}=e,l=_Ie(h7(n,c||i,void 0,r,!1),s,o,a);l.level="error",$te(l,{originalException:c,mechanism:{handled:!1,type:"onerror"}})})}function vIe(t){ote(e=>{const{stackParser:n,attachStacktrace:r}=vne();if(mn()!==t||tne())return;const i=yIe(e),s=i7(i)?bIe(i):h7(n,i,void 0,r,!0);s.level="error",$te(s,{originalException:i,mechanism:{handled:!1,type:"onunhandledrejection"}})})}function yIe(t){if(i7(t))return t;try{if("reason"in t)return t.reason;if("detail"in t&&"reason"in t.detail)return t.detail.reason}catch{}return t}function bIe(t){return{exception:{values:[{type:"UnhandledRejection",value:`Non-Error promise rejection captured with value: ${String(t)}`}]}}}function _Ie(t,e,n,r){const i=t.exception=t.exception||{},s=i.values=i.values||[],o=s[0]=s[0]||{},a=o.stacktrace=o.stacktrace||{},c=a.frames=a.frames||[],l=r,d=n,h=Ku(e)&&e.length>0?e:s3e();return c.length===0&&c.push({colno:l,filename:h,function:Op,in_app:!0,lineno:d}),t}function fV(t){Zo&&je.log(`Global Handler attached: ${t}`)}function vne(){const t=mn();return t&&t.getOptions()||{stackParser:()=>[],attachStacktrace:!1}}const SIe=()=>({name:"HttpContext",preprocessEvent(t){if(!at.navigator&&!at.location&&!at.document)return;const e=t.request&&t.request.url||at.location&&at.location.href,{referrer:n}=at.document||{},{userAgent:r}=at.navigator||{},i={...t.request&&t.request.headers,...n&&{Referer:n},...r&&{"User-Agent":r}},s={...t.request,...e&&{url:e},headers:i};t.request=s}}),wIe="cause",EIe=5,CIe="LinkedErrors",TIe=((t={})=>{const e=t.limit||EIe,n=t.key||wIe;return{name:CIe,preprocessEvent(r,i,s){const o=s.getOptions();MRe(d7,o.stackParser,o.maxValueLength,n,e,r,i)}}}),RIe=TIe;function kIe(t){const e=[SRe(),vRe(),aIe(),Xke(),mIe(),RIe(),FRe(),SIe()];return t.autoSessionTracking!==!1&&e.push(fIe()),e}function IIe(t={}){const e={defaultIntegrations:kIe(t),release:typeof __SENTRY_RELEASE__=="string"?__SENTRY_RELEASE__:at.SENTRY_RELEASE&&at.SENTRY_RELEASE.id?at.SENTRY_RELEASE.id:void 0,autoSessionTracking:!0,sendClientReports:!0};return t.defaultIntegrations==null&&delete t.defaultIntegrations,{...e,...t}}function xIe(){const t=typeof at.window<"u"&&at;if(!t)return!1;const e=t.chrome?"chrome":"browser",n=t[e],r=n&&n.runtime&&n.runtime.id,i=at.location&&at.location.href||"",s=["chrome-extension:","moz-extension:","ms-browser-extension:","safari-web-extension:"],o=!!r&&at===at.top&&s.some(c=>i.startsWith(`${c}//`)),a=typeof t.nw<"u";return!!r&&!o&&!a}function AIe(t={}){const e=IIe(t);if(!e.skipBrowserExtensionCheck&&xIe()){tm(()=>{console.error("[Sentry] You cannot run Sentry this way in a browser extension, check: https://docs.sentry.io/platforms/javascript/best-practices/browser-extensions/")});return}Zo&&(Qte()||je.warn("No Fetch API detected. The Sentry SDK requires a Fetch API compatible environment to send events. Please add a Fetch API polyfill."));const n={...e,stackParser:YCe(e.stackParser||zke),integrations:JTe(e),transport:e.transport||Pke};return rRe(g4e,n)}function hV(t={}){if(!at.document){Zo&&je.error("Global document not defined in showReportDialog call");return}const e=Kn(),n=e.getClient(),r=n&&n.getDsn();if(!r){Zo&&je.error("DSN not configured for showReportDialog call");return}if(e&&(t.user={...e.getUser(),...t.user}),!t.eventId){const a=qTe();a&&(t.eventId=a)}const i=at.document.createElement("script");i.async=!0,i.crossOrigin="anonymous",i.src=YTe(r,t),t.onLoad&&(i.onload=t.onLoad);const{onClose:s}=t;if(s){const a=c=>{if(c.data==="__sentry_reportdialog_closed__")try{s()}finally{at.removeEventListener("message",a)}};at.addEventListener("message",a)}const o=at.document.head||at.document.body;o?o.appendChild(i):Zo&&je.error("Not injecting report dialog. No injection point found in HTML")}const pV=new WeakMap,Xx=new Map,BE={traceFetch:!0,traceXHR:!0,enableHTTPTimings:!0,trackFetchStreamPerformance:!1};function LIe(t,e){const{traceFetch:n,traceXHR:r,trackFetchStreamPerformance:i,shouldCreateSpanForRequest:s,enableHTTPTimings:o,tracePropagationTargets:a}={traceFetch:BE.traceFetch,traceXHR:BE.traceXHR,trackFetchStreamPerformance:BE.trackFetchStreamPerformance,...e},c=typeof s=="function"?s:h=>!0,l=h=>PIe(h,a),d={};n&&(t.addEventProcessor(h=>(h.type==="transaction"&&h.spans&&h.spans.forEach(m=>{if(m.op==="http.client"){const g=Xx.get(m.span_id);g&&(m.timestamp=g/1e3,Xx.delete(m.span_id))}}),h)),i&&XRe(h=>{if(h.response){const m=pV.get(h.response);m&&h.endTimestamp&&Xx.set(m,h.endTimestamp)}}),Zte(h=>{const m=qRe(h,c,l,d);if(h.response&&h.fetchData.__span&&pV.set(h.response,h.fetchData.__span),m){const g=yne(h.fetchData.url),y=g?Ep(g).host:void 0;m.setAttributes({"http.url":g,"server.address":y})}o&&m&&mV(m)})),r&&mne(h=>{const m=DIe(h,c,l,d);o&&m&&mV(m)})}function MIe(t){return t.entryType==="resource"&&"initiatorType"in t&&typeof t.nextHopProtocol=="string"&&(t.initiatorType==="fetch"||t.initiatorType==="xmlhttprequest")}function mV(t){const{url:e}=hn(t).data||{};if(!e||typeof e!="string")return;const n=Yb("resource",({entries:r})=>{r.forEach(i=>{MIe(i)&&i.name.endsWith(e)&&(OIe(i).forEach(o=>t.setAttribute(...o)),setTimeout(n))})})}function nl(t=0){return((bo||performance.timeOrigin)+t)/1e3}function OIe(t){const{name:e,version:n}=pne(t.nextHopProtocol),r=[];return r.push(["network.protocol.version",n],["network.protocol.name",e]),bo?[...r,["http.request.redirect_start",nl(t.redirectStart)],["http.request.fetch_start",nl(t.fetchStart)],["http.request.domain_lookup_start",nl(t.domainLookupStart)],["http.request.domain_lookup_end",nl(t.domainLookupEnd)],["http.request.connect_start",nl(t.connectStart)],["http.request.secure_connection_start",nl(t.secureConnectionStart)],["http.request.connection_end",nl(t.connectEnd)],["http.request.request_start",nl(t.requestStart)],["http.request.response_start",nl(t.responseStart)],["http.request.response_end",nl(t.responseEnd)]]:r}function PIe(t,e){const n=at.location&&at.location.href;if(n){let r,i;try{r=new URL(t,n),i=new URL(n).origin}catch{return!1}const s=r.origin===i;return e?_p(r.toString(),e)||s&&_p(r.pathname,e):s}else{const r=!!t.match(/^\/(?!\/)/);return e?_p(t,e):r}}function DIe(t,e,n,r){const i=t.xhr,s=i&&i[$g];if(!i||i.__sentry_own_request__||!s)return;const o=Yf()&&e(s.url);if(t.endTimestamp&&o){const h=i.__sentry_xhr_span_id__;if(!h)return;const m=r[h];m&&s.status_code!==void 0&&(vte(m,s.status_code),m.end(),delete r[h]);return}const a=yne(s.url),c=a?Ep(a).host:void 0,l=!!ss(),d=o&&l?H_({name:`${s.method} ${s.url}`,attributes:{type:"xhr","http.method":s.method,"http.url":a,url:s.url,"server.address":c,[ai]:"auto.http.browser",[sd]:"http.client"}}):new Sy;return i.__sentry_xhr_span_id__=d.spanContext().spanId,r[i.__sentry_xhr_span_id__]=d,n(s.url)&&NIe(i,Yf()&&l?d:void 0),d}function NIe(t,e){const{"sentry-trace":n,baggage:r}=Wte({span:e});n&&UIe(t,n,r)}function UIe(t,e,n){try{t.setRequestHeader("sentry-trace",e),n&&t.setRequestHeader("baggage",n)}catch{}}function yne(t){try{return new URL(t,at.location.origin).href}catch{return}}function jIe(){at&&at.document?at.document.addEventListener("visibilitychange",()=>{const t=ss();if(!t)return;const e=is(t);if(at.document.hidden&&e){const n="cancelled",{op:r,status:i}=hn(e);Zo&&je.log(`[Tracing] Transaction: ${n} -> since tab moved to the background, op: ${r}`),i||e.setStatus({code:Ai,message:n}),e.setAttribute("sentry.cancellation_reason","document.hidden"),e.end()}}):Zo&&je.warn("[Tracing] Could not set up background tab detection due to lack of global document")}const FIe="BrowserTracing",$Ie={...jE,instrumentNavigation:!0,instrumentPageLoad:!0,markBackgroundSpan:!0,enableLongTask:!0,enableLongAnimationFrame:!0,enableInp:!0,_experiments:{},...BE},BIe=((t={})=>{B3e();const{enableInp:e,enableLongTask:n,enableLongAnimationFrame:r,_experiments:{enableInteractions:i,enableStandaloneClsSpans:s},beforeStartSpan:o,idleTimeout:a,finalTimeout:c,childSpanTimeout:l,markBackgroundSpan:d,traceFetch:h,traceXHR:m,trackFetchStreamPerformance:g,shouldCreateSpanForRequest:y,enableHTTPTimings:v,instrumentPageLoad:E,instrumentNavigation:w}={...$Ie,...t},R=ike({recordClsStandaloneSpans:s||!1});e&&Lke(),r&&cn.PerformanceObserver&&PerformanceObserver.supportedEntryTypes&&PerformanceObserver.supportedEntryTypes.includes("long-animation-frame")?oke():n&&ske(),i&&ake();const x={name:void 0,source:void 0};function C(k,T){const L=T.op==="pageload",O=o?o(T):T,P=O.attributes||{};T.name!==O.name&&(P[Ua]="custom",O.attributes=P),x.name=O.name,x.source=P[Ua];const D=Fte(O,{idleTimeout:a,finalTimeout:c,childSpanTimeout:l,disableAutoFinish:L,beforeSpanEnd:H=>{R(),fke(H,{recordClsOnPageloadSpan:!s})}});function j(){["interactive","complete"].includes(at.document.readyState)&&k.emit("idleSpanEnableAutoFinish",D)}return L&&at.document&&(at.document.addEventListener("readystatechange",()=>{j()}),j()),D}return{name:FIe,afterAllSetup(k){let T,L=at.location&&at.location.href;function O(){T&&!hn(T).timestamp&&(Zo&&je.log(`[Tracing] Finishing current active span with op: ${hn(T).op}`),T.end())}k.on("startNavigationSpan",P=>{mn()===k&&(O(),T=C(k,{op:"navigation",...P}))}),k.on("startPageLoadSpan",(P,D={})=>{if(mn()!==k)return;O();const j=D.sentryTrace||gV("sentry-trace"),H=D.baggage||gV("baggage"),z=P3e(j,H);Kn().setPropagationContext(z),T=C(k,{op:"pageload",...P})}),k.on("spanEnd",P=>{const D=hn(P).op;if(P!==is(P)||D!=="navigation"&&D!=="pageload")return;const j=Kn(),H=j.getPropagationContext();j.setPropagationContext({...H,sampled:H.sampled!==void 0?H.sampled:rm(P),dsc:H.dsc||wy(P)})}),at.location&&(E&&bne(k,{name:at.location.pathname,startTime:bo?bo/1e3:void 0,attributes:{[Ua]:"url",[ai]:"auto.pageload.browser"}}),w&&g7(({to:P,from:D})=>{if(D===void 0&&L&&L.indexOf(P)!==-1){L=void 0;return}D!==P&&(L=void 0,_ne(k,{name:at.location.pathname,attributes:{[Ua]:"url",[ai]:"auto.navigation.browser"}}))})),d&&jIe(),i&&HIe(a,c,l,x),e&&Oke(),LIe(k,{traceFetch:h,traceXHR:m,trackFetchStreamPerformance:g,tracePropagationTargets:k.getOptions().tracePropagationTargets,shouldCreateSpanForRequest:y,enableHTTPTimings:v})}}});function bne(t,e,n){t.emit("startPageLoadSpan",e,n),Kn().setTransactionName(e.name);const r=ss();return(r&&hn(r).op)==="pageload"?r:void 0}function _ne(t,e){$l().setPropagationContext({traceId:Gf()}),Kn().setPropagationContext({traceId:Gf()}),t.emit("startNavigationSpan",e),Kn().setTransactionName(e.name);const n=ss();return(n&&hn(n).op)==="navigation"?n:void 0}function gV(t){const e=o3e(`meta[name=${t}]`);return e?e.getAttribute("content"):void 0}function HIe(t,e,n,r){let i;const s=()=>{const o="ui.action.click",a=ss(),c=a&&is(a);if(c){const l=hn(c).op;if(["navigation","pageload"].includes(l)){Zo&&je.warn(`[Tracing] Did not create ${o} span because a pageload or navigation span is in progress.`);return}}if(i&&(i.setAttribute(IL,"interactionInterrupted"),i.end(),i=void 0),!r.name){Zo&&je.warn(`[Tracing] Did not create ${o} transaction because _latestRouteName is missing.`);return}i=Fte({name:r.name,op:o,attributes:{[Ua]:r.source||"url"}},{idleTimeout:t,finalTimeout:e,childSpanTimeout:n})};at.document&&addEventListener("click",s,{once:!1,capture:!0})}function qIe(t){const e={...t};return zte(e,"react"),HTe("react",{version:_.version}),AIe(e)}function VIe(t){const e=t.match(/^([^.]+)/);return e!==null&&parseInt(e[0])>=17}function KIe(t,e){const n=new WeakSet;function r(i,s){if(!n.has(i)){if(i.cause)return n.add(i),r(i.cause,s);i.cause=s}}r(t,e)}function GIe(t,{componentStack:e},n){if(VIe(_.version)&&VT(t)&&e){const r=new Error(t.message);r.name=`React ErrorBoundary ${t.name}`,r.stack=e,KIe(t,r)}return JT(t,{...n,captureContext:{contexts:{react:{componentStack:e}}}})}var Jx={exports:{}},gn={};var vV;function zIe(){if(vV)return gn;vV=1;var t=typeof Symbol=="function"&&Symbol.for,e=t?Symbol.for("react.element"):60103,n=t?Symbol.for("react.portal"):60106,r=t?Symbol.for("react.fragment"):60107,i=t?Symbol.for("react.strict_mode"):60108,s=t?Symbol.for("react.profiler"):60114,o=t?Symbol.for("react.provider"):60109,a=t?Symbol.for("react.context"):60110,c=t?Symbol.for("react.async_mode"):60111,l=t?Symbol.for("react.concurrent_mode"):60111,d=t?Symbol.for("react.forward_ref"):60112,h=t?Symbol.for("react.suspense"):60113,m=t?Symbol.for("react.suspense_list"):60120,g=t?Symbol.for("react.memo"):60115,y=t?Symbol.for("react.lazy"):60116,v=t?Symbol.for("react.block"):60121,E=t?Symbol.for("react.fundamental"):60117,w=t?Symbol.for("react.responder"):60118,R=t?Symbol.for("react.scope"):60119;function x(k){if(typeof k=="object"&&k!==null){var T=k.$$typeof;switch(T){case e:switch(k=k.type,k){case c:case l:case r:case s:case i:case h:return k;default:switch(k=k&&k.$$typeof,k){case a:case d:case y:case g:case o:return k;default:return T}}case n:return T}}}function C(k){return x(k)===l}return gn.AsyncMode=c,gn.ConcurrentMode=l,gn.ContextConsumer=a,gn.ContextProvider=o,gn.Element=e,gn.ForwardRef=d,gn.Fragment=r,gn.Lazy=y,gn.Memo=g,gn.Portal=n,gn.Profiler=s,gn.StrictMode=i,gn.Suspense=h,gn.isAsyncMode=function(k){return C(k)||x(k)===c},gn.isConcurrentMode=C,gn.isContextConsumer=function(k){return x(k)===a},gn.isContextProvider=function(k){return x(k)===o},gn.isElement=function(k){return typeof k=="object"&&k!==null&&k.$$typeof===e},gn.isForwardRef=function(k){return x(k)===d},gn.isFragment=function(k){return x(k)===r},gn.isLazy=function(k){return x(k)===y},gn.isMemo=function(k){return x(k)===g},gn.isPortal=function(k){return x(k)===n},gn.isProfiler=function(k){return x(k)===s},gn.isStrictMode=function(k){return x(k)===i},gn.isSuspense=function(k){return x(k)===h},gn.isValidElementType=function(k){return typeof k=="string"||typeof k=="function"||k===r||k===l||k===s||k===i||k===h||k===m||typeof k=="object"&&k!==null&&(k.$$typeof===y||k.$$typeof===g||k.$$typeof===o||k.$$typeof===a||k.$$typeof===d||k.$$typeof===E||k.$$typeof===w||k.$$typeof===R||k.$$typeof===v)},gn.typeOf=x,gn}var yV;function WIe(){return yV||(yV=1,Jx.exports=zIe()),Jx.exports}var Qx,bV;function YIe(){if(bV)return Qx;bV=1;var t=WIe(),e={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},n={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},r={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},i={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},s={};s[t.ForwardRef]=r,s[t.Memo]=i;function o(y){return t.isMemo(y)?i:s[y.$$typeof]||e}var a=Object.defineProperty,c=Object.getOwnPropertyNames,l=Object.getOwnPropertySymbols,d=Object.getOwnPropertyDescriptor,h=Object.getPrototypeOf,m=Object.prototype;function g(y,v,E){if(typeof v!="string"){if(m){var w=h(v);w&&w!==m&&g(y,w,E)}var R=c(v);l&&(R=R.concat(l(v)));for(var x=o(y),C=o(v),k=0;k<R.length;++k){var T=R[k];if(!n[T]&&!(E&&E[T])&&!(C&&C[T])&&!(x&&x[T])){var L=d(v,T);try{a(y,T,L)}catch{}}}}return y}return Qx=g,Qx}var XIe=YIe();const JIe=Dl(XIe),Sne=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,_V={componentStack:null,error:null,eventId:null};class eR extends _.Component{constructor(e){super(e),eR.prototype.__init.call(this),this.state=_V,this._openFallbackReportDialog=!0;const n=mn();n&&e.showDialog&&(this._openFallbackReportDialog=!1,this._cleanupHook=n.on("afterSendEvent",r=>{!r.type&&this._lastEventId&&r.event_id===this._lastEventId&&hV({...e.dialogOptions,eventId:this._lastEventId})}))}componentDidCatch(e,n){const{componentStack:r}=n,i=r??void 0,{beforeCapture:s,onError:o,showDialog:a,dialogOptions:c}=this.props;WT(l=>{s&&s(l,e,i);const d=this.props.handled!=null?this.props.handled:!!this.props.fallback,h=GIe(e,n,{mechanism:{handled:d}});o&&o(e,i,h),a&&(this._lastEventId=h,this._openFallbackReportDialog&&hV({...c,eventId:h})),this.setState({error:e,componentStack:r,eventId:h})})}componentDidMount(){const{onMount:e}=this.props;e&&e()}componentWillUnmount(){const{error:e,componentStack:n,eventId:r}=this.state,{onUnmount:i}=this.props;i&&i(e,n,r),this._cleanupHook&&(this._cleanupHook(),this._cleanupHook=void 0)}__init(){this.resetErrorBoundary=()=>{const{onReset:e}=this.props,{error:n,componentStack:r,eventId:i}=this.state;e&&e(n,r,i),this.setState(_V)}}render(){const{fallback:e,children:n}=this.props,r=this.state;if(r.error){let i;return typeof e=="function"?i=_.createElement(e,{error:r.error,componentStack:r.componentStack,resetError:this.resetErrorBoundary,eventId:r.eventId}):i=e,_.isValidElement(i)?i:(e&&Sne&&je.warn("fallback did not produce a valid ReactElement"),null)}return typeof n=="function"?n():n}}let HE,qE,VE,KE,Up,Bg=!1;const wne=new WeakSet,Zx=new Set;function QIe(t,e){const n=BIe({...t,instrumentPageLoad:!1,instrumentNavigation:!1}),{useEffect:r,useLocation:i,useNavigationType:s,createRoutesFromChildren:o,matchRoutes:a,stripBasename:c,instrumentPageLoad:l=!0,instrumentNavigation:d=!0}=t;return{...n,setup(){HE=r,qE=i,VE=s,Up=a,KE=o,Bg=c||!1},afterAllSetup(h){n.afterAllSetup(h);const m=at&&at.location&&at.location.pathname;l&&m&&bne(h,{name:m,attributes:{[Ua]:"url",[sd]:"pageload",[ai]:`auto.pageload.react.reactrouter_v${e}`}}),d&&wne.add(h)}}}function ZIe(t){const{location:e,routes:n,navigationType:r,version:i,matches:s,basename:o,allRoutes:a}=t,c=Array.isArray(s)?s:Up(n,e,o),l=mn();if(!(!l||!wne.has(l))&&(r==="PUSH"||r==="POP")&&c){let d,h="url";const m=Cne(e,a||n);m&&(d=Xb(v7(a||n,e)),h="route"),(!m||!d)&&([d,h]=Rne(n,e,c,o)),_ne(l,{name:d,attributes:{[Ua]:h,[sd]:"navigation",[ai]:`auto.navigation.react.reactrouter_v${i}`}})}}function i3(t,e){if(!e||e==="/"||!t.toLowerCase().startsWith(e.toLowerCase()))return t;const n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?t:t.slice(n)||"/"}function exe(t,e,n){const r=t||Bg?i3(e,n):e;return[r[r.length-1]==="/"||r.slice(-2)==="/*"?r.slice(0,-1):r,"route"]}function Ene(t){return t.endsWith("*")}function SV(t,e){return Ene(t)&&e.route.children&&e.route.children.length>0||!1}function txe(t){return!!(!t.children&&t.element&&t.path&&t.path.endsWith("/*"))}function Cne(t,e){const n=Up(e,t);if(n){for(const r of n)if(txe(r.route)&&rxe(r))return!0}return!1}function Tne(t,e=new Set){return e.has(t)||(e.add(t),t.children&&!t.index&&t.children.forEach(n=>{Tne(n,e).forEach(i=>e.add(i))})),e}function nxe(t){return ixe(t.route.path||"")}function rxe(t){return t.params["*"]||""}function ixe(t){return t[t.length-1]==="*"?t.slice(0,-1):t}function eb(t){return t[t.length-1]==="/"?t.slice(0,-1):t}function Xb(t){return t[0]==="/"?t:`/${t}`}function v7(t,e){const n=Up(t,e);if(!n||n.length===0)return"";for(const r of n)if(r.route.path&&r.route.path!=="*"){const i=nxe(r),s=i3(e.pathname,Xb(r.pathnameBase));return eb(eb(i||"")+Xb(v7(t.filter(o=>o!==r.route),{pathname:s})))}return""}function Rne(t,e,n,r=""){if(!t||t.length===0)return[Bg?i3(e.pathname,r):e.pathname,"url"];let i="";if(n)for(const o of n){const a=o.route;if(a){if(a.index)return exe(i,o.pathname,r);const c=a.path;if(c&&!SV(c,o)){const l=c[0]==="/"||i[i.length-1]==="/"?c:`/${c}`;if(i=eb(i)+Xb(l),eb(e.pathname)===eb(r+o.pathname))return nV(i)!==nV(o.pathname)&&!Ene(i)?[(Bg?"":r)+l,"route"]:(SV(i,o)&&(i=i.slice(0,-1)),[(Bg?"":r)+i,"route"])}}}return[Bg?i3(e.pathname,r):e.pathname||"/","url"]}function sxe(t,e,n,r,i,s){const o=Array.isArray(r)?r:Up(s||n,e,i);if(o){let a,c="url";const l=Cne(e,s||n);l&&(a=Xb(v7(s||n,e)),c="route"),(!l||!a)&&([a,c]=Rne(n,e,o,i)),Kn().setTransactionName(a||"/"),t&&(t.updateName(a),t.setAttribute(Ua,c))}}function oxe(t,e){if(!HE||!qE||!VE||!KE||!Up)return Sne&&je.warn(`reactRouterV6Instrumentation was unable to wrap Routes because of one or more missing parameters.
      useEffect: ${HE}. useLocation: ${qE}. useNavigationType: ${VE}.
      createRoutesFromChildren: ${KE}. matchRoutes: ${Up}.`),t;const n=r=>{const i=_.useRef(!0),s=qE(),o=VE();return HE(()=>{const a=KE(r.children);i.current?(a.forEach(c=>{Tne(c).forEach(d=>{Zx.add(d)})}),sxe(axe(),s,a,void 0,void 0,Array.from(Zx)),i.current=!1):ZIe({location:s,routes:a,navigationType:o,version:e,allRoutes:Array.from(Zx)})},[s,o]),_.createElement(t,{...r})};return JIe(n,t),n}function axe(){const t=ss(),e=t?is(t):void 0;if(!e)return;const n=hn(e).op;return n==="navigation"||n==="pageload"?e:void 0}function cxe(t){return QIe(t,"7")}function lxe(t){return oxe(t,"7")}var e6={exports:{}};var wV;function uxe(){return wV||(wV=1,(function(t){(function(){var e={}.hasOwnProperty;function n(){for(var s="",o=0;o<arguments.length;o++){var a=arguments[o];a&&(s=i(s,r(a)))}return s}function r(s){if(typeof s=="string"||typeof s=="number")return s;if(typeof s!="object")return"";if(Array.isArray(s))return n.apply(null,s);if(s.toString!==Object.prototype.toString&&!s.toString.toString().includes("[native code]"))return s.toString();var o="";for(var a in s)e.call(s,a)&&s[a]&&(o=i(o,a));return o}function i(s,o){return o?s?s+" "+o:s+o:s}t.exports?(n.default=n,t.exports=n):window.classNames=n})()})(e6)),e6.exports}var dxe=uxe();const Le=Dl(dxe);function kne(t,e){return S.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:S.jsx("path",{d:"m10.6 13.8-2.15-2.15a.95.95 0 0 0-.7-.275.95.95 0 0 0-.7.275.95.95 0 0 0-.275.7q0 .425.275.7L9.9 15.9q.3.3.7.3t.7-.3l5.65-5.65a.95.95 0 0 0 .275-.7.95.95 0 0 0-.275-.7.95.95 0 0 0-.7-.275.95.95 0 0 0-.7.275zM12 22a9.7 9.7 0 0 1-3.9-.788 10.1 10.1 0 0 1-3.175-2.137q-1.35-1.35-2.137-3.175A9.7 9.7 0 0 1 2 12q0-2.075.788-3.9a10.1 10.1 0 0 1 2.137-3.175q1.35-1.35 3.175-2.137A9.7 9.7 0 0 1 12 2q2.075 0 3.9.788a10.1 10.1 0 0 1 3.175 2.137q1.35 1.35 2.137 3.175A9.7 9.7 0 0 1 22 12a9.7 9.7 0 0 1-.788 3.9 10.1 10.1 0 0 1-2.137 3.175q-1.35 1.35-3.175 2.137A9.7 9.7 0 0 1 12 22m0-2q3.35 0 5.675-2.325T20 12t-2.325-5.675T12 4 6.325 6.325 4 12t2.325 5.675T12 20"})})}kne.displayName="CheckCircleIcon";const fxe=_.forwardRef(kne);function Ine(t,e){return S.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:S.jsx("path",{d:"M12 17q.424 0 .713-.288A.97.97 0 0 0 13 16a.97.97 0 0 0-.287-.713A.97.97 0 0 0 12 15a.97.97 0 0 0-.713.287A.97.97 0 0 0 11 16q0 .424.287.712.288.288.713.288m0-4q.424 0 .713-.287A.97.97 0 0 0 13 12V8a.97.97 0 0 0-.287-.713A.97.97 0 0 0 12 7a.97.97 0 0 0-.713.287A.97.97 0 0 0 11 8v4q0 .424.287.713.288.287.713.287m0 9a9.7 9.7 0 0 1-3.9-.788 10.1 10.1 0 0 1-3.175-2.137q-1.35-1.35-2.137-3.175A9.7 9.7 0 0 1 2 12q0-2.075.788-3.9a10.1 10.1 0 0 1 2.137-3.175q1.35-1.35 3.175-2.137A9.7 9.7 0 0 1 12 2q2.075 0 3.9.788a10.1 10.1 0 0 1 3.175 2.137q1.35 1.35 2.137 3.175A9.7 9.7 0 0 1 22 12a9.7 9.7 0 0 1-.788 3.9 10.1 10.1 0 0 1-2.137 3.175q-1.35 1.35-3.175 2.137A9.7 9.7 0 0 1 12 22"})})}Ine.displayName="ErrorSolidIcon";const z_=_.forwardRef(Ine);function xne(t,e){return S.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:[S.jsx("path",{d:"M11.288 7.288A.97.97 0 0 1 12 7q.424 0 .713.287Q13 7.576 13 8t-.287.713A.97.97 0 0 1 12 9a.97.97 0 0 1-.713-.287A.97.97 0 0 1 11 8q0-.424.287-.713m.001 4.001A.97.97 0 0 1 12 11q.424 0 .713.287.287.288.287.713v4q0 .424-.287.712A.97.97 0 0 1 12 17a.97.97 0 0 1-.713-.288A.97.97 0 0 1 11 16v-4q0-.424.287-.713"}),S.jsx("path",{fillRule:"evenodd",d:"M22 12c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2s10 4.477 10 10m-2 0a8 8 0 1 1-16 0 8 8 0 0 1 16 0",clipRule:"evenodd"})]})}xne.displayName="InfoIcon";const hxe=_.forwardRef(xne);function Ane(t,e){return S.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:S.jsx("path",{d:"M6.293 6.293a1 1 0 0 1 1.414 0L12 10.586l4.293-4.293a1 1 0 1 1 1.414 1.414L13.414 12l4.293 4.293a1 1 0 0 1-1.414 1.414L12 13.414l-4.293 4.293a1 1 0 0 1-1.414-1.414L10.586 12 6.293 7.707a1 1 0 0 1 0-1.414"})})}Ane.displayName="CloseIcon";const W_=_.forwardRef(Ane),pxe="_alert_zx76t_10",mxe="_content_zx76t_37",gxe="_icon_zx76t_48",vxe="_actions_zx76t_64",hg={alert:pxe,content:mxe,"text-content":"_text-content_zx76t_44",icon:gxe,actions:vxe},yxe="_typography_6v6n8_153",EV={"font-body-xs-regular":"_font-body-xs-regular_6v6n8_12","font-body-xs-semibold":"_font-body-xs-semibold_6v6n8_17","font-body-xs-medium":"_font-body-xs-medium_6v6n8_22","font-body-sm-regular":"_font-body-sm-regular_6v6n8_31","font-body-sm-semibold":"_font-body-sm-semibold_6v6n8_36","font-body-sm-medium":"_font-body-sm-medium_6v6n8_41","font-body-md-regular":"_font-body-md-regular_6v6n8_50","font-body-md-semibold":"_font-body-md-semibold_6v6n8_55","font-body-md-medium":"_font-body-md-medium_6v6n8_60","font-body-lg-regular":"_font-body-lg-regular_6v6n8_69","font-body-lg-semibold":"_font-body-lg-semibold_6v6n8_74","font-body-lg-medium":"_font-body-lg-medium_6v6n8_79","font-heading-sm-regular":"_font-heading-sm-regular_6v6n8_88","font-heading-sm-semibold":"_font-heading-sm-semibold_6v6n8_93","font-heading-sm-medium":"_font-heading-sm-medium_6v6n8_98","font-heading-md-regular":"_font-heading-md-regular_6v6n8_107","font-heading-md-semibold":"_font-heading-md-semibold_6v6n8_112","font-heading-lg-regular":"_font-heading-lg-regular_6v6n8_121","font-heading-lg-semibold":"_font-heading-lg-semibold_6v6n8_126","font-heading-xl-regular":"_font-heading-xl-regular_6v6n8_135","font-heading-xl-semibold":"_font-heading-xl-semibold_6v6n8_140",typography:yxe},Lne=({as:t,children:e,type:n="body",weight:r="regular",size:i="md",className:s,...o})=>{const a=t||"p";return S.jsx(a,{...o,className:Le(EV.typography,EV[`font-${n}-${i}-${r}`],s),children:e})},an=({as:t="p",children:e,...n})=>S.jsx(Lne,{as:t,type:"body",...n,children:e}),bxe="_destructive_1pz9o_95",t6={"icon-button":"_icon-button_1pz9o_8","no-background":"_no-background_1pz9o_42",destructive:bxe},Mne=_.forwardRef(function({as:e,children:n,className:r,disabled:i,...s},o){const a=e||"button",{onClick:c,onSubmit:l,onPointerDown:d,onPointerUp:h,onKeyDown:m,onKeyUp:g,onKeyPress:y,...v}=s,E=i?{}:{onClick:c,onSubmit:l,onPointerDown:d,onPointerUp:h,onKeyDown:m,onKeyUp:g,onKeyPress:y};return S.jsx(a,{ref:o,className:r,role:e==="a"?"link":"button",tabIndex:0,"aria-disabled":i,...v,...E,children:n})}),_xe={"indicator-icon":"_indicator-icon_147l5_17"},Sxe=_.forwardRef(function({children:e,className:n,size:r="100%",colour:i,indicator:s},o){const a=Le(_xe["indicator-icon"],n);return S.jsx("div",{ref:o,className:a,"data-indicator":s,style:{"--cpd-icon-button-size":r,"--cpd-color-icon-tertiary":i},children:xe.Children.only(e)})}),One=_.createContext(null);function y7(){const t=_.useContext(One);if(t==null)throw new Error("Tooltip components must be wrapped in <Tooltip />");return t}function tR(){return typeof window<"u"}function xy(t){return Pne(t)?(t.nodeName||"").toLowerCase():"#document"}function po(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function Bl(t){var e;return(e=(Pne(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function Pne(t){return tR()?t instanceof Node||t instanceof po(t).Node:!1}function Bn(t){return tR()?t instanceof Element||t instanceof po(t).Element:!1}function ta(t){return tR()?t instanceof HTMLElement||t instanceof po(t).HTMLElement:!1}function KL(t){return!tR()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof po(t).ShadowRoot}function Y_(t){const{overflow:e,overflowX:n,overflowY:r,display:i}=na(t);return/auto|scroll|overlay|hidden|clip/.test(e+r+n)&&!["inline","contents"].includes(i)}function wxe(t){return["table","td","th"].includes(xy(t))}function nR(t){return[":popover-open",":modal"].some(e=>{try{return t.matches(e)}catch{return!1}})}function b7(t){const e=rR(),n=Bn(t)?na(t):t;return["transform","translate","scale","rotate","perspective"].some(r=>n[r]?n[r]!=="none":!1)||(n.containerType?n.containerType!=="normal":!1)||!e&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!e&&(n.filter?n.filter!=="none":!1)||["transform","translate","scale","rotate","perspective","filter"].some(r=>(n.willChange||"").includes(r))||["paint","layout","strict","content"].some(r=>(n.contain||"").includes(r))}function Exe(t){let e=ad(t);for(;ta(e)&&!Gu(e);){if(b7(e))return e;if(nR(e))return null;e=ad(e)}return null}function rR(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function Gu(t){return["html","body","#document"].includes(xy(t))}function na(t){return po(t).getComputedStyle(t)}function iR(t){return Bn(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function ad(t){if(xy(t)==="html")return t;const e=t.assignedSlot||t.parentNode||KL(t)&&t.host||Bl(t);return KL(e)?e.host:e}function Dne(t){const e=ad(t);return Gu(e)?t.ownerDocument?t.ownerDocument.body:t.body:ta(e)&&Y_(e)?e:Dne(e)}function Pf(t,e,n){var r;e===void 0&&(e=[]),n===void 0&&(n=!0);const i=Dne(t),s=i===((r=t.ownerDocument)==null?void 0:r.body),o=po(i);if(s){const a=GL(o);return e.concat(o,o.visualViewport||[],Y_(i)?i:[],a&&n?Pf(a):[])}return e.concat(i,Pf(i,[],n))}function GL(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function zL(t){let e=t.activeElement;for(;((n=e)==null||(n=n.shadowRoot)==null?void 0:n.activeElement)!=null;){var n;e=e.shadowRoot.activeElement}return e}function $v(t,e){if(!t||!e)return!1;const n=e.getRootNode==null?void 0:e.getRootNode();if(t.contains(e))return!0;if(n&&KL(n)){let r=e;for(;r;){if(t===r)return!0;r=r.parentNode||r.host}}return!1}function Nne(){const t=navigator.userAgentData;return t!=null&&t.platform?t.platform:navigator.platform}function Une(){const t=navigator.userAgentData;return t&&Array.isArray(t.brands)?t.brands.map(e=>{let{brand:n,version:r}=e;return n+"/"+r}).join(" "):navigator.userAgent}function Cxe(t){return Rxe()?!1:!CV()&&t.width===0&&t.height===0||CV()&&t.width===1&&t.height===1&&t.pressure===0&&t.detail===0&&t.pointerType==="mouse"||t.width<1&&t.height<1&&t.pressure===0&&t.detail===0&&t.pointerType==="touch"}function jne(){return/apple/i.test(navigator.vendor)}function CV(){const t=/android/i;return t.test(Nne())||t.test(Une())}function Txe(){return Nne().toLowerCase().startsWith("mac")&&!navigator.maxTouchPoints}function Rxe(){return Une().includes("jsdom/")}function WL(t,e){const n=["mouse","pen"];return n.push("",void 0),n.includes(t)}function kxe(t){return"nativeEvent"in t}function Ixe(t){return t.matches("html,body")}function wf(t){return t?.ownerDocument||document}function n6(t,e){if(e==null)return!1;if("composedPath"in t)return t.composedPath().includes(e);const n=t;return n.target!=null&&e.contains(n.target)}function Mg(t){return"composedPath"in t?t.composedPath()[0]:t.target}const xxe="input:not([type='hidden']):not([disabled]),[contenteditable]:not([contenteditable='false']),textarea:not([disabled])";function Axe(t){return ta(t)&&t.matches(xxe)}const Lxe=["top","right","bottom","left"],Xf=Math.min,Yo=Math.max,s3=Math.round,yw=Math.floor,Tl=t=>({x:t,y:t}),Mxe={left:"right",right:"left",bottom:"top",top:"bottom"},Oxe={start:"end",end:"start"};function YL(t,e,n){return Yo(t,Xf(e,n))}function cd(t,e){return typeof t=="function"?t(e):t}function ld(t){return t.split("-")[0]}function Ay(t){return t.split("-")[1]}function _7(t){return t==="x"?"y":"x"}function S7(t){return t==="y"?"height":"width"}function Jf(t){return["top","bottom"].includes(ld(t))?"y":"x"}function w7(t){return _7(Jf(t))}function Pxe(t,e,n){n===void 0&&(n=!1);const r=Ay(t),i=w7(t),s=S7(i);let o=i==="x"?r===(n?"end":"start")?"right":"left":r==="start"?"bottom":"top";return e.reference[s]>e.floating[s]&&(o=o3(o)),[o,o3(o)]}function Dxe(t){const e=o3(t);return[XL(t),e,XL(e)]}function XL(t){return t.replace(/start|end/g,e=>Oxe[e])}function Nxe(t,e,n){const r=["left","right"],i=["right","left"],s=["top","bottom"],o=["bottom","top"];switch(t){case"top":case"bottom":return n?e?i:r:e?r:i;case"left":case"right":return e?s:o;default:return[]}}function Uxe(t,e,n,r){const i=Ay(t);let s=Nxe(ld(t),n==="start",r);return i&&(s=s.map(o=>o+"-"+i),e&&(s=s.concat(s.map(XL)))),s}function o3(t){return t.replace(/left|right|bottom|top/g,e=>Mxe[e])}function jxe(t){return{top:0,right:0,bottom:0,left:0,...t}}function Fne(t){return typeof t!="number"?jxe(t):{top:t,right:t,bottom:t,left:t}}function a3(t){const{x:e,y:n,width:r,height:i}=t;return{width:r,height:i,top:n,left:e,right:e+r,bottom:n+i,x:e,y:n}}var Fxe=["input:not([inert])","select:not([inert])","textarea:not([inert])","a[href]:not([inert])","button:not([inert])","[tabindex]:not(slot):not([inert])","audio[controls]:not([inert])","video[controls]:not([inert])",'[contenteditable]:not([contenteditable="false"]):not([inert])',"details>summary:first-of-type:not([inert])","details:not([inert])"],JL=Fxe.join(","),$ne=typeof Element>"u",Jb=$ne?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,c3=!$ne&&Element.prototype.getRootNode?function(t){var e;return t==null||(e=t.getRootNode)===null||e===void 0?void 0:e.call(t)}:function(t){return t?.ownerDocument},l3=function t(e,n){var r;n===void 0&&(n=!0);var i=e==null||(r=e.getAttribute)===null||r===void 0?void 0:r.call(e,"inert"),s=i===""||i==="true",o=s||n&&e&&t(e.parentNode);return o},$xe=function(e){var n,r=e==null||(n=e.getAttribute)===null||n===void 0?void 0:n.call(e,"contenteditable");return r===""||r==="true"},Bxe=function(e,n,r){if(l3(e))return[];var i=Array.prototype.slice.apply(e.querySelectorAll(JL));return n&&Jb.call(e,JL)&&i.unshift(e),i=i.filter(r),i},Hxe=function t(e,n,r){for(var i=[],s=Array.from(e);s.length;){var o=s.shift();if(!l3(o,!1))if(o.tagName==="SLOT"){var a=o.assignedElements(),c=a.length?a:o.children,l=t(c,!0,r);r.flatten?i.push.apply(i,l):i.push({scopeParent:o,candidates:l})}else{var d=Jb.call(o,JL);d&&r.filter(o)&&(n||!e.includes(o))&&i.push(o);var h=o.shadowRoot||typeof r.getShadowRoot=="function"&&r.getShadowRoot(o),m=!l3(h,!1)&&(!r.shadowRootFilter||r.shadowRootFilter(o));if(h&&m){var g=t(h===!0?o.children:h.children,!0,r);r.flatten?i.push.apply(i,g):i.push({scopeParent:o,candidates:g})}else s.unshift.apply(s,o.children)}}return i},Bne=function(e){return!isNaN(parseInt(e.getAttribute("tabindex"),10))},Hne=function(e){if(!e)throw new Error("No node provided");return e.tabIndex<0&&(/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||$xe(e))&&!Bne(e)?0:e.tabIndex},qxe=function(e,n){var r=Hne(e);return r<0&&n&&!Bne(e)?0:r},Vxe=function(e,n){return e.tabIndex===n.tabIndex?e.documentOrder-n.documentOrder:e.tabIndex-n.tabIndex},qne=function(e){return e.tagName==="INPUT"},Kxe=function(e){return qne(e)&&e.type==="hidden"},Gxe=function(e){var n=e.tagName==="DETAILS"&&Array.prototype.slice.apply(e.children).some(function(r){return r.tagName==="SUMMARY"});return n},zxe=function(e,n){for(var r=0;r<e.length;r++)if(e[r].checked&&e[r].form===n)return e[r]},Wxe=function(e){if(!e.name)return!0;var n=e.form||c3(e),r=function(a){return n.querySelectorAll('input[type="radio"][name="'+a+'"]')},i;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")i=r(window.CSS.escape(e.name));else try{i=r(e.name)}catch(o){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",o.message),!1}var s=zxe(i,e.form);return!s||s===e},Yxe=function(e){return qne(e)&&e.type==="radio"},Xxe=function(e){return Yxe(e)&&!Wxe(e)},Jxe=function(e){var n,r=e&&c3(e),i=(n=r)===null||n===void 0?void 0:n.host,s=!1;if(r&&r!==e){var o,a,c;for(s=!!((o=i)!==null&&o!==void 0&&(a=o.ownerDocument)!==null&&a!==void 0&&a.contains(i)||e!=null&&(c=e.ownerDocument)!==null&&c!==void 0&&c.contains(e));!s&&i;){var l,d,h;r=c3(i),i=(l=r)===null||l===void 0?void 0:l.host,s=!!((d=i)!==null&&d!==void 0&&(h=d.ownerDocument)!==null&&h!==void 0&&h.contains(i))}}return s},TV=function(e){var n=e.getBoundingClientRect(),r=n.width,i=n.height;return r===0&&i===0},Qxe=function(e,n){var r=n.displayCheck,i=n.getShadowRoot;if(getComputedStyle(e).visibility==="hidden")return!0;var s=Jb.call(e,"details>summary:first-of-type"),o=s?e.parentElement:e;if(Jb.call(o,"details:not([open]) *"))return!0;if(!r||r==="full"||r==="legacy-full"){if(typeof i=="function"){for(var a=e;e;){var c=e.parentElement,l=c3(e);if(c&&!c.shadowRoot&&i(c)===!0)return TV(e);e.assignedSlot?e=e.assignedSlot:!c&&l!==e.ownerDocument?e=l.host:e=c}e=a}if(Jxe(e))return!e.getClientRects().length;if(r!=="legacy-full")return!0}else if(r==="non-zero-area")return TV(e);return!1},Zxe=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var n=e.parentElement;n;){if(n.tagName==="FIELDSET"&&n.disabled){for(var r=0;r<n.children.length;r++){var i=n.children.item(r);if(i.tagName==="LEGEND")return Jb.call(n,"fieldset[disabled] *")?!0:!i.contains(e)}return!0}n=n.parentElement}return!1},e6e=function(e,n){return!(n.disabled||l3(n)||Kxe(n)||Qxe(n,e)||Gxe(n)||Zxe(n))},RV=function(e,n){return!(Xxe(n)||Hne(n)<0||!e6e(e,n))},t6e=function(e){var n=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(n)||n>=0)},n6e=function t(e){var n=[],r=[];return e.forEach(function(i,s){var o=!!i.scopeParent,a=o?i.scopeParent:i,c=qxe(a,o),l=o?t(i.candidates):a;c===0?o?n.push.apply(n,l):n.push(a):r.push({documentOrder:s,tabIndex:c,item:i,isScope:o,content:l})}),r.sort(Vxe).reduce(function(i,s){return s.isScope?i.push.apply(i,s.content):i.push(s.content),i},[]).concat(n)},Vne=function(e,n){n=n||{};var r;return n.getShadowRoot?r=Hxe([e],n.includeContainer,{filter:RV.bind(null,n),flatten:!1,getShadowRoot:n.getShadowRoot,shadowRootFilter:t6e}):r=Bxe(e,n.includeContainer,RV.bind(null,n)),n6e(r)};function kV(t,e,n){let{reference:r,floating:i}=t;const s=Jf(e),o=w7(e),a=S7(o),c=ld(e),l=s==="y",d=r.x+r.width/2-i.width/2,h=r.y+r.height/2-i.height/2,m=r[a]/2-i[a]/2;let g;switch(c){case"top":g={x:d,y:r.y-i.height};break;case"bottom":g={x:d,y:r.y+r.height};break;case"right":g={x:r.x+r.width,y:h};break;case"left":g={x:r.x-i.width,y:h};break;default:g={x:r.x,y:r.y}}switch(Ay(e)){case"start":g[o]-=m*(n&&l?-1:1);break;case"end":g[o]+=m*(n&&l?-1:1);break}return g}const r6e=async(t,e,n)=>{const{placement:r="bottom",strategy:i="absolute",middleware:s=[],platform:o}=n,a=s.filter(Boolean),c=await(o.isRTL==null?void 0:o.isRTL(e));let l=await o.getElementRects({reference:t,floating:e,strategy:i}),{x:d,y:h}=kV(l,r,c),m=r,g={},y=0;for(let v=0;v<a.length;v++){const{name:E,fn:w}=a[v],{x:R,y:x,data:C,reset:k}=await w({x:d,y:h,initialPlacement:r,placement:m,strategy:i,middlewareData:g,rects:l,platform:o,elements:{reference:t,floating:e}});d=R??d,h=x??h,g={...g,[E]:{...g[E],...C}},k&&y<=50&&(y++,typeof k=="object"&&(k.placement&&(m=k.placement),k.rects&&(l=k.rects===!0?await o.getElementRects({reference:t,floating:e,strategy:i}):k.rects),{x:d,y:h}=kV(l,m,c)),v=-1)}return{x:d,y:h,placement:m,strategy:i,middlewareData:g}};async function Qb(t,e){var n;e===void 0&&(e={});const{x:r,y:i,platform:s,rects:o,elements:a,strategy:c}=t,{boundary:l="clippingAncestors",rootBoundary:d="viewport",elementContext:h="floating",altBoundary:m=!1,padding:g=0}=cd(e,t),y=Fne(g),E=a[m?h==="floating"?"reference":"floating":h],w=a3(await s.getClippingRect({element:(n=await(s.isElement==null?void 0:s.isElement(E)))==null||n?E:E.contextElement||await(s.getDocumentElement==null?void 0:s.getDocumentElement(a.floating)),boundary:l,rootBoundary:d,strategy:c})),R=h==="floating"?{x:r,y:i,width:o.floating.width,height:o.floating.height}:o.reference,x=await(s.getOffsetParent==null?void 0:s.getOffsetParent(a.floating)),C=await(s.isElement==null?void 0:s.isElement(x))?await(s.getScale==null?void 0:s.getScale(x))||{x:1,y:1}:{x:1,y:1},k=a3(s.convertOffsetParentRelativeRectToViewportRelativeRect?await s.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:R,offsetParent:x,strategy:c}):R);return{top:(w.top-k.top+y.top)/C.y,bottom:(k.bottom-w.bottom+y.bottom)/C.y,left:(w.left-k.left+y.left)/C.x,right:(k.right-w.right+y.right)/C.x}}const i6e=t=>({name:"arrow",options:t,async fn(e){const{x:n,y:r,placement:i,rects:s,platform:o,elements:a,middlewareData:c}=e,{element:l,padding:d=0}=cd(t,e)||{};if(l==null)return{};const h=Fne(d),m={x:n,y:r},g=w7(i),y=S7(g),v=await o.getDimensions(l),E=g==="y",w=E?"top":"left",R=E?"bottom":"right",x=E?"clientHeight":"clientWidth",C=s.reference[y]+s.reference[g]-m[g]-s.floating[y],k=m[g]-s.reference[g],T=await(o.getOffsetParent==null?void 0:o.getOffsetParent(l));let L=T?T[x]:0;(!L||!await(o.isElement==null?void 0:o.isElement(T)))&&(L=a.floating[x]||s.floating[y]);const O=C/2-k/2,P=L/2-v[y]/2-1,D=Xf(h[w],P),j=Xf(h[R],P),H=D,z=L-v[y]-j,Y=L/2-v[y]/2+O,W=YL(H,Y,z),F=!c.arrow&&Ay(i)!=null&&Y!==W&&s.reference[y]/2-(Y<H?D:j)-v[y]/2<0,$=F?Y<H?Y-H:Y-z:0;return{[g]:m[g]+$,data:{[g]:W,centerOffset:Y-W-$,...F&&{alignmentOffset:$}},reset:F}}}),s6e=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var n,r;const{placement:i,middlewareData:s,rects:o,initialPlacement:a,platform:c,elements:l}=e,{mainAxis:d=!0,crossAxis:h=!0,fallbackPlacements:m,fallbackStrategy:g="bestFit",fallbackAxisSideDirection:y="none",flipAlignment:v=!0,...E}=cd(t,e);if((n=s.arrow)!=null&&n.alignmentOffset)return{};const w=ld(i),R=Jf(a),x=ld(a)===a,C=await(c.isRTL==null?void 0:c.isRTL(l.floating)),k=m||(x||!v?[o3(a)]:Dxe(a)),T=y!=="none";!m&&T&&k.push(...Uxe(a,v,y,C));const L=[a,...k],O=await Qb(e,E),P=[];let D=((r=s.flip)==null?void 0:r.overflows)||[];if(d&&P.push(O[w]),h){const Y=Pxe(i,o,C);P.push(O[Y[0]],O[Y[1]])}if(D=[...D,{placement:i,overflows:P}],!P.every(Y=>Y<=0)){var j,H;const Y=(((j=s.flip)==null?void 0:j.index)||0)+1,W=L[Y];if(W)return{data:{index:Y,overflows:D},reset:{placement:W}};let F=(H=D.filter($=>$.overflows[0]<=0).sort(($,V)=>$.overflows[1]-V.overflows[1])[0])==null?void 0:H.placement;if(!F)switch(g){case"bestFit":{var z;const $=(z=D.filter(V=>{if(T){const G=Jf(V.placement);return G===R||G==="y"}return!0}).map(V=>[V.placement,V.overflows.filter(G=>G>0).reduce((G,Z)=>G+Z,0)]).sort((V,G)=>V[1]-G[1])[0])==null?void 0:z[0];$&&(F=$);break}case"initialPlacement":F=a;break}if(i!==F)return{reset:{placement:F}}}return{}}}};function IV(t,e){return{top:t.top-e.height,right:t.right-e.width,bottom:t.bottom-e.height,left:t.left-e.width}}function xV(t){return Lxe.some(e=>t[e]>=0)}const o6e=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(e){const{rects:n}=e,{strategy:r="referenceHidden",...i}=cd(t,e);switch(r){case"referenceHidden":{const s=await Qb(e,{...i,elementContext:"reference"}),o=IV(s,n.reference);return{data:{referenceHiddenOffsets:o,referenceHidden:xV(o)}}}case"escaped":{const s=await Qb(e,{...i,altBoundary:!0}),o=IV(s,n.floating);return{data:{escapedOffsets:o,escaped:xV(o)}}}default:return{}}}}};async function a6e(t,e){const{placement:n,platform:r,elements:i}=t,s=await(r.isRTL==null?void 0:r.isRTL(i.floating)),o=ld(n),a=Ay(n),c=Jf(n)==="y",l=["left","top"].includes(o)?-1:1,d=s&&c?-1:1,h=cd(e,t);let{mainAxis:m,crossAxis:g,alignmentAxis:y}=typeof h=="number"?{mainAxis:h,crossAxis:0,alignmentAxis:null}:{mainAxis:h.mainAxis||0,crossAxis:h.crossAxis||0,alignmentAxis:h.alignmentAxis};return a&&typeof y=="number"&&(g=a==="end"?y*-1:y),c?{x:g*d,y:m*l}:{x:m*l,y:g*d}}const c6e=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var n,r;const{x:i,y:s,placement:o,middlewareData:a}=e,c=await a6e(e,t);return o===((n=a.offset)==null?void 0:n.placement)&&(r=a.arrow)!=null&&r.alignmentOffset?{}:{x:i+c.x,y:s+c.y,data:{...c,placement:o}}}}},l6e=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:n,y:r,placement:i}=e,{mainAxis:s=!0,crossAxis:o=!1,limiter:a={fn:E=>{let{x:w,y:R}=E;return{x:w,y:R}}},...c}=cd(t,e),l={x:n,y:r},d=await Qb(e,c),h=Jf(ld(i)),m=_7(h);let g=l[m],y=l[h];if(s){const E=m==="y"?"top":"left",w=m==="y"?"bottom":"right",R=g+d[E],x=g-d[w];g=YL(R,g,x)}if(o){const E=h==="y"?"top":"left",w=h==="y"?"bottom":"right",R=y+d[E],x=y-d[w];y=YL(R,y,x)}const v=a.fn({...e,[m]:g,[h]:y});return{...v,data:{x:v.x-n,y:v.y-r,enabled:{[m]:s,[h]:o}}}}}},u6e=function(t){return t===void 0&&(t={}),{options:t,fn(e){const{x:n,y:r,placement:i,rects:s,middlewareData:o}=e,{offset:a=0,mainAxis:c=!0,crossAxis:l=!0}=cd(t,e),d={x:n,y:r},h=Jf(i),m=_7(h);let g=d[m],y=d[h];const v=cd(a,e),E=typeof v=="number"?{mainAxis:v,crossAxis:0}:{mainAxis:0,crossAxis:0,...v};if(c){const x=m==="y"?"height":"width",C=s.reference[m]-s.floating[x]+E.mainAxis,k=s.reference[m]+s.reference[x]-E.mainAxis;g<C?g=C:g>k&&(g=k)}if(l){var w,R;const x=m==="y"?"width":"height",C=["top","left"].includes(ld(i)),k=s.reference[h]-s.floating[x]+(C&&((w=o.offset)==null?void 0:w[h])||0)+(C?0:E.crossAxis),T=s.reference[h]+s.reference[x]+(C?0:((R=o.offset)==null?void 0:R[h])||0)-(C?E.crossAxis:0);y<k?y=k:y>T&&(y=T)}return{[m]:g,[h]:y}}}},d6e=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(e){var n,r;const{placement:i,rects:s,platform:o,elements:a}=e,{apply:c=()=>{},...l}=cd(t,e),d=await Qb(e,l),h=ld(i),m=Ay(i),g=Jf(i)==="y",{width:y,height:v}=s.floating;let E,w;h==="top"||h==="bottom"?(E=h,w=m===(await(o.isRTL==null?void 0:o.isRTL(a.floating))?"start":"end")?"left":"right"):(w=h,E=m==="end"?"top":"bottom");const R=v-d.top-d.bottom,x=y-d.left-d.right,C=Xf(v-d[E],R),k=Xf(y-d[w],x),T=!e.middlewareData.shift;let L=C,O=k;if((n=e.middlewareData.shift)!=null&&n.enabled.x&&(O=x),(r=e.middlewareData.shift)!=null&&r.enabled.y&&(L=R),T&&!m){const D=Yo(d.left,0),j=Yo(d.right,0),H=Yo(d.top,0),z=Yo(d.bottom,0);g?O=y-2*(D!==0||j!==0?D+j:Yo(d.left,d.right)):L=v-2*(H!==0||z!==0?H+z:Yo(d.top,d.bottom))}await c({...e,availableWidth:O,availableHeight:L});const P=await o.getDimensions(a.floating);return y!==P.width||v!==P.height?{reset:{rects:!0}}:{}}}};function Kne(t){const e=na(t);let n=parseFloat(e.width)||0,r=parseFloat(e.height)||0;const i=ta(t),s=i?t.offsetWidth:n,o=i?t.offsetHeight:r,a=s3(n)!==s||s3(r)!==o;return a&&(n=s,r=o),{width:n,height:r,$:a}}function E7(t){return Bn(t)?t:t.contextElement}function lv(t){const e=E7(t);if(!ta(e))return Tl(1);const n=e.getBoundingClientRect(),{width:r,height:i,$:s}=Kne(e);let o=(s?s3(n.width):n.width)/r,a=(s?s3(n.height):n.height)/i;return(!o||!Number.isFinite(o))&&(o=1),(!a||!Number.isFinite(a))&&(a=1),{x:o,y:a}}const f6e=Tl(0);function Gne(t){const e=po(t);return!rR()||!e.visualViewport?f6e:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function h6e(t,e,n){return e===void 0&&(e=!1),!n||e&&n!==po(t)?!1:e}function jp(t,e,n,r){e===void 0&&(e=!1),n===void 0&&(n=!1);const i=t.getBoundingClientRect(),s=E7(t);let o=Tl(1);e&&(r?Bn(r)&&(o=lv(r)):o=lv(t));const a=h6e(s,n,r)?Gne(s):Tl(0);let c=(i.left+a.x)/o.x,l=(i.top+a.y)/o.y,d=i.width/o.x,h=i.height/o.y;if(s){const m=po(s),g=r&&Bn(r)?po(r):r;let y=m,v=GL(y);for(;v&&r&&g!==y;){const E=lv(v),w=v.getBoundingClientRect(),R=na(v),x=w.left+(v.clientLeft+parseFloat(R.paddingLeft))*E.x,C=w.top+(v.clientTop+parseFloat(R.paddingTop))*E.y;c*=E.x,l*=E.y,d*=E.x,h*=E.y,c+=x,l+=C,y=po(v),v=GL(y)}}return a3({width:d,height:h,x:c,y:l})}function C7(t,e){const n=iR(t).scrollLeft;return e?e.left+n:jp(Bl(t)).left+n}function zne(t,e,n){n===void 0&&(n=!1);const r=t.getBoundingClientRect(),i=r.left+e.scrollLeft-(n?0:C7(t,r)),s=r.top+e.scrollTop;return{x:i,y:s}}function p6e(t){let{elements:e,rect:n,offsetParent:r,strategy:i}=t;const s=i==="fixed",o=Bl(r),a=e?nR(e.floating):!1;if(r===o||a&&s)return n;let c={scrollLeft:0,scrollTop:0},l=Tl(1);const d=Tl(0),h=ta(r);if((h||!h&&!s)&&((xy(r)!=="body"||Y_(o))&&(c=iR(r)),ta(r))){const g=jp(r);l=lv(r),d.x=g.x+r.clientLeft,d.y=g.y+r.clientTop}const m=o&&!h&&!s?zne(o,c,!0):Tl(0);return{width:n.width*l.x,height:n.height*l.y,x:n.x*l.x-c.scrollLeft*l.x+d.x+m.x,y:n.y*l.y-c.scrollTop*l.y+d.y+m.y}}function m6e(t){return Array.from(t.getClientRects())}function g6e(t){const e=Bl(t),n=iR(t),r=t.ownerDocument.body,i=Yo(e.scrollWidth,e.clientWidth,r.scrollWidth,r.clientWidth),s=Yo(e.scrollHeight,e.clientHeight,r.scrollHeight,r.clientHeight);let o=-n.scrollLeft+C7(t);const a=-n.scrollTop;return na(r).direction==="rtl"&&(o+=Yo(e.clientWidth,r.clientWidth)-i),{width:i,height:s,x:o,y:a}}function v6e(t,e){const n=po(t),r=Bl(t),i=n.visualViewport;let s=r.clientWidth,o=r.clientHeight,a=0,c=0;if(i){s=i.width,o=i.height;const l=rR();(!l||l&&e==="fixed")&&(a=i.offsetLeft,c=i.offsetTop)}return{width:s,height:o,x:a,y:c}}function y6e(t,e){const n=jp(t,!0,e==="fixed"),r=n.top+t.clientTop,i=n.left+t.clientLeft,s=ta(t)?lv(t):Tl(1),o=t.clientWidth*s.x,a=t.clientHeight*s.y,c=i*s.x,l=r*s.y;return{width:o,height:a,x:c,y:l}}function AV(t,e,n){let r;if(e==="viewport")r=v6e(t,n);else if(e==="document")r=g6e(Bl(t));else if(Bn(e))r=y6e(e,n);else{const i=Gne(t);r={x:e.x-i.x,y:e.y-i.y,width:e.width,height:e.height}}return a3(r)}function Wne(t,e){const n=ad(t);return n===e||!Bn(n)||Gu(n)?!1:na(n).position==="fixed"||Wne(n,e)}function b6e(t,e){const n=e.get(t);if(n)return n;let r=Pf(t,[],!1).filter(a=>Bn(a)&&xy(a)!=="body"),i=null;const s=na(t).position==="fixed";let o=s?ad(t):t;for(;Bn(o)&&!Gu(o);){const a=na(o),c=b7(o);!c&&a.position==="fixed"&&(i=null),(s?!c&&!i:!c&&a.position==="static"&&!!i&&["absolute","fixed"].includes(i.position)||Y_(o)&&!c&&Wne(t,o))?r=r.filter(d=>d!==o):i=a,o=ad(o)}return e.set(t,r),r}function _6e(t){let{element:e,boundary:n,rootBoundary:r,strategy:i}=t;const o=[...n==="clippingAncestors"?nR(e)?[]:b6e(e,this._c):[].concat(n),r],a=o[0],c=o.reduce((l,d)=>{const h=AV(e,d,i);return l.top=Yo(h.top,l.top),l.right=Xf(h.right,l.right),l.bottom=Xf(h.bottom,l.bottom),l.left=Yo(h.left,l.left),l},AV(e,a,i));return{width:c.right-c.left,height:c.bottom-c.top,x:c.left,y:c.top}}function S6e(t){const{width:e,height:n}=Kne(t);return{width:e,height:n}}function w6e(t,e,n){const r=ta(e),i=Bl(e),s=n==="fixed",o=jp(t,!0,s,e);let a={scrollLeft:0,scrollTop:0};const c=Tl(0);if(r||!r&&!s)if((xy(e)!=="body"||Y_(i))&&(a=iR(e)),r){const m=jp(e,!0,s,e);c.x=m.x+e.clientLeft,c.y=m.y+e.clientTop}else i&&(c.x=C7(i));const l=i&&!r&&!s?zne(i,a):Tl(0),d=o.left+a.scrollLeft-c.x-l.x,h=o.top+a.scrollTop-c.y-l.y;return{x:d,y:h,width:o.width,height:o.height}}function r6(t){return na(t).position==="static"}function LV(t,e){if(!ta(t)||na(t).position==="fixed")return null;if(e)return e(t);let n=t.offsetParent;return Bl(t)===n&&(n=n.ownerDocument.body),n}function Yne(t,e){const n=po(t);if(nR(t))return n;if(!ta(t)){let i=ad(t);for(;i&&!Gu(i);){if(Bn(i)&&!r6(i))return i;i=ad(i)}return n}let r=LV(t,e);for(;r&&wxe(r)&&r6(r);)r=LV(r,e);return r&&Gu(r)&&r6(r)&&!b7(r)?n:r||Exe(t)||n}const E6e=async function(t){const e=this.getOffsetParent||Yne,n=this.getDimensions,r=await n(t.floating);return{reference:w6e(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}};function C6e(t){return na(t).direction==="rtl"}const T6e={convertOffsetParentRelativeRectToViewportRelativeRect:p6e,getDocumentElement:Bl,getClippingRect:_6e,getOffsetParent:Yne,getElementRects:E6e,getClientRects:m6e,getDimensions:S6e,getScale:lv,isElement:Bn,isRTL:C6e};function Xne(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height}function R6e(t,e){let n=null,r;const i=Bl(t);function s(){var a;clearTimeout(r),(a=n)==null||a.disconnect(),n=null}function o(a,c){a===void 0&&(a=!1),c===void 0&&(c=1),s();const l=t.getBoundingClientRect(),{left:d,top:h,width:m,height:g}=l;if(a||e(),!m||!g)return;const y=yw(h),v=yw(i.clientWidth-(d+m)),E=yw(i.clientHeight-(h+g)),w=yw(d),x={rootMargin:-y+"px "+-v+"px "+-E+"px "+-w+"px",threshold:Yo(0,Xf(1,c))||1};let C=!0;function k(T){const L=T[0].intersectionRatio;if(L!==c){if(!C)return o();L?o(!1,L):r=setTimeout(()=>{o(!1,1e-7)},1e3)}L===1&&!Xne(l,t.getBoundingClientRect())&&o(),C=!1}try{n=new IntersectionObserver(k,{...x,root:i.ownerDocument})}catch{n=new IntersectionObserver(k,x)}n.observe(t)}return o(!0),s}function T7(t,e,n,r){r===void 0&&(r={});const{ancestorScroll:i=!0,ancestorResize:s=!0,elementResize:o=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:c=!1}=r,l=E7(t),d=i||s?[...l?Pf(l):[],...Pf(e)]:[];d.forEach(w=>{i&&w.addEventListener("scroll",n,{passive:!0}),s&&w.addEventListener("resize",n)});const h=l&&a?R6e(l,n):null;let m=-1,g=null;o&&(g=new ResizeObserver(w=>{let[R]=w;R&&R.target===l&&g&&(g.unobserve(e),cancelAnimationFrame(m),m=requestAnimationFrame(()=>{var x;(x=g)==null||x.observe(e)})),n()}),l&&!c&&g.observe(l),g.observe(e));let y,v=c?jp(t):null;c&&E();function E(){const w=jp(t);v&&!Xne(v,w)&&n(),v=w,y=requestAnimationFrame(E)}return n(),()=>{var w;d.forEach(R=>{i&&R.removeEventListener("scroll",n),s&&R.removeEventListener("resize",n)}),h?.(),(w=g)==null||w.disconnect(),g=null,c&&cancelAnimationFrame(y)}}const k6e=c6e,I6e=l6e,x6e=s6e,A6e=d6e,L6e=o6e,MV=i6e,M6e=u6e,O6e=(t,e,n)=>{const r=new Map,i={platform:T6e,...n},s={...i.platform,_c:r};return r6e(t,e,{...i,platform:s})};var GE=typeof document<"u"?_.useLayoutEffect:_.useEffect;function u3(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="function"&&t.toString()===e.toString())return!0;let n,r,i;if(t&&e&&typeof t=="object"){if(Array.isArray(t)){if(n=t.length,n!==e.length)return!1;for(r=n;r--!==0;)if(!u3(t[r],e[r]))return!1;return!0}if(i=Object.keys(t),n=i.length,n!==Object.keys(e).length)return!1;for(r=n;r--!==0;)if(!{}.hasOwnProperty.call(e,i[r]))return!1;for(r=n;r--!==0;){const s=i[r];if(!(s==="_owner"&&t.$$typeof)&&!u3(t[s],e[s]))return!1}return!0}return t!==t&&e!==e}function Jne(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function OV(t,e){const n=Jne(t);return Math.round(e*n)/n}function i6(t){const e=_.useRef(t);return GE(()=>{e.current=t}),e}function R7(t){t===void 0&&(t={});const{placement:e="bottom",strategy:n="absolute",middleware:r=[],platform:i,elements:{reference:s,floating:o}={},transform:a=!0,whileElementsMounted:c,open:l}=t,[d,h]=_.useState({x:0,y:0,strategy:n,placement:e,middlewareData:{},isPositioned:!1}),[m,g]=_.useState(r);u3(m,r)||g(r);const[y,v]=_.useState(null),[E,w]=_.useState(null),R=_.useCallback(V=>{V!==T.current&&(T.current=V,v(V))},[]),x=_.useCallback(V=>{V!==L.current&&(L.current=V,w(V))},[]),C=s||y,k=o||E,T=_.useRef(null),L=_.useRef(null),O=_.useRef(d),P=c!=null,D=i6(c),j=i6(i),H=i6(l),z=_.useCallback(()=>{if(!T.current||!L.current)return;const V={placement:e,strategy:n,middleware:m};j.current&&(V.platform=j.current),O6e(T.current,L.current,V).then(G=>{const Z={...G,isPositioned:H.current!==!1};Y.current&&!u3(O.current,Z)&&(O.current=Z,em.flushSync(()=>{h(Z)}))})},[m,e,n,j,H]);GE(()=>{l===!1&&O.current.isPositioned&&(O.current.isPositioned=!1,h(V=>({...V,isPositioned:!1})))},[l]);const Y=_.useRef(!1);GE(()=>(Y.current=!0,()=>{Y.current=!1}),[]),GE(()=>{if(C&&(T.current=C),k&&(L.current=k),C&&k){if(D.current)return D.current(C,k,z);z()}},[C,k,z,D,P]);const W=_.useMemo(()=>({reference:T,floating:L,setReference:R,setFloating:x}),[R,x]),F=_.useMemo(()=>({reference:C,floating:k}),[C,k]),$=_.useMemo(()=>{const V={position:n,left:0,top:0};if(!F.floating)return V;const G=OV(F.floating,d.x),Z=OV(F.floating,d.y);return a?{...V,transform:"translate("+G+"px, "+Z+"px)",...Jne(F.floating)>=1.5&&{willChange:"transform"}}:{position:n,left:G,top:Z}},[n,a,F.floating,d.x,d.y]);return _.useMemo(()=>({...d,update:z,refs:W,elements:F,floatingStyles:$}),[d,z,W,F,$])}const P6e=t=>{function e(n){return{}.hasOwnProperty.call(n,"current")}return{name:"arrow",options:t,fn(n){const{element:r,padding:i}=typeof t=="function"?t(n):t;return r&&e(r)?r.current!=null?MV({element:r.current,padding:i}).fn(n):{}:r?MV({element:r,padding:i}).fn(n):{}}}},k7=(t,e)=>({...k6e(t),options:[t,e]}),I7=(t,e)=>({...I6e(t),options:[t,e]}),Qne=(t,e)=>({...M6e(t),options:[t,e]}),x7=(t,e)=>({...x6e(t),options:[t,e]}),Zne=(t,e)=>({...A6e(t),options:[t,e]}),ere=(t,e)=>({...L6e(t),options:[t,e]}),A7=(t,e)=>({...P6e(t),options:[t,e]});function tre(t){return _.useMemo(()=>t.every(e=>e==null)?null:e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})},t)}const nre={...my},D6e=nre.useInsertionEffect,N6e=D6e||(t=>t());function Du(t){const e=_.useRef(()=>{});return N6e(()=>{e.current=t}),_.useCallback(function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return e.current==null?void 0:e.current(...r)},[])}var Ns=typeof document<"u"?_.useLayoutEffect:_.useEffect;let PV=!1,U6e=0;const DV=()=>"floating-ui-"+Math.random().toString(36).slice(2,6)+U6e++;function j6e(){const[t,e]=_.useState(()=>PV?DV():void 0);return Ns(()=>{t==null&&e(DV())},[]),_.useEffect(()=>{PV=!0},[]),t}const F6e=nre.useId,Bv=F6e||j6e,$6e=_.forwardRef(function(e,n){const{context:{placement:r,elements:{floating:i},middlewareData:{arrow:s,shift:o}},width:a=14,height:c=7,tipRadius:l=0,strokeWidth:d=0,staticOffset:h,stroke:m,d:g,style:{transform:y,...v}={},...E}=e,w=Bv(),[R,x]=_.useState(!1);if(Ns(()=>{if(!i)return;na(i).direction==="rtl"&&x(!0)},[i]),!i)return null;const[C,k]=r.split("-"),T=C==="top"||C==="bottom";let L=h;(T&&o!=null&&o.x||!T&&o!=null&&o.y)&&(L=null);const O=d*2,P=O/2,D=a/2*(l/-8+1),j=c/2*l/4,H=!!g,z=L&&k==="end"?"bottom":"top";let Y=L&&k==="end"?"right":"left";L&&R&&(Y=k==="end"?"left":"right");const W=s?.x!=null?L||s.x:"",F=s?.y!=null?L||s.y:"",$=g||"M0,0"+(" H"+a)+(" L"+(a-D)+","+(c-j))+(" Q"+a/2+","+c+" "+D+","+(c-j))+" Z",V={top:H?"rotate(180deg)":"",left:H?"rotate(90deg)":"rotate(-90deg)",bottom:H?"":"rotate(180deg)",right:H?"rotate(-90deg)":"rotate(90deg)"}[C];return S.jsxs("svg",{...E,"aria-hidden":!0,ref:n,width:H?a:a+O,height:a,viewBox:"0 0 "+a+" "+(c>a?c:a),style:{position:"absolute",pointerEvents:"none",[Y]:W,[z]:F,[C]:T||H?"100%":"calc(100% - "+O/2+"px)",transform:[V,y].filter(G=>!!G).join(" "),...v},children:[O>0&&S.jsx("path",{clipPath:"url(#"+w+")",fill:"none",stroke:m,strokeWidth:O+(g?0:1),d:$}),S.jsx("path",{stroke:O&&!g?E.fill:"none",d:$}),S.jsx("clipPath",{id:w,children:S.jsx("rect",{x:-P,y:P*(H?-1:1),width:a+O,height:a})})]})});function B6e(){const t=new Map;return{emit(e,n){var r;(r=t.get(e))==null||r.forEach(i=>i(n))},on(e,n){t.set(e,[...t.get(e)||[],n])},off(e,n){var r;t.set(e,((r=t.get(e))==null?void 0:r.filter(i=>i!==n))||[])}}}const H6e=_.createContext(null),q6e=_.createContext(null),L7=()=>{var t;return((t=_.useContext(H6e))==null?void 0:t.id)||null},M7=()=>_.useContext(q6e);function X_(t){return"data-floating-ui-"+t}function s6(t){const e=_.useRef(t);return Ns(()=>{e.current=t}),e}const NV=X_("safe-polygon");function zE(t,e,n){return n&&!WL(n)?0:typeof t=="number"?t:t?.[e]}function V6e(t,e){e===void 0&&(e={});const{open:n,onOpenChange:r,dataRef:i,events:s,elements:o}=t,{enabled:a=!0,delay:c=0,handleClose:l=null,mouseOnly:d=!1,restMs:h=0,move:m=!0}=e,g=M7(),y=L7(),v=s6(l),E=s6(c),w=s6(n),R=_.useRef(),x=_.useRef(-1),C=_.useRef(),k=_.useRef(-1),T=_.useRef(!0),L=_.useRef(!1),O=_.useRef(()=>{}),P=_.useRef(!1),D=_.useCallback(()=>{var $;const V=($=i.current.openEvent)==null?void 0:$.type;return V?.includes("mouse")&&V!=="mousedown"},[i]);_.useEffect(()=>{if(!a)return;function $(V){let{open:G}=V;G||(clearTimeout(x.current),clearTimeout(k.current),T.current=!0,P.current=!1)}return s.on("openchange",$),()=>{s.off("openchange",$)}},[a,s]),_.useEffect(()=>{if(!a||!v.current||!n)return;function $(G){D()&&r(!1,G,"hover")}const V=wf(o.floating).documentElement;return V.addEventListener("mouseleave",$),()=>{V.removeEventListener("mouseleave",$)}},[o.floating,n,r,a,v,D]);const j=_.useCallback(function($,V,G){V===void 0&&(V=!0),G===void 0&&(G="hover");const Z=zE(E.current,"close",R.current);Z&&!C.current?(clearTimeout(x.current),x.current=window.setTimeout(()=>r(!1,$,G),Z)):V&&(clearTimeout(x.current),r(!1,$,G))},[E,r]),H=Du(()=>{O.current(),C.current=void 0}),z=Du(()=>{if(L.current){const $=wf(o.floating).body;$.style.pointerEvents="",$.removeAttribute(NV),L.current=!1}}),Y=Du(()=>i.current.openEvent?["click","mousedown"].includes(i.current.openEvent.type):!1);_.useEffect(()=>{if(!a)return;function $(q){if(clearTimeout(x.current),T.current=!1,d&&!WL(R.current)||h>0&&!zE(E.current,"open"))return;const J=zE(E.current,"open",R.current);J?x.current=window.setTimeout(()=>{w.current||r(!0,q,"hover")},J):n||r(!0,q,"hover")}function V(q){if(Y())return;O.current();const J=wf(o.floating);if(clearTimeout(k.current),P.current=!1,v.current&&i.current.floatingContext){n||clearTimeout(x.current),C.current=v.current({...i.current.floatingContext,tree:g,x:q.clientX,y:q.clientY,onClose(){z(),H(),Y()||j(q,!0,"safe-polygon")}});const ge=C.current;J.addEventListener("mousemove",ge),O.current=()=>{J.removeEventListener("mousemove",ge)};return}(R.current!=="touch"||!$v(o.floating,q.relatedTarget))&&j(q)}function G(q){Y()||i.current.floatingContext&&(v.current==null||v.current({...i.current.floatingContext,tree:g,x:q.clientX,y:q.clientY,onClose(){z(),H(),Y()||j(q)}})(q))}if(Bn(o.domReference)){var Z;const q=o.domReference;return n&&q.addEventListener("mouseleave",G),(Z=o.floating)==null||Z.addEventListener("mouseleave",G),m&&q.addEventListener("mousemove",$,{once:!0}),q.addEventListener("mouseenter",$),q.addEventListener("mouseleave",V),()=>{var J;n&&q.removeEventListener("mouseleave",G),(J=o.floating)==null||J.removeEventListener("mouseleave",G),m&&q.removeEventListener("mousemove",$),q.removeEventListener("mouseenter",$),q.removeEventListener("mouseleave",V)}}},[o,a,t,d,h,m,j,H,z,r,n,w,g,E,v,i,Y]),Ns(()=>{var $;if(a&&n&&($=v.current)!=null&&$.__options.blockPointerEvents&&D()){L.current=!0;const G=o.floating;if(Bn(o.domReference)&&G){var V;const Z=wf(o.floating).body;Z.setAttribute(NV,"");const q=o.domReference,J=g==null||(V=g.nodesRef.current.find(ue=>ue.id===y))==null||(V=V.context)==null?void 0:V.elements.floating;return J&&(J.style.pointerEvents=""),Z.style.pointerEvents="none",q.style.pointerEvents="auto",G.style.pointerEvents="auto",()=>{Z.style.pointerEvents="",q.style.pointerEvents="",G.style.pointerEvents=""}}}},[a,n,y,o,g,v,D]),Ns(()=>{n||(R.current=void 0,P.current=!1,H(),z())},[n,H,z]),_.useEffect(()=>()=>{H(),clearTimeout(x.current),clearTimeout(k.current),z()},[a,o.domReference,H,z]);const W=_.useMemo(()=>{function $(V){R.current=V.pointerType}return{onPointerDown:$,onPointerEnter:$,onMouseMove(V){const{nativeEvent:G}=V;function Z(){!T.current&&!w.current&&r(!0,G,"hover")}d&&!WL(R.current)||n||h===0||P.current&&V.movementX**2+V.movementY**2<2||(clearTimeout(k.current),R.current==="touch"?Z():(P.current=!0,k.current=window.setTimeout(Z,h)))}}},[d,r,n,w,h]),F=_.useMemo(()=>({onMouseEnter(){clearTimeout(x.current)},onMouseLeave($){Y()||j($.nativeEvent,!1)}}),[j,Y]);return _.useMemo(()=>a?{reference:W,floating:F}:{},[a,W,F])}const QL=()=>{},rre=_.createContext({delay:0,initialDelay:0,timeoutMs:0,currentId:null,setCurrentId:QL,setState:QL,isInstantPhase:!1}),K6e=()=>_.useContext(rre);function G6e(t){const{children:e,delay:n,timeoutMs:r=0}=t,[i,s]=_.useReducer((c,l)=>({...c,...l}),{delay:n,timeoutMs:r,initialDelay:n,currentId:null,isInstantPhase:!1}),o=_.useRef(null),a=_.useCallback(c=>{s({currentId:c})},[]);return Ns(()=>{i.currentId?o.current===null?o.current=i.currentId:i.isInstantPhase||s({isInstantPhase:!0}):(i.isInstantPhase&&s({isInstantPhase:!1}),o.current=null)},[i.currentId,i.isInstantPhase]),S.jsx(rre.Provider,{value:_.useMemo(()=>({...i,setState:s,setCurrentId:a}),[i,a]),children:e})}function z6e(t,e){e===void 0&&(e={});const{open:n,onOpenChange:r,floatingId:i}=t,{id:s,enabled:o=!0}=e,a=s??i,c=K6e(),{currentId:l,setCurrentId:d,initialDelay:h,setState:m,timeoutMs:g}=c;return Ns(()=>{o&&l&&(m({delay:{open:1,close:zE(h,"close")}}),l!==a&&r(!1))},[o,a,r,m,l,h]),Ns(()=>{function y(){r(!1),m({delay:h,currentId:null})}if(o&&l&&!n&&l===a){if(g){const v=window.setTimeout(y,g);return()=>{clearTimeout(v)}}y()}},[o,n,m,l,a,r,h,g]),Ns(()=>{o&&(d===QL||!n||d(a))},[o,n,d,a]),c}function o6(t,e){let n=t.filter(i=>{var s;return i.parentId===e&&((s=i.context)==null?void 0:s.open)}),r=n;for(;r.length;)r=t.filter(i=>{var s;return(s=r)==null?void 0:s.some(o=>{var a;return i.parentId===o.id&&((a=i.context)==null?void 0:a.open)})}),n=n.concat(r);return n}const ire=()=>({getShadowRoot:!0,displayCheck:typeof ResizeObserver=="function"&&ResizeObserver.toString().includes("[native code]")?"full":"none"});function sre(t,e){const n=Vne(t,ire());e==="prev"&&n.reverse();const r=n.indexOf(zL(wf(t)));return n.slice(r+1)[0]}function W6e(){return sre(document.body,"next")}function Y6e(){return sre(document.body,"prev")}function a6(t,e){const n=e||t.currentTarget,r=t.relatedTarget;return!r||!$v(n,r)}function X6e(t){Vne(t,ire()).forEach(n=>{n.dataset.tabindex=n.getAttribute("tabindex")||"",n.setAttribute("tabindex","-1")})}function UV(t){t.querySelectorAll("[data-tabindex]").forEach(n=>{const r=n.dataset.tabindex;delete n.dataset.tabindex,r?n.setAttribute("tabindex",r):n.removeAttribute("tabindex")})}const ore={border:0,clip:"rect(0 0 0 0)",height:"1px",margin:"-1px",overflow:"hidden",padding:0,position:"fixed",whiteSpace:"nowrap",width:"1px",top:0,left:0};let J6e;function jV(t){t.key==="Tab"&&(t.target,clearTimeout(J6e))}const FV=_.forwardRef(function(e,n){const[r,i]=_.useState();Ns(()=>(jne()&&i("button"),document.addEventListener("keydown",jV),()=>{document.removeEventListener("keydown",jV)}),[]);const s={ref:n,tabIndex:0,role:r,"aria-hidden":r?void 0:!0,[X_("focus-guard")]:"",style:ore};return S.jsx("span",{...e,...s})}),are=_.createContext(null),$V=X_("portal");function Q6e(t){t===void 0&&(t={});const{id:e,root:n}=t,r=Bv(),i=e5e(),[s,o]=_.useState(null),a=_.useRef(null);return Ns(()=>()=>{s?.remove(),queueMicrotask(()=>{a.current=null})},[s]),Ns(()=>{if(!r||a.current)return;const c=e?document.getElementById(e):null;if(!c)return;const l=document.createElement("div");l.id=r,l.setAttribute($V,""),c.appendChild(l),a.current=l,o(l)},[e,r]),Ns(()=>{if(n===null||!r||a.current)return;let c=n||i?.portalNode;c&&!Bn(c)&&(c=c.current),c=c||document.body;let l=null;e&&(l=document.createElement("div"),l.id=e,c.appendChild(l));const d=document.createElement("div");d.id=r,d.setAttribute($V,""),c=l||c,c.appendChild(d),a.current=d,o(d)},[e,n,r,i]),s}function Z6e(t){const{children:e,id:n,root:r,preserveTabOrder:i=!0}=t,s=Q6e({id:n,root:r}),[o,a]=_.useState(null),c=_.useRef(null),l=_.useRef(null),d=_.useRef(null),h=_.useRef(null),m=o?.modal,g=o?.open,y=!!o&&!o.modal&&o.open&&i&&!!(r||s);return _.useEffect(()=>{if(!s||!i||m)return;function v(E){s&&a6(E)&&(E.type==="focusin"?UV:X6e)(s)}return s.addEventListener("focusin",v,!0),s.addEventListener("focusout",v,!0),()=>{s.removeEventListener("focusin",v,!0),s.removeEventListener("focusout",v,!0)}},[s,i,m]),_.useEffect(()=>{s&&(g||UV(s))},[g,s]),S.jsxs(are.Provider,{value:_.useMemo(()=>({preserveTabOrder:i,beforeOutsideRef:c,afterOutsideRef:l,beforeInsideRef:d,afterInsideRef:h,portalNode:s,setFocusManagerState:a}),[i,s]),children:[y&&s&&S.jsx(FV,{"data-type":"outside",ref:c,onFocus:v=>{if(a6(v,s)){var E;(E=d.current)==null||E.focus()}else{const w=Y6e()||o?.domReference;w?.focus()}}}),y&&s&&S.jsx("span",{"aria-owns":s.id,style:ore}),s&&em.createPortal(e,s),y&&s&&S.jsx(FV,{"data-type":"outside",ref:l,onFocus:v=>{if(a6(v,s)){var E;(E=h.current)==null||E.focus()}else{const w=W6e()||o?.domReference;w?.focus(),o?.closeOnFocusOut&&o?.onOpenChange(!1,v.nativeEvent,"focus-out")}}})]})}const e5e=()=>_.useContext(are),t5e="data-floating-ui-focusable",n5e={pointerdown:"onPointerDown",mousedown:"onMouseDown",click:"onClick"},r5e={pointerdown:"onPointerDownCapture",mousedown:"onMouseDownCapture",click:"onClickCapture"},BV=t=>{var e,n;return{escapeKey:typeof t=="boolean"?t:(e=t?.escapeKey)!=null?e:!1,outsidePress:typeof t=="boolean"?t:(n=t?.outsidePress)!=null?n:!0}};function i5e(t,e){e===void 0&&(e={});const{open:n,onOpenChange:r,elements:i,dataRef:s}=t,{enabled:o=!0,escapeKey:a=!0,outsidePress:c=!0,outsidePressEvent:l="pointerdown",referencePress:d=!1,referencePressEvent:h="pointerdown",ancestorScroll:m=!1,bubbles:g,capture:y}=e,v=M7(),E=Du(typeof c=="function"?c:()=>!1),w=typeof c=="function"?E:c,R=_.useRef(!1),x=_.useRef(!1),{escapeKey:C,outsidePress:k}=BV(g),{escapeKey:T,outsidePress:L}=BV(y),O=_.useRef(!1),P=Du(W=>{var F;if(!n||!o||!a||W.key!=="Escape"||O.current)return;const $=(F=s.current.floatingContext)==null?void 0:F.nodeId,V=v?o6(v.nodesRef.current,$):[];if(!C&&(W.stopPropagation(),V.length>0)){let G=!0;if(V.forEach(Z=>{var q;if((q=Z.context)!=null&&q.open&&!Z.context.dataRef.current.__escapeKeyBubbles){G=!1;return}}),!G)return}r(!1,kxe(W)?W.nativeEvent:W,"escape-key")}),D=Du(W=>{var F;const $=()=>{var V;P(W),(V=Mg(W))==null||V.removeEventListener("keydown",$)};(F=Mg(W))==null||F.addEventListener("keydown",$)}),j=Du(W=>{var F;const $=R.current;R.current=!1;const V=x.current;if(x.current=!1,l==="click"&&V||$||typeof w=="function"&&!w(W))return;const G=Mg(W),Z="["+X_("inert")+"]",q=wf(i.floating).querySelectorAll(Z);let J=Bn(G)?G:null;for(;J&&!Gu(J);){const we=ad(J);if(Gu(we)||!Bn(we))break;J=we}if(q.length&&Bn(G)&&!Ixe(G)&&!$v(G,i.floating)&&Array.from(q).every(we=>!$v(J,we)))return;if(ta(G)&&Y){const we=Gu(G),de=na(G),ke=/auto|scroll/,De=we||ke.test(de.overflowX),Je=we||ke.test(de.overflowY),vt=De&&G.clientWidth>0&&G.scrollWidth>G.clientWidth,Sr=Je&&G.clientHeight>0&&G.scrollHeight>G.clientHeight,zn=de.direction==="rtl",ze=Sr&&(zn?W.offsetX<=G.offsetWidth-G.clientWidth:W.offsetX>G.clientWidth),ys=vt&&W.offsetY>G.clientHeight;if(ze||ys)return}const ue=(F=s.current.floatingContext)==null?void 0:F.nodeId,ge=v&&o6(v.nodesRef.current,ue).some(we=>{var de;return n6(W,(de=we.context)==null?void 0:de.elements.floating)});if(n6(W,i.floating)||n6(W,i.domReference)||ge)return;const Re=v?o6(v.nodesRef.current,ue):[];if(Re.length>0){let we=!0;if(Re.forEach(de=>{var ke;if((ke=de.context)!=null&&ke.open&&!de.context.dataRef.current.__outsidePressBubbles){we=!1;return}}),!we)return}r(!1,W,"outside-press")}),H=Du(W=>{var F;const $=()=>{var V;j(W),(V=Mg(W))==null||V.removeEventListener(l,$)};(F=Mg(W))==null||F.addEventListener(l,$)});_.useEffect(()=>{if(!n||!o)return;s.current.__escapeKeyBubbles=C,s.current.__outsidePressBubbles=k;let W=-1;function F(q){r(!1,q,"ancestor-scroll")}function $(){window.clearTimeout(W),O.current=!0}function V(){W=window.setTimeout(()=>{O.current=!1},rR()?5:0)}const G=wf(i.floating);a&&(G.addEventListener("keydown",T?D:P,T),G.addEventListener("compositionstart",$),G.addEventListener("compositionend",V)),w&&G.addEventListener(l,L?H:j,L);let Z=[];return m&&(Bn(i.domReference)&&(Z=Pf(i.domReference)),Bn(i.floating)&&(Z=Z.concat(Pf(i.floating))),!Bn(i.reference)&&i.reference&&i.reference.contextElement&&(Z=Z.concat(Pf(i.reference.contextElement)))),Z=Z.filter(q=>{var J;return q!==((J=G.defaultView)==null?void 0:J.visualViewport)}),Z.forEach(q=>{q.addEventListener("scroll",F,{passive:!0})}),()=>{a&&(G.removeEventListener("keydown",T?D:P,T),G.removeEventListener("compositionstart",$),G.removeEventListener("compositionend",V)),w&&G.removeEventListener(l,L?H:j,L),Z.forEach(q=>{q.removeEventListener("scroll",F)}),window.clearTimeout(W)}},[s,i,a,w,l,n,r,m,o,C,k,P,T,D,j,L,H]),_.useEffect(()=>{R.current=!1},[w,l]);const z=_.useMemo(()=>({onKeyDown:P,...d&&{[n5e[h]]:W=>{r(!1,W.nativeEvent,"reference-press")},...h!=="click"&&{onClick(W){r(!1,W.nativeEvent,"reference-press")}}}}),[P,r,d,h]),Y=_.useMemo(()=>({onKeyDown:P,onMouseDown(){x.current=!0},onMouseUp(){x.current=!0},[r5e[l]]:()=>{R.current=!0}}),[P,l]);return _.useMemo(()=>o?{reference:z,floating:Y}:{},[o,z,Y])}function s5e(t){const{open:e=!1,onOpenChange:n,elements:r}=t,i=Bv(),s=_.useRef({}),[o]=_.useState(()=>B6e()),a=L7()!=null,[c,l]=_.useState(r.reference),d=Du((g,y,v)=>{s.current.openEvent=g?y:void 0,o.emit("openchange",{open:g,event:y,reason:v,nested:a}),n?.(g,y,v)}),h=_.useMemo(()=>({setPositionReference:l}),[]),m=_.useMemo(()=>({reference:c||r.reference||null,floating:r.floating||null,domReference:r.reference}),[c,r.reference,r.floating]);return _.useMemo(()=>({dataRef:s,open:e,onOpenChange:d,elements:m,events:o,floatingId:i,refs:h}),[e,d,m,o,i,h])}function o5e(t){t===void 0&&(t={});const{nodeId:e}=t,n=s5e({...t,elements:{reference:null,floating:null,...t.elements}}),r=t.rootContext||n,i=r.elements,[s,o]=_.useState(null),[a,c]=_.useState(null),d=i?.domReference||s,h=_.useRef(null),m=M7();Ns(()=>{d&&(h.current=d)},[d]);const g=R7({...t,elements:{...i,...a&&{reference:a}}}),y=_.useCallback(x=>{const C=Bn(x)?{getBoundingClientRect:()=>x.getBoundingClientRect(),contextElement:x}:x;c(C),g.refs.setReference(C)},[g.refs]),v=_.useCallback(x=>{(Bn(x)||x===null)&&(h.current=x,o(x)),(Bn(g.refs.reference.current)||g.refs.reference.current===null||x!==null&&!Bn(x))&&g.refs.setReference(x)},[g.refs]),E=_.useMemo(()=>({...g.refs,setReference:v,setPositionReference:y,domReference:h}),[g.refs,v,y]),w=_.useMemo(()=>({...g.elements,domReference:d}),[g.elements,d]),R=_.useMemo(()=>({...g,...r,refs:E,elements:w,nodeId:e}),[g,E,w,e,r]);return Ns(()=>{r.dataRef.current.floatingContext=R;const x=m?.nodesRef.current.find(C=>C.id===e);x&&(x.context=R)}),_.useMemo(()=>({...g,context:R,refs:E,elements:w}),[g,E,w,R])}function a5e(t,e){e===void 0&&(e={});const{open:n,onOpenChange:r,events:i,dataRef:s,elements:o}=t,{enabled:a=!0,visibleOnly:c=!0}=e,l=_.useRef(!1),d=_.useRef(),h=_.useRef(!0);_.useEffect(()=>{if(!a)return;const g=po(o.domReference);function y(){!n&&ta(o.domReference)&&o.domReference===zL(wf(o.domReference))&&(l.current=!0)}function v(){h.current=!0}return g.addEventListener("blur",y),g.addEventListener("keydown",v,!0),()=>{g.removeEventListener("blur",y),g.removeEventListener("keydown",v,!0)}},[o.domReference,n,a]),_.useEffect(()=>{if(!a)return;function g(y){let{reason:v}=y;(v==="reference-press"||v==="escape-key")&&(l.current=!0)}return i.on("openchange",g),()=>{i.off("openchange",g)}},[i,a]),_.useEffect(()=>()=>{clearTimeout(d.current)},[]);const m=_.useMemo(()=>({onPointerDown(g){Cxe(g.nativeEvent)||(h.current=!1)},onMouseLeave(){l.current=!1},onFocus(g){if(l.current)return;const y=Mg(g.nativeEvent);if(c&&Bn(y))try{if(jne()&&Txe())throw Error();if(!y.matches(":focus-visible"))return}catch{if(!h.current&&!Axe(y))return}r(!0,g.nativeEvent,"focus")},onBlur(g){l.current=!1;const y=g.relatedTarget,v=g.nativeEvent,E=Bn(y)&&y.hasAttribute(X_("focus-guard"))&&y.getAttribute("data-type")==="outside";d.current=window.setTimeout(()=>{var w;const R=zL(o.domReference?o.domReference.ownerDocument:document);!y&&R===o.domReference||$v((w=s.current.floatingContext)==null?void 0:w.refs.floating.current,R)||$v(o.domReference,R)||E||r(!1,v,"focus")})}}),[s,o.domReference,r,c]);return _.useMemo(()=>a?{reference:m}:{},[a,m])}const HV="active",qV="selected";function c6(t,e,n){const r=new Map,i=n==="item";let s=t;if(i&&t){const{[HV]:o,[qV]:a,...c}=t;s=c}return{...n==="floating"&&{tabIndex:-1,[t5e]:""},...s,...e.map(o=>{const a=o?o[n]:null;return typeof a=="function"?t?a(t):null:a}).concat(t).reduce((o,a)=>(a&&Object.entries(a).forEach(c=>{let[l,d]=c;if(!(i&&[HV,qV].includes(l)))if(l.indexOf("on")===0){if(r.has(l)||r.set(l,[]),typeof d=="function"){var h;(h=r.get(l))==null||h.push(d),o[l]=function(){for(var m,g=arguments.length,y=new Array(g),v=0;v<g;v++)y[v]=arguments[v];return(m=r.get(l))==null?void 0:m.map(E=>E(...y)).find(E=>E!==void 0)}}}else o[l]=d}),o),{})}}function c5e(t){t===void 0&&(t=[]);const e=t.map(a=>a?.reference),n=t.map(a=>a?.floating),r=t.map(a=>a?.item),i=_.useCallback(a=>c6(a,t,"reference"),e),s=_.useCallback(a=>c6(a,t,"floating"),n),o=_.useCallback(a=>c6(a,t,"item"),r);return _.useMemo(()=>({getReferenceProps:i,getFloatingProps:s,getItemProps:o}),[i,s,o])}const l5e=new Map([["select","listbox"],["combobox","listbox"],["label",!1]]);function u5e(t,e){var n;e===void 0&&(e={});const{open:r,floatingId:i}=t,{enabled:s=!0,role:o="dialog"}=e,a=(n=l5e.get(o))!=null?n:o,c=Bv(),d=L7()!=null,h=_.useMemo(()=>a==="tooltip"||o==="label"?{["aria-"+(o==="label"?"labelledby":"describedby")]:r?i:void 0}:{"aria-expanded":r?"true":"false","aria-haspopup":a==="alertdialog"?"dialog":a,"aria-controls":r?i:void 0,...a==="listbox"&&{role:"combobox"},...a==="menu"&&{id:c},...a==="menu"&&d&&{role:"menuitem"},...o==="select"&&{"aria-autocomplete":"none"},...o==="combobox"&&{"aria-autocomplete":"list"}},[a,i,d,r,c,o]),m=_.useMemo(()=>{const y={id:i,...a&&{role:a}};return a==="tooltip"||o==="label"?y:{...y,...a==="menu"&&{"aria-labelledby":c}}},[a,i,c,o]),g=_.useCallback(y=>{let{active:v,selected:E}=y;const w={role:"option",...v&&{id:i+"-option"}};switch(o){case"select":return{...w,"aria-selected":v&&E};case"combobox":return{...w,...v&&{"aria-selected":!0}}}return{}},[i,o]);return _.useMemo(()=>s?{reference:h,floating:m,item:g}:{},[s,h,m,g])}const d5e="_tooltip_1nqnq_8",f5e="_invisible_1nqnq_21",h5e="_caption_1nqnq_28",p5e="_arrow_1nqnq_33",WE={tooltip:d5e,invisible:f5e,caption:h5e,arrow:p5e},cre={open:300,close:0},lre=({children:t})=>S.jsx(G6e,{delay:cre,timeoutMs:300,children:t});lre.displayName="TooltipProvider";function m5e({open:t,disabled:e=!1,onOpenChange:n,placement:r="bottom",isTriggerInteractive:i,caption:s,"aria-atomic":o,"aria-live":a,...c}){const l=Bv(),d=Bv(),h=_.useRef(null),[m,g]=_.useState(!1),y=e?!1:t??m,v=(z,Y,W)=>{n?.(z,Y,W),t===void 0&&g(z)},E=o5e({placement:r,open:y,onOpenChange:v,whileElementsMounted:T7,middleware:[k7(6),x7({crossAxis:r.includes("-"),fallbackAxisSideDirection:"start",padding:5}),I7({padding:5}),A7({element:h})]}),w=E.context,{delay:R,initialDelay:x}=z6e(w);if(x!==cre)throw new Error("Tooltips must be wrapped in a global <TooltipProvider>");const C=V6e(w,{move:!1,enabled:t===void 0,delay:i?R:{},mouseOnly:!0}),k=a5e(w,{enabled:t===void 0}),T=_.useRef(void 0);_.useEffect(()=>()=>window.clearTimeout(T.current),[]);const L=_.useMemo(()=>{const z=()=>{T.current===void 0?T.current=window.setTimeout(()=>{v(!1),T.current=void 0},1500):window.clearTimeout(T.current)};return{reference:{onTouchStart:()=>{T.current!==void 0&&window.clearTimeout(T.current),T.current=window.setTimeout(()=>{v(!0),T.current=void 0},500)},onTouchEnd:z,onTouchCancel:z}}},[]),O=i5e(w),P="label"in c?"label":"description",D=u5e(w,{enabled:P==="description",role:"tooltip"}),j=_.useMemo(()=>P==="label"?{reference:{"aria-labelledby":l,"aria-describedby":s?d:void 0}}:{},[P,l,d]),H=c5e([C,k,L,O,D,j]);return _.useMemo(()=>({labelId:l,captionId:s?d:void 0,caption:s,purpose:P,open:y,setOpen:v,tooltipProps:{"aria-atomic":o,"aria-live":a},...H,...E,arrowRef:h}),[l,d,s,D,y,v,H,E,h])}const g5e=t=>"label"in t&&!!t.label;function bi({children:t,isTriggerInteractive:e=!0,nonInteractiveTriggerTabIndex:n=0,...r}){const i=m5e({isTriggerInteractive:e,...r});return S.jsxs(One.Provider,{value:i,children:[S.jsx(b5e,{isTriggerInteractive:e,nonInteractiveTriggerTabIndex:n,children:t}),S.jsxs(y5e,{children:[S.jsx("span",{id:i.labelId,children:g5e(r)?r.label:r.description}),S.jsx(v5e,{})]})]})}function v5e(){const{caption:t,captionId:e}=y7();if(!t)return null;const r=typeof t=="string"?"span":"div";return S.jsx(r,{id:e,className:Le(WE.caption,"cpd-theme-dark"),children:t})}function y5e({children:t}){const{context:e,open:n,arrowRef:r,purpose:i,...s}=y7();return!n&&i!=="label"?null:S.jsx(Z6e,{children:S.jsxs("div",{ref:s.refs.setFloating,style:s.floatingStyles,...s.tooltipProps,...s.getFloatingProps(),className:Le(WE.tooltip,{[WE.invisible]:i==="label"&&!n}),children:[S.jsx($6e,{ref:r,context:e,width:10,height:6,className:WE.arrow}),t]})})}const b5e=({children:t,isTriggerInteractive:e,nonInteractiveTriggerTabIndex:n})=>{const r=y7(),i=t?.ref,s=tre([r.refs.setReference,i]),o=_.useMemo(()=>{if(_.isValidElement(t))if(e){const a=r.getReferenceProps({...typeof t.props=="object"?t.props:{},ref:s});return _.cloneElement(t,a)}else{const a=r.getReferenceProps({ref:s,tabIndex:n}),{"aria-labelledby":c,"aria-describedby":l,...d}=a;return S.jsx("span",{tabIndex:n,...d,children:_.cloneElement(t,{"aria-labelledby":c,"aria-describedby":l})})}},[r,s,t]);if(!o)throw new Error("Tooltip anchor must be a single valid React element");return o},sR=_.forwardRef(function({kind:e="primary",children:n,className:r,indicator:i,size:s="32px",style:o,disabled:a,destructive:c,tooltip:l,noBackground:d=!1,...h},m){const g=Le(t6["icon-button"],r,{[t6.destructive]:c,[t6["no-background"]]:d}),y=S.jsx(Mne,{as:"button",ref:m,className:g,style:{"--cpd-icon-button-size":s,...o},disabled:a,...h,"data-indicator":i,"data-kind":e,children:S.jsx(Sxe,{indicator:i,colour:a?"var(--cpd-color-icon-disabled)":void 0,children:xe.Children.only(n)})});return l?S.jsx(bi,{label:l,children:y}):y}),_5e=({type:t,title:e,children:n,className:r,actions:i,onClose:s,...o})=>{const a=Le(hg.alert,r),c=_.useCallback(l=>{switch(t){case"critical":return S.jsx(z_,{...l});case"info":return S.jsx(hxe,{...l});case"success":return S.jsx(fxe,{...l})}},[t]);return S.jsxs("div",{...o,className:a,"data-type":t,children:[c({width:24,height:24,className:hg.icon,"aria-hidden":!0}),S.jsxs("div",{className:hg.content,children:[S.jsxs("div",{className:hg["text-content"],children:[S.jsx(an,{size:"md",weight:"semibold",children:e}),S.jsx(an,{size:"sm",weight:"regular",children:n})]}),i&&S.jsx("div",{className:hg.actions,children:i})]}),s&&S.jsx(sR,{onClick:s,"aria-label":"Close",role:"button",className:hg.close,children:S.jsx(W_,{})})]})},S5e="@",w5e="#",E5e="+",C5e=new Intl.Segmenter;function T5e(t){if(t.length<1)return"";const e=t[0];[S5e,w5e,E5e].includes(e)&&(t=t.substring(1));const n=C5e.segment(t)[Symbol.iterator]().next();return n.done?"":n.value.segment}const R5e="_avatar_zysgz_8",k5e="_image_zysgz_43",l6={avatar:R5e,image:k5e,"avatar-imageless":"_avatar-imageless_zysgz_55"};function I5e(t){return t.split("").reduce((i,s)=>i+s.charCodeAt(0),0)%6+1}function x5e(t){return!!(t.onClick||t.onKeyDown||t.onKeyUp)}const A5e=_.forwardRef(function({src:e,id:n,name:r="",type:i="round",className:s="",size:o,style:a={},onError:c,...l},d){return xe.createElement(x5e(l)?"button":"span",{ref:d,role:"img","aria-label":n,...l,"data-type":i,"data-color":I5e(n),className:Le(l6.avatar,s,{[l6["avatar-imageless"]]:!e}),style:{...a,"--cpd-avatar-size":o}},S.jsx(xe.Fragment,{children:e?S.jsx("img",{loading:"lazy",alt:"",src:e,referrerPolicy:"no-referrer",className:Le(l6.image),"data-type":i,style:a,width:o,height:o,onError:c}):T5e(r)}))});function bt(t,e,{checkForDefaultPrevented:n=!0}={}){return function(i){if(t?.(i),n===!1||!i.defaultPrevented)return e?.(i)}}function L5e(t,e){const n=_.createContext(e),r=s=>{const{children:o,...a}=s,c=_.useMemo(()=>a,Object.values(a));return S.jsx(n.Provider,{value:c,children:o})};r.displayName=t+"Provider";function i(s){const o=_.useContext(n);if(o)return o;if(e!==void 0)return e;throw new Error(`\`${s}\` must be used within \`${t}\``)}return[r,i]}function sm(t,e=[]){let n=[];function r(s,o){const a=_.createContext(o),c=n.length;n=[...n,o];const l=h=>{const{scope:m,children:g,...y}=h,v=m?.[t]?.[c]||a,E=_.useMemo(()=>y,Object.values(y));return S.jsx(v.Provider,{value:E,children:g})};l.displayName=s+"Provider";function d(h,m){const g=m?.[t]?.[c]||a,y=_.useContext(g);if(y)return y;if(o!==void 0)return o;throw new Error(`\`${h}\` must be used within \`${s}\``)}return[l,d]}const i=()=>{const s=n.map(o=>_.createContext(o));return function(a){const c=a?.[t]||s;return _.useMemo(()=>({[`__scope${t}`]:{...a,[t]:c}}),[a,c])}};return i.scopeName=t,[r,M5e(i,...e)]}function M5e(...t){const e=t[0];if(t.length===1)return e;const n=()=>{const r=t.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(s){const o=r.reduce((a,{useScope:c,scopeName:l})=>{const h=c(s)[`__scope${l}`];return{...a,...h}},{});return _.useMemo(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return n.scopeName=e.scopeName,n}function VV(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function oR(...t){return e=>{let n=!1;const r=t.map(i=>{const s=VV(i,e);return!n&&typeof s=="function"&&(n=!0),s});if(n)return()=>{for(let i=0;i<r.length;i++){const s=r[i];typeof s=="function"?s():VV(t[i],null)}}}}function br(...t){return _.useCallback(oR(...t),t)}function _o(t){const e=O5e(t),n=_.forwardRef((r,i)=>{const{children:s,...o}=r,a=_.Children.toArray(s),c=a.find(D5e);if(c){const l=c.props.children,d=a.map(h=>h===c?_.Children.count(l)>1?_.Children.only(null):_.isValidElement(l)?l.props.children:null:h);return S.jsx(e,{...o,ref:i,children:_.isValidElement(l)?_.cloneElement(l,void 0,d):null})}return S.jsx(e,{...o,ref:i,children:s})});return n.displayName=`${t}.Slot`,n}function O5e(t){const e=_.forwardRef((n,r)=>{const{children:i,...s}=n;if(_.isValidElement(i)){const o=U5e(i),a=N5e(s,i.props);return i.type!==_.Fragment&&(a.ref=r?oR(r,o):o),_.cloneElement(i,a)}return _.Children.count(i)>1?_.Children.only(null):null});return e.displayName=`${t}.SlotClone`,e}var P5e=Symbol("radix.slottable");function D5e(t){return _.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===P5e}function N5e(t,e){const n={...e};for(const r in e){const i=t[r],s=e[r];/^on[A-Z]/.test(r)?i&&s?n[r]=(...a)=>{const c=s(...a);return i(...a),c}:i&&(n[r]=i):r==="style"?n[r]={...i,...s}:r==="className"&&(n[r]=[i,s].filter(Boolean).join(" "))}return{...t,...n}}function U5e(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var j5e=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],F5e=j5e.reduce((t,e)=>{const n=_o(`Primitive.${e}`),r=_.forwardRef((i,s)=>{const{asChild:o,...a}=i,c=o?n:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),S.jsx(c,{...a,ref:s})});return r.displayName=`Primitive.${e}`,{...t,[e]:r}},{});function O7(t){const e=t+"CollectionProvider",[n,r]=sm(e),[i,s]=n(e,{collectionRef:{current:null},itemMap:new Map}),o=v=>{const{scope:E,children:w}=v,R=xe.useRef(null),x=xe.useRef(new Map).current;return S.jsx(i,{scope:E,itemMap:x,collectionRef:R,children:w})};o.displayName=e;const a=t+"CollectionSlot",c=_o(a),l=xe.forwardRef((v,E)=>{const{scope:w,children:R}=v,x=s(a,w),C=br(E,x.collectionRef);return S.jsx(c,{ref:C,children:R})});l.displayName=a;const d=t+"CollectionItemSlot",h="data-radix-collection-item",m=_o(d),g=xe.forwardRef((v,E)=>{const{scope:w,children:R,...x}=v,C=xe.useRef(null),k=br(E,C),T=s(d,w);return xe.useEffect(()=>(T.itemMap.set(C,{ref:C,...x}),()=>{T.itemMap.delete(C)})),S.jsx(m,{[h]:"",ref:k,children:R})});g.displayName=d;function y(v){const E=s(t+"CollectionConsumer",v);return xe.useCallback(()=>{const R=E.collectionRef.current;if(!R)return[];const x=Array.from(R.querySelectorAll(`[${h}]`));return Array.from(E.itemMap.values()).sort((T,L)=>x.indexOf(T.ref.current)-x.indexOf(L.ref.current))},[E.collectionRef,E.itemMap])}return[{Provider:o,Slot:l,ItemSlot:g},y,r]}var $5e=_.createContext(void 0);function P7(t){const e=_.useContext($5e);return t||e||"ltr"}var B5e=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],ure=B5e.reduce((t,e)=>{const n=_o(`Primitive.${e}`),r=_.forwardRef((i,s)=>{const{asChild:o,...a}=i,c=o?n:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),S.jsx(c,{...a,ref:s})});return r.displayName=`Primitive.${e}`,{...t,[e]:r}},{});function H5e(t,e){t&&em.flushSync(()=>t.dispatchEvent(e))}function Al(t){const e=_.useRef(t);return _.useEffect(()=>{e.current=t}),_.useMemo(()=>(...n)=>e.current?.(...n),[])}function q5e(t,e=globalThis?.document){const n=Al(t);_.useEffect(()=>{const r=i=>{i.key==="Escape"&&n(i)};return e.addEventListener("keydown",r,{capture:!0}),()=>e.removeEventListener("keydown",r,{capture:!0})},[n,e])}var V5e="DismissableLayer",ZL="dismissableLayer.update",K5e="dismissableLayer.pointerDownOutside",G5e="dismissableLayer.focusOutside",KV,dre=_.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),aR=_.forwardRef((t,e)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:r,onPointerDownOutside:i,onFocusOutside:s,onInteractOutside:o,onDismiss:a,...c}=t,l=_.useContext(dre),[d,h]=_.useState(null),m=d?.ownerDocument??globalThis?.document,[,g]=_.useState({}),y=br(e,L=>h(L)),v=Array.from(l.layers),[E]=[...l.layersWithOutsidePointerEventsDisabled].slice(-1),w=v.indexOf(E),R=d?v.indexOf(d):-1,x=l.layersWithOutsidePointerEventsDisabled.size>0,C=R>=w,k=Y5e(L=>{const O=L.target,P=[...l.branches].some(D=>D.contains(O));!C||P||(i?.(L),o?.(L),L.defaultPrevented||a?.())},m),T=X5e(L=>{const O=L.target;[...l.branches].some(D=>D.contains(O))||(s?.(L),o?.(L),L.defaultPrevented||a?.())},m);return q5e(L=>{R===l.layers.size-1&&(r?.(L),!L.defaultPrevented&&a&&(L.preventDefault(),a()))},m),_.useEffect(()=>{if(d)return n&&(l.layersWithOutsidePointerEventsDisabled.size===0&&(KV=m.body.style.pointerEvents,m.body.style.pointerEvents="none"),l.layersWithOutsidePointerEventsDisabled.add(d)),l.layers.add(d),GV(),()=>{n&&l.layersWithOutsidePointerEventsDisabled.size===1&&(m.body.style.pointerEvents=KV)}},[d,m,n,l]),_.useEffect(()=>()=>{d&&(l.layers.delete(d),l.layersWithOutsidePointerEventsDisabled.delete(d),GV())},[d,l]),_.useEffect(()=>{const L=()=>g({});return document.addEventListener(ZL,L),()=>document.removeEventListener(ZL,L)},[]),S.jsx(ure.div,{...c,ref:y,style:{pointerEvents:x?C?"auto":"none":void 0,...t.style},onFocusCapture:bt(t.onFocusCapture,T.onFocusCapture),onBlurCapture:bt(t.onBlurCapture,T.onBlurCapture),onPointerDownCapture:bt(t.onPointerDownCapture,k.onPointerDownCapture)})});aR.displayName=V5e;var z5e="DismissableLayerBranch",W5e=_.forwardRef((t,e)=>{const n=_.useContext(dre),r=_.useRef(null),i=br(e,r);return _.useEffect(()=>{const s=r.current;if(s)return n.branches.add(s),()=>{n.branches.delete(s)}},[n.branches]),S.jsx(ure.div,{...t,ref:i})});W5e.displayName=z5e;function Y5e(t,e=globalThis?.document){const n=Al(t),r=_.useRef(!1),i=_.useRef(()=>{});return _.useEffect(()=>{const s=a=>{if(a.target&&!r.current){let c=function(){fre(K5e,n,l,{discrete:!0})};const l={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",i.current),i.current=c,e.addEventListener("click",i.current,{once:!0})):c()}else e.removeEventListener("click",i.current);r.current=!1},o=window.setTimeout(()=>{e.addEventListener("pointerdown",s)},0);return()=>{window.clearTimeout(o),e.removeEventListener("pointerdown",s),e.removeEventListener("click",i.current)}},[e,n]),{onPointerDownCapture:()=>r.current=!0}}function X5e(t,e=globalThis?.document){const n=Al(t),r=_.useRef(!1);return _.useEffect(()=>{const i=s=>{s.target&&!r.current&&fre(G5e,n,{originalEvent:s},{discrete:!1})};return e.addEventListener("focusin",i),()=>e.removeEventListener("focusin",i)},[e,n]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function GV(){const t=new CustomEvent(ZL);document.dispatchEvent(t)}function fre(t,e,n,{discrete:r}){const i=n.originalEvent.target,s=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:n});e&&i.addEventListener(t,e,{once:!0}),r?H5e(i,s):i.dispatchEvent(s)}var u6=0;function D7(){_.useEffect(()=>{const t=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",t[0]??zV()),document.body.insertAdjacentElement("beforeend",t[1]??zV()),u6++,()=>{u6===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),u6--}},[])}function zV(){const t=document.createElement("span");return t.setAttribute("data-radix-focus-guard",""),t.tabIndex=0,t.style.outline="none",t.style.opacity="0",t.style.position="fixed",t.style.pointerEvents="none",t}var J5e=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Q5e=J5e.reduce((t,e)=>{const n=_o(`Primitive.${e}`),r=_.forwardRef((i,s)=>{const{asChild:o,...a}=i,c=o?n:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),S.jsx(c,{...a,ref:s})});return r.displayName=`Primitive.${e}`,{...t,[e]:r}},{}),d6="focusScope.autoFocusOnMount",f6="focusScope.autoFocusOnUnmount",WV={bubbles:!1,cancelable:!0},Z5e="FocusScope",N7=_.forwardRef((t,e)=>{const{loop:n=!1,trapped:r=!1,onMountAutoFocus:i,onUnmountAutoFocus:s,...o}=t,[a,c]=_.useState(null),l=Al(i),d=Al(s),h=_.useRef(null),m=br(e,v=>c(v)),g=_.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;_.useEffect(()=>{if(r){let v=function(x){if(g.paused||!a)return;const C=x.target;a.contains(C)?h.current=C:of(h.current,{select:!0})},E=function(x){if(g.paused||!a)return;const C=x.relatedTarget;C!==null&&(a.contains(C)||of(h.current,{select:!0}))},w=function(x){if(document.activeElement===document.body)for(const k of x)k.removedNodes.length>0&&of(a)};document.addEventListener("focusin",v),document.addEventListener("focusout",E);const R=new MutationObserver(w);return a&&R.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",v),document.removeEventListener("focusout",E),R.disconnect()}}},[r,a,g.paused]),_.useEffect(()=>{if(a){XV.add(g);const v=document.activeElement;if(!a.contains(v)){const w=new CustomEvent(d6,WV);a.addEventListener(d6,l),a.dispatchEvent(w),w.defaultPrevented||(eAe(sAe(hre(a)),{select:!0}),document.activeElement===v&&of(a))}return()=>{a.removeEventListener(d6,l),setTimeout(()=>{const w=new CustomEvent(f6,WV);a.addEventListener(f6,d),a.dispatchEvent(w),w.defaultPrevented||of(v??document.body,{select:!0}),a.removeEventListener(f6,d),XV.remove(g)},0)}}},[a,l,d,g]);const y=_.useCallback(v=>{if(!n&&!r||g.paused)return;const E=v.key==="Tab"&&!v.altKey&&!v.ctrlKey&&!v.metaKey,w=document.activeElement;if(E&&w){const R=v.currentTarget,[x,C]=tAe(R);x&&C?!v.shiftKey&&w===C?(v.preventDefault(),n&&of(x,{select:!0})):v.shiftKey&&w===x&&(v.preventDefault(),n&&of(C,{select:!0})):w===R&&v.preventDefault()}},[n,r,g.paused]);return S.jsx(Q5e.div,{tabIndex:-1,...o,ref:m,onKeyDown:y})});N7.displayName=Z5e;function eAe(t,{select:e=!1}={}){const n=document.activeElement;for(const r of t)if(of(r,{select:e}),document.activeElement!==n)return}function tAe(t){const e=hre(t),n=YV(e,t),r=YV(e.reverse(),t);return[n,r]}function hre(t){const e=[],n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const i=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||i?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)e.push(n.currentNode);return e}function YV(t,e){for(const n of t)if(!nAe(n,{upTo:e}))return n}function nAe(t,{upTo:e}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(e!==void 0&&t===e)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function rAe(t){return t instanceof HTMLInputElement&&"select"in t}function of(t,{select:e=!1}={}){if(t&&t.focus){const n=document.activeElement;t.focus({preventScroll:!0}),t!==n&&rAe(t)&&e&&t.select()}}var XV=iAe();function iAe(){let t=[];return{add(e){const n=t[0];e!==n&&n?.pause(),t=JV(t,e),t.unshift(e)},remove(e){t=JV(t,e),t[0]?.resume()}}}function JV(t,e){const n=[...t],r=n.indexOf(e);return r!==-1&&n.splice(r,1),n}function sAe(t){return t.filter(e=>e.tagName!=="A")}var ud=globalThis?.document?_.useLayoutEffect:()=>{},oAe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],aAe=oAe.reduce((t,e)=>{const n=_o(`Primitive.${e}`),r=_.forwardRef((i,s)=>{const{asChild:o,...a}=i,c=o?n:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),S.jsx(c,{...a,ref:s})});return r.displayName=`Primitive.${e}`,{...t,[e]:r}},{}),cAe="Arrow",pre=_.forwardRef((t,e)=>{const{children:n,width:r=10,height:i=5,...s}=t;return S.jsx(aAe.svg,{...s,ref:e,width:r,height:i,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:t.asChild?n:S.jsx("polygon",{points:"0,0 30,0 15,10"})})});pre.displayName=cAe;var lAe=pre,uAe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],mre=uAe.reduce((t,e)=>{const n=_o(`Primitive.${e}`),r=_.forwardRef((i,s)=>{const{asChild:o,...a}=i,c=o?n:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),S.jsx(c,{...a,ref:s})});return r.displayName=`Primitive.${e}`,{...t,[e]:r}},{});function gre(t){const[e,n]=_.useState(void 0);return ud(()=>{if(t){n({width:t.offsetWidth,height:t.offsetHeight});const r=new ResizeObserver(i=>{if(!Array.isArray(i)||!i.length)return;const s=i[0];let o,a;if("borderBoxSize"in s){const c=s.borderBoxSize,l=Array.isArray(c)?c[0]:c;o=l.inlineSize,a=l.blockSize}else o=t.offsetWidth,a=t.offsetHeight;n({width:o,height:a})});return r.observe(t,{box:"border-box"}),()=>r.unobserve(t)}else n(void 0)},[t]),e}var U7="Popper",[vre,yre]=sm(U7),[dAe,bre]=vre(U7),_re=t=>{const{__scopePopper:e,children:n}=t,[r,i]=_.useState(null);return S.jsx(dAe,{scope:e,anchor:r,onAnchorChange:i,children:n})};_re.displayName=U7;var Sre="PopperAnchor",wre=_.forwardRef((t,e)=>{const{__scopePopper:n,virtualRef:r,...i}=t,s=bre(Sre,n),o=_.useRef(null),a=br(e,o),c=_.useRef(null);return _.useEffect(()=>{const l=c.current;c.current=r?.current||o.current,l!==c.current&&s.onAnchorChange(c.current)}),r?null:S.jsx(mre.div,{...i,ref:a})});wre.displayName=Sre;var j7="PopperContent",[fAe,hAe]=vre(j7),Ere=_.forwardRef((t,e)=>{const{__scopePopper:n,side:r="bottom",sideOffset:i=0,align:s="center",alignOffset:o=0,arrowPadding:a=0,avoidCollisions:c=!0,collisionBoundary:l=[],collisionPadding:d=0,sticky:h="partial",hideWhenDetached:m=!1,updatePositionStrategy:g="optimized",onPlaced:y,...v}=t,E=bre(j7,n),[w,R]=_.useState(null),x=br(e,de=>R(de)),[C,k]=_.useState(null),T=gre(C),L=T?.width??0,O=T?.height??0,P=r+(s!=="center"?"-"+s:""),D=typeof d=="number"?d:{top:0,right:0,bottom:0,left:0,...d},j=Array.isArray(l)?l:[l],H=j.length>0,z={padding:D,boundary:j.filter(mAe),altBoundary:H},{refs:Y,floatingStyles:W,placement:F,isPositioned:$,middlewareData:V}=R7({strategy:"fixed",placement:P,whileElementsMounted:(...de)=>T7(...de,{animationFrame:g==="always"}),elements:{reference:E.anchor},middleware:[k7({mainAxis:i+O,alignmentAxis:o}),c&&I7({mainAxis:!0,crossAxis:!1,limiter:h==="partial"?Qne():void 0,...z}),c&&x7({...z}),Zne({...z,apply:({elements:de,rects:ke,availableWidth:De,availableHeight:Je})=>{const{width:vt,height:Sr}=ke.reference,zn=de.floating.style;zn.setProperty("--radix-popper-available-width",`${De}px`),zn.setProperty("--radix-popper-available-height",`${Je}px`),zn.setProperty("--radix-popper-anchor-width",`${vt}px`),zn.setProperty("--radix-popper-anchor-height",`${Sr}px`)}}),C&&A7({element:C,padding:a}),gAe({arrowWidth:L,arrowHeight:O}),m&&ere({strategy:"referenceHidden",...z})]}),[G,Z]=Rre(F),q=Al(y);ud(()=>{$&&q?.()},[$,q]);const J=V.arrow?.x,ue=V.arrow?.y,ge=V.arrow?.centerOffset!==0,[Re,we]=_.useState();return ud(()=>{w&&we(window.getComputedStyle(w).zIndex)},[w]),S.jsx("div",{ref:Y.setFloating,"data-radix-popper-content-wrapper":"",style:{...W,transform:$?W.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Re,"--radix-popper-transform-origin":[V.transformOrigin?.x,V.transformOrigin?.y].join(" "),...V.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:t.dir,children:S.jsx(fAe,{scope:n,placedSide:G,onArrowChange:k,arrowX:J,arrowY:ue,shouldHideArrow:ge,children:S.jsx(mre.div,{"data-side":G,"data-align":Z,...v,ref:x,style:{...v.style,animation:$?void 0:"none"}})})})});Ere.displayName=j7;var Cre="PopperArrow",pAe={top:"bottom",right:"left",bottom:"top",left:"right"},Tre=_.forwardRef(function(e,n){const{__scopePopper:r,...i}=e,s=hAe(Cre,r),o=pAe[s.placedSide];return S.jsx("span",{ref:s.onArrowChange,style:{position:"absolute",left:s.arrowX,top:s.arrowY,[o]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[s.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[s.placedSide],visibility:s.shouldHideArrow?"hidden":void 0},children:S.jsx(lAe,{...i,ref:n,style:{...i.style,display:"block"}})})});Tre.displayName=Cre;function mAe(t){return t!==null}var gAe=t=>({name:"transformOrigin",options:t,fn(e){const{placement:n,rects:r,middlewareData:i}=e,o=i.arrow?.centerOffset!==0,a=o?0:t.arrowWidth,c=o?0:t.arrowHeight,[l,d]=Rre(n),h={start:"0%",center:"50%",end:"100%"}[d],m=(i.arrow?.x??0)+a/2,g=(i.arrow?.y??0)+c/2;let y="",v="";return l==="bottom"?(y=o?h:`${m}px`,v=`${-c}px`):l==="top"?(y=o?h:`${m}px`,v=`${r.floating.height+c}px`):l==="right"?(y=`${-c}px`,v=o?h:`${g}px`):l==="left"&&(y=`${r.floating.width+c}px`,v=o?h:`${g}px`),{data:{x:y,y:v}}}});function Rre(t){const[e,n="center"]=t.split("-");return[e,n]}var vAe=_re,yAe=wre,bAe=Ere,_Ae=Tre,SAe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],wAe=SAe.reduce((t,e)=>{const n=_o(`Primitive.${e}`),r=_.forwardRef((i,s)=>{const{asChild:o,...a}=i,c=o?n:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),S.jsx(c,{...a,ref:s})});return r.displayName=`Primitive.${e}`,{...t,[e]:r}},{}),EAe="Portal",F7=_.forwardRef((t,e)=>{const{container:n,...r}=t,[i,s]=_.useState(!1);ud(()=>s(!0),[]);const o=n||i&&globalThis?.document?.body;return o?nte.createPortal(S.jsx(wAe.div,{...r,ref:e}),o):null});F7.displayName=EAe;function CAe(t,e){return _.useReducer((n,r)=>e[n][r]??n,t)}var fh=t=>{const{present:e,children:n}=t,r=TAe(e),i=typeof n=="function"?n({present:r.isPresent}):_.Children.only(n),s=br(r.ref,RAe(i));return typeof n=="function"||r.isPresent?_.cloneElement(i,{ref:s}):null};fh.displayName="Presence";function TAe(t){const[e,n]=_.useState(),r=_.useRef(null),i=_.useRef(t),s=_.useRef("none"),o=t?"mounted":"unmounted",[a,c]=CAe(o,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return _.useEffect(()=>{const l=bw(r.current);s.current=a==="mounted"?l:"none"},[a]),ud(()=>{const l=r.current,d=i.current;if(d!==t){const m=s.current,g=bw(l);t?c("MOUNT"):g==="none"||l?.display==="none"?c("UNMOUNT"):c(d&&m!==g?"ANIMATION_OUT":"UNMOUNT"),i.current=t}},[t,c]),ud(()=>{if(e){let l;const d=e.ownerDocument.defaultView??window,h=g=>{const v=bw(r.current).includes(CSS.escape(g.animationName));if(g.target===e&&v&&(c("ANIMATION_END"),!i.current)){const E=e.style.animationFillMode;e.style.animationFillMode="forwards",l=d.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=E)})}},m=g=>{g.target===e&&(s.current=bw(r.current))};return e.addEventListener("animationstart",m),e.addEventListener("animationcancel",h),e.addEventListener("animationend",h),()=>{d.clearTimeout(l),e.removeEventListener("animationstart",m),e.removeEventListener("animationcancel",h),e.removeEventListener("animationend",h)}}else c("ANIMATION_END")},[e,c]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:_.useCallback(l=>{r.current=l?getComputedStyle(l):null,n(l)},[])}}function bw(t){return t?.animationName||"none"}function RAe(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var kAe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],J_=kAe.reduce((t,e)=>{const n=_o(`Primitive.${e}`),r=_.forwardRef((i,s)=>{const{asChild:o,...a}=i,c=o?n:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),S.jsx(c,{...a,ref:s})});return r.displayName=`Primitive.${e}`,{...t,[e]:r}},{});function IAe(t,e){t&&em.flushSync(()=>t.dispatchEvent(e))}var xAe=my[" useId ".trim().toString()]||(()=>{}),AAe=0;function LAe(t){const[e,n]=_.useState(xAe());return ud(()=>{n(r=>r??String(AAe++))},[t]),e?`radix-${e}`:""}var MAe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],kre=MAe.reduce((t,e)=>{const n=_o(`Primitive.${e}`),r=_.forwardRef((i,s)=>{const{asChild:o,...a}=i,c=o?n:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),S.jsx(c,{...a,ref:s})});return r.displayName=`Primitive.${e}`,{...t,[e]:r}},{}),OAe=my[" useInsertionEffect ".trim().toString()]||ud;function $7({prop:t,defaultProp:e,onChange:n=()=>{},caller:r}){const[i,s,o]=PAe({defaultProp:e,onChange:n}),a=t!==void 0,c=a?t:i;{const d=_.useRef(t!==void 0);_.useEffect(()=>{const h=d.current;h!==a&&console.warn(`${r} is changing from ${h?"controlled":"uncontrolled"} to ${a?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),d.current=a},[a,r])}const l=_.useCallback(d=>{if(a){const h=DAe(d)?d(t):d;h!==t&&o.current?.(h)}else s(d)},[a,t,s,o]);return[c,l]}function PAe({defaultProp:t,onChange:e}){const[n,r]=_.useState(t),i=_.useRef(n),s=_.useRef(e);return OAe(()=>{s.current=e},[e]),_.useEffect(()=>{i.current!==n&&(s.current?.(n),i.current=n)},[n,i]),[n,r,s]}function DAe(t){return typeof t=="function"}var h6="rovingFocusGroup.onEntryFocus",NAe={bubbles:!1,cancelable:!0},Q_="RovingFocusGroup",[eM,Ire,UAe]=O7(Q_),[jAe,xre]=sm(Q_,[UAe]),[FAe,$Ae]=jAe(Q_),Are=_.forwardRef((t,e)=>S.jsx(eM.Provider,{scope:t.__scopeRovingFocusGroup,children:S.jsx(eM.Slot,{scope:t.__scopeRovingFocusGroup,children:S.jsx(BAe,{...t,ref:e})})}));Are.displayName=Q_;var BAe=_.forwardRef((t,e)=>{const{__scopeRovingFocusGroup:n,orientation:r,loop:i=!1,dir:s,currentTabStopId:o,defaultCurrentTabStopId:a,onCurrentTabStopIdChange:c,onEntryFocus:l,preventScrollOnEntryFocus:d=!1,...h}=t,m=_.useRef(null),g=br(e,m),y=P7(s),[v,E]=$7({prop:o,defaultProp:a??null,onChange:c,caller:Q_}),[w,R]=_.useState(!1),x=Al(l),C=Ire(n),k=_.useRef(!1),[T,L]=_.useState(0);return _.useEffect(()=>{const O=m.current;if(O)return O.addEventListener(h6,x),()=>O.removeEventListener(h6,x)},[x]),S.jsx(FAe,{scope:n,orientation:r,dir:y,loop:i,currentTabStopId:v,onItemFocus:_.useCallback(O=>E(O),[E]),onItemShiftTab:_.useCallback(()=>R(!0),[]),onFocusableItemAdd:_.useCallback(()=>L(O=>O+1),[]),onFocusableItemRemove:_.useCallback(()=>L(O=>O-1),[]),children:S.jsx(kre.div,{tabIndex:w||T===0?-1:0,"data-orientation":r,...h,ref:g,style:{outline:"none",...t.style},onMouseDown:bt(t.onMouseDown,()=>{k.current=!0}),onFocus:bt(t.onFocus,O=>{const P=!k.current;if(O.target===O.currentTarget&&P&&!w){const D=new CustomEvent(h6,NAe);if(O.currentTarget.dispatchEvent(D),!D.defaultPrevented){const j=C().filter(F=>F.focusable),H=j.find(F=>F.active),z=j.find(F=>F.id===v),W=[H,z,...j].filter(Boolean).map(F=>F.ref.current);Ore(W,d)}}k.current=!1}),onBlur:bt(t.onBlur,()=>R(!1))})})}),Lre="RovingFocusGroupItem",Mre=_.forwardRef((t,e)=>{const{__scopeRovingFocusGroup:n,focusable:r=!0,active:i=!1,tabStopId:s,children:o,...a}=t,c=LAe(),l=s||c,d=$Ae(Lre,n),h=d.currentTabStopId===l,m=Ire(n),{onFocusableItemAdd:g,onFocusableItemRemove:y,currentTabStopId:v}=d;return _.useEffect(()=>{if(r)return g(),()=>y()},[r,g,y]),S.jsx(eM.ItemSlot,{scope:n,id:l,focusable:r,active:i,children:S.jsx(kre.span,{tabIndex:h?0:-1,"data-orientation":d.orientation,...a,ref:e,onMouseDown:bt(t.onMouseDown,E=>{r?d.onItemFocus(l):E.preventDefault()}),onFocus:bt(t.onFocus,()=>d.onItemFocus(l)),onKeyDown:bt(t.onKeyDown,E=>{if(E.key==="Tab"&&E.shiftKey){d.onItemShiftTab();return}if(E.target!==E.currentTarget)return;const w=VAe(E,d.orientation,d.dir);if(w!==void 0){if(E.metaKey||E.ctrlKey||E.altKey||E.shiftKey)return;E.preventDefault();let x=m().filter(C=>C.focusable).map(C=>C.ref.current);if(w==="last")x.reverse();else if(w==="prev"||w==="next"){w==="prev"&&x.reverse();const C=x.indexOf(E.currentTarget);x=d.loop?KAe(x,C+1):x.slice(C+1)}setTimeout(()=>Ore(x))}}),children:typeof o=="function"?o({isCurrentTabStop:h,hasTabStop:v!=null}):o})})});Mre.displayName=Lre;var HAe={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function qAe(t,e){return e!=="rtl"?t:t==="ArrowLeft"?"ArrowRight":t==="ArrowRight"?"ArrowLeft":t}function VAe(t,e,n){const r=qAe(t.key,n);if(!(e==="vertical"&&["ArrowLeft","ArrowRight"].includes(r))&&!(e==="horizontal"&&["ArrowUp","ArrowDown"].includes(r)))return HAe[r]}function Ore(t,e=!1){const n=document.activeElement;for(const r of t)if(r===n||(r.focus({preventScroll:e}),document.activeElement!==n))return}function KAe(t,e){return t.map((n,r)=>t[(e+r)%t.length])}var GAe=Are,zAe=Mre,WAe=function(t){if(typeof document>"u")return null;var e=Array.isArray(t)?t[0]:t;return e.ownerDocument.body},pg=new WeakMap,_w=new WeakMap,Sw={},p6=0,Pre=function(t){return t&&(t.host||Pre(t.parentNode))},YAe=function(t,e){return e.map(function(n){if(t.contains(n))return n;var r=Pre(n);return r&&t.contains(r)?r:(console.error("aria-hidden",n,"in not contained inside",t,". Doing nothing"),null)}).filter(function(n){return!!n})},XAe=function(t,e,n,r){var i=YAe(e,Array.isArray(t)?t:[t]);Sw[n]||(Sw[n]=new WeakMap);var s=Sw[n],o=[],a=new Set,c=new Set(i),l=function(h){!h||a.has(h)||(a.add(h),l(h.parentNode))};i.forEach(l);var d=function(h){!h||c.has(h)||Array.prototype.forEach.call(h.children,function(m){if(a.has(m))d(m);else try{var g=m.getAttribute(r),y=g!==null&&g!=="false",v=(pg.get(m)||0)+1,E=(s.get(m)||0)+1;pg.set(m,v),s.set(m,E),o.push(m),v===1&&y&&_w.set(m,!0),E===1&&m.setAttribute(n,"true"),y||m.setAttribute(r,"true")}catch(w){console.error("aria-hidden: cannot operate on ",m,w)}})};return d(e),a.clear(),p6++,function(){o.forEach(function(h){var m=pg.get(h)-1,g=s.get(h)-1;pg.set(h,m),s.set(h,g),m||(_w.has(h)||h.removeAttribute(r),_w.delete(h)),g||h.removeAttribute(n)}),p6--,p6||(pg=new WeakMap,pg=new WeakMap,_w=new WeakMap,Sw={})}},B7=function(t,e,n){n===void 0&&(n="data-aria-hidden");var r=Array.from(Array.isArray(t)?t:[t]),i=WAe(t);return i?(r.push.apply(r,Array.from(i.querySelectorAll("[aria-live]"))),XAe(r,i,n,"aria-hidden")):function(){return null}},tM=function(t,e){return tM=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},tM(t,e)};function $c(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");tM(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}var Ui=function(){return Ui=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Ui.apply(this,arguments)};function Z_(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}function Dre(t,e,n,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,n):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,n,s):o(e,n))||s);return i>3&&s&&Object.defineProperty(e,n,s),s}function Nre(t,e){return function(n,r){e(n,r,t)}}function Ure(t,e,n,r,i,s){function o(w){if(w!==void 0&&typeof w!="function")throw new TypeError("Function expected");return w}for(var a=r.kind,c=a==="getter"?"get":a==="setter"?"set":"value",l=!e&&t?r.static?t:t.prototype:null,d=e||(l?Object.getOwnPropertyDescriptor(l,r.name):{}),h,m=!1,g=n.length-1;g>=0;g--){var y={};for(var v in r)y[v]=v==="access"?{}:r[v];for(var v in r.access)y.access[v]=r.access[v];y.addInitializer=function(w){if(m)throw new TypeError("Cannot add initializers after decoration has completed");s.push(o(w||null))};var E=(0,n[g])(a==="accessor"?{get:d.get,set:d.set}:d[c],y);if(a==="accessor"){if(E===void 0)continue;if(E===null||typeof E!="object")throw new TypeError("Object expected");(h=o(E.get))&&(d.get=h),(h=o(E.set))&&(d.set=h),(h=o(E.init))&&i.unshift(h)}else(h=o(E))&&(a==="field"?i.unshift(h):d[c]=h)}l&&Object.defineProperty(l,r.name,d),m=!0}function jre(t,e,n){for(var r=arguments.length>2,i=0;i<e.length;i++)n=r?e[i].call(t,n):e[i].call(t);return r?n:void 0}function Fre(t){return typeof t=="symbol"?t:"".concat(t)}function $re(t,e,n){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(t,"name",{configurable:!0,value:n?"".concat(n," ",e):e})}function Bre(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function H7(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(d){try{l(r.next(d))}catch(h){o(h)}}function c(d){try{l(r.throw(d))}catch(h){o(h)}}function l(d){d.done?s(d.value):i(d.value).then(a,c)}l((r=r.apply(t,e||[])).next())})}function cR(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(d){return c([l,d])}}function c(l){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(n=0)),n;)try{if(r=1,i&&(s=l[0]&2?i.return:l[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,l[1])).done)return s;switch(i=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return n.label++,{value:l[1],done:!1};case 5:n.label++,i=l[1],l=[0];continue;case 7:l=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){n.label=l[1];break}if(l[0]===6&&n.label<s[1]){n.label=s[1],s=l;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(l);break}s[2]&&n.ops.pop(),n.trys.pop();continue}l=e.call(t,n)}catch(d){l=[6,d],i=0}finally{r=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}var lR=Object.create?(function(t,e,n,r){r===void 0&&(r=n);var i=Object.getOwnPropertyDescriptor(e,n);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,i)}):(function(t,e,n,r){r===void 0&&(r=n),t[r]=e[n]});function Hre(t,e){for(var n in t)n!=="default"&&!Object.prototype.hasOwnProperty.call(e,n)&&lR(e,t,n)}function Qf(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function ra(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s}function qre(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(ra(arguments[e]));return t}function Vre(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,i++)r[i]=s[o];return r}function ia(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))}function zu(t){return this instanceof zu?(this.v=t,this):new zu(t)}function q7(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),i,s=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),i[Symbol.asyncIterator]=function(){return this},i;function o(g){return function(y){return Promise.resolve(y).then(g,h)}}function a(g,y){r[g]&&(i[g]=function(v){return new Promise(function(E,w){s.push([g,v,E,w])>1||c(g,v)})},y&&(i[g]=y(i[g])))}function c(g,y){try{l(r[g](y))}catch(v){m(s[0][3],v)}}function l(g){g.value instanceof zu?Promise.resolve(g.value.v).then(d,h):m(s[0][2],g)}function d(g){c("next",g)}function h(g){c("throw",g)}function m(g,y){g(y),s.shift(),s.length&&c(s[0][0],s[0][1])}}function Kre(t){var e,n;return e={},r("next"),r("throw",function(i){throw i}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(i,s){e[i]=t[i]?function(o){return(n=!n)?{value:zu(t[i](o)),done:!1}:s?s(o):o}:s}}function V7(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof Qf=="function"?Qf(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(s){n[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(l){s({value:l,done:a})},o)}}function Gre(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}var JAe=Object.create?(function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}):function(t,e){t.default=e},nM=function(t){return nM=Object.getOwnPropertyNames||function(e){var n=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[n.length]=r);return n},nM(t)};function zre(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n=nM(t),r=0;r<n.length;r++)n[r]!=="default"&&lR(e,t,n[r]);return JAe(e,t),e}function Wre(t){return t&&t.__esModule?t:{default:t}}function Yre(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)}function Xre(t,e,n,r,i){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?i.call(t,n):i?i.value=n:e.set(t,n),n}function Jre(t,e){if(e===null||typeof e!="object"&&typeof e!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof t=="function"?e===t:t.has(e)}function Qre(t,e,n){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,i;if(n){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],n&&(i=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");i&&(r=function(){try{i.call(this)}catch(s){return Promise.reject(s)}}),t.stack.push({value:e,dispose:r,async:n})}else n&&t.stack.push({async:!0});return e}var QAe=typeof SuppressedError=="function"?SuppressedError:function(t,e,n){var r=new Error(n);return r.name="SuppressedError",r.error=t,r.suppressed=e,r};function Zre(t){function e(s){t.error=t.hasError?new QAe(s,t.error,"An error was suppressed during disposal."):s,t.hasError=!0}var n,r=0;function i(){for(;n=t.stack.pop();)try{if(!n.async&&r===1)return r=0,t.stack.push(n),Promise.resolve().then(i);if(n.dispose){var s=n.dispose.call(n.value);if(n.async)return r|=2,Promise.resolve(s).then(i,function(o){return e(o),i()})}else r|=1}catch(o){e(o)}if(r===1)return t.hasError?Promise.reject(t.error):Promise.resolve();if(t.hasError)throw t.error}return i()}function eie(t,e){return typeof t=="string"&&/^\.\.?\//.test(t)?t.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(n,r,i,s,o){return r?e?".jsx":".js":i&&(!s||!o)?n:i+s+"."+o.toLowerCase()+"js"}):t}const ZAe={__extends:$c,__assign:Ui,__rest:Z_,__decorate:Dre,__param:Nre,__esDecorate:Ure,__runInitializers:jre,__propKey:Fre,__setFunctionName:$re,__metadata:Bre,__awaiter:H7,__generator:cR,__createBinding:lR,__exportStar:Hre,__values:Qf,__read:ra,__spread:qre,__spreadArrays:Vre,__spreadArray:ia,__await:zu,__asyncGenerator:q7,__asyncDelegator:Kre,__asyncValues:V7,__makeTemplateObject:Gre,__importStar:zre,__importDefault:Wre,__classPrivateFieldGet:Yre,__classPrivateFieldSet:Xre,__classPrivateFieldIn:Jre,__addDisposableResource:Qre,__disposeResources:Zre,__rewriteRelativeImportExtension:eie},Vot=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:Qre,get __assign(){return Ui},__asyncDelegator:Kre,__asyncGenerator:q7,__asyncValues:V7,__await:zu,__awaiter:H7,__classPrivateFieldGet:Yre,__classPrivateFieldIn:Jre,__classPrivateFieldSet:Xre,__createBinding:lR,__decorate:Dre,__disposeResources:Zre,__esDecorate:Ure,__exportStar:Hre,__extends:$c,__generator:cR,__importDefault:Wre,__importStar:zre,__makeTemplateObject:Gre,__metadata:Bre,__param:Nre,__propKey:Fre,__read:ra,__rest:Z_,__rewriteRelativeImportExtension:eie,__runInitializers:jre,__setFunctionName:$re,__spread:qre,__spreadArray:ia,__spreadArrays:Vre,__values:Qf,default:ZAe},Symbol.toStringTag,{value:"Module"}));var tb="right-scroll-bar-position",nb="width-before-scroll-bar",eLe="with-scroll-bars-hidden",tLe="--removed-body-scroll-bar-size";function m6(t,e){return typeof t=="function"?t(e):t&&(t.current=e),t}function nLe(t,e){var n=_.useState(function(){return{value:t,callback:e,facade:{get current(){return n.value},set current(r){var i=n.value;i!==r&&(n.value=r,n.callback(r,i))}}}})[0];return n.callback=e,n.facade}var rLe=typeof window<"u"?_.useLayoutEffect:_.useEffect,QV=new WeakMap;function tie(t,e){var n=nLe(null,function(r){return t.forEach(function(i){return m6(i,r)})});return rLe(function(){var r=QV.get(n);if(r){var i=new Set(r),s=new Set(t),o=n.current;i.forEach(function(a){s.has(a)||m6(a,null)}),s.forEach(function(a){i.has(a)||m6(a,o)})}QV.set(n,t)},[t]),n}function iLe(t){return t}function sLe(t,e){e===void 0&&(e=iLe);var n=[],r=!1,i={read:function(){if(r)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:t},useMedium:function(s){var o=e(s,r);return n.push(o),function(){n=n.filter(function(a){return a!==o})}},assignSyncMedium:function(s){for(r=!0;n.length;){var o=n;n=[],o.forEach(s)}n={push:function(a){return s(a)},filter:function(){return n}}},assignMedium:function(s){r=!0;var o=[];if(n.length){var a=n;n=[],a.forEach(s),o=n}var c=function(){var d=o;o=[],d.forEach(s)},l=function(){return Promise.resolve().then(c)};l(),n={push:function(d){o.push(d),l()},filter:function(d){return o=o.filter(d),n}}}};return i}function nie(t){t===void 0&&(t={});var e=sLe(null);return e.options=Ui({async:!0,ssr:!1},t),e}var rie=function(t){var e=t.sideCar,n=Z_(t,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var r=e.read();if(!r)throw new Error("Sidecar medium not found");return _.createElement(r,Ui({},n))};rie.isSideCarExport=!0;function iie(t,e){return t.useMedium(e),rie}var sie=nie(),g6=function(){},uR=_.forwardRef(function(t,e){var n=_.useRef(null),r=_.useState({onScrollCapture:g6,onWheelCapture:g6,onTouchMoveCapture:g6}),i=r[0],s=r[1],o=t.forwardProps,a=t.children,c=t.className,l=t.removeScrollBar,d=t.enabled,h=t.shards,m=t.sideCar,g=t.noIsolation,y=t.inert,v=t.allowPinchZoom,E=t.as,w=E===void 0?"div":E,R=t.gapMode,x=Z_(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),C=m,k=tie([n,e]),T=Ui(Ui({},x),i);return _.createElement(_.Fragment,null,d&&_.createElement(C,{sideCar:sie,removeScrollBar:l,shards:h,noIsolation:g,inert:y,setCallbacks:s,allowPinchZoom:!!v,lockRef:n,gapMode:R}),o?_.cloneElement(_.Children.only(a),Ui(Ui({},T),{ref:k})):_.createElement(w,Ui({},T,{className:c,ref:k}),a))});uR.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};uR.classNames={fullWidth:nb,zeroRight:tb};var oLe=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function aLe(){if(!document)return null;var t=document.createElement("style");t.type="text/css";var e=oLe();return e&&t.setAttribute("nonce",e),t}function cLe(t,e){t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e))}function lLe(t){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(t)}var uLe=function(){var t=0,e=null;return{add:function(n){t==0&&(e=aLe())&&(cLe(e,n),lLe(e)),t++},remove:function(){t--,!t&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},dLe=function(){var t=uLe();return function(e,n){_.useEffect(function(){return t.add(e),function(){t.remove()}},[e&&n])}},K7=function(){var t=dLe(),e=function(n){var r=n.styles,i=n.dynamic;return t(r,i),null};return e},fLe={left:0,top:0,right:0,gap:0},v6=function(t){return parseInt(t||"",10)||0},hLe=function(t){var e=window.getComputedStyle(document.body),n=e[t==="padding"?"paddingLeft":"marginLeft"],r=e[t==="padding"?"paddingTop":"marginTop"],i=e[t==="padding"?"paddingRight":"marginRight"];return[v6(n),v6(r),v6(i)]},pLe=function(t){if(t===void 0&&(t="margin"),typeof window>"u")return fLe;var e=hLe(t),n=document.documentElement.clientWidth,r=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,r-n+e[2]-e[0])}},mLe=K7(),uv="data-scroll-locked",gLe=function(t,e,n,r){var i=t.left,s=t.top,o=t.right,a=t.gap;return n===void 0&&(n="margin"),`
  .`.concat(eLe,` {
   overflow: hidden `).concat(r,`;
   padding-right: `).concat(a,"px ").concat(r,`;
  }
  body[`).concat(uv,`] {
    overflow: hidden `).concat(r,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(r,";"),n==="margin"&&`
    padding-left: `.concat(i,`px;
    padding-top: `).concat(s,`px;
    padding-right: `).concat(o,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(a,"px ").concat(r,`;
    `),n==="padding"&&"padding-right: ".concat(a,"px ").concat(r,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(tb,` {
    right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(nb,` {
    margin-right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(tb," .").concat(tb,` {
    right: 0 `).concat(r,`;
  }
  
  .`).concat(nb," .").concat(nb,` {
    margin-right: 0 `).concat(r,`;
  }
  
  body[`).concat(uv,`] {
    `).concat(tLe,": ").concat(a,`px;
  }
`)},ZV=function(){var t=parseInt(document.body.getAttribute(uv)||"0",10);return isFinite(t)?t:0},vLe=function(){_.useEffect(function(){return document.body.setAttribute(uv,(ZV()+1).toString()),function(){var t=ZV()-1;t<=0?document.body.removeAttribute(uv):document.body.setAttribute(uv,t.toString())}},[])},oie=function(t){var e=t.noRelative,n=t.noImportant,r=t.gapMode,i=r===void 0?"margin":r;vLe();var s=_.useMemo(function(){return pLe(i)},[i]);return _.createElement(mLe,{styles:gLe(s,!e,i,n?"":"!important")})},rM=!1;if(typeof window<"u")try{var ww=Object.defineProperty({},"passive",{get:function(){return rM=!0,!0}});window.addEventListener("test",ww,ww),window.removeEventListener("test",ww,ww)}catch{rM=!1}var mg=rM?{passive:!1}:!1,yLe=function(t){return t.tagName==="TEXTAREA"},aie=function(t,e){if(!(t instanceof Element))return!1;var n=window.getComputedStyle(t);return n[e]!=="hidden"&&!(n.overflowY===n.overflowX&&!yLe(t)&&n[e]==="visible")},bLe=function(t){return aie(t,"overflowY")},_Le=function(t){return aie(t,"overflowX")},eK=function(t,e){var n=e.ownerDocument,r=e;do{typeof ShadowRoot<"u"&&r instanceof ShadowRoot&&(r=r.host);var i=cie(t,r);if(i){var s=lie(t,r),o=s[1],a=s[2];if(o>a)return!0}r=r.parentNode}while(r&&r!==n.body);return!1},SLe=function(t){var e=t.scrollTop,n=t.scrollHeight,r=t.clientHeight;return[e,n,r]},wLe=function(t){var e=t.scrollLeft,n=t.scrollWidth,r=t.clientWidth;return[e,n,r]},cie=function(t,e){return t==="v"?bLe(e):_Le(e)},lie=function(t,e){return t==="v"?SLe(e):wLe(e)},ELe=function(t,e){return t==="h"&&e==="rtl"?-1:1},CLe=function(t,e,n,r,i){var s=ELe(t,window.getComputedStyle(e).direction),o=s*r,a=n.target,c=e.contains(a),l=!1,d=o>0,h=0,m=0;do{var g=lie(t,a),y=g[0],v=g[1],E=g[2],w=v-E-s*y;(y||w)&&cie(t,a)&&(h+=w,m+=y),a instanceof ShadowRoot?a=a.host:a=a.parentNode}while(!c&&a!==document.body||c&&(e.contains(a)||e===a));return(d&&Math.abs(h)<1||!d&&Math.abs(m)<1)&&(l=!0),l},Ew=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},tK=function(t){return[t.deltaX,t.deltaY]},nK=function(t){return t&&"current"in t?t.current:t},TLe=function(t,e){return t[0]===e[0]&&t[1]===e[1]},RLe=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},kLe=0,gg=[];function ILe(t){var e=_.useRef([]),n=_.useRef([0,0]),r=_.useRef(),i=_.useState(kLe++)[0],s=_.useState(K7)[0],o=_.useRef(t);_.useEffect(function(){o.current=t},[t]),_.useEffect(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(i));var v=ia([t.lockRef.current],(t.shards||[]).map(nK),!0).filter(Boolean);return v.forEach(function(E){return E.classList.add("allow-interactivity-".concat(i))}),function(){document.body.classList.remove("block-interactivity-".concat(i)),v.forEach(function(E){return E.classList.remove("allow-interactivity-".concat(i))})}}},[t.inert,t.lockRef.current,t.shards]);var a=_.useCallback(function(v,E){if("touches"in v&&v.touches.length===2||v.type==="wheel"&&v.ctrlKey)return!o.current.allowPinchZoom;var w=Ew(v),R=n.current,x="deltaX"in v?v.deltaX:R[0]-w[0],C="deltaY"in v?v.deltaY:R[1]-w[1],k,T=v.target,L=Math.abs(x)>Math.abs(C)?"h":"v";if("touches"in v&&L==="h"&&T.type==="range")return!1;var O=eK(L,T);if(!O)return!0;if(O?k=L:(k=L==="v"?"h":"v",O=eK(L,T)),!O)return!1;if(!r.current&&"changedTouches"in v&&(x||C)&&(r.current=k),!k)return!0;var P=r.current||k;return CLe(P,E,v,P==="h"?x:C)},[]),c=_.useCallback(function(v){var E=v;if(!(!gg.length||gg[gg.length-1]!==s)){var w="deltaY"in E?tK(E):Ew(E),R=e.current.filter(function(k){return k.name===E.type&&(k.target===E.target||E.target===k.shadowParent)&&TLe(k.delta,w)})[0];if(R&&R.should){E.cancelable&&E.preventDefault();return}if(!R){var x=(o.current.shards||[]).map(nK).filter(Boolean).filter(function(k){return k.contains(E.target)}),C=x.length>0?a(E,x[0]):!o.current.noIsolation;C&&E.cancelable&&E.preventDefault()}}},[]),l=_.useCallback(function(v,E,w,R){var x={name:v,delta:E,target:w,should:R,shadowParent:xLe(w)};e.current.push(x),setTimeout(function(){e.current=e.current.filter(function(C){return C!==x})},1)},[]),d=_.useCallback(function(v){n.current=Ew(v),r.current=void 0},[]),h=_.useCallback(function(v){l(v.type,tK(v),v.target,a(v,t.lockRef.current))},[]),m=_.useCallback(function(v){l(v.type,Ew(v),v.target,a(v,t.lockRef.current))},[]);_.useEffect(function(){return gg.push(s),t.setCallbacks({onScrollCapture:h,onWheelCapture:h,onTouchMoveCapture:m}),document.addEventListener("wheel",c,mg),document.addEventListener("touchmove",c,mg),document.addEventListener("touchstart",d,mg),function(){gg=gg.filter(function(v){return v!==s}),document.removeEventListener("wheel",c,mg),document.removeEventListener("touchmove",c,mg),document.removeEventListener("touchstart",d,mg)}},[]);var g=t.removeScrollBar,y=t.inert;return _.createElement(_.Fragment,null,y?_.createElement(s,{styles:RLe(i)}):null,g?_.createElement(oie,{gapMode:t.gapMode}):null)}function xLe(t){for(var e=null;t!==null;)t instanceof ShadowRoot&&(e=t.host,t=t.host),t=t.parentNode;return e}const ALe=iie(sie,ILe);var G7=_.forwardRef(function(t,e){return _.createElement(uR,Ui({},t,{ref:e,sideCar:ALe}))});G7.classNames=uR.classNames;var iM=["Enter"," "],LLe=["ArrowDown","PageUp","Home"],uie=["ArrowUp","PageDown","End"],MLe=[...LLe,...uie],OLe={ltr:[...iM,"ArrowRight"],rtl:[...iM,"ArrowLeft"]},PLe={ltr:["ArrowLeft"],rtl:["ArrowRight"]},eS="Menu",[Zb,DLe,NLe]=O7(eS),[om,die]=sm(eS,[NLe,yre,xre]),dR=yre(),fie=xre(),[ULe,am]=om(eS),[jLe,tS]=om(eS),hie=t=>{const{__scopeMenu:e,open:n=!1,children:r,dir:i,onOpenChange:s,modal:o=!0}=t,a=dR(e),[c,l]=_.useState(null),d=_.useRef(!1),h=Al(s),m=P7(i);return _.useEffect(()=>{const g=()=>{d.current=!0,document.addEventListener("pointerdown",y,{capture:!0,once:!0}),document.addEventListener("pointermove",y,{capture:!0,once:!0})},y=()=>d.current=!1;return document.addEventListener("keydown",g,{capture:!0}),()=>{document.removeEventListener("keydown",g,{capture:!0}),document.removeEventListener("pointerdown",y,{capture:!0}),document.removeEventListener("pointermove",y,{capture:!0})}},[]),S.jsx(vAe,{...a,children:S.jsx(ULe,{scope:e,open:n,onOpenChange:h,content:c,onContentChange:l,children:S.jsx(jLe,{scope:e,onClose:_.useCallback(()=>h(!1),[h]),isUsingKeyboardRef:d,dir:m,modal:o,children:r})})})};hie.displayName=eS;var FLe="MenuAnchor",z7=_.forwardRef((t,e)=>{const{__scopeMenu:n,...r}=t,i=dR(n);return S.jsx(yAe,{...i,...r,ref:e})});z7.displayName=FLe;var W7="MenuPortal",[$Le,pie]=om(W7,{forceMount:void 0}),mie=t=>{const{__scopeMenu:e,forceMount:n,children:r,container:i}=t,s=am(W7,e);return S.jsx($Le,{scope:e,forceMount:n,children:S.jsx(fh,{present:n||s.open,children:S.jsx(F7,{asChild:!0,container:i,children:r})})})};mie.displayName=W7;var qa="MenuContent",[BLe,Y7]=om(qa),gie=_.forwardRef((t,e)=>{const n=pie(qa,t.__scopeMenu),{forceMount:r=n.forceMount,...i}=t,s=am(qa,t.__scopeMenu),o=tS(qa,t.__scopeMenu);return S.jsx(Zb.Provider,{scope:t.__scopeMenu,children:S.jsx(fh,{present:r||s.open,children:S.jsx(Zb.Slot,{scope:t.__scopeMenu,children:o.modal?S.jsx(HLe,{...i,ref:e}):S.jsx(qLe,{...i,ref:e})})})})}),HLe=_.forwardRef((t,e)=>{const n=am(qa,t.__scopeMenu),r=_.useRef(null),i=br(e,r);return _.useEffect(()=>{const s=r.current;if(s)return B7(s)},[]),S.jsx(X7,{...t,ref:i,trapFocus:n.open,disableOutsidePointerEvents:n.open,disableOutsideScroll:!0,onFocusOutside:bt(t.onFocusOutside,s=>s.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>n.onOpenChange(!1)})}),qLe=_.forwardRef((t,e)=>{const n=am(qa,t.__scopeMenu);return S.jsx(X7,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>n.onOpenChange(!1)})}),VLe=_o("MenuContent.ScrollLock"),X7=_.forwardRef((t,e)=>{const{__scopeMenu:n,loop:r=!1,trapFocus:i,onOpenAutoFocus:s,onCloseAutoFocus:o,disableOutsidePointerEvents:a,onEntryFocus:c,onEscapeKeyDown:l,onPointerDownOutside:d,onFocusOutside:h,onInteractOutside:m,onDismiss:g,disableOutsideScroll:y,...v}=t,E=am(qa,n),w=tS(qa,n),R=dR(n),x=fie(n),C=DLe(n),[k,T]=_.useState(null),L=_.useRef(null),O=br(e,L,E.onContentChange),P=_.useRef(0),D=_.useRef(""),j=_.useRef(0),H=_.useRef(null),z=_.useRef("right"),Y=_.useRef(0),W=y?G7:_.Fragment,F=y?{as:VLe,allowPinchZoom:!0}:void 0,$=G=>{const Z=D.current+G,q=C().filter(de=>!de.disabled),J=document.activeElement,ue=q.find(de=>de.ref.current===J)?.textValue,ge=q.map(de=>de.textValue),Re=nMe(ge,Z,ue),we=q.find(de=>de.textValue===Re)?.ref.current;(function de(ke){D.current=ke,window.clearTimeout(P.current),ke!==""&&(P.current=window.setTimeout(()=>de(""),1e3))})(Z),we&&setTimeout(()=>we.focus())};_.useEffect(()=>()=>window.clearTimeout(P.current),[]),D7();const V=_.useCallback(G=>z.current===H.current?.side&&iMe(G,H.current?.area),[]);return S.jsx(BLe,{scope:n,searchRef:D,onItemEnter:_.useCallback(G=>{V(G)&&G.preventDefault()},[V]),onItemLeave:_.useCallback(G=>{V(G)||(L.current?.focus(),T(null))},[V]),onTriggerLeave:_.useCallback(G=>{V(G)&&G.preventDefault()},[V]),pointerGraceTimerRef:j,onPointerGraceIntentChange:_.useCallback(G=>{H.current=G},[]),children:S.jsx(W,{...F,children:S.jsx(N7,{asChild:!0,trapped:i,onMountAutoFocus:bt(s,G=>{G.preventDefault(),L.current?.focus({preventScroll:!0})}),onUnmountAutoFocus:o,children:S.jsx(aR,{asChild:!0,disableOutsidePointerEvents:a,onEscapeKeyDown:l,onPointerDownOutside:d,onFocusOutside:h,onInteractOutside:m,onDismiss:g,children:S.jsx(GAe,{asChild:!0,...x,dir:w.dir,orientation:"vertical",loop:r,currentTabStopId:k,onCurrentTabStopIdChange:T,onEntryFocus:bt(c,G=>{w.isUsingKeyboardRef.current||G.preventDefault()}),preventScrollOnEntryFocus:!0,children:S.jsx(bAe,{role:"menu","aria-orientation":"vertical","data-state":Mie(E.open),"data-radix-menu-content":"",dir:w.dir,...R,...v,ref:O,style:{outline:"none",...v.style},onKeyDown:bt(v.onKeyDown,G=>{const q=G.target.closest("[data-radix-menu-content]")===G.currentTarget,J=G.ctrlKey||G.altKey||G.metaKey,ue=G.key.length===1;q&&(G.key==="Tab"&&G.preventDefault(),!J&&ue&&$(G.key));const ge=L.current;if(G.target!==ge||!MLe.includes(G.key))return;G.preventDefault();const we=C().filter(de=>!de.disabled).map(de=>de.ref.current);uie.includes(G.key)&&we.reverse(),eMe(we)}),onBlur:bt(t.onBlur,G=>{G.currentTarget.contains(G.target)||(window.clearTimeout(P.current),D.current="")}),onPointerMove:bt(t.onPointerMove,e_(G=>{const Z=G.target,q=Y.current!==G.clientX;if(G.currentTarget.contains(Z)&&q){const J=G.clientX>Y.current?"right":"left";z.current=J,Y.current=G.clientX}}))})})})})})})});gie.displayName=qa;var KLe="MenuGroup",J7=_.forwardRef((t,e)=>{const{__scopeMenu:n,...r}=t;return S.jsx(J_.div,{role:"group",...r,ref:e})});J7.displayName=KLe;var GLe="MenuLabel",vie=_.forwardRef((t,e)=>{const{__scopeMenu:n,...r}=t;return S.jsx(J_.div,{...r,ref:e})});vie.displayName=GLe;var d3="MenuItem",rK="menu.itemSelect",fR=_.forwardRef((t,e)=>{const{disabled:n=!1,onSelect:r,...i}=t,s=_.useRef(null),o=tS(d3,t.__scopeMenu),a=Y7(d3,t.__scopeMenu),c=br(e,s),l=_.useRef(!1),d=()=>{const h=s.current;if(!n&&h){const m=new CustomEvent(rK,{bubbles:!0,cancelable:!0});h.addEventListener(rK,g=>r?.(g),{once:!0}),IAe(h,m),m.defaultPrevented?l.current=!1:o.onClose()}};return S.jsx(yie,{...i,ref:c,disabled:n,onClick:bt(t.onClick,d),onPointerDown:h=>{t.onPointerDown?.(h),l.current=!0},onPointerUp:bt(t.onPointerUp,h=>{l.current||h.currentTarget?.click()}),onKeyDown:bt(t.onKeyDown,h=>{const m=a.searchRef.current!=="";n||m&&h.key===" "||iM.includes(h.key)&&(h.currentTarget.click(),h.preventDefault())})})});fR.displayName=d3;var yie=_.forwardRef((t,e)=>{const{__scopeMenu:n,disabled:r=!1,textValue:i,...s}=t,o=Y7(d3,n),a=fie(n),c=_.useRef(null),l=br(e,c),[d,h]=_.useState(!1),[m,g]=_.useState("");return _.useEffect(()=>{const y=c.current;y&&g((y.textContent??"").trim())},[s.children]),S.jsx(Zb.ItemSlot,{scope:n,disabled:r,textValue:i??m,children:S.jsx(zAe,{asChild:!0,...a,focusable:!r,children:S.jsx(J_.div,{role:"menuitem","data-highlighted":d?"":void 0,"aria-disabled":r||void 0,"data-disabled":r?"":void 0,...s,ref:l,onPointerMove:bt(t.onPointerMove,e_(y=>{r?o.onItemLeave(y):(o.onItemEnter(y),y.defaultPrevented||y.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:bt(t.onPointerLeave,e_(y=>o.onItemLeave(y))),onFocus:bt(t.onFocus,()=>h(!0)),onBlur:bt(t.onBlur,()=>h(!1))})})})}),zLe="MenuCheckboxItem",bie=_.forwardRef((t,e)=>{const{checked:n=!1,onCheckedChange:r,...i}=t;return S.jsx(Cie,{scope:t.__scopeMenu,checked:n,children:S.jsx(fR,{role:"menuitemcheckbox","aria-checked":f3(n)?"mixed":n,...i,ref:e,"data-state":Z7(n),onSelect:bt(i.onSelect,()=>r?.(f3(n)?!0:!n),{checkForDefaultPrevented:!1})})})});bie.displayName=zLe;var _ie="MenuRadioGroup",[WLe,YLe]=om(_ie,{value:void 0,onValueChange:()=>{}}),Sie=_.forwardRef((t,e)=>{const{value:n,onValueChange:r,...i}=t,s=Al(r);return S.jsx(WLe,{scope:t.__scopeMenu,value:n,onValueChange:s,children:S.jsx(J7,{...i,ref:e})})});Sie.displayName=_ie;var wie="MenuRadioItem",Eie=_.forwardRef((t,e)=>{const{value:n,...r}=t,i=YLe(wie,t.__scopeMenu),s=n===i.value;return S.jsx(Cie,{scope:t.__scopeMenu,checked:s,children:S.jsx(fR,{role:"menuitemradio","aria-checked":s,...r,ref:e,"data-state":Z7(s),onSelect:bt(r.onSelect,()=>i.onValueChange?.(n),{checkForDefaultPrevented:!1})})})});Eie.displayName=wie;var Q7="MenuItemIndicator",[Cie,XLe]=om(Q7,{checked:!1}),Tie=_.forwardRef((t,e)=>{const{__scopeMenu:n,forceMount:r,...i}=t,s=XLe(Q7,n);return S.jsx(fh,{present:r||f3(s.checked)||s.checked===!0,children:S.jsx(J_.span,{...i,ref:e,"data-state":Z7(s.checked)})})});Tie.displayName=Q7;var JLe="MenuSeparator",Rie=_.forwardRef((t,e)=>{const{__scopeMenu:n,...r}=t;return S.jsx(J_.div,{role:"separator","aria-orientation":"horizontal",...r,ref:e})});Rie.displayName=JLe;var QLe="MenuArrow",kie=_.forwardRef((t,e)=>{const{__scopeMenu:n,...r}=t,i=dR(n);return S.jsx(_Ae,{...i,...r,ref:e})});kie.displayName=QLe;var ZLe="MenuSub",[Kot,Iie]=om(ZLe),L1="MenuSubTrigger",xie=_.forwardRef((t,e)=>{const n=am(L1,t.__scopeMenu),r=tS(L1,t.__scopeMenu),i=Iie(L1,t.__scopeMenu),s=Y7(L1,t.__scopeMenu),o=_.useRef(null),{pointerGraceTimerRef:a,onPointerGraceIntentChange:c}=s,l={__scopeMenu:t.__scopeMenu},d=_.useCallback(()=>{o.current&&window.clearTimeout(o.current),o.current=null},[]);return _.useEffect(()=>d,[d]),_.useEffect(()=>{const h=a.current;return()=>{window.clearTimeout(h),c(null)}},[a,c]),S.jsx(z7,{asChild:!0,...l,children:S.jsx(yie,{id:i.triggerId,"aria-haspopup":"menu","aria-expanded":n.open,"aria-controls":i.contentId,"data-state":Mie(n.open),...t,ref:oR(e,i.onTriggerChange),onClick:h=>{t.onClick?.(h),!(t.disabled||h.defaultPrevented)&&(h.currentTarget.focus(),n.open||n.onOpenChange(!0))},onPointerMove:bt(t.onPointerMove,e_(h=>{s.onItemEnter(h),!h.defaultPrevented&&!t.disabled&&!n.open&&!o.current&&(s.onPointerGraceIntentChange(null),o.current=window.setTimeout(()=>{n.onOpenChange(!0),d()},100))})),onPointerLeave:bt(t.onPointerLeave,e_(h=>{d();const m=n.content?.getBoundingClientRect();if(m){const g=n.content?.dataset.side,y=g==="right",v=y?-5:5,E=m[y?"left":"right"],w=m[y?"right":"left"];s.onPointerGraceIntentChange({area:[{x:h.clientX+v,y:h.clientY},{x:E,y:m.top},{x:w,y:m.top},{x:w,y:m.bottom},{x:E,y:m.bottom}],side:g}),window.clearTimeout(a.current),a.current=window.setTimeout(()=>s.onPointerGraceIntentChange(null),300)}else{if(s.onTriggerLeave(h),h.defaultPrevented)return;s.onPointerGraceIntentChange(null)}})),onKeyDown:bt(t.onKeyDown,h=>{const m=s.searchRef.current!=="";t.disabled||m&&h.key===" "||OLe[r.dir].includes(h.key)&&(n.onOpenChange(!0),n.content?.focus(),h.preventDefault())})})})});xie.displayName=L1;var Aie="MenuSubContent",Lie=_.forwardRef((t,e)=>{const n=pie(qa,t.__scopeMenu),{forceMount:r=n.forceMount,...i}=t,s=am(qa,t.__scopeMenu),o=tS(qa,t.__scopeMenu),a=Iie(Aie,t.__scopeMenu),c=_.useRef(null),l=br(e,c);return S.jsx(Zb.Provider,{scope:t.__scopeMenu,children:S.jsx(fh,{present:r||s.open,children:S.jsx(Zb.Slot,{scope:t.__scopeMenu,children:S.jsx(X7,{id:a.contentId,"aria-labelledby":a.triggerId,...i,ref:l,align:"start",side:o.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:d=>{o.isUsingKeyboardRef.current&&c.current?.focus(),d.preventDefault()},onCloseAutoFocus:d=>d.preventDefault(),onFocusOutside:bt(t.onFocusOutside,d=>{d.target!==a.trigger&&s.onOpenChange(!1)}),onEscapeKeyDown:bt(t.onEscapeKeyDown,d=>{o.onClose(),d.preventDefault()}),onKeyDown:bt(t.onKeyDown,d=>{const h=d.currentTarget.contains(d.target),m=PLe[o.dir].includes(d.key);h&&m&&(s.onOpenChange(!1),a.trigger?.focus(),d.preventDefault())})})})})})});Lie.displayName=Aie;function Mie(t){return t?"open":"closed"}function f3(t){return t==="indeterminate"}function Z7(t){return f3(t)?"indeterminate":t?"checked":"unchecked"}function eMe(t){const e=document.activeElement;for(const n of t)if(n===e||(n.focus(),document.activeElement!==e))return}function tMe(t,e){return t.map((n,r)=>t[(e+r)%t.length])}function nMe(t,e,n){const i=e.length>1&&Array.from(e).every(l=>l===e[0])?e[0]:e,s=n?t.indexOf(n):-1;let o=tMe(t,Math.max(s,0));i.length===1&&(o=o.filter(l=>l!==n));const c=o.find(l=>l.toLowerCase().startsWith(i.toLowerCase()));return c!==n?c:void 0}function rMe(t,e){const{x:n,y:r}=t;let i=!1;for(let s=0,o=e.length-1;s<e.length;o=s++){const a=e[s],c=e[o],l=a.x,d=a.y,h=c.x,m=c.y;d>r!=m>r&&n<(h-l)*(r-d)/(m-d)+l&&(i=!i)}return i}function iMe(t,e){if(!e)return!1;const n={x:t.clientX,y:t.clientY};return rMe(n,e)}function e_(t){return e=>e.pointerType==="mouse"?t(e):void 0}var sMe=hie,oMe=z7,aMe=mie,cMe=gie,lMe=J7,uMe=vie,dMe=fR,fMe=bie,hMe=Sie,pMe=Eie,mMe=Tie,gMe=Rie,vMe=kie,yMe=xie,bMe=Lie,e8="ContextMenu",[_Me,Got]=sm(e8,[die]),Fs=die(),[SMe,Oie]=_Me(e8),Pie=t=>{const{__scopeContextMenu:e,children:n,onOpenChange:r,dir:i,modal:s=!0}=t,[o,a]=_.useState(!1),c=Fs(e),l=Al(r),d=_.useCallback(h=>{a(h),l(h)},[l]);return S.jsx(SMe,{scope:e,open:o,onOpenChange:d,modal:s,children:S.jsx(sMe,{...c,dir:i,open:o,onOpenChange:d,modal:s,children:n})})};Pie.displayName=e8;var Die="ContextMenuTrigger",Nie=_.forwardRef((t,e)=>{const{__scopeContextMenu:n,disabled:r=!1,...i}=t,s=Oie(Die,n),o=Fs(n),a=_.useRef({x:0,y:0}),c=_.useRef({getBoundingClientRect:()=>DOMRect.fromRect({width:0,height:0,...a.current})}),l=_.useRef(0),d=_.useCallback(()=>window.clearTimeout(l.current),[]),h=m=>{a.current={x:m.clientX,y:m.clientY},s.onOpenChange(!0)};return _.useEffect(()=>d,[d]),_.useEffect(()=>{r&&d()},[r,d]),S.jsxs(S.Fragment,{children:[S.jsx(oMe,{...o,virtualRef:c}),S.jsx(F5e.span,{"data-state":s.open?"open":"closed","data-disabled":r?"":void 0,...i,ref:e,style:{WebkitTouchCallout:"none",...t.style},onContextMenu:r?t.onContextMenu:bt(t.onContextMenu,m=>{d(),h(m),m.preventDefault()}),onPointerDown:r?t.onPointerDown:bt(t.onPointerDown,Cw(m=>{d(),l.current=window.setTimeout(()=>h(m),700)})),onPointerMove:r?t.onPointerMove:bt(t.onPointerMove,Cw(d)),onPointerCancel:r?t.onPointerCancel:bt(t.onPointerCancel,Cw(d)),onPointerUp:r?t.onPointerUp:bt(t.onPointerUp,Cw(d))})]})});Nie.displayName=Die;var wMe="ContextMenuPortal",Uie=t=>{const{__scopeContextMenu:e,...n}=t,r=Fs(e);return S.jsx(aMe,{...r,...n})};Uie.displayName=wMe;var jie="ContextMenuContent",Fie=_.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=Oie(jie,n),s=Fs(n),o=_.useRef(!1);return S.jsx(cMe,{...s,...r,ref:e,side:"right",sideOffset:2,align:"start",onCloseAutoFocus:a=>{t.onCloseAutoFocus?.(a),!a.defaultPrevented&&o.current&&a.preventDefault(),o.current=!1},onInteractOutside:a=>{t.onInteractOutside?.(a),!a.defaultPrevented&&!i.modal&&(o.current=!0)},style:{...t.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Fie.displayName=jie;var EMe="ContextMenuGroup",CMe=_.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=Fs(n);return S.jsx(lMe,{...i,...r,ref:e})});CMe.displayName=EMe;var TMe="ContextMenuLabel",RMe=_.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=Fs(n);return S.jsx(uMe,{...i,...r,ref:e})});RMe.displayName=TMe;var kMe="ContextMenuItem",$ie=_.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=Fs(n);return S.jsx(dMe,{...i,...r,ref:e})});$ie.displayName=kMe;var IMe="ContextMenuCheckboxItem",xMe=_.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=Fs(n);return S.jsx(fMe,{...i,...r,ref:e})});xMe.displayName=IMe;var AMe="ContextMenuRadioGroup",LMe=_.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=Fs(n);return S.jsx(hMe,{...i,...r,ref:e})});LMe.displayName=AMe;var MMe="ContextMenuRadioItem",OMe=_.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=Fs(n);return S.jsx(pMe,{...i,...r,ref:e})});OMe.displayName=MMe;var PMe="ContextMenuItemIndicator",DMe=_.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=Fs(n);return S.jsx(mMe,{...i,...r,ref:e})});DMe.displayName=PMe;var NMe="ContextMenuSeparator",UMe=_.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=Fs(n);return S.jsx(gMe,{...i,...r,ref:e})});UMe.displayName=NMe;var jMe="ContextMenuArrow",FMe=_.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=Fs(n);return S.jsx(vMe,{...i,...r,ref:e})});FMe.displayName=jMe;var $Me="ContextMenuSubTrigger",BMe=_.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=Fs(n);return S.jsx(yMe,{...i,...r,ref:e})});BMe.displayName=$Me;var HMe="ContextMenuSubContent",qMe=_.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=Fs(n);return S.jsx(bMe,{...i,...r,ref:e,style:{...t.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});qMe.displayName=HMe;function Cw(t){return e=>e.pointerType!=="mouse"?t(e):void 0}var iK=Pie,VMe=Nie,KMe=Uie,GMe=Fie;const zMe="_menu_1glhz_8",WMe="_title_1glhz_74",sK={menu:zMe,title:WMe},YMe={"menu-title":"_menu-title_1sgvx_8"},XMe=({title:t,id:e,className:n})=>{const r=Le(YMe["menu-title"],n);return S.jsx(an,{as:"h3",id:e,className:r,size:"sm",weight:"semibold",children:t})},t8=_.forwardRef(({title:t,showTitle:e=!0,className:n,children:r,...i},s)=>{const o=_.useId();return S.jsxs("div",{role:"menu",ref:s,"aria-label":e?void 0:t,"aria-labelledby":e?o:void 0,className:Le(n,sK.menu),...i,children:[e&&S.jsx(XMe,{className:sK.title,title:t,id:o}),r]})});t8.displayName="FloatingMenu";var JMe=my[" useId ".trim().toString()]||(()=>{}),QMe=0;function y6(t){const[e,n]=_.useState(JMe());return ud(()=>{n(r=>r??String(QMe++))},[t]),t||(e?`radix-${e}`:"")}var ZMe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],nS=ZMe.reduce((t,e)=>{const n=_o(`Primitive.${e}`),r=_.forwardRef((i,s)=>{const{asChild:o,...a}=i,c=o?n:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),S.jsx(c,{...a,ref:s})});return r.displayName=`Primitive.${e}`,{...t,[e]:r}},{}),hR="Dialog",[Bie,zot]=sm(hR),[eOe,Bc]=Bie(hR),Hie=t=>{const{__scopeDialog:e,children:n,open:r,defaultOpen:i,onOpenChange:s,modal:o=!0}=t,a=_.useRef(null),c=_.useRef(null),[l,d]=$7({prop:r,defaultProp:i??!1,onChange:s,caller:hR});return S.jsx(eOe,{scope:e,triggerRef:a,contentRef:c,contentId:y6(),titleId:y6(),descriptionId:y6(),open:l,onOpenChange:d,onOpenToggle:_.useCallback(()=>d(h=>!h),[d]),modal:o,children:n})};Hie.displayName=hR;var qie="DialogTrigger",Vie=_.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,i=Bc(qie,n),s=br(e,i.triggerRef);return S.jsx(nS.button,{type:"button","aria-haspopup":"dialog","aria-expanded":i.open,"aria-controls":i.contentId,"data-state":i8(i.open),...r,ref:s,onClick:bt(t.onClick,i.onOpenToggle)})});Vie.displayName=qie;var n8="DialogPortal",[tOe,Kie]=Bie(n8,{forceMount:void 0}),Gie=t=>{const{__scopeDialog:e,forceMount:n,children:r,container:i}=t,s=Bc(n8,e);return S.jsx(tOe,{scope:e,forceMount:n,children:_.Children.map(r,o=>S.jsx(fh,{present:n||s.open,children:S.jsx(F7,{asChild:!0,container:i,children:o})}))})};Gie.displayName=n8;var h3="DialogOverlay",zie=_.forwardRef((t,e)=>{const n=Kie(h3,t.__scopeDialog),{forceMount:r=n.forceMount,...i}=t,s=Bc(h3,t.__scopeDialog);return s.modal?S.jsx(fh,{present:r||s.open,children:S.jsx(rOe,{...i,ref:e})}):null});zie.displayName=h3;var nOe=_o("DialogOverlay.RemoveScroll"),rOe=_.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,i=Bc(h3,n);return S.jsx(G7,{as:nOe,allowPinchZoom:!0,shards:[i.contentRef],children:S.jsx(nS.div,{"data-state":i8(i.open),...r,ref:e,style:{pointerEvents:"auto",...r.style}})})}),Fp="DialogContent",Wie=_.forwardRef((t,e)=>{const n=Kie(Fp,t.__scopeDialog),{forceMount:r=n.forceMount,...i}=t,s=Bc(Fp,t.__scopeDialog);return S.jsx(fh,{present:r||s.open,children:s.modal?S.jsx(iOe,{...i,ref:e}):S.jsx(sOe,{...i,ref:e})})});Wie.displayName=Fp;var iOe=_.forwardRef((t,e)=>{const n=Bc(Fp,t.__scopeDialog),r=_.useRef(null),i=br(e,n.contentRef,r);return _.useEffect(()=>{const s=r.current;if(s)return B7(s)},[]),S.jsx(Yie,{...t,ref:i,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:bt(t.onCloseAutoFocus,s=>{s.preventDefault(),n.triggerRef.current?.focus()}),onPointerDownOutside:bt(t.onPointerDownOutside,s=>{const o=s.detail.originalEvent,a=o.button===0&&o.ctrlKey===!0;(o.button===2||a)&&s.preventDefault()}),onFocusOutside:bt(t.onFocusOutside,s=>s.preventDefault())})}),sOe=_.forwardRef((t,e)=>{const n=Bc(Fp,t.__scopeDialog),r=_.useRef(!1),i=_.useRef(!1);return S.jsx(Yie,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{t.onCloseAutoFocus?.(s),s.defaultPrevented||(r.current||n.triggerRef.current?.focus(),s.preventDefault()),r.current=!1,i.current=!1},onInteractOutside:s=>{t.onInteractOutside?.(s),s.defaultPrevented||(r.current=!0,s.detail.originalEvent.type==="pointerdown"&&(i.current=!0));const o=s.target;n.triggerRef.current?.contains(o)&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&i.current&&s.preventDefault()}})}),Yie=_.forwardRef((t,e)=>{const{__scopeDialog:n,trapFocus:r,onOpenAutoFocus:i,onCloseAutoFocus:s,...o}=t,a=Bc(Fp,n),c=_.useRef(null),l=br(e,c);return D7(),S.jsxs(S.Fragment,{children:[S.jsx(N7,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:i,onUnmountAutoFocus:s,children:S.jsx(aR,{role:"dialog",id:a.contentId,"aria-describedby":a.descriptionId,"aria-labelledby":a.titleId,"data-state":i8(a.open),...o,ref:l,onDismiss:()=>a.onOpenChange(!1)})}),S.jsxs(S.Fragment,{children:[S.jsx(aOe,{titleId:a.titleId}),S.jsx(lOe,{contentRef:c,descriptionId:a.descriptionId})]})]})}),r8="DialogTitle",Xie=_.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,i=Bc(r8,n);return S.jsx(nS.h2,{id:i.titleId,...r,ref:e})});Xie.displayName=r8;var Jie="DialogDescription",oOe=_.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,i=Bc(Jie,n);return S.jsx(nS.p,{id:i.descriptionId,...r,ref:e})});oOe.displayName=Jie;var Qie="DialogClose",Zie=_.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,i=Bc(Qie,n);return S.jsx(nS.button,{type:"button",...r,ref:e,onClick:bt(t.onClick,()=>i.onOpenChange(!1))})});Zie.displayName=Qie;function i8(t){return t?"open":"closed"}var ese="DialogTitleWarning",[Wot,tse]=L5e(ese,{contentName:Fp,titleName:r8,docsSlug:"dialog"}),aOe=({titleId:t})=>{const e=tse(ese),n=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return _.useEffect(()=>{t&&(document.getElementById(t)||console.error(n))},[n,t]),null},cOe="DialogDescriptionWarning",lOe=({contentRef:t,descriptionId:e})=>{const r=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${tse(cOe).contentName}}.`;return _.useEffect(()=>{const i=t.current?.getAttribute("aria-describedby");e&&i&&(document.getElementById(e)||console.warn(r))},[r,t,e]),null},s8=Hie,uOe=Vie,o8=Gie,a8=zie,c8=Wie,l8=Xie,nse=Zie;function dOe(t){if(typeof document>"u")return;let e=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",e.appendChild(n),n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t))}const rse=xe.createContext({drawerRef:{current:null},overlayRef:{current:null},onPress:()=>{},onRelease:()=>{},onDrag:()=>{},onNestedDrag:()=>{},onNestedOpenChange:()=>{},onNestedRelease:()=>{},openProp:void 0,dismissible:!1,isOpen:!1,isDragging:!1,keyboardIsOpen:{current:!1},snapPointsOffset:null,snapPoints:null,handleOnly:!1,modal:!1,shouldFade:!1,activeSnapPoint:null,onOpenChange:()=>{},setActiveSnapPoint:()=>{},closeDrawer:()=>{},direction:"bottom",shouldAnimate:{current:!0},shouldScaleBackground:!1,setBackgroundColorOnScale:!0,noBodyStyles:!1,container:null,autoFocus:!1}),rS=()=>{const t=xe.useContext(rse);if(!t)throw new Error("useDrawerContext must be used within a Drawer.Root");return t};dOe(`[data-vaul-drawer]{touch-action:none;will-change:transform;transition:transform .5s cubic-bezier(.32, .72, 0, 1);animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=open]{animation-name:slideFromBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=closed]{animation-name:slideToBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=open]{animation-name:slideFromTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=closed]{animation-name:slideToTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=open]{animation-name:slideFromLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=closed]{animation-name:slideToLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=open]{animation-name:slideFromRight}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=closed]{animation-name:slideToRight}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,var(--initial-transform,100%),0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(var(--initial-transform,100%),0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-overlay][data-vaul-snap-points=false]{animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-overlay][data-vaul-snap-points=false][data-state=open]{animation-name:fadeIn}[data-vaul-overlay][data-state=closed]{animation-name:fadeOut}[data-vaul-animate=false]{animation:none!important}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:0;transition:opacity .5s cubic-bezier(.32, .72, 0, 1)}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:1}[data-vaul-drawer]:not([data-vaul-custom-container=true])::after{content:'';position:absolute;background:inherit;background-color:inherit}[data-vaul-drawer][data-vaul-drawer-direction=top]::after{top:initial;bottom:100%;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=bottom]::after{top:100%;bottom:initial;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=left]::after{left:initial;right:100%;top:0;bottom:0;width:200%}[data-vaul-drawer][data-vaul-drawer-direction=right]::after{left:100%;right:initial;top:0;bottom:0;width:200%}[data-vaul-overlay][data-vaul-snap-points=true]:not([data-vaul-snap-points-overlay=true]):not(
[data-state=closed]
){opacity:0}[data-vaul-overlay][data-vaul-snap-points-overlay=true]{opacity:1}[data-vaul-handle]{display:block;position:relative;opacity:.7;background:#e2e2e4;margin-left:auto;margin-right:auto;height:5px;width:32px;border-radius:1rem;touch-action:pan-y}[data-vaul-handle]:active,[data-vaul-handle]:hover{opacity:1}[data-vaul-handle-hitarea]{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:max(100%,2.75rem);height:max(100%,2.75rem);touch-action:inherit}@media (hover:hover) and (pointer:fine){[data-vaul-drawer]{user-select:none}}@media (pointer:fine){[data-vaul-handle-hitarea]:{width:100%;height:100%}}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes fadeOut{to{opacity:0}}@keyframes slideFromBottom{from{transform:translate3d(0,var(--initial-transform,100%),0)}to{transform:translate3d(0,0,0)}}@keyframes slideToBottom{to{transform:translate3d(0,var(--initial-transform,100%),0)}}@keyframes slideFromTop{from{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}to{transform:translate3d(0,0,0)}}@keyframes slideToTop{to{transform:translate3d(0,calc(var(--initial-transform,100%) * -1),0)}}@keyframes slideFromLeft{from{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToLeft{to{transform:translate3d(calc(var(--initial-transform,100%) * -1),0,0)}}@keyframes slideFromRight{from{transform:translate3d(var(--initial-transform,100%),0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToRight{to{transform:translate3d(var(--initial-transform,100%),0,0)}}`);function fOe(){const t=navigator.userAgent;return typeof window<"u"&&(/Firefox/.test(t)&&/Mobile/.test(t)||/FxiOS/.test(t))}function hOe(){return u8(/^Mac/)}function pOe(){return u8(/^iPhone/)}function oK(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function mOe(){return u8(/^iPad/)||hOe()&&navigator.maxTouchPoints>1}function ise(){return pOe()||mOe()}function u8(t){return typeof window<"u"&&window.navigator!=null?t.test(window.navigator.platform):void 0}const gOe=24,vOe=typeof window<"u"?_.useLayoutEffect:_.useEffect;function aK(...t){return(...e)=>{for(let n of t)typeof n=="function"&&n(...e)}}const b6=typeof document<"u"&&window.visualViewport;function cK(t){let e=window.getComputedStyle(t);return/(auto|scroll)/.test(e.overflow+e.overflowX+e.overflowY)}function sse(t){for(cK(t)&&(t=t.parentElement);t&&!cK(t);)t=t.parentElement;return t||document.scrollingElement||document.documentElement}const yOe=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]);let Tw=0,_6;function bOe(t={}){let{isDisabled:e}=t;vOe(()=>{if(!e)return Tw++,Tw===1&&ise()&&(_6=_Oe()),()=>{Tw--,Tw===0&&_6?.()}},[e])}function _Oe(){let t,e=0,n=h=>{t=sse(h.target),!(t===document.documentElement&&t===document.body)&&(e=h.changedTouches[0].pageY)},r=h=>{if(!t||t===document.documentElement||t===document.body){h.preventDefault();return}let m=h.changedTouches[0].pageY,g=t.scrollTop,y=t.scrollHeight-t.clientHeight;y!==0&&((g<=0&&m>e||g>=y&&m<e)&&h.preventDefault(),e=m)},i=h=>{let m=h.target;sM(m)&&m!==document.activeElement&&(h.preventDefault(),m.style.transform="translateY(-2000px)",m.focus(),requestAnimationFrame(()=>{m.style.transform=""}))},s=h=>{let m=h.target;sM(m)&&(m.style.transform="translateY(-2000px)",requestAnimationFrame(()=>{m.style.transform="",b6&&(b6.height<window.innerHeight?requestAnimationFrame(()=>{lK(m)}):b6.addEventListener("resize",()=>lK(m),{once:!0}))}))},o=()=>{window.scrollTo(0,0)},a=window.pageXOffset,c=window.pageYOffset,l=aK(SOe(document.documentElement,"paddingRight",`${window.innerWidth-document.documentElement.clientWidth}px`));window.scrollTo(0,0);let d=aK(n1(document,"touchstart",n,{passive:!1,capture:!0}),n1(document,"touchmove",r,{passive:!1,capture:!0}),n1(document,"touchend",i,{passive:!1,capture:!0}),n1(document,"focus",s,!0),n1(window,"scroll",o));return()=>{l(),d(),window.scrollTo(a,c)}}function SOe(t,e,n){let r=t.style[e];return t.style[e]=n,()=>{t.style[e]=r}}function n1(t,e,n,r){return t.addEventListener(e,n,r),()=>{t.removeEventListener(e,n,r)}}function lK(t){let e=document.scrollingElement||document.documentElement;for(;t&&t!==e;){let n=sse(t);if(n!==document.documentElement&&n!==document.body&&n!==t){let r=n.getBoundingClientRect().top,i=t.getBoundingClientRect().top,s=t.getBoundingClientRect().bottom;const o=n.getBoundingClientRect().bottom+gOe;s>o&&(n.scrollTop+=i-r)}t=n.parentElement}}function sM(t){return t instanceof HTMLInputElement&&!yOe.has(t.type)||t instanceof HTMLTextAreaElement||t instanceof HTMLElement&&t.isContentEditable}function wOe(t,e){typeof t=="function"?t(e):t!=null&&(t.current=e)}function EOe(...t){return e=>t.forEach(n=>wOe(n,e))}function ose(...t){return _.useCallback(EOe(...t),t)}const ase=new WeakMap;function fi(t,e,n=!1){if(!t||!(t instanceof HTMLElement))return;let r={};Object.entries(e).forEach(([i,s])=>{if(i.startsWith("--")){t.style.setProperty(i,s);return}r[i]=t.style[i],t.style[i]=s}),!n&&ase.set(t,r)}function COe(t,e){if(!t||!(t instanceof HTMLElement))return;let n=ase.get(t);n&&(t.style[e]=n[e])}const ti=t=>{switch(t){case"top":case"bottom":return!0;case"left":case"right":return!1;default:return t}};function Rw(t,e){if(!t)return null;const n=window.getComputedStyle(t),r=n.transform||n.webkitTransform||n.mozTransform;let i=r.match(/^matrix3d\((.+)\)$/);return i?parseFloat(i[1].split(", ")[ti(e)?13:12]):(i=r.match(/^matrix\((.+)\)$/),i?parseFloat(i[1].split(", ")[ti(e)?5:4]):null)}function TOe(t){return 8*(Math.log(t+1)-2)}function S6(t,e){if(!t)return()=>{};const n=t.style.cssText;return Object.assign(t.style,e),()=>{t.style.cssText=n}}function ROe(...t){return(...e)=>{for(const n of t)typeof n=="function"&&n(...e)}}const pr={DURATION:.5,EASE:[.32,.72,0,1]},cse=.4,kOe=.25,IOe=100,lse=8,Gh=16,oM=26,w6="vaul-dragging";function use(t){const e=xe.useRef(t);return xe.useEffect(()=>{e.current=t}),xe.useMemo(()=>(...n)=>e.current==null?void 0:e.current.call(e,...n),[])}function xOe({defaultProp:t,onChange:e}){const n=xe.useState(t),[r]=n,i=xe.useRef(r),s=use(e);return xe.useEffect(()=>{i.current!==r&&(s(r),i.current=r)},[r,i,s]),n}function dse({prop:t,defaultProp:e,onChange:n=()=>{}}){const[r,i]=xOe({defaultProp:e,onChange:n}),s=t!==void 0,o=s?t:r,a=use(n),c=xe.useCallback(l=>{if(s){const h=typeof l=="function"?l(t):l;h!==t&&a(h)}else i(l)},[s,t,i,a]);return[o,c]}function AOe({activeSnapPointProp:t,setActiveSnapPointProp:e,snapPoints:n,drawerRef:r,overlayRef:i,fadeFromIndex:s,onSnapPointChange:o,direction:a="bottom",container:c,snapToSequentialPoint:l}){const[d,h]=dse({prop:t,defaultProp:n?.[0],onChange:e}),[m,g]=xe.useState(typeof window<"u"?{innerWidth:window.innerWidth,innerHeight:window.innerHeight}:void 0);xe.useEffect(()=>{function L(){g({innerWidth:window.innerWidth,innerHeight:window.innerHeight})}return window.addEventListener("resize",L),()=>window.removeEventListener("resize",L)},[]);const y=xe.useMemo(()=>d===n?.[n.length-1]||null,[n,d]),v=xe.useMemo(()=>{var L;return(L=n?.findIndex(O=>O===d))!=null?L:null},[n,d]),E=n&&n.length>0&&(s||s===0)&&!Number.isNaN(s)&&n[s]===d||!n,w=xe.useMemo(()=>{const L=c?{width:c.getBoundingClientRect().width,height:c.getBoundingClientRect().height}:typeof window<"u"?{width:window.innerWidth,height:window.innerHeight}:{width:0,height:0};var O;return(O=n?.map(P=>{const D=typeof P=="string";let j=0;if(D&&(j=parseInt(P,10)),ti(a)){const z=D?j:m?P*L.height:0;return m?a==="bottom"?L.height-z:-L.height+z:z}const H=D?j:m?P*L.width:0;return m?a==="right"?L.width-H:-L.width+H:H}))!=null?O:[]},[n,m,c]),R=xe.useMemo(()=>v!==null?w?.[v]:null,[w,v]),x=xe.useCallback(L=>{var O;const P=(O=w?.findIndex(D=>D===L))!=null?O:null;o(P),fi(r.current,{transition:`transform ${pr.DURATION}s cubic-bezier(${pr.EASE.join(",")})`,transform:ti(a)?`translate3d(0, ${L}px, 0)`:`translate3d(${L}px, 0, 0)`}),w&&P!==w.length-1&&s!==void 0&&P!==s&&P<s?fi(i.current,{transition:`opacity ${pr.DURATION}s cubic-bezier(${pr.EASE.join(",")})`,opacity:"0"}):fi(i.current,{transition:`opacity ${pr.DURATION}s cubic-bezier(${pr.EASE.join(",")})`,opacity:"1"}),h(n?.[Math.max(P,0)])},[r.current,n,w,s,i,h]);xe.useEffect(()=>{if(d||t){var L;const O=(L=n?.findIndex(P=>P===t||P===d))!=null?L:-1;w&&O!==-1&&typeof w[O]=="number"&&x(w[O])}},[d,t,n,w,x]);function C({draggedDistance:L,closeDrawer:O,velocity:P,dismissible:D}){if(s===void 0)return;const j=a==="bottom"||a==="right"?(R??0)-L:(R??0)+L,H=v===s-1,z=v===0,Y=L>0;if(H&&fi(i.current,{transition:`opacity ${pr.DURATION}s cubic-bezier(${pr.EASE.join(",")})`}),!l&&P>2&&!Y){D?O():x(w[0]);return}if(!l&&P>2&&Y&&w&&n){x(w[n.length-1]);return}const W=w?.reduce(($,V)=>typeof $!="number"||typeof V!="number"?$:Math.abs(V-j)<Math.abs($-j)?V:$),F=ti(a)?window.innerHeight:window.innerWidth;if(P>cse&&Math.abs(L)<F*.4){const $=Y?1:-1;if($>0&&y&&n){x(w[n.length-1]);return}if(z&&$<0&&D&&O(),v===null)return;x(w[v+$]);return}x(W)}function k({draggedDistance:L}){if(R===null)return;const O=a==="bottom"||a==="right"?R-L:R+L;(a==="bottom"||a==="right")&&O<w[w.length-1]||(a==="top"||a==="left")&&O>w[w.length-1]||fi(r.current,{transform:ti(a)?`translate3d(0, ${O}px, 0)`:`translate3d(${O}px, 0, 0)`})}function T(L,O){if(!n||typeof v!="number"||!w||s===void 0)return null;const P=v===s-1;if(v>=s&&O)return 0;if(P&&!O)return 1;if(!E&&!P)return null;const j=P?v+1:v-1,H=P?w[j]-w[j-1]:w[j+1]-w[j],z=L/Math.abs(H);return P?1-z:z}return{isLastSnapPoint:y,activeSnapPoint:d,shouldFade:E,getPercentageDragged:T,setActiveSnapPoint:h,activeSnapPointIndex:v,onRelease:C,onDrag:k,snapPointsOffset:w}}const LOe=()=>()=>{};function MOe(){const{direction:t,isOpen:e,shouldScaleBackground:n,setBackgroundColorOnScale:r,noBodyStyles:i}=rS(),s=xe.useRef(null),o=_.useMemo(()=>document.body.style.backgroundColor,[]);function a(){return(window.innerWidth-oM)/window.innerWidth}xe.useEffect(()=>{if(e&&n){s.current&&clearTimeout(s.current);const c=document.querySelector("[data-vaul-drawer-wrapper]")||document.querySelector("[vaul-drawer-wrapper]");if(!c)return;ROe(r&&!i?S6(document.body,{background:"black"}):LOe,S6(c,{transformOrigin:ti(t)?"top":"left",transitionProperty:"transform, border-radius",transitionDuration:`${pr.DURATION}s`,transitionTimingFunction:`cubic-bezier(${pr.EASE.join(",")})`}));const l=S6(c,{borderRadius:`${lse}px`,overflow:"hidden",...ti(t)?{transform:`scale(${a()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`}:{transform:`scale(${a()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`}});return()=>{l(),s.current=window.setTimeout(()=>{o?document.body.style.background=o:document.body.style.removeProperty("background")},pr.DURATION*1e3)}}},[e,n,o])}let r1=null;function OOe({isOpen:t,modal:e,nested:n,hasBeenOpened:r,preventScrollRestoration:i,noBodyStyles:s}){const[o,a]=xe.useState(()=>typeof window<"u"?window.location.href:""),c=xe.useRef(0),l=xe.useCallback(()=>{if(oK()&&r1===null&&t&&!s){r1={position:document.body.style.position,top:document.body.style.top,left:document.body.style.left,height:document.body.style.height,right:"unset"};const{scrollX:h,innerHeight:m}=window;document.body.style.setProperty("position","fixed","important"),Object.assign(document.body.style,{top:`${-c.current}px`,left:`${-h}px`,right:"0px",height:"auto"}),window.setTimeout(()=>window.requestAnimationFrame(()=>{const g=m-window.innerHeight;g&&c.current>=m&&(document.body.style.top=`${-(c.current+g)}px`)}),300)}},[t]),d=xe.useCallback(()=>{if(oK()&&r1!==null&&!s){const h=-parseInt(document.body.style.top,10),m=-parseInt(document.body.style.left,10);Object.assign(document.body.style,r1),window.requestAnimationFrame(()=>{if(i&&o!==window.location.href){a(window.location.href);return}window.scrollTo(m,h)}),r1=null}},[o]);return xe.useEffect(()=>{function h(){c.current=window.scrollY}return h(),window.addEventListener("scroll",h),()=>{window.removeEventListener("scroll",h)}},[]),xe.useEffect(()=>{if(e)return()=>{typeof document>"u"||document.querySelector("[data-vaul-drawer]")||d()}},[e,d]),xe.useEffect(()=>{n||!r||(t?(!window.matchMedia("(display-mode: standalone)").matches&&l(),e||window.setTimeout(()=>{d()},500)):d())},[t,r,o,e,n,l,d]),{restorePositionSetting:d}}function POe({open:t,onOpenChange:e,children:n,onDrag:r,onRelease:i,snapPoints:s,shouldScaleBackground:o=!1,setBackgroundColorOnScale:a=!0,closeThreshold:c=kOe,scrollLockTimeout:l=IOe,dismissible:d=!0,handleOnly:h=!1,fadeFromIndex:m=s&&s.length-1,activeSnapPoint:g,setActiveSnapPoint:y,fixed:v,modal:E=!0,onClose:w,nested:R,noBodyStyles:x=!1,direction:C="bottom",defaultOpen:k=!1,disablePreventScroll:T=!0,snapToSequentialPoint:L=!1,preventScrollRestoration:O=!1,repositionInputs:P=!0,onAnimationEnd:D,container:j,autoFocus:H=!1}){var z,Y;const[W=!1,F]=dse({defaultProp:k,prop:t,onChange:nt=>{e?.(nt),!nt&&!R&&Vl(),setTimeout(()=>{D?.(nt)},pr.DURATION*1e3),nt&&!E&&typeof window<"u"&&window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"}),nt||(document.body.style.pointerEvents="auto")}}),[$,V]=xe.useState(!1),[G,Z]=xe.useState(!1),[q,J]=xe.useState(!1),ue=xe.useRef(null),ge=xe.useRef(null),Re=xe.useRef(null),we=xe.useRef(null),de=xe.useRef(null),ke=xe.useRef(!1),De=xe.useRef(null),Je=xe.useRef(0),vt=xe.useRef(!1),Sr=xe.useRef(!k),zn=xe.useRef(0),ze=xe.useRef(null),ys=xe.useRef(((z=ze.current)==null?void 0:z.getBoundingClientRect().height)||0),bs=xe.useRef(((Y=ze.current)==null?void 0:Y.getBoundingClientRect().width)||0),wi=xe.useRef(0),ql=xe.useCallback(nt=>{s&&nt===To.length-1&&(ge.current=new Date)},[]),{activeSnapPoint:sc,activeSnapPointIndex:_s,setActiveSnapPoint:Ss,onRelease:wd,snapPointsOffset:To,onDrag:wr,shouldFade:oc,getPercentageDragged:Wc}=AOe({snapPoints:s,activeSnapPointProp:g,setActiveSnapPointProp:y,drawerRef:ze,fadeFromIndex:m,overlayRef:ue,onSnapPointChange:ql,direction:C,container:j,snapToSequentialPoint:L});bOe({isDisabled:!W||G||!E||q||!$||!P||!T});const{restorePositionSetting:Vl}=OOe({isOpen:W,modal:E,nested:R??!1,hasBeenOpened:$,preventScrollRestoration:O,noBodyStyles:x});function Ro(){return(window.innerWidth-oM)/window.innerWidth}function Yc(nt){var Dt,Be;!d&&!s||ze.current&&!ze.current.contains(nt.target)||(ys.current=((Dt=ze.current)==null?void 0:Dt.getBoundingClientRect().height)||0,bs.current=((Be=ze.current)==null?void 0:Be.getBoundingClientRect().width)||0,Z(!0),Re.current=new Date,ise()&&window.addEventListener("touchend",()=>ke.current=!1,{once:!0}),nt.target.setPointerCapture(nt.pointerId),Je.current=ti(C)?nt.pageY:nt.pageX)}function Kl(nt,Dt){var Be;let rt=nt;const Mt=(Be=window.getSelection())==null?void 0:Be.toString(),Un=ze.current?Rw(ze.current,C):null,jn=new Date;if(rt.tagName==="SELECT"||rt.hasAttribute("data-vaul-no-drag")||rt.closest("[data-vaul-no-drag]"))return!1;if(C==="right"||C==="left")return!0;if(ge.current&&jn.getTime()-ge.current.getTime()<500)return!1;if(Un!==null&&(C==="bottom"?Un>0:Un<0))return!0;if(Mt&&Mt.length>0)return!1;if(de.current&&jn.getTime()-de.current.getTime()<l&&Un===0||Dt)return de.current=jn,!1;for(;rt;){if(rt.scrollHeight>rt.clientHeight){if(rt.scrollTop!==0)return de.current=new Date,!1;if(rt.getAttribute("role")==="dialog")return!0}rt=rt.parentNode}return!0}function Ed(nt){if(ze.current&&G){const Dt=C==="bottom"||C==="right"?1:-1,Be=(Je.current-(ti(C)?nt.pageY:nt.pageX))*Dt,rt=Be>0,Mt=s&&!d&&!rt;if(Mt&&_s===0)return;const Un=Math.abs(Be),jn=document.querySelector("[data-vaul-drawer-wrapper]"),ws=C==="bottom"||C==="top"?ys.current:bs.current;let zr=Un/ws;const Es=Wc(Un,rt);if(Es!==null&&(zr=Es),Mt&&zr>=1||!ke.current&&!Kl(nt.target,rt))return;if(ze.current.classList.add(w6),ke.current=!0,fi(ze.current,{transition:"none"}),fi(ue.current,{transition:"none"}),s&&wr({draggedDistance:Be}),rt&&!s){const os=TOe(Be),ac=Math.min(os*-1,0)*Dt;fi(ze.current,{transform:ti(C)?`translate3d(0, ${ac}px, 0)`:`translate3d(${ac}px, 0, 0)`});return}const Ci=1-zr;if((oc||m&&_s===m-1)&&(r?.(nt,zr),fi(ue.current,{opacity:`${Ci}`,transition:"none"},!0)),jn&&ue.current&&o){const os=Math.min(Ro()+zr*(1-Ro()),1),ac=8-zr*8,ne=Math.max(0,14-zr*14);fi(jn,{borderRadius:`${ac}px`,transform:ti(C)?`scale(${os}) translate3d(0, ${ne}px, 0)`:`scale(${os}) translate3d(${ne}px, 0, 0)`,transition:"none"},!0)}if(!s){const os=Un*Dt;fi(ze.current,{transform:ti(C)?`translate3d(0, ${os}px, 0)`:`translate3d(${os}px, 0, 0)`})}}}xe.useEffect(()=>{window.requestAnimationFrame(()=>{Sr.current=!0})},[]),xe.useEffect(()=>{var nt;function Dt(){if(!ze.current||!P)return;const Be=document.activeElement;if(sM(Be)||vt.current){var rt;const Mt=((rt=window.visualViewport)==null?void 0:rt.height)||0,Un=window.innerHeight;let jn=Un-Mt;const ws=ze.current.getBoundingClientRect().height||0,zr=ws>Un*.8;wi.current||(wi.current=ws);const Es=ze.current.getBoundingClientRect().top;if(Math.abs(zn.current-jn)>60&&(vt.current=!vt.current),s&&s.length>0&&To&&_s){const Ci=To[_s]||0;jn+=Ci}if(zn.current=jn,ws>Mt||vt.current){const Ci=ze.current.getBoundingClientRect().height;let os=Ci;Ci>Mt&&(os=Mt-(zr?Es:oM)),v?ze.current.style.height=`${Ci-Math.max(jn,0)}px`:ze.current.style.height=`${Math.max(os,Mt-Es)}px`}else fOe()||(ze.current.style.height=`${wi.current}px`);s&&s.length>0&&!vt.current?ze.current.style.bottom="0px":ze.current.style.bottom=`${Math.max(jn,0)}px`}}return(nt=window.visualViewport)==null||nt.addEventListener("resize",Dt),()=>{var Be;return(Be=window.visualViewport)==null?void 0:Be.removeEventListener("resize",Dt)}},[_s,s,To]);function qs(nt){Gr(),w?.(),nt||F(!1),setTimeout(()=>{s&&Ss(s[0])},pr.DURATION*1e3)}function Ei(){if(!ze.current)return;const nt=document.querySelector("[data-vaul-drawer-wrapper]"),Dt=Rw(ze.current,C);fi(ze.current,{transform:"translate3d(0, 0, 0)",transition:`transform ${pr.DURATION}s cubic-bezier(${pr.EASE.join(",")})`}),fi(ue.current,{transition:`opacity ${pr.DURATION}s cubic-bezier(${pr.EASE.join(",")})`,opacity:"1"}),o&&Dt&&Dt>0&&W&&fi(nt,{borderRadius:`${lse}px`,overflow:"hidden",...ti(C)?{transform:`scale(${Ro()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`,transformOrigin:"top"}:{transform:`scale(${Ro()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`,transformOrigin:"left"},transitionProperty:"transform, border-radius",transitionDuration:`${pr.DURATION}s`,transitionTimingFunction:`cubic-bezier(${pr.EASE.join(",")})`},!0)}function Gr(){!G||!ze.current||(ze.current.classList.remove(w6),ke.current=!1,Z(!1),we.current=new Date)}function Vs(nt){if(!G||!ze.current)return;ze.current.classList.remove(w6),ke.current=!1,Z(!1),we.current=new Date;const Dt=Rw(ze.current,C);if(!nt||!Kl(nt.target,!1)||!Dt||Number.isNaN(Dt)||Re.current===null)return;const Be=we.current.getTime()-Re.current.getTime(),rt=Je.current-(ti(C)?nt.pageY:nt.pageX),Mt=Math.abs(rt)/Be;if(Mt>.05&&(J(!0),setTimeout(()=>{J(!1)},200)),s){wd({draggedDistance:rt*(C==="bottom"||C==="right"?1:-1),closeDrawer:qs,velocity:Mt,dismissible:d}),i?.(nt,!0);return}if(C==="bottom"||C==="right"?rt>0:rt<0){Ei(),i?.(nt,!0);return}if(Mt>cse){qs(),i?.(nt,!1);return}var Un;const jn=Math.min((Un=ze.current.getBoundingClientRect().height)!=null?Un:0,window.innerHeight);var ws;const zr=Math.min((ws=ze.current.getBoundingClientRect().width)!=null?ws:0,window.innerWidth),Es=C==="left"||C==="right";if(Math.abs(Dt)>=(Es?zr:jn)*c){qs(),i?.(nt,!1);return}i?.(nt,!0),Ei()}xe.useEffect(()=>(W&&(fi(document.documentElement,{scrollBehavior:"auto"}),ge.current=new Date),()=>{COe(document.documentElement,"scrollBehavior")}),[W]);function li(nt){const Dt=nt?(window.innerWidth-Gh)/window.innerWidth:1,Be=nt?-Gh:0;De.current&&window.clearTimeout(De.current),fi(ze.current,{transition:`transform ${pr.DURATION}s cubic-bezier(${pr.EASE.join(",")})`,transform:ti(C)?`scale(${Dt}) translate3d(0, ${Be}px, 0)`:`scale(${Dt}) translate3d(${Be}px, 0, 0)`}),!nt&&ze.current&&(De.current=setTimeout(()=>{const rt=Rw(ze.current,C);fi(ze.current,{transition:"none",transform:ti(C)?`translate3d(0, ${rt}px, 0)`:`translate3d(${rt}px, 0, 0)`})},500))}function Cd(nt,Dt){if(Dt<0)return;const Be=(window.innerWidth-Gh)/window.innerWidth,rt=Be+Dt*(1-Be),Mt=-Gh+Dt*Gh;fi(ze.current,{transform:ti(C)?`scale(${rt}) translate3d(0, ${Mt}px, 0)`:`scale(${rt}) translate3d(${Mt}px, 0, 0)`,transition:"none"})}function ko(nt,Dt){const Be=ti(C)?window.innerHeight:window.innerWidth,rt=Dt?(Be-Gh)/Be:1,Mt=Dt?-Gh:0;Dt&&fi(ze.current,{transition:`transform ${pr.DURATION}s cubic-bezier(${pr.EASE.join(",")})`,transform:ti(C)?`scale(${rt}) translate3d(0, ${Mt}px, 0)`:`scale(${rt}) translate3d(${Mt}px, 0, 0)`})}return xe.useEffect(()=>{E||window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"})},[E]),xe.createElement(s8,{defaultOpen:k,onOpenChange:nt=>{!d&&!nt||(nt?V(!0):qs(!0),F(nt))},open:W},xe.createElement(rse.Provider,{value:{activeSnapPoint:sc,snapPoints:s,setActiveSnapPoint:Ss,drawerRef:ze,overlayRef:ue,onOpenChange:e,onPress:Yc,onRelease:Vs,onDrag:Ed,dismissible:d,shouldAnimate:Sr,handleOnly:h,isOpen:W,isDragging:G,shouldFade:oc,closeDrawer:qs,onNestedDrag:Cd,onNestedOpenChange:li,onNestedRelease:ko,keyboardIsOpen:vt,modal:E,snapPointsOffset:To,activeSnapPointIndex:_s,direction:C,shouldScaleBackground:o,setBackgroundColorOnScale:a,noBodyStyles:x,container:j,autoFocus:H}},n))}const fse=xe.forwardRef(function({...t},e){const{overlayRef:n,snapPoints:r,onRelease:i,shouldFade:s,isOpen:o,modal:a,shouldAnimate:c}=rS(),l=ose(e,n),d=r&&r.length>0;if(!a)return null;const h=xe.useCallback(m=>i(m),[i]);return xe.createElement(a8,{onMouseUp:h,ref:l,"data-vaul-overlay":"","data-vaul-snap-points":o&&d?"true":"false","data-vaul-snap-points-overlay":o&&s?"true":"false","data-vaul-animate":c?.current?"true":"false",...t})});fse.displayName="Drawer.Overlay";const hse=xe.forwardRef(function({onPointerDownOutside:t,style:e,onOpenAutoFocus:n,...r},i){const{drawerRef:s,onPress:o,onRelease:a,onDrag:c,keyboardIsOpen:l,snapPointsOffset:d,activeSnapPointIndex:h,modal:m,isOpen:g,direction:y,snapPoints:v,container:E,handleOnly:w,shouldAnimate:R,autoFocus:x}=rS(),[C,k]=xe.useState(!1),T=ose(i,s),L=xe.useRef(null),O=xe.useRef(null),P=xe.useRef(!1),D=v&&v.length>0;MOe();const j=(z,Y,W=0)=>{if(P.current)return!0;const F=Math.abs(z.y),$=Math.abs(z.x),V=$>F,G=["bottom","right"].includes(Y)?1:-1;if(Y==="left"||Y==="right"){if(!(z.x*G<0)&&$>=0&&$<=W)return V}else if(!(z.y*G<0)&&F>=0&&F<=W)return!V;return P.current=!0,!0};xe.useEffect(()=>{D&&window.requestAnimationFrame(()=>{k(!0)})},[]);function H(z){L.current=null,P.current=!1,a(z)}return xe.createElement(c8,{"data-vaul-drawer-direction":y,"data-vaul-drawer":"","data-vaul-delayed-snap-points":C?"true":"false","data-vaul-snap-points":g&&D?"true":"false","data-vaul-custom-container":E?"true":"false","data-vaul-animate":R?.current?"true":"false",...r,ref:T,style:d&&d.length>0?{"--snap-point-height":`${d[h??0]}px`,...e}:e,onPointerDown:z=>{w||(r.onPointerDown==null||r.onPointerDown.call(r,z),L.current={x:z.pageX,y:z.pageY},o(z))},onOpenAutoFocus:z=>{n?.(z),x||z.preventDefault()},onPointerDownOutside:z=>{if(t?.(z),!m||z.defaultPrevented){z.preventDefault();return}l.current&&(l.current=!1)},onFocusOutside:z=>{if(!m){z.preventDefault();return}},onPointerMove:z=>{if(O.current=z,w||(r.onPointerMove==null||r.onPointerMove.call(r,z),!L.current))return;const Y=z.pageY-L.current.y,W=z.pageX-L.current.x,F=z.pointerType==="touch"?10:2;j({x:W,y:Y},y,F)?c(z):(Math.abs(W)>F||Math.abs(Y)>F)&&(L.current=null)},onPointerUp:z=>{r.onPointerUp==null||r.onPointerUp.call(r,z),L.current=null,P.current=!1,a(z)},onPointerOut:z=>{r.onPointerOut==null||r.onPointerOut.call(r,z),H(O.current)},onContextMenu:z=>{r.onContextMenu==null||r.onContextMenu.call(r,z),O.current&&H(O.current)}})});hse.displayName="Drawer.Content";const DOe=250,NOe=120,UOe=xe.forwardRef(function({preventCycle:t=!1,children:e,...n},r){const{closeDrawer:i,isDragging:s,snapPoints:o,activeSnapPoint:a,setActiveSnapPoint:c,dismissible:l,handleOnly:d,isOpen:h,onPress:m,onDrag:g}=rS(),y=xe.useRef(null),v=xe.useRef(!1);function E(){if(v.current){x();return}window.setTimeout(()=>{w()},NOe)}function w(){if(s||t||v.current){x();return}if(x(),!o||o.length===0){l||i();return}if(a===o[o.length-1]&&l){i();return}const k=o.findIndex(L=>L===a);if(k===-1)return;const T=o[k+1];c(T)}function R(){y.current=window.setTimeout(()=>{v.current=!0},DOe)}function x(){y.current&&window.clearTimeout(y.current),v.current=!1}return xe.createElement("div",{onClick:E,onPointerCancel:x,onPointerDown:C=>{d&&m(C),R()},onPointerMove:C=>{d&&g(C)},ref:r,"data-vaul-drawer-visible":h?"true":"false","data-vaul-handle":"","aria-hidden":"true",...n},xe.createElement("span",{"data-vaul-handle-hitarea":"","aria-hidden":"true"},e))});UOe.displayName="Drawer.Handle";function jOe(t){const e=rS(),{container:n=e.container,...r}=t;return xe.createElement(o8,{container:n,...r})}const oo={Root:POe,Content:hse,Overlay:fse,Trigger:uOe,Portal:jOe,Title:l8},FOe="_bg_610zp_8",$Oe="_drawer_610zp_17",BOe="_body_610zp_51",p3={bg:FOe,drawer:$Oe,body:BOe},HOe="_content_vnv5k_8",qOe={content:HOe},d8=_.createContext(null);function f8(){const t=globalThis.navigator?.userAgent;return/android/i.test(t)?"android":/iPad|iPhone|iPod|Mac/.test(t)&&"ontouchend"in document?"ios":"other"}const h8=_.forwardRef(({title:t,children:e,className:n,...r},i)=>S.jsx("div",{ref:i,className:Le(n,p3.drawer),"aria-label":t,"data-platform":f8(),...r,role:"menu",children:S.jsx("div",{className:p3.body,children:e})}));h8.displayName="DrawerMenu";const VOe=({onSelect:t,children:e})=>S.jsx($ie,{onSelect:t??void 0,asChild:!0,children:e}),KOe=({title:t,showTitle:e=!0,onOpenChange:n,trigger:r,hasAccessibleAlternative:i,children:s})=>{const[o,a]=_.useState(!1),c=_.useCallback(y=>{a(y),n?.(y)},[a,n]),l=f8(),d=l==="android"||l==="ios",h=_.useMemo(()=>({MenuItemWrapper:d?null:VOe,onOpenChange:c}),[c]),m=S.jsx(d8.Provider,{value:h,children:s}),g=S.jsx(VMe,{"aria-haspopup":"menu",tabIndex:i?void 0:0,asChild:!0,children:r});return d?S.jsxs(S.Fragment,{children:[S.jsx(iK,{onOpenChange:c,children:g}),S.jsx(oo.Root,{open:o,onOpenChange:c,children:S.jsxs(oo.Portal,{children:[S.jsx(oo.Overlay,{className:Le(p3.bg)}),S.jsx(oo.Content,{asChild:!0,children:S.jsx(h8,{title:t,children:m})})]})})]}):S.jsxs(iK,{onOpenChange:c,children:[g,S.jsx(KMe,{children:S.jsx(GMe,{asChild:!0,className:Le(qOe.content),children:S.jsx(t8,{showTitle:e,title:t,children:m})})})]})},GOe="_glass_sepwu_8",zOe={glass:GOe},pse=_.forwardRef(({children:t,className:e,...n},r)=>S.jsx("div",{ref:r,className:Le(e,zOe.glass),...n,children:_.Children.only(t)}));pse.displayName="Glass";const Hc=({as:t="h1",children:e,...n})=>S.jsx(Lne,{as:t,type:"heading",...n,children:e}),WOe="_link_1v5rz_8",YOe={link:WOe},XOe=_.forwardRef(function({children:e,className:n,kind:r="primary",size:i="medium",...s},o){return S.jsx("a",{ref:o,...s,rel:"noreferrer noopener",className:Le(YOe.link,n),"data-kind":r,"data-size":i,children:e})});function pn(t,e,{checkForDefaultPrevented:n=!0}={}){return function(i){if(t?.(i),n===!1||!i.defaultPrevented)return e?.(i)}}function uK(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function pR(...t){return e=>{let n=!1;const r=t.map(i=>{const s=uK(i,e);return!n&&typeof s=="function"&&(n=!0),s});if(n)return()=>{for(let i=0;i<r.length;i++){const s=r[i];typeof s=="function"?s():uK(t[i],null)}}}}function Ya(...t){return _.useCallback(pR(...t),t)}function iS(t,e=[]){let n=[];function r(s,o){const a=_.createContext(o),c=n.length;n=[...n,o];const l=h=>{const{scope:m,children:g,...y}=h,v=m?.[t]?.[c]||a,E=_.useMemo(()=>y,Object.values(y));return S.jsx(v.Provider,{value:E,children:g})};l.displayName=s+"Provider";function d(h,m){const g=m?.[t]?.[c]||a,y=_.useContext(g);if(y)return y;if(o!==void 0)return o;throw new Error(`\`${h}\` must be used within \`${s}\``)}return[l,d]}const i=()=>{const s=n.map(o=>_.createContext(o));return function(a){const c=a?.[t]||s;return _.useMemo(()=>({[`__scope${t}`]:{...a,[t]:c}}),[a,c])}};return i.scopeName=t,[r,JOe(i,...e)]}function JOe(...t){const e=t[0];if(t.length===1)return e;const n=()=>{const r=t.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(s){const o=r.reduce((a,{useScope:c,scopeName:l})=>{const h=c(s)[`__scope${l}`];return{...a,...h}},{});return _.useMemo(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return n.scopeName=e.scopeName,n}function Zf(t){const e=_.useRef(t);return _.useEffect(()=>{e.current=t}),_.useMemo(()=>(...n)=>e.current?.(...n),[])}function mse({prop:t,defaultProp:e,onChange:n=()=>{}}){const[r,i]=QOe({defaultProp:e,onChange:n}),s=t!==void 0,o=s?t:r,a=Zf(n),c=_.useCallback(l=>{if(s){const h=typeof l=="function"?l(t):l;h!==t&&a(h)}else i(l)},[s,t,i,a]);return[o,c]}function QOe({defaultProp:t,onChange:e}){const n=_.useState(t),[r]=n,i=_.useRef(r),s=Zf(e);return _.useEffect(()=>{i.current!==r&&(s(r),i.current=r)},[r,i,s]),n}function dK(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function ZOe(...t){return e=>{let n=!1;const r=t.map(i=>{const s=dK(i,e);return!n&&typeof s=="function"&&(n=!0),s});if(n)return()=>{for(let i=0;i<r.length;i++){const s=r[i];typeof s=="function"?s():dK(t[i],null)}}}}var gse=_.forwardRef((t,e)=>{const{children:n,...r}=t,i=_.Children.toArray(n),s=i.find(tPe);if(s){const o=s.props.children,a=i.map(c=>c===s?_.Children.count(o)>1?_.Children.only(null):_.isValidElement(o)?o.props.children:null:c);return S.jsx(aM,{...r,ref:e,children:_.isValidElement(o)?_.cloneElement(o,void 0,a):null})}return S.jsx(aM,{...r,ref:e,children:n})});gse.displayName="Slot";var aM=_.forwardRef((t,e)=>{const{children:n,...r}=t;if(_.isValidElement(n)){const i=rPe(n);return _.cloneElement(n,{...nPe(r,n.props),ref:e?ZOe(e,i):i})}return _.Children.count(n)>1?_.Children.only(null):null});aM.displayName="SlotClone";var ePe=({children:t})=>S.jsx(S.Fragment,{children:t});function tPe(t){return _.isValidElement(t)&&t.type===ePe}function nPe(t,e){const n={...e};for(const r in e){const i=t[r],s=e[r];/^on[A-Z]/.test(r)?i&&s?n[r]=(...a)=>{s(...a),i(...a)}:i&&(n[r]=i):r==="style"?n[r]={...i,...s}:r==="className"&&(n[r]=[i,s].filter(Boolean).join(" "))}return{...t,...n}}function rPe(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var iPe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],ci=iPe.reduce((t,e)=>{const n=_.forwardRef((r,i)=>{const{asChild:s,...o}=r,a=s?gse:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),S.jsx(a,{...o,ref:i})});return n.displayName=`Primitive.${e}`,{...t,[e]:n}},{});function sPe(t,e){t&&em.flushSync(()=>t.dispatchEvent(e))}var m3=_.forwardRef((t,e)=>{const{children:n,...r}=t,i=_.Children.toArray(n),s=i.find(aPe);if(s){const o=s.props.children,a=i.map(c=>c===s?_.Children.count(o)>1?_.Children.only(null):_.isValidElement(o)?o.props.children:null:c);return S.jsx(cM,{...r,ref:e,children:_.isValidElement(o)?_.cloneElement(o,void 0,a):null})}return S.jsx(cM,{...r,ref:e,children:n})});m3.displayName="Slot";var cM=_.forwardRef((t,e)=>{const{children:n,...r}=t;if(_.isValidElement(n)){const i=lPe(n);return _.cloneElement(n,{...cPe(r,n.props),ref:e?pR(e,i):i})}return _.Children.count(n)>1?_.Children.only(null):null});cM.displayName="SlotClone";var oPe=({children:t})=>S.jsx(S.Fragment,{children:t});function aPe(t){return _.isValidElement(t)&&t.type===oPe}function cPe(t,e){const n={...e};for(const r in e){const i=t[r],s=e[r];/^on[A-Z]/.test(r)?i&&s?n[r]=(...a)=>{s(...a),i(...a)}:i&&(n[r]=i):r==="style"?n[r]={...i,...s}:r==="className"&&(n[r]=[i,s].filter(Boolean).join(" "))}return{...t,...n}}function lPe(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}function vse(t){const e=t+"CollectionProvider",[n,r]=iS(e),[i,s]=n(e,{collectionRef:{current:null},itemMap:new Map}),o=g=>{const{scope:y,children:v}=g,E=xe.useRef(null),w=xe.useRef(new Map).current;return S.jsx(i,{scope:y,itemMap:w,collectionRef:E,children:v})};o.displayName=e;const a=t+"CollectionSlot",c=xe.forwardRef((g,y)=>{const{scope:v,children:E}=g,w=s(a,v),R=Ya(y,w.collectionRef);return S.jsx(m3,{ref:R,children:E})});c.displayName=a;const l=t+"CollectionItemSlot",d="data-radix-collection-item",h=xe.forwardRef((g,y)=>{const{scope:v,children:E,...w}=g,R=xe.useRef(null),x=Ya(y,R),C=s(l,v);return xe.useEffect(()=>(C.itemMap.set(R,{ref:R,...w}),()=>{C.itemMap.delete(R)})),S.jsx(m3,{[d]:"",ref:x,children:E})});h.displayName=l;function m(g){const y=s(t+"CollectionConsumer",g);return xe.useCallback(()=>{const E=y.collectionRef.current;if(!E)return[];const w=Array.from(E.querySelectorAll(`[${d}]`));return Array.from(y.itemMap.values()).sort((C,k)=>w.indexOf(C.ref.current)-w.indexOf(k.ref.current))},[y.collectionRef,y.itemMap])}return[{Provider:o,Slot:c,ItemSlot:h},m,r]}var uPe=_.createContext(void 0);function yse(t){const e=_.useContext(uPe);return t||e||"ltr"}var E6="focusScope.autoFocusOnMount",C6="focusScope.autoFocusOnUnmount",fK={bubbles:!1,cancelable:!0},dPe="FocusScope",bse=_.forwardRef((t,e)=>{const{loop:n=!1,trapped:r=!1,onMountAutoFocus:i,onUnmountAutoFocus:s,...o}=t,[a,c]=_.useState(null),l=Zf(i),d=Zf(s),h=_.useRef(null),m=Ya(e,v=>c(v)),g=_.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;_.useEffect(()=>{if(r){let v=function(x){if(g.paused||!a)return;const C=x.target;a.contains(C)?h.current=C:af(h.current,{select:!0})},E=function(x){if(g.paused||!a)return;const C=x.relatedTarget;C!==null&&(a.contains(C)||af(h.current,{select:!0}))},w=function(x){if(document.activeElement===document.body)for(const k of x)k.removedNodes.length>0&&af(a)};document.addEventListener("focusin",v),document.addEventListener("focusout",E);const R=new MutationObserver(w);return a&&R.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",v),document.removeEventListener("focusout",E),R.disconnect()}}},[r,a,g.paused]),_.useEffect(()=>{if(a){pK.add(g);const v=document.activeElement;if(!a.contains(v)){const w=new CustomEvent(E6,fK);a.addEventListener(E6,l),a.dispatchEvent(w),w.defaultPrevented||(fPe(vPe(_se(a)),{select:!0}),document.activeElement===v&&af(a))}return()=>{a.removeEventListener(E6,l),setTimeout(()=>{const w=new CustomEvent(C6,fK);a.addEventListener(C6,d),a.dispatchEvent(w),w.defaultPrevented||af(v??document.body,{select:!0}),a.removeEventListener(C6,d),pK.remove(g)},0)}}},[a,l,d,g]);const y=_.useCallback(v=>{if(!n&&!r||g.paused)return;const E=v.key==="Tab"&&!v.altKey&&!v.ctrlKey&&!v.metaKey,w=document.activeElement;if(E&&w){const R=v.currentTarget,[x,C]=hPe(R);x&&C?!v.shiftKey&&w===C?(v.preventDefault(),n&&af(x,{select:!0})):v.shiftKey&&w===x&&(v.preventDefault(),n&&af(C,{select:!0})):w===R&&v.preventDefault()}},[n,r,g.paused]);return S.jsx(ci.div,{tabIndex:-1,...o,ref:m,onKeyDown:y})});bse.displayName=dPe;function fPe(t,{select:e=!1}={}){const n=document.activeElement;for(const r of t)if(af(r,{select:e}),document.activeElement!==n)return}function hPe(t){const e=_se(t),n=hK(e,t),r=hK(e.reverse(),t);return[n,r]}function _se(t){const e=[],n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const i=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||i?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)e.push(n.currentNode);return e}function hK(t,e){for(const n of t)if(!pPe(n,{upTo:e}))return n}function pPe(t,{upTo:e}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(e!==void 0&&t===e)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function mPe(t){return t instanceof HTMLInputElement&&"select"in t}function af(t,{select:e=!1}={}){if(t&&t.focus){const n=document.activeElement;t.focus({preventScroll:!0}),t!==n&&mPe(t)&&e&&t.select()}}var pK=gPe();function gPe(){let t=[];return{add(e){const n=t[0];e!==n&&n?.pause(),t=mK(t,e),t.unshift(e)},remove(e){t=mK(t,e),t[0]?.resume()}}}function mK(t,e){const n=[...t],r=n.indexOf(e);return r!==-1&&n.splice(r,1),n}function vPe(t){return t.filter(e=>e.tagName!=="A")}var yPe=globalThis?.document?_.useLayoutEffect:()=>{},bPe=my.useId||(()=>{}),_Pe=0;function Hv(t){const[e,n]=_.useState(bPe());return yPe(()=>{n(r=>r??String(_Pe++))},[t]),t||(e?`radix-${e}`:"")}var SPe="Arrow",Sse=_.forwardRef((t,e)=>{const{children:n,width:r=10,height:i=5,...s}=t;return S.jsx(ci.svg,{...s,ref:e,width:r,height:i,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:t.asChild?n:S.jsx("polygon",{points:"0,0 30,0 15,10"})})});Sse.displayName=SPe;var wPe=Sse,qv=globalThis?.document?_.useLayoutEffect:()=>{};function EPe(t){const[e,n]=_.useState(void 0);return qv(()=>{if(t){n({width:t.offsetWidth,height:t.offsetHeight});const r=new ResizeObserver(i=>{if(!Array.isArray(i)||!i.length)return;const s=i[0];let o,a;if("borderBoxSize"in s){const c=s.borderBoxSize,l=Array.isArray(c)?c[0]:c;o=l.inlineSize,a=l.blockSize}else o=t.offsetWidth,a=t.offsetHeight;n({width:o,height:a})});return r.observe(t,{box:"border-box"}),()=>r.unobserve(t)}else n(void 0)},[t]),e}var p8="Popper",[wse,Ese]=iS(p8),[CPe,Cse]=wse(p8),Tse=t=>{const{__scopePopper:e,children:n}=t,[r,i]=_.useState(null);return S.jsx(CPe,{scope:e,anchor:r,onAnchorChange:i,children:n})};Tse.displayName=p8;var Rse="PopperAnchor",kse=_.forwardRef((t,e)=>{const{__scopePopper:n,virtualRef:r,...i}=t,s=Cse(Rse,n),o=_.useRef(null),a=Ya(e,o);return _.useEffect(()=>{s.onAnchorChange(r?.current||o.current)}),r?null:S.jsx(ci.div,{...i,ref:a})});kse.displayName=Rse;var m8="PopperContent",[TPe,RPe]=wse(m8),Ise=_.forwardRef((t,e)=>{const{__scopePopper:n,side:r="bottom",sideOffset:i=0,align:s="center",alignOffset:o=0,arrowPadding:a=0,avoidCollisions:c=!0,collisionBoundary:l=[],collisionPadding:d=0,sticky:h="partial",hideWhenDetached:m=!1,updatePositionStrategy:g="optimized",onPlaced:y,...v}=t,E=Cse(m8,n),[w,R]=_.useState(null),x=Ya(e,de=>R(de)),[C,k]=_.useState(null),T=EPe(C),L=T?.width??0,O=T?.height??0,P=r+(s!=="center"?"-"+s:""),D=typeof d=="number"?d:{top:0,right:0,bottom:0,left:0,...d},j=Array.isArray(l)?l:[l],H=j.length>0,z={padding:D,boundary:j.filter(IPe),altBoundary:H},{refs:Y,floatingStyles:W,placement:F,isPositioned:$,middlewareData:V}=R7({strategy:"fixed",placement:P,whileElementsMounted:(...de)=>T7(...de,{animationFrame:g==="always"}),elements:{reference:E.anchor},middleware:[k7({mainAxis:i+O,alignmentAxis:o}),c&&I7({mainAxis:!0,crossAxis:!1,limiter:h==="partial"?Qne():void 0,...z}),c&&x7({...z}),Zne({...z,apply:({elements:de,rects:ke,availableWidth:De,availableHeight:Je})=>{const{width:vt,height:Sr}=ke.reference,zn=de.floating.style;zn.setProperty("--radix-popper-available-width",`${De}px`),zn.setProperty("--radix-popper-available-height",`${Je}px`),zn.setProperty("--radix-popper-anchor-width",`${vt}px`),zn.setProperty("--radix-popper-anchor-height",`${Sr}px`)}}),C&&A7({element:C,padding:a}),xPe({arrowWidth:L,arrowHeight:O}),m&&ere({strategy:"referenceHidden",...z})]}),[G,Z]=Lse(F),q=Zf(y);qv(()=>{$&&q?.()},[$,q]);const J=V.arrow?.x,ue=V.arrow?.y,ge=V.arrow?.centerOffset!==0,[Re,we]=_.useState();return qv(()=>{w&&we(window.getComputedStyle(w).zIndex)},[w]),S.jsx("div",{ref:Y.setFloating,"data-radix-popper-content-wrapper":"",style:{...W,transform:$?W.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Re,"--radix-popper-transform-origin":[V.transformOrigin?.x,V.transformOrigin?.y].join(" "),...V.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:t.dir,children:S.jsx(TPe,{scope:n,placedSide:G,onArrowChange:k,arrowX:J,arrowY:ue,shouldHideArrow:ge,children:S.jsx(ci.div,{"data-side":G,"data-align":Z,...v,ref:x,style:{...v.style,animation:$?void 0:"none"}})})})});Ise.displayName=m8;var xse="PopperArrow",kPe={top:"bottom",right:"left",bottom:"top",left:"right"},Ase=_.forwardRef(function(e,n){const{__scopePopper:r,...i}=e,s=RPe(xse,r),o=kPe[s.placedSide];return S.jsx("span",{ref:s.onArrowChange,style:{position:"absolute",left:s.arrowX,top:s.arrowY,[o]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[s.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[s.placedSide],visibility:s.shouldHideArrow?"hidden":void 0},children:S.jsx(wPe,{...i,ref:n,style:{...i.style,display:"block"}})})});Ase.displayName=xse;function IPe(t){return t!==null}var xPe=t=>({name:"transformOrigin",options:t,fn(e){const{placement:n,rects:r,middlewareData:i}=e,o=i.arrow?.centerOffset!==0,a=o?0:t.arrowWidth,c=o?0:t.arrowHeight,[l,d]=Lse(n),h={start:"0%",center:"50%",end:"100%"}[d],m=(i.arrow?.x??0)+a/2,g=(i.arrow?.y??0)+c/2;let y="",v="";return l==="bottom"?(y=o?h:`${m}px`,v=`${-c}px`):l==="top"?(y=o?h:`${m}px`,v=`${r.floating.height+c}px`):l==="right"?(y=`${-c}px`,v=o?h:`${g}px`):l==="left"&&(y=`${r.floating.width+c}px`,v=o?h:`${g}px`),{data:{x:y,y:v}}}});function Lse(t){const[e,n="center"]=t.split("-");return[e,n]}var APe=Tse,LPe=kse,MPe=Ise,OPe=Ase,PPe="Portal",Mse=_.forwardRef((t,e)=>{const{container:n,...r}=t,[i,s]=_.useState(!1);qv(()=>s(!0),[]);const o=n||i&&globalThis?.document?.body;return o?nte.createPortal(S.jsx(ci.div,{...r,ref:e}),o):null});Mse.displayName=PPe;function DPe(t,e){return _.useReducer((n,r)=>e[n][r]??n,t)}var sS=t=>{const{present:e,children:n}=t,r=NPe(e),i=typeof n=="function"?n({present:r.isPresent}):_.Children.only(n),s=Ya(r.ref,UPe(i));return typeof n=="function"||r.isPresent?_.cloneElement(i,{ref:s}):null};sS.displayName="Presence";function NPe(t){const[e,n]=_.useState(),r=_.useRef({}),i=_.useRef(t),s=_.useRef("none"),o=t?"mounted":"unmounted",[a,c]=DPe(o,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return _.useEffect(()=>{const l=kw(r.current);s.current=a==="mounted"?l:"none"},[a]),qv(()=>{const l=r.current,d=i.current;if(d!==t){const m=s.current,g=kw(l);t?c("MOUNT"):g==="none"||l?.display==="none"?c("UNMOUNT"):c(d&&m!==g?"ANIMATION_OUT":"UNMOUNT"),i.current=t}},[t,c]),qv(()=>{if(e){let l;const d=e.ownerDocument.defaultView??window,h=g=>{const v=kw(r.current).includes(g.animationName);if(g.target===e&&v&&(c("ANIMATION_END"),!i.current)){const E=e.style.animationFillMode;e.style.animationFillMode="forwards",l=d.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=E)})}},m=g=>{g.target===e&&(s.current=kw(r.current))};return e.addEventListener("animationstart",m),e.addEventListener("animationcancel",h),e.addEventListener("animationend",h),()=>{d.clearTimeout(l),e.removeEventListener("animationstart",m),e.removeEventListener("animationcancel",h),e.removeEventListener("animationend",h)}}else c("ANIMATION_END")},[e,c]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:_.useCallback(l=>{l&&(r.current=getComputedStyle(l)),n(l)},[])}}function kw(t){return t?.animationName||"none"}function UPe(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var T6="rovingFocusGroup.onEntryFocus",jPe={bubbles:!1,cancelable:!0},mR="RovingFocusGroup",[lM,Ose,FPe]=vse(mR),[$Pe,Pse]=iS(mR,[FPe]),[BPe,HPe]=$Pe(mR),Dse=_.forwardRef((t,e)=>S.jsx(lM.Provider,{scope:t.__scopeRovingFocusGroup,children:S.jsx(lM.Slot,{scope:t.__scopeRovingFocusGroup,children:S.jsx(qPe,{...t,ref:e})})}));Dse.displayName=mR;var qPe=_.forwardRef((t,e)=>{const{__scopeRovingFocusGroup:n,orientation:r,loop:i=!1,dir:s,currentTabStopId:o,defaultCurrentTabStopId:a,onCurrentTabStopIdChange:c,onEntryFocus:l,preventScrollOnEntryFocus:d=!1,...h}=t,m=_.useRef(null),g=Ya(e,m),y=yse(s),[v=null,E]=mse({prop:o,defaultProp:a,onChange:c}),[w,R]=_.useState(!1),x=Zf(l),C=Ose(n),k=_.useRef(!1),[T,L]=_.useState(0);return _.useEffect(()=>{const O=m.current;if(O)return O.addEventListener(T6,x),()=>O.removeEventListener(T6,x)},[x]),S.jsx(BPe,{scope:n,orientation:r,dir:y,loop:i,currentTabStopId:v,onItemFocus:_.useCallback(O=>E(O),[E]),onItemShiftTab:_.useCallback(()=>R(!0),[]),onFocusableItemAdd:_.useCallback(()=>L(O=>O+1),[]),onFocusableItemRemove:_.useCallback(()=>L(O=>O-1),[]),children:S.jsx(ci.div,{tabIndex:w||T===0?-1:0,"data-orientation":r,...h,ref:g,style:{outline:"none",...t.style},onMouseDown:pn(t.onMouseDown,()=>{k.current=!0}),onFocus:pn(t.onFocus,O=>{const P=!k.current;if(O.target===O.currentTarget&&P&&!w){const D=new CustomEvent(T6,jPe);if(O.currentTarget.dispatchEvent(D),!D.defaultPrevented){const j=C().filter(F=>F.focusable),H=j.find(F=>F.active),z=j.find(F=>F.id===v),W=[H,z,...j].filter(Boolean).map(F=>F.ref.current);jse(W,d)}}k.current=!1}),onBlur:pn(t.onBlur,()=>R(!1))})})}),Nse="RovingFocusGroupItem",Use=_.forwardRef((t,e)=>{const{__scopeRovingFocusGroup:n,focusable:r=!0,active:i=!1,tabStopId:s,...o}=t,a=Hv(),c=s||a,l=HPe(Nse,n),d=l.currentTabStopId===c,h=Ose(n),{onFocusableItemAdd:m,onFocusableItemRemove:g}=l;return _.useEffect(()=>{if(r)return m(),()=>g()},[r,m,g]),S.jsx(lM.ItemSlot,{scope:n,id:c,focusable:r,active:i,children:S.jsx(ci.span,{tabIndex:d?0:-1,"data-orientation":l.orientation,...o,ref:e,onMouseDown:pn(t.onMouseDown,y=>{r?l.onItemFocus(c):y.preventDefault()}),onFocus:pn(t.onFocus,()=>l.onItemFocus(c)),onKeyDown:pn(t.onKeyDown,y=>{if(y.key==="Tab"&&y.shiftKey){l.onItemShiftTab();return}if(y.target!==y.currentTarget)return;const v=GPe(y,l.orientation,l.dir);if(v!==void 0){if(y.metaKey||y.ctrlKey||y.altKey||y.shiftKey)return;y.preventDefault();let w=h().filter(R=>R.focusable).map(R=>R.ref.current);if(v==="last")w.reverse();else if(v==="prev"||v==="next"){v==="prev"&&w.reverse();const R=w.indexOf(y.currentTarget);w=l.loop?zPe(w,R+1):w.slice(R+1)}setTimeout(()=>jse(w))}})})})});Use.displayName=Nse;var VPe={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function KPe(t,e){return e!=="rtl"?t:t==="ArrowLeft"?"ArrowRight":t==="ArrowRight"?"ArrowLeft":t}function GPe(t,e,n){const r=KPe(t.key,n);if(!(e==="vertical"&&["ArrowLeft","ArrowRight"].includes(r))&&!(e==="horizontal"&&["ArrowUp","ArrowDown"].includes(r)))return VPe[r]}function jse(t,e=!1){const n=document.activeElement;for(const r of t)if(r===n||(r.focus({preventScroll:e}),document.activeElement!==n))return}function zPe(t,e){return t.map((n,r)=>t[(e+r)%t.length])}var WPe=Dse,YPe=Use,Fse=nie(),R6=function(){},gR=_.forwardRef(function(t,e){var n=_.useRef(null),r=_.useState({onScrollCapture:R6,onWheelCapture:R6,onTouchMoveCapture:R6}),i=r[0],s=r[1],o=t.forwardProps,a=t.children,c=t.className,l=t.removeScrollBar,d=t.enabled,h=t.shards,m=t.sideCar,g=t.noIsolation,y=t.inert,v=t.allowPinchZoom,E=t.as,w=E===void 0?"div":E,R=t.gapMode,x=Z_(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),C=m,k=tie([n,e]),T=Ui(Ui({},x),i);return _.createElement(_.Fragment,null,d&&_.createElement(C,{sideCar:Fse,removeScrollBar:l,shards:h,noIsolation:g,inert:y,setCallbacks:s,allowPinchZoom:!!v,lockRef:n,gapMode:R}),o?_.cloneElement(_.Children.only(a),Ui(Ui({},T),{ref:k})):_.createElement(w,Ui({},T,{className:c,ref:k}),a))});gR.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};gR.classNames={fullWidth:nb,zeroRight:tb};var uM=!1;if(typeof window<"u")try{var Iw=Object.defineProperty({},"passive",{get:function(){return uM=!0,!0}});window.addEventListener("test",Iw,Iw),window.removeEventListener("test",Iw,Iw)}catch{uM=!1}var vg=uM?{passive:!1}:!1,XPe=function(t){return t.tagName==="TEXTAREA"},$se=function(t,e){if(!(t instanceof Element))return!1;var n=window.getComputedStyle(t);return n[e]!=="hidden"&&!(n.overflowY===n.overflowX&&!XPe(t)&&n[e]==="visible")},JPe=function(t){return $se(t,"overflowY")},QPe=function(t){return $se(t,"overflowX")},gK=function(t,e){var n=e.ownerDocument,r=e;do{typeof ShadowRoot<"u"&&r instanceof ShadowRoot&&(r=r.host);var i=Bse(t,r);if(i){var s=Hse(t,r),o=s[1],a=s[2];if(o>a)return!0}r=r.parentNode}while(r&&r!==n.body);return!1},ZPe=function(t){var e=t.scrollTop,n=t.scrollHeight,r=t.clientHeight;return[e,n,r]},e7e=function(t){var e=t.scrollLeft,n=t.scrollWidth,r=t.clientWidth;return[e,n,r]},Bse=function(t,e){return t==="v"?JPe(e):QPe(e)},Hse=function(t,e){return t==="v"?ZPe(e):e7e(e)},t7e=function(t,e){return t==="h"&&e==="rtl"?-1:1},n7e=function(t,e,n,r,i){var s=t7e(t,window.getComputedStyle(e).direction),o=s*r,a=n.target,c=e.contains(a),l=!1,d=o>0,h=0,m=0;do{var g=Hse(t,a),y=g[0],v=g[1],E=g[2],w=v-E-s*y;(y||w)&&Bse(t,a)&&(h+=w,m+=y),a instanceof ShadowRoot?a=a.host:a=a.parentNode}while(!c&&a!==document.body||c&&(e.contains(a)||e===a));return(d&&Math.abs(h)<1||!d&&Math.abs(m)<1)&&(l=!0),l},xw=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},vK=function(t){return[t.deltaX,t.deltaY]},yK=function(t){return t&&"current"in t?t.current:t},r7e=function(t,e){return t[0]===e[0]&&t[1]===e[1]},i7e=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},s7e=0,yg=[];function o7e(t){var e=_.useRef([]),n=_.useRef([0,0]),r=_.useRef(),i=_.useState(s7e++)[0],s=_.useState(K7)[0],o=_.useRef(t);_.useEffect(function(){o.current=t},[t]),_.useEffect(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(i));var v=ia([t.lockRef.current],(t.shards||[]).map(yK),!0).filter(Boolean);return v.forEach(function(E){return E.classList.add("allow-interactivity-".concat(i))}),function(){document.body.classList.remove("block-interactivity-".concat(i)),v.forEach(function(E){return E.classList.remove("allow-interactivity-".concat(i))})}}},[t.inert,t.lockRef.current,t.shards]);var a=_.useCallback(function(v,E){if("touches"in v&&v.touches.length===2||v.type==="wheel"&&v.ctrlKey)return!o.current.allowPinchZoom;var w=xw(v),R=n.current,x="deltaX"in v?v.deltaX:R[0]-w[0],C="deltaY"in v?v.deltaY:R[1]-w[1],k,T=v.target,L=Math.abs(x)>Math.abs(C)?"h":"v";if("touches"in v&&L==="h"&&T.type==="range")return!1;var O=gK(L,T);if(!O)return!0;if(O?k=L:(k=L==="v"?"h":"v",O=gK(L,T)),!O)return!1;if(!r.current&&"changedTouches"in v&&(x||C)&&(r.current=k),!k)return!0;var P=r.current||k;return n7e(P,E,v,P==="h"?x:C)},[]),c=_.useCallback(function(v){var E=v;if(!(!yg.length||yg[yg.length-1]!==s)){var w="deltaY"in E?vK(E):xw(E),R=e.current.filter(function(k){return k.name===E.type&&(k.target===E.target||E.target===k.shadowParent)&&r7e(k.delta,w)})[0];if(R&&R.should){E.cancelable&&E.preventDefault();return}if(!R){var x=(o.current.shards||[]).map(yK).filter(Boolean).filter(function(k){return k.contains(E.target)}),C=x.length>0?a(E,x[0]):!o.current.noIsolation;C&&E.cancelable&&E.preventDefault()}}},[]),l=_.useCallback(function(v,E,w,R){var x={name:v,delta:E,target:w,should:R,shadowParent:a7e(w)};e.current.push(x),setTimeout(function(){e.current=e.current.filter(function(C){return C!==x})},1)},[]),d=_.useCallback(function(v){n.current=xw(v),r.current=void 0},[]),h=_.useCallback(function(v){l(v.type,vK(v),v.target,a(v,t.lockRef.current))},[]),m=_.useCallback(function(v){l(v.type,xw(v),v.target,a(v,t.lockRef.current))},[]);_.useEffect(function(){return yg.push(s),t.setCallbacks({onScrollCapture:h,onWheelCapture:h,onTouchMoveCapture:m}),document.addEventListener("wheel",c,vg),document.addEventListener("touchmove",c,vg),document.addEventListener("touchstart",d,vg),function(){yg=yg.filter(function(v){return v!==s}),document.removeEventListener("wheel",c,vg),document.removeEventListener("touchmove",c,vg),document.removeEventListener("touchstart",d,vg)}},[]);var g=t.removeScrollBar,y=t.inert;return _.createElement(_.Fragment,null,y?_.createElement(s,{styles:i7e(i)}):null,g?_.createElement(oie,{gapMode:t.gapMode}):null)}function a7e(t){for(var e=null;t!==null;)t instanceof ShadowRoot&&(e=t.host,t=t.host),t=t.parentNode;return e}const c7e=iie(Fse,o7e);var qse=_.forwardRef(function(t,e){return _.createElement(gR,Ui({},t,{ref:e,sideCar:c7e}))});qse.classNames=gR.classNames;var dM=["Enter"," "],l7e=["ArrowDown","PageUp","Home"],Vse=["ArrowUp","PageDown","End"],u7e=[...l7e,...Vse],d7e={ltr:[...dM,"ArrowRight"],rtl:[...dM,"ArrowLeft"]},f7e={ltr:["ArrowLeft"],rtl:["ArrowRight"]},oS="Menu",[t_,h7e,p7e]=vse(oS),[cm,Kse]=iS(oS,[p7e,Ese,Pse]),vR=Ese(),Gse=Pse(),[m7e,lm]=cm(oS),[g7e,aS]=cm(oS),zse=t=>{const{__scopeMenu:e,open:n=!1,children:r,dir:i,onOpenChange:s,modal:o=!0}=t,a=vR(e),[c,l]=_.useState(null),d=_.useRef(!1),h=Zf(s),m=yse(i);return _.useEffect(()=>{const g=()=>{d.current=!0,document.addEventListener("pointerdown",y,{capture:!0,once:!0}),document.addEventListener("pointermove",y,{capture:!0,once:!0})},y=()=>d.current=!1;return document.addEventListener("keydown",g,{capture:!0}),()=>{document.removeEventListener("keydown",g,{capture:!0}),document.removeEventListener("pointerdown",y,{capture:!0}),document.removeEventListener("pointermove",y,{capture:!0})}},[]),S.jsx(APe,{...a,children:S.jsx(m7e,{scope:e,open:n,onOpenChange:h,content:c,onContentChange:l,children:S.jsx(g7e,{scope:e,onClose:_.useCallback(()=>h(!1),[h]),isUsingKeyboardRef:d,dir:m,modal:o,children:r})})})};zse.displayName=oS;var v7e="MenuAnchor",g8=_.forwardRef((t,e)=>{const{__scopeMenu:n,...r}=t,i=vR(n);return S.jsx(LPe,{...i,...r,ref:e})});g8.displayName=v7e;var v8="MenuPortal",[y7e,Wse]=cm(v8,{forceMount:void 0}),Yse=t=>{const{__scopeMenu:e,forceMount:n,children:r,container:i}=t,s=lm(v8,e);return S.jsx(y7e,{scope:e,forceMount:n,children:S.jsx(sS,{present:n||s.open,children:S.jsx(Mse,{asChild:!0,container:i,children:r})})})};Yse.displayName=v8;var Va="MenuContent",[b7e,y8]=cm(Va),Xse=_.forwardRef((t,e)=>{const n=Wse(Va,t.__scopeMenu),{forceMount:r=n.forceMount,...i}=t,s=lm(Va,t.__scopeMenu),o=aS(Va,t.__scopeMenu);return S.jsx(t_.Provider,{scope:t.__scopeMenu,children:S.jsx(sS,{present:r||s.open,children:S.jsx(t_.Slot,{scope:t.__scopeMenu,children:o.modal?S.jsx(_7e,{...i,ref:e}):S.jsx(S7e,{...i,ref:e})})})})}),_7e=_.forwardRef((t,e)=>{const n=lm(Va,t.__scopeMenu),r=_.useRef(null),i=Ya(e,r);return _.useEffect(()=>{const s=r.current;if(s)return B7(s)},[]),S.jsx(b8,{...t,ref:i,trapFocus:n.open,disableOutsidePointerEvents:n.open,disableOutsideScroll:!0,onFocusOutside:pn(t.onFocusOutside,s=>s.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>n.onOpenChange(!1)})}),S7e=_.forwardRef((t,e)=>{const n=lm(Va,t.__scopeMenu);return S.jsx(b8,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>n.onOpenChange(!1)})}),b8=_.forwardRef((t,e)=>{const{__scopeMenu:n,loop:r=!1,trapFocus:i,onOpenAutoFocus:s,onCloseAutoFocus:o,disableOutsidePointerEvents:a,onEntryFocus:c,onEscapeKeyDown:l,onPointerDownOutside:d,onFocusOutside:h,onInteractOutside:m,onDismiss:g,disableOutsideScroll:y,...v}=t,E=lm(Va,n),w=aS(Va,n),R=vR(n),x=Gse(n),C=h7e(n),[k,T]=_.useState(null),L=_.useRef(null),O=Ya(e,L,E.onContentChange),P=_.useRef(0),D=_.useRef(""),j=_.useRef(0),H=_.useRef(null),z=_.useRef("right"),Y=_.useRef(0),W=y?qse:_.Fragment,F=y?{as:m3,allowPinchZoom:!0}:void 0,$=G=>{const Z=D.current+G,q=C().filter(de=>!de.disabled),J=document.activeElement,ue=q.find(de=>de.ref.current===J)?.textValue,ge=q.map(de=>de.textValue),Re=O7e(ge,Z,ue),we=q.find(de=>de.textValue===Re)?.ref.current;(function de(ke){D.current=ke,window.clearTimeout(P.current),ke!==""&&(P.current=window.setTimeout(()=>de(""),1e3))})(Z),we&&setTimeout(()=>we.focus())};_.useEffect(()=>()=>window.clearTimeout(P.current),[]),D7();const V=_.useCallback(G=>z.current===H.current?.side&&D7e(G,H.current?.area),[]);return S.jsx(b7e,{scope:n,searchRef:D,onItemEnter:_.useCallback(G=>{V(G)&&G.preventDefault()},[V]),onItemLeave:_.useCallback(G=>{V(G)||(L.current?.focus(),T(null))},[V]),onTriggerLeave:_.useCallback(G=>{V(G)&&G.preventDefault()},[V]),pointerGraceTimerRef:j,onPointerGraceIntentChange:_.useCallback(G=>{H.current=G},[]),children:S.jsx(W,{...F,children:S.jsx(bse,{asChild:!0,trapped:i,onMountAutoFocus:pn(s,G=>{G.preventDefault(),L.current?.focus({preventScroll:!0})}),onUnmountAutoFocus:o,children:S.jsx(aR,{asChild:!0,disableOutsidePointerEvents:a,onEscapeKeyDown:l,onPointerDownOutside:d,onFocusOutside:h,onInteractOutside:m,onDismiss:g,children:S.jsx(WPe,{asChild:!0,...x,dir:w.dir,orientation:"vertical",loop:r,currentTabStopId:k,onCurrentTabStopIdChange:T,onEntryFocus:pn(c,G=>{w.isUsingKeyboardRef.current||G.preventDefault()}),preventScrollOnEntryFocus:!0,children:S.jsx(MPe,{role:"menu","aria-orientation":"vertical","data-state":foe(E.open),"data-radix-menu-content":"",dir:w.dir,...R,...v,ref:O,style:{outline:"none",...v.style},onKeyDown:pn(v.onKeyDown,G=>{const q=G.target.closest("[data-radix-menu-content]")===G.currentTarget,J=G.ctrlKey||G.altKey||G.metaKey,ue=G.key.length===1;q&&(G.key==="Tab"&&G.preventDefault(),!J&&ue&&$(G.key));const ge=L.current;if(G.target!==ge||!u7e.includes(G.key))return;G.preventDefault();const we=C().filter(de=>!de.disabled).map(de=>de.ref.current);Vse.includes(G.key)&&we.reverse(),L7e(we)}),onBlur:pn(t.onBlur,G=>{G.currentTarget.contains(G.target)||(window.clearTimeout(P.current),D.current="")}),onPointerMove:pn(t.onPointerMove,n_(G=>{const Z=G.target,q=Y.current!==G.clientX;if(G.currentTarget.contains(Z)&&q){const J=G.clientX>Y.current?"right":"left";z.current=J,Y.current=G.clientX}}))})})})})})})});Xse.displayName=Va;var w7e="MenuGroup",_8=_.forwardRef((t,e)=>{const{__scopeMenu:n,...r}=t;return S.jsx(ci.div,{role:"group",...r,ref:e})});_8.displayName=w7e;var E7e="MenuLabel",Jse=_.forwardRef((t,e)=>{const{__scopeMenu:n,...r}=t;return S.jsx(ci.div,{...r,ref:e})});Jse.displayName=E7e;var g3="MenuItem",bK="menu.itemSelect",yR=_.forwardRef((t,e)=>{const{disabled:n=!1,onSelect:r,...i}=t,s=_.useRef(null),o=aS(g3,t.__scopeMenu),a=y8(g3,t.__scopeMenu),c=Ya(e,s),l=_.useRef(!1),d=()=>{const h=s.current;if(!n&&h){const m=new CustomEvent(bK,{bubbles:!0,cancelable:!0});h.addEventListener(bK,g=>r?.(g),{once:!0}),sPe(h,m),m.defaultPrevented?l.current=!1:o.onClose()}};return S.jsx(Qse,{...i,ref:c,disabled:n,onClick:pn(t.onClick,d),onPointerDown:h=>{t.onPointerDown?.(h),l.current=!0},onPointerUp:pn(t.onPointerUp,h=>{l.current||h.currentTarget?.click()}),onKeyDown:pn(t.onKeyDown,h=>{const m=a.searchRef.current!=="";n||m&&h.key===" "||dM.includes(h.key)&&(h.currentTarget.click(),h.preventDefault())})})});yR.displayName=g3;var Qse=_.forwardRef((t,e)=>{const{__scopeMenu:n,disabled:r=!1,textValue:i,...s}=t,o=y8(g3,n),a=Gse(n),c=_.useRef(null),l=Ya(e,c),[d,h]=_.useState(!1),[m,g]=_.useState("");return _.useEffect(()=>{const y=c.current;y&&g((y.textContent??"").trim())},[s.children]),S.jsx(t_.ItemSlot,{scope:n,disabled:r,textValue:i??m,children:S.jsx(YPe,{asChild:!0,...a,focusable:!r,children:S.jsx(ci.div,{role:"menuitem","data-highlighted":d?"":void 0,"aria-disabled":r||void 0,"data-disabled":r?"":void 0,...s,ref:l,onPointerMove:pn(t.onPointerMove,n_(y=>{r?o.onItemLeave(y):(o.onItemEnter(y),y.defaultPrevented||y.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:pn(t.onPointerLeave,n_(y=>o.onItemLeave(y))),onFocus:pn(t.onFocus,()=>h(!0)),onBlur:pn(t.onBlur,()=>h(!1))})})})}),C7e="MenuCheckboxItem",Zse=_.forwardRef((t,e)=>{const{checked:n=!1,onCheckedChange:r,...i}=t;return S.jsx(ioe,{scope:t.__scopeMenu,checked:n,children:S.jsx(yR,{role:"menuitemcheckbox","aria-checked":v3(n)?"mixed":n,...i,ref:e,"data-state":w8(n),onSelect:pn(i.onSelect,()=>r?.(v3(n)?!0:!n),{checkForDefaultPrevented:!1})})})});Zse.displayName=C7e;var eoe="MenuRadioGroup",[T7e,R7e]=cm(eoe,{value:void 0,onValueChange:()=>{}}),toe=_.forwardRef((t,e)=>{const{value:n,onValueChange:r,...i}=t,s=Zf(r);return S.jsx(T7e,{scope:t.__scopeMenu,value:n,onValueChange:s,children:S.jsx(_8,{...i,ref:e})})});toe.displayName=eoe;var noe="MenuRadioItem",roe=_.forwardRef((t,e)=>{const{value:n,...r}=t,i=R7e(noe,t.__scopeMenu),s=n===i.value;return S.jsx(ioe,{scope:t.__scopeMenu,checked:s,children:S.jsx(yR,{role:"menuitemradio","aria-checked":s,...r,ref:e,"data-state":w8(s),onSelect:pn(r.onSelect,()=>i.onValueChange?.(n),{checkForDefaultPrevented:!1})})})});roe.displayName=noe;var S8="MenuItemIndicator",[ioe,k7e]=cm(S8,{checked:!1}),soe=_.forwardRef((t,e)=>{const{__scopeMenu:n,forceMount:r,...i}=t,s=k7e(S8,n);return S.jsx(sS,{present:r||v3(s.checked)||s.checked===!0,children:S.jsx(ci.span,{...i,ref:e,"data-state":w8(s.checked)})})});soe.displayName=S8;var I7e="MenuSeparator",ooe=_.forwardRef((t,e)=>{const{__scopeMenu:n,...r}=t;return S.jsx(ci.div,{role:"separator","aria-orientation":"horizontal",...r,ref:e})});ooe.displayName=I7e;var x7e="MenuArrow",aoe=_.forwardRef((t,e)=>{const{__scopeMenu:n,...r}=t,i=vR(n);return S.jsx(OPe,{...i,...r,ref:e})});aoe.displayName=x7e;var A7e="MenuSub",[Yot,coe]=cm(A7e),M1="MenuSubTrigger",loe=_.forwardRef((t,e)=>{const n=lm(M1,t.__scopeMenu),r=aS(M1,t.__scopeMenu),i=coe(M1,t.__scopeMenu),s=y8(M1,t.__scopeMenu),o=_.useRef(null),{pointerGraceTimerRef:a,onPointerGraceIntentChange:c}=s,l={__scopeMenu:t.__scopeMenu},d=_.useCallback(()=>{o.current&&window.clearTimeout(o.current),o.current=null},[]);return _.useEffect(()=>d,[d]),_.useEffect(()=>{const h=a.current;return()=>{window.clearTimeout(h),c(null)}},[a,c]),S.jsx(g8,{asChild:!0,...l,children:S.jsx(Qse,{id:i.triggerId,"aria-haspopup":"menu","aria-expanded":n.open,"aria-controls":i.contentId,"data-state":foe(n.open),...t,ref:pR(e,i.onTriggerChange),onClick:h=>{t.onClick?.(h),!(t.disabled||h.defaultPrevented)&&(h.currentTarget.focus(),n.open||n.onOpenChange(!0))},onPointerMove:pn(t.onPointerMove,n_(h=>{s.onItemEnter(h),!h.defaultPrevented&&!t.disabled&&!n.open&&!o.current&&(s.onPointerGraceIntentChange(null),o.current=window.setTimeout(()=>{n.onOpenChange(!0),d()},100))})),onPointerLeave:pn(t.onPointerLeave,n_(h=>{d();const m=n.content?.getBoundingClientRect();if(m){const g=n.content?.dataset.side,y=g==="right",v=y?-5:5,E=m[y?"left":"right"],w=m[y?"right":"left"];s.onPointerGraceIntentChange({area:[{x:h.clientX+v,y:h.clientY},{x:E,y:m.top},{x:w,y:m.top},{x:w,y:m.bottom},{x:E,y:m.bottom}],side:g}),window.clearTimeout(a.current),a.current=window.setTimeout(()=>s.onPointerGraceIntentChange(null),300)}else{if(s.onTriggerLeave(h),h.defaultPrevented)return;s.onPointerGraceIntentChange(null)}})),onKeyDown:pn(t.onKeyDown,h=>{const m=s.searchRef.current!=="";t.disabled||m&&h.key===" "||d7e[r.dir].includes(h.key)&&(n.onOpenChange(!0),n.content?.focus(),h.preventDefault())})})})});loe.displayName=M1;var uoe="MenuSubContent",doe=_.forwardRef((t,e)=>{const n=Wse(Va,t.__scopeMenu),{forceMount:r=n.forceMount,...i}=t,s=lm(Va,t.__scopeMenu),o=aS(Va,t.__scopeMenu),a=coe(uoe,t.__scopeMenu),c=_.useRef(null),l=Ya(e,c);return S.jsx(t_.Provider,{scope:t.__scopeMenu,children:S.jsx(sS,{present:r||s.open,children:S.jsx(t_.Slot,{scope:t.__scopeMenu,children:S.jsx(b8,{id:a.contentId,"aria-labelledby":a.triggerId,...i,ref:l,align:"start",side:o.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:d=>{o.isUsingKeyboardRef.current&&c.current?.focus(),d.preventDefault()},onCloseAutoFocus:d=>d.preventDefault(),onFocusOutside:pn(t.onFocusOutside,d=>{d.target!==a.trigger&&s.onOpenChange(!1)}),onEscapeKeyDown:pn(t.onEscapeKeyDown,d=>{o.onClose(),d.preventDefault()}),onKeyDown:pn(t.onKeyDown,d=>{const h=d.currentTarget.contains(d.target),m=f7e[o.dir].includes(d.key);h&&m&&(s.onOpenChange(!1),a.trigger?.focus(),d.preventDefault())})})})})})});doe.displayName=uoe;function foe(t){return t?"open":"closed"}function v3(t){return t==="indeterminate"}function w8(t){return v3(t)?"indeterminate":t?"checked":"unchecked"}function L7e(t){const e=document.activeElement;for(const n of t)if(n===e||(n.focus(),document.activeElement!==e))return}function M7e(t,e){return t.map((n,r)=>t[(e+r)%t.length])}function O7e(t,e,n){const i=e.length>1&&Array.from(e).every(l=>l===e[0])?e[0]:e,s=n?t.indexOf(n):-1;let o=M7e(t,Math.max(s,0));i.length===1&&(o=o.filter(l=>l!==n));const c=o.find(l=>l.toLowerCase().startsWith(i.toLowerCase()));return c!==n?c:void 0}function P7e(t,e){const{x:n,y:r}=t;let i=!1;for(let s=0,o=e.length-1;s<e.length;o=s++){const a=e[s].x,c=e[s].y,l=e[o].x,d=e[o].y;c>r!=d>r&&n<(l-a)*(r-c)/(d-c)+a&&(i=!i)}return i}function D7e(t,e){if(!e)return!1;const n={x:t.clientX,y:t.clientY};return P7e(n,e)}function n_(t){return e=>e.pointerType==="mouse"?t(e):void 0}var N7e=zse,U7e=g8,j7e=Yse,F7e=Xse,$7e=_8,B7e=Jse,H7e=yR,q7e=Zse,V7e=toe,K7e=roe,G7e=soe,z7e=ooe,W7e=aoe,Y7e=loe,X7e=doe,E8="DropdownMenu",[J7e,Xot]=iS(E8,[Kse]),$s=Kse(),[Q7e,hoe]=J7e(E8),poe=t=>{const{__scopeDropdownMenu:e,children:n,dir:r,open:i,defaultOpen:s,onOpenChange:o,modal:a=!0}=t,c=$s(e),l=_.useRef(null),[d=!1,h]=mse({prop:i,defaultProp:s,onChange:o});return S.jsx(Q7e,{scope:e,triggerId:Hv(),triggerRef:l,contentId:Hv(),open:d,onOpenChange:h,onOpenToggle:_.useCallback(()=>h(m=>!m),[h]),modal:a,children:S.jsx(N7e,{...c,open:d,onOpenChange:h,dir:r,modal:a,children:n})})};poe.displayName=E8;var moe="DropdownMenuTrigger",goe=_.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,disabled:r=!1,...i}=t,s=hoe(moe,n),o=$s(n);return S.jsx(U7e,{asChild:!0,...o,children:S.jsx(ci.button,{type:"button",id:s.triggerId,"aria-haspopup":"menu","aria-expanded":s.open,"aria-controls":s.open?s.contentId:void 0,"data-state":s.open?"open":"closed","data-disabled":r?"":void 0,disabled:r,...i,ref:pR(e,s.triggerRef),onPointerDown:pn(t.onPointerDown,a=>{!r&&a.button===0&&a.ctrlKey===!1&&(s.onOpenToggle(),s.open||a.preventDefault())}),onKeyDown:pn(t.onKeyDown,a=>{r||(["Enter"," "].includes(a.key)&&s.onOpenToggle(),a.key==="ArrowDown"&&s.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(a.key)&&a.preventDefault())})})})});goe.displayName=moe;var Z7e="DropdownMenuPortal",voe=t=>{const{__scopeDropdownMenu:e,...n}=t,r=$s(e);return S.jsx(j7e,{...r,...n})};voe.displayName=Z7e;var yoe="DropdownMenuContent",boe=_.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=hoe(yoe,n),s=$s(n),o=_.useRef(!1);return S.jsx(F7e,{id:i.contentId,"aria-labelledby":i.triggerId,...s,...r,ref:e,onCloseAutoFocus:pn(t.onCloseAutoFocus,a=>{o.current||i.triggerRef.current?.focus(),o.current=!1,a.preventDefault()}),onInteractOutside:pn(t.onInteractOutside,a=>{const c=a.detail.originalEvent,l=c.button===0&&c.ctrlKey===!0,d=c.button===2||l;(!i.modal||d)&&(o.current=!0)}),style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});boe.displayName=yoe;var e8e="DropdownMenuGroup",t8e=_.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=$s(n);return S.jsx($7e,{...i,...r,ref:e})});t8e.displayName=e8e;var n8e="DropdownMenuLabel",r8e=_.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=$s(n);return S.jsx(B7e,{...i,...r,ref:e})});r8e.displayName=n8e;var i8e="DropdownMenuItem",_oe=_.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=$s(n);return S.jsx(H7e,{...i,...r,ref:e})});_oe.displayName=i8e;var s8e="DropdownMenuCheckboxItem",o8e=_.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=$s(n);return S.jsx(q7e,{...i,...r,ref:e})});o8e.displayName=s8e;var a8e="DropdownMenuRadioGroup",c8e=_.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=$s(n);return S.jsx(V7e,{...i,...r,ref:e})});c8e.displayName=a8e;var l8e="DropdownMenuRadioItem",u8e=_.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=$s(n);return S.jsx(K7e,{...i,...r,ref:e})});u8e.displayName=l8e;var d8e="DropdownMenuItemIndicator",f8e=_.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=$s(n);return S.jsx(G7e,{...i,...r,ref:e})});f8e.displayName=d8e;var h8e="DropdownMenuSeparator",p8e=_.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=$s(n);return S.jsx(z7e,{...i,...r,ref:e})});p8e.displayName=h8e;var m8e="DropdownMenuArrow",g8e=_.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=$s(n);return S.jsx(W7e,{...i,...r,ref:e})});g8e.displayName=m8e;var v8e="DropdownMenuSubTrigger",y8e=_.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=$s(n);return S.jsx(Y7e,{...i,...r,ref:e})});y8e.displayName=v8e;var b8e="DropdownMenuSubContent",_8e=_.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=$s(n);return S.jsx(X7e,{...i,...r,ref:e,style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});_8e.displayName=b8e;var S8e=poe,w8e=goe,E8e=voe,C8e=boe;const T8e=({onSelect:t,children:e})=>S.jsx(_oe,{onSelect:t??void 0,asChild:!0,children:e}),C8=({title:t,showTitle:e=!0,open:n,onOpenChange:r,trigger:i,children:s,side:o="bottom",align:a="center"})=>{const c=f8(),l=c==="android"||c==="ios",d=_.useMemo(()=>({MenuItemWrapper:l?null:T8e,onOpenChange:r}),[r]),h=S.jsx(d8.Provider,{value:d,children:s});return l?S.jsxs(oo.Root,{open:n,onOpenChange:r,children:[S.jsx(oo.Trigger,{asChild:!0,children:i}),S.jsxs(oo.Portal,{children:[S.jsx(oo.Overlay,{className:Le(p3.bg)}),S.jsx(oo.Content,{asChild:!0,children:S.jsx(h8,{title:t,children:h})})]})]}):S.jsxs(S8e,{open:n,onOpenChange:r,children:[S.jsx(w8e,{asChild:!0,children:i}),S.jsx(E8e,{children:S.jsx(C8e,{asChild:!0,side:o,align:a,sideOffset:8,children:S.jsx(t8,{title:t,showTitle:e,children:h})})})]})},R8e="_item_lqfwq_8",k8e="_interactive_lqfwq_26",I8e="_label_lqfwq_34",x8e="_icon_lqfwq_50",A8e="_disabled_lqfwq_118",uu={item:R8e,interactive:k8e,"no-label":"_no-label_lqfwq_30",label:I8e,"no-icon":"_no-icon_lqfwq_41",icon:x8e,"nav-hint":"_nav-hint_lqfwq_59",disabled:A8e};function Soe(t,e){return S.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:S.jsx("path",{d:"M8.7 17.3a.95.95 0 0 1-.275-.7q0-.425.275-.7l3.9-3.9-3.9-3.9a.95.95 0 0 1-.275-.7q0-.425.275-.7a.95.95 0 0 1 .7-.275q.425 0 .7.275l4.6 4.6q.15.15.213.325.062.175.062.375t-.062.375a.9.9 0 0 1-.213.325l-4.6 4.6a.95.95 0 0 1-.7.275.95.95 0 0 1-.7-.275"})})}Soe.displayName="ChevronRightIcon";const woe=_.forwardRef(Soe);function _K(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function L8e(...t){return e=>{let n=!1;const r=t.map(i=>{const s=_K(i,e);return!n&&typeof s=="function"&&(n=!0),s});if(n)return()=>{for(let i=0;i<r.length;i++){const s=r[i];typeof s=="function"?s():_K(t[i],null)}}}}var Eoe=_.forwardRef((t,e)=>{const{children:n,...r}=t,i=_.Children.toArray(n),s=i.find(O8e);if(s){const o=s.props.children,a=i.map(c=>c===s?_.Children.count(o)>1?_.Children.only(null):_.isValidElement(o)?o.props.children:null:c);return S.jsx(fM,{...r,ref:e,children:_.isValidElement(o)?_.cloneElement(o,void 0,a):null})}return S.jsx(fM,{...r,ref:e,children:n})});Eoe.displayName="Slot";var fM=_.forwardRef((t,e)=>{const{children:n,...r}=t;if(_.isValidElement(n)){const i=D8e(n);return _.cloneElement(n,{...P8e(r,n.props),ref:e?L8e(e,i):i})}return _.Children.count(n)>1?_.Children.only(null):null});fM.displayName="SlotClone";var M8e=({children:t})=>S.jsx(S.Fragment,{children:t});function O8e(t){return _.isValidElement(t)&&t.type===M8e}function P8e(t,e){const n={...e};for(const r in e){const i=t[r],s=e[r];/^on[A-Z]/.test(r)?i&&s?n[r]=(...a)=>{s(...a),i(...a)}:i&&(n[r]=i):r==="style"?n[r]={...i,...s}:r==="className"&&(n[r]=[i,s].filter(Boolean).join(" "))}return{...t,...n}}function D8e(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}const $p=({as:t,className:e,Icon:n,label:r,labelProps:i,onSelect:s,kind:o="primary",children:a,onClick:c,disabled:l,hideChevron:d,...h})=>{const m=t??"button",g=_.useContext(d8),y=_.useCallback(x=>{if(c?.(x),s!==null&&g?.MenuItemWrapper==null){const C=new CustomEvent("menu.itemSelect",{bubbles:!0,cancelable:!0});s(C),C.defaultPrevented||g?.onOpenChange(!1)}},[g,s]),v=_.isValidElement(n),E=n,w=n,R=S.jsxs(m,{role:"menuitem",...h,className:Le(e,uu.item,{[uu.interactive]:s!==null,[uu["no-label"]]:r===null,[uu["no-icon"]]:!n,[uu.disabled]:l}),"data-kind":o,onClick:y,disabled:m==="button"?l:void 0,"aria-disabled":m==="button"?void 0:l,children:[n&&(v?S.jsx(Eoe,{className:uu.icon,children:E}):S.jsx(w,{width:24,height:24,className:uu.icon,"aria-hidden":!0})),r!==null&&S.jsx(an,{className:uu.label,size:"md",weight:"medium",as:"span",...i,children:r}),!d&&(m==="button"||m==="a")&&S.jsx(woe,{width:8,height:24,className:uu["nav-hint"],"aria-hidden":!0,viewBox:"8 0 8 24"}),a]});return g?.MenuItemWrapper==null||s===null?R:S.jsx(g.MenuItemWrapper,{onSelect:s,children:R})};function rb(t,e,{checkForDefaultPrevented:n=!0}={}){return function(i){if(t?.(i),n===!1||!i.defaultPrevented)return e?.(i)}}function SK(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function N8e(...t){return e=>{let n=!1;const r=t.map(i=>{const s=SK(i,e);return!n&&typeof s=="function"&&(n=!0),s});if(n)return()=>{for(let i=0;i<r.length;i++){const s=r[i];typeof s=="function"?s():SK(t[i],null)}}}}function T8(...t){return _.useCallback(N8e(...t),t)}function U8e(t,e=[]){let n=[];function r(s,o){const a=_.createContext(o),c=n.length;n=[...n,o];const l=h=>{const{scope:m,children:g,...y}=h,v=m?.[t]?.[c]||a,E=_.useMemo(()=>y,Object.values(y));return S.jsx(v.Provider,{value:E,children:g})};l.displayName=s+"Provider";function d(h,m){const g=m?.[t]?.[c]||a,y=_.useContext(g);if(y)return y;if(o!==void 0)return o;throw new Error(`\`${h}\` must be used within \`${s}\``)}return[l,d]}const i=()=>{const s=n.map(o=>_.createContext(o));return function(a){const c=a?.[t]||s;return _.useMemo(()=>({[`__scope${t}`]:{...a,[t]:c}}),[a,c])}};return i.scopeName=t,[r,j8e(i,...e)]}function j8e(...t){const e=t[0];if(t.length===1)return e;const n=()=>{const r=t.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(s){const o=r.reduce((a,{useScope:c,scopeName:l})=>{const h=c(s)[`__scope${l}`];return{...a,...h}},{});return _.useMemo(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return n.scopeName=e.scopeName,n}var F8e="Label",Coe=_.forwardRef((t,e)=>S.jsx(ci.label,{...t,ref:e,onMouseDown:n=>{n.target.closest("button, input, select, textarea")||(t.onMouseDown?.(n),!n.defaultPrevented&&n.detail>1&&n.preventDefault())}}));Coe.displayName=F8e;var[R8,Jot]=U8e("Form"),k8="Form",[$8e,Ly]=R8(k8),[B8e,Toe]=R8(k8),Roe=_.forwardRef((t,e)=>{const{__scopeForm:n,onClearServerErrors:r=()=>{},...i}=t,s=_.useRef(null),o=T8(e,s),[a,c]=_.useState({}),l=_.useCallback(D=>a[D],[a]),d=_.useCallback((D,j)=>c(H=>({...H,[D]:{...H[D]??{},...j}})),[]),h=_.useCallback(D=>{c(j=>({...j,[D]:void 0})),R(j=>({...j,[D]:{}}))},[]),[m,g]=_.useState({}),y=_.useCallback(D=>m[D]??[],[m]),v=_.useCallback((D,j)=>{g(H=>({...H,[D]:[...H[D]??[],j]}))},[]),E=_.useCallback((D,j)=>{g(H=>({...H,[D]:(H[D]??[]).filter(z=>z.id!==j)}))},[]),[w,R]=_.useState({}),x=_.useCallback(D=>w[D]??{},[w]),C=_.useCallback((D,j)=>{R(H=>({...H,[D]:{...H[D]??{},...j}}))},[]),[k,T]=_.useState({}),L=_.useCallback((D,j)=>{T(H=>{const z=new Set(H[D]).add(j);return{...H,[D]:z}})},[]),O=_.useCallback((D,j)=>{T(H=>{const z=new Set(H[D]);return z.delete(j),{...H,[D]:z}})},[]),P=_.useCallback(D=>Array.from(k[D]??[]).join(" ")||void 0,[k]);return S.jsx($8e,{scope:n,getFieldValidity:l,onFieldValidityChange:d,getFieldCustomMatcherEntries:y,onFieldCustomMatcherEntryAdd:v,onFieldCustomMatcherEntryRemove:E,getFieldCustomErrors:x,onFieldCustomErrorsChange:C,onFieldValiditionClear:h,children:S.jsx(B8e,{scope:n,onFieldMessageIdAdd:L,onFieldMessageIdRemove:O,getFieldDescription:P,children:S.jsx(ci.form,{...i,ref:o,onInvalid:rb(t.onInvalid,D=>{const j=Ooe(D.currentTarget);j===D.target&&j.focus(),D.preventDefault()}),onSubmit:rb(t.onSubmit,r,{checkForDefaultPrevented:!1}),onReset:rb(t.onReset,r)})})})});Roe.displayName=k8;var I8="FormField",[H8e,bR]=R8(I8),koe=_.forwardRef((t,e)=>{const{__scopeForm:n,name:r,serverInvalid:i=!1,...s}=t,a=Ly(I8,n).getFieldValidity(r),c=Hv();return S.jsx(H8e,{scope:n,id:c,name:r,serverInvalid:i,children:S.jsx(ci.div,{"data-valid":A8(a,i),"data-invalid":L8(a,i),...s,ref:e})})});koe.displayName=I8;var hM="FormLabel",Ioe=_.forwardRef((t,e)=>{const{__scopeForm:n,...r}=t,i=Ly(hM,n),s=bR(hM,n),o=r.htmlFor||s.id,a=i.getFieldValidity(s.name);return S.jsx(Coe,{"data-valid":A8(a,s.serverInvalid),"data-invalid":L8(a,s.serverInvalid),...r,ref:e,htmlFor:o})});Ioe.displayName=hM;var YE="FormControl",xoe=_.forwardRef((t,e)=>{const{__scopeForm:n,...r}=t,i=Ly(YE,n),s=bR(YE,n),o=Toe(YE,n),a=_.useRef(null),c=T8(e,a),l=r.name||s.name,d=r.id||s.id,h=i.getFieldCustomMatcherEntries(l),{onFieldValidityChange:m,onFieldCustomErrorsChange:g,onFieldValiditionClear:y}=i,v=_.useCallback(async R=>{if(Poe(R.validity)){const H=k6(R.validity);m(l,H);return}const x=R.form?new FormData(R.form):new FormData,C=[R.value,x],k=[],T=[];h.forEach(H=>{X8e(H,C)?T.push(H):J8e(H)&&k.push(H)});const L=k.map(({id:H,match:z})=>[H,z(...C)]),O=Object.fromEntries(L),P=Object.values(O).some(Boolean),D=P;R.setCustomValidity(D?r_:"");const j=k6(R.validity);if(m(l,j),g(l,O),!P&&T.length>0){const H=T.map(({id:V,match:G})=>G(...C).then(Z=>[V,Z])),z=await Promise.all(H),Y=Object.fromEntries(z),F=Object.values(Y).some(Boolean);R.setCustomValidity(F?r_:"");const $=k6(R.validity);m(l,$),g(l,Y)}},[h,l,g,m]);_.useEffect(()=>{const R=a.current;if(R){const x=()=>v(R);return R.addEventListener("change",x),()=>R.removeEventListener("change",x)}},[v]);const E=_.useCallback(()=>{const R=a.current;R&&(R.setCustomValidity(""),y(l))},[l,y]);_.useEffect(()=>{const R=a.current?.form;if(R)return R.addEventListener("reset",E),()=>R.removeEventListener("reset",E)},[E]),_.useEffect(()=>{const R=a.current,x=R?.closest("form");if(x&&s.serverInvalid){const C=Ooe(x);C===R&&C.focus()}},[s.serverInvalid]);const w=i.getFieldValidity(l);return S.jsx(ci.input,{"data-valid":A8(w,s.serverInvalid),"data-invalid":L8(w,s.serverInvalid),"aria-invalid":s.serverInvalid?!0:void 0,"aria-describedby":o.getFieldDescription(l),title:"",...r,ref:c,id:d,name:l,onInvalid:rb(t.onInvalid,R=>{const x=R.currentTarget;v(x)}),onChange:rb(t.onChange,R=>{E()})})});xoe.displayName=YE;var r_="This value is not valid",q8e={badInput:r_,patternMismatch:"This value does not match the required pattern",rangeOverflow:"This value is too large",rangeUnderflow:"This value is too small",stepMismatch:"This value does not match the required step",tooLong:"This value is too long",tooShort:"This value is too short",typeMismatch:"This value does not match the required type",valid:void 0,valueMissing:"This value is missing"},cS="FormMessage",Aoe=_.forwardRef((t,e)=>{const{match:n,name:r,...i}=t,s=bR(cS,t.__scopeForm),o=r??s.name;return n===void 0?S.jsx(x8,{...i,ref:e,name:o,children:t.children||r_}):typeof n=="function"?S.jsx(K8e,{match:n,...i,ref:e,name:o}):S.jsx(V8e,{match:n,...i,ref:e,name:o})});Aoe.displayName=cS;var V8e=_.forwardRef((t,e)=>{const{match:n,forceMatch:r=!1,name:i,children:s,...o}=t,c=Ly(cS,o.__scopeForm).getFieldValidity(i);return r||c?.[n]?S.jsx(x8,{ref:e,...o,name:i,children:s??q8e[n]}):null}),K8e=_.forwardRef((t,e)=>{const{match:n,forceMatch:r=!1,name:i,id:s,children:o,...a}=t,c=Ly(cS,a.__scopeForm),l=_.useRef(null),d=T8(e,l),h=Hv(),m=s??h,g=_.useMemo(()=>({id:m,match:n}),[m,n]),{onFieldCustomMatcherEntryAdd:y,onFieldCustomMatcherEntryRemove:v}=c;_.useEffect(()=>(y(i,g),()=>v(i,g.id)),[g,i,y,v]);const E=c.getFieldValidity(i),R=c.getFieldCustomErrors(i)[m];return r||E&&!Poe(E)&&R?S.jsx(x8,{id:m,ref:d,...a,name:i,children:o??r_}):null}),x8=_.forwardRef((t,e)=>{const{__scopeForm:n,id:r,name:i,...s}=t,o=Toe(cS,n),a=Hv(),c=r??a,{onFieldMessageIdAdd:l,onFieldMessageIdRemove:d}=o;return _.useEffect(()=>(l(i,c),()=>d(i,c)),[i,c,l,d]),S.jsx(ci.span,{id:c,...s,ref:e})}),pM="FormValidityState",Loe=t=>{const{__scopeForm:e,name:n,children:r}=t,i=Ly(pM,e),s=bR(pM,e),o=n??s.name,a=i.getFieldValidity(o);return S.jsx(S.Fragment,{children:r(a)})};Loe.displayName=pM;var G8e="FormSubmit",Moe=_.forwardRef((t,e)=>{const{__scopeForm:n,...r}=t;return S.jsx(ci.button,{type:"submit",...r,ref:e})});Moe.displayName=G8e;function k6(t){const e={};for(const n in t)e[n]=t[n];return e}function z8e(t){return t instanceof HTMLElement}function W8e(t){return"validity"in t}function Y8e(t){return W8e(t)&&(t.validity.valid===!1||t.getAttribute("aria-invalid")==="true")}function Ooe(t){const e=t.elements,[n]=Array.from(e).filter(z8e).filter(Y8e);return n}function X8e(t,e){return t.match.constructor.name==="AsyncFunction"||Q8e(t.match,e)}function J8e(t){return t.match.constructor.name==="Function"}function Q8e(t,e){return t(...e)instanceof Promise}function Poe(t){let e=!1;for(const n in t){const r=n;if(r!=="valid"&&r!=="customError"&&t[r]){e=!0;break}}return e}function A8(t,e){if(t?.valid===!0&&!e)return!0}function L8(t,e){if(t?.valid===!1||e)return!0}var Z8e=Roe,Doe=koe,e9e=Ioe,M8=xoe,_R=Aoe,t9e=Loe,n9e=Moe;const r9e="_container_1qhtc_10",i9e="_input_1qhtc_18",s9e="_ui_1qhtc_19",I6={container:r9e,input:i9e,ui:s9e},o9e=_.forwardRef(function({className:e,...n},r){const i=Le(I6.container,e);return S.jsxs("div",{className:i,children:[S.jsx("input",{ref:r,...n,className:I6.input,type:"radio"}),S.jsx("div",{className:I6.ui})]})}),XE=_.forwardRef(function(e,n){return S.jsx(M8,{asChild:!0,children:S.jsx(o9e,{ref:n,...e})})}),a9e="_root_19upo_16",c9e="_field_19upo_26",l9e="_label_19upo_59",u9e="_message_19upo_85",ea={root:a9e,field:c9e,"inline-field":"_inline-field_19upo_32","inline-field-body":"_inline-field-body_19upo_38","inline-field-control":"_inline-field-control_19upo_44",label:l9e,message:u9e,"help-message":"_help-message_19upo_91","error-message":"_error-message_19upo_95","success-message":"_success-message_19upo_99"},d9e=_.forwardRef(function({children:e,...n},r){const i=Le(ea.field,n.className);return S.jsx(Doe,{ref:r,...n,className:i,children:e})}),ib=_.forwardRef(function({children:e,...n},r){const i=Le(ea.label,n.className);return S.jsx(e9e,{ref:r,...n,className:i,children:e})});var f9e="Separator",wK="horizontal",h9e=["horizontal","vertical"],Noe=_.forwardRef((t,e)=>{const{decorative:n,orientation:r=wK,...i}=t,s=p9e(r)?r:wK,a=n?{role:"none"}:{"aria-orientation":s==="vertical"?s:void 0,role:"separator"};return S.jsx(ci.div,{"data-orientation":s,...a,...i,ref:e})});Noe.displayName=f9e;function p9e(t){return h9e.includes(t)}var m9e=Noe;const g9e="_separator_cqpyv_8",v9e={separator:g9e},EK="--cpd-separator-spacing",O8=_.forwardRef(({className:t,spacing:e,kind:n="primary",...r},i)=>{const s=Le(v9e.separator,t),o=_.useRef(null),a=tre([o,i]);return _.useEffect(()=>{const c=o.current?.style;e?c?.setProperty(EK,e):c?.removeProperty(EK)},[e]),S.jsx(m9e,{...r,className:s,ref:a,"data-kind":n})});O8.displayName="Separator";const y9e="_container_udcm8_10",b9e="_input_udcm8_24",_9e="_ui_udcm8_34",x6={container:y9e,input:b9e,ui:_9e},Uoe=_.forwardRef(function({className:e,...n},r){const i=Le(x6.container,e);return S.jsxs("div",{className:i,children:[S.jsx("input",{role:"switch",ref:r,className:x6.input,...n,type:"checkbox"}),S.jsx("div",{className:x6.ui})]})});_.forwardRef(function(e,n){return S.jsx(M8,{asChild:!0,children:S.jsx(Uoe,{ref:n,...e})})});const P8=_.forwardRef(function({className:e,Icon:n,label:r,onSelect:i,checked:s,disabled:o,onClick:a},c){const l=_.useId(),d=_.useCallback(()=>{},[]);return S.jsx($p,{as:"div",role:"menuitemcheckbox","aria-checked":s,className:e,Icon:n,label:r,onSelect:i,disabled:o,onClick:a,children:S.jsx(Uoe,{id:l,ref:c,"aria-hidden":!0,checked:s,disabled:o,onChange:d})})});function joe(t,e){return S.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:S.jsx("path",{d:"M9.55 17.575q-.2 0-.375-.062a.9.9 0 0 1-.325-.213L4.55 13q-.274-.274-.262-.713.012-.437.287-.712a.95.95 0 0 1 .7-.275q.425 0 .7.275L9.55 15.15l8.475-8.475q.274-.275.713-.275.437 0 .712.275.275.274.275.713 0 .437-.275.712l-9.2 9.2q-.15.15-.325.212a1.1 1.1 0 0 1-.375.063"})})}joe.displayName="CheckIcon";const D8=_.forwardRef(joe),y3=_.forwardRef(function({children:e,...n},r){const i=Le(ea.root,n.className);return S.jsx(Z8e,{ref:r,...n,className:i,children:e})}),JE=_.forwardRef(function({className:e,control:n,children:r,...i},s){const o=Le(ea["inline-field"],e);return S.jsxs(Doe,{ref:s,...i,className:o,children:[S.jsx("div",{className:ea["inline-field-control"],children:n}),S.jsx("div",{className:ea["inline-field-body"],children:r})]})});function Foe(t,e){return S.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:S.jsx("path",{d:"m10.6 13.8-2.15-2.15a.95.95 0 0 0-.7-.275.95.95 0 0 0-.7.275.95.95 0 0 0-.275.7q0 .425.275.7L9.9 15.9q.3.3.7.3t.7-.3l5.65-5.65a.95.95 0 0 0 .275-.7.95.95 0 0 0-.275-.7.95.95 0 0 0-.7-.275.95.95 0 0 0-.7.275zM12 22a9.7 9.7 0 0 1-3.9-.788 10.1 10.1 0 0 1-3.175-2.137q-1.35-1.35-2.137-3.175A9.7 9.7 0 0 1 2 12q0-2.075.788-3.9a10.1 10.1 0 0 1 2.137-3.175q1.35-1.35 3.175-2.137A9.7 9.7 0 0 1 12 2q2.075 0 3.9.788a10.1 10.1 0 0 1 3.175 2.137q1.35 1.35 2.137 3.175A9.7 9.7 0 0 1 22 12a9.7 9.7 0 0 1-.788 3.9 10.1 10.1 0 0 1-2.137 3.175q-1.35 1.35-3.175 2.137A9.7 9.7 0 0 1 12 22"})})}Foe.displayName="CheckCircleSolidIcon";const S9e=_.forwardRef(Foe),w9e="_icon_11k6c_18",E9e={icon:w9e};function $oe(t,e){return S.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:S.jsx("path",{fillRule:"evenodd",d:"M12 4.031a8 8 0 1 0 8 8 1 1 0 0 1 2 0c0 5.523-4.477 10-10 10s-10-4.477-10-10 4.477-10 10-10a1 1 0 1 1 0 2",clipRule:"evenodd"})})}$oe.displayName="SpinnerIcon";const C9e=_.forwardRef($oe),Boe=_.forwardRef(function({size:e=20,className:n,...r},i){return S.jsx(C9e,{ref:i,className:Le(E9e.icon,n),style:{width:e,height:e},...r})});_.forwardRef(function({children:e,className:n,...r},i){const s=Le(ea.message,ea["error-message"],n);return S.jsxs(_R,{ref:i,...r,className:s,children:[S.jsx(z_,{}),e]})});const T9e=_.forwardRef(function({children:e,className:n,...r},i){const s=Le(ea.message,ea["success-message"],n);return S.jsxs(_R,{ref:i,...r,className:s,children:[S.jsx(S9e,{}),e]})}),R9e=_.forwardRef(function({children:e,className:n,...r},i){const s=Le(ea.message,n);return S.jsxs(_R,{ref:i,...r,className:s,children:[S.jsx(Boe,{}),e]})}),QE=_.forwardRef(function({children:e,className:n,...r},i){const s=Le(ea.message,ea["help-message"],n);return S.jsx(_R,{ref:i,...r,className:s,children:e})}),k9e="_button_13vu4_8",I9e="_destructive_13vu4_110",i1={button:k9e,"icon-only":"_icon-only_13vu4_53","has-icon":"_has-icon_13vu4_60",destructive:I9e},qt=_.forwardRef(function({as:e,kind:n="primary",size:r="lg",children:i,className:s,iconOnly:o,Icon:a,destructive:c,disabled:l,...d},h){const[m,g]=n==="destructive"?["secondary",!0]:[n,c],y=Le(i1.button,s,{[i1["has-icon"]]:a,[i1["icon-only"]]:o,[i1.destructive]:g}),v=o&&r==="lg"?24:20;return S.jsxs(Mne,{...d,as:e||"button",ref:h,className:y,"data-size":r,"data-kind":m,tabIndex:0,disabled:l,children:[a&&S.jsx(a,{width:v,height:v,className:i1.icon,"aria-hidden":!0}),i]})}),x9e="_control_sqdq4_10",CK={control:x9e,"enable-ligatures":"_enable-ligatures_sqdq4_62"},A9e=_.forwardRef(function({className:e,enableLigatures:n,...r},i){const s=Le(CK.control,e,{[CK["enable-ligatures"]]:n});return S.jsx("input",{ref:i,...r,className:s})}),L9e=_.forwardRef(function(e,n){return S.jsx(M8,{asChild:!0,children:S.jsx(A9e,{ref:n,...e})})});function Hoe(t,e){return S.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:S.jsx("path",{d:"M12 16q1.875 0 3.188-1.312Q16.5 13.375 16.5 11.5t-1.312-3.187T12 7 8.813 8.313 7.5 11.5t1.313 3.188T12 16m0-1.8q-1.125 0-1.912-.787A2.6 2.6 0 0 1 9.3 11.5q0-1.125.787-1.912A2.6 2.6 0 0 1 12 8.8q1.125 0 1.912.787.788.788.788 1.913t-.787 1.912A2.6 2.6 0 0 1 12 14.2m0 4.8q-3.475 0-6.35-1.837Q2.775 15.324 1.3 12.2a.8.8 0 0 1-.1-.312 3 3 0 0 1 0-.775.8.8 0 0 1 .1-.313q1.475-3.125 4.35-4.962Q8.525 4 12 4t6.35 1.838T22.7 10.8a.8.8 0 0 1 .1.313 3 3 0 0 1 0 .774.8.8 0 0 1-.1.313q-1.475 3.125-4.35 4.963Q15.475 19 12 19m0-2a9.54 9.54 0 0 0 5.188-1.488A9.77 9.77 0 0 0 20.8 11.5a9.77 9.77 0 0 0-3.613-4.012A9.54 9.54 0 0 0 12 6a9.55 9.55 0 0 0-5.187 1.487A9.77 9.77 0 0 0 3.2 11.5a9.77 9.77 0 0 0 3.613 4.012A9.54 9.54 0 0 0 12 17"})})}Hoe.displayName="VisibilityOnIcon";const M9e=_.forwardRef(Hoe),O9e="_controls_17lij_8",A6={controls:O9e,"button-group":"_button-group_17lij_18"};function P9e(t,e){switch(e){case 0:return t===0||t===3?1:t;case 1:return 2;case 4:return 0;case 2:return t===2?3:t;case 3:return t===2?0:t;case 5:return t===3?0:t}D9e(e)}function D9e(t){throw new Error(`Unreachable value: ${t}`)}const N9e=_.forwardRef(function({className:e,label:n,onSave:r,onCancel:i,onInput:s,onClearServerErrors:o,serverInvalid:a,saveButtonLabel:c,cancelButtonLabel:l,savedLabel:d,savingLabel:h,helpLabel:m,disabled:g,children:y,...v},E){const[w,R]=_.useReducer(P9e,0),x=_.useRef(!1),[C,k]=_.useState(!1),T=w===1||w===2||C,L=_.useRef(void 0);_.useEffect(()=>(w===3&&(L.current=setTimeout(()=>{R(5),L.current=void 0},2e3)),()=>{L.current&&clearTimeout(L.current),L.current=void 0}),[w]);const O=_.useRef(null),P=_.useRef(null),D=_.useRef(null),j=_.useCallback(()=>{x.current||(x.current=!0,k(!0))},[C,k]),H=_.useCallback(F=>{x.current&&(F.currentTarget.contains(F.relatedTarget)||(x.current=!1,k(!1)))},[C,k]),z=_.useCallback(F=>{R(0),s?.(F)},[R,s]),Y=_.useCallback(async F=>{if(F.preventDefault(),w!==0)try{R(1),P.current?.blur(),await r?.(F),R(2)}catch{R(3)}},[r,w,L]),W=_.useCallback(F=>{D.current?.blur(),i?.(F),R(4)},[D,i]);return S.jsx(y3,{className:e,onSubmit:Y,onReset:W,onFocus:j,onBlur:H,onClearServerErrors:o,ref:O,children:S.jsxs(d9e,{name:"input",serverInvalid:a,children:[S.jsx(ib,{children:n}),S.jsxs("div",{className:A6.controls,children:[S.jsx(L9e,{ref:E,...v,onInput:z,disabled:g||w===2}),T&&S.jsxs("div",{className:A6["button-group"],children:[S.jsx(bi,{label:c,children:S.jsx(n9e,{asChild:!0,children:S.jsx(qt,{type:"submit",kind:"primary",size:"sm",ref:P,disabled:w!==1,iconOnly:!0,Icon:D8})})}),S.jsx(bi,{label:l,children:S.jsx(qt,{type:"reset",kind:"secondary",size:"sm",ref:D,className:A6.button,disabled:w===2,iconOnly:!0,Icon:W_})})]})]}),w===2?S.jsx(R9e,{children:h}):y,d&&w===3&&S.jsx(T9e,{children:d}),m&&(w===0||w===1)&&S.jsx(t9e,{children:F=>(F===void 0||F.valid)&&!a&&S.jsx(QE,{children:m})})]})})}),U9e="_content_1r8kr_8",j9e="_destructive_1r8kr_34",F9e="_success_1r8kr_39",L6={content:U9e,destructive:j9e,success:F9e};function qoe({className:t,size:e="large",destructive:n=!1,success:r=!1,children:i}){return S.jsx("div",{className:Le(L6.content,t,{[L6.destructive]:n,[L6.success]:r}),"data-size":e,children:xe.Children.only(i)})}const i_={"nav-bar":"_nav-bar_z70g4_8","nav-bar-items":"_nav-bar-items_z70g4_14","nav-tab":"_nav-tab_z70g4_25","nav-item":"_nav-item_z70g4_47"},$9e=({children:t,className:e,role:n,"aria-label":r,...i})=>{const s=Le(e,i_["nav-bar"]),o=n!=="tablist"?{role:"navigation","aria-label":r}:{role:"presentation"},a=n==="tablist"?{role:"tablist","aria-label":r}:{};return S.jsx("nav",{...o,...i,className:s,children:S.jsx("ul",{...a,className:i_["nav-bar-items"],children:t})})},B9e=_.forwardRef(function({children:e,href:n,onClick:r,...i},s){return S.jsx("a",{href:n,onClick:r,className:i_["nav-item"],...i,ref:s,children:e})}),H9e=_.forwardRef(function({children:e,disabled:n,onClick:r,...i},s){return S.jsx("button",{onClick:r,className:i_["nav-item"],disabled:n,ref:s,...i,children:e})}),q9e=t=>"href"in t&&!!t.href,V9e=_.forwardRef(function(e,n){const r=e["aria-controls"],s=!!r?{"aria-controls":r,role:"tab","aria-selected":e.active}:{"aria-current":e.active?!0:void 0},o={...e};delete o.active;let a;if(q9e(o)){const c=n;a=S.jsx(B9e,{...o,...s,ref:c})}else{const c=n;a=S.jsx(H9e,{...o,...s,ref:c})}return S.jsx("li",{className:i_["nav-tab"],"data-current":e.active?!0:void 0,role:"presentation",children:a})});function Voe(t,e){return S.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:S.jsx("path",{d:"M12 14.95q-.2 0-.375-.062a.9.9 0 0 1-.325-.213l-4.6-4.6a.95.95 0 0 1-.275-.7q0-.425.275-.7a.95.95 0 0 1 .7-.275q.425 0 .7.275l3.9 3.9 3.9-3.9a.95.95 0 0 1 .7-.275q.425 0 .7.275a.95.95 0 0 1 .275.7.95.95 0 0 1-.275.7l-4.6 4.6q-.15.15-.325.212a1.1 1.1 0 0 1-.375.063"})})}Voe.displayName="ChevronDownIcon";const K9e=_.forwardRef(Voe);function Koe(t,e){return S.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:S.jsx("path",{d:"m13.3 17.3-4.6-4.6a.9.9 0 0 1-.213-.325A1.1 1.1 0 0 1 8.425 12q0-.2.062-.375A.9.9 0 0 1 8.7 11.3l4.6-4.6a.95.95 0 0 1 .7-.275q.425 0 .7.275a.95.95 0 0 1 .275.7.95.95 0 0 1-.275.7L10.8 12l3.9 3.9a.95.95 0 0 1 .275.7.95.95 0 0 1-.275.7.95.95 0 0 1-.7.275.95.95 0 0 1-.7-.275"})})}Koe.displayName="ChevronLeftIcon";const G9e=_.forwardRef(Koe),yt=t=>typeof t=="string",s1=()=>{let t,e;const n=new Promise((r,i)=>{t=r,e=i});return n.resolve=t,n.reject=e,n},TK=t=>t==null?"":""+t,z9e=(t,e,n)=>{t.forEach(r=>{e[r]&&(n[r]=e[r])})},W9e=/###/g,RK=t=>t&&t.indexOf("###")>-1?t.replace(W9e,"."):t,kK=t=>!t||yt(t),sb=(t,e,n)=>{const r=yt(e)?e.split("."):e;let i=0;for(;i<r.length-1;){if(kK(t))return{};const s=RK(r[i]);!t[s]&&n&&(t[s]=new n),Object.prototype.hasOwnProperty.call(t,s)?t=t[s]:t={},++i}return kK(t)?{}:{obj:t,k:RK(r[i])}},IK=(t,e,n)=>{const{obj:r,k:i}=sb(t,e,Object);if(r!==void 0||e.length===1){r[i]=n;return}let s=e[e.length-1],o=e.slice(0,e.length-1),a=sb(t,o,Object);for(;a.obj===void 0&&o.length;)s=`${o[o.length-1]}.${s}`,o=o.slice(0,o.length-1),a=sb(t,o,Object),a?.obj&&typeof a.obj[`${a.k}.${s}`]<"u"&&(a.obj=void 0);a.obj[`${a.k}.${s}`]=n},Y9e=(t,e,n,r)=>{const{obj:i,k:s}=sb(t,e,Object);i[s]=i[s]||[],i[s].push(n)},b3=(t,e)=>{const{obj:n,k:r}=sb(t,e);if(n&&Object.prototype.hasOwnProperty.call(n,r))return n[r]},X9e=(t,e,n)=>{const r=b3(t,n);return r!==void 0?r:b3(e,n)},Goe=(t,e,n)=>{for(const r in e)r!=="__proto__"&&r!=="constructor"&&(r in t?yt(t[r])||t[r]instanceof String||yt(e[r])||e[r]instanceof String?n&&(t[r]=e[r]):Goe(t[r],e[r],n):t[r]=e[r]);return t},bg=t=>t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var J9e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const Q9e=t=>yt(t)?t.replace(/[&<>"'\/]/g,e=>J9e[e]):t;class Z9e{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const n=this.regExpMap.get(e);if(n!==void 0)return n;const r=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,r),this.regExpQueue.push(e),r}}const eDe=[" ",",","?","!",";"],tDe=new Z9e(20),nDe=(t,e,n)=>{e=e||"",n=n||"";const r=eDe.filter(o=>e.indexOf(o)<0&&n.indexOf(o)<0);if(r.length===0)return!0;const i=tDe.getRegExp(`(${r.map(o=>o==="?"?"\\?":o).join("|")})`);let s=!i.test(t);if(!s){const o=t.indexOf(n);o>0&&!i.test(t.substring(0,o))&&(s=!0)}return s},mM=(t,e,n=".")=>{if(!t)return;if(t[e])return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0;const r=e.split(n);let i=t;for(let s=0;s<r.length;){if(!i||typeof i!="object")return;let o,a="";for(let c=s;c<r.length;++c)if(c!==s&&(a+=n),a+=r[c],o=i[a],o!==void 0){if(["string","number","boolean"].indexOf(typeof o)>-1&&c<r.length-1)continue;s+=c-s+1;break}i=o}return i},s_=t=>t?.replace("_","-"),rDe={type:"logger",log(t){this.output("log",t)},warn(t){this.output("warn",t)},error(t){this.output("error",t)},output(t,e){console?.[t]?.apply?.(console,e)}};class _3{constructor(e,n={}){this.init(e,n)}init(e,n={}){this.prefix=n.prefix||"i18next:",this.logger=e||rDe,this.options=n,this.debug=n.debug}log(...e){return this.forward(e,"log","",!0)}warn(...e){return this.forward(e,"warn","",!0)}error(...e){return this.forward(e,"error","")}deprecate(...e){return this.forward(e,"warn","WARNING DEPRECATED: ",!0)}forward(e,n,r,i){return i&&!this.debug?null:(yt(e[0])&&(e[0]=`${r}${this.prefix} ${e[0]}`),this.logger[n](e))}create(e){return new _3(this.logger,{prefix:`${this.prefix}:${e}:`,...this.options})}clone(e){return e=e||this.options,e.prefix=e.prefix||this.prefix,new _3(this.logger,e)}}var wl=new _3;class SR{constructor(){this.observers={}}on(e,n){return e.split(" ").forEach(r=>{this.observers[r]||(this.observers[r]=new Map);const i=this.observers[r].get(n)||0;this.observers[r].set(n,i+1)}),this}off(e,n){if(this.observers[e]){if(!n){delete this.observers[e];return}this.observers[e].delete(n)}}emit(e,...n){this.observers[e]&&Array.from(this.observers[e].entries()).forEach(([i,s])=>{for(let o=0;o<s;o++)i(...n)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(([i,s])=>{for(let o=0;o<s;o++)i.apply(i,[e,...n])})}}class xK extends SR{constructor(e,n={ns:["translation"],defaultNS:"translation"}){super(),this.data=e||{},this.options=n,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const n=this.options.ns.indexOf(e);n>-1&&this.options.ns.splice(n,1)}getResource(e,n,r,i={}){const s=i.keySeparator!==void 0?i.keySeparator:this.options.keySeparator,o=i.ignoreJSONStructure!==void 0?i.ignoreJSONStructure:this.options.ignoreJSONStructure;let a;e.indexOf(".")>-1?a=e.split("."):(a=[e,n],r&&(Array.isArray(r)?a.push(...r):yt(r)&&s?a.push(...r.split(s)):a.push(r)));const c=b3(this.data,a);return!c&&!n&&!r&&e.indexOf(".")>-1&&(e=a[0],n=a[1],r=a.slice(2).join(".")),c||!o||!yt(r)?c:mM(this.data?.[e]?.[n],r,s)}addResource(e,n,r,i,s={silent:!1}){const o=s.keySeparator!==void 0?s.keySeparator:this.options.keySeparator;let a=[e,n];r&&(a=a.concat(o?r.split(o):r)),e.indexOf(".")>-1&&(a=e.split("."),i=n,n=a[1]),this.addNamespaces(n),IK(this.data,a,i),s.silent||this.emit("added",e,n,r,i)}addResources(e,n,r,i={silent:!1}){for(const s in r)(yt(r[s])||Array.isArray(r[s]))&&this.addResource(e,n,s,r[s],{silent:!0});i.silent||this.emit("added",e,n,r)}addResourceBundle(e,n,r,i,s,o={silent:!1,skipCopy:!1}){let a=[e,n];e.indexOf(".")>-1&&(a=e.split("."),i=r,r=n,n=a[1]),this.addNamespaces(n);let c=b3(this.data,a)||{};o.skipCopy||(r=JSON.parse(JSON.stringify(r))),i?Goe(c,r,s):c={...c,...r},IK(this.data,a,c),o.silent||this.emit("added",e,n,r)}removeResourceBundle(e,n){this.hasResourceBundle(e,n)&&delete this.data[e][n],this.removeNamespaces(n),this.emit("removed",e,n)}hasResourceBundle(e,n){return this.getResource(e,n)!==void 0}getResourceBundle(e,n){return n||(n=this.options.defaultNS),this.getResource(e,n)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const n=this.getDataByLanguage(e);return!!(n&&Object.keys(n)||[]).find(i=>n[i]&&Object.keys(n[i]).length>0)}toJSON(){return this.data}}var zoe={processors:{},addPostProcessor(t){this.processors[t.name]=t},handle(t,e,n,r,i){return t.forEach(s=>{e=this.processors[s]?.process(e,n,r,i)??e}),e}};const Woe=Symbol("i18next/PATH_KEY");function iDe(){const t=[],e=Object.create(null);let n;return e.get=(r,i)=>(n?.revoke?.(),i===Woe?t:(t.push(i),n=Proxy.revocable(r,e),n.proxy)),Proxy.revocable(Object.create(null),e).proxy}function S3(t,e){const{[Woe]:n}=t(iDe());return n.join(e?.keySeparator??".")}const AK={},M6=t=>!yt(t)&&typeof t!="boolean"&&typeof t!="number";class w3 extends SR{constructor(e,n={}){super(),z9e(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,this),this.options=n,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=wl.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e,n={interpolation:{}}){const r={...n};if(e==null)return!1;const i=this.resolve(e,r);if(i?.res===void 0)return!1;const s=M6(i.res);return!(r.returnObjects===!1&&s)}extractFromKey(e,n){let r=n.nsSeparator!==void 0?n.nsSeparator:this.options.nsSeparator;r===void 0&&(r=":");const i=n.keySeparator!==void 0?n.keySeparator:this.options.keySeparator;let s=n.ns||this.options.defaultNS||[];const o=r&&e.indexOf(r)>-1,a=!this.options.userDefinedKeySeparator&&!n.keySeparator&&!this.options.userDefinedNsSeparator&&!n.nsSeparator&&!nDe(e,r,i);if(o&&!a){const c=e.match(this.interpolator.nestingRegexp);if(c&&c.length>0)return{key:e,namespaces:yt(s)?[s]:s};const l=e.split(r);(r!==i||r===i&&this.options.ns.indexOf(l[0])>-1)&&(s=l.shift()),e=l.join(i)}return{key:e,namespaces:yt(s)?[s]:s}}translate(e,n,r){let i=typeof n=="object"?{...n}:n;if(typeof i!="object"&&this.options.overloadTranslationOptionHandler&&(i=this.options.overloadTranslationOptionHandler(arguments)),typeof i=="object"&&(i={...i}),i||(i={}),e==null)return"";typeof e=="function"&&(e=S3(e,{...this.options,...i})),Array.isArray(e)||(e=[String(e)]);const s=i.returnDetails!==void 0?i.returnDetails:this.options.returnDetails,o=i.keySeparator!==void 0?i.keySeparator:this.options.keySeparator,{key:a,namespaces:c}=this.extractFromKey(e[e.length-1],i),l=c[c.length-1];let d=i.nsSeparator!==void 0?i.nsSeparator:this.options.nsSeparator;d===void 0&&(d=":");const h=i.lng||this.language,m=i.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(h?.toLowerCase()==="cimode")return m?s?{res:`${l}${d}${a}`,usedKey:a,exactUsedKey:a,usedLng:h,usedNS:l,usedParams:this.getUsedParamsDetails(i)}:`${l}${d}${a}`:s?{res:a,usedKey:a,exactUsedKey:a,usedLng:h,usedNS:l,usedParams:this.getUsedParamsDetails(i)}:a;const g=this.resolve(e,i);let y=g?.res;const v=g?.usedKey||a,E=g?.exactUsedKey||a,w=["[object Number]","[object Function]","[object RegExp]"],R=i.joinArrays!==void 0?i.joinArrays:this.options.joinArrays,x=!this.i18nFormat||this.i18nFormat.handleAsObject,C=i.count!==void 0&&!yt(i.count),k=w3.hasDefaultValue(i),T=C?this.pluralResolver.getSuffix(h,i.count,i):"",L=i.ordinal&&C?this.pluralResolver.getSuffix(h,i.count,{ordinal:!1}):"",O=C&&!i.ordinal&&i.count===0,P=O&&i[`defaultValue${this.options.pluralSeparator}zero`]||i[`defaultValue${T}`]||i[`defaultValue${L}`]||i.defaultValue;let D=y;x&&!y&&k&&(D=P);const j=M6(D),H=Object.prototype.toString.apply(D);if(x&&D&&j&&w.indexOf(H)<0&&!(yt(R)&&Array.isArray(D))){if(!i.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const z=this.options.returnedObjectHandler?this.options.returnedObjectHandler(v,D,{...i,ns:c}):`key '${a} (${this.language})' returned an object instead of string.`;return s?(g.res=z,g.usedParams=this.getUsedParamsDetails(i),g):z}if(o){const z=Array.isArray(D),Y=z?[]:{},W=z?E:v;for(const F in D)if(Object.prototype.hasOwnProperty.call(D,F)){const $=`${W}${o}${F}`;k&&!y?Y[F]=this.translate($,{...i,defaultValue:M6(P)?P[F]:void 0,joinArrays:!1,ns:c}):Y[F]=this.translate($,{...i,joinArrays:!1,ns:c}),Y[F]===$&&(Y[F]=D[F])}y=Y}}else if(x&&yt(R)&&Array.isArray(y))y=y.join(R),y&&(y=this.extendTranslation(y,e,i,r));else{let z=!1,Y=!1;!this.isValidLookup(y)&&k&&(z=!0,y=P),this.isValidLookup(y)||(Y=!0,y=a);const F=(i.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&Y?void 0:y,$=k&&P!==y&&this.options.updateMissing;if(Y||z||$){if(this.logger.log($?"updateKey":"missingKey",h,l,a,$?P:y),o){const q=this.resolve(a,{...i,keySeparator:!1});q&&q.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let V=[];const G=this.languageUtils.getFallbackCodes(this.options.fallbackLng,i.lng||this.language);if(this.options.saveMissingTo==="fallback"&&G&&G[0])for(let q=0;q<G.length;q++)V.push(G[q]);else this.options.saveMissingTo==="all"?V=this.languageUtils.toResolveHierarchy(i.lng||this.language):V.push(i.lng||this.language);const Z=(q,J,ue)=>{const ge=k&&ue!==y?ue:F;this.options.missingKeyHandler?this.options.missingKeyHandler(q,l,J,ge,$,i):this.backendConnector?.saveMissing&&this.backendConnector.saveMissing(q,l,J,ge,$,i),this.emit("missingKey",q,l,J,y)};this.options.saveMissing&&(this.options.saveMissingPlurals&&C?V.forEach(q=>{const J=this.pluralResolver.getSuffixes(q,i);O&&i[`defaultValue${this.options.pluralSeparator}zero`]&&J.indexOf(`${this.options.pluralSeparator}zero`)<0&&J.push(`${this.options.pluralSeparator}zero`),J.forEach(ue=>{Z([q],a+ue,i[`defaultValue${ue}`]||P)})}):Z(V,a,P))}y=this.extendTranslation(y,e,i,g,r),Y&&y===a&&this.options.appendNamespaceToMissingKey&&(y=`${l}${d}${a}`),(Y||z)&&this.options.parseMissingKeyHandler&&(y=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${l}${d}${a}`:a,z?y:void 0,i))}return s?(g.res=y,g.usedParams=this.getUsedParamsDetails(i),g):y}extendTranslation(e,n,r,i,s){if(this.i18nFormat?.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...r},r.lng||this.language||i.usedLng,i.usedNS,i.usedKey,{resolved:i});else if(!r.skipInterpolation){r.interpolation&&this.interpolator.init({...r,interpolation:{...this.options.interpolation,...r.interpolation}});const c=yt(e)&&(r?.interpolation?.skipOnVariables!==void 0?r.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let l;if(c){const h=e.match(this.interpolator.nestingRegexp);l=h&&h.length}let d=r.replace&&!yt(r.replace)?r.replace:r;if(this.options.interpolation.defaultVariables&&(d={...this.options.interpolation.defaultVariables,...d}),e=this.interpolator.interpolate(e,d,r.lng||this.language||i.usedLng,r),c){const h=e.match(this.interpolator.nestingRegexp),m=h&&h.length;l<m&&(r.nest=!1)}!r.lng&&i&&i.res&&(r.lng=this.language||i.usedLng),r.nest!==!1&&(e=this.interpolator.nest(e,(...h)=>s?.[0]===h[0]&&!r.context?(this.logger.warn(`It seems you are nesting recursively key: ${h[0]} in key: ${n[0]}`),null):this.translate(...h,n),r)),r.interpolation&&this.interpolator.reset()}const o=r.postProcess||this.options.postProcess,a=yt(o)?[o]:o;return e!=null&&a?.length&&r.applyPostProcessor!==!1&&(e=zoe.handle(a,e,n,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...i,usedParams:this.getUsedParamsDetails(r)},...r}:r,this)),e}resolve(e,n={}){let r,i,s,o,a;return yt(e)&&(e=[e]),e.forEach(c=>{if(this.isValidLookup(r))return;const l=this.extractFromKey(c,n),d=l.key;i=d;let h=l.namespaces;this.options.fallbackNS&&(h=h.concat(this.options.fallbackNS));const m=n.count!==void 0&&!yt(n.count),g=m&&!n.ordinal&&n.count===0,y=n.context!==void 0&&(yt(n.context)||typeof n.context=="number")&&n.context!=="",v=n.lngs?n.lngs:this.languageUtils.toResolveHierarchy(n.lng||this.language,n.fallbackLng);h.forEach(E=>{this.isValidLookup(r)||(a=E,!AK[`${v[0]}-${E}`]&&this.utils?.hasLoadedNamespace&&!this.utils?.hasLoadedNamespace(a)&&(AK[`${v[0]}-${E}`]=!0,this.logger.warn(`key "${i}" for languages "${v.join(", ")}" won't get resolved as namespace "${a}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),v.forEach(w=>{if(this.isValidLookup(r))return;o=w;const R=[d];if(this.i18nFormat?.addLookupKeys)this.i18nFormat.addLookupKeys(R,d,w,E,n);else{let C;m&&(C=this.pluralResolver.getSuffix(w,n.count,n));const k=`${this.options.pluralSeparator}zero`,T=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(m&&(n.ordinal&&C.indexOf(T)===0&&R.push(d+C.replace(T,this.options.pluralSeparator)),R.push(d+C),g&&R.push(d+k)),y){const L=`${d}${this.options.contextSeparator||"_"}${n.context}`;R.push(L),m&&(n.ordinal&&C.indexOf(T)===0&&R.push(L+C.replace(T,this.options.pluralSeparator)),R.push(L+C),g&&R.push(L+k))}}let x;for(;x=R.pop();)this.isValidLookup(r)||(s=x,r=this.getResource(w,E,x,n))}))})}),{res:r,usedKey:i,exactUsedKey:s,usedLng:o,usedNS:a}}isValidLookup(e){return e!==void 0&&!(!this.options.returnNull&&e===null)&&!(!this.options.returnEmptyString&&e==="")}getResource(e,n,r,i={}){return this.i18nFormat?.getResource?this.i18nFormat.getResource(e,n,r,i):this.resourceStore.getResource(e,n,r,i)}getUsedParamsDetails(e={}){const n=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],r=e.replace&&!yt(e.replace);let i=r?e.replace:e;if(r&&typeof e.count<"u"&&(i.count=e.count),this.options.interpolation.defaultVariables&&(i={...this.options.interpolation.defaultVariables,...i}),!r){i={...i};for(const s of n)delete i[s]}return i}static hasDefaultValue(e){const n="defaultValue";for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&n===r.substring(0,n.length)&&e[r]!==void 0)return!0;return!1}}class LK{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=wl.create("languageUtils")}getScriptPartFromCode(e){if(e=s_(e),!e||e.indexOf("-")<0)return null;const n=e.split("-");return n.length===2||(n.pop(),n[n.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(n.join("-"))}getLanguagePartFromCode(e){if(e=s_(e),!e||e.indexOf("-")<0)return e;const n=e.split("-");return this.formatLanguageCode(n[0])}formatLanguageCode(e){if(yt(e)&&e.indexOf("-")>-1){let n;try{n=Intl.getCanonicalLocales(e)[0]}catch{}return n&&this.options.lowerCaseLng&&(n=n.toLowerCase()),n||(this.options.lowerCaseLng?e.toLowerCase():e)}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let n;return e.forEach(r=>{if(n)return;const i=this.formatLanguageCode(r);(!this.options.supportedLngs||this.isSupportedCode(i))&&(n=i)}),!n&&this.options.supportedLngs&&e.forEach(r=>{if(n)return;const i=this.getScriptPartFromCode(r);if(this.isSupportedCode(i))return n=i;const s=this.getLanguagePartFromCode(r);if(this.isSupportedCode(s))return n=s;n=this.options.supportedLngs.find(o=>{if(o===s)return o;if(!(o.indexOf("-")<0&&s.indexOf("-")<0)&&(o.indexOf("-")>0&&s.indexOf("-")<0&&o.substring(0,o.indexOf("-"))===s||o.indexOf(s)===0&&s.length>1))return o})}),n||(n=this.getFallbackCodes(this.options.fallbackLng)[0]),n}getFallbackCodes(e,n){if(!e)return[];if(typeof e=="function"&&(e=e(n)),yt(e)&&(e=[e]),Array.isArray(e))return e;if(!n)return e.default||[];let r=e[n];return r||(r=e[this.getScriptPartFromCode(n)]),r||(r=e[this.formatLanguageCode(n)]),r||(r=e[this.getLanguagePartFromCode(n)]),r||(r=e.default),r||[]}toResolveHierarchy(e,n){const r=this.getFallbackCodes((n===!1?[]:n)||this.options.fallbackLng||[],e),i=[],s=o=>{o&&(this.isSupportedCode(o)?i.push(o):this.logger.warn(`rejecting language code not found in supportedLngs: ${o}`))};return yt(e)&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&s(this.formatLanguageCode(e)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&s(this.getScriptPartFromCode(e)),this.options.load!=="currentOnly"&&s(this.getLanguagePartFromCode(e))):yt(e)&&s(this.formatLanguageCode(e)),r.forEach(o=>{i.indexOf(o)<0&&s(this.formatLanguageCode(o))}),i}}const MK={zero:0,one:1,two:2,few:3,many:4,other:5},OK={select:t=>t===1?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class sDe{constructor(e,n={}){this.languageUtils=e,this.options=n,this.logger=wl.create("pluralResolver"),this.pluralRulesCache={}}addRule(e,n){this.rules[e]=n}clearCache(){this.pluralRulesCache={}}getRule(e,n={}){const r=s_(e==="dev"?"en":e),i=n.ordinal?"ordinal":"cardinal",s=JSON.stringify({cleanedCode:r,type:i});if(s in this.pluralRulesCache)return this.pluralRulesCache[s];let o;try{o=new Intl.PluralRules(r,{type:i})}catch{if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),OK;if(!e.match(/-|_/))return OK;const c=this.languageUtils.getLanguagePartFromCode(e);o=this.getRule(c,n)}return this.pluralRulesCache[s]=o,o}needsPlural(e,n={}){let r=this.getRule(e,n);return r||(r=this.getRule("dev",n)),r?.resolvedOptions().pluralCategories.length>1}getPluralFormsOfKey(e,n,r={}){return this.getSuffixes(e,r).map(i=>`${n}${i}`)}getSuffixes(e,n={}){let r=this.getRule(e,n);return r||(r=this.getRule("dev",n)),r?r.resolvedOptions().pluralCategories.sort((i,s)=>MK[i]-MK[s]).map(i=>`${this.options.prepend}${n.ordinal?`ordinal${this.options.prepend}`:""}${i}`):[]}getSuffix(e,n,r={}){const i=this.getRule(e,r);return i?`${this.options.prepend}${r.ordinal?`ordinal${this.options.prepend}`:""}${i.select(n)}`:(this.logger.warn(`no plural rule found for: ${e}`),this.getSuffix("dev",n,r))}}const PK=(t,e,n,r=".",i=!0)=>{let s=X9e(t,e,n);return!s&&i&&yt(n)&&(s=mM(t,n,r),s===void 0&&(s=mM(e,n,r))),s},O6=t=>t.replace(/\$/g,"$$$$");class DK{constructor(e={}){this.logger=wl.create("interpolator"),this.options=e,this.format=e?.interpolation?.format||(n=>n),this.init(e)}init(e={}){e.interpolation||(e.interpolation={escapeValue:!0});const{escape:n,escapeValue:r,useRawValueToEscape:i,prefix:s,prefixEscaped:o,suffix:a,suffixEscaped:c,formatSeparator:l,unescapeSuffix:d,unescapePrefix:h,nestingPrefix:m,nestingPrefixEscaped:g,nestingSuffix:y,nestingSuffixEscaped:v,nestingOptionsSeparator:E,maxReplaces:w,alwaysFormat:R}=e.interpolation;this.escape=n!==void 0?n:Q9e,this.escapeValue=r!==void 0?r:!0,this.useRawValueToEscape=i!==void 0?i:!1,this.prefix=s?bg(s):o||"{{",this.suffix=a?bg(a):c||"}}",this.formatSeparator=l||",",this.unescapePrefix=d?"":h||"-",this.unescapeSuffix=this.unescapePrefix?"":d||"",this.nestingPrefix=m?bg(m):g||bg("$t("),this.nestingSuffix=y?bg(y):v||bg(")"),this.nestingOptionsSeparator=E||",",this.maxReplaces=w||1e3,this.alwaysFormat=R!==void 0?R:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(n,r)=>n?.source===r?(n.lastIndex=0,n):new RegExp(r,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}((?:[^()"']+|"[^"]*"|'[^']*'|\\((?:[^()]|"[^"]*"|'[^']*')*\\))*?)${this.nestingSuffix}`)}interpolate(e,n,r,i){let s,o,a;const c=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},l=g=>{if(g.indexOf(this.formatSeparator)<0){const w=PK(n,c,g,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(w,void 0,r,{...i,...n,interpolationkey:g}):w}const y=g.split(this.formatSeparator),v=y.shift().trim(),E=y.join(this.formatSeparator).trim();return this.format(PK(n,c,v,this.options.keySeparator,this.options.ignoreJSONStructure),E,r,{...i,...n,interpolationkey:v})};this.resetRegExp();const d=i?.missingInterpolationHandler||this.options.missingInterpolationHandler,h=i?.interpolation?.skipOnVariables!==void 0?i.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:g=>O6(g)},{regex:this.regexp,safeValue:g=>this.escapeValue?O6(this.escape(g)):O6(g)}].forEach(g=>{for(a=0;s=g.regex.exec(e);){const y=s[1].trim();if(o=l(y),o===void 0)if(typeof d=="function"){const E=d(e,s,i);o=yt(E)?E:""}else if(i&&Object.prototype.hasOwnProperty.call(i,y))o="";else if(h){o=s[0];continue}else this.logger.warn(`missed to pass in variable ${y} for interpolating ${e}`),o="";else!yt(o)&&!this.useRawValueToEscape&&(o=TK(o));const v=g.safeValue(o);if(e=e.replace(s[0],v),h?(g.regex.lastIndex+=o.length,g.regex.lastIndex-=s[0].length):g.regex.lastIndex=0,a++,a>=this.maxReplaces)break}}),e}nest(e,n,r={}){let i,s,o;const a=(c,l)=>{const d=this.nestingOptionsSeparator;if(c.indexOf(d)<0)return c;const h=c.split(new RegExp(`${d}[ ]*{`));let m=`{${h[1]}`;c=h[0],m=this.interpolate(m,o);const g=m.match(/'/g),y=m.match(/"/g);((g?.length??0)%2===0&&!y||y.length%2!==0)&&(m=m.replace(/'/g,'"'));try{o=JSON.parse(m),l&&(o={...l,...o})}catch(v){return this.logger.warn(`failed parsing options string in nesting for key ${c}`,v),`${c}${d}${m}`}return o.defaultValue&&o.defaultValue.indexOf(this.prefix)>-1&&delete o.defaultValue,c};for(;i=this.nestingRegexp.exec(e);){let c=[];o={...r},o=o.replace&&!yt(o.replace)?o.replace:o,o.applyPostProcessor=!1,delete o.defaultValue;const l=/{.*}/.test(i[1])?i[1].lastIndexOf("}")+1:i[1].indexOf(this.formatSeparator);if(l!==-1&&(c=i[1].slice(l).split(this.formatSeparator).map(d=>d.trim()).filter(Boolean),i[1]=i[1].slice(0,l)),s=n(a.call(this,i[1].trim(),o),o),s&&i[0]===e&&!yt(s))return s;yt(s)||(s=TK(s)),s||(this.logger.warn(`missed to resolve ${i[1]} for nesting ${e}`),s=""),c.length&&(s=c.reduce((d,h)=>this.format(d,h,r.lng,{...r,interpolationkey:i[1].trim()}),s.trim())),e=e.replace(i[0],s),this.regexp.lastIndex=0}return e}}const oDe=t=>{let e=t.toLowerCase().trim();const n={};if(t.indexOf("(")>-1){const r=t.split("(");e=r[0].toLowerCase().trim();const i=r[1].substring(0,r[1].length-1);e==="currency"&&i.indexOf(":")<0?n.currency||(n.currency=i.trim()):e==="relativetime"&&i.indexOf(":")<0?n.range||(n.range=i.trim()):i.split(";").forEach(o=>{if(o){const[a,...c]=o.split(":"),l=c.join(":").trim().replace(/^'+|'+$/g,""),d=a.trim();n[d]||(n[d]=l),l==="false"&&(n[d]=!1),l==="true"&&(n[d]=!0),isNaN(l)||(n[d]=parseInt(l,10))}})}return{formatName:e,formatOptions:n}},NK=t=>{const e={};return(n,r,i)=>{let s=i;i&&i.interpolationkey&&i.formatParams&&i.formatParams[i.interpolationkey]&&i[i.interpolationkey]&&(s={...s,[i.interpolationkey]:void 0});const o=r+JSON.stringify(s);let a=e[o];return a||(a=t(s_(r),i),e[o]=a),a(n)}},aDe=t=>(e,n,r)=>t(s_(n),r)(e);class cDe{constructor(e={}){this.logger=wl.create("formatter"),this.options=e,this.init(e)}init(e,n={interpolation:{}}){this.formatSeparator=n.interpolation.formatSeparator||",";const r=n.cacheInBuiltFormats?NK:aDe;this.formats={number:r((i,s)=>{const o=new Intl.NumberFormat(i,{...s});return a=>o.format(a)}),currency:r((i,s)=>{const o=new Intl.NumberFormat(i,{...s,style:"currency"});return a=>o.format(a)}),datetime:r((i,s)=>{const o=new Intl.DateTimeFormat(i,{...s});return a=>o.format(a)}),relativetime:r((i,s)=>{const o=new Intl.RelativeTimeFormat(i,{...s});return a=>o.format(a,s.range||"day")}),list:r((i,s)=>{const o=new Intl.ListFormat(i,{...s});return a=>o.format(a)})}}add(e,n){this.formats[e.toLowerCase().trim()]=n}addCached(e,n){this.formats[e.toLowerCase().trim()]=NK(n)}format(e,n,r,i={}){const s=n.split(this.formatSeparator);if(s.length>1&&s[0].indexOf("(")>1&&s[0].indexOf(")")<0&&s.find(a=>a.indexOf(")")>-1)){const a=s.findIndex(c=>c.indexOf(")")>-1);s[0]=[s[0],...s.splice(1,a)].join(this.formatSeparator)}return s.reduce((a,c)=>{const{formatName:l,formatOptions:d}=oDe(c);if(this.formats[l]){let h=a;try{const m=i?.formatParams?.[i.interpolationkey]||{},g=m.locale||m.lng||i.locale||i.lng||r;h=this.formats[l](a,g,{...d,...i,...m})}catch(m){this.logger.warn(m)}return h}else this.logger.warn(`there was no format function for ${l}`);return a},e)}}const lDe=(t,e)=>{t.pending[e]!==void 0&&(delete t.pending[e],t.pendingCount--)};class uDe extends SR{constructor(e,n,r,i={}){super(),this.backend=e,this.store=n,this.services=r,this.languageUtils=r.languageUtils,this.options=i,this.logger=wl.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=i.maxParallelReads||10,this.readingCalls=0,this.maxRetries=i.maxRetries>=0?i.maxRetries:5,this.retryTimeout=i.retryTimeout>=1?i.retryTimeout:350,this.state={},this.queue=[],this.backend?.init?.(r,i.backend,i)}queueLoad(e,n,r,i){const s={},o={},a={},c={};return e.forEach(l=>{let d=!0;n.forEach(h=>{const m=`${l}|${h}`;!r.reload&&this.store.hasResourceBundle(l,h)?this.state[m]=2:this.state[m]<0||(this.state[m]===1?o[m]===void 0&&(o[m]=!0):(this.state[m]=1,d=!1,o[m]===void 0&&(o[m]=!0),s[m]===void 0&&(s[m]=!0),c[h]===void 0&&(c[h]=!0)))}),d||(a[l]=!0)}),(Object.keys(s).length||Object.keys(o).length)&&this.queue.push({pending:o,pendingCount:Object.keys(o).length,loaded:{},errors:[],callback:i}),{toLoad:Object.keys(s),pending:Object.keys(o),toLoadLanguages:Object.keys(a),toLoadNamespaces:Object.keys(c)}}loaded(e,n,r){const i=e.split("|"),s=i[0],o=i[1];n&&this.emit("failedLoading",s,o,n),!n&&r&&this.store.addResourceBundle(s,o,r,void 0,void 0,{skipCopy:!0}),this.state[e]=n?-1:2,n&&r&&(this.state[e]=0);const a={};this.queue.forEach(c=>{Y9e(c.loaded,[s],o),lDe(c,e),n&&c.errors.push(n),c.pendingCount===0&&!c.done&&(Object.keys(c.loaded).forEach(l=>{a[l]||(a[l]={});const d=c.loaded[l];d.length&&d.forEach(h=>{a[l][h]===void 0&&(a[l][h]=!0)})}),c.done=!0,c.errors.length?c.callback(c.errors):c.callback())}),this.emit("loaded",a),this.queue=this.queue.filter(c=>!c.done)}read(e,n,r,i=0,s=this.retryTimeout,o){if(!e.length)return o(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:e,ns:n,fcName:r,tried:i,wait:s,callback:o});return}this.readingCalls++;const a=(l,d)=>{if(this.readingCalls--,this.waitingReads.length>0){const h=this.waitingReads.shift();this.read(h.lng,h.ns,h.fcName,h.tried,h.wait,h.callback)}if(l&&d&&i<this.maxRetries){setTimeout(()=>{this.read.call(this,e,n,r,i+1,s*2,o)},s);return}o(l,d)},c=this.backend[r].bind(this.backend);if(c.length===2){try{const l=c(e,n);l&&typeof l.then=="function"?l.then(d=>a(null,d)).catch(a):a(null,l)}catch(l){a(l)}return}return c(e,n,a)}prepareLoading(e,n,r={},i){if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),i&&i();yt(e)&&(e=this.languageUtils.toResolveHierarchy(e)),yt(n)&&(n=[n]);const s=this.queueLoad(e,n,r,i);if(!s.toLoad.length)return s.pending.length||i(),null;s.toLoad.forEach(o=>{this.loadOne(o)})}load(e,n,r){this.prepareLoading(e,n,{},r)}reload(e,n,r){this.prepareLoading(e,n,{reload:!0},r)}loadOne(e,n=""){const r=e.split("|"),i=r[0],s=r[1];this.read(i,s,"read",void 0,void 0,(o,a)=>{o&&this.logger.warn(`${n}loading namespace ${s} for language ${i} failed`,o),!o&&a&&this.logger.log(`${n}loaded namespace ${s} for language ${i}`,a),this.loaded(e,o,a)})}saveMissing(e,n,r,i,s,o={},a=()=>{}){if(this.services?.utils?.hasLoadedNamespace&&!this.services?.utils?.hasLoadedNamespace(n)){this.logger.warn(`did not save key "${r}" as the namespace "${n}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(r==null||r==="")){if(this.backend?.create){const c={...o,isUpdate:s},l=this.backend.create.bind(this.backend);if(l.length<6)try{let d;l.length===5?d=l(e,n,r,i,c):d=l(e,n,r,i),d&&typeof d.then=="function"?d.then(h=>a(null,h)).catch(a):a(null,d)}catch(d){a(d)}else l(e,n,r,i,a,c)}!e||!e[0]||this.store.addResource(e[0],n,r,i)}}}const UK=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:t=>{let e={};if(typeof t[1]=="object"&&(e=t[1]),yt(t[1])&&(e.defaultValue=t[1]),yt(t[2])&&(e.tDescription=t[2]),typeof t[2]=="object"||typeof t[3]=="object"){const n=t[3]||t[2];Object.keys(n).forEach(r=>{e[r]=n[r]})}return e},interpolation:{escapeValue:!0,format:t=>t,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0},cacheInBuiltFormats:!0}),jK=t=>(yt(t.ns)&&(t.ns=[t.ns]),yt(t.fallbackLng)&&(t.fallbackLng=[t.fallbackLng]),yt(t.fallbackNS)&&(t.fallbackNS=[t.fallbackNS]),t.supportedLngs?.indexOf?.("cimode")<0&&(t.supportedLngs=t.supportedLngs.concat(["cimode"])),typeof t.initImmediate=="boolean"&&(t.initAsync=t.initImmediate),t),Aw=()=>{},dDe=t=>{Object.getOwnPropertyNames(Object.getPrototypeOf(t)).forEach(n=>{typeof t[n]=="function"&&(t[n]=t[n].bind(t))})};class ob extends SR{constructor(e={},n){if(super(),this.options=jK(e),this.services={},this.logger=wl,this.modules={external:[]},dDe(this),n&&!this.isInitialized&&!e.isClone){if(!this.options.initAsync)return this.init(e,n),this;setTimeout(()=>{this.init(e,n)},0)}}init(e={},n){this.isInitializing=!0,typeof e=="function"&&(n=e,e={}),e.defaultNS==null&&e.ns&&(yt(e.ns)?e.defaultNS=e.ns:e.ns.indexOf("translation")<0&&(e.defaultNS=e.ns[0]));const r=UK();this.options={...r,...this.options,...jK(e)},this.options.interpolation={...r.interpolation,...this.options.interpolation},e.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=e.keySeparator),e.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=e.nsSeparator),typeof this.options.overloadTranslationOptionHandler!="function"&&(this.options.overloadTranslationOptionHandler=r.overloadTranslationOptionHandler);const i=l=>l?typeof l=="function"?new l:l:null;if(!this.options.isClone){this.modules.logger?wl.init(i(this.modules.logger),this.options):wl.init(null,this.options);let l;this.modules.formatter?l=this.modules.formatter:l=cDe;const d=new LK(this.options);this.store=new xK(this.options.resources,this.options);const h=this.services;h.logger=wl,h.resourceStore=this.store,h.languageUtils=d,h.pluralResolver=new sDe(d,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),this.options.interpolation.format&&this.options.interpolation.format!==r.interpolation.format&&this.logger.deprecate("init: you are still using the legacy format function, please use the new approach: https://www.i18next.com/translation-function/formatting"),l&&(!this.options.interpolation.format||this.options.interpolation.format===r.interpolation.format)&&(h.formatter=i(l),h.formatter.init&&h.formatter.init(h,this.options),this.options.interpolation.format=h.formatter.format.bind(h.formatter)),h.interpolator=new DK(this.options),h.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},h.backendConnector=new uDe(i(this.modules.backend),h.resourceStore,h,this.options),h.backendConnector.on("*",(g,...y)=>{this.emit(g,...y)}),this.modules.languageDetector&&(h.languageDetector=i(this.modules.languageDetector),h.languageDetector.init&&h.languageDetector.init(h,this.options.detection,this.options)),this.modules.i18nFormat&&(h.i18nFormat=i(this.modules.i18nFormat),h.i18nFormat.init&&h.i18nFormat.init(this)),this.translator=new w3(this.services,this.options),this.translator.on("*",(g,...y)=>{this.emit(g,...y)}),this.modules.external.forEach(g=>{g.init&&g.init(this)})}if(this.format=this.options.interpolation.format,n||(n=Aw),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const l=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);l.length>0&&l[0]!=="dev"&&(this.options.lng=l[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(l=>{this[l]=(...d)=>this.store[l](...d)}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(l=>{this[l]=(...d)=>(this.store[l](...d),this)});const a=s1(),c=()=>{const l=(d,h)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),a.resolve(h),n(d,h)};if(this.languages&&!this.isInitialized)return l(null,this.t.bind(this));this.changeLanguage(this.options.lng,l)};return this.options.resources||!this.options.initAsync?c():setTimeout(c,0),a}loadResources(e,n=Aw){let r=n;const i=yt(e)?e:this.language;if(typeof e=="function"&&(r=e),!this.options.resources||this.options.partialBundledLanguages){if(i?.toLowerCase()==="cimode"&&(!this.options.preload||this.options.preload.length===0))return r();const s=[],o=a=>{if(!a||a==="cimode")return;this.services.languageUtils.toResolveHierarchy(a).forEach(l=>{l!=="cimode"&&s.indexOf(l)<0&&s.push(l)})};i?o(i):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(c=>o(c)),this.options.preload?.forEach?.(a=>o(a)),this.services.backendConnector.load(s,this.options.ns,a=>{!a&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),r(a)})}else r(null)}reloadResources(e,n,r){const i=s1();return typeof e=="function"&&(r=e,e=void 0),typeof n=="function"&&(r=n,n=void 0),e||(e=this.languages),n||(n=this.options.ns),r||(r=Aw),this.services.backendConnector.reload(e,n,s=>{i.resolve(),r(s)}),i}use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return e.type==="backend"&&(this.modules.backend=e),(e.type==="logger"||e.log&&e.warn&&e.error)&&(this.modules.logger=e),e.type==="languageDetector"&&(this.modules.languageDetector=e),e.type==="i18nFormat"&&(this.modules.i18nFormat=e),e.type==="postProcessor"&&zoe.addPostProcessor(e),e.type==="formatter"&&(this.modules.formatter=e),e.type==="3rdParty"&&this.modules.external.push(e),this}setResolvedLanguage(e){if(!(!e||!this.languages)&&!(["cimode","dev"].indexOf(e)>-1)){for(let n=0;n<this.languages.length;n++){const r=this.languages[n];if(!(["cimode","dev"].indexOf(r)>-1)&&this.store.hasLanguageSomeTranslations(r)){this.resolvedLanguage=r;break}}!this.resolvedLanguage&&this.languages.indexOf(e)<0&&this.store.hasLanguageSomeTranslations(e)&&(this.resolvedLanguage=e,this.languages.unshift(e))}}changeLanguage(e,n){this.isLanguageChangingTo=e;const r=s1();this.emit("languageChanging",e);const i=a=>{this.language=a,this.languages=this.services.languageUtils.toResolveHierarchy(a),this.resolvedLanguage=void 0,this.setResolvedLanguage(a)},s=(a,c)=>{c?this.isLanguageChangingTo===e&&(i(c),this.translator.changeLanguage(c),this.isLanguageChangingTo=void 0,this.emit("languageChanged",c),this.logger.log("languageChanged",c)):this.isLanguageChangingTo=void 0,r.resolve((...l)=>this.t(...l)),n&&n(a,(...l)=>this.t(...l))},o=a=>{!e&&!a&&this.services.languageDetector&&(a=[]);const c=yt(a)?a:a&&a[0],l=this.store.hasLanguageSomeTranslations(c)?c:this.services.languageUtils.getBestMatchFromCodes(yt(a)?[a]:a);l&&(this.language||i(l),this.translator.language||this.translator.changeLanguage(l),this.services.languageDetector?.cacheUserLanguage?.(l)),this.loadResources(l,d=>{s(d,l)})};return!e&&this.services.languageDetector&&!this.services.languageDetector.async?o(this.services.languageDetector.detect()):!e&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(o):this.services.languageDetector.detect(o):o(e),r}getFixedT(e,n,r){const i=(s,o,...a)=>{let c;typeof o!="object"?c=this.options.overloadTranslationOptionHandler([s,o].concat(a)):c={...o},c.lng=c.lng||i.lng,c.lngs=c.lngs||i.lngs,c.ns=c.ns||i.ns,c.keyPrefix!==""&&(c.keyPrefix=c.keyPrefix||r||i.keyPrefix);const l=this.options.keySeparator||".";let d;return c.keyPrefix&&Array.isArray(s)?d=s.map(h=>(typeof h=="function"&&(h=S3(h,{...this.options,...o})),`${c.keyPrefix}${l}${h}`)):(typeof s=="function"&&(s=S3(s,{...this.options,...o})),d=c.keyPrefix?`${c.keyPrefix}${l}${s}`:s),this.t(d,c)};return yt(e)?i.lng=e:i.lngs=e,i.ns=n,i.keyPrefix=r,i}t(...e){return this.translator?.translate(...e)}exists(...e){return this.translator?.exists(...e)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e,n={}){if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const r=n.lng||this.resolvedLanguage||this.languages[0],i=this.options?this.options.fallbackLng:!1,s=this.languages[this.languages.length-1];if(r.toLowerCase()==="cimode")return!0;const o=(a,c)=>{const l=this.services.backendConnector.state[`${a}|${c}`];return l===-1||l===0||l===2};if(n.precheck){const a=n.precheck(this,o);if(a!==void 0)return a}return!!(this.hasResourceBundle(r,e)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||o(r,e)&&(!i||o(s,e)))}loadNamespaces(e,n){const r=s1();return this.options.ns?(yt(e)&&(e=[e]),e.forEach(i=>{this.options.ns.indexOf(i)<0&&this.options.ns.push(i)}),this.loadResources(i=>{r.resolve(),n&&n(i)}),r):(n&&n(),Promise.resolve())}loadLanguages(e,n){const r=s1();yt(e)&&(e=[e]);const i=this.options.preload||[],s=e.filter(o=>i.indexOf(o)<0&&this.services.languageUtils.isSupportedCode(o));return s.length?(this.options.preload=i.concat(s),this.loadResources(o=>{r.resolve(),n&&n(o)}),r):(n&&n(),Promise.resolve())}dir(e){if(e||(e=this.resolvedLanguage||(this.languages?.length>0?this.languages[0]:this.language)),!e)return"rtl";try{const i=new Intl.Locale(e);if(i&&i.getTextInfo){const s=i.getTextInfo();if(s&&s.direction)return s.direction}}catch{}const n=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],r=this.services?.languageUtils||new LK(UK());return e.toLowerCase().indexOf("-latn")>1?"ltr":n.indexOf(r.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(e={},n){const r=new ob(e,n);return r.createInstance=ob.createInstance,r}cloneInstance(e={},n=Aw){const r=e.forkResourceStore;r&&delete e.forkResourceStore;const i={...this.options,...e,isClone:!0},s=new ob(i);if((e.debug!==void 0||e.prefix!==void 0)&&(s.logger=s.logger.clone(e)),["store","services","language"].forEach(a=>{s[a]=this[a]}),s.services={...this.services},s.services.utils={hasLoadedNamespace:s.hasLoadedNamespace.bind(s)},r){const a=Object.keys(this.store.data).reduce((c,l)=>(c[l]={...this.store.data[l]},c[l]=Object.keys(c[l]).reduce((d,h)=>(d[h]={...c[l][h]},d),c[l]),c),{});s.store=new xK(a,i),s.services.resourceStore=s.store}return e.interpolation&&(s.services.interpolator=new DK(i)),s.translator=new w3(s.services,i),s.translator.on("*",(a,...c)=>{s.emit(a,...c)}),s.init(i,n),s.translator.options=i,s.translator.backendConnector.services.utils={hasLoadedNamespace:s.hasLoadedNamespace.bind(s)},s}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const gs=ob.createInstance();gs.createInstance;gs.dir;gs.init;gs.loadResources;gs.reloadResources;gs.use;gs.changeLanguage;gs.getFixedT;const $i=gs.t;gs.exists;gs.setDefaultNamespace;gs.hasLoadedNamespace;gs.loadNamespaces;gs.loadLanguages;var P6,FK;function fDe(){return FK||(FK=1,P6={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0}),P6}var hDe=fDe();const pDe=Dl(hDe);var mDe=/\s([^'"/\s><]+?)[\s/>]|([^\s=]+)=\s?(".*?"|'.*?')/g;function $K(t){var e={type:"tag",name:"",voidElement:!1,attrs:{},children:[]},n=t.match(/<\/?([^\s]+?)[/\s>]/);if(n&&(e.name=n[1],(pDe[n[1]]||t.charAt(t.length-2)==="/")&&(e.voidElement=!0),e.name.startsWith("!--"))){var r=t.indexOf("-->");return{type:"comment",comment:r!==-1?t.slice(4,r):""}}for(var i=new RegExp(mDe),s=null;(s=i.exec(t))!==null;)if(s[0].trim())if(s[1]){var o=s[1].trim(),a=[o,""];o.indexOf("=")>-1&&(a=o.split("=")),e.attrs[a[0]]=a[1],i.lastIndex--}else s[2]&&(e.attrs[s[2]]=s[3].trim().substring(1,s[3].length-1));return e}var gDe=/<[a-zA-Z0-9\-\!\/](?:"[^"]*"|'[^']*'|[^'">])*>/g,vDe=/^\s*$/,yDe=Object.create(null);function Yoe(t,e){switch(e.type){case"text":return t+e.content;case"tag":return t+="<"+e.name+(e.attrs?(function(n){var r=[];for(var i in n)r.push(i+'="'+n[i]+'"');return r.length?" "+r.join(" "):""})(e.attrs):"")+(e.voidElement?"/>":">"),e.voidElement?t:t+e.children.reduce(Yoe,"")+"</"+e.name+">";case"comment":return t+"<!--"+e.comment+"-->"}}var bDe={parse:function(t,e){e||(e={}),e.components||(e.components=yDe);var n,r=[],i=[],s=-1,o=!1;if(t.indexOf("<")!==0){var a=t.indexOf("<");r.push({type:"text",content:a===-1?t:t.substring(0,a)})}return t.replace(gDe,function(c,l){if(o){if(c!=="</"+n.name+">")return;o=!1}var d,h=c.charAt(1)!=="/",m=c.startsWith("<!--"),g=l+c.length,y=t.charAt(g);if(m){var v=$K(c);return s<0?(r.push(v),r):((d=i[s]).children.push(v),r)}if(h&&(s++,(n=$K(c)).type==="tag"&&e.components[n.name]&&(n.type="component",o=!0),n.voidElement||o||!y||y==="<"||n.children.push({type:"text",content:t.slice(g,t.indexOf("<",g))}),s===0&&r.push(n),(d=i[s-1])&&d.children.push(n),i[s]=n),(!h||n.voidElement)&&(s>-1&&(n.voidElement||n.name===c.slice(2,-1))&&(s--,n=s===-1?r:i[s]),!o&&y!=="<"&&y)){d=s===-1?r:i[s].children;var E=t.indexOf("<",g),w=t.slice(g,E===-1?void 0:E);vDe.test(w)&&(w=" "),(E>-1&&s+d.length>=0||w!==" ")&&d.push({type:"text",content:w})}}),r},stringify:function(t){return t.reduce(function(e,n){return e+Yoe("",n)},"")}};const ZE=(t,e,n,r)=>{const i=[n,{code:e,...r||{}}];if(t?.services?.logger?.forward)return t.services.logger.forward(i,"warn","react-i18next::",!0);Ka(i[0])&&(i[0]=`react-i18next:: ${i[0]}`),t?.services?.logger?.warn?t.services.logger.warn(...i):console?.warn&&console.warn(...i)},BK={},o_=(t,e,n,r)=>{Ka(n)&&BK[n]||(Ka(n)&&(BK[n]=new Date),ZE(t,e,n,r))},Xoe=(t,e)=>()=>{if(t.isInitialized)e();else{const n=()=>{setTimeout(()=>{t.off("initialized",n)},0),e()};t.on("initialized",n)}},gM=(t,e,n)=>{t.loadNamespaces(e,Xoe(t,n))},HK=(t,e,n,r)=>{if(Ka(n)&&(n=[n]),t.options.preload&&t.options.preload.indexOf(e)>-1)return gM(t,n,r);n.forEach(i=>{t.options.ns.indexOf(i)<0&&t.options.ns.push(i)}),t.loadLanguages(e,Xoe(t,r))},_De=(t,e,n={})=>!e.languages||!e.languages.length?(o_(e,"NO_LANGUAGES","i18n.languages were undefined or empty",{languages:e.languages}),!0):e.hasLoadedNamespace(t,{lng:n.lng,precheck:(r,i)=>{if(n.bindI18n&&n.bindI18n.indexOf("languageChanging")>-1&&r.services.backendConnector.backend&&r.isLanguageChangingTo&&!i(r.isLanguageChangingTo,t))return!1}}),Ka=t=>typeof t=="string",Ef=t=>typeof t=="object"&&t!==null,SDe=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,wDe={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"©","&#169;":"©","&reg;":"®","&#174;":"®","&hellip;":"…","&#8230;":"…","&#x2F;":"/","&#47;":"/"},EDe=t=>wDe[t],CDe=t=>t.replace(SDe,EDe);let vM={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:CDe};const TDe=(t={})=>{vM={...vM,...t}},Joe=()=>vM;let Qoe;const RDe=t=>{Qoe=t},N8=()=>Qoe,D6=(t,e)=>{if(!t)return!1;const n=t.props?.children??t.children;return e?n.length>0:!!n},N6=t=>{if(!t)return[];const e=t.props?.children??t.children;return t.props?.i18nIsDynamicList?Hg(e):e},kDe=t=>Array.isArray(t)&&t.every(_.isValidElement),Hg=t=>Array.isArray(t)?t:[t],IDe=(t,e)=>{const n={...e};return n.props=Object.assign(t.props,e.props),n},Zoe=(t,e,n,r)=>{if(!t)return"";let i="";const s=Hg(t),o=e?.transSupportBasicHtmlNodes?e.transKeepBasicHtmlNodesFor??[]:[];return s.forEach((a,c)=>{if(Ka(a)){i+=`${a}`;return}if(_.isValidElement(a)){const{props:l,type:d}=a,h=Object.keys(l).length,m=o.indexOf(d)>-1,g=l.children;if(!g&&m&&!h){i+=`<${d}/>`;return}if(!g&&(!m||h)||l.i18nIsDynamicList){i+=`<${c}></${c}>`;return}if(m&&h===1&&Ka(g)){i+=`<${d}>${g}</${d}>`;return}const y=Zoe(g,e,n,r);i+=`<${c}>${y}</${c}>`;return}if(a===null){ZE(n,"TRANS_NULL_VALUE","Passed in a null value as child",{i18nKey:r});return}if(Ef(a)){const{format:l,...d}=a,h=Object.keys(d);if(h.length===1){const m=l?`${h[0]}, ${l}`:h[0];i+=`{{${m}}}`;return}ZE(n,"TRANS_INVALID_OBJ","Invalid child - Object should only have keys {{ value, format }} (format is optional).",{i18nKey:r,child:a});return}ZE(n,"TRANS_INVALID_VAR","Passed in a variable like {number} - pass variables for interpolation as full objects like {{number}}.",{i18nKey:r,child:a})}),i},xDe=(t,e,n,r,i,s,o)=>{if(n==="")return[];const a=i.transKeepBasicHtmlNodesFor||[],c=n&&new RegExp(a.map(w=>`<${w}`).join("|")).test(n);if(!t&&!e&&!c&&!o)return[n];const l=e??{},d=w=>{Hg(w).forEach(x=>{Ka(x)||(D6(x)?d(N6(x)):Ef(x)&&!_.isValidElement(x)&&Object.assign(l,x))})};d(t);const h=bDe.parse(`<0>${n}</0>`),m={...l,...s},g=(w,R,x)=>{const C=N6(w),k=v(C,R.children,x);return kDe(C)&&k.length===0||w.props?.i18nIsDynamicList?C:k},y=(w,R,x,C,k)=>{w.dummy?(w.children=R,x.push(_.cloneElement(w,{key:C},k?void 0:R))):x.push(..._.Children.map([w],T=>{const L={...T.props};return delete L.i18nIsDynamicList,_.createElement(T.type,{...L,key:C,ref:T.props.ref??T.ref},k?null:R)}))},v=(w,R,x)=>{const C=Hg(w);return Hg(R).reduce((T,L,O)=>{const P=L.children?.[0]?.content&&r.services.interpolator.interpolate(L.children[0].content,m,r.language);if(L.type==="tag"){let D=C[parseInt(L.name,10)];!D&&e&&(D=e[L.name]),x.length===1&&!D&&(D=x[0][L.name]),D||(D={});const j=Object.keys(L.attrs).length!==0?IDe({props:L.attrs},D):D,H=_.isValidElement(j),z=H&&D6(L,!0)&&!L.voidElement,Y=c&&Ef(j)&&j.dummy&&!H,W=Ef(e)&&Object.hasOwnProperty.call(e,L.name);if(Ka(j)){const F=r.services.interpolator.interpolate(j,m,r.language);T.push(F)}else if(D6(j)||z){const F=g(j,L,x);y(j,F,T,O)}else if(Y){const F=v(C,L.children,x);y(j,F,T,O)}else if(Number.isNaN(parseFloat(L.name)))if(W){const F=g(j,L,x);y(j,F,T,O,L.voidElement)}else if(i.transSupportBasicHtmlNodes&&a.indexOf(L.name)>-1)if(L.voidElement)T.push(_.createElement(L.name,{key:`${L.name}-${O}`}));else{const F=v(C,L.children,x);T.push(_.createElement(L.name,{key:`${L.name}-${O}`},F))}else if(L.voidElement)T.push(`<${L.name} />`);else{const F=v(C,L.children,x);T.push(`<${L.name}>${F}</${L.name}>`)}else if(Ef(j)&&!H){const F=L.children[0]?P:null;F&&T.push(F)}else y(j,P,T,O,L.children.length!==1||!P)}else if(L.type==="text"){const D=i.transWrapTextNodes,j=o?i.unescape(r.services.interpolator.interpolate(L.content,m,r.language)):r.services.interpolator.interpolate(L.content,m,r.language);D?T.push(_.createElement(D,{key:`${L.name}-${O}`},j)):T.push(j)}return T},[])},E=v([{dummy:!0,children:t||[]}],h,Hg(t||[]));return N6(E[0])},eae=(t,e,n)=>{const r=t.key||e,i=_.cloneElement(t,{key:r});if(!i.props||!i.props.children||n.indexOf(`${e}/>`)<0&&n.indexOf(`${e} />`)<0)return i;function s(){return _.createElement(_.Fragment,null,i)}return _.createElement(s,{key:r})},ADe=(t,e)=>t.map((n,r)=>eae(n,r,e)),LDe=(t,e)=>{const n={};return Object.keys(t).forEach(r=>{Object.assign(n,{[r]:eae(t[r],r,e)})}),n},MDe=(t,e,n,r)=>t?Array.isArray(t)?ADe(t,e):Ef(t)?LDe(t,e):(o_(n,"TRANS_INVALID_COMPONENTS",'<Trans /> "components" prop expects an object or array',{i18nKey:r}),null):null,ODe=t=>!Ef(t)||Array.isArray(t)?!1:Object.keys(t).reduce((e,n)=>e&&Number.isNaN(Number.parseFloat(n)),!0);function PDe({children:t,count:e,parent:n,i18nKey:r,context:i,tOptions:s={},values:o,defaults:a,components:c,ns:l,i18n:d,t:h,shouldUnescape:m,...g}){const y=d||N8();if(!y)return o_(y,"NO_I18NEXT_INSTANCE","Trans: You need to pass in an i18next instance using i18nextReactModule",{i18nKey:r}),t;const v=h||y.t.bind(y)||(Y=>Y),E={...Joe(),...y.options?.react};let w=l||v.ns||y.options?.defaultNS;w=Ka(w)?[w]:w||["translation"];const R=Zoe(t,E,y,r),x=a||R||E.transEmptyNodeValue||(typeof r=="function"?S3(r):r),{hashTransKey:C}=E,k=r||(C?C(R||x):R||x);y.options?.interpolation?.defaultVariables&&(o=o&&Object.keys(o).length>0?{...o,...y.options.interpolation.defaultVariables}:{...y.options.interpolation.defaultVariables});const T=o||e!==void 0&&!y.options?.interpolation?.alwaysFormat||!t?s.interpolation:{interpolation:{...s.interpolation,prefix:"#$?",suffix:"?$#"}},L={...s,context:i||s.context,count:e,...o,...T,defaultValue:x,ns:w},O=k?v(k,L):x,P=MDe(c,O,y,r);let D=P||t,j=null;ODe(P)&&(j=P,D=t);const H=xDe(D,j,O,y,E,L,m),z=n??E.defaultTransParent;return z?_.createElement(z,g,H):H}const DDe={type:"3rdParty",init(t){TDe(t.options.react),RDe(t)}},tae=_.createContext();class NDe{constructor(){this.usedNamespaces={}}addUsedNamespaces(e){e.forEach(n=>{this.usedNamespaces[n]||(this.usedNamespaces[n]=!0)})}getUsedNamespaces(){return Object.keys(this.usedNamespaces)}}function mo({children:t,count:e,parent:n,i18nKey:r,context:i,tOptions:s={},values:o,defaults:a,components:c,ns:l,i18n:d,t:h,shouldUnescape:m,...g}){const{i18n:y,defaultNS:v}=_.useContext(tae)||{},E=d||y||N8(),w=h||E?.t.bind(E);return PDe({children:t,count:e,parent:n,i18nKey:r,context:i,tOptions:s,values:o,defaults:a,components:c,ns:l||w?.ns||v||E?.options?.defaultNS,i18n:E,t:h,shouldUnescape:m,...g})}const UDe=(t,e)=>{const n=_.useRef();return _.useEffect(()=>{n.current=t},[t,e]),n.current},nae=(t,e,n,r)=>t.getFixedT(e,n,r),jDe=(t,e,n,r)=>_.useCallback(nae(t,e,n,r),[t,e,n,r]),et=(t,e={})=>{const{i18n:n}=e,{i18n:r,defaultNS:i}=_.useContext(tae)||{},s=n||r||N8();if(s&&!s.reportNamespaces&&(s.reportNamespaces=new NDe),!s){o_(s,"NO_I18NEXT_INSTANCE","useTranslation: You will need to pass in an i18next instance by using initReactI18next");const C=(T,L)=>Ka(L)?L:Ef(L)&&Ka(L.defaultValue)?L.defaultValue:Array.isArray(T)?T[T.length-1]:T,k=[C,{},!1];return k.t=C,k.i18n={},k.ready=!1,k}s.options.react?.wait&&o_(s,"DEPRECATED_OPTION","useTranslation: It seems you are still using the old wait option, you may migrate to the new useSuspense behaviour.");const o={...Joe(),...s.options.react,...e},{useSuspense:a,keyPrefix:c}=o;let l=i||s.options?.defaultNS;l=Ka(l)?[l]:l||["translation"],s.reportNamespaces.addUsedNamespaces?.(l);const d=(s.isInitialized||s.initializedStoreOnce)&&l.every(C=>_De(C,s,o)),h=jDe(s,e.lng||null,o.nsMode==="fallback"?l:l[0],c),m=()=>h,g=()=>nae(s,e.lng||null,o.nsMode==="fallback"?l:l[0],c),[y,v]=_.useState(m);let E=l.join();e.lng&&(E=`${e.lng}${E}`);const w=UDe(E),R=_.useRef(!0);_.useEffect(()=>{const{bindI18n:C,bindI18nStore:k}=o;R.current=!0,!d&&!a&&(e.lng?HK(s,e.lng,l,()=>{R.current&&v(g)}):gM(s,l,()=>{R.current&&v(g)})),d&&w&&w!==E&&R.current&&v(g);const T=()=>{R.current&&v(g)};return C&&s?.on(C,T),k&&s?.store.on(k,T),()=>{R.current=!1,s&&C&&C?.split(" ").forEach(L=>s.off(L,T)),k&&s&&k.split(" ").forEach(L=>s.store.off(L,T))}},[s,E]),_.useEffect(()=>{R.current&&d&&v(m)},[s,c,d]);const x=[y,s,d];if(x.t=y,x.i18n=s,x.ready=d,d||!d&&!a)return x;throw new Promise(C=>{e.lng?HK(s,e.lng,l,()=>C()):gM(s,l,()=>C())})};function rae(t,e){return S.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:S.jsx("path",{fillRule:"evenodd",d:"m12 4.236-6 3V12c0 5.156 4.239 7.254 6 7.898 1.761-.644 6-2.742 6-7.898V7.236zm-.894-1.789a2 2 0 0 1 1.788 0l6 3A2 2 0 0 1 20 7.236V12c0 6.742-5.773 9.246-7.51 9.846-.32.111-.66.111-.98 0C9.774 21.246 4 18.743 4 12V7.236a2 2 0 0 1 1.106-1.789z",clipRule:"evenodd"})})}rae.displayName="AdminIcon";const FDe=_.forwardRef(rae);function iae(t,e){return S.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:S.jsx("path",{d:"m12 10.775-3.9 3.9a.95.95 0 0 1-.7.275.95.95 0 0 1-.7-.275.95.95 0 0 1-.275-.7q0-.425.275-.7l4.6-4.6q.15-.15.325-.212Q11.8 8.4 12 8.4t.375.063a.9.9 0 0 1 .325.212l4.6 4.6a.95.95 0 0 1 .275.7.95.95 0 0 1-.275.7.95.95 0 0 1-.7.275.95.95 0 0 1-.7-.275z"})})}iae.displayName="ChevronUpIcon";const $De=_.forwardRef(iae);function sae(t,e){return S.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:S.jsx("path",{d:"M12 11.034a1 1 0 0 0 .29.702l.005.005c.18.18.43.29.705.29h8a1 1 0 0 0 0-2h-5.586L22 3.445a1 1 0 0 0-1.414-1.414L14 8.617V3.031a1 1 0 1 0-2 0zm0 1.963a1 1 0 0 0-.29-.702l-.005-.004A1 1 0 0 0 11 12H3a1 1 0 1 0 0 2h5.586L2 20.586A1 1 0 1 0 3.414 22L10 15.414V21a1 1 0 0 0 2 0z"})})}sae.displayName="CollapseIcon";const oae=_.forwardRef(sae);function aae(t,e){return S.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:S.jsx("path",{d:"M7 21q-.824 0-1.412-.587A1.93 1.93 0 0 1 5 19V6a.97.97 0 0 1-.713-.287A.97.97 0 0 1 4 5q0-.424.287-.713A.97.97 0 0 1 5 4h4q0-.424.287-.712A.97.97 0 0 1 10 3h4q.424 0 .713.288Q15 3.575 15 4h4q.424 0 .712.287Q20 4.576 20 5t-.288.713A.97.97 0 0 1 19 6v13q0 .824-.587 1.413A1.93 1.93 0 0 1 17 21zM7 6v13h10V6zm2 10q0 .424.287.712Q9.576 17 10 17t.713-.288A.97.97 0 0 0 11 16V9a.97.97 0 0 0-.287-.713A.97.97 0 0 0 10 8a.97.97 0 0 0-.713.287A.97.97 0 0 0 9 9zm4 0q0 .424.287.712.288.288.713.288.424 0 .713-.288A.97.97 0 0 0 15 16V9a.97.97 0 0 0-.287-.713A.97.97 0 0 0 14 8a.97.97 0 0 0-.713.287A.97.97 0 0 0 13 9z"})})}aae.displayName="DeleteIcon";const BDe=_.forwardRef(aae);function cae(t,e){return S.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:S.jsx("path",{fillRule:"evenodd",d:"M15.706 2.637a2 2 0 0 1 2.829 0l2.828 2.828a2 2 0 0 1 0 2.829L9.605 20.052a1 1 0 0 1-.465.263L3.483 21.73a1 1 0 0 1-1.212-1.213l1.414-5.657a1 1 0 0 1 .263-.465zm1.224 7.262L14.102 7.07l-8.544 8.544-.943 3.771 3.771-.943z",clipRule:"evenodd"})})}cae.displayName="EditIcon";const qK=_.forwardRef(cae);function lae(t,e){return S.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:S.jsx("path",{d:"m2.765 16.02-2.47-2.416A1.02 1.02 0 0 1 0 12.852q0-.456.295-.751a15.6 15.6 0 0 1 5.316-3.786A15.9 15.9 0 0 1 12 7q3.355 0 6.39 1.329a16 16 0 0 1 5.315 3.772q.295.294.295.751t-.295.752l-2.47 2.416a1.047 1.047 0 0 1-1.396.108l-3.114-2.363a1.1 1.1 0 0 1-.322-.376 1.1 1.1 0 0 1-.108-.483v-2.27a13.6 13.6 0 0 0-2.12-.524C13.459 9.996 12 9.937 12 9.937s-1.459.059-2.174.175q-1.074.174-2.121.523v2.271q0 .268-.108.483a1.1 1.1 0 0 1-.322.376l-3.114 2.363a1.047 1.047 0 0 1-1.396-.107"})})}lae.displayName="EndCallIcon";const uae=_.forwardRef(lae);function dae(t,e){return S.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:S.jsx("path",{d:"M21 3.997a1 1 0 0 0-.29-.702l-.005-.004A1 1 0 0 0 20 3h-8a1 1 0 1 0 0 2h5.586L5 17.586V12a1 1 0 1 0-2 0v8.003a1 1 0 0 0 .29.702l.005.004c.18.18.43.291.705.291h8a1 1 0 1 0 0-2H6.414L19 6.414V12a1 1 0 1 0 2 0z"})})}dae.displayName="ExpandIcon";const fae=_.forwardRef(dae);function hae(t,e){return S.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:S.jsx("path",{d:"M4 11a.97.97 0 0 1-.712-.287A.97.97 0 0 1 3 10V4q0-.424.288-.712A.97.97 0 0 1 4 3h6q.424 0 .713.288Q11 3.575 11 4v6q0 .424-.287.713A.97.97 0 0 1 10 11zm5-2V5H5v4zm5 12a.97.97 0 0 1-.713-.288A.97.97 0 0 1 13 20v-6q0-.424.287-.713A.97.97 0 0 1 14 13h6q.424 0 .712.287.288.288.288.713v6q0 .424-.288.712A.97.97 0 0 1 20 21zm5-2v-4h-4v4zM4 21a.97.97 0 0 1-.712-.288A.97.97 0 0 1 3 20v-6q0-.424.288-.713A.97.97 0 0 1 4 13h6q.424 0 .713.287.287.288.287.713v6q0 .424-.287.712A.97.97 0 0 1 10 21zm5-2v-4H5v4zm5-8a.97.97 0 0 1-.713-.287A.97.97 0 0 1 13 10V4q0-.424.287-.712A.97.97 0 0 1 14 3h6q.424 0 .712.288Q21 3.575 21 4v6q0 .424-.288.713A.97.97 0 0 1 20 11zm5-2V5h-4v4z"})})}hae.displayName="GridIcon";const HDe=_.forwardRef(hae);function pae(t,e){return S.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:[S.jsx("path",{d:"M16.713 6.713A.97.97 0 0 1 16 7a.97.97 0 0 1-.713-.287A.97.97 0 0 1 15 6q0-.424.287-.713A.97.97 0 0 1 16 5q.424 0 .712.287Q17 5.576 17 6t-.288.713"}),S.jsx("path",{fillRule:"evenodd",d:"M6 2a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2zm12 2H6v4h12zM6 12v-2h12v2zm0 2v2h12v-2zm0 6v-2h12v2z",clipRule:"evenodd"})]})}pae.displayName="HostIcon";const qDe=_.forwardRef(pae);function mae(t,e){return S.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:S.jsx("path",{d:"M12 19.071q-1.467 1.467-3.536 1.467-2.067 0-3.535-1.467t-1.467-3.535q0-2.07 1.467-3.536L7.05 9.879q.3-.3.707-.3t.707.3.301.707-.3.707l-2.122 2.121a2.9 2.9 0 0 0-.884 2.122q0 1.237.884 2.12.884.885 2.121.885t2.122-.884l2.121-2.121q.3-.3.707-.3t.707.3.3.707q0 .405-.3.707zm-1.414-4.243q-.3.3-.707.301a.97.97 0 0 1-.707-.3q-.3-.3-.301-.708 0-.405.3-.707l4.243-4.242q.3-.3.707-.3t.707.3.3.707-.3.707zm6.364-.707q-.3.3-.707.3a.97.97 0 0 1-.707-.3q-.3-.3-.301-.707 0-.405.3-.707l2.122-2.121q.884-.885.884-2.121 0-1.238-.884-2.122a2.9 2.9 0 0 0-2.121-.884q-1.237 0-2.122.884l-2.121 2.122q-.3.3-.707.3a.97.97 0 0 1-.707-.3q-.3-.3-.3-.708 0-.405.3-.707L12 4.93q1.467-1.467 3.536-1.467t3.535 1.467 1.467 3.536T19.071 12z"})})}mae.displayName="LinkIcon";const VDe=_.forwardRef(mae);function gae(t,e){return S.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:S.jsx("path",{d:"M6 22q-.825 0-1.412-.587A1.93 1.93 0 0 1 4 20V10q0-.825.588-1.412a2 2 0 0 1 .702-.463L1.333 4.167a1 1 0 0 1 1.414-1.414L7 7.006v-.012l13 13v.012l1.247 1.247a1 1 0 1 1-1.414 1.414l-.896-.896A1.94 1.94 0 0 1 18 22zm14-4.834V10q0-.825-.587-1.412A1.93 1.93 0 0 0 18 8h-1V6q0-2.075-1.463-3.537Q14.075 1 12 1T8.463 2.463a4.9 4.9 0 0 0-1.22 1.946L9 6.166V6q0-1.25.875-2.125A2.9 2.9 0 0 1 12 3q1.25 0 2.125.875T15 6v2h-4.166z"})})}gae.displayName="LockOffIcon";const KDe=_.forwardRef(gae);function vae(t,e){return S.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:S.jsx("path",{d:"M6 22q-.824 0-1.412-.587A1.93 1.93 0 0 1 4 20V10q0-.825.588-1.412A1.93 1.93 0 0 1 6 8h1V6q0-2.075 1.463-3.537Q9.926 1 12 1q2.075 0 3.537 1.463Q17 3.925 17 6v2h1q.824 0 1.413.588Q20 9.175 20 10v10q0 .824-.587 1.413A1.93 1.93 0 0 1 18 22zM9 8h6V6q0-1.25-.875-2.125A2.9 2.9 0 0 0 12 3q-1.25 0-2.125.875A2.9 2.9 0 0 0 9 6z"})})}vae.displayName="LockSolidIcon";const GDe=_.forwardRef(vae);function yae(t,e){return S.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:S.jsx("path",{d:"M8 8v-.006l6.831 6.832-.002.002 1.414 1.415.003-.003 1.414 1.414-.003.003L20.5 20.5a1 1 0 0 1-1.414 1.414l-3.022-3.022A7.95 7.95 0 0 1 13 19.938V21a1 1 0 0 1-2 0v-1.062A8 8 0 0 1 4 12a1 1 0 1 1 2 0 6 6 0 0 0 8.587 5.415l-1.55-1.55A4.005 4.005 0 0 1 8 12v-1.172L2.086 4.914A1 1 0 0 1 3.5 3.5zm9.417 6.583 1.478 1.477A7.96 7.96 0 0 0 20 12a1 1 0 0 0-2 0c0 .925-.21 1.8-.583 2.583M8.073 5.238l7.793 7.793q.132-.495.134-1.031V6a4 4 0 0 0-7.927-.762"})})}yae.displayName="MicOffSolidIcon";const bae=_.forwardRef(yae);function _ae(t,e){return S.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:[S.jsx("path",{fillRule:"evenodd",d:"M8 8v-.006l2 2V10l3.414 3.414.003-.003 1.414 1.415-.002.002 1.414 1.415.003-.003 1.414 1.414-.003.003L20.5 20.5a1 1 0 0 1-1.414 1.414l-3.022-3.022A7.95 7.95 0 0 1 13 19.938V21a1 1 0 1 1-2 0v-1.062A8 8 0 0 1 4 12a1 1 0 1 1 2 0 6 6 0 0 0 8.587 5.415l-1.55-1.55A4.005 4.005 0 0 1 8 12v-1.172L2.086 4.914A1 1 0 0 1 3.5 3.5z",clipRule:"evenodd"}),S.jsx("path",{d:"M14 6v5.166l1.866 1.866q.132-.496.134-1.032V6a4 4 0 0 0-7.928-.762L10 7.166V6a2 2 0 1 1 4 0m3.417 8.583 1.477 1.477A7.96 7.96 0 0 0 20 12a1 1 0 1 0-2 0c0 .925-.21 1.8-.583 2.583"})]})}_ae.displayName="MicOffIcon";const zDe=_.forwardRef(_ae);function Sae(t,e){return S.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:[S.jsx("path",{d:"M8 6a4 4 0 1 1 8 0v6a4 4 0 0 1-8 0z"}),S.jsx("path",{d:"M5 11a1 1 0 0 1 1 1 6 6 0 0 0 12 0 1 1 0 1 1 2 0 8 8 0 0 1-7 7.938V21a1 1 0 1 1-2 0v-1.062A8 8 0 0 1 4 12a1 1 0 0 1 1-1"})]})}Sae.displayName="MicOnSolidIcon";const U8=_.forwardRef(Sae);function wae(t,e){return S.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:S.jsx("path",{d:"M3.5 3.5a1 1 0 1 0-1.414 1.414l4.113 4.114a5.5 5.5 0 0 0-.184 1.07A5.002 5.002 0 0 0 7 20h10.172l1.914 1.914A1 1 0 1 0 20.5 20.5l-.979-.979.004-.001L7.145 7.14l-.002.003zm18.5 12a4.48 4.48 0 0 1-.928 2.738L8.637 5.803A5.47 5.47 0 0 1 11.5 5a5.49 5.49 0 0 1 4.25 2.008 4 4 0 0 1 4.187 4.708A4.5 4.5 0 0 1 22 15.5"})})}wae.displayName="OfflineIcon";const WDe=_.forwardRef(wae);function Eae(t,e){return S.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:S.jsx("path",{d:"M6 14q-.824 0-1.412-.588A1.93 1.93 0 0 1 4 12q0-.825.588-1.412A1.93 1.93 0 0 1 6 10q.824 0 1.412.588Q8 11.175 8 12t-.588 1.412A1.93 1.93 0 0 1 6 14m6 0q-.825 0-1.412-.588A1.93 1.93 0 0 1 10 12q0-.825.588-1.412A1.93 1.93 0 0 1 12 10q.825 0 1.412.588Q14 11.175 14 12t-.588 1.412A1.93 1.93 0 0 1 12 14m6 0q-.824 0-1.413-.588A1.93 1.93 0 0 1 16 12q0-.825.587-1.412A1.93 1.93 0 0 1 18 10q.824 0 1.413.588Q20 11.175 20 12t-.587 1.412A1.93 1.93 0 0 1 18 14"})})}Eae.displayName="OverflowHorizontalIcon";const YDe=_.forwardRef(Eae);function Cae(t,e){return S.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:[S.jsx("path",{d:"M5 3h6a1 1 0 1 1 0 2H5v14h14v-6a1 1 0 1 1 2 0v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2"}),S.jsx("path",{d:"M15 3h5a1 1 0 0 1 1 1v5a1 1 0 1 1-2 0V6.414l-6.293 6.293a1 1 0 0 1-1.414-1.414L17.586 5H15a1 1 0 1 1 0-2"})]})}Cae.displayName="PopOutIcon";const j8=_.forwardRef(Cae);function Tae(t,e){return S.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:S.jsx("path",{d:"M11 3a1 1 0 1 1 2 0v8.5a.5.5 0 0 0 1 0V4a1 1 0 1 1 2 0v10.2l3.284-2.597a1.081 1.081 0 0 1 1.47 1.577c-.613.673-1.214 1.367-1.818 2.064-1.267 1.463-2.541 2.934-3.943 4.235A6 6 0 0 1 5 15V7a1 1 0 0 1 1.999 0v5.5a.5.5 0 0 0 1 0V4a1 1 0 0 1 2 0v7.5a.5.5 0 0 0 1 0z"})})}Tae.displayName="RaisedHandSolidIcon";const Rae=_.forwardRef(Tae);function kae(t,e){return S.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:S.jsx("path",{fillRule:"evenodd",d:"M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10m3.536-6.464a1 1 0 0 0-1.415-1.415A3 3 0 0 1 12 15a3 3 0 0 1-2.121-.879 1 1 0 1 0-1.414 1.415A5 5 0 0 0 12 17c1.38 0 2.632-.56 3.536-1.464M10 10.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0m5.5 1.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3",clipRule:"evenodd"})})}kae.displayName="ReactionSolidIcon";const XDe=_.forwardRef(kae);function Iae(t,e){return S.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:S.jsx("path",{d:"M12.731 2C13.432 2 14 2.568 14 3.269c0 .578.396 1.074.935 1.286q.128.052.253.106c.531.23 1.162.16 1.572-.25a1.27 1.27 0 0 1 1.794 0l1.034 1.035a1.27 1.27 0 0 1 0 1.794c-.41.41-.48 1.04-.248 1.572l.105.253c.212.539.708.935 1.286.935.701 0 1.269.568 1.269 1.269v1.462c0 .701-.568 1.269-1.269 1.269-.578 0-1.074.396-1.287.935q-.05.128-.104.253c-.232.531-.161 1.162.248 1.572a1.27 1.27 0 0 1 0 1.794l-1.034 1.034a1.27 1.27 0 0 1-1.794 0c-.41-.41-1.04-.48-1.572-.248a8 8 0 0 1-.253.105c-.539.212-.935.708-.935 1.286 0 .701-.568 1.269-1.269 1.269H11.27c-.702 0-1.27-.568-1.27-1.269 0-.578-.396-1.074-.935-1.287a8 8 0 0 1-.253-.104c-.531-.232-1.162-.161-1.572.248a1.27 1.27 0 0 1-1.794 0l-1.034-1.034a1.27 1.27 0 0 1 0-1.794c.41-.41.48-1.04.249-1.572a8 8 0 0 1-.106-.253C4.343 14.396 3.847 14 3.27 14 2.568 14 2 13.432 2 12.731V11.27c0-.702.568-1.27 1.269-1.27.578 0 1.074-.396 1.286-.935q.052-.128.106-.253c.23-.531.16-1.162-.25-1.572a1.27 1.27 0 0 1 0-1.794l1.035-1.034a1.27 1.27 0 0 1 1.794 0c.41.41 1.04.48 1.572.249a8 8 0 0 1 .253-.106c.539-.212.935-.708.935-1.286C10 2.568 10.568 2 11.269 2zM12 16a4 4 0 1 0 0-8 4 4 0 0 0 0 8"})})}Iae.displayName="SettingsSolidIcon";const JDe=_.forwardRef(Iae);function xae(t,e){return S.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:S.jsx("path",{d:"M1.288 20.713Q1.575 21 2 21h20q.424 0 .712-.288A.97.97 0 0 0 23 20a.97.97 0 0 0-.288-.712A.97.97 0 0 0 22 19H2a.97.97 0 0 0-.712.288A.97.97 0 0 0 1 20q0 .424.288.712m1.3-3.299A1.93 1.93 0 0 1 2 16V5q0-.824.587-1.412A1.93 1.93 0 0 1 4 3h16q.824 0 1.413.587Q22 4.176 22 5v11q0 .824-.587 1.413A1.93 1.93 0 0 1 20 18H4q-.824 0-1.412-.587m10.12-10.12a1 1 0 0 0-1.415 0l-2.5 2.5a1 1 0 0 0 1.414 1.414l.793-.793V13a1 1 0 1 0 2 0v-2.586l.793.793a1 1 0 0 0 1.414-1.414z"})})}xae.displayName="ShareScreenSolidIcon";const QDe=_.forwardRef(xae);function Aae(t,e){return S.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:S.jsx("path",{d:"M12 16a.97.97 0 0 1-.713-.287A.97.97 0 0 1 11 15V7.85L9.125 9.725q-.3.3-.7.3T7.7 9.7a.93.93 0 0 1-.288-.713A.98.98 0 0 1 7.7 8.3l3.6-3.6q.15-.15.325-.213.175-.062.375-.062t.375.062a.9.9 0 0 1 .325.213l3.6 3.6q.3.3.287.712a.98.98 0 0 1-.287.688q-.3.3-.713.313a.93.93 0 0 1-.712-.288L13 7.85V15q0 .424-.287.713A.97.97 0 0 1 12 16m-6 4q-.824 0-1.412-.587A1.93 1.93 0 0 1 4 18v-2q0-.424.287-.713A.97.97 0 0 1 5 15q.424 0 .713.287Q6 15.576 6 16v2h12v-2q0-.424.288-.713A.97.97 0 0 1 19 15q.424 0 .712.287.288.288.288.713v2q0 .824-.587 1.413A1.93 1.93 0 0 1 18 20z"})})}Aae.displayName="ShareIcon";const ZDe=_.forwardRef(Aae);function Lae(t,e){return S.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:S.jsx("path",{d:"M5 5h14v8h-5a1 1 0 0 0-1 1v5H5zm10 14v-4h4v4zM5 21h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2"})})}Lae.displayName="SpotlightIcon";const eNe=_.forwardRef(Lae);function Mae(t,e){return S.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:[S.jsx("path",{d:"M16.293 2.293a1 1 0 0 1 1.414 0l2 2a1 1 0 0 1 0 1.414l-2 2a1 1 0 1 1-1.414-1.414L16.586 6H6a2 2 0 0 0-2 2v7a1 1 0 1 1-2 0V8a4 4 0 0 1 4-4h10.586l-.293-.293a1 1 0 0 1 0-1.414M18 18H7.414l.293-.293a1 1 0 1 0-1.414-1.414l-2 2a1 1 0 0 0 0 1.414l2 2a1 1 0 0 0 1.414-1.414L7.414 20H18a4 4 0 0 0 4-4V9a1 1 0 1 0-2 0v7a2 2 0 0 1-2 2"}),S.jsx("path",{d:"M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6"})]})}Mae.displayName="SwitchCameraSolidIcon";const tNe=_.forwardRef(Mae);function Oae(t,e){return S.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:S.jsx("path",{d:"M12.999 13.012v-.005zm-9.411 7.401Q4.175 21 5 21h14q.824 0 1.413-.587Q21 19.825 21 19V5q0-.824-.587-1.412A1.93 1.93 0 0 0 19 3H5q-.824 0-1.412.587A1.93 1.93 0 0 0 3 5v14q0 .824.587 1.413M12 9a1 1 0 0 0-1 1 1 1 0 1 1-2 0 3 3 0 1 1 4.44 2.633 1.4 1.4 0 0 0-.383.288.3.3 0 0 0-.057.085A1 1 0 0 1 11 13c0-.58.253-1.047.539-1.38.281-.33.63-.572.94-.742A1 1 0 0 0 12 9m1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0"})})}Oae.displayName="UnknownSolidIcon";const nNe=_.forwardRef(Oae);function Pae(t,e){return S.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:S.jsx("path",{d:"M10 12q-1.65 0-2.825-1.175T6 8t1.175-2.825T10 4t2.825 1.175T14 8t-1.175 2.825T10 12m-8 6v-.8q0-.85.438-1.562.437-.713 1.162-1.088a14.8 14.8 0 0 1 3.15-1.163A13.8 13.8 0 0 1 10 13q1.65 0 3.25.387 1.6.388 3.15 1.163.724.375 1.163 1.087Q18 16.35 18 17.2v.8q0 .824-.587 1.413A1.93 1.93 0 0 1 16 20H4q-.824 0-1.412-.587A1.93 1.93 0 0 1 2 18m2 0h12v-.8a.97.97 0 0 0-.5-.85q-1.35-.675-2.725-1.012a11.6 11.6 0 0 0-5.55 0Q5.85 15.675 4.5 16.35a.97.97 0 0 0-.5.85zm6-8q.825 0 1.412-.588Q12 8.826 12 8q0-.824-.588-1.412A1.93 1.93 0 0 0 10 6q-.825 0-1.412.588A1.93 1.93 0 0 0 8 8q0 .825.588 1.412Q9.175 10 10 10m7 1h2v2q0 .424.288.713.287.287.712.287.424 0 .712-.287A.97.97 0 0 0 21 13v-2h2q.424 0 .712-.287A.97.97 0 0 0 24 10a.97.97 0 0 0-.288-.713A.97.97 0 0 0 23 9h-2V7a.97.97 0 0 0-.288-.713A.97.97 0 0 0 20 6a.97.97 0 0 0-.712.287A.97.97 0 0 0 19 7v2h-2a.97.97 0 0 0-.712.287A.97.97 0 0 0 16 10q0 .424.288.713.287.287.712.287"})})}Pae.displayName="UserAddIcon";const rNe=_.forwardRef(Pae);function Dae(t,e){return S.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:[S.jsx("path",{d:"M9.175 13.825Q10.35 15 12 15t2.825-1.175T16 11t-1.175-2.825T12 7 9.175 8.175 8 11t1.175 2.825m4.237-1.412A1.93 1.93 0 0 1 12 13q-.825 0-1.412-.588A1.93 1.93 0 0 1 10 11q0-.825.588-1.412A1.93 1.93 0 0 1 12 9q.825 0 1.412.588Q14 10.175 14 11t-.588 1.412"}),S.jsx("path",{d:"M22 12c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2s10 4.477 10 10m-2 0a8 8 0 1 0-16 0 8 8 0 0 0 16 0"}),S.jsx("path",{d:"M16.23 18.792a13 13 0 0 0-1.455-.455 11.6 11.6 0 0 0-5.55 0q-.73.18-1.455.455a8 8 0 0 1-1.729-1.454q1.336-.618 2.709-.95A13.8 13.8 0 0 1 12 16q1.65 0 3.25.387 1.373.333 2.709.95a8 8 0 0 1-1.73 1.455"})]})}Dae.displayName="UserProfileIcon";const Nae=_.forwardRef(Dae);function Uae(t,e){return S.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:S.jsx("path",{d:"M2.747 2.753 4.35 4.355l.007-.003L18 17.994v.012l3.247 3.247a1 1 0 0 1-1.414 1.414l-2.898-2.898A2 2 0 0 1 16 20H6a4 4 0 0 1-4-4V8c0-.892.292-1.715.785-2.38L1.333 4.166a1 1 0 0 1 1.414-1.414M18 15.166 6.834 4H16a2 2 0 0 1 2 2v4.286l3.35-2.871a1 1 0 0 1 1.65.76v7.65a1 1 0 0 1-1.65.76L18 13.715z"})})}Uae.displayName="VideoCallOffSolidIcon";const iNe=_.forwardRef(Uae);function jae(t,e){return S.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:S.jsx("path",{d:"M6 4h10a2 2 0 0 1 2 2v4.286l3.35-2.871a1 1 0 0 1 1.65.76v7.65a1 1 0 0 1-1.65.76L18 13.715V18a2 2 0 0 1-2 2H6a4 4 0 0 1-4-4V8a4 4 0 0 1 4-4"})})}jae.displayName="VideoCallSolidIcon";const Fae=_.forwardRef(jae);function $ae(t,e){return S.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:S.jsx("path",{d:"m20.958 16.374.039 3.527q0 .427-.33.756-.33.33-.756.33a16 16 0 0 1-6.57-1.105 16.2 16.2 0 0 1-5.563-3.663 16.1 16.1 0 0 1-3.653-5.573 16.3 16.3 0 0 1-1.115-6.56q0-.427.33-.757T4.095 3l3.528.039a1.07 1.07 0 0 1 1.085.93l.543 3.954q.039.271-.039.504a1.1 1.1 0 0 1-.271.426l-1.64 1.64q.505 1.008 1.154 1.909c.433.6 1.444 1.696 1.444 1.696s1.095 1.01 1.696 1.444q.9.65 1.909 1.153l1.64-1.64q.193-.193.426-.27t.504-.04l3.954.543q.406.059.668.359t.262.727"})})}$ae.displayName="VoiceCallSolidIcon";const sNe=_.forwardRef($ae);function Bae(t,e){return S.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:[S.jsx("g",{clipPath:"url(#a)",children:S.jsx("path",{fillRule:"evenodd",d:"M8.929 15.1a13.6 13.6 0 0 0 4.654 3.066q2.62 1.036 5.492.923h.008l.003-.004.003-.002-.034-3.124-3.52-.483-1.791 1.792-.645-.322a13.5 13.5 0 0 1-3.496-2.52 13.4 13.4 0 0 1-2.52-3.496l-.322-.644 1.792-1.792-.483-3.519-3.123-.034-.003.002-.003.004v.002a13.65 13.65 0 0 0 .932 5.492A13.4 13.4 0 0 0 8.93 15.1m3.92 4.926a15.6 15.6 0 0 1-5.334-3.511 15.4 15.4 0 0 1-3.505-5.346 15.6 15.6 0 0 1-1.069-6.274 1.93 1.93 0 0 1 .589-1.366c.366-.366.84-.589 1.386-.589h.01l3.163.035a1.96 1.96 0 0 1 1.958 1.694v.005l.487 3.545v.003c.043.297.025.605-.076.907a2 2 0 0 1-.485.773l-.762.762a11.4 11.4 0 0 0 3.206 3.54q.457.33.948.614l.762-.761a2 2 0 0 1 .774-.486c.302-.1.61-.118.907-.076l3.553.487a1.96 1.96 0 0 1 1.694 1.958l.034 3.174c0 .546-.223 1.02-.588 1.386-.361.36-.827.582-1.363.588a15.3 15.3 0 0 1-6.29-1.062",clipRule:"evenodd"})}),S.jsx("defs",{children:S.jsx("clipPath",{id:"a",children:S.jsx("path",{d:"M0 0h24v24H0z"})})})]})}Bae.displayName="VoiceCallIcon";const oNe=_.forwardRef(Bae);function Hae(t,e){return S.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:S.jsx("path",{d:"M3.5 3.5a1 1 0 1 0-1.414 1.414L5.172 8H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h2l3.293 3.293c.63.63 1.707.184 1.707-.707v-3.758l7.086 7.086A1 1 0 0 0 20.5 20.5l-2.136-2.136.003-.003-1.414-1.414-.003.003-1.414-1.414.003-.003-1.415-1.415-.002.003L12 12v-.006L7.503 7.497 7.5 7.5zm11.496 8.662 1.661 1.66c.222-.564.343-1.18.343-1.822 0-1.38-.56-2.632-1.464-3.536a1 1 0 1 0-1.414 1.414 3 3 0 0 1 .874 2.284m3.164 3.165 1.462 1.46A8.96 8.96 0 0 0 21 12a8.98 8.98 0 0 0-2.636-6.364A1 1 0 0 0 16.95 7.05 6.98 6.98 0 0 1 19 12a7 7 0 0 1-.84 3.326M8.917 6.083 12 9.166V5.414c0-.89-1.077-1.337-1.707-.707z"})})}Hae.displayName="VolumeOffSolidIcon";const aNe=_.forwardRef(Hae);function qae(t,e){return S.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:S.jsx("path",{d:"m3.5 3.5 4 4 .003-.003L8.917 8.91l-.003.003L10 10v-.006l2 2V12l2.122 2.121.002-.003 1.415 1.415-.003.003 1.414 1.414.003-.003 1.414 1.414-.003.003L20.5 20.5a1 1 0 0 1-1.414 1.414L12 14.828v3.758c0 .89-1.077 1.337-1.707.707L7 16H5a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h.172L2.086 4.914A1 1 0 0 1 3.5 3.5M7.172 10H5v4h2.828L10 16.17v-3.343zm7.824 2.162 1.661 1.66c.222-.564.343-1.18.343-1.822 0-1.38-.56-2.632-1.464-3.536a1 1 0 1 0-1.414 1.414 3 3 0 0 1 .874 2.284m3.164 3.165 1.462 1.46A8.96 8.96 0 0 0 21 12a8.98 8.98 0 0 0-2.636-6.364A1 1 0 0 0 16.95 7.05 6.98 6.98 0 0 1 19 12a7 7 0 0 1-.84 3.326M8.917 6.083 12 9.166V5.414c0-.89-1.077-1.337-1.707-.707z"})})}qae.displayName="VolumeOffIcon";const cNe=_.forwardRef(qae);function Vae(t,e){return S.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:[S.jsx("path",{d:"M3 14v-4a2 2 0 0 1 2-2h2l3.293-3.293c.63-.63 1.707-.184 1.707.707v13.172c0 .89-1.077 1.337-1.707.707L7 16H5a2 2 0 0 1-2-2m11.122-5.536a1 1 0 0 1 1.414 0A5 5 0 0 1 17 12c0 1.38-.56 2.632-1.464 3.536a1 1 0 0 1-1.415-1.415 3 3 0 0 0 .88-2.121c0-.829-.335-1.577-.88-2.121a1 1 0 0 1 0-1.415"}),S.jsx("path",{d:"M16.95 5.636a1 1 0 0 1 1.414 0A8.98 8.98 0 0 1 21 12a8.98 8.98 0 0 1-2.636 6.364 1 1 0 0 1-1.414-1.414A6.98 6.98 0 0 0 19 12a6.98 6.98 0 0 0-2.05-4.95 1 1 0 0 1 0-1.414"})]})}Vae.displayName="VolumeOnSolidIcon";const lNe=_.forwardRef(Vae);function Kae(t,e){return S.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:[S.jsx("path",{d:"M3 10a2 2 0 0 1 2-2h2l3.293-3.293c.63-.63 1.707-.184 1.707.707v13.172c0 .89-1.077 1.337-1.707.707L7 16H5a2 2 0 0 1-2-2zm4.828 4L10 16.172V7.828L7.828 10H5v4zm6.294-5.536a1 1 0 0 1 1.414 0A5 5 0 0 1 17 12c0 1.38-.56 2.632-1.464 3.535a1 1 0 1 1-1.415-1.414 3 3 0 0 0 .88-2.121c0-.829-.335-1.578-.88-2.122a1 1 0 0 1 0-1.414"}),S.jsx("path",{d:"M18.364 5.636A1 1 0 1 0 16.95 7.05 6.98 6.98 0 0 1 19 12a6.98 6.98 0 0 1-2.05 4.95 1 1 0 0 0 1.414 1.414A8.98 8.98 0 0 0 21 12a8.98 8.98 0 0 0-2.636-6.364"})]})}Kae.displayName="VolumeOnIcon";const uNe=_.forwardRef(Kae);function Gae(t,e){return S.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",viewBox:"0 0 24 24",ref:e,...t,children:S.jsx("path",{d:"M4 20q-.824 0-1.412-.587A1.93 1.93 0 0 1 2 18V6q0-.824.587-1.412A1.93 1.93 0 0 1 4 4h16q.824 0 1.413.588Q22 5.175 22 6v12q0 .824-.587 1.413A1.93 1.93 0 0 1 20 20zm0-2h16V8H4z"})})}Gae.displayName="WebBrowserIcon";const dNe=_.forwardRef(Gae),fNe="_header_p1omj_8",hNe="_nav_p1omj_18",pNe="_headerLogo_p1omj_26",mNe="_leftNav_p1omj_33",gNe="_hideMobile_p1omj_33",vNe="_rightNav_p1omj_45",yNe="_roomHeaderInfo_p1omj_61",bNe="_roomAvatar_p1omj_76",_Ne="_nameLine_p1omj_81",SNe="_participantsLine_p1omj_100",ja={header:fNe,nav:hNe,headerLogo:pNe,leftNav:mNe,hideMobile:gNe,rightNav:vNe,roomHeaderInfo:yNe,roomAvatar:bNe,nameLine:_Ne,participantsLine:SNe},wNe=(t,e)=>_.createElement("svg",{width:260,height:30,viewBox:"0 0 260 30",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:e,...t},_.createElement("desc",null,"Element Call (Beta)"),_.createElement("circle",{cx:15,cy:15,r:13,fill:"white"}),_.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M15 30C23.2843 30 30 23.2843 30 15C30 6.71573 23.2843 0 15 0C6.71573 0 0 6.71573 0 15C0 23.2843 6.71573 30 15 30ZM12.2579 6.98923C12.2579 6.38376 12.7497 5.89292 13.3565 5.89292C17.4687 5.89292 20.8024 9.21967 20.8024 13.3234C20.8024 13.9289 20.3106 14.4197 19.7038 14.4197C19.0971 14.4197 18.6052 13.9289 18.6052 13.3234C18.6052 10.4306 16.2553 8.08554 13.3565 8.08554C12.7497 8.08554 12.2579 7.59471 12.2579 6.98923ZM24.1066 13.3235C24.1066 12.7181 23.6148 12.2272 23.008 12.2272C22.4013 12.2272 21.9094 12.7181 21.9094 13.3235C21.9094 16.2163 19.5595 18.5614 16.6607 18.5614C16.0539 18.5614 15.5621 19.0523 15.5621 19.6577C15.5621 20.2632 16.0539 20.754 16.6607 20.754C20.7729 20.754 24.1066 17.4273 24.1066 13.3235ZM17.7601 23.011C17.7601 23.6164 17.2682 24.1073 16.6615 24.1073C12.5492 24.1073 9.21553 20.7805 9.21553 16.6768C9.21553 16.0713 9.70739 15.5805 10.3141 15.5805C10.9209 15.5805 11.4127 16.0713 11.4127 16.6768C11.4127 19.5696 13.7627 21.9146 16.6615 21.9146C17.2682 21.9146 17.7601 22.4055 17.7601 23.011ZM5.89281 16.6769C5.89281 17.2824 6.38466 17.7732 6.9914 17.7732C7.59813 17.7732 8.08999 17.2824 8.08999 16.6769C8.08999 13.7841 10.4399 11.439 13.3388 11.439C13.9455 11.439 14.4373 10.9482 14.4373 10.3427C14.4373 9.73722 13.9455 9.24639 13.3388 9.24639C9.22647 9.24639 5.89281 12.5731 5.89281 16.6769Z",fill:"#0DBD8B"}),_.createElement("path",{d:"M53.5406 17.258H42.8052C42.932 18.3814 43.3397 19.2782 44.0282 19.9486C44.7167 20.6009 45.6227 20.927 46.746 20.927C47.4889 20.927 48.1593 20.7459 48.7572 20.3835C49.3551 20.0211 49.7809 19.5319 50.0346 18.9159H53.296C52.8611 20.3472 52.0458 21.5068 50.8499 22.3947C49.6722 23.2644 48.2771 23.6992 46.6645 23.6992C44.5627 23.6992 42.8596 23.0016 41.555 21.6065C40.2686 20.2114 39.6254 18.4448 39.6254 16.3068C39.6254 14.2231 40.2776 12.4747 41.5822 11.0614C42.8867 9.64814 44.5718 8.94151 46.6373 8.94151C48.7029 8.94151 50.3698 9.63908 51.6381 11.0342C52.9245 12.4112 53.5677 14.1506 53.5677 16.2524L53.5406 17.258ZM46.6373 11.5778C45.6227 11.5778 44.7801 11.8767 44.1098 12.4747C43.4394 13.0726 43.0226 13.8698 42.8596 14.8663H50.3607C50.2158 13.8698 49.8172 13.0726 49.1649 12.4747C48.5126 11.8767 47.6701 11.5778 46.6373 11.5778Z",fill:"currentColor"}),_.createElement("path",{d:"M55.7934 19.1605V2.9895H59.0276V19.2148C59.0276 19.9396 59.4262 20.302 60.2234 20.302L60.7941 20.2748V23.3459C60.4861 23.4003 60.16 23.4274 59.8157 23.4274C58.4206 23.4274 57.3969 23.0741 56.7446 22.3675C56.1104 21.6609 55.7934 20.5919 55.7934 19.1605Z",fill:"currentColor"}),_.createElement("path",{d:"M75.8563 17.258H65.121C65.2478 18.3814 65.6555 19.2782 66.344 19.9486C67.0325 20.6009 67.9384 20.927 69.0618 20.927C69.8047 20.927 70.4751 20.7459 71.073 20.3835C71.6709 20.0211 72.0967 19.5319 72.3503 18.9159H75.6117C75.1769 20.3472 74.3615 21.5068 73.1657 22.3947C71.988 23.2644 70.5928 23.6992 68.9803 23.6992C66.8785 23.6992 65.1753 23.0016 63.8708 21.6065C62.5843 20.2114 61.9411 18.4448 61.9411 16.3068C61.9411 14.2231 62.5934 12.4747 63.898 11.0614C65.2025 9.64814 66.8875 8.94151 68.9531 8.94151C71.0186 8.94151 72.6855 9.63908 73.9539 11.0342C75.2403 12.4112 75.8835 14.1506 75.8835 16.2524L75.8563 17.258ZM68.9531 11.5778C67.9384 11.5778 67.0959 11.8767 66.4255 12.4747C65.7551 13.0726 65.3384 13.8698 65.1753 14.8663H72.6765C72.5315 13.8698 72.1329 13.0726 71.4806 12.4747C70.8284 11.8767 69.9859 11.5778 68.9531 11.5778Z",fill:"currentColor"}),_.createElement("path",{d:"M90.448 15.274V23.3731H87.2138V14.9207C87.2138 12.7827 86.326 11.7137 84.5503 11.7137C83.59 11.7137 82.82 12.0217 82.2402 12.6377C81.6785 13.2538 81.3977 14.0963 81.3977 15.1653V23.3731H78.1635V9.26764H81.1531V11.1429C81.4973 10.5088 82.0228 9.98333 82.7294 9.5666C83.436 9.14987 84.3148 8.94151 85.3657 8.94151C87.3225 8.94151 88.7358 9.68438 89.6055 11.1701C90.8013 9.68438 92.3958 8.94151 94.3888 8.94151C96.0376 8.94151 97.3059 9.45789 98.1937 10.4907C99.0816 11.5053 99.5255 12.8461 99.5255 14.513V23.3731H96.2913V14.9207C96.2913 12.7827 95.4035 11.7137 93.6278 11.7137C92.6494 11.7137 91.8703 12.0308 91.2905 12.6649C90.7288 13.2809 90.448 14.1506 90.448 15.274Z",fill:"currentColor"}),_.createElement("path",{d:"M115.61 17.258H104.874C105.001 18.3814 105.409 19.2782 106.097 19.9486C106.786 20.6009 107.692 20.927 108.815 20.927C109.558 20.927 110.228 20.7459 110.826 20.3835C111.424 20.0211 111.85 19.5319 112.104 18.9159H115.365C114.93 20.3472 114.115 21.5068 112.919 22.3947C111.741 23.2644 110.346 23.6992 108.734 23.6992C106.632 23.6992 104.929 23.0016 103.624 21.6065C102.338 20.2114 101.694 18.4448 101.694 16.3068C101.694 14.2231 102.347 12.4747 103.651 11.0614C104.956 9.64814 106.641 8.94151 108.706 8.94151C110.772 8.94151 112.439 9.63908 113.707 11.0342C114.994 12.4112 115.637 14.1506 115.637 16.2524L115.61 17.258ZM108.706 11.5778C107.692 11.5778 106.849 11.8767 106.179 12.4747C105.508 13.0726 105.092 13.8698 104.929 14.8663H112.43C112.285 13.8698 111.886 13.0726 111.234 12.4747C110.582 11.8767 109.739 11.5778 108.706 11.5778Z",fill:"currentColor"}),_.createElement("path",{d:"M120.906 9.26764V11.1429C121.232 10.5269 121.767 10.0105 122.51 9.59378C123.271 9.15893 124.186 8.94151 125.255 8.94151C126.922 8.94151 128.208 9.44883 129.114 10.4635C130.038 11.4781 130.5 12.828 130.5 14.513V23.3731H127.266V14.9207C127.266 13.9242 127.03 13.1451 126.559 12.5834C126.106 12.0036 125.409 11.7137 124.467 11.7137C123.434 11.7137 122.619 12.0217 122.021 12.6377C121.441 13.2538 121.151 14.1053 121.151 15.1925V23.3731H117.917V9.26764H120.906Z",fill:"currentColor"}),_.createElement("path",{d:"M139.946 20.4922V23.2915C139.547 23.4003 138.985 23.4546 138.261 23.4546C135.507 23.4546 134.13 22.0685 134.13 19.2964V11.8496H131.982V9.26764H134.13V5.5986H137.364V9.26764H140V11.8496H137.364V18.9702C137.364 20.0755 137.889 20.6281 138.94 20.6281L139.946 20.4922Z",fill:"currentColor"}),_.createElement("path",{d:"M148.304 20.864C146.768 19.184 146 17.056 146 14.48C146 11.904 146.768 9.784 148.304 8.12C149.856 6.44 151.896 5.6 154.424 5.6C156.504 5.6 158.264 6.176 159.704 7.328C161.144 8.48 162.064 10.024 162.464 11.96H160.616C160.28 10.52 159.552 9.376 158.432 8.528C157.312 7.68 155.976 7.256 154.424 7.256C152.44 7.256 150.84 7.92 149.624 9.248C148.424 10.576 147.824 12.32 147.824 14.48C147.824 16.64 148.424 18.384 149.624 19.712C150.84 21.04 152.44 21.704 154.424 21.704C155.976 21.704 157.312 21.28 158.432 20.432C159.552 19.584 160.28 18.44 160.616 17H162.464C162.064 18.936 161.144 20.48 159.704 21.632C158.264 22.784 156.504 23.36 154.424 23.36C151.896 23.36 149.856 22.528 148.304 20.864Z",fill:"currentColor"}),_.createElement("path",{d:"M173.63 17.192C171.438 17.192 169.942 17.24 169.142 17.336C168.358 17.416 167.782 17.552 167.414 17.744C166.758 18.112 166.43 18.704 166.43 19.52C166.43 21.088 167.358 21.872 169.214 21.872C170.638 21.872 171.726 21.552 172.478 20.912C173.246 20.272 173.63 19.416 173.63 18.344V17.192ZM169.022 23.288C167.63 23.288 166.566 22.952 165.83 22.28C165.11 21.592 164.75 20.688 164.75 19.568C164.75 18.832 164.942 18.176 165.326 17.6C165.726 17.024 166.27 16.6 166.958 16.328C167.534 16.104 168.278 15.96 169.19 15.896C170.102 15.816 171.582 15.776 173.63 15.776V14.984C173.63 12.968 172.478 11.96 170.174 11.96C168.19 11.96 167.038 12.768 166.718 14.384H165.062C165.238 13.2 165.742 12.256 166.574 11.552C167.422 10.848 168.646 10.496 170.246 10.496C171.958 10.496 173.23 10.896 174.062 11.696C174.91 12.496 175.334 13.6 175.334 15.008V23H173.702V21.224C172.854 22.6 171.294 23.288 169.022 23.288Z",fill:"currentColor"}),_.createElement("path",{d:"M179.418 20.312V5H181.122V20.12C181.122 20.616 181.202 20.96 181.362 21.152C181.538 21.344 181.85 21.44 182.298 21.44L182.778 21.392V22.952C182.506 23 182.21 23.024 181.89 23.024C180.242 23.024 179.418 22.12 179.418 20.312Z",fill:"currentColor"}),_.createElement("path",{d:"M185.582 20.312V5H187.286V20.12C187.286 20.616 187.366 20.96 187.526 21.152C187.702 21.344 188.014 21.44 188.462 21.44L188.942 21.392V22.952C188.67 23 188.374 23.024 188.054 23.024C186.406 23.024 185.582 22.12 185.582 20.312Z",fill:"currentColor"}),_.createElement("path",{d:"M201 10C201 5.58172 204.582 2 209 2H252C256.418 2 260 5.58172 260 10V20C260 24.4183 256.418 28 252 28H209C204.582 28 201 24.4183 201 20V10Z",fill:"#368BD6"}),_.createElement("path",{d:"M212.076 20H216.492C218.99 20 220.215 18.7269 220.215 17.0277C220.215 15.3764 219.043 14.407 217.882 14.3484V14.2418C218.947 13.9915 219.789 13.2457 219.789 11.9194C219.789 10.2947 218.617 9.09091 216.252 9.09091H212.076V20ZM214.052 18.3487V15.1527H216.231C217.451 15.1527 218.207 15.8984 218.207 16.8732C218.207 17.7415 217.61 18.3487 216.178 18.3487H214.052ZM214.052 13.7305V10.7209H216.05C217.211 10.7209 217.813 11.3335 217.813 12.1751C217.813 13.1339 217.035 13.7305 216.007 13.7305H214.052ZM221.934 20H229.072V18.3434H223.911V15.3658H228.662V13.7092H223.911V10.7475H229.03V9.09091H221.934V20ZM230.566 10.7475H233.938V20H235.898V10.7475H239.27V9.09091H230.566V10.7475ZM241.031 20L241.931 17.31H246.032L246.938 20H249.047L245.201 9.09091H242.762L238.921 20H241.031ZM242.464 15.7227L243.939 11.3281H244.024L245.5 15.7227H242.464Z",fill:"white"})),ENe=_.forwardRef(wNe);var um=(t=>(t.XS="xs",t.SM="sm",t.MD="md",t.LG="lg",t.XL="xl",t))(um||{});const CNe=new Map([["xs",22],["sm",32],["md",36],["lg",42],["xl",90]]);function TNe(t,e,n=96){const r=Math.floor(n*window.devicePixelRatio),i=Math.floor(n*window.devicePixelRatio),s=n<=96?"crop":"scale";return e?t.mxcUrlToHttp(e,r,i,s,!1,!0,!0):null}const dm=({className:t,id:e,name:n,src:r,size:i="md",style:s,...o})=>{const a=My(),c=_.useMemo(()=>Object.values(um).includes(i)?CNe.get(i):i,[i]),[l,d]=_.useState(void 0);return _.useEffect(()=>{if(a?.state!=="valid")return;const{authenticated:h,supportedFeatures:m}=a,g=h?.client;if(!g||!r||!c||!m.thumbnails)return;const y=g.getAccessToken();if(!y)return;const v=TNe(g,r,c);if(!v){d(void 0);return}let E;return fetch(v,{headers:{Authorization:`Bearer ${y}`}}).then(async w=>w.blob()).then(w=>{E=URL.createObjectURL(w),d(E)}).catch(w=>{d(void 0)}),()=>{E&&URL.revokeObjectURL(E)}},[a,r,c]),S.jsx(A5e,{className:t,id:e,name:n,size:`${c}px`,src:l,style:s,...o})},RNe="_lock_zf62g_8",kNe={lock:RNe},INe=({encrypted:t})=>{const{t:e}=et(),n=t?GDe:KDe,r=e(t?"common.encrypted":"common.unencrypted");return S.jsx(bi,{label:r,placement:"right",isTriggerInteractive:!1,children:S.jsx(n,{width:16,height:16,className:kNe.lock,"data-encrypted":t})})};function wR(t){const e=_.useMemo(()=>window.matchMedia(t),[t]),n=_.useCallback(i=>(e.addEventListener("change",i),()=>e.removeEventListener("change",i)),[e]),r=_.useCallback(()=>e.matches,[e]);return _.useSyncExternalStore(n,r)}const xNe="_banner_sye6n_8",ANe={banner:xNe},LNe=({children:t,className:e,...n})=>{const{t:r}=et(),i=My();let s=!1;return i?.state==="valid"&&(s=i.disconnected),S.jsx(S.Fragment,{children:s&&S.jsxs("div",{className:Le(ANe.banner,e),...n,children:[t,r("disconnected_banner")]})})},gd=({ref:t,children:e,className:n,disconnectedBanner:r=!0,...i})=>S.jsxs(S.Fragment,{children:[S.jsx("header",{ref:t,className:Le(ja.header,n),...i,children:e}),r&&S.jsx(LNe,{})]});gd.displayName="Header";const hh=({children:t,className:e,hideMobile:n,...r})=>S.jsx("div",{className:Le(ja.nav,ja.leftNav,{[ja.hideMobile]:n},e),...r,children:t}),ph=({children:t,className:e,hideMobile:n,...r})=>S.jsx("div",{className:Le(ja.nav,ja.rightNav,{[ja.hideMobile]:n},e),...r,children:t}),Bp=({className:t})=>{const{t:e}=et();return S.jsx(HT,{className:Le(ja.headerLogo,t),to:"/","aria-label":e("header_label"),children:S.jsx(ENe,{})})},zae=({id:t,name:e,avatarUrl:n,encrypted:r,participantCount:i})=>{const{t:s}=et(),o=wR("(max-width: 550px)")?"sm":"lg";return S.jsxs("div",{className:ja.roomHeaderInfo,"data-size":o,children:[S.jsx(dm,{className:ja.roomAvatar,id:t,name:e,size:o==="sm"?um.SM:56,src:n??void 0}),S.jsxs("div",{className:ja.nameLine,children:[S.jsx(Hc,{type:o==="sm"?"body":"heading",size:o==="sm"?"lg":"md",weight:"semibold","data-testid":"roomHeader_roomName",children:e}),S.jsx(INe,{encrypted:r})]}),(i??0)>0&&S.jsxs("div",{className:ja.participantsLine,children:[S.jsx(Nae,{width:20,height:20,"aria-label":s("header_participants_label")}),S.jsx(an,{as:"span",size:"sm",weight:"medium","data-testid":"roomHeader_participants_count",children:s("participant_count",{count:i??0})})]})]})},MNe="_page_fvtgn_8",ONe="_container_fvtgn_20",PNe="_content_fvtgn_28",U6={page:MNe,container:ONe,content:PNe};var Wae=typeof global=="object"&&global&&global.Object===Object&&global,DNe=typeof self=="object"&&self&&self.Object===Object&&self,qc=Wae||DNe||Function("return this")(),eh=qc.Symbol,Yae=Object.prototype,NNe=Yae.hasOwnProperty,UNe=Yae.toString,o1=eh?eh.toStringTag:void 0;function jNe(t){var e=NNe.call(t,o1),n=t[o1];try{t[o1]=void 0;var r=!0}catch{}var i=UNe.call(t);return r&&(e?t[o1]=n:delete t[o1]),i}var FNe=Object.prototype,$Ne=FNe.toString;function BNe(t){return $Ne.call(t)}var HNe="[object Null]",qNe="[object Undefined]",VK=eh?eh.toStringTag:void 0;function fm(t){return t==null?t===void 0?qNe:HNe:VK&&VK in Object(t)?jNe(t):BNe(t)}function th(t){return t!=null&&typeof t=="object"}var VNe="[object Symbol]";function ER(t){return typeof t=="symbol"||th(t)&&fm(t)==VNe}function Xae(t,e){for(var n=-1,r=t==null?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}var jc=Array.isArray,KK=eh?eh.prototype:void 0,GK=KK?KK.toString:void 0;function Jae(t){if(typeof t=="string")return t;if(jc(t))return Xae(t,Jae)+"";if(ER(t))return GK?GK.call(t):"";var e=t+"";return e=="0"&&1/t==-1/0?"-0":e}var KNe=/\s/;function GNe(t){for(var e=t.length;e--&&KNe.test(t.charAt(e)););return e}var zNe=/^\s+/;function WNe(t){return t&&t.slice(0,GNe(t)+1).replace(zNe,"")}function So(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var zK=NaN,YNe=/^[-+]0x[0-9a-f]+$/i,XNe=/^0b[01]+$/i,JNe=/^0o[0-7]+$/i,QNe=parseInt;function WK(t){if(typeof t=="number")return t;if(ER(t))return zK;if(So(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=So(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=WNe(t);var n=XNe.test(t);return n||JNe.test(t)?QNe(t.slice(2),n?2:8):YNe.test(t)?zK:+t}function F8(t){return t}var ZNe="[object AsyncFunction]",eUe="[object Function]",tUe="[object GeneratorFunction]",nUe="[object Proxy]";function $8(t){if(!So(t))return!1;var e=fm(t);return e==eUe||e==tUe||e==ZNe||e==nUe}var j6=qc["__core-js_shared__"],YK=(function(){var t=/[^.]+$/.exec(j6&&j6.keys&&j6.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""})();function rUe(t){return!!YK&&YK in t}var iUe=Function.prototype,sUe=iUe.toString;function hm(t){if(t!=null){try{return sUe.call(t)}catch{}try{return t+""}catch{}}return""}var oUe=/[\\^$.*+?()[\]{}|]/g,aUe=/^\[object .+?Constructor\]$/,cUe=Function.prototype,lUe=Object.prototype,uUe=cUe.toString,dUe=lUe.hasOwnProperty,fUe=RegExp("^"+uUe.call(dUe).replace(oUe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function hUe(t){if(!So(t)||rUe(t))return!1;var e=$8(t)?fUe:aUe;return e.test(hm(t))}function pUe(t,e){return t?.[e]}function pm(t,e){var n=pUe(t,e);return hUe(n)?n:void 0}var yM=pm(qc,"WeakMap"),XK=Object.create,mUe=(function(){function t(){}return function(e){if(!So(e))return{};if(XK)return XK(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}})();function gUe(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function vUe(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}var yUe=800,bUe=16,_Ue=Date.now;function SUe(t){var e=0,n=0;return function(){var r=_Ue(),i=bUe-(r-n);if(n=r,i>0){if(++e>=yUe)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function wUe(t){return function(){return t}}var E3=(function(){try{var t=pm(Object,"defineProperty");return t({},"",{}),t}catch{}})(),EUe=E3?function(t,e){return E3(t,"toString",{configurable:!0,enumerable:!1,value:wUe(e),writable:!0})}:F8,CUe=SUe(EUe),TUe=9007199254740991,RUe=/^(?:0|[1-9]\d*)$/;function CR(t,e){var n=typeof t;return e=e??TUe,!!e&&(n=="number"||n!="symbol"&&RUe.test(t))&&t>-1&&t%1==0&&t<e}function B8(t,e,n){e=="__proto__"&&E3?E3(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function lS(t,e){return t===e||t!==t&&e!==e}var kUe=Object.prototype,IUe=kUe.hasOwnProperty;function Qae(t,e,n){var r=t[e];(!(IUe.call(t,e)&&lS(r,n))||n===void 0&&!(e in t))&&B8(t,e,n)}function xUe(t,e,n,r){var i=!n;n||(n={});for(var s=-1,o=e.length;++s<o;){var a=e[s],c=void 0;c===void 0&&(c=t[a]),i?B8(n,a,c):Qae(n,a,c)}return n}var JK=Math.max;function AUe(t,e,n){return e=JK(e===void 0?t.length-1:e,0),function(){for(var r=arguments,i=-1,s=JK(r.length-e,0),o=Array(s);++i<s;)o[i]=r[e+i];i=-1;for(var a=Array(e+1);++i<e;)a[i]=r[i];return a[e]=n(o),gUe(t,this,a)}}function LUe(t,e){return CUe(AUe(t,e,F8),t+"")}var MUe=9007199254740991;function H8(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=MUe}function TR(t){return t!=null&&H8(t.length)&&!$8(t)}function OUe(t,e,n){if(!So(n))return!1;var r=typeof e;return(r=="number"?TR(n)&&CR(e,n.length):r=="string"&&e in n)?lS(n[e],t):!1}function PUe(t){return LUe(function(e,n){var r=-1,i=n.length,s=i>1?n[i-1]:void 0,o=i>2?n[2]:void 0;for(s=t.length>3&&typeof s=="function"?(i--,s):void 0,o&&OUe(n[0],n[1],o)&&(s=i<3?void 0:s,i=1),e=Object(e);++r<i;){var a=n[r];a&&t(e,a,r,s)}return e})}var DUe=Object.prototype;function q8(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||DUe;return t===n}function NUe(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}var UUe="[object Arguments]";function QK(t){return th(t)&&fm(t)==UUe}var Zae=Object.prototype,jUe=Zae.hasOwnProperty,FUe=Zae.propertyIsEnumerable,C3=QK((function(){return arguments})())?QK:function(t){return th(t)&&jUe.call(t,"callee")&&!FUe.call(t,"callee")};function $Ue(){return!1}var ece=typeof exports=="object"&&exports&&!exports.nodeType&&exports,ZK=ece&&typeof module=="object"&&module&&!module.nodeType&&module,BUe=ZK&&ZK.exports===ece,eG=BUe?qc.Buffer:void 0,HUe=eG?eG.isBuffer:void 0,T3=HUe||$Ue,qUe="[object Arguments]",VUe="[object Array]",KUe="[object Boolean]",GUe="[object Date]",zUe="[object Error]",WUe="[object Function]",YUe="[object Map]",XUe="[object Number]",JUe="[object Object]",QUe="[object RegExp]",ZUe="[object Set]",eje="[object String]",tje="[object WeakMap]",nje="[object ArrayBuffer]",rje="[object DataView]",ije="[object Float32Array]",sje="[object Float64Array]",oje="[object Int8Array]",aje="[object Int16Array]",cje="[object Int32Array]",lje="[object Uint8Array]",uje="[object Uint8ClampedArray]",dje="[object Uint16Array]",fje="[object Uint32Array]",Jn={};Jn[ije]=Jn[sje]=Jn[oje]=Jn[aje]=Jn[cje]=Jn[lje]=Jn[uje]=Jn[dje]=Jn[fje]=!0;Jn[qUe]=Jn[VUe]=Jn[nje]=Jn[KUe]=Jn[rje]=Jn[GUe]=Jn[zUe]=Jn[WUe]=Jn[YUe]=Jn[XUe]=Jn[JUe]=Jn[QUe]=Jn[ZUe]=Jn[eje]=Jn[tje]=!1;function hje(t){return th(t)&&H8(t.length)&&!!Jn[fm(t)]}function pje(t){return function(e){return t(e)}}var tce=typeof exports=="object"&&exports&&!exports.nodeType&&exports,ab=tce&&typeof module=="object"&&module&&!module.nodeType&&module,mje=ab&&ab.exports===tce,F6=mje&&Wae.process,tG=(function(){try{var t=ab&&ab.require&&ab.require("util").types;return t||F6&&F6.binding&&F6.binding("util")}catch{}})(),nG=tG&&tG.isTypedArray,V8=nG?pje(nG):hje,gje=Object.prototype,vje=gje.hasOwnProperty;function nce(t,e){var n=jc(t),r=!n&&C3(t),i=!n&&!r&&T3(t),s=!n&&!r&&!i&&V8(t),o=n||r||i||s,a=o?NUe(t.length,String):[],c=a.length;for(var l in t)(e||vje.call(t,l))&&!(o&&(l=="length"||i&&(l=="offset"||l=="parent")||s&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||CR(l,c)))&&a.push(l);return a}function rce(t,e){return function(n){return t(e(n))}}var yje=rce(Object.keys,Object),bje=Object.prototype,_je=bje.hasOwnProperty;function Sje(t){if(!q8(t))return yje(t);var e=[];for(var n in Object(t))_je.call(t,n)&&n!="constructor"&&e.push(n);return e}function ice(t){return TR(t)?nce(t):Sje(t)}function wje(t){var e=[];if(t!=null)for(var n in Object(t))e.push(n);return e}var Eje=Object.prototype,Cje=Eje.hasOwnProperty;function Tje(t){if(!So(t))return wje(t);var e=q8(t),n=[];for(var r in t)r=="constructor"&&(e||!Cje.call(t,r))||n.push(r);return n}function K8(t){return TR(t)?nce(t,!0):Tje(t)}var Rje=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,kje=/^\w*$/;function G8(t,e){if(jc(t))return!1;var n=typeof t;return n=="number"||n=="symbol"||n=="boolean"||t==null||ER(t)?!0:kje.test(t)||!Rje.test(t)||e!=null&&t in Object(e)}var a_=pm(Object,"create");function Ije(){this.__data__=a_?a_(null):{},this.size=0}function xje(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var Aje="__lodash_hash_undefined__",Lje=Object.prototype,Mje=Lje.hasOwnProperty;function Oje(t){var e=this.__data__;if(a_){var n=e[t];return n===Aje?void 0:n}return Mje.call(e,t)?e[t]:void 0}var Pje=Object.prototype,Dje=Pje.hasOwnProperty;function Nje(t){var e=this.__data__;return a_?e[t]!==void 0:Dje.call(e,t)}var Uje="__lodash_hash_undefined__";function jje(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=a_&&e===void 0?Uje:e,this}function Hp(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Hp.prototype.clear=Ije;Hp.prototype.delete=xje;Hp.prototype.get=Oje;Hp.prototype.has=Nje;Hp.prototype.set=jje;function Fje(){this.__data__=[],this.size=0}function RR(t,e){for(var n=t.length;n--;)if(lS(t[n][0],e))return n;return-1}var $je=Array.prototype,Bje=$je.splice;function Hje(t){var e=this.__data__,n=RR(e,t);if(n<0)return!1;var r=e.length-1;return n==r?e.pop():Bje.call(e,n,1),--this.size,!0}function qje(t){var e=this.__data__,n=RR(e,t);return n<0?void 0:e[n][1]}function Vje(t){return RR(this.__data__,t)>-1}function Kje(t,e){var n=this.__data__,r=RR(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this}function vd(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}vd.prototype.clear=Fje;vd.prototype.delete=Hje;vd.prototype.get=qje;vd.prototype.has=Vje;vd.prototype.set=Kje;var c_=pm(qc,"Map");function Gje(){this.size=0,this.__data__={hash:new Hp,map:new(c_||vd),string:new Hp}}function zje(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function kR(t,e){var n=t.__data__;return zje(e)?n[typeof e=="string"?"string":"hash"]:n.map}function Wje(t){var e=kR(this,t).delete(t);return this.size-=e?1:0,e}function Yje(t){return kR(this,t).get(t)}function Xje(t){return kR(this,t).has(t)}function Jje(t,e){var n=kR(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this}function yd(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}yd.prototype.clear=Gje;yd.prototype.delete=Wje;yd.prototype.get=Yje;yd.prototype.has=Xje;yd.prototype.set=Jje;var Qje="Expected a function";function z8(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(Qje);var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=t.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(z8.Cache||yd),n}z8.Cache=yd;var Zje=500;function eFe(t){var e=z8(t,function(r){return n.size===Zje&&n.clear(),r}),n=e.cache;return e}var tFe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,nFe=/\\(\\)?/g,rFe=eFe(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(tFe,function(n,r,i,s){e.push(i?s.replace(nFe,"$1"):r||n)}),e});function iFe(t){return t==null?"":Jae(t)}function IR(t,e){return jc(t)?t:G8(t,e)?[t]:rFe(iFe(t))}function uS(t){if(typeof t=="string"||ER(t))return t;var e=t+"";return e=="0"&&1/t==-1/0?"-0":e}function W8(t,e){e=IR(e,t);for(var n=0,r=e.length;t!=null&&n<r;)t=t[uS(e[n++])];return n&&n==r?t:void 0}function sFe(t,e,n){var r=t==null?void 0:W8(t,e);return r===void 0?n:r}function sce(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}var Y8=rce(Object.getPrototypeOf,Object),oFe="[object Object]",aFe=Function.prototype,cFe=Object.prototype,oce=aFe.toString,lFe=cFe.hasOwnProperty,uFe=oce.call(Object);function dFe(t){if(!th(t)||fm(t)!=oFe)return!1;var e=Y8(t);if(e===null)return!0;var n=lFe.call(e,"constructor")&&e.constructor;return typeof n=="function"&&n instanceof n&&oce.call(n)==uFe}function fFe(){this.__data__=new vd,this.size=0}function hFe(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}function pFe(t){return this.__data__.get(t)}function mFe(t){return this.__data__.has(t)}var gFe=200;function vFe(t,e){var n=this.__data__;if(n instanceof vd){var r=n.__data__;if(!c_||r.length<gFe-1)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new yd(r)}return n.set(t,e),this.size=n.size,this}function Rl(t){var e=this.__data__=new vd(t);this.size=e.size}Rl.prototype.clear=fFe;Rl.prototype.delete=hFe;Rl.prototype.get=pFe;Rl.prototype.has=mFe;Rl.prototype.set=vFe;var ace=typeof exports=="object"&&exports&&!exports.nodeType&&exports,rG=ace&&typeof module=="object"&&module&&!module.nodeType&&module,yFe=rG&&rG.exports===ace,iG=yFe?qc.Buffer:void 0;iG&&iG.allocUnsafe;function bFe(t,e){return t.slice()}function _Fe(t,e){for(var n=-1,r=t==null?0:t.length,i=0,s=[];++n<r;){var o=t[n];e(o,n,t)&&(s[i++]=o)}return s}function cce(){return[]}var SFe=Object.prototype,wFe=SFe.propertyIsEnumerable,sG=Object.getOwnPropertySymbols,lce=sG?function(t){return t==null?[]:(t=Object(t),_Fe(sG(t),function(e){return wFe.call(t,e)}))}:cce,EFe=Object.getOwnPropertySymbols,CFe=EFe?function(t){for(var e=[];t;)sce(e,lce(t)),t=Y8(t);return e}:cce;function uce(t,e,n){var r=e(t);return jc(t)?r:sce(r,n(t))}function oG(t){return uce(t,ice,lce)}function TFe(t){return uce(t,K8,CFe)}var bM=pm(qc,"DataView"),_M=pm(qc,"Promise"),SM=pm(qc,"Set"),aG="[object Map]",RFe="[object Object]",cG="[object Promise]",lG="[object Set]",uG="[object WeakMap]",dG="[object DataView]",kFe=hm(bM),IFe=hm(c_),xFe=hm(_M),AFe=hm(SM),LFe=hm(yM),ff=fm;(bM&&ff(new bM(new ArrayBuffer(1)))!=dG||c_&&ff(new c_)!=aG||_M&&ff(_M.resolve())!=cG||SM&&ff(new SM)!=lG||yM&&ff(new yM)!=uG)&&(ff=function(t){var e=fm(t),n=e==RFe?t.constructor:void 0,r=n?hm(n):"";if(r)switch(r){case kFe:return dG;case IFe:return aG;case xFe:return cG;case AFe:return lG;case LFe:return uG}return e});var R3=qc.Uint8Array;function MFe(t){var e=new t.constructor(t.byteLength);return new R3(e).set(new R3(t)),e}function OFe(t,e){var n=MFe(t.buffer);return new t.constructor(n,t.byteOffset,t.length)}function PFe(t){return typeof t.constructor=="function"&&!q8(t)?mUe(Y8(t)):{}}var DFe="__lodash_hash_undefined__";function NFe(t){return this.__data__.set(t,DFe),this}function UFe(t){return this.__data__.has(t)}function k3(t){var e=-1,n=t==null?0:t.length;for(this.__data__=new yd;++e<n;)this.add(t[e])}k3.prototype.add=k3.prototype.push=NFe;k3.prototype.has=UFe;function jFe(t,e){for(var n=-1,r=t==null?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}function FFe(t,e){return t.has(e)}var $Fe=1,BFe=2;function dce(t,e,n,r,i,s){var o=n&$Fe,a=t.length,c=e.length;if(a!=c&&!(o&&c>a))return!1;var l=s.get(t),d=s.get(e);if(l&&d)return l==e&&d==t;var h=-1,m=!0,g=n&BFe?new k3:void 0;for(s.set(t,e),s.set(e,t);++h<a;){var y=t[h],v=e[h];if(r)var E=o?r(v,y,h,e,t,s):r(y,v,h,t,e,s);if(E!==void 0){if(E)continue;m=!1;break}if(g){if(!jFe(e,function(w,R){if(!FFe(g,R)&&(y===w||i(y,w,n,r,s)))return g.push(R)})){m=!1;break}}else if(!(y===v||i(y,v,n,r,s))){m=!1;break}}return s.delete(t),s.delete(e),m}function HFe(t){var e=-1,n=Array(t.size);return t.forEach(function(r,i){n[++e]=[i,r]}),n}function qFe(t){var e=-1,n=Array(t.size);return t.forEach(function(r){n[++e]=r}),n}var VFe=1,KFe=2,GFe="[object Boolean]",zFe="[object Date]",WFe="[object Error]",YFe="[object Map]",XFe="[object Number]",JFe="[object RegExp]",QFe="[object Set]",ZFe="[object String]",e$e="[object Symbol]",t$e="[object ArrayBuffer]",n$e="[object DataView]",fG=eh?eh.prototype:void 0,$6=fG?fG.valueOf:void 0;function r$e(t,e,n,r,i,s,o){switch(n){case n$e:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case t$e:return!(t.byteLength!=e.byteLength||!s(new R3(t),new R3(e)));case GFe:case zFe:case XFe:return lS(+t,+e);case WFe:return t.name==e.name&&t.message==e.message;case JFe:case ZFe:return t==e+"";case YFe:var a=HFe;case QFe:var c=r&VFe;if(a||(a=qFe),t.size!=e.size&&!c)return!1;var l=o.get(t);if(l)return l==e;r|=KFe,o.set(t,e);var d=dce(a(t),a(e),r,i,s,o);return o.delete(t),d;case e$e:if($6)return $6.call(t)==$6.call(e)}return!1}var i$e=1,s$e=Object.prototype,o$e=s$e.hasOwnProperty;function a$e(t,e,n,r,i,s){var o=n&i$e,a=oG(t),c=a.length,l=oG(e),d=l.length;if(c!=d&&!o)return!1;for(var h=c;h--;){var m=a[h];if(!(o?m in e:o$e.call(e,m)))return!1}var g=s.get(t),y=s.get(e);if(g&&y)return g==e&&y==t;var v=!0;s.set(t,e),s.set(e,t);for(var E=o;++h<c;){m=a[h];var w=t[m],R=e[m];if(r)var x=o?r(R,w,m,e,t,s):r(w,R,m,t,e,s);if(!(x===void 0?w===R||i(w,R,n,r,s):x)){v=!1;break}E||(E=m=="constructor")}if(v&&!E){var C=t.constructor,k=e.constructor;C!=k&&"constructor"in t&&"constructor"in e&&!(typeof C=="function"&&C instanceof C&&typeof k=="function"&&k instanceof k)&&(v=!1)}return s.delete(t),s.delete(e),v}var c$e=1,hG="[object Arguments]",pG="[object Array]",Lw="[object Object]",l$e=Object.prototype,mG=l$e.hasOwnProperty;function u$e(t,e,n,r,i,s){var o=jc(t),a=jc(e),c=o?pG:ff(t),l=a?pG:ff(e);c=c==hG?Lw:c,l=l==hG?Lw:l;var d=c==Lw,h=l==Lw,m=c==l;if(m&&T3(t)){if(!T3(e))return!1;o=!0,d=!1}if(m&&!d)return s||(s=new Rl),o||V8(t)?dce(t,e,n,r,i,s):r$e(t,e,c,n,r,i,s);if(!(n&c$e)){var g=d&&mG.call(t,"__wrapped__"),y=h&&mG.call(e,"__wrapped__");if(g||y){var v=g?t.value():t,E=y?e.value():e;return s||(s=new Rl),i(v,E,n,r,s)}}return m?(s||(s=new Rl),a$e(t,e,n,r,i,s)):!1}function X8(t,e,n,r,i){return t===e?!0:t==null||e==null||!th(t)&&!th(e)?t!==t&&e!==e:u$e(t,e,n,r,X8,i)}var d$e=1,f$e=2;function h$e(t,e,n,r){var i=n.length,s=i;if(t==null)return!s;for(t=Object(t);i--;){var o=n[i];if(o[2]?o[1]!==t[o[0]]:!(o[0]in t))return!1}for(;++i<s;){o=n[i];var a=o[0],c=t[a],l=o[1];if(o[2]){if(c===void 0&&!(a in t))return!1}else{var d=new Rl,h;if(!(h===void 0?X8(l,c,d$e|f$e,r,d):h))return!1}}return!0}function fce(t){return t===t&&!So(t)}function p$e(t){for(var e=ice(t),n=e.length;n--;){var r=e[n],i=t[r];e[n]=[r,i,fce(i)]}return e}function hce(t,e){return function(n){return n==null?!1:n[t]===e&&(e!==void 0||t in Object(n))}}function m$e(t){var e=p$e(t);return e.length==1&&e[0][2]?hce(e[0][0],e[0][1]):function(n){return n===t||h$e(n,t,e)}}function g$e(t,e){return t!=null&&e in Object(t)}function v$e(t,e,n){e=IR(e,t);for(var r=-1,i=e.length,s=!1;++r<i;){var o=uS(e[r]);if(!(s=t!=null&&n(t,o)))break;t=t[o]}return s||++r!=i?s:(i=t==null?0:t.length,!!i&&H8(i)&&CR(o,i)&&(jc(t)||C3(t)))}function y$e(t,e){return t!=null&&v$e(t,e,g$e)}var b$e=1,_$e=2;function S$e(t,e){return G8(t)&&fce(e)?hce(uS(t),e):function(n){var r=sFe(n,t);return r===void 0&&r===e?y$e(n,t):X8(e,r,b$e|_$e)}}function w$e(t){return function(e){return e?.[t]}}function E$e(t){return function(e){return W8(e,t)}}function C$e(t){return G8(t)?w$e(uS(t)):E$e(t)}function T$e(t){return typeof t=="function"?t:t==null?F8:typeof t=="object"?jc(t)?S$e(t[0],t[1]):m$e(t):C$e(t)}function R$e(t){return function(e,n,r){for(var i=-1,s=Object(e),o=r(e),a=o.length;a--;){var c=o[++i];if(n(s[c],c,s)===!1)break}return e}}var k$e=R$e(),B6=function(){return qc.Date.now()},I$e="Expected a function",x$e=Math.max,A$e=Math.min;function L$e(t,e,n){var r,i,s,o,a,c,l=0,d=!1,h=!1,m=!0;if(typeof t!="function")throw new TypeError(I$e);e=WK(e)||0,So(n)&&(d=!!n.leading,h="maxWait"in n,s=h?x$e(WK(n.maxWait)||0,e):s,m="trailing"in n?!!n.trailing:m);function g(T){var L=r,O=i;return r=i=void 0,l=T,o=t.apply(O,L),o}function y(T){return l=T,a=setTimeout(w,e),d?g(T):o}function v(T){var L=T-c,O=T-l,P=e-L;return h?A$e(P,s-O):P}function E(T){var L=T-c,O=T-l;return c===void 0||L>=e||L<0||h&&O>=s}function w(){var T=B6();if(E(T))return R(T);a=setTimeout(w,v(T))}function R(T){return a=void 0,m&&r?g(T):(r=i=void 0,o)}function x(){a!==void 0&&clearTimeout(a),l=0,r=c=i=a=void 0}function C(){return a===void 0?o:R(B6())}function k(){var T=B6(),L=E(T);if(r=arguments,i=this,c=T,L){if(a===void 0)return y(c);if(h)return clearTimeout(a),a=setTimeout(w,e),g(c)}return a===void 0&&(a=setTimeout(w,e)),o}return k.cancel=x,k.flush=C,k}function wM(t,e,n){(n!==void 0&&!lS(t[e],n)||n===void 0&&!(e in t))&&B8(t,e,n)}function M$e(t){return th(t)&&TR(t)}function EM(t,e){if(!(e==="constructor"&&typeof t[e]=="function")&&e!="__proto__")return t[e]}function O$e(t){return xUe(t,K8(t))}function P$e(t,e,n,r,i,s,o){var a=EM(t,n),c=EM(e,n),l=o.get(c);if(l){wM(t,n,l);return}var d=s?s(a,c,n+"",t,e,o):void 0,h=d===void 0;if(h){var m=jc(c),g=!m&&T3(c),y=!m&&!g&&V8(c);d=c,m||g||y?jc(a)?d=a:M$e(a)?d=vUe(a):g?(h=!1,d=bFe(c)):y?(h=!1,d=OFe(c)):d=[]:dFe(c)||C3(c)?(d=a,C3(a)?d=O$e(a):(!So(a)||$8(a))&&(d=PFe(c))):h=!1}h&&(o.set(c,d),i(d,c,r,s,o),o.delete(c)),wM(t,n,d)}function pce(t,e,n,r,i){t!==e&&k$e(e,function(s,o){if(i||(i=new Rl),So(s))P$e(t,e,o,n,pce,r,i);else{var a=r?r(EM(t,o),s,o+"",t,e,i):void 0;a===void 0&&(a=s),wM(t,o,a)}},K8)}var D$e=PUe(function(t,e,n){pce(t,e,n)});function N$e(t,e,n,r){if(!So(t))return t;e=IR(e,t);for(var i=-1,s=e.length,o=s-1,a=t;a!=null&&++i<s;){var c=uS(e[i]),l=n;if(c==="__proto__"||c==="constructor"||c==="prototype")return t;if(i!=o){var d=a[c];l=void 0,l===void 0&&(l=So(d)?d:CR(e[i+1])?[]:{})}Qae(a,c,l),a=a[c]}return t}function U$e(t,e,n){for(var r=-1,i=e.length,s={};++r<i;){var o=e[r],a=W8(t,o);n(a,o)&&N$e(s,IR(o,t),a)}return s}function j$e(t,e){if(t==null)return{};var n=Xae(TFe(t),function(r){return[r]});return e=T$e(e),U$e(t,n,function(r,i){return e(r,i[0])})}var F$e="Expected a function";function $$e(t,e,n){var r=!0,i=!0;if(typeof t!="function")throw new TypeError(F$e);return So(n)&&(r="leading"in n?!1:r,i="trailing"in n?!0:i),L$e(t,e,{leading:r,maxWait:e,trailing:i})}const CM={default_server_config:{"m.homeserver":{base_url:"http://localhost:8008",server_name:"localhost"}},features:{feature_use_device_session_member_events:!0},ssla:"https://static.element.io/legal/element-software-and-services-license-agreement-uk-1.pdf",app_prompt:!0};function J8(t){return!(t.ok||t.url.startsWith("file:")&&t.status===0)}class yn{static get(){if(!this.internalInstance?.config)throw new Error("Config instance read before config got initialized");return this.internalInstance.config}static async init(){if(!yn.internalInstance?.initPromise){const e=new yn;yn.internalInstance=e;let n;window.location.pathname.endsWith("/room/")||window.location.pathname.endsWith("/room")?n=new URL("/config.json",window.location.href).href:n="config.json",yn.internalInstance.initPromise=B$e(n).then(r=>{e.config=D$e({},CM,r)})}return yn.internalInstance.initPromise}static initDefault(){yn.internalInstance=new yn,yn.internalInstance.config={...CM}}static defaultHomeserverUrl(){return ur().homeserver??yn.get().default_server_config?.["m.homeserver"].base_url}static defaultServerName(){const e=ur().homeserver;return e?new URL(e).hostname:yn.get().default_server_config?.["m.homeserver"].server_name}}async function B$e(t){const e=await fetch(t);return J8(e)?CM:e.json()}var qn=(t=>(t[t.NONE=0]="NONE",t[t.PER_PARTICIPANT=1]="PER_PARTICIPANT",t[t.SHARED_KEY=2]="SHARED_KEY",t))(qn||{});let Dc;/android/i.test(navigator.userAgent)?Dc="android":/iPad|iPhone|iPod|Mac/.test(navigator.userAgent)&&"ontouchend"in document?Dc="ios":Dc="desktop";const H$e=()=>{const{userAgent:t}=navigator;return t.includes("Firefox")};var mce=(t=>(t.StartNewCall="start_call",t.JoinExistingCall="join_existing",t.StartNewCallDM="start_call_dm",t.StartNewCallDMVoice="start_call_dm_voice",t.JoinExistingCallDM="join_existing_dm",t.JoinExistingCallDMVoice="join_existing_dm_voice",t.Unknown="unknown",t))(mce||{}),l_=(t=>(t.None="none",t.Standard="standard",t.AppBar="app_bar",t))(l_||{});function q$e(t,e){const n=t.indexOf("?"),r=e(new URLSearchParams(n===-1?"":t.substring(n)));return`${t.substring(0,n)}?${r.toString()}`}class gce{constructor(e,n){this.queryParams=new URLSearchParams(e);const r=n.indexOf("?");this.fragmentParams=new URLSearchParams(r===-1?"":n.substring(r))}getParam(e){return this.fragmentParams.get(e)??this.queryParams.get(e)}getEnumParam(e,n){const r=this.getParam(e);if(r!==null&&Object.values(n).includes(r))return r}getAllParams(e){return[...this.fragmentParams.getAll(e),...this.queryParams.getAll(e)]}getFlagParam(e,n=!1){const r=this.getParam(e);return r===null?n:r!=="false"}getFlag(e){const n=this.getParam(e);return n!==null?n!=="false":void 0}}let a1={};const ur=(t=window.location.search,e=window.location.hash)=>{if(a1.search===t&&a1.hash===e&&a1.params)return a1.params;const n=V$e(t,e);return a1={search:t,hash:e,params:n},n},V$e=(t="",e="")=>{const n=new gce(t,e),r=parseFloat(n.getParam("fontScale")??""),i=n.getParam("widgetId"),s=n.getParam("parentUrl"),o=!!i&&!!s,a=o?n.getEnumParam("intent",mce)??"unknown":"unknown";let c={confineToRoom:!0,appPrompt:!1,preload:!1,header:Dc==="desktop"?"none":"app_bar",showControls:!0,hideScreensharing:!1,allowIceFallback:!0,perParticipantE2EE:!0,controlledAudioDevices:Dc!=="desktop",skipLobby:!0,returnToLobby:!1,sendNotificationType:"notification",autoLeaveWhenOthersLeft:!1,waitForCallPickup:!1};switch(a){case"start_call":c.skipLobby=!1,c.callIntent="video";break;case"join_existing":c.skipLobby=!1,c.callIntent="video";break;case"start_call_dm_voice":c.callIntent="audio";case"start_call_dm":c.skipLobby=!0,c.sendNotificationType="ring",c.autoLeaveWhenOthersLeft=!0,c.waitForCallPickup=!0,c.callIntent=c.callIntent??"video";break;case"join_existing_dm_voice":c.callIntent="audio";case"join_existing_dm":c.skipLobby=!0,c.autoLeaveWhenOthersLeft=!0,c.callIntent=c.callIntent??"video";break;default:c={confineToRoom:!1,appPrompt:!0,preload:!1,header:"standard",showControls:!0,hideScreensharing:!1,allowIceFallback:!1,perParticipantE2EE:!1,controlledAudioDevices:!1,skipLobby:!1,returnToLobby:!1,sendNotificationType:void 0,autoLeaveWhenOthersLeft:!1,waitForCallPickup:!1}}const l={widgetId:i,parentUrl:s,roomId:n.getParam("roomId"),password:n.getParam("password"),userId:o?n.getParam("userId"):null,displayName:n.getParam("displayName"),deviceId:o?n.getParam("deviceId"):null,baseUrl:o?n.getParam("baseUrl"):null,lang:n.getParam("lang"),fonts:n.getAllParams("font"),fontScale:Number.isNaN(r)?null:r,theme:n.getParam("theme"),viaServers:o?null:n.getParam("viaServers"),homeserver:o?null:n.getParam("homeserver"),posthogApiHost:n.getParam("posthogApiHost"),posthogApiKey:n.getParam("posthogApiKey"),posthogUserId:n.getParam("posthogUserId")??n.getParam("analyticsID"),rageshakeSubmitUrl:n.getParam("rageshakeSubmitUrl"),sentryDsn:n.getParam("sentryDsn"),sentryEnvironment:n.getParam("sentryEnvironment"),e2eEnabled:n.getFlagParam("enableE2EE",!0)},d={confineToRoom:n.getFlag("confineToRoom"),appPrompt:n.getFlag("appPrompt"),preload:o?n.getFlag("preload"):void 0,header:n.getEnumParam("header",l_),showControls:n.getFlag("showControls"),hideScreensharing:n.getFlag("hideScreensharing"),allowIceFallback:n.getFlag("allowIceFallback"),perParticipantE2EE:n.getFlag("perParticipantE2EE"),controlledAudioDevices:n.getFlag("controlledAudioDevices"),skipLobby:o?n.getFlag("skipLobby"):!1,returnToLobby:o?n.getFlag("returnToLobby"):!1,sendNotificationType:n.getEnumParam("sendNotificationType",["ring","notification"]),waitForCallPickup:n.getFlag("waitForCallPickup"),autoLeaveWhenOthersLeft:n.getFlag("autoLeave"),noiseSuppression:n.getFlagParam("noiseSuppression",!0),echoCancellation:n.getFlagParam("echoCancellation",!0)};return N.info(`UrlParams: final set of url params
`,"intent:",a,`
properties:`,l,"configuration:",d),{...l,...c,...j$e(d,h=>h!==void 0)}},nc=()=>{const{search:t,hash:e}=vs();return _.useMemo(()=>ur(t,e),[t,e])};function K$e(t,e,n){let r=null;t=t.substring(1);const i=t.split("/"),s=i[0]=="room",o=i.length>1;n===""||n.startsWith("#?")?(o&&s&&(r=i[1]),s||(r=i[0])):r=n,r=r?.split("?")[0]??null,r&&(r.length<=1?r=null:(r.startsWith("#")||(r=`#${r}`),r.includes(":")||(r=`${r}:${yn.defaultServerName()}`)));const a=new gce(e,n);let c=a.getParam("roomId");return c!==null&&(c=c.replaceAll(/^[^ -~]+|[^ -~]+$/g,""),c.startsWith("!")&&c.includes("")||(c=null)),{roomAlias:r,roomId:c,viaServers:a.getAllParams("viaServers")}}const G$e=()=>{const{pathname:t,search:e,hash:n}=vs();return _.useMemo(()=>K$e(t,e,n),[t,e,n])};function z$e(t,e,n){const r=new URLSearchParams;switch(e?.kind){case qn.SHARED_KEY:{const i=encodeURIComponent(e.secret);i!==e.secret&&N.info("Encoded call password used non URL-safe chars: buggy client?"),r.set("password",i);break}case qn.PER_PARTICIPANT:r.set("perParticipantE2EE","true");break}return r.set("roomId",t),r}const W$e="_rageshakeControl_65ekp_8",gG={rageshakeControl:W$e},vG=1024*1024*5,Y$e=2*1e3,X$e=3;class J$e extends JX{constructor(){super(...arguments),this.logs="",this.log=(e,...n)=>{const r=new Date().toISOString();n=n.map(s=>{if(s instanceof DOMException)return s.message+` (${s.name} | ${s.code})`;if(s instanceof Error)return s.message+(s.stack?`
${s.stack}`:"");if(typeof s=="object")try{return JSON.stringify(s,rBe())}catch{return"<$ failed to serialize object $>"}else return s});let i=`${r} ${e} ${n.join(" ")}
`;i=i.replace(/token=[a-zA-Z0-9-]+/gm,"token=xxxxx"),this.logs+=i,this.emit("log")}}popLogs(){const e=this.logs;return this.logs="",e}peekLogs(){return this.logs}}class Q$e{constructor(e,n){this.indexedDB=e,this.loggerInstance=n,this.index=0,this.onLoggerLog=()=>{this.db&&this.throttledFlush()},this.throttledFlush=$$e(()=>this.flush,Y$e,{leading:!1,trailing:!0}),this.flush=async()=>this.flushPromise?this.flushAgainPromise?this.flushAgainPromise:(this.flushAgainPromise=this.flushPromise.then(this.flush).then(()=>{this.flushAgainPromise=void 0}),this.flushAgainPromise):(this.flushPromise=new Promise((r,i)=>{if(!this.db){i(new Error("No connected database"));return}const s=this.loggerInstance.popLogs();if(s.length===0){r();return}const o=this.db.transaction(["logs","logslastmod"],"readwrite"),a=o.objectStore("logs");o.oncomplete=()=>{r()},o.onerror=l=>{N.error("Failed to flush logs : ",l),i(new Error("Failed to write logs: "+o?.error?.message))},a.add(this.generateLogEntry(s)),o.objectStore("logslastmod").put(this.generateLastModifiedTime())}).then(()=>{this.flushPromise=void 0}),this.flushPromise),this.id="instance-"+Qo(16),n.on("log",this.onLoggerLog),window.addEventListener("beforeunload",()=>{this.flush().catch(r=>N.error("Failed to flush logs before unload",r))})}async connect(){const e=this.indexedDB.open("logs");return new Promise((n,r)=>{e.onsuccess=()=>{this.db=e.result,n()},e.onerror=()=>{const i="Failed to open log database: "+e?.error?.name;N.error(i),r(new Error(i))},e.onupgradeneeded=()=>{const i=e.result,s=i.createObjectStore("logs",{keyPath:["id","index"]});s.createIndex("id","id",{unique:!1}),s.add(this.generateLogEntry(new Date+" ::: Log database was created.")),i.createObjectStore("logslastmod",{keyPath:"id"}).add(this.generateLastModifiedTime())}})}async consume(){const e=this.db;if(!e)return Promise.reject(new Error("No connected database"));async function n(l,d){const h=e.transaction("logs","readonly").objectStore("logs");return new Promise((m,g)=>{const y=h.index("id").openCursor(IDBKeyRange.only(l),"prev");let v="";y.onerror=()=>{g(new Error("Query failed: "+y?.error?.message))},y.onsuccess=()=>{const E=y.result;if(!E){m(v);return}v=E.value.lines+v,v.length>=d?m(v):E.continue()}})}async function r(){const l=e.transaction("logslastmod","readonly").objectStore("logslastmod");return Z$e(l,void 0,d=>({id:d.value.id,ts:d.value.ts})).then(d=>d.sort((h,m)=>m.ts-h.ts).map(h=>h.id))}async function i(l){return new Promise((d,h)=>{const m=e.transaction(["logs","logslastmod"],"readwrite"),g=m.objectStore("logs"),y=g.index("id").openKeyCursor(IDBKeyRange.only(l));y.onsuccess=()=>{const E=y.result;E&&(g.delete(E.primaryKey),E.continue())},m.oncomplete=()=>{d()},m.onerror=()=>{h(new Error(`Failed to delete logs for '${l}' : ${m?.error?.message}`))},m.objectStore("logslastmod").delete(l)})}const s=await r();let o=[];const a=[];let c=0;for(let l=0;l<s.length;l++){const d=await n(s[l],vG-c);if(a.push({lines:d,id:s[l]}),c+=d.length,c>=vG){o=s.slice(l+1).map(h=>parseInt(h,10));break}}return o.length>0&&(N.log("Removing logs: ",o),Promise.all(o.map(async l=>i(l))).then(()=>{N.log(`Removed ${o.length} old logs.`)},l=>{N.error(l)})),a}generateLogEntry(e){return{id:this.id,lines:e,index:this.index++}}generateLastModifiedTime(){return{id:this.id,ts:Date.now()}}}async function Z$e(t,e,n){const r=t.openCursor(e);return new Promise((i,s)=>{const o=[];r.onerror=()=>{s(new Error("Query failed: "+r?.error?.message))},r.onsuccess=()=>{const a=r.result;if(!a){i(o);return}o.push(n(a)),a.continue()}})}async function eBe(){return global.mx_rage_logger=new J$e,iBe(N,global.mx_rage_logger.log),["trace","debug","info","warn","error"].forEach(t=>{const e=window.console[t];if(!e)return;const n=`${t.toUpperCase()} matrix_sdk`;window.console[t]=(...r)=>{e(...r),typeof r[0]=="string"&&r[0].startsWith(n)&&global.mx_rage_logger.log(Q8[t],"matrix_sdk",...r)}}),tBe()}async function tBe(){if(global.mx_rage_initStoragePromise)return global.mx_rage_initStoragePromise;N.log("Configuring rageshake persistence...");let t;try{t=window.indexedDB}catch(e){N.warn("Could not get indexDB from window.",e)}return t?(global.mx_rage_store=new Q$e(t,global.mx_rage_logger),global.mx_rage_initStoragePromise=global.mx_rage_store.connect(),global.mx_rage_initStoragePromise):(global.mx_rage_initStoragePromise=Promise.resolve(),global.mx_rage_initStoragePromise)}async function nBe(){if(!global.mx_rage_logger)throw new Error("No console logger, did you forget to call init()?");return global.mx_rage_store?(await global.mx_rage_store.flush(),global.mx_rage_store.consume()):[{lines:global.mx_rage_logger.peekLogs(),id:"-"}]}const rBe=()=>{const t=new WeakSet,e=new WeakMap;return function(n,r){if(typeof r=="object"&&r!==null){if(t.has(r))return"<$ cycle-trimmed $>";t.add(r);let i=0;if(this&&(i=e.get(this)??0),e.set(r,i+1),i>X$e)return"<$ object-pruned $>"}return r}};var Q8=(t=>(t[t.trace=0]="trace",t[t.debug=1]="debug",t[t.info=2]="info",t[t.warn=3]="warn",t[t.error=4]="error",t[t.silent=5]="silent",t))(Q8||{});function iBe(t,e){const n=t,r=n.methodFactory;n.methodFactory=function(i,s,o){const a=r(i,s,o),c=Q8[i],l=c>=s&&c<5;return(...d)=>{a.apply(this,d),l&&e(c,o?.toString(),...d)}},n.setLevel(n.getLevel())}const sBe=async t=>{const{gzip:e}=await Rb(async()=>{const{gzip:r}=await import("./pako.esm-Cf42LiW4.js");return{gzip:r}},[],import.meta.url),n=new TextEncoder().encode(t);return new Blob([e(n)])};async function oBe(t,e){e.append("crypto_version",t.getVersion());const n=await t.getOwnDeviceKeys(),r=[`curve25519:${n.curve25519}`,`ed25519:${n.ed25519}`];e.append("device_keys",r.join(", "));const i=await t.getCrossSigningStatus();e.append("cross_signing_ready",String(await t.isCrossSigningReady())),e.append("cross_signing_key",await t.getCrossSigningKeyId()??"n/a"),e.append("cross_signing_privkey_in_secret_storage",String(i.privateKeysInSecretStorage)),e.append("cross_signing_master_privkey_cached",String(i.privateKeysCachedLocally.masterKey)),e.append("cross_signing_self_signing_privkey_cached",String(i.privateKeysCachedLocally.selfSigningKey)),e.append("cross_signing_user_signing_privkey_cached",String(i.privateKeysCachedLocally.userSigningKey))}async function aBe(t,e,n){const r=t.secretStorage;n.append("secret_storage_ready",String(await e.isSecretStorageReady())),n.append("secret_storage_key_in_account",String(await r.hasKey())),n.append("session_backup_key_in_secret_storage",String(!!await t.isKeyBackupKeyStored()));const i=await e.getSessionBackupPrivateKey();n.append("session_backup_key_cached",String(!!i)),n.append("session_backup_key_well_formed",String(i instanceof Uint8Array))}function cBe(){return ur().rageshakeSubmitUrl??void 0}function xR(t=cBe){const{client:e}=gm(),[{sending:n,sent:r,error:i},s]=_.useState({sending:!1,sent:!1,error:void 0});return{submitRageshake:_.useCallback(async a=>{const c=t();if(!c)throw new Error("No rageshake URL is configured");if(!n)try{s({sending:!0,sent:!1,error:void 0});let l="UNKNOWN";window.navigator&&window.navigator.userAgent&&(l=window.navigator.userAgent);let d="UNKNOWN";try{d=String(window.matchMedia("(pointer: coarse)").matches)}catch(y){N.warn("Could not get coarse pointer for rageshake submit.",y)}let h=a.rageshakeRequestId?`Rageshake ${a.rageshakeRequestId}`:"";a.description&&(h+=`: ${a.description}`);const m=new FormData;if(m.append("text",h??"User did not supply any additional text."),m.append("app","matrix-video-chat"),m.append("version","dev"),m.append("user_agent",l),m.append("installed_pwa","false"),m.append("touch_input",d),m.append("call_backend","livekit"),m.append("hostname",window.location.hostname),e){const y=e.getUserId(),v=e.getUser(y);m.append("display_name",v?.displayName??""),m.append("user_id",e.credentials.userId??""),m.append("device_id",e.deviceId??""),a.roomId&&m.append("room_id",a.roomId);const E=e.getCrypto();E&&(await oBe(E,m),await aBe(e,E,m))}if(a.label&&m.append("label",a.label),navigator.storage&&navigator.storage.persisted)try{m.append("storageManager_persisted",String(await navigator.storage.persisted()))}catch(y){N.warn("coulr not get navigator peristed storage",y)}else if(document.hasStorageAccess)try{m.append("storageManager_persisted",String(await document.hasStorageAccess()))}catch(y){N.warn("could not get storage access",y)}if(navigator.storage&&navigator.storage.estimate)try{const y=await navigator.storage.estimate();m.append("storageManager_quota",String(y.quota)),m.append("storageManager_usage",String(y.usage)),y.usageDetails&&Object.keys(y.usageDetails).forEach(v=>{m.append(`storageManager_usage_${v}`,String(y.usageDetails[v]))})}catch(y){N.warn("could not obatain storage estimate",y)}if(a.sendLogs){const y=await nBe();for(const v of y)m.append("compressed-log",await sBe(v.lines),v.id)}a.rageshakeRequestId&&m.append("group_call_rageshake_request_id",a.rageshakeRequestId);const g=await fetch(c,{method:"POST",body:m});if(g.status!==200)throw new Error(`Failed to submit feedback: receive HTTP ${g.status} ${g.statusText}`);s({sending:!1,sent:!0,error:void 0})}catch(l){s({sending:!1,sent:!1,error:l}),N.error(l)}},[e,n,t]),sending:n,sent:r,error:i,available:!!t()}}function lBe(){const{client:t}=gm();return _.useCallback((n,r)=>{t.sendEvent(n,"org.matrix.rageshake_request",{request_id:r}).catch(i=>{N.error("Failed to send org.matrix.rageshake_request event",i)})},[t])}function uBe(t){const[e,n]=_.useState(!1),r=_.useCallback(()=>n(!1),[n]),{client:i}=gm(),[s,o]=_.useState();return _.useEffect(()=>{if(!i)return;const a=c=>{c.getType()==="org.matrix.rageshake_request"&&t===c.getRoomId()&&i.getUserId()!==c.getSender()&&(o(c.getContent().request_id),n(!0))};return i.on(Pe.Event,a),()=>{i.removeListener(Pe.Event,a)}},[n,t,i]),{rageshakeRequestId:s??"",roomId:t,open:e,onDismiss:r}}const dBe=({description:t})=>{const{submitRageshake:e,sending:n,sent:r,error:i}=xR(),{t:s}=et(),o=_.useCallback(()=>{e({description:t,sendLogs:!0}).catch(c=>{N.error("Failed to send rageshake",c)})},[e,t]);if(!yn.get().rageshake?.submit_url)return null;let a=null;if(n)a=S.jsx("span",{children:s("rageshake_sending")});else if(r)a=S.jsx("div",{children:s("rageshake_sent")});else{let c=s("rageshake_send_logs");i&&(c=s("rageshake_button_error_caption")),a=S.jsx(qt,{onClick:o,className:gG.wideButton,disabled:n,children:c})}return S.jsx("div",{className:gG.rageshakeControl,children:a})},fBe="_error_17zfc_1",hBe="_icon_17zfc_9",Mw={error:fBe,icon:hBe},pBe="_endCall_bwclo_8",mBe={endCall:pBe},vce=({muted:t,...e})=>{const{t:n}=et(),r=t?bae:U8,i=n(t?"unmute_microphone_button_label":"mute_microphone_button_label");return S.jsx(bi,{label:i,children:S.jsx(qt,{iconOnly:!0,"aria-label":i,Icon:r,kind:t?"primary":"secondary",...e})})},yce=({muted:t,...e})=>{const{t:n}=et(),r=t?iNe:Fae,i=n(t?"start_video_button_label":"stop_video_button_label");return S.jsx(bi,{label:i,children:S.jsx(qt,{iconOnly:!0,"aria-label":i,Icon:r,kind:t?"primary":"secondary",...e})})},gBe=({enabled:t,...e})=>{const{t:n}=et(),r=n(t?"stop_screenshare_button_label":"screenshare_button_label");return S.jsx(bi,{label:r,children:S.jsx(qt,{iconOnly:!0,Icon:QDe,kind:t?"primary":"secondary",...e})})},bce=({className:t,...e})=>{const{t:n}=et();return S.jsx(bi,{label:n("hangup_button_label"),children:S.jsx(qt,{className:Le(t,mBe.endCall),iconOnly:!0,"aria-label":n("hangup_button_label"),Icon:uae,destructive:!0,...e})})},_ce=t=>{const{t:e}=et();return S.jsx(bi,{label:e("common.settings"),children:S.jsx(qt,{iconOnly:!0,Icon:JDe,kind:"secondary",...t})})},vBe="_external_jhjdf_8",yBe={external:vBe};function Sce(t,e){const n=Vee(t),r=tte(t,{state:e});return[n,r]}const Ll=({ref:t,to:e,state:n,...r})=>{const[i,s]=Sce(e,n);return S.jsx(XOe,{ref:t,...r,href:i,onClick:s})},Cp=({ref:t,className:e,children:n,...r})=>S.jsx("a",{ref:t,className:Le(e,yBe.external),target:"_blank",rel:"noreferrer noopener",...r,children:n}),Z8=({ref:t,to:e,state:n,...r})=>{const[i,s]=Sce(e,n);return S.jsx(qt,{as:"a",ref:t,...r,href:i,onClick:s})};function eC(t,e,n,r){_.useEffect(()=>{if(t)return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)},[t,e,n,r])}function bBe(t,e,n){_.useEffect(()=>(t.on(e,n),()=>{t.off(e,n)}),[t,e,n])}function u_(t,e,n){const r=_.useCallback(i=>(t.on(e,i),()=>{t.off(e,i)}),[t,e]);return _.useSyncExternalStore(r,n)}function wce(t){return u_(t,Ji.MembershipsChanged,_.useCallback(()=>t.memberships,[t]))}const _Be=""+new URL("cat-4r_NkDcK.ogg",import.meta.url).href,SBe=""+new URL("cat-Dd8bv_2W.mp3",import.meta.url).href,wBe=""+new URL("clap-AxCMZLTd.ogg",import.meta.url).href,EBe=""+new URL("clap-Dxm5qGyl.mp3",import.meta.url).href,CBe=""+new URL("crickets-DUJdcuUa.ogg",import.meta.url).href,TBe=""+new URL("crickets-CcwrRdbq.mp3",import.meta.url).href,RBe=""+new URL("dog-CxIWtkNX.ogg",import.meta.url).href,kBe=""+new URL("dog-BoQdnF-w.mp3",import.meta.url).href,IBe=""+new URL("generic-BBbS3Wph.ogg",import.meta.url).href,xBe=""+new URL("generic-BFeSb6fL.mp3",import.meta.url).href,ABe=""+new URL("lightbulb-BIeJtAR_.ogg",import.meta.url).href,LBe=""+new URL("lightbulb-BrnY00qi.mp3",import.meta.url).href,MBe=""+new URL("party-D7rIOhAQ.ogg",import.meta.url).href,OBe=""+new URL("party-BZPeTgC3.mp3",import.meta.url).href,PBe=""+new URL("deer-DPSlVch4.ogg",import.meta.url).href,DBe=""+new URL("deer-91r1Gyrx.mp3",import.meta.url).href,NBe=""+new URL("rock-BVCJXNC-.ogg",import.meta.url).href,UBe=""+new URL("rock-CHdnB31m.mp3",import.meta.url).href,jBe=""+new URL("wave-FiiOzicp.ogg",import.meta.url).href,FBe=""+new URL("wave-Bzf1LSMH.mp3",import.meta.url).href,$Be=""+new URL("baduntss-Ca1ZuBEK.ogg",import.meta.url).href,BBe=""+new URL("baduntss-DOe0oFuS.mp3",import.meta.url).href,e9="io.element.call.reaction",TM={name:"generic",emoji:"",sound:{mp3:xBe,ogg:IBe}},RM=5,d_=[{emoji:"👍",name:"thumbsup",alias:["+1","yes","thumbs up"]},{emoji:"🎉",name:"party",alias:["hurray","success"],sound:{ogg:MBe,mp3:OBe}},{emoji:"👏",name:"clapping",alias:["celebrate","success"],sound:{ogg:wBe,mp3:EBe}},{emoji:"🐶",name:"dog",alias:["doggo","pupper","woofer","bark"],sound:{ogg:RBe,mp3:kBe}},{emoji:"🐱",name:"cat",alias:["meow","kitty"],sound:{ogg:_Be,mp3:SBe}},{emoji:"💡",name:"lightbulb",alias:["bulb","light","idea","ping"],sound:{ogg:ABe,mp3:LBe}},{emoji:"🦗",name:"crickets",alias:["awkward","silence"],sound:{ogg:CBe,mp3:TBe}},{emoji:"👎",name:"thumbsdown",alias:["-1","no","thumbs no"]},{emoji:"😵‍💫",name:"dizzy",alias:["dazed","confused"]},{emoji:"👌",name:"ok",alias:["okay","cool"]},{emoji:"🥰",name:"heart",alias:["heart","love","smiling"]},{emoji:"😄",name:"laugh",alias:["giggle","joy","smiling"]},{emoji:"🦌",name:"deer",alias:["stag","doe","bleat"],sound:{ogg:PBe,mp3:DBe}},{emoji:"🤘",name:"rock",alias:["cool","horns","guitar"],sound:{ogg:NBe,mp3:UBe}},{emoji:"👋",name:"wave",alias:["hand","waving"],sound:{ogg:jBe,mp3:FBe}},{emoji:"🥁",name:"drum",alias:["joke"],sound:{ogg:$Be,mp3:BBe}}];function Fe(t){const e=_.useCallback(r=>{const i=t.subscribe(r);return()=>i.unsubscribe()},[t]),n=_.useCallback(()=>t.value,[t]);return _.useSyncExternalStore(e,n)}const Ece=_.createContext(void 0),t9=()=>{const t=_.use(Ece);if(!t)throw new Error("useReactions must be used within a ReactionsProvider");return t},HBe=({children:t,rtcSession:e,vm:n})=>{const r=wce(e),i=My(),s=i?.state==="valid"&&i.supportedFeatures.reactions,o=e.room,a=o.client.getUserId(),c=o.client.getDeviceId(),l=`${a}:${c}`,d=_.useMemo(()=>r.find(w=>w.userId===a&&w.deviceId===c)?.eventId,[r,a,c]),h=Fe(n.reactions$),m=_.useMemo(()=>l!==void 0?h[l]:void 0,[l,h]),g=Fe(n.handsRaised$),y=_.useMemo(()=>l!==void 0?g[l]:void 0,[l,g]),v=_.useCallback(async()=>{if(!l)return;const w=y?.reactionEventId;if(w)try{await o.client.redactEvent(e.room.roomId,w),N.debug("Redacted raise hand event")}catch(R){throw N.error("Failed to redact reaction event",w,R),R}else try{if(!d)throw new Error("Cannot find own membership event");const R=await o.client.sendEvent(e.room.roomId,ee.Reaction,{"m.relates_to":{rel_type:vn.Annotation,event_id:d,key:"🖐️"}});N.debug("Sent raise hand event",R.event_id)}catch(R){N.error("Failed to send raised hand",R)}},[d,l,y,e,o]),E=_.useCallback(async w=>{if(!(!l||m)){if(!d)throw new Error("Cannot find own membership event");await o.client.sendEvent(e.room.roomId,e9,{"m.relates_to":{rel_type:vn.Reference,event_id:d},emoji:w.emoji,name:w.name})}},[d,m,o,l,e]);return S.jsx(Ece,{value:{supportsReactions:s,toggleRaisedHand:v,sendReaction:E},children:t})},qBe="_raisedButton_unw54_1",VBe="_reactionPopupMenu_unw54_5",KBe="_reactionPopupMenuRoot_unw54_21",GBe="_reactionPopupMenuModal_unw54_21",zBe="_reactionsMenuSection_unw54_47",WBe="_reactionsMenu_unw54_47",YBe="_reactionButton_unw54_81",XBe="_verticalSeperator_unw54_91",JBe="_alert_unw54_99",vc={raisedButton:qBe,reactionPopupMenu:VBe,reactionPopupMenuRoot:KBe,reactionPopupMenuModal:GBe,reactionsMenuSection:zBe,reactionsMenu:WBe,reactionButton:YBe,verticalSeperator:XBe,alert:JBe};var QBe=Symbol.for("react.lazy"),I3=my[" use ".trim().toString()];function ZBe(t){return typeof t=="object"&&t!==null&&"then"in t}function Cce(t){return t!=null&&typeof t=="object"&&"$$typeof"in t&&t.$$typeof===QBe&&"_payload"in t&&ZBe(t._payload)}function eHe(t){const e=tHe(t),n=_.forwardRef((r,i)=>{let{children:s,...o}=r;Cce(s)&&typeof I3=="function"&&(s=I3(s._payload));const a=_.Children.toArray(s),c=a.find(rHe);if(c){const l=c.props.children,d=a.map(h=>h===c?_.Children.count(l)>1?_.Children.only(null):_.isValidElement(l)?l.props.children:null:h);return S.jsx(e,{...o,ref:i,children:_.isValidElement(l)?_.cloneElement(l,void 0,d):null})}return S.jsx(e,{...o,ref:i,children:s})});return n.displayName=`${t}.Slot`,n}function tHe(t){const e=_.forwardRef((n,r)=>{let{children:i,...s}=n;if(Cce(i)&&typeof I3=="function"&&(i=I3(i._payload)),_.isValidElement(i)){const o=sHe(i),a=iHe(s,i.props);return i.type!==_.Fragment&&(a.ref=r?oR(r,o):o),_.cloneElement(i,a)}return _.Children.count(i)>1?_.Children.only(null):null});return e.displayName=`${t}.SlotClone`,e}var nHe=Symbol("radix.slottable");function rHe(t){return _.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===nHe}function iHe(t,e){const n={...e};for(const r in e){const i=t[r],s=e[r];/^on[A-Z]/.test(r)?i&&s?n[r]=(...a)=>{const c=s(...a);return i(...a),c}:i&&(n[r]=i):r==="style"?n[r]={...i,...s}:r==="className"&&(n[r]=[i,s].filter(Boolean).join(" "))}return{...t,...n}}function sHe(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var oHe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],aHe=oHe.reduce((t,e)=>{const n=eHe(`Primitive.${e}`),r=_.forwardRef((i,s)=>{const{asChild:o,...a}=i,c=o?n:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),S.jsx(c,{...a,ref:s})});return r.displayName=`Primitive.${e}`,{...t,[e]:r}},{}),cHe=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),lHe="VisuallyHidden",kM=_.forwardRef((t,e)=>S.jsx(aHe.span,{...t,ref:e,style:{...cHe,...t.style}}));kM.displayName=lHe;const uHe="_modal_lmgdq_8",dHe="_dialog_lmgdq_14",fHe="_content_lmgdq_21",hHe="_drawer_lmgdq_32",pHe="_close_lmgdq_59",mHe="_header_lmgdq_84",gHe="_body_lmgdq_114",vHe="_tabbed_lmgdq_129",yHe="_handle_lmgdq_133",Qs={modal:uHe,dialog:dHe,content:fHe,drawer:hHe,close:pHe,header:mHe,body:gHe,tabbed:vHe,handle:yHe},bHe="_bg_180k3_8",_He="_animate_180k3_23",SHe="_overlay_180k3_42",io={bg:bHe,animate:_He,overlay:SHe},mm=({title:t,hideHeader:e,children:n,className:r,classNameDrawer:i,classNameModal:s,open:o,onDismiss:a,tabbed:c,...l})=>{const{t:d}=et(),h=wR("(hover: none) or (pointer: coarse)"),m=_.useCallback(g=>{g||a?.()},[a]);if(h)return S.jsx(oo.Root,{open:o,onOpenChange:m,dismissible:a!==void 0,children:S.jsxs(oo.Portal,{children:[S.jsx(oo.Overlay,{className:Le(io.bg)}),S.jsx(oo.Content,{className:Le(r,i,io.overlay,Qs.modal,Qs.drawer,{[Qs.tabbed]:c}),role:"dialog","aria-describedby":void 0,...l,children:S.jsxs("div",{className:Qs.content,children:[S.jsxs("div",{className:Qs.header,children:[S.jsx("div",{className:Qs.handle}),S.jsx(kM,{asChild:!0,children:S.jsx(oo.Title,{children:t})})]}),S.jsx("div",{className:Qs.body,children:n})]})})]})});{const g=S.jsx(l8,{asChild:!0,children:S.jsx(Hc,{as:"h2",weight:"semibold",size:"md",children:t})}),y=S.jsxs("div",{className:Qs.header,children:[g,a!==void 0&&S.jsx(nse,{className:Qs.close,"data-testid":"modal_close","aria-label":d("action.close"),children:S.jsx(W_,{width:20,height:20})})]});return S.jsx(s8,{open:o,onOpenChange:m,children:S.jsxs(o8,{children:[S.jsx(a8,{className:Le(io.bg,io.animate)}),S.jsx(c8,{asChild:!0,"aria-describedby":void 0,role:"dialog",...l,children:S.jsx(pse,{className:Le(r,s,io.overlay,io.animate,Qs.modal,Qs.dialog,{[Qs.tabbed]:c}),children:S.jsxs("div",{className:Qs.content,children:[e?null:y,e?S.jsx(kM,{asChild:!0,children:g}):null,S.jsx("div",{className:Qs.body,children:n})]})})})]})})}},wHe=({raised:t,open:e,...n})=>{const{t:r}=et();return S.jsx(bi,{label:r("common.reactions"),children:S.jsx(qt,{className:Le(t&&vc.raisedButton),"aria-expanded":e,"aria-haspopup":!0,kind:t||e?"primary":"secondary",iconOnly:!0,Icon:t?Rae:XDe,...n})})};function EHe({sendReaction:t,toggleRaisedHand:e,isHandRaised:n,canReact:r,errorText:i}){const{t:s}=et(),[o,a]=_.useState(!1),c=_.useMemo(()=>o?d_:d_.slice(0,5),[o]),l=s(n?"action.lower_hand":"action.raise_hand");return S.jsxs(S.Fragment,{children:[i&&S.jsx(_5e,{className:vc.alert,type:"critical",title:s("error.generic"),children:i}),S.jsxs("div",{className:vc.reactionPopupMenu,children:[S.jsx("section",{className:vc.handRaiseSection,children:S.jsx(bi,{label:l,caption:"H",children:S.jsx(qt,{kind:n?"primary":"secondary","aria-keyshortcuts":"H","aria-pressed":n,"aria-label":l,onClick:()=>e(),iconOnly:!0,Icon:Rae})})}),S.jsx("div",{className:vc.verticalSeperator}),S.jsx("section",{className:vc.reactionsMenuSection,children:S.jsx("menu",{className:Le(o&&vc.reactionsMenuExpanded,vc.reactionsMenu),children:c.map((d,h)=>S.jsx("li",{children:S.jsx(bi,{label:d.name,caption:h<RM?(h+1).toString():void 0,children:S.jsx(qt,{kind:"secondary",className:vc.reactionButton,disabled:!r,onClick:()=>t(d),"aria-keyshortcuts":h<RM?(h+1).toString():void 0,children:d.emoji})})},d.name))})}),S.jsx("section",{style:{marginLeft:"var(--cpd-separator-spacing)"},children:S.jsx(bi,{label:s(o?"action.show_less":"action.show_more"),children:S.jsx(qt,{iconOnly:!0,"aria-label":s(o?"action.show_less":"action.show_more"),Icon:o?$De:K9e,kind:"tertiary",onClick:()=>a(!o)})})})]})]})}function CHe({identifier:t,vm:e,...n}){const{t:r}=et(),{toggleRaisedHand:i,sendReaction:s}=t9(),[o,a]=_.useState(!1),[c,l]=_.useState(!1),[d,h]=_.useState(),m=!!Fe(e.handsRaised$)[t],g=!Fe(e.reactions$)[t];_.useEffect(()=>{h(void 0)},[c]);const y=_.useCallback(async E=>{try{a(!0),await s(E),h(void 0),l(!1)}catch(w){h(w instanceof Error?w.message:"Unknown error"),N.error("Failed to send reaction",w)}finally{a(!1)}},[s]),v=_.useCallback(()=>{(async()=>{try{a(!0),await i(),l(!1)}catch(w){h(w instanceof Error?w.message:"Unknown error"),N.error("Failed to raise/lower hand",w)}finally{a(!1)}})()},[i]);return S.jsxs(S.Fragment,{children:[S.jsx(wHe,{disabled:o,onClick:()=>l(E=>!E),raised:!!m,open:c,...n}),S.jsx(mm,{open:c,title:r("action.pick_reaction"),hideHeader:!0,classNameModal:vc.reactionPopupMenuModal,className:vc.reactionPopupMenuRoot,onDismiss:()=>l(!1),children:S.jsx(EHe,{errorText:d,isHandRaised:!!m,canReact:!o&&!!g,sendReaction:E=>{y(E)},toggleRaisedHand:v})})]})}class THe extends JX{constructor(){super(...arguments),this.eventBacklogs=new Map}emit(e,...n){const r=super.emit(e,...n);if(!r){const i=this.eventBacklogs.get(e);i?i.push(n):this.eventBacklogs.set(e,[n])}return r}on(e,n){super.on(e,n);const r=this.eventBacklogs.get(e);if(r){for(const i of r)super.emit(e,...i);this.eventBacklogs.delete(e)}return this}addListener(e,n){return this.on(e,n)}once(e,n){super.once(e,n);const r=this.eventBacklogs.get(e);return r&&(super.emit(e,...r[0]),r.length===1?this.eventBacklogs.delete(e):r.shift()),this}}var kl=(t=>(t.JoinCall="io.element.join",t.HangupCall="im.vector.hangup",t.Close="io.element.close",t.DeviceMute="io.element.device_mute",t))(kl||{});let Et;const RHe=(t="m.call",e=!1)=>{try{const{widgetId:n,parentUrl:r,roomId:i,userId:s,deviceId:o,baseUrl:a,e2eEnabled:c,allowIceFallback:l}=ur();if(!i)throw new Error("Room ID must be supplied");if(!s)throw new Error("User ID must be supplied");if(!o)throw new Error("Device ID must be supplied");if(!a)throw new Error("Base URL must be supplied");if(n&&r){const d=new URL(r).origin;N.info("Widget API is available");const h=new dbe(n,d);h.requestCapability(lp.AlwaysOnScreen);const m=new THe;[Ir.ThemeChange,"io.element.join","im.vector.hangup","io.element.device_mute"].forEach(C=>{h.on(`action:${C}`,k=>{k.preventDefault(),m.emit(C,k)})});const g=[ee.CallNotify,ee.RTCNotification];e&&g.push(ee.RoomMessage);const y=["org.matrix.rageshake_request",ee.CallEncryptionKeysPrefix,ee.Reaction,ee.RoomRedaction,e9,ee.RTCDecline,ee.RTCMembership],v=[s,`_${s}_${o}_${t}`,`${s}_${o}_${t}`].map(C=>({eventType:ee.GroupCallMemberPrefix,stateKey:C})),E=[{eventType:ee.RoomCreate},{eventType:ee.RoomName},{eventType:ee.RoomMember},{eventType:ee.RoomEncryption},{eventType:ee.GroupCallMemberPrefix}],w=[ee.CallInvite,ee.CallCandidates,ee.CallAnswer,ee.CallHangup,ee.CallReject,ee.CallSelectAnswer,ee.CallNegotiate,ee.CallSDPStreamMetadataChanged,ee.CallSDPStreamMetadataChangedPrefix,ee.CallReplaces,ee.CallEncryptionKeysPrefix],R=$Q(h,{sendEvent:[...g,...y],receiveEvent:y,sendState:v,receiveState:E,sendToDevice:w,receiveToDevice:w,turnServers:!1,sendDelayedEvents:!0,updateDelayedEvents:!0,sendSticky:!0,receiveSticky:!0},i,{baseUrl:a,userId:s,deviceId:o,timelineSupport:!0,useE2eForGroupCall:c,fallbackICEServerAllowed:l},!1);Et={api:h,lazyActions:m,client:(async()=>(await yn.init(),await R.startClient({clientWellKnownPollPeriod:600}),R))()}}else N.info("No widget API available"),Et=null}catch(n){N.warn("Continuing without the widget API",n),Et=null}},f_=({Icon:t,title:e,rageshake:n,fatal:r,children:i,widget:s})=>{const{t:o}=et(),{confineToRoom:a}=nc(),c=_.useCallback(()=>{window.location.href="/"},[]),l=({widget:h})=>{const m=()=>{h.api.transport.send(kl.Close,{}).catch(g=>{N.error("Failed to send close action",g)}).finally(()=>{h.api.transport.stop()})};return S.jsx(qt,{kind:"primary",onClick:m,children:o("action.close")})},d=()=>r||location.pathname==="/"?S.jsx(qt,{kind:"tertiary",className:Mw.homeLink,onClick:c,children:o("return_home_button")}):S.jsx(Z8,{kind:"tertiary",className:Mw.homeLink,to:"/",children:o("return_home_button")});return S.jsxs("div",{className:Mw.error,children:[S.jsx(qoe,{className:Mw.icon,children:S.jsx(t,{"aria-hidden":!0})}),S.jsx(Hc,{as:"h1",weight:"semibold",size:"md",children:e}),i,n&&S.jsx(dBe,{description:`***Error View***: ${e}`}),s?S.jsx(l,{widget:s}):!a&&S.jsx(d,{})]})};class Tce extends Error{constructor(e,n){super(e),this.richMessage=n}}const kHe=()=>{const{t}=et();return S.jsx(f_,{widget:Et,Icon:j8,title:t("error.open_elsewhere"),children:S.jsx("p",{children:t("error.open_elsewhere_description",{brand:"Element Call"})})})};class IHe extends Tce{constructor(){super("App opened in another tab",S.jsx(kHe,{}))}}const dv=({className:t,children:e})=>{const{header:n}=nc();return S.jsxs("div",{className:Le(U6.page,t),children:[n==="standard"&&S.jsxs(gd,{children:[S.jsx(hh,{children:S.jsx(Bp,{})}),S.jsx(ph,{})]}),S.jsx("div",{className:U6.container,children:S.jsx("div",{className:U6.content,children:e})})]})},h_=({error:t,widget:e})=>{const{t:n}=et();return _.useEffect(()=>{N.error(t),JT(t)},[t]),S.jsx(dv,{children:t instanceof Tce?t.richMessage:S.jsx(f_,{widget:e,Icon:z_,title:n("error.generic"),rageshake:!0,fatal:!0,children:S.jsx("p",{children:n("error.generic_description")})})})},AR=()=>{const{t}=et();return S.jsx(dv,{children:S.jsx("h1",{children:t("common.loading")})})};function yG(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable}))),n.push.apply(n,r)}return n}function $e(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?yG(Object(n),!0).forEach((function(r){be(t,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):yG(Object(n)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))}))}return t}function p_(t){return p_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p_(t)}function ln(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function bG(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function un(t,e,n){return e&&bG(t.prototype,e),n&&bG(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function be(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function xHe(t,e){if(t==null)return{};var n,r,i=(function(o,a){if(o==null)return{};var c,l,d={},h=Object.keys(o);for(l=0;l<h.length;l++)c=h[l],a.indexOf(c)>=0||(d[c]=o[c]);return d})(t,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(r=0;r<s.length;r++)n=s[r],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}function Ms(t,e){return(function(n){if(Array.isArray(n))return n})(t)||(function(n,r){var i=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(i!=null){var s,o,a=[],c=!0,l=!1;try{for(i=i.call(n);!(c=(s=i.next()).done)&&(a.push(s.value),!r||a.length!==r);c=!0);}catch(d){l=!0,o=d}finally{try{c||i.return==null||i.return()}finally{if(l)throw o}}return a}})(t,e)||n9(t,e)||(function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)})()}function Wu(t){return(function(e){if(Array.isArray(e))return IM(e)})(t)||(function(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)})(t)||n9(t)||(function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)})()}function n9(t,e){if(t){if(typeof t=="string")return IM(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set"?Array.from(t):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?IM(t,e):void 0}}function IM(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Xa(t,e){var n=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=n9(t))||e){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(c){throw c},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s,o=!0,a=!1;return{s:function(){n=n.call(t)},n:function(){var c=n.next();return o=c.done,c},e:function(c){a=!0,s=c},f:function(){try{o||n.return==null||n.return()}finally{if(a)throw s}}}}var Aa={DEBUG:!1,LIB_VERSION:"1.160.3"},AHe=Array.isArray,Rce=Object.prototype,kce=Rce.hasOwnProperty,LR=Rce.toString,yi=AHe||function(t){return LR.call(t)==="[object Array]"},Fa=function(t){return typeof t=="function"},Zi=function(t){return t===Object(t)&&!yi(t)},tC=function(t){if(Zi(t)){for(var e in t)if(kce.call(t,e))return!1;return!0}return!1},st=function(t){return t===void 0},hs=function(t){return LR.call(t)=="[object String]"},_G=function(t){return hs(t)&&t.trim().length===0},bd=function(t){return t===null},go=function(t){return st(t)||bd(t)},La=function(t){return LR.call(t)=="[object Number]"},fp=function(t){return LR.call(t)==="[object Boolean]"},LHe=function(t){return t instanceof FormData},ce=typeof window<"u"?window:void 0,lo=typeof globalThis<"u"?globalThis:ce,Ice=Array.prototype,SG=Ice.forEach,wG=Ice.indexOf,Ac=lo?.navigator,Ge=lo?.document,eo=lo?.location,xM=lo?.fetch,AM=lo!=null&&lo.XMLHttpRequest&&"withCredentials"in new lo.XMLHttpRequest?lo.XMLHttpRequest:void 0,EG=lo?.AbortController,Li=Ac?.userAgent,ar=ce??{},CG="[PostHog.js]",Te={_log:function(t){if(ce&&(Aa.DEBUG||ar.POSTHOG_DEBUG)&&!st(ce.console)&&ce.console){for(var e=("__rrweb_original__"in ce.console[t])?ce.console[t].__rrweb_original__:ce.console[t],n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];e.apply(void 0,[CG].concat(r))}},info:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];Te._log.apply(Te,["log"].concat(e))},warn:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];Te._log.apply(Te,["warn"].concat(e))},error:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];Te._log.apply(Te,["error"].concat(e))},critical:function(){for(var t,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];(t=console).error.apply(t,[CG].concat(n))},uninitializedWarning:function(t){Te.error("You must initialize PostHog before calling ".concat(t))}},x3={},MR=function(t){return t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")};function fv(t,e,n){if(yi(t)){if(SG&&t.forEach===SG)t.forEach(e,n);else if("length"in t&&t.length===+t.length){for(var r=0,i=t.length;r<i;r++)if(r in t&&e.call(n,t[r],r)===x3)return}}}function Nn(t,e,n){if(!go(t)){if(yi(t))return fv(t,e,n);if(LHe(t)){var r,i=Xa(t.entries());try{for(i.s();!(r=i.n()).done;){var s=r.value;if(e.call(n,s[1],s[0])===x3)return}}catch(a){i.e(a)}finally{i.f()}}else for(var o in t)if(kce.call(t,o)&&e.call(n,t[o],o)===x3)return}}var Os=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return fv(n,(function(i){for(var s in i)i[s]!==void 0&&(t[s]=i[s])})),t};function Wt(t,e){return t.indexOf(e)!==-1}function nC(t){for(var e=Object.keys(t),n=e.length,r=new Array(n);n--;)r[n]=[e[n],t[e[n]]];return r}var xce=function(){return Date.now=Date.now||function(){return+new Date},Date.now()},TG=function(t){try{return t()}catch{return}},MHe=function(t){return function(){try{for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t.apply(this,n)}catch(i){Te.critical("Implementation error. Please turn on debug mode and open a ticket on https://app.posthog.com/home#panel=support%3Asupport%3A."),Te.critical(i)}}},LM=function(t){var e={};return Nn(t,(function(n,r){hs(n)&&n.length>0&&(e[r]=n)})),e},MM=function(t){return t.replace(/^\$/,"")};function OHe(t,e){return n=t,r=function(s){return hs(s)&&!bd(e)?s.slice(0,e):s},i=new Set,(function s(o,a){return o!==Object(o)?r?r(o,a):o:i.has(o)?void 0:(i.add(o),yi(o)?(c=[],fv(o,(function(l){c.push(s(l))}))):(c={},Nn(o,(function(l,d){i.has(l)||(c[d]=s(l,d))}))),c);var c})(n);var n,r,i}var Ic,PHe=function(t){var e,n,r,i,s="";for(e=n=0,r=(t=(t+"").replace(/\r\n/g,`
`).replace(/\r/g,`
`)).length,i=0;i<r;i++){var o=t.charCodeAt(i),a=null;o<128?n++:a=o>127&&o<2048?String.fromCharCode(o>>6|192,63&o|128):String.fromCharCode(o>>12|224,o>>6&63|128,63&o|128),bd(a)||(n>e&&(s+=t.substring(e,n)),s+=a,e=n=i+1)}return n>e&&(s+=t.substring(e,t.length)),s},Nu=(function(){function t(e){return e&&(e.preventDefault=t.preventDefault,e.stopPropagation=t.stopPropagation),e}return t.preventDefault=function(){this.returnValue=!1},t.stopPropagation=function(){this.cancelBubble=!0},function(e,n,r,i,s){if(e)if(e.addEventListener&&!i)e.addEventListener(n,r,!!s);else{var o="on"+n,a=e[o];e[o]=(function(c,l,d){return function(h){if(h=h||t(ce?.event)){var m,g=!0;Fa(d)&&(m=d(h));var y=l.call(c,h);return m!==!1&&y!==!1||(g=!1),g}}})(e,r,a)}else Te.error("No valid element provided to register_event")}})();function Ace(t,e){for(var n=0;n<t.length;n++)if(e(t[n]))return t[n]}(function(t){t.GZipJS="gzip-js",t.Base64="base64"})(Ic||(Ic={}));var Lce="$people_distinct_id",O1="__alias",P1="__timers",RG="$autocapture_disabled_server_side",OM="$heatmaps_enabled_server_side",kG="$exception_capture_enabled_server_side",IG="$exception_capture_endpoint_suffix",xG="$web_vitals_enabled_server_side",PM="$session_recording_enabled_server_side",AG="$console_log_recording_enabled_server_side",LG="$session_recording_network_payload_capture",MG="$session_recording_canvas_recording",OG="$replay_sample_rate",PG="$replay_minimum_duration",A3="$sesid",cb="$session_is_sampled",qg="$enabled_feature_flags",DM="$early_access_features",Vg="$stored_person_properties",hf="$stored_group_properties",NM="$surveys",Ow="$surveys_activated",L3="$flag_call_reported",wu="$user_state",UM="$client_session_props",jM="$capture_rate_limit",FM="$initial_campaign_params",$M="$initial_referrer_info",DG="$initial_person_info",M3="$epp",BM="__POSTHOG_TOOLBAR__",DHe=[Lce,O1,"__cmpns",P1,PM,OM,A3,qg,wu,DM,hf,Vg,NM,L3,UM,jM,FM,$M,M3],H6="$active_feature_flags",Pw="$override_feature_flags",NG="$feature_flag_payloads",UG=function(t){var e,n={},r=Xa(nC(t||{}));try{for(r.s();!(e=r.n()).done;){var i=Ms(e.value,2),s=i[0],o=i[1];o&&(n[s]=o)}}catch(a){r.e(a)}finally{r.f()}return n},NHe=(function(){function t(e){ln(this,t),this.instance=e,this._override_warning=!1,this.featureFlagEventHandlers=[],this.reloadFeatureFlagsQueued=!1,this.reloadFeatureFlagsInAction=!1}return un(t,[{key:"getFlags",value:function(){return Object.keys(this.getFlagVariants())}},{key:"getFlagVariants",value:function(){var e=this.instance.get_property(qg),n=this.instance.get_property(Pw);if(!n)return e||{};for(var r=Os({},e),i=Object.keys(n),s=0;s<i.length;s++)r[i[s]]=n[i[s]];return this._override_warning||(Te.warn(" Overriding feature flags!",{enabledFlags:e,overriddenFlags:n,finalFlags:r}),this._override_warning=!0),r}},{key:"getFlagPayloads",value:function(){return this.instance.get_property(NG)||{}}},{key:"reloadFeatureFlags",value:function(){this.reloadFeatureFlagsQueued||(this.reloadFeatureFlagsQueued=!0,this._startReloadTimer())}},{key:"setAnonymousDistinctId",value:function(e){this.$anon_distinct_id=e}},{key:"setReloadingPaused",value:function(e){this.reloadFeatureFlagsInAction=e}},{key:"resetRequestQueue",value:function(){this.reloadFeatureFlagsQueued=!1}},{key:"_startReloadTimer",value:function(){var e=this;this.reloadFeatureFlagsQueued&&!this.reloadFeatureFlagsInAction&&setTimeout((function(){!e.reloadFeatureFlagsInAction&&e.reloadFeatureFlagsQueued&&(e.reloadFeatureFlagsQueued=!1,e._reloadFeatureFlagsRequest())}),5)}},{key:"_reloadFeatureFlagsRequest",value:function(){var e=this;if(!this.instance.config.advanced_disable_feature_flags){this.setReloadingPaused(!0);var n=this.instance.config.token,r=this.instance.get_property(Vg),i=this.instance.get_property(hf),s={token:n,distinct_id:this.instance.get_distinct_id(),groups:this.instance.getGroups(),$anon_distinct_id:this.$anon_distinct_id,person_properties:r,group_properties:i,disable_flags:this.instance.config.advanced_disable_feature_flags||void 0};this.instance._send_request({method:"POST",url:this.instance.requestRouter.endpointFor("api","/decide/?v=3"),data:s,compression:this.instance.config.disable_compression?void 0:Ic.Base64,timeout:this.instance.config.feature_flag_request_timeout_ms,callback:function(o){var a;e.setReloadingPaused(!1);var c=!0;o.statusCode===200&&(e.$anon_distinct_id=void 0,c=!1),e.receivedFeatureFlags((a=o.json)!==null&&a!==void 0?a:{},c),e._startReloadTimer()}})}}},{key:"getFeatureFlag",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.instance.decideEndpointWasHit||this.getFlags()&&this.getFlags().length>0){var r,i=this.getFlagVariants()[e],s="".concat(i),o=this.instance.get_property(L3)||{};return(n.send_event||!("send_event"in n))&&(!(e in o)||!o[e].includes(s))&&(yi(o[e])?o[e].push(s):o[e]=[s],(r=this.instance.persistence)===null||r===void 0||r.register(be({},L3,o)),this.instance.capture("$feature_flag_called",{$feature_flag:e,$feature_flag_response:i})),i}Te.warn('getFeatureFlag for key "'+e+`" failed. Feature flags didn't load in time.`)}},{key:"getFeatureFlagPayload",value:function(e){return this.getFlagPayloads()[e]}},{key:"isFeatureEnabled",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.instance.decideEndpointWasHit||this.getFlags()&&this.getFlags().length>0)return!!this.getFeatureFlag(e,n);Te.warn('isFeatureEnabled for key "'+e+`" failed. Feature flags didn't load in time.`)}},{key:"addFeatureFlagsHandler",value:function(e){this.featureFlagEventHandlers.push(e)}},{key:"removeFeatureFlagsHandler",value:function(e){this.featureFlagEventHandlers=this.featureFlagEventHandlers.filter((function(n){return n!==e}))}},{key:"receivedFeatureFlags",value:function(e,n){if(this.instance.persistence){this.instance.decideEndpointWasHit=!0;var r=this.getFlagVariants(),i=this.getFlagPayloads();(function(s,o){var a,c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},d=s.featureFlags,h=s.featureFlagPayloads;if(d)if(yi(d)){var m,g={};if(d)for(var y=0;y<d.length;y++)g[d[y]]=!0;o&&o.register((be(m={},H6,d),be(m,qg,g),m))}else{var v=d,E=h;s.errorsWhileComputingFlags&&(v=$e($e({},c),v),E=$e($e({},l),E)),o&&o.register((be(a={},H6,Object.keys(UG(v))),be(a,qg,v||{}),be(a,NG,E||{}),a))}})(e,this.instance.persistence,r,i),this._fireFeatureFlagsCallbacks(n)}}},{key:"override",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!this.instance.__loaded||!this.instance.persistence)return Te.uninitializedWarning("posthog.feature_flags.override");if(this._override_warning=n,e===!1)this.instance.persistence.unregister(Pw);else if(yi(e)){for(var r={},i=0;i<e.length;i++)r[e[i]]=!0;this.instance.persistence.register(be({},Pw,r))}else this.instance.persistence.register(be({},Pw,e))}},{key:"onFeatureFlags",value:function(e){var n=this;if(this.addFeatureFlagsHandler(e),this.instance.decideEndpointWasHit){var r=this._prepareFeatureFlagsForCallbacks(),i=r.flags,s=r.flagVariants;e(i,s)}return function(){return n.removeFeatureFlagsHandler(e)}}},{key:"updateEarlyAccessFeatureEnrollment",value:function(e,n){var r,i,s=be({},"$feature_enrollment/".concat(e),n);this.instance.capture("$feature_enrollment_update",{$feature_flag:e,$feature_enrollment:n,$set:s}),this.setPersonPropertiesForFlags(s,!1);var o=$e($e({},this.getFlagVariants()),{},be({},e,n));(r=this.instance.persistence)===null||r===void 0||r.register((be(i={},H6,Object.keys(UG(o))),be(i,qg,o),i)),this._fireFeatureFlagsCallbacks()}},{key:"getEarlyAccessFeatures",value:function(e){var n=this,r=arguments.length>1&&arguments[1]!==void 0&&arguments[1],i=this.instance.get_property(DM);if(i&&!r)return e(i);this.instance._send_request({transport:"XHR",url:this.instance.requestRouter.endpointFor("api","/api/early_access_features/?token=".concat(this.instance.config.token)),method:"GET",callback:function(s){var o;if(s.json){var a=s.json.earlyAccessFeatures;return(o=n.instance.persistence)===null||o===void 0||o.register(be({},DM,a)),e(a)}}})}},{key:"_prepareFeatureFlagsForCallbacks",value:function(){var e=this.getFlags(),n=this.getFlagVariants();return{flags:e.filter((function(r){return n[r]})),flagVariants:Object.keys(n).filter((function(r){return n[r]})).reduce((function(r,i){return r[i]=n[i],r}),{})}}},{key:"_fireFeatureFlagsCallbacks",value:function(e){var n=this._prepareFeatureFlagsForCallbacks(),r=n.flags,i=n.flagVariants;this.featureFlagEventHandlers.forEach((function(s){return s(r,i,{errorsLoading:e})}))}},{key:"setPersonPropertiesForFlags",value:function(e){var n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r=this.instance.get_property(Vg)||{};this.instance.register(be({},Vg,$e($e({},r),e))),n&&this.instance.reloadFeatureFlags()}},{key:"resetPersonPropertiesForFlags",value:function(){this.instance.unregister(Vg)}},{key:"setGroupPropertiesForFlags",value:function(e){var n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r=this.instance.get_property(hf)||{};Object.keys(r).length!==0&&Object.keys(r).forEach((function(i){r[i]=$e($e({},r[i]),e[i]),delete e[i]})),this.instance.register(be({},hf,$e($e({},r),e))),n&&this.instance.reloadFeatureFlags()}},{key:"resetGroupPropertiesForFlags",value:function(e){if(e){var n=this.instance.get_property(hf)||{};this.instance.register(be({},hf,$e($e({},n),{},be({},e,{}))))}else this.instance.unregister(hf)}}]),t})();Math.trunc||(Math.trunc=function(t){return t<0?Math.ceil(t):Math.floor(t)}),Number.isInteger||(Number.isInteger=function(t){return La(t)&&isFinite(t)&&Math.floor(t)===t});var jG="0123456789abcdef",UHe=(function(){function t(e){if(ln(this,t),this.bytes=e,e.length!==16)throw new TypeError("not 128-bit length")}return un(t,[{key:"toString",value:function(){for(var e="",n=0;n<this.bytes.length;n++)e=e+jG.charAt(this.bytes[n]>>>4)+jG.charAt(15&this.bytes[n]),n!==3&&n!==5&&n!==7&&n!==9||(e+="-");if(e.length!==36)throw new Error("Invalid UUIDv7 was generated");return e}},{key:"clone",value:function(){return new t(this.bytes.slice(0))}},{key:"equals",value:function(e){return this.compareTo(e)===0}},{key:"compareTo",value:function(e){for(var n=0;n<16;n++){var r=this.bytes[n]-e.bytes[n];if(r!==0)return Math.sign(r)}return 0}}],[{key:"fromFieldsV7",value:function(e,n,r,i){if(!Number.isInteger(e)||!Number.isInteger(n)||!Number.isInteger(r)||!Number.isInteger(i)||e<0||n<0||r<0||i<0||e>0xffffffffffff||n>4095||r>1073741823||i>4294967295)throw new RangeError("invalid field value");var s=new Uint8Array(16);return s[0]=e/Math.pow(2,40),s[1]=e/Math.pow(2,32),s[2]=e/Math.pow(2,24),s[3]=e/Math.pow(2,16),s[4]=e/Math.pow(2,8),s[5]=e,s[6]=112|n>>>8,s[7]=n,s[8]=128|r>>>24,s[9]=r>>>16,s[10]=r>>>8,s[11]=r,s[12]=i>>>24,s[13]=i>>>16,s[14]=i>>>8,s[15]=i,new t(s)}}]),t})(),jHe=(function(){function t(){ln(this,t),be(this,"timestamp",0),be(this,"counter",0),be(this,"random",new FHe)}return un(t,[{key:"generate",value:function(){var e=this.generateOrAbort();if(st(e)){this.timestamp=0;var n=this.generateOrAbort();if(st(n))throw new Error("Could not generate UUID after timestamp reset");return n}return e}},{key:"generateOrAbort",value:function(){var e=Date.now();if(e>this.timestamp)this.timestamp=e,this.resetCounter();else{if(!(e+1e4>this.timestamp))return;this.counter++,this.counter>4398046511103&&(this.timestamp++,this.resetCounter())}return UHe.fromFieldsV7(this.timestamp,Math.trunc(this.counter/Math.pow(2,30)),this.counter&Math.pow(2,30)-1,this.random.nextUint32())}},{key:"resetCounter",value:function(){this.counter=1024*this.random.nextUint32()+(1023&this.random.nextUint32())}}]),t})(),Mce=function(t){if(typeof UUIDV7_DENY_WEAK_RNG<"u"&&UUIDV7_DENY_WEAK_RNG)throw new Error("no cryptographically strong RNG available");for(var e=0;e<t.length;e++)t[e]=65536*Math.trunc(65536*Math.random())+Math.trunc(65536*Math.random());return t};ce&&!st(ce.crypto)&&crypto.getRandomValues&&(Mce=function(t){return crypto.getRandomValues(t)});var FG,FHe=(function(){function t(){ln(this,t),be(this,"buffer",new Uint32Array(8)),be(this,"cursor",1/0)}return un(t,[{key:"nextUint32",value:function(){return this.cursor>=this.buffer.length&&(Mce(this.buffer),this.cursor=0),this.buffer[this.cursor++]}}]),t})(),Cf=function(){return $He().toString()},$He=function(){return(FG||(FG=new jHe)).generate()},BHe="Thu, 01 Jan 1970 00:00:00 GMT",c1="",HHe=/[a-z0-9][a-z0-9-]+\.[a-z]{2,}$/i;function qHe(t,e){if(e){var n=(function(i){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ge;if(c1)return c1;if(!s||["localhost","127.0.0.1"].includes(i))return"";for(var o=i.split("."),a=Math.min(o.length,8),c="dmn_chk_"+Cf(),l=new RegExp("(^|;)\\s*"+c+"=1");!c1&&a--;){var d=o.slice(a).join("."),h=c+"=1;domain=."+d;s.cookie=h,l.test(s.cookie)&&(s.cookie=h+";expires="+BHe,c1=d)}return c1})(t);if(!n){var r=(function(i){var s=i.match(HHe);return s?s[0]:""})(t);r!==n&&Te.info("Warning: cookie subdomain discovery mismatch",r,n),n=r}return n?"; domain=."+n:""}return""}var Gi,Yu={is_supported:function(){return!!Ge},error:function(t){Te.error("cookieStore error: "+t)},get:function(t){if(Ge){try{for(var e=t+"=",n=Ge.cookie.split(";").filter((function(s){return s.length})),r=0;r<n.length;r++){for(var i=n[r];i.charAt(0)==" ";)i=i.substring(1,i.length);if(i.indexOf(e)===0)return decodeURIComponent(i.substring(e.length,i.length))}}catch{}return null}},parse:function(t){var e;try{e=JSON.parse(Yu.get(t))||{}}catch{}return e},set:function(t,e,n,r,i){if(Ge)try{var s="",o="",a=qHe(Ge.location.hostname,r);if(n){var c=new Date;c.setTime(c.getTime()+24*n*60*60*1e3),s="; expires="+c.toUTCString()}i&&(o="; secure");var l=t+"="+encodeURIComponent(JSON.stringify(e))+s+"; SameSite=Lax; path=/"+a+o;return l.length>3686.4&&Te.warn("cookieStore warning: large cookie, len="+l.length),Ge.cookie=l,l}catch{return}},remove:function(t,e){try{Yu.set(t,"",-1,e)}catch{return}}},q6=null,gi={is_supported:function(){if(!bd(q6))return q6;var t=!0;if(st(ce))t=!1;else try{var e="__mplssupport__";gi.set(e,"xyz"),gi.get(e)!=='"xyz"'&&(t=!1),gi.remove(e)}catch{t=!1}return t||Te.error("localStorage unsupported; falling back to cookie store"),q6=t,t},error:function(t){Te.error("localStorage error: "+t)},get:function(t){try{return ce?.localStorage.getItem(t)}catch(e){gi.error(e)}return null},parse:function(t){try{return JSON.parse(gi.get(t))||{}}catch{}return null},set:function(t,e){try{ce?.localStorage.setItem(t,JSON.stringify(e))}catch(n){gi.error(n)}},remove:function(t){try{ce?.localStorage.removeItem(t)}catch(e){gi.error(e)}}},VHe=["distinct_id",A3,cb,M3],Dw=$e($e({},gi),{},{parse:function(t){try{var e={};try{e=Yu.parse(t)||{}}catch{}var n=Os(e,JSON.parse(gi.get(t)||"{}"));return gi.set(t,n),n}catch{}return null},set:function(t,e,n,r,i,s){try{gi.set(t,e,void 0,void 0,s);var o={};VHe.forEach((function(a){e[a]&&(o[a]=e[a])})),Object.keys(o).length&&Yu.set(t,o,n,r,i,s)}catch(a){gi.error(a)}},remove:function(t,e){try{ce?.localStorage.removeItem(t),Yu.remove(t,e)}catch(n){gi.error(n)}}}),Nw={},KHe={is_supported:function(){return!0},error:function(t){Te.error("memoryStorage error: "+t)},get:function(t){return Nw[t]||null},parse:function(t){return Nw[t]||null},set:function(t,e){Nw[t]=e},remove:function(t){delete Nw[t]}},zh=null,Qi={is_supported:function(){if(!bd(zh))return zh;if(zh=!0,st(ce))zh=!1;else try{var t="__support__";Qi.set(t,"xyz"),Qi.get(t)!=='"xyz"'&&(zh=!1),Qi.remove(t)}catch{zh=!1}return zh},error:function(t){Te.error("sessionStorage error: ",t)},get:function(t){try{return ce?.sessionStorage.getItem(t)}catch(e){Qi.error(e)}return null},parse:function(t){try{return JSON.parse(Qi.get(t))||null}catch{}return null},set:function(t,e){try{ce?.sessionStorage.setItem(t,JSON.stringify(e))}catch(n){Qi.error(n)}},remove:function(t){try{ce?.sessionStorage.removeItem(t)}catch(e){Qi.error(e)}}},GHe=["localhost","127.0.0.1"],lb=function(t){var e=Ge?.createElement("a");return st(e)?null:(e.href=t,e)},O3=function(t,e){return!!(function(n){try{new RegExp(n)}catch{return!1}return!0})(e)&&new RegExp(e).test(t)},zHe=function(t){var e,n,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"&",i=[];return Nn(t,(function(s,o){st(s)||st(o)||o==="undefined"||(e=encodeURIComponent((function(a){return a instanceof File})(s)?s.name:s.toString()),n=encodeURIComponent(o),i[i.length]=n+"="+e)})),i.join(r)},$G=function(t,e){for(var n,r=((t.split("#")[0]||"").split("?")[1]||"").split("&"),i=0;i<r.length;i++){var s=r[i].split("=");if(s[0]===e){n=s;break}}if(!yi(n)||n.length<2)return"";var o=n[1];try{o=decodeURIComponent(o)}catch{Te.error("Skipping decoding for malformed query param: "+o)}return o.replace(/\+/g," ")},P3=function(t,e){var n=t.match(new RegExp(e+"=([^&]*)"));return n?n[1]:null},Ga="Mobile",D3="iOS",El="Android",m_="Tablet",Oce=El+" "+m_,Pce="iPad",Dce="Apple",Nce=Dce+" Watch",g_="Safari",Vv="BlackBerry",Uce="Samsung",jce=Uce+"Browser",Fce=Uce+" Internet",Df="Chrome",WHe=Df+" OS",$ce=Df+" "+D3,r9="Internet Explorer",Bce=r9+" "+Ga,i9="Opera",YHe=i9+" Mini",s9="Edge",Hce="Microsoft "+s9,hv="Firefox",qce=hv+" "+D3,v_="Nintendo",y_="PlayStation",pv="Xbox",Vce=El+" "+Ga,Kce=Ga+" "+g_,D1="Windows",HM=D1+" Phone",BG="Nokia",qM="Ouya",Gce="Generic",XHe=Gce+" "+Ga.toLowerCase(),zce=Gce+" "+m_.toLowerCase(),VM="Konqueror",Ts="(\\d+(\\.\\d+)?)",V6=new RegExp("Version/"+Ts),JHe=new RegExp(pv,"i"),QHe=new RegExp(y_+" \\w+","i"),ZHe=new RegExp(v_+" \\w+","i"),o9=new RegExp(Vv+"|PlayBook|BB10","i"),eqe={"NT3.51":"NT 3.11","NT4.0":"NT 4.0","5.0":"2000",5.1:"XP",5.2:"XP","6.0":"Vista",6.1:"7",6.2:"8",6.3:"8.1",6.4:"10","10.0":"10"},tqe=function(t,e){return e&&Wt(e,Dce)||(function(n){return Wt(n,g_)&&!Wt(n,Df)&&!Wt(n,El)})(t)},HG=function(t,e){return e=e||"",Wt(t," OPR/")&&Wt(t,"Mini")?YHe:Wt(t," OPR/")?i9:o9.test(t)?Vv:Wt(t,"IE"+Ga)||Wt(t,"WPDesktop")?Bce:Wt(t,jce)?Fce:Wt(t,s9)||Wt(t,"Edg/")?Hce:Wt(t,"FBIOS")?"Facebook "+Ga:Wt(t,"UCWEB")||Wt(t,"UCBrowser")?"UC Browser":Wt(t,"CriOS")?$ce:Wt(t,"CrMo")?Df:Wt(t,El)&&Wt(t,g_)?Vce:Wt(t,Df)?Df:Wt(t,"FxiOS")?qce:Wt(t.toLowerCase(),VM.toLowerCase())?VM:tqe(t,e)?Wt(t,Ga)?Kce:g_:Wt(t,hv)?hv:Wt(t,"MSIE")||Wt(t,"Trident/")?r9:Wt(t,"Gecko")?hv:""},nqe=(be(Gi={},Bce,[new RegExp("rv:"+Ts)]),be(Gi,Hce,[new RegExp(s9+"?\\/"+Ts)]),be(Gi,Df,[new RegExp("("+Df+"|CrMo)\\/"+Ts)]),be(Gi,$ce,[new RegExp("CriOS\\/"+Ts)]),be(Gi,"UC Browser",[new RegExp("(UCBrowser|UCWEB)\\/"+Ts)]),be(Gi,g_,[V6]),be(Gi,Kce,[V6]),be(Gi,i9,[new RegExp("(Opera|OPR)\\/"+Ts)]),be(Gi,hv,[new RegExp(hv+"\\/"+Ts)]),be(Gi,qce,[new RegExp("FxiOS\\/"+Ts)]),be(Gi,VM,[new RegExp("Konqueror[:/]?"+Ts,"i")]),be(Gi,Vv,[new RegExp(Vv+" "+Ts),V6]),be(Gi,Vce,[new RegExp("android\\s"+Ts,"i")]),be(Gi,Fce,[new RegExp(jce+"\\/"+Ts)]),be(Gi,r9,[new RegExp("(rv:|MSIE )"+Ts)]),be(Gi,"Mozilla",[new RegExp("rv:"+Ts)]),Gi),qG=[[new RegExp(pv+"; "+pv+" (.*?)[);]","i"),function(t){return[pv,t&&t[1]||""]}],[new RegExp(v_,"i"),[v_,""]],[new RegExp(y_,"i"),[y_,""]],[o9,[Vv,""]],[new RegExp(D1,"i"),function(t,e){if(/Phone/.test(e)||/WPDesktop/.test(e))return[HM,""];if(new RegExp(Ga).test(e)&&!/IEMobile\b/.test(e))return[D1+" "+Ga,""];var n=/Windows NT ([0-9.]+)/i.exec(e);if(n&&n[1]){var r=n[1],i=eqe[r]||"";return/arm/i.test(e)&&(i="RT"),[D1,i]}return[D1,""]}],[/((iPhone|iPad|iPod).*?OS (\d+)_(\d+)_?(\d+)?|iPhone)/,function(t){if(t&&t[3]){var e=[t[3],t[4],t[5]||"0"];return[D3,e.join(".")]}return[D3,""]}],[/(watch.*\/(\d+\.\d+\.\d+)|watch os,(\d+\.\d+),)/i,function(t){var e="";return t&&t.length>=3&&(e=st(t[2])?t[3]:t[2]),["watchOS",e]}],[new RegExp("("+El+" (\\d+)\\.(\\d+)\\.?(\\d+)?|"+El+")","i"),function(t){if(t&&t[2]){var e=[t[2],t[3],t[4]||"0"];return[El,e.join(".")]}return[El,""]}],[/Mac OS X (\d+)[_.](\d+)[_.]?(\d+)?/i,function(t){var e=["Mac OS X",""];if(t&&t[1]){var n=[t[1],t[2],t[3]||"0"];e[1]=n.join(".")}return e}],[/Mac/i,["Mac OS X",""]],[/CrOS/,[WHe,""]],[/Linux|debian/i,["Linux",""]]],VG=function(t){return ZHe.test(t)?v_:QHe.test(t)?y_:JHe.test(t)?pv:new RegExp(qM,"i").test(t)?qM:new RegExp("("+HM+"|WPDesktop)","i").test(t)?HM:/iPad/.test(t)?Pce:/iPod/.test(t)?"iPod Touch":/iPhone/.test(t)?"iPhone":/(watch)(?: ?os[,/]|\d,\d\/)[\d.]+/i.test(t)?Nce:o9.test(t)?Vv:/(kobo)\s(ereader|touch)/i.test(t)?"Kobo":new RegExp(BG,"i").test(t)?BG:/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i.test(t)||/(kf[a-z]+)( bui|\)).+silk\//i.test(t)?"Kindle Fire":/(Android|ZTE)/i.test(t)?!new RegExp(Ga).test(t)||/(9138B|TB782B|Nexus [97]|pixel c|HUAWEISHT|BTV|noble nook|smart ultra 6)/i.test(t)?/pixel[\daxl ]{1,6}/i.test(t)&&!/pixel c/i.test(t)||/(huaweimed-al00|tah-|APA|SM-G92|i980|zte|U304AA)/i.test(t)||/lmy47v/i.test(t)&&!/QTAQZ3/i.test(t)?El:Oce:El:new RegExp("(pda|"+Ga+")","i").test(t)?XHe:new RegExp(m_,"i").test(t)&&!new RegExp(m_+" pc","i").test(t)?zce:""},Uw="https?://(.*)",rqe=["utm_source","utm_medium","utm_campaign","utm_content","utm_term","gclid","gad_source","gclsrc","dclid","gbraid","wbraid","fbclid","msclkid","twclid","li_fat_id","mc_cid","igshid","ttclid","rdt_cid"],Mi={campaignParams:function(t){return Ge?this._campaignParamsFromUrl(Ge.URL,t):{}},_campaignParamsFromUrl:function(t,e){var n=rqe.concat(e||[]),r={};return Nn(n,(function(i){var s=$G(t,i);s&&(r[i]=s)})),r},_searchEngine:function(t){return t?t.search(Uw+"google.([^/?]*)")===0?"google":t.search(Uw+"bing.com")===0?"bing":t.search(Uw+"yahoo.com")===0?"yahoo":t.search(Uw+"duckduckgo.com")===0?"duckduckgo":null:null},_searchInfoFromReferrer:function(t){var e=Mi._searchEngine(t),n=e!="yahoo"?"q":"p",r={};if(!bd(e)){r.$search_engine=e;var i=Ge?$G(Ge.referrer,n):"";i.length&&(r.ph_keyword=i)}return r},searchInfo:function(){var t=Ge?.referrer;return t?this._searchInfoFromReferrer(t):{}},browser:HG,browserVersion:function(t,e){var n=HG(t,e),r=nqe[n];if(st(r))return null;for(var i=0;i<r.length;i++){var s=r[i],o=t.match(s);if(o)return parseFloat(o[o.length-2])}return null},browserLanguage:function(){return navigator.language||navigator.userLanguage},os:function(t){for(var e=0;e<qG.length;e++){var n=Ms(qG[e],2),r=n[0],i=n[1],s=r.exec(t),o=s&&(Fa(i)?i(s,t):i);if(o)return o}return["",""]},device:VG,deviceType:function(t){var e=VG(t);return e===Pce||e===Oce||e==="Kobo"||e==="Kindle Fire"||e===zce?m_:e===v_||e===pv||e===y_||e===qM?"Console":e===Nce?"Wearable":e?Ga:"Desktop"},referrer:function(){return Ge?.referrer||"$direct"},referringDomain:function(){var t;return Ge!=null&&Ge.referrer&&((t=lb(Ge.referrer))===null||t===void 0?void 0:t.host)||"$direct"},referrerInfo:function(){return{$referrer:this.referrer(),$referring_domain:this.referringDomain()}},initialPersonInfo:function(){return{r:this.referrer(),u:eo?.href}},initialPersonPropsFromInfo:function(t){var e,n=t.r,r=t.u,i={$initial_referrer:n,$initial_referring_domain:n==null?void 0:n=="$direct"?"$direct":(e=lb(n))===null||e===void 0?void 0:e.host};if(r){i.$initial_current_url=r;var s=lb(r);i.$initial_host=s?.host,i.$initial_pathname=s?.pathname,Nn(this._campaignParamsFromUrl(r),(function(o,a){i["$initial_"+MM(a)]=o}))}return n&&Nn(this._searchInfoFromReferrer(n),(function(o,a){i["$initial_"+MM(a)]=o})),i},properties:function(){if(!Li)return{};var t=Ms(Mi.os(Li),2),e=t[0],n=t[1];return Os(LM({$os:e,$os_version:n,$browser:Mi.browser(Li,navigator.vendor),$device:Mi.device(Li),$device_type:Mi.deviceType(Li)}),{$current_url:eo?.href,$host:eo?.host,$pathname:eo?.pathname,$raw_user_agent:Li.length>1e3?Li.substring(0,997)+"...":Li,$browser_version:Mi.browserVersion(Li,navigator.vendor),$browser_language:Mi.browserLanguage(),$screen_height:ce?.screen.height,$screen_width:ce?.screen.width,$viewport_height:ce?.innerHeight,$viewport_width:ce?.innerWidth,$lib:"web",$lib_version:Aa.LIB_VERSION,$insert_id:Math.random().toString(36).substring(2,10)+Math.random().toString(36).substring(2,10),$time:xce()/1e3})},people_properties:function(){if(!Li)return{};var t=Ms(Mi.os(Li),2),e=t[0],n=t[1];return Os(LM({$os:e,$os_version:n,$browser:Mi.browser(Li,navigator.vendor)}),{$browser_version:Mi.browserVersion(Li,navigator.vendor)})}},iqe=["cookie","localstorage","localstorage+cookie","sessionstorage","memory"],K6=(function(){function t(e){ln(this,t),this.config=e,this.props={},this.campaign_params_saved=!1,this.name=(function(n){var r="";return n.token&&(r=n.token.replace(/\+/g,"PL").replace(/\//g,"SL").replace(/=/g,"EQ")),n.persistence_name?"ph_"+n.persistence_name:"ph_"+r+"_posthog"})(e),this.storage=this.buildStorage(e),this.load(),e.debug&&Te.info("Persistence loaded",e.persistence,$e({},this.props)),this.update_config(e,e),this.save()}return un(t,[{key:"buildStorage",value:function(e){iqe.indexOf(e.persistence.toLowerCase())===-1&&(Te.critical("Unknown persistence type "+e.persistence+"; falling back to localStorage+cookie"),e.persistence="localStorage+cookie");var n=e.persistence.toLowerCase();return n==="localstorage"&&gi.is_supported()?gi:n==="localstorage+cookie"&&Dw.is_supported()?Dw:n==="sessionstorage"&&Qi.is_supported()?Qi:n==="memory"?KHe:n==="cookie"?Yu:Dw.is_supported()?Dw:Yu}},{key:"properties",value:function(){var e={};return Nn(this.props,(function(n,r){if(r===qg&&Zi(n))for(var i=Object.keys(n),s=0;s<i.length;s++)e["$feature/".concat(i[s])]=n[i[s]];else a=r,c=!1,(bd(o=DHe)?c:wG&&o.indexOf===wG?o.indexOf(a)!=-1:(Nn(o,(function(l){if(c||(c=l===a))return x3})),c))||(e[r]=n);var o,a,c})),e}},{key:"load",value:function(){if(!this.disabled){var e=this.storage.parse(this.name);e&&(this.props=Os({},e))}}},{key:"save",value:function(){this.disabled||this.storage.set(this.name,this.props,this.expire_days,this.cross_subdomain,this.secure,this.config.debug)}},{key:"remove",value:function(){this.storage.remove(this.name,!1),this.storage.remove(this.name,!0)}},{key:"clear",value:function(){this.remove(),this.props={}}},{key:"register_once",value:function(e,n,r){var i=this;if(Zi(e)){st(n)&&(n="None"),this.expire_days=st(r)?this.default_expiry:r;var s=!1;if(Nn(e,(function(o,a){i.props.hasOwnProperty(a)&&i.props[a]!==n||(i.props[a]=o,s=!0)})),s)return this.save(),!0}return!1}},{key:"register",value:function(e,n){var r=this;if(Zi(e)){this.expire_days=st(n)?this.default_expiry:n;var i=!1;if(Nn(e,(function(s,o){e.hasOwnProperty(o)&&r.props[o]!==s&&(r.props[o]=s,i=!0)})),i)return this.save(),!0}return!1}},{key:"unregister",value:function(e){e in this.props&&(delete this.props[e],this.save())}},{key:"update_campaign_params",value:function(){this.campaign_params_saved||(this.register(Mi.campaignParams(this.config.custom_campaign_params)),this.campaign_params_saved=!0)}},{key:"update_search_keyword",value:function(){this.register(Mi.searchInfo())}},{key:"update_referrer_info",value:function(){this.register_once(Mi.referrerInfo(),void 0)}},{key:"set_initial_person_info",value:function(){this.props[FM]||this.props[$M]||this.register_once(be({},DG,Mi.initialPersonInfo()),void 0)}},{key:"get_referrer_info",value:function(){return LM({$referrer:this.props.$referrer,$referring_domain:this.props.$referring_domain})}},{key:"get_initial_props",value:function(){var e=this,n={};Nn([$M,FM],(function(s){var o=e.props[s];o&&Nn(o,(function(a,c){n["$initial_"+MM(c)]=a}))}));var r=this.props[DG];if(r){var i=Mi.initialPersonPropsFromInfo(r);Os(n,i)}return n}},{key:"safe_merge",value:function(e){return Nn(this.props,(function(n,r){r in e||(e[r]=n)})),e}},{key:"update_config",value:function(e,n){if(this.default_expiry=this.expire_days=e.cookie_expiration,this.set_disabled(e.disable_persistence),this.set_cross_subdomain(e.cross_subdomain_cookie),this.set_secure(e.secure_cookie),e.persistence!==n.persistence){var r=this.buildStorage(e),i=this.props;this.clear(),this.storage=r,this.props=i,this.save()}}},{key:"set_disabled",value:function(e){this.disabled=e,this.disabled?this.remove():this.save()}},{key:"set_cross_subdomain",value:function(e){e!==this.cross_subdomain&&(this.cross_subdomain=e,this.remove(),this.save())}},{key:"get_cross_subdomain",value:function(){return!!this.cross_subdomain}},{key:"set_secure",value:function(e){e!==this.secure&&(this.secure=e,this.remove(),this.save())}},{key:"set_event_timer",value:function(e,n){var r=this.props[P1]||{};r[e]=n,this.props[P1]=r,this.save()}},{key:"remove_event_timer",value:function(e){var n=(this.props[P1]||{})[e];return st(n)||(delete this.props[P1][e],this.save()),n}},{key:"get_property",value:function(e){return this.props[e]}},{key:"set_property",value:function(e,n){this.props[e]=n,this.save()}}]),t})();function KM(t){return JSON.stringify(t,(e=[],function(n,r){if(Zi(r)){for(;e.length>0&&e.at(-1)!==this;)e.pop();return e.includes(r)?"[Circular]":(e.push(r),r)}return r})).length;var e}var sqe=2,oqe=4;function GM(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:66060288e-1;if(t.size>=e&&t.data.length>1){var n=Math.floor(t.data.length/2),r=t.data.slice(0,n),i=t.data.slice(n);return[GM({size:KM(r),data:r,sessionId:t.sessionId,windowId:t.windowId}),GM({size:KM(i),data:i,sessionId:t.sessionId,windowId:t.windowId})].flatMap((function(s){return s}))}return[t]}var rC=(function(t){return t[t.DomContentLoaded=0]="DomContentLoaded",t[t.Load=1]="Load",t[t.FullSnapshot=2]="FullSnapshot",t[t.IncrementalSnapshot=3]="IncrementalSnapshot",t[t.Meta=4]="Meta",t[t.Custom=5]="Custom",t[t.Plugin=6]="Plugin",t})(rC||{}),gu=(function(t){return t[t.Mutation=0]="Mutation",t[t.MouseMove=1]="MouseMove",t[t.MouseInteraction=2]="MouseInteraction",t[t.Scroll=3]="Scroll",t[t.ViewportResize=4]="ViewportResize",t[t.Input=5]="Input",t[t.TouchMove=6]="TouchMove",t[t.MediaInteraction=7]="MediaInteraction",t[t.StyleSheetRule=8]="StyleSheetRule",t[t.CanvasMutation=9]="CanvasMutation",t[t.Font=10]="Font",t[t.Log=11]="Log",t[t.Drag=12]="Drag",t[t.StyleDeclaration=13]="StyleDeclaration",t[t.Selection=14]="Selection",t[t.AdoptedStyleSheet=15]="AdoptedStyleSheet",t[t.CustomElement=16]="CustomElement",t})(gu||{});function a9(t){return t?MR(t).split(/\s+/):[]}function KG(t){var e=ce?.location.href;return!!(e&&t&&t.some((function(n){return e.match(n)})))}function N3(t){var e="";switch(p_(t.className)){case"string":e=t.className;break;case"object":e=(t.className&&"baseVal"in t.className?t.className.baseVal:null)||t.getAttribute("class")||"";break;default:e=""}return a9(e)}function Wce(t){return go(t)?null:MR(t).split(/(\s+)/).filter((function(e){return mv(e)})).join("").replace(/[\r\n]/g," ").replace(/[ ]+/g," ").substring(0,255)}function U3(t){var e="";return WM(t)&&!Qce(t)&&t.childNodes&&t.childNodes.length&&Nn(t.childNodes,(function(n){var r;Yce(n)&&n.textContent&&(e+=(r=Wce(n.textContent))!==null&&r!==void 0?r:"")})),MR(e)}function c9(t){return!!t&&t.nodeType===1}function Nf(t,e){return!!t&&!!t.tagName&&t.tagName.toLowerCase()===e.toLowerCase()}function Yce(t){return!!t&&t.nodeType===3}function Xce(t){return!!t&&t.nodeType===11}var zM=["a","button","form","input","select","textarea","label"];function Jce(t){var e=t.parentNode;return!(!e||!c9(e))&&e}function aqe(t,e){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;if(!ce||!t||Nf(t,"html")||!c9(t)||n!=null&&n.url_allowlist&&!KG(n.url_allowlist)||n!=null&&n.url_ignorelist&&KG(n.url_ignorelist))return!1;if(n!=null&&n.dom_event_allowlist){var s=n.dom_event_allowlist;if(s&&!s.some((function(g){return e.type===g})))return!1}for(var o=!1,a=[t],c=!0,l=t;l.parentNode&&!Nf(l,"body");)if(Xce(l.parentNode))a.push(l.parentNode.host),l=l.parentNode.host;else{if(!(c=Jce(l)))break;if(r||zM.indexOf(c.tagName.toLowerCase())>-1)o=!0;else{var d=ce.getComputedStyle(c);d&&d.getPropertyValue("cursor")==="pointer"&&(o=!0)}a.push(c),l=c}if(!(function(g,y){var v=y?.element_allowlist;if(st(v))return!0;var E,w=Xa(g);try{var R=function(){var C=E.value;if(v.some((function(k){return C.tagName.toLowerCase()===k})))return{v:!0}};for(w.s();!(E=w.n()).done;){var x=R();if(p_(x)==="object")return x.v}}catch(C){w.e(C)}finally{w.f()}return!1})(a,n)||!(function(g,y){var v=y?.css_selector_allowlist;if(st(v))return!0;var E,w=Xa(g);try{var R=function(){var C=E.value;if(v.some((function(k){return C.matches(k)})))return{v:!0}};for(w.s();!(E=w.n()).done;){var x=R();if(p_(x)==="object")return x.v}}catch(C){w.e(C)}finally{w.f()}return!1})(a,n))return!1;var h=ce.getComputedStyle(t);if(h&&h.getPropertyValue("cursor")==="pointer"&&e.type==="click")return!0;var m=t.tagName.toLowerCase();switch(m){case"html":return!1;case"form":return(i||["submit"]).indexOf(e.type)>=0;case"input":case"select":case"textarea":return(i||["change","click"]).indexOf(e.type)>=0;default:return o?(i||["click"]).indexOf(e.type)>=0:(i||["click"]).indexOf(e.type)>=0&&(zM.indexOf(m)>-1||t.getAttribute("contenteditable")==="true")}}function WM(t){for(var e=t;e.parentNode&&!Nf(e,"body");e=e.parentNode){var n=N3(e);if(Wt(n,"ph-sensitive")||Wt(n,"ph-no-capture"))return!1}if(Wt(N3(t),"ph-include"))return!0;var r=t.type||"";if(hs(r))switch(r.toLowerCase()){case"hidden":case"password":return!1}var i=t.name||t.id||"";return!(hs(i)&&/^cc|cardnum|ccnum|creditcard|csc|cvc|cvv|exp|pass|pwd|routing|seccode|securitycode|securitynum|socialsec|socsec|ssn/i.test(i.replace(/[^a-zA-Z0-9]/g,"")))}function Qce(t){return!!(Nf(t,"input")&&!["button","checkbox","submit","reset"].includes(t.type)||Nf(t,"select")||Nf(t,"textarea")||t.getAttribute("contenteditable")==="true")}var Zce="(4[0-9]{12}(?:[0-9]{3})?)|(5[1-5][0-9]{14})|(6(?:011|5[0-9]{2})[0-9]{12})|(3[47][0-9]{13})|(3(?:0[0-5]|[68][0-9])[0-9]{11})|((?:2131|1800|35[0-9]{3})[0-9]{11})",cqe=new RegExp("^(?:".concat(Zce,")$")),lqe=new RegExp(Zce),ele="\\d{3}-?\\d{2}-?\\d{4}",uqe=new RegExp("^(".concat(ele,")$")),dqe=new RegExp("(".concat(ele,")"));function mv(t){var e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return!(go(t)||hs(t)&&(t=MR(t),(e?cqe:lqe).test((t||"").replace(/[- ]/g,""))||(e?uqe:dqe).test(t)))}function GG(t){var e=U3(t);return mv(e="".concat(e," ").concat(tle(t)).trim())?e:""}function tle(t){var e="";return t&&t.childNodes&&t.childNodes.length&&Nn(t.childNodes,(function(n){var r;if(n&&((r=n.tagName)===null||r===void 0?void 0:r.toLowerCase())==="span")try{var i=U3(n);e="".concat(e," ").concat(i).trim(),n.childNodes&&n.childNodes.length&&(e="".concat(e," ").concat(tle(n)).trim())}catch(s){Te.error(s)}})),e}function fqe(t){return(function(e){var n=e.map((function(r){var i,s,o="";if(r.tag_name&&(o+=r.tag_name),r.attr_class){r.attr_class.sort();var a,c=Xa(r.attr_class);try{for(c.s();!(a=c.n()).done;){var l=a.value;o+=".".concat(l.replace(/"/g,""))}}catch(m){c.e(m)}finally{c.f()}}var d=$e($e($e($e({},r.text?{text:r.text}:{}),{},{"nth-child":(i=r.nth_child)!==null&&i!==void 0?i:0,"nth-of-type":(s=r.nth_of_type)!==null&&s!==void 0?s:0},r.href?{href:r.href}:{}),r.attr_id?{attr_id:r.attr_id}:{}),r.attributes),h={};return nC(d).sort((function(m,g){var y=Ms(m,1)[0],v=Ms(g,1)[0];return y.localeCompare(v)})).forEach((function(m){var g=Ms(m,2),y=g[0],v=g[1];return h[zG(y.toString())]=zG(v.toString())})),o+=":",o+=nC(d).map((function(m){var g=Ms(m,2),y=g[0],v=g[1];return"".concat(y,'="').concat(v,'"')})).join("")}));return n.join(";")})((function(e){return e.map((function(n){var r,i,s={text:(r=n.$el_text)===null||r===void 0?void 0:r.slice(0,400),tag_name:n.tag_name,href:(i=n.attr__href)===null||i===void 0?void 0:i.slice(0,2048),attr_class:hqe(n),attr_id:n.attr__id,nth_child:n.nth_child,nth_of_type:n.nth_of_type,attributes:{}};return nC(n).filter((function(o){return Ms(o,1)[0].indexOf("attr__")===0})).forEach((function(o){var a=Ms(o,2),c=a[0],l=a[1];return s.attributes[c]=l})),s}))})(t))}function zG(t){return t.replace(/"|\\"/g,'\\"')}function hqe(t){var e=t.attr__class;return e?yi(e)?e:a9(e):void 0}var YM="[SessionRecording]",XM="redacted",jw={initiatorTypes:["audio","beacon","body","css","early-hint","embed","fetch","frame","iframe","icon","image","img","input","link","navigation","object","ping","script","track","video","xmlhttprequest"],maskRequestFn:function(t){return t},recordHeaders:!1,recordBody:!1,recordInitialRequests:!1,recordPerformance:!1,performanceEntryTypeToObserve:["first-input","navigation","paint","resource"],payloadSizeLimitBytes:1e6,payloadHostDenyList:[".lr-ingest.io",".ingest.sentry.io"]},pqe=["authorization","x-forwarded-for","authorization","cookie","set-cookie","x-api-key","x-real-ip","remote-addr","forwarded","proxy-authorization","x-csrf-token","x-csrftoken","x-xsrf-token"],mqe=["password","secret","passwd","api_key","apikey","auth","credentials","mysql_pwd","privatekey","private_key","token"],gqe=["/s/","/e/","/i/"];function WG(t,e,n,r){if(go(t))return t;var i=e?.["content-length"]||(function(s){return new Blob([s]).size})(t);return hs(i)&&(i=parseInt(i)),i>n?YM+" ".concat(r," body too large to record (").concat(i," bytes)"):t}function YG(t,e){if(go(t))return t;var n=t;return mv(n,!1)||(n=YM+" "+e+" body "+XM),Nn(mqe,(function(r){var i,s;(i=n)!==null&&i!==void 0&&i.length&&((s=n)===null||s===void 0?void 0:s.indexOf(r))!==-1&&(n=YM+" "+e+" body "+XM+" as might contain: "+r)})),n}var Eu,vqe=function(t,e){var n,r,i,s={payloadSizeLimitBytes:jw.payloadSizeLimitBytes,performanceEntryTypeToObserve:Wu(jw.performanceEntryTypeToObserve),payloadHostDenyList:[].concat(Wu(e.payloadHostDenyList||[]),Wu(jw.payloadHostDenyList))},o=t.session_recording.recordHeaders!==!1&&e.recordHeaders,a=t.session_recording.recordBody!==!1&&e.recordBody,c=t.capture_performance!==!1&&e.recordPerformance,l=(n=s,i=Math.min(1e6,(r=n.payloadSizeLimitBytes)!==null&&r!==void 0?r:1e6),function(m){return m!=null&&m.requestBody&&(m.requestBody=WG(m.requestBody,m.requestHeaders,i,"Request")),m!=null&&m.responseBody&&(m.responseBody=WG(m.responseBody,m.responseHeaders,i,"Response")),m}),d=function(m){return l((function(v){var E=lb(v.name);if(!(E&&E.pathname&&gqe.some((function(w){return E.pathname.indexOf(w)===0}))))return v})((y=(g=m).requestHeaders,go(y)||Nn(Object.keys(y??{}),(function(v){pqe.includes(v.toLowerCase())&&(y[v]=XM)})),g)));var g,y},h=Fa(t.session_recording.maskNetworkRequestFn);return h&&Fa(t.session_recording.maskCapturedNetworkRequestFn)&&Te.warn("Both `maskNetworkRequestFn` and `maskCapturedNetworkRequestFn` are defined. `maskNetworkRequestFn` will be ignored."),h&&(t.session_recording.maskCapturedNetworkRequestFn=function(m){var g=t.session_recording.maskNetworkRequestFn({url:m.name});return $e($e({},m),{},{name:g?.url})}),s.maskRequestFn=Fa(t.session_recording.maskCapturedNetworkRequestFn)?function(m){var g,y,v,E=d(m);return E&&(g=(y=(v=t.session_recording).maskCapturedNetworkRequestFn)===null||y===void 0?void 0:y.call(v,E))!==null&&g!==void 0?g:void 0}:function(m){return(function(g){if(!st(g))return g.requestBody=YG(g.requestBody,"Request"),g.responseBody=YG(g.responseBody,"Response"),g})(d(m))},$e($e($e({},jw),s),{},{recordHeaders:o,recordBody:a,recordPerformance:c,recordInitialRequests:c})},yqe=un((function t(e){var n,r,i=this,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};ln(this,t),be(this,"bucketSize",100),be(this,"refillRate",10),be(this,"mutationBuckets",{}),be(this,"loggedTracker",{}),be(this,"refillBuckets",(function(){Object.keys(i.mutationBuckets).forEach((function(o){i.mutationBuckets[o]=i.mutationBuckets[o]+i.refillRate,i.mutationBuckets[o]>=i.bucketSize&&delete i.mutationBuckets[o]}))})),be(this,"getNodeOrRelevantParent",(function(o){var a=i.rrweb.mirror.getNode(o);if(a?.nodeName!=="svg"&&a instanceof Element){var c=a.closest("svg");if(c)return[i.rrweb.mirror.getId(c),c]}return[o,a]})),be(this,"numberOfChanges",(function(o){var a,c,l,d,h,m,g,y;return((a=(c=o.removes)===null||c===void 0?void 0:c.length)!==null&&a!==void 0?a:0)+((l=(d=o.attributes)===null||d===void 0?void 0:d.length)!==null&&l!==void 0?l:0)+((h=(m=o.texts)===null||m===void 0?void 0:m.length)!==null&&h!==void 0?h:0)+((g=(y=o.adds)===null||y===void 0?void 0:y.length)!==null&&g!==void 0?g:0)})),be(this,"throttleMutations",(function(o){if(o.type!==3||o.data.source!==0)return o;var a=o.data,c=i.numberOfChanges(a);a.attributes&&(a.attributes=a.attributes.filter((function(d){var h,m,g,y=Ms(i.getNodeOrRelevantParent(d.id),2),v=y[0],E=y[1];return i.mutationBuckets[v]===0?!1:(i.mutationBuckets[v]=(h=i.mutationBuckets[v])!==null&&h!==void 0?h:i.bucketSize,i.mutationBuckets[v]=Math.max(i.mutationBuckets[v]-1,0),i.mutationBuckets[v]===0&&(i.loggedTracker[v]||(i.loggedTracker[v]=!0,(m=(g=i.options).onBlockedNode)===null||m===void 0||m.call(g,v,E))),d)})));var l=i.numberOfChanges(a);return l!==0||c===l?o:void 0})),this.rrweb=e,this.options=s,this.refillRate=(n=this.options.refillRate)!==null&&n!==void 0?n:this.refillRate,this.bucketSize=(r=this.options.bucketSize)!==null&&r!==void 0?r:this.bucketSize,setInterval((function(){i.refillBuckets()}),1e3)})),bqe=3e5,_qe=[gu.MouseMove,gu.MouseInteraction,gu.Scroll,gu.ViewportResize,gu.Input,gu.TouchMove,gu.MediaInteraction,gu.Drag],XG=function(t){return{rrwebMethod:t,enqueuedAt:Date.now(),attempt:1}},wa="[SessionRecording]",Sqe=(function(){function t(e){var n=this;if(ln(this,t),be(this,"queuedRRWebEvents",[]),be(this,"isIdle",!1),be(this,"_linkedFlagSeen",!1),be(this,"_lastActivityTimestamp",Date.now()),be(this,"_linkedFlag",null),be(this,"_forceAllowLocalhostNetworkCapture",!1),be(this,"_onBeforeUnload",(function(){n._flushBuffer()})),be(this,"_onOffline",(function(){n._tryAddCustomEvent("browser offline",{})})),be(this,"_onOnline",(function(){n._tryAddCustomEvent("browser online",{})})),be(this,"_onVisibilityChange",(function(){if(Ge!=null&&Ge.visibilityState){var o="window "+Ge.visibilityState;n._tryAddCustomEvent(o,{})}})),be(this,"_samplingSessionListener",null),this.instance=e,this._captureStarted=!1,this._endpoint="/s/",this.stopRrweb=void 0,this.receivedDecide=!1,!this.instance.sessionManager)throw Te.error(wa+" started without valid sessionManager"),new Error(wa+" started without valid sessionManager. This is a bug.");var r=this.sessionManager.checkAndGetSessionAndWindowId(),i=r.sessionId,s=r.windowId;this.sessionId=i,this.windowId=s,this.buffer=this.clearBuffer(),this._setupSampling()}return un(t,[{key:"rrwebRecord",get:function(){var e;return ar==null||(e=ar.rrweb)===null||e===void 0?void 0:e.record}},{key:"started",get:function(){return this._captureStarted}},{key:"sessionManager",get:function(){if(!this.instance.sessionManager)throw new Error(wa+" must be started with a valid sessionManager.");return this.instance.sessionManager}},{key:"fullSnapshotIntervalMillis",get:function(){var e;return((e=this.instance.config.session_recording)===null||e===void 0?void 0:e.full_snapshot_interval_millis)||bqe}},{key:"isSampled",get:function(){var e=this.instance.get_property(cb);return fp(e)?e:null}},{key:"sessionDuration",get:function(){var e,n,r=(e=this.buffer)===null||e===void 0?void 0:e.data[((n=this.buffer)===null||n===void 0?void 0:n.data.length)-1],i=this.sessionManager.checkAndGetSessionAndWindowId(!0).sessionStartTimestamp;return r?r.timestamp-i:null}},{key:"isRecordingEnabled",get:function(){var e=!!this.instance.get_property(PM),n=!this.instance.config.disable_session_recording;return ce&&e&&n}},{key:"isConsoleLogCaptureEnabled",get:function(){var e=!!this.instance.get_property(AG),n=this.instance.config.enable_recording_console_log;return n??e}},{key:"canvasRecording",get:function(){var e=this.instance.get_property(MG);return e&&e.fps&&e.quality?{enabled:e.enabled,fps:e.fps,quality:e.quality}:void 0}},{key:"networkPayloadCapture",get:function(){var e,n,r=this.instance.get_property(LG),i={recordHeaders:(e=this.instance.config.session_recording)===null||e===void 0?void 0:e.recordHeaders,recordBody:(n=this.instance.config.session_recording)===null||n===void 0?void 0:n.recordBody},s=i?.recordHeaders||r?.recordHeaders,o=i?.recordBody||r?.recordBody,a=Zi(this.instance.config.capture_performance)?this.instance.config.capture_performance.network_timing:this.instance.config.capture_performance,c=!!(fp(a)?a:r?.capturePerformance);return s||o||c?{recordHeaders:s,recordBody:o,recordPerformance:c}:void 0}},{key:"sampleRate",get:function(){var e=this.instance.get_property(OG);return La(e)?e:null}},{key:"minimumDuration",get:function(){var e=this.instance.get_property(PG);return La(e)?e:null}},{key:"status",get:function(){return this.receivedDecide?this.isRecordingEnabled?go(this._linkedFlag)||this._linkedFlagSeen?fp(this.isSampled)?this.isSampled?"sampled":"disabled":"active":"buffering":"disabled":"buffering"}},{key:"startIfEnabledOrStop",value:function(){this.isRecordingEnabled?(this._startCapture(),ce?.addEventListener("beforeunload",this._onBeforeUnload),ce?.addEventListener("offline",this._onOffline),ce?.addEventListener("online",this._onOnline),ce?.addEventListener("visibilitychange",this._onVisibilityChange),Te.info(wa+" started")):(this.stopRecording(),this.clearBuffer(),clearInterval(this._fullSnapshotTimer))}},{key:"stopRecording",value:function(){this._captureStarted&&this.stopRrweb&&(this.stopRrweb(),this.stopRrweb=void 0,this._captureStarted=!1,ce?.removeEventListener("beforeunload",this._onBeforeUnload),ce?.removeEventListener("offline",this._onOffline),ce?.removeEventListener("online",this._onOnline),ce?.removeEventListener("visibilitychange",this._onVisibilityChange),Te.info(wa+" stopped"))}},{key:"makeSamplingDecision",value:function(e){var n,r=this.sessionId!==e,i=this.sampleRate;if(La(i)){var s,o=this.isSampled,a=r||!fp(o);a?s=Math.random()<i:s=o,!s&&a&&Te.warn(wa+" Sample rate (".concat(i,") has determined that this sessionId (").concat(e,") will not be sent to the server.")),this._tryAddCustomEvent("samplingDecisionMade",{sampleRate:i}),(n=this.instance.persistence)===null||n===void 0||n.register(be({},cb,s))}else{var c;(c=this.instance.persistence)===null||c===void 0||c.register(be({},cb,null))}}},{key:"afterDecideResponse",value:function(e){var n,r,i,s=this;if(this._persistDecideResponse(e),this._linkedFlag=((n=e.sessionRecording)===null||n===void 0?void 0:n.linkedFlag)||null,(r=e.sessionRecording)!==null&&r!==void 0&&r.endpoint&&(this._endpoint=(i=e.sessionRecording)===null||i===void 0?void 0:i.endpoint),this._setupSampling(),!go(this._linkedFlag)&&!this._linkedFlagSeen){var o=hs(this._linkedFlag)?this._linkedFlag:this._linkedFlag.flag,a=hs(this._linkedFlag)?null:this._linkedFlag.variant;this.instance.onFeatureFlags((function(c,l){var d=Zi(l)&&o in l,h=a?l[o]===a:d;if(h){var m={linkedFlag:o,linkedVariant:a},g="linked flag matched";Te.info(wa+" "+g,m),s._tryAddCustomEvent(g,m)}s._linkedFlagSeen=h}))}this.receivedDecide=!0,this.startIfEnabledOrStop()}},{key:"_setupSampling",value:function(){var e=this;La(this.sampleRate)&&bd(this._samplingSessionListener)&&(this._samplingSessionListener=this.sessionManager.onSessionId((function(n){e.makeSamplingDecision(n)})))}},{key:"_persistDecideResponse",value:function(e){if(this.instance.persistence){var n=this.instance.persistence,r=function(){var i,s,o,a,c,l,d,h,m=(i=e.sessionRecording)===null||i===void 0?void 0:i.sampleRate,g=go(m)?null:parseFloat(m),y=(s=e.sessionRecording)===null||s===void 0?void 0:s.minimumDurationMilliseconds;n.register((be(h={},PM,!!e.sessionRecording),be(h,AG,(o=e.sessionRecording)===null||o===void 0?void 0:o.consoleLogRecordingEnabled),be(h,LG,$e({capturePerformance:e.capturePerformance},(a=e.sessionRecording)===null||a===void 0?void 0:a.networkPayloadCapture)),be(h,MG,{enabled:(c=e.sessionRecording)===null||c===void 0?void 0:c.recordCanvas,fps:(l=e.sessionRecording)===null||l===void 0?void 0:l.canvasFps,quality:(d=e.sessionRecording)===null||d===void 0?void 0:d.canvasQuality}),be(h,OG,g),be(h,PG,st(y)?null:y),h))};r(),this.sessionManager.onSessionId(r)}}},{key:"log",value:function(e){var n,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"log";(n=this.instance.sessionRecording)===null||n===void 0||n.onRRwebEmit({type:6,data:{plugin:"rrweb/console@1",payload:{level:r,trace:[],payload:[JSON.stringify(e)]}},timestamp:xce()})}},{key:"_startCapture",value:function(){var e=this;st(Object.assign)||this._captureStarted||this.instance.config.disable_session_recording||this.instance.consent.isOptedOut()||(this._captureStarted=!0,this.sessionManager.checkAndGetSessionAndWindowId(),this.rrwebRecord?this._onScriptLoaded():this.instance.requestRouter.loadScript("/static/recorder.js?v=".concat(Aa.LIB_VERSION),(function(n){if(n)return Te.error(wa+" could not load recorder.js",n);e._onScriptLoaded()})))}},{key:"isInteractiveEvent",value:function(e){var n;return e.type===3&&_qe.indexOf((n=e.data)===null||n===void 0?void 0:n.source)!==-1}},{key:"_updateWindowAndSessionIds",value:function(e){var n=this.isInteractiveEvent(e);n||this.isIdle||e.timestamp-this._lastActivityTimestamp>3e5&&(this.isIdle=!0,clearInterval(this._fullSnapshotTimer),this._flushBuffer());var r=!1;if(n&&(this._lastActivityTimestamp=e.timestamp,this.isIdle&&(this.isIdle=!1,this._tryAddCustomEvent("sessionNoLongerIdle",{reason:"user activity",type:e.type}),r=!0)),!this.isIdle){var i=this.sessionManager.checkAndGetSessionAndWindowId(!n,e.timestamp),s=i.windowId,o=i.sessionId,a=this.sessionId!==o,c=this.windowId!==s;this.windowId=s,this.sessionId=o,(r||[sqe,oqe].indexOf(e.type)===-1&&(c||a||st(this._fullSnapshotTimer)))&&this._tryTakeFullSnapshot()}}},{key:"_tryRRWebMethod",value:function(e){try{return e.rrwebMethod(),!0}catch(n){return this.queuedRRWebEvents.length<10?this.queuedRRWebEvents.push({enqueuedAt:e.enqueuedAt||Date.now(),attempt:e.attempt++,rrwebMethod:e.rrwebMethod}):Te.warn(wa+" could not emit queued rrweb event.",n,e),!1}}},{key:"_tryAddCustomEvent",value:function(e,n){var r=this;return this._tryRRWebMethod(XG((function(){return r.rrwebRecord.addCustomEvent(e,n)})))}},{key:"_tryTakeFullSnapshot",value:function(){var e=this;return this._tryRRWebMethod(XG((function(){return e.rrwebRecord.takeFullSnapshot()})))}},{key:"_onScriptLoaded",value:function(){for(var e,n=this,r={blockClass:"ph-no-capture",blockSelector:void 0,ignoreClass:"ph-ignore-input",maskTextClass:"ph-mask",maskTextSelector:void 0,maskTextFn:void 0,maskAllInputs:!0,maskInputOptions:{password:!0},maskInputFn:void 0,slimDOMOptions:{},collectFonts:!1,inlineStylesheet:!0,recordCrossOriginIframes:!1},i=this.instance.config.session_recording,s=0,o=Object.entries(i||{});s<o.length;s++){var a=Ms(o[s],2),c=a[0],l=a[1];c in r&&(c==="maskInputOptions"?r.maskInputOptions=$e({password:!0},l):r[c]=l)}if(this.canvasRecording&&this.canvasRecording.enabled&&(r.recordCanvas=!0,r.sampling={canvas:this.canvasRecording.fps},r.dataURLOptions={type:"image/webp",quality:this.canvasRecording.quality}),this.rrwebRecord){this.mutationRateLimiter=(e=this.mutationRateLimiter)!==null&&e!==void 0?e:new yqe(this.rrwebRecord,{onBlockedNode:function(h,m){var g="Too many mutations on node '".concat(h,"'. Rate limiting. This could be due to SVG animations or something similar");Te.info(g,{node:m}),n.log(wa+" "+g,"warn")}});var d=this._gatherRRWebPlugins();this.stopRrweb=this.rrwebRecord($e({emit:function(h){n.onRRwebEmit(h)},plugins:d},r)),this.instance._addCaptureHook((function(h){try{if(h==="$pageview"){var m=ce?n._maskUrl(ce.location.href):"";if(!m)return;n._tryAddCustomEvent("$pageview",{href:m})}}catch(g){Te.error("Could not add $pageview to rrweb session",g)}})),this._lastActivityTimestamp=Date.now(),this.isIdle=!1,this._tryAddCustomEvent("$session_options",{sessionRecordingOptions:r,activePlugins:d.map((function(h){return h?.name}))}),this._tryAddCustomEvent("$posthog_config",{config:this.instance.config})}else Te.error(wa+"onScriptLoaded was called but rrwebRecord is not available. This indicates something has gone wrong.")}},{key:"_scheduleFullSnapshot",value:function(){var e=this;if(this._fullSnapshotTimer&&clearInterval(this._fullSnapshotTimer),!this.isIdle){var n=this.fullSnapshotIntervalMillis;n&&(this._fullSnapshotTimer=setInterval((function(){e._tryTakeFullSnapshot()}),n))}}},{key:"_gatherRRWebPlugins",value:function(){var e=[];return ar.rrwebConsoleRecord&&this.isConsoleLogCaptureEnabled&&e.push(ar.rrwebConsoleRecord.getRecordConsolePlugin()),this.networkPayloadCapture&&Fa(ar.getRecordNetworkPlugin)&&(!GHe.includes(location.hostname)||this._forceAllowLocalhostNetworkCapture?e.push(ar.getRecordNetworkPlugin(vqe(this.instance.config,this.networkPayloadCapture))):Te.info(wa+" NetworkCapture not started because we are on localhost.")),e}},{key:"onRRwebEmit",value:function(e){if(this._processQueuedEvents(),e&&Zi(e)){if(e.type===rC.Meta){var n=this._maskUrl(e.data.href);if(this._lastHref=n,!n)return;e.data.href=n}else this._pageViewFallBack();e.type===rC.FullSnapshot&&this._scheduleFullSnapshot();var r=this.mutationRateLimiter?this.mutationRateLimiter.throttleMutations(e):e;if(r){var i=(function(a){var c=a;if(c&&Zi(c)&&c.type===6&&Zi(c.data)&&c.data.plugin==="rrweb/console@1"){c.data.payload.payload.length>10&&(c.data.payload.payload=c.data.payload.payload.slice(0,10),c.data.payload.payload.push("...[truncated]"));for(var l=[],d=0;d<c.data.payload.payload.length;d++)c.data.payload.payload[d]&&c.data.payload.payload[d].length>2e3?l.push(c.data.payload.payload[d].slice(0,2e3)+"...[truncated]"):l.push(c.data.payload.payload[d]);return c.data.payload.payload=l,a}return a})(r),s=KM(i);if(this._updateWindowAndSessionIds(i),!this.isIdle||i.type===rC.Custom){var o={$snapshot_bytes:s,$snapshot_data:i,$session_id:this.sessionId,$window_id:this.windowId};this.status!=="disabled"?this._captureSnapshotBuffered(o):this.clearBuffer()}}}}},{key:"_pageViewFallBack",value:function(){if(!this.instance.config.capture_pageview&&ce){var e=this._maskUrl(ce.location.href);this._lastHref!==e&&(this._tryAddCustomEvent("$url_changed",{href:e}),this._lastHref=e)}}},{key:"_processQueuedEvents",value:function(){var e=this;if(this.queuedRRWebEvents.length){var n=Wu(this.queuedRRWebEvents);this.queuedRRWebEvents=[],n.forEach((function(r){Date.now()-r.enqueuedAt<=2e3&&e._tryRRWebMethod(r)}))}}},{key:"_maskUrl",value:function(e){var n=this.instance.config.session_recording;if(n.maskNetworkRequestFn){var r,i={url:e};return(r=i=n.maskNetworkRequestFn(i))===null||r===void 0?void 0:r.url}return e}},{key:"clearBuffer",value:function(){return this.buffer={size:0,data:[],sessionId:this.sessionId,windowId:this.windowId},this.buffer}},{key:"_flushBuffer",value:function(){var e=this;this.flushBufferTimer&&(clearTimeout(this.flushBufferTimer),this.flushBufferTimer=void 0);var n=this.minimumDuration,r=this.sessionDuration,i=La(r)&&r>=0,s=La(n)&&i&&r<n;return this.status==="buffering"||s?(this.flushBufferTimer=setTimeout((function(){e._flushBuffer()}),2e3),this.buffer):(this.buffer.data.length>0&&GM(this.buffer).forEach((function(o){e._captureSnapshot({$snapshot_bytes:o.size,$snapshot_data:o.data,$session_id:o.sessionId,$window_id:o.windowId})})),this.clearBuffer())}},{key:"_captureSnapshotBuffered",value:function(e){var n,r=this,i=2+(((n=this.buffer)===null||n===void 0?void 0:n.data.length)||0);!this.isIdle&&(this.buffer.size+e.$snapshot_bytes+i>943718.4||this.buffer.sessionId!==this.sessionId)&&(this.buffer=this._flushBuffer()),this.buffer.size+=e.$snapshot_bytes,this.buffer.data.push(e.$snapshot_data),this.flushBufferTimer||this.isIdle||(this.flushBufferTimer=setTimeout((function(){r._flushBuffer()}),2e3))}},{key:"_captureSnapshot",value:function(e){this.instance.capture("$snapshot",e,{_url:this.instance.requestRouter.endpointFor("api",this._endpoint),_noTruncate:!0,_batchKey:"recordings",skip_client_rate_limiting:!0})}},{key:"overrideLinkedFlag",value:function(){this._linkedFlagSeen=!0}}]),t})(),wqe=(function(){function t(e){ln(this,t),this.instance=e,this.instance.decideEndpointWasHit=this.instance._hasBootstrappedFeatureFlags()}return un(t,[{key:"call",value:function(){var e=this,n={token:this.instance.config.token,distinct_id:this.instance.get_distinct_id(),groups:this.instance.getGroups(),person_properties:this.instance.get_property(Vg),group_properties:this.instance.get_property(hf),disable_flags:this.instance.config.advanced_disable_feature_flags||this.instance.config.advanced_disable_feature_flags_on_first_load||void 0};this.instance._send_request({method:"POST",url:this.instance.requestRouter.endpointFor("api","/decide/?v=3"),data:n,compression:this.instance.config.disable_compression?void 0:Ic.Base64,timeout:this.instance.config.feature_flag_request_timeout_ms,callback:function(r){return e.parseDecideResponse(r.json)}})}},{key:"parseDecideResponse",value:function(e){var n=this;this.instance.featureFlags.setReloadingPaused(!1),this.instance.featureFlags._startReloadTimer();var r=!e;if(this.instance.config.advanced_disable_feature_flags_on_first_load||this.instance.config.advanced_disable_feature_flags||this.instance.featureFlags.receivedFeatureFlags(e??{},r),r)Te.error("Failed to fetch feature flags from PostHog.");else{if(!Ge||!Ge.body)return Te.info("document not ready yet, trying again in 500 milliseconds..."),void setTimeout((function(){n.parseDecideResponse(e)}),500);if(this.instance._afterDecideResponse(e),e.siteApps)if(this.instance.config.opt_in_site_apps){var i,s=Xa(e.siteApps);try{var o=function(){var a=i.value,c=a.id,l=a.url,d=n.instance.requestRouter.endpointFor("api",l);ar["__$$ph_site_app_".concat(c)]=n.instance,n.instance.requestRouter.loadScript(d,(function(h){if(h)return Te.error("Error while initializing PostHog app with config id ".concat(c),h)}))};for(s.s();!(i=s.n()).done;)o()}catch(a){s.e(a)}finally{s.f()}}else e.siteApps.length>0&&Te.error('PostHog site apps are disabled. Enable the "opt_in_site_apps" config to proceed.')}}}]),t})(),Eqe=ce!=null&&ce.location?P3(ce.location.hash,"__posthog")||P3(location.hash,"state"):null,JG="_postHogToolbarParams";(function(t){t[t.UNINITIALIZED=0]="UNINITIALIZED",t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED"})(Eu||(Eu={}));var Cqe=(function(){function t(e){ln(this,t),this.instance=e}return un(t,[{key:"setToolbarState",value:function(e){ar.ph_toolbar_state=e}},{key:"getToolbarState",value:function(){var e;return(e=ar.ph_toolbar_state)!==null&&e!==void 0?e:Eu.UNINITIALIZED}},{key:"maybeLoadToolbar",value:function(){var e,n,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:void 0,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:void 0,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;if(!ce||!Ge)return!1;r=(e=r)!==null&&e!==void 0?e:ce.location,s=(n=s)!==null&&n!==void 0?n:ce.history;try{if(!i){try{ce.localStorage.setItem("test","test"),ce.localStorage.removeItem("test")}catch{return!1}i=ce?.localStorage}var o,a=Eqe||P3(r.hash,"__posthog")||P3(r.hash,"state"),c=a?TG((function(){return JSON.parse(atob(decodeURIComponent(a)))}))||TG((function(){return JSON.parse(decodeURIComponent(a))})):null;return c&&c.action==="ph_authorize"?((o=c).source="url",o&&Object.keys(o).length>0&&(c.desiredHash?r.hash=c.desiredHash:s?s.replaceState(s.state,"",r.pathname+r.search):r.hash="")):((o=JSON.parse(i.getItem(JG)||"{}")).source="localstorage",delete o.userIntent),!(!o.token||this.instance.config.token!==o.token)&&(this.loadToolbar(o),!0)}catch{return!1}}},{key:"_callLoadToolbar",value:function(e){(ar.ph_load_toolbar||ar.ph_load_editor)(e,this.instance)}},{key:"loadToolbar",value:function(e){var n=this,r=!(Ge==null||!Ge.getElementById(BM));if(!ce||r)return!1;var i=this.instance.requestRouter.region==="custom"&&this.instance.config.advanced_disable_toolbar_metrics,s=$e($e({token:this.instance.config.token},e),{},{apiURL:this.instance.requestRouter.endpointFor("ui")},i?{instrument:!1}:{});if(ce.localStorage.setItem(JG,JSON.stringify($e($e({},s),{},{source:void 0}))),this.getToolbarState()===Eu.LOADED)this._callLoadToolbar(s);else if(this.getToolbarState()===Eu.UNINITIALIZED){this.setToolbarState(Eu.LOADING);var o=3e5,a=Math.floor(Date.now()/o)*o;this.instance.requestRouter.loadScript("/static/toolbar.js?t=".concat(a),(function(c){if(c)return Te.error("Failed to load toolbar",c),void n.setToolbarState(Eu.UNINITIALIZED);n.setToolbarState(Eu.LOADED),n._callLoadToolbar(s)})),Nu(ce,"turbolinks:load",(function(){n.setToolbarState(Eu.UNINITIALIZED),n.loadToolbar(s)}))}return!0}},{key:"_loadEditor",value:function(e){return this.loadToolbar(e)}},{key:"maybeLoadEditor",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:void 0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:void 0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;return this.maybeLoadToolbar(e,n,r)}}]),t})(),Tqe=(function(){function t(e){ln(this,t),be(this,"isPaused",!0),be(this,"queue",[]),be(this,"flushTimeoutMs",3e3),this.sendRequest=e}return un(t,[{key:"enqueue",value:function(e){this.queue.push(e),this.flushTimeout||this.setFlushTimeout()}},{key:"unload",value:function(){var e=this;this.clearFlushTimeout();var n=this.queue.length>0?this.formatQueue():{},r=Object.values(n);[].concat(Wu(r.filter((function(i){return i.url.indexOf("/e")===0}))),Wu(r.filter((function(i){return i.url.indexOf("/e")!==0})))).map((function(i){e.sendRequest($e($e({},i),{},{transport:"sendBeacon"}))}))}},{key:"enable",value:function(){this.isPaused=!1,this.setFlushTimeout()}},{key:"setFlushTimeout",value:function(){var e=this;this.isPaused||(this.flushTimeout=setTimeout((function(){if(e.clearFlushTimeout(),e.queue.length>0){var n=e.formatQueue(),r=function(s){var o=n[s],a=new Date().getTime();o.data&&yi(o.data)&&Nn(o.data,(function(c){c.offset=Math.abs(c.timestamp-a),delete c.timestamp})),e.sendRequest(o)};for(var i in n)r(i)}}),this.flushTimeoutMs))}},{key:"clearFlushTimeout",value:function(){clearTimeout(this.flushTimeout),this.flushTimeout=void 0}},{key:"formatQueue",value:function(){var e={};return Nn(this.queue,(function(n){var r,i=n,s=(i?i.batchKey:null)||i.url;st(e[s])&&(e[s]=$e($e({},i),{},{data:[]})),(r=e[s].data)===null||r===void 0||r.push(i.data)})),this.queue=[],e}}]),t})(),za=Uint8Array,uo=Uint16Array,Kv=Uint32Array,l9=new za([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),u9=new za([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),QG=new za([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),nle=function(t,e){for(var n=new uo(31),r=0;r<31;++r)n[r]=e+=1<<t[r-1];var i=new Kv(n[30]);for(r=1;r<30;++r)for(var s=n[r];s<n[r+1];++s)i[s]=s-n[r]<<5|r;return[n,i]},rle=nle(l9,2),Rqe=rle[0],JM=rle[1];Rqe[28]=258,JM[258]=28;for(var ZG=nle(u9,0)[1],ile=new uo(32768),Zn=0;Zn<32768;++Zn){var Wh=(43690&Zn)>>>1|(21845&Zn)<<1;Wh=(61680&(Wh=(52428&Wh)>>>2|(13107&Wh)<<2))>>>4|(3855&Wh)<<4,ile[Zn]=((65280&Wh)>>>8|(255&Wh)<<8)>>>1}var ub=function(t,e,n){for(var r=t.length,i=0,s=new uo(e);i<r;++i)++s[t[i]-1];var o,a=new uo(e);for(i=0;i<e;++i)a[i]=a[i-1]+s[i-1]<<1;for(o=new uo(r),i=0;i<r;++i)o[i]=ile[a[t[i]-1]++]>>>15-t[i];return o},qp=new za(288);for(Zn=0;Zn<144;++Zn)qp[Zn]=8;for(Zn=144;Zn<256;++Zn)qp[Zn]=9;for(Zn=256;Zn<280;++Zn)qp[Zn]=7;for(Zn=280;Zn<288;++Zn)qp[Zn]=8;var j3=new za(32);for(Zn=0;Zn<32;++Zn)j3[Zn]=5;var kqe=ub(qp,9),Iqe=ub(j3,5),sle=function(t){return(t/8>>0)+(7&t&&1)},ole=function(t,e,n){(n==null||n>t.length)&&(n=t.length);var r=new(t instanceof uo?uo:t instanceof Kv?Kv:za)(n-e);return r.set(t.subarray(e,n)),r},du=function(t,e,n){n<<=7&e;var r=e/8>>0;t[r]|=n,t[r+1]|=n>>>8},l1=function(t,e,n){n<<=7&e;var r=e/8>>0;t[r]|=n,t[r+1]|=n>>>8,t[r+2]|=n>>>16},G6=function(t,e){for(var n=[],r=0;r<t.length;++r)t[r]&&n.push({s:r,f:t[r]});var i=n.length,s=n.slice();if(!i)return[new za(0),0];if(i==1){var o=new za(n[0].s+1);return o[n[0].s]=1,[o,1]}n.sort((function(k,T){return k.f-T.f})),n.push({s:-1,f:25001});var a=n[0],c=n[1],l=0,d=1,h=2;for(n[0]={s:-1,f:a.f+c.f,l:a,r:c};d!=i-1;)a=n[n[l].f<n[h].f?l++:h++],c=n[l!=d&&n[l].f<n[h].f?l++:h++],n[d++]={s:-1,f:a.f+c.f,l:a,r:c};var m=s[0].s;for(r=1;r<i;++r)s[r].s>m&&(m=s[r].s);var g=new uo(m+1),y=xqe(n[d-1],g,0);if(y>e){r=0;var v=0,E=y-e,w=1<<E;for(s.sort((function(k,T){return g[T.s]-g[k.s]||k.f-T.f}));r<i;++r){var R=s[r].s;if(!(g[R]>e))break;v+=w-(1<<y-g[R]),g[R]=e}for(v>>>=E;v>0;){var x=s[r].s;g[x]<e?v-=1<<e-g[x]++-1:++r}for(;r>=0&&v;--r){var C=s[r].s;g[C]==e&&(--g[C],++v)}y=e}return[new za(g),y]},xqe=function t(e,n,r){return e.s==-1?Math.max(t(e.l,n,r+1),t(e.r,n,r+1)):n[e.s]=r},ez=function(t){for(var e=t.length;e&&!t[--e];);for(var n=new uo(++e),r=0,i=t[0],s=1,o=function(c){n[r++]=c},a=1;a<=e;++a)if(t[a]==i&&a!=e)++s;else{if(!i&&s>2){for(;s>138;s-=138)o(32754);s>2&&(o(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(o(i),--s;s>6;s-=6)o(8304);s>2&&(o(s-3<<5|8208),s=0)}for(;s--;)o(i);s=1,i=t[a]}return[n.subarray(0,r),e]},u1=function(t,e){for(var n=0,r=0;r<e.length;++r)n+=t[r]*e[r];return n},QM=function(t,e,n){var r=n.length,i=sle(e+2);t[i]=255&r,t[i+1]=r>>>8,t[i+2]=255^t[i],t[i+3]=255^t[i+1];for(var s=0;s<r;++s)t[i+s+4]=n[s];return 8*(i+4+r)},tz=function(t,e,n,r,i,s,o,a,c,l,d){du(e,d++,n),++i[256];for(var h=G6(i,15),m=h[0],g=h[1],y=G6(s,15),v=y[0],E=y[1],w=ez(m),R=w[0],x=w[1],C=ez(v),k=C[0],T=C[1],L=new uo(19),O=0;O<R.length;++O)L[31&R[O]]++;for(O=0;O<k.length;++O)L[31&k[O]]++;for(var P=G6(L,7),D=P[0],j=P[1],H=19;H>4&&!D[QG[H-1]];--H);var z,Y,W,F,$=l+5<<3,V=u1(i,qp)+u1(s,j3)+o,G=u1(i,m)+u1(s,v)+o+14+3*H+u1(L,D)+(2*L[16]+3*L[17]+7*L[18]);if($<=V&&$<=G)return QM(e,d,t.subarray(c,c+l));if(du(e,d,1+(G<V)),d+=2,G<V){z=ub(m,g),Y=m,W=ub(v,E),F=v;var Z=ub(D,j);for(du(e,d,x-257),du(e,d+5,T-1),du(e,d+10,H-4),d+=14,O=0;O<H;++O)du(e,d+3*O,D[QG[O]]);d+=3*H;for(var q=[R,k],J=0;J<2;++J){var ue=q[J];for(O=0;O<ue.length;++O){var ge=31&ue[O];du(e,d,Z[ge]),d+=D[ge],ge>15&&(du(e,d,ue[O]>>>5&127),d+=ue[O]>>>12)}}}else z=kqe,Y=qp,W=Iqe,F=j3;for(O=0;O<a;++O)if(r[O]>255){ge=r[O]>>>18&31,l1(e,d,z[ge+257]),d+=Y[ge+257],ge>7&&(du(e,d,r[O]>>>23&31),d+=l9[ge]);var Re=31&r[O];l1(e,d,W[Re]),d+=F[Re],Re>3&&(l1(e,d,r[O]>>>5&8191),d+=u9[Re])}else l1(e,d,z[r[O]]),d+=Y[r[O]];return l1(e,d,z[256]),d+Y[256]},Aqe=new Kv([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Lqe=(function(){for(var t=new Kv(256),e=0;e<256;++e){for(var n=e,r=9;--r;)n=(1&n&&3988292384)^n>>>1;t[e]=n}return t})(),Mqe=function(t,e,n,r,i){return(function(s,o,a,c,l,d){var h=s.length,m=new za(c+h+5*(1+Math.floor(h/7e3))+l),g=m.subarray(c,m.length-l),y=0;if(!o||h<8)for(var v=0;v<=h;v+=65535){var E=v+65535;E<h?y=QM(g,y,s.subarray(v,E)):(g[v]=d,y=QM(g,y,s.subarray(v,h)))}else{for(var w=Aqe[o-1],R=w>>>13,x=8191&w,C=(1<<a)-1,k=new uo(32768),T=new uo(C+1),L=Math.ceil(a/3),O=2*L,P=function(wi){return(s[wi]^s[wi+1]<<L^s[wi+2]<<O)&C},D=new Kv(25e3),j=new uo(288),H=new uo(32),z=0,Y=0,W=(v=0,0),F=0,$=0;v<h;++v){var V=P(v),G=32767&v,Z=T[V];if(k[G]=Z,T[V]=G,F<=v){var q=h-v;if((z>7e3||W>24576)&&q>423){y=tz(s,g,0,D,j,H,Y,W,$,v-$,y),W=z=Y=0,$=v;for(var J=0;J<286;++J)j[J]=0;for(J=0;J<30;++J)H[J]=0}var ue=2,ge=0,Re=x,we=G-Z&32767;if(q>2&&V==P(v-we))for(var de=Math.min(R,q)-1,ke=Math.min(32767,v),De=Math.min(258,q);we<=ke&&--Re&&G!=Z;){if(s[v+ue]==s[v+ue-we]){for(var Je=0;Je<De&&s[v+Je]==s[v+Je-we];++Je);if(Je>ue){if(ue=Je,ge=we,Je>de)break;var vt=Math.min(we,Je-2),Sr=0;for(J=0;J<vt;++J){var zn=v-we+J+32768&32767,ze=zn-k[zn]+32768&32767;ze>Sr&&(Sr=ze,Z=zn)}}}we+=(G=Z)-(Z=k[G])+32768&32767}if(ge){D[W++]=268435456|JM[ue]<<18|ZG[ge];var ys=31&JM[ue],bs=31&ZG[ge];Y+=l9[ys]+u9[bs],++j[257+ys],++H[bs],F=v+ue,++z}else D[W++]=s[v],++j[s[v]]}}y=tz(s,g,d,D,j,H,Y,W,$,v-$,y)}return ole(m,0,c+sle(y)+l)})(t,e.level==null?6:e.level,e.mem==null?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(t.length)))):12+e.mem,n,r,!0)},z6=function(t,e,n){for(;n;++e)t[e]=n,n>>>=8};function Oqe(t,e){e===void 0&&(e={});var n=(function(){var a=4294967295;return{p:function(c){for(var l=a,d=0;d<c.length;++d)l=Lqe[255&l^c[d]]^l>>>8;a=l},d:function(){return 4294967295^a}}})(),r=t.length;n.p(t);var i,s=Mqe(t,e,10+((i=e).filename&&i.filename.length+1||0),8),o=s.length;return(function(a,c){var l=c.filename;if(a[0]=31,a[1]=139,a[2]=8,a[8]=c.level<2?4:c.level==9?2:0,a[9]=3,c.mtime!=0&&z6(a,4,Math.floor(new Date(c.mtime||Date.now())/1e3)),l){a[3]=8;for(var d=0;d<=l.length;++d)a[d+10]=l.charCodeAt(d)}})(s,e),z6(s,o-8,n.d()),z6(s,o-4,r),s}var Pqe=!!AM||!!xM,nz="text/plain",F3=function(t,e){var n=Ms(t.split("?"),2),r=n[0],i=n[1],s=$e({},e);i?.split("&").forEach((function(a){var c=Ms(a.split("="),1)[0];delete s[c]}));var o=zHe(s);return o=o?(i?i+"&":"")+o:i,"".concat(r,"?").concat(o)},Dqe=function(t){return"data="+encodeURIComponent(typeof t=="string"?t:JSON.stringify(t))},W6=function(t){var e=t.data,n=t.compression;if(e){if(n===Ic.GZipJS){var r=Oqe((function(s,o){var a=s.length;if(typeof TextEncoder<"u")return new TextEncoder().encode(s);for(var c=new za(s.length+(s.length>>>1)),l=0,d=function(y){c[l++]=y},h=0;h<a;++h){if(l+5>c.length){var m=new za(l+8+(a-h<<1));m.set(c),c=m}var g=s.charCodeAt(h);g<128||o?d(g):g<2048?(d(192|g>>>6),d(128|63&g)):g>55295&&g<57344?(d(240|(g=65536+(1047552&g)|1023&s.charCodeAt(++h))>>>18),d(128|g>>>12&63),d(128|g>>>6&63),d(128|63&g)):(d(224|g>>>12),d(128|g>>>6&63),d(128|63&g))}return ole(c,0,l)})(JSON.stringify(e)),{mtime:0});return{contentType:nz,body:new Blob([r],{type:nz})}}if(n===Ic.Base64){var i=(function(s){var o,a,c,l,d,h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",m=0,g=0,y="",v=[];if(!s)return s;s=PHe(s);do o=(d=s.charCodeAt(m++)<<16|s.charCodeAt(m++)<<8|s.charCodeAt(m++))>>18&63,a=d>>12&63,c=d>>6&63,l=63&d,v[g++]=h.charAt(o)+h.charAt(a)+h.charAt(c)+h.charAt(l);while(m<s.length);switch(y=v.join(""),s.length%3){case 1:y=y.slice(0,-2)+"==";break;case 2:y=y.slice(0,-1)+"="}return y})(JSON.stringify(e));return{contentType:"application/x-www-form-urlencoded",body:Dqe(i)}}return{contentType:"application/json",body:JSON.stringify(e)}}},db=[];AM&&db.push({transport:"XHR",method:function(t){var e,n=new AM;n.open(t.method||"GET",t.url,!0);var r=(e=W6(t))!==null&&e!==void 0?e:{},i=r.contentType,s=r.body;Nn(t.headers,(function(o,a){n.setRequestHeader(a,o)})),i&&n.setRequestHeader("Content-Type",i),t.timeout&&(n.timeout=t.timeout),n.withCredentials=!0,n.onreadystatechange=function(){if(n.readyState===4){var o,a={statusCode:n.status,text:n.responseText};if(n.status===200)try{a.json=JSON.parse(n.responseText)}catch{}(o=t.callback)===null||o===void 0||o.call(t,a)}},n.send(s)}}),xM&&db.push({transport:"fetch",method:function(t){var e,n,r=(e=W6(t))!==null&&e!==void 0?e:{},i=r.contentType,s=r.body,o=new Headers;Nn(t.headers,(function(d,h){o.append(h,d)})),i&&o.append("Content-Type",i);var a=t.url,c=null;if(EG){var l=new EG;c={signal:l.signal,timeout:setTimeout((function(){return l.abort()}),t.timeout)}}xM(a,{method:t?.method||"GET",headers:o,keepalive:t.method==="POST",body:s,signal:(n=c)===null||n===void 0?void 0:n.signal}).then((function(d){return d.text().then((function(h){var m,g={statusCode:d.status,text:h};if(d.status===200)try{g.json=JSON.parse(h)}catch(y){Te.error(y)}(m=t.callback)===null||m===void 0||m.call(t,g)}))})).catch((function(d){var h;Te.error(d),(h=t.callback)===null||h===void 0||h.call(t,{statusCode:0,text:d})})).finally((function(){return c?clearTimeout(c.timeout):null}))}}),Ac!=null&&Ac.sendBeacon&&db.push({transport:"sendBeacon",method:function(t){var e=F3(t.url,{beacon:"1"});try{var n,r=(n=W6(t))!==null&&n!==void 0?n:{},i=r.contentType,s=r.body,o=typeof s=="string"?new Blob([s],{type:i}):s;Ac.sendBeacon(e,o)}catch{}}});var Nqe=["retriesPerformedSoFar"],hp,Uqe=(function(){function t(e){var n=this;ln(this,t),be(this,"isPolling",!1),be(this,"pollIntervalMs",3e3),be(this,"queue",[]),this.instance=e,this.queue=[],this.areWeOnline=!0,!st(ce)&&"onLine"in ce.navigator&&(this.areWeOnline=ce.navigator.onLine,ce.addEventListener("online",(function(){n.areWeOnline=!0,n.flush()})),ce.addEventListener("offline",(function(){n.areWeOnline=!1})))}return un(t,[{key:"retriableRequest",value:function(e){var n=this,r=e.retriesPerformedSoFar,i=xHe(e,Nqe);La(r)&&r>0&&(i.url=F3(i.url,{retry_count:r})),this.instance._send_request($e($e({},i),{},{callback:function(s){var o;s.statusCode!==200&&(s.statusCode<400||s.statusCode>=500)&&(r??0)<10?n.enqueue($e({retriesPerformedSoFar:r},i)):(o=i.callback)===null||o===void 0||o.call(i,s)}}))}},{key:"enqueue",value:function(e){var n=e.retriesPerformedSoFar||0;e.retriesPerformedSoFar=n+1;var r=(function(o){var a=3e3*Math.pow(2,o),c=a/2,l=Math.min(18e5,a),d=(Math.random()-.5)*(l-c);return Math.ceil(l+d)})(n),i=Date.now()+r;this.queue.push({retryAt:i,requestOptions:e});var s="Enqueued failed request for retry in ".concat(r);navigator.onLine||(s+=" (Browser is offline)"),Te.warn(s),this.isPolling||(this.isPolling=!0,this.poll())}},{key:"poll",value:function(){var e=this;this.poller&&clearTimeout(this.poller),this.poller=setTimeout((function(){e.areWeOnline&&e.queue.length>0&&e.flush(),e.poll()}),this.pollIntervalMs)}},{key:"flush",value:function(){var e=Date.now(),n=[],r=this.queue.filter((function(a){return a.retryAt<e||(n.push(a),!1)}));if(this.queue=n,r.length>0){var i,s=Xa(r);try{for(s.s();!(i=s.n()).done;){var o=i.value.requestOptions;this.retriableRequest(o)}}catch(a){s.e(a)}finally{s.f()}}}},{key:"unload",value:function(){this.poller&&(clearTimeout(this.poller),this.poller=void 0);var e,n=Xa(this.queue);try{for(n.s();!(e=n.n()).done;){var r=e.value.requestOptions;try{this.instance._send_request($e($e({},r),{},{transport:"sendBeacon"}))}catch(i){Te.error(i)}}}catch(i){n.e(i)}finally{n.f()}this.queue=[]}}]),t})(),Fw=1800,jqe=(function(){function t(e,n,r,i){var s;ln(this,t),be(this,"_sessionIdChangedHandlers",[]),this.config=e,this.persistence=n,this._windowId=void 0,this._sessionId=void 0,this._sessionStartTimestamp=null,this._sessionActivityTimestamp=null,this._sessionIdGenerator=r||Cf,this._windowIdGenerator=i||Cf;var o=e.persistence_name||e.token,a=e.session_idle_timeout_seconds||Fw;if(La(a)?a>Fw?Te.warn("session_idle_timeout_seconds cannot be  greater than 30 minutes. Using 30 minutes instead."):a<60&&Te.warn("session_idle_timeout_seconds cannot be less than 60 seconds. Using 60 seconds instead."):(Te.warn("session_idle_timeout_seconds must be a number. Defaulting to 30 minutes."),a=Fw),this._sessionTimeoutMs=1e3*Math.min(Math.max(a,60),Fw),this._window_id_storage_key="ph_"+o+"_window_id",this._primary_window_exists_storage_key="ph_"+o+"_primary_window_exists",this._canUseSessionStorage()){var c=Qi.parse(this._window_id_storage_key),l=Qi.parse(this._primary_window_exists_storage_key);c&&!l?this._windowId=c:Qi.remove(this._window_id_storage_key),Qi.set(this._primary_window_exists_storage_key,!0)}if((s=this.config.bootstrap)!==null&&s!==void 0&&s.sessionID)try{var d=(function(h){var m=h.replace(/-/g,"");if(m.length!==32)throw new Error("Not a valid UUID");if(m[12]!=="7")throw new Error("Not a UUIDv7");return parseInt(m.substring(0,12),16)})(this.config.bootstrap.sessionID);this._setSessionId(this.config.bootstrap.sessionID,new Date().getTime(),d)}catch(h){Te.error("Invalid sessionID in bootstrap",h)}this._listenToReloadWindow()}return un(t,[{key:"onSessionId",value:function(e){var n=this;return st(this._sessionIdChangedHandlers)&&(this._sessionIdChangedHandlers=[]),this._sessionIdChangedHandlers.push(e),this._sessionId&&e(this._sessionId,this._windowId),function(){n._sessionIdChangedHandlers=n._sessionIdChangedHandlers.filter((function(r){return r!==e}))}}},{key:"_canUseSessionStorage",value:function(){return this.config.persistence!=="memory"&&!this.persistence.disabled&&Qi.is_supported()}},{key:"_setWindowId",value:function(e){e!==this._windowId&&(this._windowId=e,this._canUseSessionStorage()&&Qi.set(this._window_id_storage_key,e))}},{key:"_getWindowId",value:function(){return this._windowId?this._windowId:this._canUseSessionStorage()?Qi.parse(this._window_id_storage_key):null}},{key:"_setSessionId",value:function(e,n,r){e===this._sessionId&&n===this._sessionActivityTimestamp&&r===this._sessionStartTimestamp||(this._sessionStartTimestamp=r,this._sessionActivityTimestamp=n,this._sessionId=e,this.persistence.register(be({},A3,[n,e,r])))}},{key:"_getSessionId",value:function(){if(this._sessionId&&this._sessionActivityTimestamp&&this._sessionStartTimestamp)return[this._sessionActivityTimestamp,this._sessionId,this._sessionStartTimestamp];var e=this.persistence.props[A3];return yi(e)&&e.length===2&&e.push(e[0]),e||[0,null,0]}},{key:"resetSessionId",value:function(){this._setSessionId(null,null,null)}},{key:"_listenToReloadWindow",value:function(){var e=this;ce?.addEventListener("beforeunload",(function(){e._canUseSessionStorage()&&Qi.remove(e._primary_window_exists_storage_key)}))}},{key:"checkAndGetSessionAndWindowId",value:function(){var e=arguments.length>0&&arguments[0]!==void 0&&arguments[0],n=(arguments.length>1&&arguments[1]!==void 0?arguments[1]:null)||new Date().getTime(),r=Ms(this._getSessionId(),3),i=r[0],s=r[1],o=r[2],a=this._getWindowId(),c=o&&o>0&&Math.abs(n-o)>864e5,l=!1,d=!s,h=!e&&Math.abs(n-i)>this._sessionTimeoutMs;d||h||c?(s=this._sessionIdGenerator(),a=this._windowIdGenerator(),Te.info("[SessionId] new session ID generated",{sessionId:s,windowId:a,changeReason:{noSessionId:d,activityTimeout:h,sessionPastMaximumLength:c}}),o=n,l=!0):a||(a=this._windowIdGenerator(),l=!0);var m=i===0||!e||c?n:i,g=o===0?new Date().getTime():o;return this._setWindowId(a),this._setSessionId(s,m,g),l&&this._sessionIdChangedHandlers.forEach((function(y){return y(s,a)})),{sessionId:s,windowId:a,sessionStartTimestamp:g}}}]),t})();(function(t){t.US="us",t.EU="eu",t.CUSTOM="custom"})(hp||(hp={}));var rz="i.posthog.com",Fqe=(function(){function t(e){ln(this,t),be(this,"_regionCache",{}),this.instance=e}return un(t,[{key:"apiHost",get:function(){var e=this.instance.config.api_host.trim().replace(/\/$/,"");return e==="https://app.posthog.com"?"https://us.i.posthog.com":e}},{key:"uiHost",get:function(){var e,n=(e=this.instance.config.ui_host)===null||e===void 0?void 0:e.replace(/\/$/,"");return n||(n=this.apiHost.replace(".".concat(rz),".posthog.com")),n==="https://app.posthog.com"?"https://us.posthog.com":n}},{key:"region",get:function(){return this._regionCache[this.apiHost]||(/https:\/\/(app|us|us-assets)(\.i)?\.posthog\.com/i.test(this.apiHost)?this._regionCache[this.apiHost]=hp.US:/https:\/\/(eu|eu-assets)(\.i)?\.posthog\.com/i.test(this.apiHost)?this._regionCache[this.apiHost]=hp.EU:this._regionCache[this.apiHost]=hp.CUSTOM),this._regionCache[this.apiHost]}},{key:"endpointFor",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(n&&(n=n[0]==="/"?n:"/".concat(n)),e==="ui")return this.uiHost+n;if(this.region===hp.CUSTOM)return this.apiHost+n;var r=rz+n;switch(e){case"assets":return"https://".concat(this.region,"-assets.").concat(r);case"api":return"https://".concat(this.region,".").concat(r)}}},{key:"loadScript",value:function(e,n){if(this.instance.config.disable_external_dependency_loading)return Te.warn("".concat(e," was requested but loading of external scripts is disabled.")),n("Loading of external scripts is disabled");var r=e[0]==="/"?this.endpointFor("assets",e):e,i=function(){if(!Ge)return n("document not found");var s=Ge.createElement("script");s.type="text/javascript",s.src=r,s.onload=function(c){return n(void 0,c)},s.onerror=function(c){return n(c)};var o,a=Ge.querySelectorAll("body > script");a.length>0?(o=a[0].parentNode)===null||o===void 0||o.insertBefore(s,a[0]):Ge.body.appendChild(s)};Ge!=null&&Ge.body?i():Ge?.addEventListener("DOMContentLoaded",i)}}]),t})(),ale="posthog-js";function cle(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=e.organization,r=e.projectId,i=e.prefix,s=e.severityAllowList,o=s===void 0?["error"]:s;return function(a){var c,l,d,h,m;if(!(o==="*"||o.includes(a.level))||!t.__loaded)return a;a.tags||(a.tags={});var g=t.requestRouter.endpointFor("ui","/project/".concat(t.config.token,"/person/").concat(t.get_distinct_id()));a.tags["PostHog Person URL"]=g,t.sessionRecordingStarted()&&(a.tags["PostHog Recording URL"]=t.get_session_replay_url({withTimestamp:!0}));var y=((c=a.exception)===null||c===void 0?void 0:c.values)||[],v={$exception_message:((l=y[0])===null||l===void 0?void 0:l.value)||a.message,$exception_type:(d=y[0])===null||d===void 0?void 0:d.type,$exception_personURL:g,$exception_level:a.level,$sentry_event_id:a.event_id,$sentry_exception:a.exception,$sentry_exception_message:((h=y[0])===null||h===void 0?void 0:h.value)||a.message,$sentry_exception_type:(m=y[0])===null||m===void 0?void 0:m.type,$sentry_tags:a.tags,$level:a.level};return n&&r&&(v.$sentry_url=(i||"https://sentry.io/organizations/")+n+"/issues/?project="+r+"&query="+a.event_id),t.exceptions.sendExceptionEvent(v),a}}var $qe=un((function t(e,n,r,i,s){ln(this,t),this.name=ale,this.setupOnce=function(o){o(cle(e,{organization:n,projectId:r,prefix:i,severityAllowList:s}))}}));function Bqe(t,e){var n=t.config.segment;if(!n)return e();(function(r,i){var s=r.config.segment;if(!s)return i();var o=function(c){var l=function(){return c.anonymousId()||Cf()};r.config.get_device_id=l,c.id()&&(r.register({distinct_id:c.id(),$device_id:l()}),r.persistence.set_property(wu,"identified")),i()},a=s.user();"then"in a&&Fa(a.then)?a.then((function(c){return o(c)})):o(a)})(t,(function(){n.register((function(r){Promise&&Promise.resolve||Te.warn("This browser does not have Promise support, and can not use the segment integration");var i=function(s,o){var a;if(!o)return s;s.event.userId||s.event.anonymousId===r.get_distinct_id()||(Te.info("Segment integration does not have a userId set, resetting PostHog"),r.reset()),s.event.userId&&s.event.userId!==r.get_distinct_id()&&(Te.info("Segment integration has a userId set, identifying with PostHog"),r.identify(s.event.userId));var c=r._calculate_event_properties(o,(a=s.event.properties)!==null&&a!==void 0?a:{},new Date);return s.event.properties=Object.assign({},c,s.event.properties),s};return{name:"PostHog JS",type:"enrichment",version:"1.0.0",isLoaded:function(){return!0},load:function(){return Promise.resolve()},track:function(s){return i(s,s.event.event)},page:function(s){return i(s,"$pageview")},identify:function(s){return i(s,"$identify")},screen:function(s){return i(s,"$screen")}}})(t)).then((function(){e()}))}))}var iz,$3,mc,Hqe=(function(){function t(e){ln(this,t),this._instance=e}return un(t,[{key:"doPageView",value:function(e){var n,r=this._previousPageViewProperties(e);return this._currentPath=(n=ce?.location.pathname)!==null&&n!==void 0?n:"",this._instance.scrollManager.resetContext(),this._prevPageviewTimestamp=e,r}},{key:"doPageLeave",value:function(e){return this._previousPageViewProperties(e)}},{key:"_previousPageViewProperties",value:function(e){var n=this._currentPath,r=this._prevPageviewTimestamp,i=this._instance.scrollManager.getContext();if(!r)return{};var s={};if(i){var o=i.maxScrollHeight,a=i.lastScrollY,c=i.maxScrollY,l=i.maxContentHeight,d=i.lastContentY,h=i.maxContentY;st(o)||st(a)||st(c)||st(l)||st(d)||st(h)||(o=Math.ceil(o),a=Math.ceil(a),c=Math.ceil(c),l=Math.ceil(l),d=Math.ceil(d),h=Math.ceil(h),s={$prev_pageview_last_scroll:a,$prev_pageview_last_scroll_percentage:o<=1?1:$w(a/o,0,1),$prev_pageview_max_scroll:c,$prev_pageview_max_scroll_percentage:o<=1?1:$w(c/o,0,1),$prev_pageview_last_content:d,$prev_pageview_last_content_percentage:l<=1?1:$w(d/l,0,1),$prev_pageview_max_content:h,$prev_pageview_max_content_percentage:l<=1?1:$w(h/l,0,1)})}return n&&(s.$prev_pageview_pathname=n),r&&(s.$prev_pageview_duration=(e.getTime()-r.getTime())/1e3),s}}]),t})();function $w(t,e,n){return Math.max(e,Math.min(t,n))}(function(t){t.Popover="popover",t.API="api",t.Widget="widget"})(iz||(iz={})),(function(t){t.Open="open",t.MultipleChoice="multiple_choice",t.SingleChoice="single_choice",t.Rating="rating",t.Link="link"})($3||($3={})),(function(t){t.NextQuestion="next_question",t.End="end",t.ResponseBased="response_based",t.SpecificQuestion="specific_question"})(mc||(mc={}));var lle=(function(){function t(){ln(this,t),be(this,"events",{}),this.events={}}return un(t,[{key:"on",value:function(e,n){var r=this;return this.events[e]||(this.events[e]=[]),this.events[e].push(n),function(){r.events[e]=r.events[e].filter((function(i){return i!==n}))}}},{key:"emit",value:function(e,n){var r,i=Xa(this.events[e]||[]);try{for(i.s();!(r=i.n()).done;)(0,r.value)(n)}catch(a){i.e(a)}finally{i.f()}var s,o=Xa(this.events["*"]||[]);try{for(o.s();!(s=o.n()).done;)(0,s.value)(e,n)}catch(a){o.e(a)}finally{o.f()}}}]),t})(),qqe=(function(){function t(e){var n=this;ln(this,t),be(this,"_debugEventEmitter",new lle),be(this,"checkStep",(function(r,i){return n.checkStepEvent(r,i)&&n.checkStepUrl(r,i)&&n.checkStepElement(r,i)})),be(this,"checkStepEvent",(function(r,i){return i==null||!i.event||r?.event===i?.event})),this.instance=e,this.actionEvents=new Set,this.actionRegistry=new Set}return un(t,[{key:"init",value:function(){var e,n=this;if(!st((e=this.instance)===null||e===void 0?void 0:e._addCaptureHook)){var r;(r=this.instance)===null||r===void 0||r._addCaptureHook((function(i,s){n.on(i,s)}))}}},{key:"register",value:function(e){var n,r,i=this;if(!st((n=this.instance)===null||n===void 0?void 0:n._addCaptureHook)&&(e.forEach((function(a){var c,l;(c=i.actionRegistry)===null||c===void 0||c.add(a),(l=a.steps)===null||l===void 0||l.forEach((function(d){var h;(h=i.actionEvents)===null||h===void 0||h.add(d?.event||"")}))})),(r=this.instance)!==null&&r!==void 0&&r.autocapture)){var s,o=new Set;e.forEach((function(a){var c;(c=a.steps)===null||c===void 0||c.forEach((function(l){l!=null&&l.selector&&o.add(l?.selector)}))})),(s=this.instance)===null||s===void 0||s.autocapture.setElementSelectors(o)}}},{key:"on",value:function(e,n){var r,i=this;n!=null&&e.length!=0&&(this.actionEvents.has(e)||this.actionEvents.has(n?.event))&&this.actionRegistry&&((r=this.actionRegistry)===null||r===void 0?void 0:r.size)>0&&this.actionRegistry.forEach((function(s){i.checkAction(n,s)&&i._debugEventEmitter.emit("actionCaptured",s.name)}))}},{key:"_addActionHook",value:function(e){this.onAction("actionCaptured",(function(n){return e(n)}))}},{key:"checkAction",value:function(e,n){if(n?.steps==null)return!1;var r,i=Xa(n.steps);try{for(i.s();!(r=i.n()).done;){var s=r.value;if(this.checkStep(e,s))return!0}}catch(o){i.e(o)}finally{i.f()}return!1}},{key:"onAction",value:function(e,n){return this._debugEventEmitter.on(e,n)}},{key:"checkStepUrl",value:function(e,n){if(n!=null&&n.url){var r,i=e==null||(r=e.properties)===null||r===void 0?void 0:r.$current_url;if(!i||typeof i!="string"||!t.matchString(i,n?.url,n?.url_matching||"contains"))return!1}return!0}},{key:"checkStepElement",value:function(e,n){if((n!=null&&n.href||n!=null&&n.tag_name||n!=null&&n.text)&&!this.getElementsList(e).some((function(s){return!(n!=null&&n.href&&!t.matchString(s.href||"",n?.href,n?.href_matching||"exact"))&&(n==null||!n.tag_name||s.tag_name===n?.tag_name)&&!(n!=null&&n.text&&!t.matchString(s.text||"",n?.text,n?.text_matching||"exact")&&!t.matchString(s.$el_text||"",n?.text,n?.text_matching||"exact"))})))return!1;if(n!=null&&n.selector){var r,i=e==null||(r=e.properties)===null||r===void 0?void 0:r.$element_selectors;if(!i||!i.includes(n?.selector))return!1}return!0}},{key:"getElementsList",value:function(e){return e?.properties.$elements==null?[]:e?.properties.$elements}}],[{key:"matchString",value:function(e,n,r){switch(r){case"regex":return!!ce&&O3(e,n);case"exact":return n===e;case"contains":var i=t.escapeStringRegexp(n).replace(/_/g,".").replace(/%/g,".*");return O3(e,i);default:return!1}}},{key:"escapeStringRegexp",value:function(e){return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}}]),t})(),ZM=(function(){function t(e){ln(this,t),this.instance=e,this.eventToSurveys=new Map,this.actionToSurveys=new Map}return un(t,[{key:"register",value:function(e){var n;st((n=this.instance)===null||n===void 0?void 0:n._addCaptureHook)||(this.setupEventBasedSurveys(e),this.setupActionBasedSurveys(e))}},{key:"setupActionBasedSurveys",value:function(e){var n=this,r=e.filter((function(i){var s,o,a,c;return((s=i.conditions)===null||s===void 0?void 0:s.actions)&&((o=i.conditions)===null||o===void 0||(a=o.actions)===null||a===void 0||(c=a.values)===null||c===void 0?void 0:c.length)>0}));r.length!==0&&(this.actionMatcher==null&&(this.actionMatcher=new qqe(this.instance),this.actionMatcher.init(),this.actionMatcher._addActionHook((function(i){n.onAction(i)}))),r.forEach((function(i){var s,o,a,c,l,d,h,m,g,y;i.conditions&&(s=i.conditions)!==null&&s!==void 0&&s.actions&&(o=i.conditions)!==null&&o!==void 0&&(a=o.actions)!==null&&a!==void 0&&a.values&&((c=i.conditions)===null||c===void 0||(l=c.actions)===null||l===void 0||(d=l.values)===null||d===void 0?void 0:d.length)>0&&((h=n.actionMatcher)===null||h===void 0||h.register(i.conditions.actions.values),(m=i.conditions)===null||m===void 0||(g=m.actions)===null||g===void 0||(y=g.values)===null||y===void 0||y.forEach((function(v){if(v&&v.name){var E=n.actionToSurveys.get(v.name);E&&E.push(i.id),n.actionToSurveys.set(v.name,E||[i.id])}})))})))}},{key:"setupEventBasedSurveys",value:function(e){var n,r=this;e.filter((function(i){var s,o,a,c;return((s=i.conditions)===null||s===void 0?void 0:s.events)&&((o=i.conditions)===null||o===void 0||(a=o.events)===null||a===void 0||(c=a.values)===null||c===void 0?void 0:c.length)>0})).length!==0&&((n=this.instance)===null||n===void 0||n._addCaptureHook((function(i,s){r.onEvent(i,s)})),e.forEach((function(i){var s,o,a;(s=i.conditions)===null||s===void 0||(o=s.events)===null||o===void 0||(a=o.values)===null||a===void 0||a.forEach((function(c){if(c&&c.name){var l=r.eventToSurveys.get(c.name);l&&l.push(i.id),r.eventToSurveys.set(c.name,l||[i.id])}}))})))}},{key:"onEvent",value:function(e,n){var r,i,s=((r=this.instance)===null||r===void 0||(i=r.persistence)===null||i===void 0?void 0:i.props[Ow])||[];if(t.SURVEY_SHOWN_EVENT_NAME==e&&n&&s.length>0){var o,a=n==null||(o=n.properties)===null||o===void 0?void 0:o.$survey_id;if(a){var c=s.indexOf(a);c>=0&&(s.splice(c,1),this._updateActivatedSurveys(s))}}else this.eventToSurveys.has(e)&&this._updateActivatedSurveys(s.concat(this.eventToSurveys.get(e)||[]))}},{key:"onAction",value:function(e){var n,r,i=((n=this.instance)===null||n===void 0||(r=n.persistence)===null||r===void 0?void 0:r.props[Ow])||[];this.actionToSurveys.has(e)&&this._updateActivatedSurveys(i.concat(this.actionToSurveys.get(e)||[]))}},{key:"_updateActivatedSurveys",value:function(e){var n,r;(n=this.instance)===null||n===void 0||(r=n.persistence)===null||r===void 0||r.register(be({},Ow,Wu(new Set(e))))}},{key:"getSurveys",value:function(){var e,n,r=(e=this.instance)===null||e===void 0||(n=e.persistence)===null||n===void 0?void 0:n.props[Ow];return r||[]}},{key:"getEventToSurveys",value:function(){return this.eventToSurveys}},{key:"_getActionMatcher",value:function(){return this.actionMatcher}}]),t})();be(ZM,"SURVEY_SHOWN_EVENT_NAME","survey shown");var d1="[Surveys]",Vqe={icontains:function(t){return!!ce&&ce.location.href.toLowerCase().indexOf(t.toLowerCase())>-1},not_icontains:function(t){return!!ce&&ce.location.href.toLowerCase().indexOf(t.toLowerCase())===-1},regex:function(t){return!!ce&&O3(ce.location.href,t)},not_regex:function(t){return!!ce&&!O3(ce.location.href,t)},exact:function(t){return ce?.location.href===t},is_not:function(t){return ce?.location.href!==t}},Kqe=(function(){function t(e){ln(this,t),this.instance=e,this._surveyEventReceiver=null}return un(t,[{key:"afterDecideResponse",value:function(e){this._decideServerResponse=!!e.surveys,this.loadIfEnabled()}},{key:"loadIfEnabled",value:function(){var e=this,n=ar?.extendPostHogWithSurveys;this.instance.config.disable_surveys||!this._decideServerResponse||n||(this._surveyEventReceiver==null&&(this._surveyEventReceiver=new ZM(this.instance)),this.instance.requestRouter.loadScript("/static/surveys.js",(function(r){if(r)return Te.error(d1,"Could not load surveys script",r);e._surveyManager=ar.extendPostHogWithSurveys(e.instance)})))}},{key:"getSurveys",value:function(e){var n=this,r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(this.instance.config.disable_surveys)return e([]);this._surveyEventReceiver==null&&(this._surveyEventReceiver=new ZM(this.instance));var i=this.instance.get_property(NM);if(i&&!r)return e(i);this.instance._send_request({url:this.instance.requestRouter.endpointFor("api","/api/surveys/?token=".concat(this.instance.config.token)),method:"GET",transport:"XHR",callback:function(s){var o;if(s.statusCode!==200||!s.json)return e([]);var a,c=s.json.surveys||[],l=c.filter((function(d){var h,m,g,y,v,E,w,R,x,C,k,T;return((h=d.conditions)===null||h===void 0?void 0:h.events)&&((m=d.conditions)===null||m===void 0||(g=m.events)===null||g===void 0?void 0:g.values)&&((y=d.conditions)===null||y===void 0||(v=y.events)===null||v===void 0||(E=v.values)===null||E===void 0?void 0:E.length)>0||((w=d.conditions)===null||w===void 0?void 0:w.actions)&&((R=d.conditions)===null||R===void 0||(x=R.actions)===null||x===void 0?void 0:x.values)&&((C=d.conditions)===null||C===void 0||(k=C.actions)===null||k===void 0||(T=k.values)===null||T===void 0?void 0:T.length)>0}));return l.length>0&&((a=n._surveyEventReceiver)===null||a===void 0||a.register(l)),(o=n.instance.persistence)===null||o===void 0||o.register(be({},NM,c)),e(c)}})}},{key:"getActiveMatchingSurveys",value:function(e){var n=this,r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this.getSurveys((function(i){var s,o=i.filter((function(l){return!(!l.start_date||l.end_date)})).filter((function(l){var d,h,m,g;if(!l.conditions)return!0;var y=(d=l.conditions)===null||d===void 0||!d.url||Vqe[(h=(m=l.conditions)===null||m===void 0?void 0:m.urlMatchType)!==null&&h!==void 0?h:"icontains"](l.conditions.url),v=(g=l.conditions)===null||g===void 0||!g.selector||Ge?.querySelector(l.conditions.selector);return y&&v})),a=(s=n._surveyEventReceiver)===null||s===void 0?void 0:s.getSurveys(),c=o.filter((function(l){var d,h,m,g,y,v,E,w,R,x;if(!l.linked_flag_key&&!l.targeting_flag_key&&!l.internal_targeting_flag_key)return!0;var C=!l.linked_flag_key||n.instance.featureFlags.isFeatureEnabled(l.linked_flag_key),k=!l.targeting_flag_key||n.instance.featureFlags.isFeatureEnabled(l.targeting_flag_key),T=((d=l.conditions)===null||d===void 0?void 0:d.events)&&((h=l.conditions)===null||h===void 0||(m=h.events)===null||m===void 0?void 0:m.values)&&((g=l.conditions)===null||g===void 0||(y=g.events)===null||y===void 0?void 0:y.values.length)>0,L=((v=l.conditions)===null||v===void 0?void 0:v.actions)&&((E=l.conditions)===null||E===void 0||(w=E.actions)===null||w===void 0?void 0:w.values)&&((R=l.conditions)===null||R===void 0||(x=R.actions)===null||x===void 0?void 0:x.values.length)>0,O=!T&&!L||a?.includes(l.id),P=n._canActivateRepeatedly(l),D=!(l.internal_targeting_flag_key&&!P)||n.instance.featureFlags.isFeatureEnabled(l.internal_targeting_flag_key);return C&&k&&D&&O}));return e(c)}),r)}},{key:"getNextSurveyStep",value:function(e,n,r){var i,s=e.questions[n],o=n+1;if((i=s.branching)===null||i===void 0||!i.type)return n===e.questions.length-1?mc.End:o;if(s.branching.type===mc.End)return mc.End;if(s.branching.type===mc.SpecificQuestion){if(Number.isInteger(s.branching.index))return s.branching.index}else if(s.branching.type===mc.ResponseBased){if(s.type===$3.SingleChoice){var a,c,l=s.choices.indexOf("".concat(r));if((a=s.branching)!==null&&a!==void 0&&(c=a.responseValues)!==null&&c!==void 0&&c.hasOwnProperty(l)){var d=s.branching.responseValues[l];return Number.isInteger(d)?d:d===mc.End?mc.End:o}}else if(s.type===$3.Rating){var h,m;if(typeof r!="number"||!Number.isInteger(r))throw new Error("The response type must be an integer");var g=(function(v,E){if(E===3){if(v<1||v>3)throw new Error("The response must be in range 1-3");return v===1?"negative":v===2?"neutral":"positive"}if(E===5){if(v<1||v>5)throw new Error("The response must be in range 1-5");return v<=2?"negative":v===3?"neutral":"positive"}if(E===10){if(v<0||v>10)throw new Error("The response must be in range 0-10");return v<=6?"detractors":v<=8?"passives":"promoters"}throw new Error("The scale must be one of: 3, 5, 10")})(r,s.scale);if((h=s.branching)!==null&&h!==void 0&&(m=h.responseValues)!==null&&m!==void 0&&m.hasOwnProperty(g)){var y=s.branching.responseValues[g];return Number.isInteger(y)?y:y===mc.End?mc.End:o}}return o}return Te.warn(d1,"Falling back to next question index due to unexpected branching type"),o}},{key:"_canActivateRepeatedly",value:function(e){return go(ar.__PosthogExtensions__.canActivateRepeatedly)&&Te.warn(d1,"canActivateRepeatedly is not defined, must init before calling"),ar.__PosthogExtensions__.canActivateRepeatedly(e)}},{key:"canRenderSurvey",value:function(e){var n=this;go(this._surveyManager)?Te.warn(d1,"canActivateRepeatedly is not defined, must init before calling"):this.getSurveys((function(r){var i=r.filter((function(s){return s.id===e}))[0];n._surveyManager.canRenderSurvey(i)}))}},{key:"renderSurvey",value:function(e,n){var r=this;go(this._surveyManager)?Te.warn(d1,"canActivateRepeatedly is not defined, must init before calling"):this.getSurveys((function(i){var s=i.filter((function(o){return o.id===e}))[0];r._surveyManager.renderSurvey(s,Ge?.querySelector(n))}))}}]),t})(),Gqe=(function(){function t(e){var n,r,i=this;ln(this,t),be(this,"serverLimits",{}),be(this,"lastEventRateLimited",!1),be(this,"checkForLimiting",(function(s){var o=s.text;if(o&&o.length)try{(JSON.parse(o).quota_limited||[]).forEach((function(a){Te.info("[RateLimiter] ".concat(a||"events"," is quota limited.")),i.serverLimits[a]=new Date().getTime()+6e4}))}catch(a){return void Te.warn('[RateLimiter] could not rate limit - continuing. Error: "'.concat(a?.message,'"'),{text:o})}})),this.instance=e,this.captureEventsPerSecond=((n=e.config.rate_limiting)===null||n===void 0?void 0:n.events_per_second)||10,this.captureEventsBurstLimit=Math.max(((r=e.config.rate_limiting)===null||r===void 0?void 0:r.events_burst_limit)||10*this.captureEventsPerSecond,this.captureEventsPerSecond),this.lastEventRateLimited=this.clientRateLimitContext(!0).isRateLimited}return un(t,[{key:"clientRateLimitContext",value:function(){var e,n,r,i=arguments.length>0&&arguments[0]!==void 0&&arguments[0],s=new Date().getTime(),o=(e=(n=this.instance.persistence)===null||n===void 0?void 0:n.get_property(jM))!==null&&e!==void 0?e:{tokens:this.captureEventsBurstLimit,last:s};o.tokens+=(s-o.last)/1e3*this.captureEventsPerSecond,o.last=s,o.tokens>this.captureEventsBurstLimit&&(o.tokens=this.captureEventsBurstLimit);var a=o.tokens<1;return a||i||(o.tokens=Math.max(0,o.tokens-1)),!a||this.lastEventRateLimited||i||this.instance.capture("$$client_ingestion_warning",{$$client_ingestion_warning_message:"posthog-js client rate limited. Config is set to ".concat(this.captureEventsPerSecond," events per second and ").concat(this.captureEventsBurstLimit," events burst limit.")},{skip_client_rate_limiting:!0}),this.lastEventRateLimited=a,(r=this.instance.persistence)===null||r===void 0||r.set_property(jM,o),{isRateLimited:a,remainingTokens:o.tokens}}},{key:"isServerRateLimited",value:function(e){var n=this.serverLimits[e||"events"]||!1;return n!==!1&&new Date().getTime()<n}}]),t})(),zqe=function(){return $e({initialPathName:eo?.pathname||"",referringDomain:Mi.referringDomain()},Mi.campaignParams())},Wqe=(function(){function t(e,n,r){var i=this;ln(this,t),be(this,"_onSessionIdCallback",(function(s){var o=i._getStoredProps();if(!o||o.sessionId!==s){var a={sessionId:s,props:i._sessionSourceParamGenerator()};i._persistence.register(be({},UM,a))}})),this._sessionIdManager=e,this._persistence=n,this._sessionSourceParamGenerator=r||zqe,this._sessionIdManager.onSessionId(this._onSessionIdCallback)}return un(t,[{key:"_getStoredProps",value:function(){return this._persistence.props[UM]}},{key:"getSessionProps",value:function(){var e,n=(e=this._getStoredProps())===null||e===void 0?void 0:e.props;return n?{$client_session_initial_referring_host:n.referringDomain,$client_session_initial_pathname:n.initialPathName,$client_session_initial_utm_source:n.utm_source,$client_session_initial_utm_campaign:n.utm_campaign,$client_session_initial_utm_medium:n.utm_medium,$client_session_initial_utm_content:n.utm_content,$client_session_initial_utm_term:n.utm_term}:{}}}]),t})(),Yqe=["ahrefsbot","ahrefssiteaudit","applebot","baiduspider","bingbot","bingpreview","bot.htm","bot.php","crawler","deepscan","duckduckbot","facebookexternal","facebookcatalog","gptbot","http://yandex.com/bots","hubspot","ia_archiver","linkedinbot","mj12bot","msnbot","nessus","petalbot","pinterest","prerender","rogerbot","screaming frog","semrushbot","sitebulb","slurp","turnitin","twitterbot","vercelbot","yahoo! slurp","yandexbot","headlesschrome","cypress","Google-HotelAdsVerifier","adsbot-google","apis-google","duplexweb-google","feedfetcher-google","google favicon","google web preview","google-read-aloud","googlebot","googleweblight","mediapartners-google","storebot-google","Bytespider;"],sz=function(t,e){if(!t)return!1;var n=t.toLowerCase();return Yqe.concat(e||[]).some((function(r){var i=r.toLowerCase();return n.indexOf(i)!==-1}))},ule=(function(){function t(){ln(this,t),this.clicks=[]}return un(t,[{key:"isRageClick",value:function(e,n,r){var i=this.clicks[this.clicks.length-1];if(i&&Math.abs(e-i.x)+Math.abs(n-i.y)<30&&r-i.timestamp<1e3){if(this.clicks.push({x:e,y:n,timestamp:r}),this.clicks.length===3)return!0}else this.clicks=[{x:e,y:n,timestamp:r}];return!1}}]),t})();function oz(t){var e;return t.id===BM||!((e=t.closest)===null||e===void 0||!e.call(t,"#"+BM))}var Xqe=(function(){function t(e){var n,r=this;ln(this,t),be(this,"rageclicks",new ule),be(this,"_enabledServerSide",!1),be(this,"_initialized",!1),be(this,"_flushInterval",null),this.instance=e,this._enabledServerSide=!((n=this.instance.persistence)===null||n===void 0||!n.props[OM]),ce?.addEventListener("beforeunload",(function(){r.flush()}))}return un(t,[{key:"flushIntervalMilliseconds",get:function(){var e=5e3;return Zi(this.instance.config.capture_heatmaps)&&this.instance.config.capture_heatmaps.flush_interval_milliseconds&&(e=this.instance.config.capture_heatmaps.flush_interval_milliseconds),e}},{key:"isEnabled",get:function(){return st(this.instance.config.capture_heatmaps)?st(this.instance.config.enable_heatmaps)?this._enabledServerSide:this.instance.config.enable_heatmaps:this.instance.config.capture_heatmaps!==!1}},{key:"startIfEnabled",value:function(){if(this.isEnabled){if(this._initialized)return;Te.info("[heatmaps] starting..."),this._setupListeners(),this._flushInterval=setInterval(this.flush.bind(this),this.flushIntervalMilliseconds)}else{var e;clearInterval((e=this._flushInterval)!==null&&e!==void 0?e:void 0),this.getAndClearBuffer()}}},{key:"afterDecideResponse",value:function(e){var n=!!e.heatmaps;this.instance.persistence&&this.instance.persistence.register(be({},OM,n)),this._enabledServerSide=n,this.startIfEnabled()}},{key:"getAndClearBuffer",value:function(){var e=this.buffer;return this.buffer=void 0,e}},{key:"_setupListeners",value:function(){var e=this;ce&&Ge&&(Nu(Ge,"click",(function(n){return e._onClick(n||ce?.event)}),!1,!0),Nu(Ge,"mousemove",(function(n){return e._onMouseMove(n||ce?.event)}),!1,!0),this._initialized=!0)}},{key:"_getProperties",value:function(e,n){var r=this.instance.scrollManager.scrollY(),i=this.instance.scrollManager.scrollX(),s=this.instance.scrollManager.scrollElement(),o=(function(a,c,l){for(var d=a;d&&!Nf(d,"body");){if(d===l)return!1;if(Wt(c,ce?.getComputedStyle(d).position))return!0;d=Jce(d)}return!1})(e.target,["fixed","sticky"],s);return{x:e.clientX+(o?0:i),y:e.clientY+(o?0:r),target_fixed:o,type:n}}},{key:"_onClick",value:function(e){var n;if(!oz(e.target)){var r=this._getProperties(e,"click");(n=this.rageclicks)!==null&&n!==void 0&&n.isRageClick(e.clientX,e.clientY,new Date().getTime())&&this._capture($e($e({},r),{},{type:"rageclick"})),this._capture(r)}}},{key:"_onMouseMove",value:function(e){var n=this;oz(e.target)||(clearTimeout(this._mouseMoveTimeout),this._mouseMoveTimeout=setTimeout((function(){n._capture(n._getProperties(e,"mousemove"))}),500))}},{key:"_capture",value:function(e){if(ce){var n=ce.location.href;this.buffer=this.buffer||{},this.buffer[n]||(this.buffer[n]=[]),this.buffer[n].push(e)}}},{key:"flush",value:function(){this.buffer&&!tC(this.buffer)&&this.instance.capture("$$heatmap",{$heatmap_data:this.getAndClearBuffer()})}}]),t})(),Jqe=(function(){function t(e){var n=this;ln(this,t),be(this,"_updateScrollData",(function(){var r,i,s,o;n.context||(n.context={});var a=n.scrollElement(),c=n.scrollY(),l=a?Math.max(0,a.scrollHeight-a.clientHeight):0,d=c+(a?.clientHeight||0),h=a?.scrollHeight||0;n.context.lastScrollY=Math.ceil(c),n.context.maxScrollY=Math.max(c,(r=n.context.maxScrollY)!==null&&r!==void 0?r:0),n.context.maxScrollHeight=Math.max(l,(i=n.context.maxScrollHeight)!==null&&i!==void 0?i:0),n.context.lastContentY=d,n.context.maxContentY=Math.max(d,(s=n.context.maxContentY)!==null&&s!==void 0?s:0),n.context.maxContentHeight=Math.max(h,(o=n.context.maxContentHeight)!==null&&o!==void 0?o:0)})),this.instance=e}return un(t,[{key:"getContext",value:function(){return this.context}},{key:"resetContext",value:function(){var e=this.context;return setTimeout(this._updateScrollData,0),e}},{key:"startMeasuringScrollPosition",value:function(){ce?.addEventListener("scroll",this._updateScrollData,!0),ce?.addEventListener("scrollend",this._updateScrollData,!0),ce?.addEventListener("resize",this._updateScrollData)}},{key:"scrollElement",value:function(){if(!this.instance.config.scroll_root_selector)return ce?.document.documentElement;var e,n=Xa(yi(this.instance.config.scroll_root_selector)?this.instance.config.scroll_root_selector:[this.instance.config.scroll_root_selector]);try{for(n.s();!(e=n.n()).done;){var r=e.value,i=ce?.document.querySelector(r);if(i)return i}}catch(s){n.e(s)}finally{n.f()}}},{key:"scrollY",value:function(){if(this.instance.config.scroll_root_selector){var e=this.scrollElement();return e&&e.scrollTop||0}return ce&&(ce.scrollY||ce.pageYOffset||ce.document.documentElement.scrollTop)||0}},{key:"scrollX",value:function(){if(this.instance.config.scroll_root_selector){var e=this.scrollElement();return e&&e.scrollLeft||0}return ce&&(ce.scrollX||ce.pageXOffset||ce.document.documentElement.scrollLeft)||0}}]),t})(),Y6="$copy_autocapture";function X6(t,e){return e.length>t?e.slice(0,t)+"...":e}var pf,Qqe=(function(){function t(e){ln(this,t),be(this,"_initialized",!1),be(this,"_isDisabledServerSide",null),be(this,"rageclicks",new ule),be(this,"_elementsChainAsString",!1),this.instance=e,this._elementSelectors=null}return un(t,[{key:"config",get:function(){var e,n,r=Zi(this.instance.config.autocapture)?this.instance.config.autocapture:{};return r.url_allowlist=(e=r.url_allowlist)===null||e===void 0?void 0:e.map((function(i){return new RegExp(i)})),r.url_ignorelist=(n=r.url_ignorelist)===null||n===void 0?void 0:n.map((function(i){return new RegExp(i)})),r}},{key:"_addDomEventHandlers",value:function(){var e=this;if(this.isBrowserSupported()){if(ce&&Ge){var n=function(i){i=i||ce?.event;try{e._captureEvent(i)}catch(s){Te.error("Failed to capture event",s)}},r=function(i){i=i||ce?.event,e._captureEvent(i,Y6)};Nu(Ge,"submit",n,!1,!0),Nu(Ge,"change",n,!1,!0),Nu(Ge,"click",n,!1,!0),this.config.capture_copied_text&&(Nu(Ge,"copy",r,!1,!0),Nu(Ge,"cut",r,!1,!0))}}else Te.info("Disabling Automatic Event Collection because this browser is not supported")}},{key:"startIfEnabled",value:function(){this.isEnabled&&!this._initialized&&(this._addDomEventHandlers(),this._initialized=!0)}},{key:"afterDecideResponse",value:function(e){e.elementsChainAsString&&(this._elementsChainAsString=e.elementsChainAsString),this.instance.persistence&&this.instance.persistence.register(be({},RG,!!e.autocapture_opt_out)),this._isDisabledServerSide=!!e.autocapture_opt_out,this.startIfEnabled()}},{key:"setElementSelectors",value:function(e){this._elementSelectors=e}},{key:"getElementSelectors",value:function(e){var n,r=[];return(n=this._elementSelectors)===null||n===void 0||n.forEach((function(i){var s=Ge?.querySelectorAll(i);s?.forEach((function(o){e===o&&r.push(i)}))})),r}},{key:"isEnabled",get:function(){var e,n,r=(e=this.instance.persistence)===null||e===void 0?void 0:e.props[RG],i=this._isDisabledServerSide;if(bd(i)&&!fp(r)&&!this.instance.config.advanced_disable_decide)return!1;var s=(n=this._isDisabledServerSide)!==null&&n!==void 0?n:!!r;return!!this.instance.config.autocapture&&!s}},{key:"_previousElementSibling",value:function(e){if(e.previousElementSibling)return e.previousElementSibling;var n=e;do n=n.previousSibling;while(n&&!c9(n));return n}},{key:"_getAugmentPropertiesFromElement",value:function(e){if(!WM(e))return{};var n={};return Nn(e.attributes,(function(r){if(r.name&&r.name.indexOf("data-ph-capture-attribute")===0){var i=r.name.replace("data-ph-capture-attribute-",""),s=r.value;i&&s&&mv(s)&&(n[i]=s)}})),n}},{key:"_getPropertiesFromElement",value:function(e,n,r){var i,s=e.tagName.toLowerCase(),o={tag_name:s};zM.indexOf(s)>-1&&!r&&(s.toLowerCase()==="a"||s.toLowerCase()==="button"?o.$el_text=X6(1024,GG(e)):o.$el_text=X6(1024,U3(e)));var a=N3(e);a.length>0&&(o.classes=a.filter((function(m){return m!==""})));var c=(i=this.config)===null||i===void 0?void 0:i.element_attribute_ignorelist;Nn(e.attributes,(function(m){var g;if((!Qce(e)||["name","id","class","aria-label"].indexOf(m.name)!==-1)&&(c==null||!c.includes(m.name))&&!n&&mv(m.value)&&(g=m.name,!hs(g)||g.substring(0,10)!=="_ngcontent"&&g.substring(0,7)!=="_nghost")){var y=m.value;m.name==="class"&&(y=a9(y).join(" ")),o["attr__"+m.name]=X6(1024,y)}}));for(var l=1,d=1,h=e;h=this._previousElementSibling(h);)l++,h.tagName===e.tagName&&d++;return o.nth_child=l,o.nth_of_type=d,o}},{key:"_getDefaultProperties",value:function(e){return{$event_type:e,$ce_version:1}}},{key:"_getEventTarget",value:function(e){return st(e.target)?e.srcElement||null:(n=e.target)!==null&&n!==void 0&&n.shadowRoot?e.composedPath()[0]||null:e.target||null;var n}},{key:"_captureEvent",value:function(e){var n=this,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"$autocapture";if(this.isEnabled){var i,s=this._getEventTarget(e);Yce(s)&&(s=s.parentNode||null),r==="$autocapture"&&e.type==="click"&&e instanceof MouseEvent&&this.instance.config.rageclick&&(i=this.rageclicks)!==null&&i!==void 0&&i.isRageClick(e.clientX,e.clientY,new Date().getTime())&&this._captureEvent(e,"$rageclick");var o=r===Y6;if(s&&aqe(s,e,this.config,o,o?["copy","cut"]:void 0)){for(var a,c,l=[s],d=s;d.parentNode&&!Nf(d,"body");)Xce(d.parentNode)?(l.push(d.parentNode.host),d=d.parentNode.host):(l.push(d.parentNode),d=d.parentNode);var h,m,g=[],y={},v=!1;if(Nn(l,(function(P){var D=WM(P);P.tagName.toLowerCase()==="a"&&(h=P.getAttribute("href"),h=D&&mv(h)&&h),Wt(N3(P),"ph-no-capture")&&(v=!0),g.push(n._getPropertiesFromElement(P,n.instance.config.mask_all_element_attributes,n.instance.config.mask_all_text));var j=n._getAugmentPropertiesFromElement(P);Os(y,j)})),this.instance.config.mask_all_text||(s.tagName.toLowerCase()==="a"||s.tagName.toLowerCase()==="button"?g[0].$el_text=GG(s):g[0].$el_text=U3(s)),h){var E,w;g[0].attr__href=h;var R=(E=lb(h))===null||E===void 0?void 0:E.host,x=ce==null||(w=ce.location)===null||w===void 0?void 0:w.host;R&&x&&R!==x&&(m=h)}if(v)return!1;var C=Os(this._getDefaultProperties(e.type),this._elementsChainAsString?{$elements_chain:fqe(g)}:{$elements:g},(a=g[0])!==null&&a!==void 0&&a.$el_text?{$el_text:(c=g[0])===null||c===void 0?void 0:c.$el_text}:{},m&&e.type==="click"?{$external_click_url:m}:{},y),k=this.getElementSelectors(s);if(k&&k.length>0&&(C.$element_selectors=k),r===Y6){var T,L=Wce(ce==null||(T=ce.getSelection())===null||T===void 0?void 0:T.toString()),O=e.type||"clipboard";if(!L)return!1;C.$selected_content=L,C.$copy_type=O}return this.instance.capture(r,C),!0}}}},{key:"isBrowserSupported",value:function(){return Fa(Ge?.querySelectorAll)}}]),t})(),Zqe=(function(){function t(e){var n=this;ln(this,t),be(this,"_restoreXHRPatch",void 0),be(this,"_restoreFetchPatch",void 0),be(this,"_startCapturing",(function(){st(n._restoreXHRPatch)&&ar.postHogTracingHeadersPatchFns._patchXHR(n.instance.sessionManager),st(n._restoreFetchPatch)&&ar.postHogTracingHeadersPatchFns._patchFetch(n.instance.sessionManager)})),this.instance=e}return un(t,[{key:"_loadScript",value:function(e){ar.postHogTracingHeadersPatchFns&&e(),this.instance.requestRouter.loadScript("/static/tracing-headers.js?v=".concat(Aa.LIB_VERSION),(function(n){if(n)return Te.error("[TRACING-HEADERS] failed to load script",n);e()}))}},{key:"startIfEnabledOrStop",value:function(){var e,n;this.instance.config.__add_tracing_headers?this._loadScript(this._startCapturing):((e=this._restoreXHRPatch)===null||e===void 0||e.call(this),(n=this._restoreFetchPatch)===null||n===void 0||n.call(this),this._restoreXHRPatch=void 0,this._restoreFetchPatch=void 0)}}]),t})();(function(t){t[t.PENDING=-1]="PENDING",t[t.DENIED=0]="DENIED",t[t.GRANTED=1]="GRANTED"})(pf||(pf={}));var eVe=(function(){function t(e){ln(this,t),this.instance=e}return un(t,[{key:"config",get:function(){return this.instance.config}},{key:"consent",get:function(){return this.getDnt()?pf.DENIED:this.storedConsent}},{key:"isOptedOut",value:function(){return this.consent===pf.DENIED||this.consent===pf.PENDING&&this.config.opt_out_capturing_by_default}},{key:"isOptedIn",value:function(){return!this.isOptedOut()}},{key:"optInOut",value:function(e){this.storage.set(this.storageKey,e?1:0,this.config.cookie_expiration,this.config.cross_subdomain_cookie,this.config.secure_cookie)}},{key:"reset",value:function(){this.storage.remove(this.storageKey,this.config.cross_subdomain_cookie)}},{key:"storageKey",get:function(){var e=this.instance.config,n=e.token;return(e.opt_out_capturing_cookie_prefix||"__ph_opt_in_out_")+n}},{key:"storedConsent",get:function(){var e=this.storage.get(this.storageKey);return e==="1"?pf.GRANTED:e==="0"?pf.DENIED:pf.PENDING}},{key:"storage",get:function(){if(!this._storage){var e=this.config.opt_out_capturing_persistence_type;this._storage=e==="localStorage"?gi:Yu;var n=e==="localStorage"?Yu:gi;n.get(this.storageKey)&&(this._storage.get(this.storageKey)||this.optInOut(n.get(this.storageKey)==="1"),n.remove(this.storageKey,this.config.cross_subdomain_cookie))}return this._storage}},{key:"getDnt",value:function(){return!!this.config.respect_dnt&&!!Ace([Ac?.doNotTrack,Ac?.msDoNotTrack,ar.doNotTrack],(function(e){return Wt([!0,1,"1","yes"],e)}))}}]),t})(),Bw="[Exception Autocapture]",tVe=(function(){function t(e){var n,r=this;ln(this,t),be(this,"originalOnUnhandledRejectionHandler",void 0),be(this,"startCapturing",(function(){if(ce&&r.isEnabled&&!r.hasHandlers&&!r.isCapturing){var i=ce.posthogErrorWrappingFunctions.wrapOnError,s=ce.posthogErrorWrappingFunctions.wrapUnhandledRejection;if(i&&s)try{r.unwrapOnError=i(r.captureException.bind(r)),r.unwrapUnhandledRejection=s(r.captureException.bind(r))}catch(o){Te.error(Bw+" failed to start",o),r.stopCapturing()}else Te.error(Bw+" failed to load error wrapping functions - cannot start")}})),this.instance=e,this.remoteEnabled=!((n=this.instance.persistence)===null||n===void 0||!n.props[kG]),this.startIfEnabled()}return un(t,[{key:"isEnabled",get:function(){var e;return(e=this.remoteEnabled)!==null&&e!==void 0&&e}},{key:"isCapturing",get:function(){var e;return!(ce==null||(e=ce.onerror)===null||e===void 0||!e.__POSTHOG_INSTRUMENTED__)}},{key:"hasHandlers",get:function(){return this.originalOnUnhandledRejectionHandler||this.unwrapOnError}},{key:"startIfEnabled",value:function(){this.isEnabled&&!this.isCapturing&&(Te.info(Bw+" enabled, starting..."),this.loadScript(this.startCapturing))}},{key:"loadScript",value:function(e){this.hasHandlers&&e(),this.instance.requestRouter.loadScript("/static/exception-autocapture.js?v=".concat(Aa.LIB_VERSION),(function(n){if(n)return Te.error(Bw+" failed to load script",n);e()}))}},{key:"stopCapturing",value:function(){var e,n;(e=this.unwrapOnError)===null||e===void 0||e.call(this),(n=this.unwrapUnhandledRejection)===null||n===void 0||n.call(this)}},{key:"afterDecideResponse",value:function(e){var n=e.autocaptureExceptions;this.remoteEnabled=!!n||!1,this.instance.persistence&&this.instance.persistence.register(be({},kG,this.remoteEnabled)),this.startIfEnabled()}},{key:"captureException",value:function(e){var n=this.instance.requestRouter.endpointFor("ui");e.$exception_personURL="".concat(n,"/project/").concat(this.instance.config.token,"/person/").concat(this.instance.get_distinct_id()),this.instance.exceptions.sendExceptionEvent(e)}}]),t})(),az=9e5,Yh="[Web Vitals]",nVe=(function(){function t(e){var n,r=this;ln(this,t),be(this,"_enabledServerSide",!1),be(this,"_initialized",!1),be(this,"buffer",{url:void 0,metrics:[],firstMetricTimestamp:void 0}),be(this,"_flushToCapture",(function(){clearTimeout(r._delayedFlushTimer),r.buffer.metrics.length!==0&&(r.instance.capture("$web_vitals",r.buffer.metrics.reduce((function(i,s){var o;return $e($e({},i),{},(be(o={},"$web_vitals_".concat(s.name,"_event"),$e({},s)),be(o,"$web_vitals_".concat(s.name,"_value"),s.value),o))}),{})),r.buffer={url:void 0,metrics:[],firstMetricTimestamp:void 0})})),be(this,"_addToBuffer",(function(i){var s,o=(s=r.instance.sessionManager)===null||s===void 0?void 0:s.checkAndGetSessionAndWindowId(!0);if(st(o))Te.error(Yh+"Could not read session ID. Dropping metrics!");else{r.buffer=r.buffer||{url:void 0,metrics:[],firstMetricTimestamp:void 0};var a=r._currentURL();st(a)||(go(i?.name)||go(i?.value)?Te.error(Yh+"Invalid metric received",i):r._maxAllowedValue&&i.value>=r._maxAllowedValue?Te.error(Yh+"Ignoring metric with value >= "+r._maxAllowedValue,i):(r.buffer.url!==a&&(r._flushToCapture(),r._delayedFlushTimer=setTimeout(r._flushToCapture,8e3)),st(r.buffer.url)&&(r.buffer.url=a),r.buffer.firstMetricTimestamp=st(r.buffer.firstMetricTimestamp)?Date.now():r.buffer.firstMetricTimestamp,r.buffer.metrics.push($e($e({},i),{},{$current_url:a,$session_id:o.sessionId,$window_id:o.windowId,timestamp:Date.now()})),r.buffer.metrics.length===4&&r._flushToCapture()))}})),be(this,"_startCapturing",(function(){var i=ar.postHogWebVitalsCallbacks,s=i.onLCP,o=i.onCLS,a=i.onFCP,c=i.onINP;s&&o&&a&&c?(s(r._addToBuffer),o(r._addToBuffer),a(r._addToBuffer),c(r._addToBuffer),r._initialized=!0):Te.error(Yh+"web vitals callbacks not loaded - not starting")})),this.instance=e,this._enabledServerSide=!((n=this.instance.persistence)===null||n===void 0||!n.props[xG]),this.startIfEnabled()}return un(t,[{key:"_maxAllowedValue",get:function(){var e=Zi(this.instance.config.capture_performance)&&La(this.instance.config.capture_performance.__web_vitals_max_value)?this.instance.config.capture_performance.__web_vitals_max_value:az;return 0<e&&e<=6e4?az:e}},{key:"isEnabled",get:function(){var e=Zi(this.instance.config.capture_performance)?this.instance.config.capture_performance.web_vitals:void 0;return fp(e)?e:this._enabledServerSide}},{key:"startIfEnabled",value:function(){this.isEnabled&&!this._initialized&&(Te.info(Yh+" enabled, starting..."),this.loadScript(this._startCapturing))}},{key:"afterDecideResponse",value:function(e){var n=Zi(e.capturePerformance)&&!!e.capturePerformance.web_vitals;this.instance.persistence&&this.instance.persistence.register(be({},xG,n)),this._enabledServerSide=n,this.startIfEnabled()}},{key:"loadScript",value:function(e){ce.postHogWebVitalsCallbacks&&e(),this.instance.requestRouter.loadScript("/static/web-vitals.js?v=".concat(Aa.LIB_VERSION),(function(n){n?Te.error(Yh+" failed to load script",n):e()}))}},{key:"_currentURL",value:function(){var e=ce?ce.location.href:void 0;return e||Te.error(Yh+"Could not determine current URL"),e}}]),t})(),cz="/e/",rVe=(function(){function t(e){var n;ln(this,t),this.instance=e,this._endpointSuffix=((n=this.instance.persistence)===null||n===void 0?void 0:n.props[IG])||cz}return un(t,[{key:"endpoint",get:function(){return this.instance.requestRouter.endpointFor("api",this._endpointSuffix)}},{key:"afterDecideResponse",value:function(e){var n=e.autocaptureExceptions;this._endpointSuffix=Zi(n)&&n.endpoint||cz,this.instance.persistence&&this.instance.persistence.register(be({},IG,this._endpointSuffix))}},{key:"sendExceptionEvent",value:function(e){this.instance.capture("$exception",e,{_noTruncate:!0,_batchKey:"exceptionEvent",_url:this.endpoint})}}]),t})(),fb={},lz=function(){},Og="posthog",dle=!Pqe&&Li?.indexOf("MSIE")===-1&&Li?.indexOf("Mozilla")===-1,uz=function(){var t,e,n;return{api_host:"https://us.i.posthog.com",ui_host:null,token:"",autocapture:!0,rageclick:!0,cross_subdomain_cookie:(e=Ge?.location,n=e?.hostname,!!hs(n)&&n.split(".").slice(-2).join(".")!=="herokuapp.com"),persistence:"localStorage+cookie",persistence_name:"",loaded:lz,store_google:!0,custom_campaign_params:[],custom_blocked_useragents:[],save_referrer:!0,capture_pageview:!0,capture_pageleave:"if_capture_pageview",debug:eo&&hs(eo?.search)&&eo.search.indexOf("__posthog_debug=true")!==-1||!1,verbose:!1,cookie_expiration:365,upgrade:!1,disable_session_recording:!1,disable_persistence:!1,disable_surveys:!1,enable_recording_console_log:void 0,secure_cookie:(ce==null||(t=ce.location)===null||t===void 0?void 0:t.protocol)==="https:",ip:!0,opt_out_capturing_by_default:!1,opt_out_persistence_by_default:!1,opt_out_useragent_filter:!1,opt_out_capturing_persistence_type:"localStorage",opt_out_capturing_cookie_prefix:null,opt_in_site_apps:!1,property_denylist:[],respect_dnt:!1,sanitize_properties:null,request_headers:{},inapp_protocol:"//",inapp_link_new_window:!1,request_batching:!0,properties_string_max_length:65535,session_recording:{},mask_all_element_attributes:!1,mask_all_text:!1,advanced_disable_decide:!1,advanced_disable_feature_flags:!1,advanced_disable_feature_flags_on_first_load:!1,advanced_disable_toolbar_metrics:!1,feature_flag_request_timeout_ms:3e3,on_request_error:function(r){var i="Bad HTTP status: "+r.statusCode+" "+r.text;Te.error(i)},get_device_id:function(r){return r},_onCapture:lz,capture_performance:void 0,name:"posthog",bootstrap:{},disable_compression:!1,session_idle_timeout_seconds:1800,person_profiles:"always",__add_tracing_headers:!1}},dz=function(t){var e={};st(t.process_person)||(e.person_profiles=t.process_person),st(t.xhr_headers)||(e.request_headers=t.xhr_headers),st(t.cookie_name)||(e.persistence_name=t.cookie_name),st(t.disable_cookie)||(e.disable_persistence=t.disable_cookie);var n=Os({},e,t);return yi(t.property_blacklist)&&(st(t.property_denylist)?n.property_denylist=t.property_blacklist:yi(t.property_denylist)?n.property_denylist=[].concat(Wu(t.property_blacklist),Wu(t.property_denylist)):Te.error("Invalid value for property_denylist config: "+t.property_denylist)),n},iVe=(function(){function t(){ln(this,t),be(this,"__forceAllowLocalhost",!1)}return un(t,[{key:"_forceAllowLocalhost",get:function(){return this.__forceAllowLocalhost},set:function(e){Te.error("WebPerformanceObserver is deprecated and has no impact on network capture. Use `_forceAllowLocalhostNetworkCapture` on `posthog.sessionRecording`"),this.__forceAllowLocalhost=e}}]),t})(),fle=(function(){function t(){var e=this;ln(this,t),be(this,"webPerformance",new iVe),be(this,"version",Aa.LIB_VERSION),be(this,"_internalEventEmitter",new lle),this.config=uz(),this.decideEndpointWasHit=!1,this.SentryIntegration=$qe,this.sentryIntegration=function(n){return(function(r,i){var s=cle(r,i);return{name:ale,processEvent:function(o){return s(o)}}})(e,n)},this.__request_queue=[],this.__loaded=!1,this.analyticsDefaultEndpoint="/e/",this._initialPageviewCaptured=!1,this.featureFlags=new NHe(this),this.toolbar=new Cqe(this),this.scrollManager=new Jqe(this),this.pageViewManager=new Hqe(this),this.surveys=new Kqe(this),this.exceptions=new rVe(this),this.rateLimiter=new Gqe(this),this.requestRouter=new Fqe(this),this.consent=new eVe(this),this.people={set:function(n,r,i){var s=hs(n)?be({},n,r):n;e.setPersonProperties(s),i?.({})},set_once:function(n,r,i){var s=hs(n)?be({},n,r):n;e.setPersonProperties(void 0,s),i?.({})}},this.on("eventCaptured",(function(n){return Te.info("send",n)}))}return un(t,[{key:"init",value:function(e,n,r){if(r&&r!==Og){var i,s=(i=fb[r])!==null&&i!==void 0?i:new t;return s._init(e,n,r),fb[r]=s,fb[Og][r]=s,s}return this._init(e,n,r)}},{key:"_init",value:function(e){var n,r,i=this,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;if(st(e)||_G(e))return Te.critical("PostHog was initialized without a token. This likely indicates a misconfiguration. Please check the first argument passed to posthog.init()"),this;if(this.__loaded)return Te.warn("You have already initialized PostHog! Re-initializing is a no-op"),this;this.__loaded=!0,this.config={},this._triggered_notifs=[],this.set_config(Os({},uz(),dz(s),{name:o,token:e})),this.config.on_xhr_error&&Te.error("[posthog] on_xhr_error is deprecated. Use on_request_error instead"),this.compression=s.disable_compression?void 0:Ic.GZipJS,this.persistence=new K6(this.config),this.sessionPersistence=this.config.persistence==="sessionStorage"?this.persistence:new K6($e($e({},this.config),{},{persistence:"sessionStorage"}));var a=$e({},this.persistence.props),c=$e({},this.sessionPersistence.props);if(this._requestQueue=new Tqe((function(R){return i._send_retriable_request(R)})),this._retryQueue=new Uqe(this),this.__request_queue=[],this.sessionManager=new jqe(this.config,this.persistence),this.sessionPropsManager=new Wqe(this.sessionManager,this.persistence),new Zqe(this).startIfEnabledOrStop(),this.sessionRecording=new Sqe(this),this.sessionRecording.startIfEnabledOrStop(),this.config.disable_scroll_properties||this.scrollManager.startMeasuringScrollPosition(),this.autocapture=new Qqe(this),this.autocapture.startIfEnabled(),this.surveys.loadIfEnabled(),this.heatmaps=new Xqe(this),this.heatmaps.startIfEnabled(),this.webVitalsAutocapture=new nVe(this),this.exceptionObserver=new tVe(this),this.exceptionObserver.startIfEnabled(),Aa.DEBUG=Aa.DEBUG||this.config.debug,Aa.DEBUG&&Te.info("Starting in debug mode",{this:this,config:s,thisC:$e({},this.config),p:a,s:c}),this._sync_opt_out_with_persistence(),((n=s.bootstrap)===null||n===void 0?void 0:n.distinctID)!==void 0){var l,d,h=this.config.get_device_id(Cf()),m=(l=s.bootstrap)!==null&&l!==void 0&&l.isIdentifiedID?h:s.bootstrap.distinctID;this.persistence.set_property(wu,(d=s.bootstrap)!==null&&d!==void 0&&d.isIdentifiedID?"identified":"anonymous"),this.register({distinct_id:s.bootstrap.distinctID,$device_id:m})}if(this._hasBootstrappedFeatureFlags()){var g,y,v=Object.keys(((g=s.bootstrap)===null||g===void 0?void 0:g.featureFlags)||{}).filter((function(R){var x,C;return!((x=s.bootstrap)===null||x===void 0||(C=x.featureFlags)===null||C===void 0||!C[R])})).reduce((function(R,x){var C,k;return R[x]=((C=s.bootstrap)===null||C===void 0||(k=C.featureFlags)===null||k===void 0?void 0:k[x])||!1,R}),{}),E=Object.keys(((y=s.bootstrap)===null||y===void 0?void 0:y.featureFlagPayloads)||{}).filter((function(R){return v[R]})).reduce((function(R,x){var C,k,T,L;return(C=s.bootstrap)!==null&&C!==void 0&&(k=C.featureFlagPayloads)!==null&&k!==void 0&&k[x]&&(R[x]=(T=s.bootstrap)===null||T===void 0||(L=T.featureFlagPayloads)===null||L===void 0?void 0:L[x]),R}),{});this.featureFlags.receivedFeatureFlags({featureFlags:v,featureFlagPayloads:E})}if(!this.get_distinct_id()){var w=this.config.get_device_id(Cf());this.register_once({distinct_id:w,$device_id:w},""),this.persistence.set_property(wu,"anonymous")}return ce==null||(r=ce.addEventListener)===null||r===void 0||r.call(ce,"onpagehide"in self?"pagehide":"unload",this._handle_unload.bind(this)),this.toolbar.maybeLoadToolbar(),s.segment?Bqe(this,(function(){return i._loaded()})):this._loaded(),Fa(this.config._onCapture)&&this.on("eventCaptured",(function(R){return i.config._onCapture(R.event,R)})),this}},{key:"_afterDecideResponse",value:function(e){var n,r,i,s,o,a,c,l;this.compression=void 0,e.supportedCompression&&!this.config.disable_compression&&(this.compression=Wt(e.supportedCompression,Ic.GZipJS)?Ic.GZipJS:Wt(e.supportedCompression,Ic.Base64)?Ic.Base64:void 0),(n=e.analytics)!==null&&n!==void 0&&n.endpoint&&(this.analyticsDefaultEndpoint=e.analytics.endpoint),(r=this.sessionRecording)===null||r===void 0||r.afterDecideResponse(e),(i=this.autocapture)===null||i===void 0||i.afterDecideResponse(e),(s=this.heatmaps)===null||s===void 0||s.afterDecideResponse(e),(o=this.surveys)===null||o===void 0||o.afterDecideResponse(e),(a=this.webVitalsAutocapture)===null||a===void 0||a.afterDecideResponse(e),(c=this.exceptions)===null||c===void 0||c.afterDecideResponse(e),(l=this.exceptionObserver)===null||l===void 0||l.afterDecideResponse(e)}},{key:"_loaded",value:function(){var e=this,n=this.config.advanced_disable_decide;n||this.featureFlags.setReloadingPaused(!0);try{this.config.loaded(this)}catch(r){Te.critical("`loaded` function failed",r)}this._start_queue_if_opted_in(),this.config.capture_pageview&&setTimeout((function(){e.consent.isOptedIn()&&e._captureInitialPageview()}),1),n||(new wqe(this).call(),this.featureFlags.resetRequestQueue())}},{key:"_start_queue_if_opted_in",value:function(){var e;this.has_opted_out_capturing()||this.config.request_batching&&((e=this._requestQueue)===null||e===void 0||e.enable())}},{key:"_dom_loaded",value:function(){var e=this;this.has_opted_out_capturing()||fv(this.__request_queue,(function(n){return e._send_retriable_request(n)})),this.__request_queue=[],this._start_queue_if_opted_in()}},{key:"_handle_unload",value:function(){var e,n;this.config.request_batching?(this._shouldCapturePageleave()&&this.capture("$pageleave"),(e=this._requestQueue)===null||e===void 0||e.unload(),(n=this._retryQueue)===null||n===void 0||n.unload()):this._shouldCapturePageleave()&&this.capture("$pageleave",null,{transport:"sendBeacon"})}},{key:"_send_request",value:function(e){var n=this;this.__loaded&&(dle?this.__request_queue.push(e):this.rateLimiter.isServerRateLimited(e.batchKey)||(e.transport=e.transport||this.config.api_transport,e.url=F3(e.url,{ip:this.config.ip?1:0}),e.headers=$e({},this.config.request_headers),e.compression=e.compression==="best-available"?this.compression:e.compression,(function(r){var i,s,o,a=$e({},r);a.timeout=a.timeout||6e4,a.url=F3(a.url,{_:new Date().getTime().toString(),ver:Aa.LIB_VERSION,compression:a.compression});var c=(i=a.transport)!==null&&i!==void 0?i:"XHR",l=(s=(o=Ace(db,(function(d){return d.transport===c})))===null||o===void 0?void 0:o.method)!==null&&s!==void 0?s:db[0].method;if(!l)throw new Error("No available transport method");l(a)})($e($e({},e),{},{callback:function(r){var i,s,o;n.rateLimiter.checkForLimiting(r),r.statusCode>=400&&((s=(o=n.config).on_request_error)===null||s===void 0||s.call(o,r)),(i=e.callback)===null||i===void 0||i.call(e,r)}}))))}},{key:"_send_retriable_request",value:function(e){this._retryQueue?this._retryQueue.retriableRequest(e):this._send_request(e)}},{key:"_execute_array",value:function(e){var n,r=this,i=[],s=[],o=[];fv(e,(function(c){c&&(n=c[0],yi(n)?o.push(c):Fa(c)?c.call(r):yi(c)&&n==="alias"?i.push(c):yi(c)&&n.indexOf("capture")!==-1&&Fa(r[n])?o.push(c):s.push(c))}));var a=function(c,l){fv(c,(function(d){if(yi(d[0])){var h=l;Nn(d,(function(m){h=h[m[0]].apply(h,m.slice(1))}))}else this[d[0]].apply(this,d.slice(1))}),l)};a(i,this),a(s,this),a(o,this)}},{key:"_hasBootstrappedFeatureFlags",value:function(){var e,n;return((e=this.config.bootstrap)===null||e===void 0?void 0:e.featureFlags)&&Object.keys((n=this.config.bootstrap)===null||n===void 0?void 0:n.featureFlags).length>0||!1}},{key:"push",value:function(e){this._execute_array([e])}},{key:"capture",value:function(e,n,r){var i;if(this.__loaded&&this.persistence&&this.sessionPersistence&&this._requestQueue){if(!this.consent.isOptedOut())if(!st(e)&&hs(e)){if(this.config.opt_out_useragent_filter||!this._is_bot()){var s=r!=null&&r.skip_client_rate_limiting?void 0:this.rateLimiter.clientRateLimitContext();if(s==null||!s.isRateLimited){this.sessionPersistence.update_search_keyword(),this.config.store_google&&this.sessionPersistence.update_campaign_params(),this.config.save_referrer&&this.sessionPersistence.update_referrer_info(),(this.config.store_google||this.config.save_referrer)&&this.persistence.set_initial_person_info();var o=new Date,a=r?.timestamp||o,c={uuid:Cf(),event:e,properties:this._calculate_event_properties(e,n||{},a)};s&&(c.properties.$lib_rate_limit_remaining_tokens=s.remainingTokens),r?.$set&&(c.$set=r?.$set);var l=this._calculate_set_once_properties(r?.$set_once);l&&(c.$set_once=l),(c=OHe(c,r!=null&&r._noTruncate?null:this.config.properties_string_max_length)).timestamp=a,st(r?.timestamp)||(c.properties.$event_time_override_provided=!0,c.properties.$event_time_override_system_time=o);var d=$e($e({},c.properties.$set),c.$set);tC(d)||this.setPersonPropertiesForFlags(d),this._internalEventEmitter.emit("eventCaptured",c);var h={method:"POST",url:(i=r?._url)!==null&&i!==void 0?i:this.requestRouter.endpointFor("api",this.analyticsDefaultEndpoint),data:c,compression:"best-available",batchKey:r?._batchKey};return!this.config.request_batching||r&&(r==null||!r._batchKey)||r!=null&&r.send_instantly?this._send_retriable_request(h):this._requestQueue.enqueue(h),c}Te.critical("This capture call is ignored due to client rate limiting.")}}else Te.error("No event name provided to posthog.capture")}else Te.uninitializedWarning("posthog.capture")}},{key:"_addCaptureHook",value:function(e){this.on("eventCaptured",(function(n){return e(n.event,n)}))}},{key:"_calculate_event_properties",value:function(e,n,r){if(r=r||new Date,!this.persistence||!this.sessionPersistence)return n;var i=this.persistence.remove_event_timer(e),s=$e({},n);if(s.token=this.config.token,e==="$snapshot"){var o=$e($e({},this.persistence.properties()),this.sessionPersistence.properties());return s.distinct_id=o.distinct_id,(!hs(s.distinct_id)&&!La(s.distinct_id)||_G(s.distinct_id))&&Te.error("Invalid distinct_id for replay event. This indicates a bug in your implementation"),s}var a=Mi.properties();if(this.sessionManager){var c=this.sessionManager.checkAndGetSessionAndWindowId(),l=c.sessionId,d=c.windowId;s.$session_id=l,s.$window_id=d}if(this.requestRouter.region===hp.CUSTOM&&(s.$lib_custom_api_host=this.config.api_host),this.sessionPropsManager&&this.config.__preview_send_client_session_params&&(e==="$pageview"||e==="$pageleave"||e==="$autocapture")){var h=this.sessionPropsManager.getSessionProps();s=Os(s,h)}if(!this.config.disable_scroll_properties){var m={};e==="$pageview"?m=this.pageViewManager.doPageView(r):e==="$pageleave"&&(m=this.pageViewManager.doPageLeave(r)),s=Os(s,m)}if(e==="$pageview"&&Ge&&(s.title=Ge.title),!st(i)){var g=r.getTime()-i;s.$duration=parseFloat((g/1e3).toFixed(3))}Li&&this.config.opt_out_useragent_filter&&(s.$browser_type=this._is_bot()?"bot":"browser"),(s=Os({},a,this.persistence.properties(),this.sessionPersistence.properties(),s)).$is_identified=this._isIdentified(),yi(this.config.property_denylist)?Nn(this.config.property_denylist,(function(v){delete s[v]})):Te.error("Invalid value for property_denylist config: "+this.config.property_denylist+" or property_blacklist config: "+this.config.property_blacklist);var y=this.config.sanitize_properties;return y&&(s=y(s,e)),s.$process_person_profile=this._hasPersonProcessing(),s}},{key:"_calculate_set_once_properties",value:function(e){if(!this.persistence||!this._hasPersonProcessing())return e;var n=Os({},this.persistence.get_initial_props(),e||{});return tC(n)?void 0:n}},{key:"register",value:function(e,n){var r;(r=this.persistence)===null||r===void 0||r.register(e,n)}},{key:"register_once",value:function(e,n,r){var i;(i=this.persistence)===null||i===void 0||i.register_once(e,n,r)}},{key:"register_for_session",value:function(e){var n;(n=this.sessionPersistence)===null||n===void 0||n.register(e)}},{key:"unregister",value:function(e){var n;(n=this.persistence)===null||n===void 0||n.unregister(e)}},{key:"unregister_for_session",value:function(e){var n;(n=this.sessionPersistence)===null||n===void 0||n.unregister(e)}},{key:"_register_single",value:function(e,n){this.register(be({},e,n))}},{key:"getFeatureFlag",value:function(e,n){return this.featureFlags.getFeatureFlag(e,n)}},{key:"getFeatureFlagPayload",value:function(e){var n=this.featureFlags.getFeatureFlagPayload(e);try{return JSON.parse(n)}catch{return n}}},{key:"isFeatureEnabled",value:function(e,n){return this.featureFlags.isFeatureEnabled(e,n)}},{key:"reloadFeatureFlags",value:function(){this.featureFlags.reloadFeatureFlags()}},{key:"updateEarlyAccessFeatureEnrollment",value:function(e,n){this.featureFlags.updateEarlyAccessFeatureEnrollment(e,n)}},{key:"getEarlyAccessFeatures",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return this.featureFlags.getEarlyAccessFeatures(e,n)}},{key:"on",value:function(e,n){return this._internalEventEmitter.on(e,n)}},{key:"onFeatureFlags",value:function(e){return this.featureFlags.onFeatureFlags(e)}},{key:"onSessionId",value:function(e){var n,r;return(n=(r=this.sessionManager)===null||r===void 0?void 0:r.onSessionId(e))!==null&&n!==void 0?n:function(){}}},{key:"getSurveys",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this.surveys.getSurveys(e,n)}},{key:"getActiveMatchingSurveys",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this.surveys.getActiveMatchingSurveys(e,n)}},{key:"renderSurvey",value:function(e,n){this.surveys.renderSurvey(e,n)}},{key:"canRenderSurvey",value:function(e){this.surveys.canRenderSurvey(e)}},{key:"getNextSurveyStep",value:function(e,n,r){return this.surveys.getNextSurveyStep(e,n,r)}},{key:"identify",value:function(e,n,r){if(!this.__loaded||!this.persistence)return Te.uninitializedWarning("posthog.identify");if(La(e)&&(e=e.toString(),Te.warn("The first argument to posthog.identify was a number, but it should be a string. It has been converted to a string.")),e){if(["distinct_id","distinctid"].includes(e.toLowerCase()))Te.critical('The string "'.concat(e,'" was set in posthog.identify which indicates an error. This ID should be unique to the user and not a hardcoded string.'));else if(this._requirePersonProcessing("posthog.identify")){var i=this.get_distinct_id();if(this.register({$user_id:e}),!this.get_property("$device_id")){var s=i;this.register_once({$had_persisted_distinct_id:!0,$device_id:s},"")}e!==i&&e!==this.get_property(O1)&&(this.unregister(O1),this.register({distinct_id:e}));var o=(this.persistence.get_property(wu)||"anonymous")==="anonymous";e!==i&&o?(this.persistence.set_property(wu,"identified"),this.setPersonPropertiesForFlags(n||{},!1),this.capture("$identify",{distinct_id:e,$anon_distinct_id:i},{$set:n||{},$set_once:r||{}}),this.featureFlags.setAnonymousDistinctId(i)):(n||r)&&this.setPersonProperties(n,r),e!==i&&(this.reloadFeatureFlags(),this.unregister(L3))}}else Te.error("Unique user id has not been set in posthog.identify")}},{key:"setPersonProperties",value:function(e,n){(e||n)&&this._requirePersonProcessing("posthog.setPersonProperties")&&(this.setPersonPropertiesForFlags(e||{}),this.capture("$set",{$set:e||{},$set_once:n||{}}))}},{key:"group",value:function(e,n,r){if(e&&n){if(this._requirePersonProcessing("posthog.group")){var i=this.getGroups();i[e]!==n&&this.resetGroupPropertiesForFlags(e),this.register({$groups:$e($e({},i),{},be({},e,n))}),r&&(this.capture("$groupidentify",{$group_type:e,$group_key:n,$group_set:r}),this.setGroupPropertiesForFlags(be({},e,r))),i[e]===n||r||this.reloadFeatureFlags()}}else Te.error("posthog.group requires a group type and group key")}},{key:"resetGroups",value:function(){this.register({$groups:{}}),this.resetGroupPropertiesForFlags(),this.reloadFeatureFlags()}},{key:"setPersonPropertiesForFlags",value:function(e){var n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];this._requirePersonProcessing("posthog.setPersonPropertiesForFlags")&&this.featureFlags.setPersonPropertiesForFlags(e,n)}},{key:"resetPersonPropertiesForFlags",value:function(){this.featureFlags.resetPersonPropertiesForFlags()}},{key:"setGroupPropertiesForFlags",value:function(e){var n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];this._requirePersonProcessing("posthog.setGroupPropertiesForFlags")&&this.featureFlags.setGroupPropertiesForFlags(e,n)}},{key:"resetGroupPropertiesForFlags",value:function(e){this.featureFlags.resetGroupPropertiesForFlags(e)}},{key:"reset",value:function(e){var n,r,i,s;if(Te.info("reset"),!this.__loaded)return Te.uninitializedWarning("posthog.reset");var o=this.get_property("$device_id");this.consent.reset(),(n=this.persistence)===null||n===void 0||n.clear(),(r=this.sessionPersistence)===null||r===void 0||r.clear(),(i=this.persistence)===null||i===void 0||i.set_property(wu,"anonymous"),(s=this.sessionManager)===null||s===void 0||s.resetSessionId();var a=this.config.get_device_id(Cf());this.register_once({distinct_id:a,$device_id:e?a:o},"")}},{key:"get_distinct_id",value:function(){return this.get_property("distinct_id")}},{key:"getGroups",value:function(){return this.get_property("$groups")||{}}},{key:"get_session_id",value:function(){var e,n;return(e=(n=this.sessionManager)===null||n===void 0?void 0:n.checkAndGetSessionAndWindowId(!0).sessionId)!==null&&e!==void 0?e:""}},{key:"get_session_replay_url",value:function(e){if(!this.sessionManager)return"";var n=this.sessionManager.checkAndGetSessionAndWindowId(!0),r=n.sessionId,i=n.sessionStartTimestamp,s=this.requestRouter.endpointFor("ui","/project/".concat(this.config.token,"/replay/").concat(r));if(e!=null&&e.withTimestamp&&i){var o,a=(o=e.timestampLookBack)!==null&&o!==void 0?o:10;if(!i)return s;var c=Math.max(Math.floor((new Date().getTime()-i)/1e3)-a,0);s+="?t=".concat(c)}return s}},{key:"alias",value:function(e,n){return e===this.get_property(Lce)?(Te.critical("Attempting to create alias for existing People user - aborting."),-2):this._requirePersonProcessing("posthog.alias")?(st(n)&&(n=this.get_distinct_id()),e!==n?(this._register_single(O1,e),this.capture("$create_alias",{alias:e,distinct_id:n})):(Te.warn("alias matches current distinct_id - skipping api call."),this.identify(e),-1)):void 0}},{key:"set_config",value:function(e){var n,r,i,s,o=$e({},this.config);Zi(e)&&(Os(this.config,dz(e)),(n=this.persistence)===null||n===void 0||n.update_config(this.config,o),this.sessionPersistence=this.config.persistence==="sessionStorage"?this.persistence:new K6($e($e({},this.config),{},{persistence:"sessionStorage"})),gi.is_supported()&&gi.get("ph_debug")==="true"&&(this.config.debug=!0),this.config.debug&&(Aa.DEBUG=!0,Te.info("set_config",{config:e,oldConfig:o,newConfig:$e({},this.config)})),(r=this.sessionRecording)===null||r===void 0||r.startIfEnabledOrStop(),(i=this.autocapture)===null||i===void 0||i.startIfEnabled(),(s=this.heatmaps)===null||s===void 0||s.startIfEnabled(),this.surveys.loadIfEnabled(),this._sync_opt_out_with_persistence())}},{key:"startSessionRecording",value:function(e){var n,r=fp(e)&&e;if(r||e!=null&&e.sampling){var i,s,o=(i=this.sessionManager)===null||i===void 0?void 0:i.checkAndGetSessionAndWindowId();(s=this.persistence)===null||s===void 0||s.register(be({},cb,!0)),Te.info("Session recording started with sampling override for session: ",o?.sessionId)}(r||e!=null&&e.linked_flag)&&((n=this.sessionRecording)===null||n===void 0||n.overrideLinkedFlag(),Te.info("Session recording started with linked_flags override")),this.set_config({disable_session_recording:!1})}},{key:"stopSessionRecording",value:function(){this.set_config({disable_session_recording:!0})}},{key:"sessionRecordingStarted",value:function(){var e;return!((e=this.sessionRecording)===null||e===void 0||!e.started)}},{key:"captureException",value:function(e,n){var r=Fa(ar.parseErrorAsProperties)?ar.parseErrorAsProperties([e.message,void 0,void 0,void 0,e]):$e({$exception_type:e.name,$exception_message:e.message,$exception_level:"error"},n);this.exceptions.sendExceptionEvent(r)}},{key:"loadToolbar",value:function(e){return this.toolbar.loadToolbar(e)}},{key:"get_property",value:function(e){var n;return(n=this.persistence)===null||n===void 0?void 0:n.props[e]}},{key:"getSessionProperty",value:function(e){var n;return(n=this.sessionPersistence)===null||n===void 0?void 0:n.props[e]}},{key:"toString",value:function(){var e,n=(e=this.config.name)!==null&&e!==void 0?e:Og;return n!==Og&&(n=Og+"."+n),n}},{key:"_isIdentified",value:function(){var e,n;return((e=this.persistence)===null||e===void 0?void 0:e.get_property(wu))==="identified"||((n=this.sessionPersistence)===null||n===void 0?void 0:n.get_property(wu))==="identified"}},{key:"_hasPersonProcessing",value:function(){var e,n,r,i;return!(this.config.person_profiles==="never"||this.config.person_profiles==="identified_only"&&!this._isIdentified()&&tC(this.getGroups())&&((e=this.persistence)===null||e===void 0||(n=e.props)===null||n===void 0||!n[O1])&&((r=this.persistence)===null||r===void 0||(i=r.props)===null||i===void 0||!i[M3]))}},{key:"_shouldCapturePageleave",value:function(){return this.config.capture_pageleave===!0||this.config.capture_pageleave==="if_capture_pageview"&&this.config.capture_pageview}},{key:"createPersonProfile",value:function(){this._hasPersonProcessing()||this._requirePersonProcessing("posthog.createPersonProfile")&&this.setPersonProperties({},{})}},{key:"_requirePersonProcessing",value:function(e){return this.config.person_profiles==="never"?(Te.error(e+' was called, but process_person is set to "never". This call will be ignored.'),!1):(this._register_single(M3,!0),!0)}},{key:"_sync_opt_out_with_persistence",value:function(){var e,n,r,i,s=this.consent.isOptedOut(),o=this.config.opt_out_persistence_by_default,a=this.config.disable_persistence||s&&!!o;((e=this.persistence)===null||e===void 0?void 0:e.disabled)!==a&&((r=this.persistence)===null||r===void 0||r.set_disabled(a)),((n=this.sessionPersistence)===null||n===void 0?void 0:n.disabled)!==a&&((i=this.sessionPersistence)===null||i===void 0||i.set_disabled(a))}},{key:"opt_in_capturing",value:function(e){var n;this.consent.optInOut(!0),this._sync_opt_out_with_persistence(),(st(e?.captureEventName)||e!=null&&e.captureEventName)&&this.capture((n=e?.captureEventName)!==null&&n!==void 0?n:"$opt_in",e?.captureProperties,{send_instantly:!0}),this.config.capture_pageview&&this._captureInitialPageview()}},{key:"opt_out_capturing",value:function(){this.consent.optInOut(!1),this._sync_opt_out_with_persistence()}},{key:"has_opted_in_capturing",value:function(){return this.consent.isOptedIn()}},{key:"has_opted_out_capturing",value:function(){return this.consent.isOptedOut()}},{key:"clear_opt_in_out_capturing",value:function(){this.consent.reset(),this._sync_opt_out_with_persistence()}},{key:"_is_bot",value:function(){return Ac?(function(e,n){if(!e)return!1;var r=e.userAgent;if(r&&sz(r,n))return!0;try{var i=e?.userAgentData;if(i!=null&&i.brands&&i.brands.some((function(s){return sz(s?.brand,n)})))return!0}catch{}return!!e.webdriver})(Ac,this.config.custom_blocked_useragents):void 0}},{key:"_captureInitialPageview",value:function(){Ge&&!this._initialPageviewCaptured&&(this._initialPageviewCaptured=!0,this.capture("$pageview",{title:Ge.title},{send_instantly:!0}))}},{key:"debug",value:function(e){e===!1?(ce?.console.log("You've disabled debug mode."),localStorage&&localStorage.removeItem("ph_debug"),this.set_config({debug:!1})):(ce?.console.log("You're now in debug mode. All calls to PostHog will be logged in your console.\nYou can disable this with `posthog.debug(false)`."),localStorage&&localStorage.setItem("ph_debug","true"),this.set_config({debug:!0}))}}]),t})();(function(t,e){for(var n=0;n<e.length;n++)t.prototype[e[n]]=MHe(t.prototype[e[n]])})(fle,["identify"]);var fz,sVe=(fz=fb[Og]=new fle,(function(){function t(){t.done||(t.done=!0,dle=!1,Nn(fb,(function(e){e._dom_loaded()})))}Ge!=null&&Ge.addEventListener&&(Ge.readyState==="complete"?t():Ge.addEventListener("DOMContentLoaded",t,!1)),ce&&Nu(ce,"load",t,!0)})(),fz);class oVe{constructor(){this.cache={startTime:new Date(0),maxParticipantsCount:0}}cacheStartCall(e){this.cache.startTime=e}cacheParticipantCountChanged(e){this.cache.maxParticipantsCount=Math.max(e,this.cache.maxParticipantsCount)}track(e,n,r,i){en.instance.trackEvent({eventName:"CallEnded",callId:e,callParticipantsMax:this.cache.maxParticipantsCount,callParticipantsOnLeave:n,callDuration:(Date.now()-this.cache.startTime.getTime())/1e3,roomEventEncryptionKeysSent:i.statistics.counters.roomEventEncryptionKeysSent,roomEventEncryptionKeysReceived:i.statistics.counters.roomEventEncryptionKeysReceived,roomEventEncryptionKeysReceivedAverageAge:i.statistics.counters.roomEventEncryptionKeysReceived>0?i.statistics.totals.roomEventEncryptionKeysReceivedTotalAge/i.statistics.counters.roomEventEncryptionKeysReceived:0},{send_instantly:r})}}class aVe{track(e){en.instance.trackEvent({eventName:"CallStarted",callId:e})}}class cVe{constructor(){this.cache={signupStart:new Date(0),signupEnd:new Date(0)}}cacheSignupStart(e){this.cache.signupStart=e}getSignupEndTime(){return this.cache.signupEnd}cacheSignupEnd(e){this.cache.signupEnd=e}track(){en.instance.trackEvent({eventName:"Signup",signupDuration:Date.now()-this.cache.signupStart.getTime()}),en.instance.setRegistrationType(UR.Registered)}}class lVe{track(){en.instance.trackEvent({eventName:"Login"}),en.instance.setRegistrationType(UR.Registered)}}class uVe{track(e,n){en.instance.trackEvent({eventName:"MuteMicrophone",targetMuteState:e?"mute":"unmute",callId:n})}}class dVe{track(e,n){en.instance.trackEvent({eventName:"MuteCamera",targetMuteState:e?"mute":"unmute",callId:n})}}class fVe{track(e){en.instance.trackEvent({eventName:"UndecryptableToDeviceEvent",callId:e})}}class hVe{track(e,n,r){en.instance.trackEvent({eventName:"QualitySurvey",callId:e,feedbackText:n,stars:r})}}class pVe{track(e){en.instance.trackEvent({eventName:"CallDisconnected",reason:e})}}class mVe{constructor(){this.connectStart=0,this.websocketConnected=0}cacheConnectStart(){this.connectStart=Date.now()}cacheWsConnect(){this.websocketConnected=Date.now()}track(e={log:!1}){const n=Date.now(),r=n-this.connectStart,i=this.websocketConnected-this.connectStart,s=n-this.websocketConnected;en.instance.trackEvent({eventName:"CallConnectDuration",totalDuration:r,websocketDuration:i,peerConnectionDuration:s}),e.log&&N.log(`Time to connect:
total: ${r}ms
peerConnection: ${i}ms
websocket: ${s}ms`)}}function An(t){return typeof t=="function"}function d9(t){var e=function(r){Error.call(r),r.stack=new Error().stack},n=t(e);return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}var J6=d9(function(t){return function(n){t(this),this.message=n?n.length+` errors occurred during unsubscription:
`+n.map(function(r,i){return i+1+") "+r.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=n}});function B3(t,e){if(t){var n=t.indexOf(e);0<=n&&t.splice(n,1)}}var dS=(function(){function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var e,n,r,i,s;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var a=Qf(o),c=a.next();!c.done;c=a.next()){var l=c.value;l.remove(this)}}catch(v){e={error:v}}finally{try{c&&!c.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}else o.remove(this);var d=this.initialTeardown;if(An(d))try{d()}catch(v){s=v instanceof J6?v.errors:[v]}var h=this._finalizers;if(h){this._finalizers=null;try{for(var m=Qf(h),g=m.next();!g.done;g=m.next()){var y=g.value;try{hz(y)}catch(v){s=s??[],v instanceof J6?s=ia(ia([],ra(s)),ra(v.errors)):s.push(v)}}}catch(v){r={error:v}}finally{try{g&&!g.done&&(i=m.return)&&i.call(m)}finally{if(r)throw r.error}}}if(s)throw new J6(s)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)hz(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(n=this._finalizers)!==null&&n!==void 0?n:[]).push(e)}},t.prototype._hasParent=function(e){var n=this._parentage;return n===e||Array.isArray(n)&&n.includes(e)},t.prototype._addParent=function(e){var n=this._parentage;this._parentage=Array.isArray(n)?(n.push(e),n):n?[n,e]:e},t.prototype._removeParent=function(e){var n=this._parentage;n===e?this._parentage=null:Array.isArray(n)&&B3(n,e)},t.prototype.remove=function(e){var n=this._finalizers;n&&B3(n,e),e instanceof t&&e._removeParent(this)},t.EMPTY=(function(){var e=new t;return e.closed=!0,e})(),t})(),hle=dS.EMPTY;function ple(t){return t instanceof dS||t&&"closed"in t&&An(t.remove)&&An(t.add)&&An(t.unsubscribe)}function hz(t){An(t)?t():t.unsubscribe()}var gVe={Promise:void 0},vVe={setTimeout:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setTimeout.apply(void 0,ia([t,e],ra(n)))},clearTimeout:function(t){return clearTimeout(t)},delegate:void 0};function mle(t){vVe.setTimeout(function(){throw t})}function Gv(){}function iC(t){t()}var f9=(function(t){$c(e,t);function e(n){var r=t.call(this)||this;return r.isStopped=!1,n?(r.destination=n,ple(n)&&n.add(r)):r.destination=_Ve,r}return e.create=function(n,r,i){return new zv(n,r,i)},e.prototype.next=function(n){this.isStopped||this._next(n)},e.prototype.error=function(n){this.isStopped||(this.isStopped=!0,this._error(n))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(n){this.destination.next(n)},e.prototype._error=function(n){try{this.destination.error(n)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e})(dS),yVe=(function(){function t(e){this.partialObserver=e}return t.prototype.next=function(e){var n=this.partialObserver;if(n.next)try{n.next(e)}catch(r){Hw(r)}},t.prototype.error=function(e){var n=this.partialObserver;if(n.error)try{n.error(e)}catch(r){Hw(r)}else Hw(e)},t.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(n){Hw(n)}},t})(),zv=(function(t){$c(e,t);function e(n,r,i){var s=t.call(this)||this,o;return An(n)||!n?o={next:n??void 0,error:r??void 0,complete:i??void 0}:o=n,s.destination=new yVe(o),s}return e})(f9);function Hw(t){mle(t)}function bVe(t){throw t}var _Ve={closed:!0,next:Gv,error:bVe,complete:Gv},h9=(function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"})();function mh(t){return t}function SVe(t){return t.length===0?mh:t.length===1?t[0]:function(n){return t.reduce(function(r,i){return i(r)},n)}}var nr=(function(){function t(e){e&&(this._subscribe=e)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(e,n,r){var i=this,s=EVe(e)?e:new zv(e,n,r);return iC(function(){var o=i,a=o.operator,c=o.source;s.add(a?a.call(s,c):c?i._subscribe(s):i._trySubscribe(s))}),s},t.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(n){e.error(n)}},t.prototype.forEach=function(e,n){var r=this;return n=pz(n),new n(function(i,s){var o=new zv({next:function(a){try{e(a)}catch(c){s(c),o.unsubscribe()}},error:s,complete:i});r.subscribe(o)})},t.prototype._subscribe=function(e){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(e)},t.prototype[h9]=function(){return this},t.prototype.pipe=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return SVe(e)(this)},t.prototype.toPromise=function(e){var n=this;return e=pz(e),new e(function(r,i){var s;n.subscribe(function(o){return s=o},function(o){return i(o)},function(){return r(s)})})},t.create=function(e){return new t(e)},t})();function pz(t){var e;return(e=t??gVe.Promise)!==null&&e!==void 0?e:Promise}function wVe(t){return t&&An(t.next)&&An(t.error)&&An(t.complete)}function EVe(t){return t&&t instanceof f9||wVe(t)&&ple(t)}function CVe(t){return An(t?.lift)}function _r(t){return function(e){if(CVe(e))return e.lift(function(n){try{return t(n,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function rr(t,e,n,r,i){return new TVe(t,e,n,r,i)}var TVe=(function(t){$c(e,t);function e(n,r,i,s,o,a){var c=t.call(this,n)||this;return c.onFinalize=o,c.shouldUnsubscribe=a,c._next=r?function(l){try{r(l)}catch(d){n.error(d)}}:t.prototype._next,c._error=s?function(l){try{s(l)}catch(d){n.error(d)}finally{this.unsubscribe()}}:t.prototype._error,c._complete=i?function(){try{i()}catch(l){n.error(l)}finally{this.unsubscribe()}}:t.prototype._complete,c}return e.prototype.unsubscribe=function(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;t.prototype.unsubscribe.call(this),!r&&((n=this.onFinalize)===null||n===void 0||n.call(this))}},e})(f9),RVe=d9(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),Ar=(function(t){$c(e,t);function e(){var n=t.call(this)||this;return n.closed=!1,n.currentObservers=null,n.observers=[],n.isStopped=!1,n.hasError=!1,n.thrownError=null,n}return e.prototype.lift=function(n){var r=new mz(this,this);return r.operator=n,r},e.prototype._throwIfClosed=function(){if(this.closed)throw new RVe},e.prototype.next=function(n){var r=this;iC(function(){var i,s;if(r._throwIfClosed(),!r.isStopped){r.currentObservers||(r.currentObservers=Array.from(r.observers));try{for(var o=Qf(r.currentObservers),a=o.next();!a.done;a=o.next()){var c=a.value;c.next(n)}}catch(l){i={error:l}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}}})},e.prototype.error=function(n){var r=this;iC(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=n;for(var i=r.observers;i.length;)i.shift().error(n)}})},e.prototype.complete=function(){var n=this;iC(function(){if(n._throwIfClosed(),!n.isStopped){n.isStopped=!0;for(var r=n.observers;r.length;)r.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var n;return((n=this.observers)===null||n===void 0?void 0:n.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(n){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,n)},e.prototype._subscribe=function(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)},e.prototype._innerSubscribe=function(n){var r=this,i=this,s=i.hasError,o=i.isStopped,a=i.observers;return s||o?hle:(this.currentObservers=null,a.push(n),new dS(function(){r.currentObservers=null,B3(a,n)}))},e.prototype._checkFinalizedStatuses=function(n){var r=this,i=r.hasError,s=r.thrownError,o=r.isStopped;i?n.error(s):o&&n.complete()},e.prototype.asObservable=function(){var n=new nr;return n.source=this,n},e.create=function(n,r){return new mz(n,r)},e})(nr),mz=(function(t){$c(e,t);function e(n,r){var i=t.call(this)||this;return i.destination=n,i.source=r,i}return e.prototype.next=function(n){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.next)===null||i===void 0||i.call(r,n)},e.prototype.error=function(n){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.error)===null||i===void 0||i.call(r,n)},e.prototype.complete=function(){var n,r;(r=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||r===void 0||r.call(n)},e.prototype._subscribe=function(n){var r,i;return(i=(r=this.source)===null||r===void 0?void 0:r.subscribe(n))!==null&&i!==void 0?i:hle},e})(Ar),mr=(function(t){$c(e,t);function e(n){var r=t.call(this)||this;return r._value=n,r}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(n){var r=t.prototype._subscribe.call(this,n);return!r.closed&&n.next(this._value),r},e.prototype.getValue=function(){var n=this,r=n.hasError,i=n.thrownError,s=n._value;if(r)throw i;return this._throwIfClosed(),s},e.prototype.next=function(n){t.prototype.next.call(this,this._value=n)},e})(Ar),kVe={now:function(){return Date.now()}},IVe=(function(t){$c(e,t);function e(n,r){return t.call(this)||this}return e.prototype.schedule=function(n,r){return this},e})(dS),gz={setInterval:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setInterval.apply(void 0,ia([t,e],ra(n)))},clearInterval:function(t){return clearInterval(t)},delegate:void 0},xVe=(function(t){$c(e,t);function e(n,r){var i=t.call(this,n,r)||this;return i.scheduler=n,i.work=r,i.pending=!1,i}return e.prototype.schedule=function(n,r){var i;if(r===void 0&&(r=0),this.closed)return this;this.state=n;var s=this.id,o=this.scheduler;return s!=null&&(this.id=this.recycleAsyncId(o,s,r)),this.pending=!0,this.delay=r,this.id=(i=this.id)!==null&&i!==void 0?i:this.requestAsyncId(o,this.id,r),this},e.prototype.requestAsyncId=function(n,r,i){return i===void 0&&(i=0),gz.setInterval(n.flush.bind(n,this),i)},e.prototype.recycleAsyncId=function(n,r,i){if(i===void 0&&(i=0),i!=null&&this.delay===i&&this.pending===!1)return r;r!=null&&gz.clearInterval(r)},e.prototype.execute=function(n,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(n,r);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(n,r){var i=!1,s;try{this.work(n)}catch(o){i=!0,s=o||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),s},e.prototype.unsubscribe=function(){if(!this.closed){var n=this,r=n.id,i=n.scheduler,s=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,B3(s,this),r!=null&&(this.id=this.recycleAsyncId(i,r,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e})(IVe),vz=(function(){function t(e,n){n===void 0&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(e,n,r){return n===void 0&&(n=0),new this.schedulerActionCtor(this,e).schedule(r,n)},t.now=kVe.now,t})(),AVe=(function(t){$c(e,t);function e(n,r){r===void 0&&(r=vz.now);var i=t.call(this,n,r)||this;return i.actions=[],i._active=!1,i}return e.prototype.flush=function(n){var r=this.actions;if(this._active){r.push(n);return}var i;this._active=!0;do if(i=n.execute(n.state,n.delay))break;while(n=r.shift());if(this._active=!1,i){for(;n=r.shift();)n.unsubscribe();throw i}},e})(vz),OR=new AVe(xVe),LVe=OR,p9=new nr(function(t){return t.complete()});function gle(t){return t&&An(t.schedule)}function m9(t){return t[t.length-1]}function vle(t){return An(m9(t))?t.pop():void 0}function fS(t){return gle(m9(t))?t.pop():void 0}function MVe(t,e){return typeof m9(t)=="number"?t.pop():e}var g9=(function(t){return t&&typeof t.length=="number"&&typeof t!="function"});function yle(t){return An(t?.then)}function ble(t){return An(t[h9])}function _le(t){return Symbol.asyncIterator&&An(t?.[Symbol.asyncIterator])}function Sle(t){return new TypeError("You provided "+(t!==null&&typeof t=="object"?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function OVe(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var wle=OVe();function Ele(t){return An(t?.[wle])}function Cle(t){return q7(this,arguments,function(){var n,r,i,s;return cR(this,function(o){switch(o.label){case 0:n=t.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,zu(n.read())];case 3:return r=o.sent(),i=r.value,s=r.done,s?[4,zu(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,zu(i)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return n.releaseLock(),[7];case 10:return[2]}})})}function Tle(t){return An(t?.getReader)}function Si(t){if(t instanceof nr)return t;if(t!=null){if(ble(t))return PVe(t);if(g9(t))return DVe(t);if(yle(t))return NVe(t);if(_le(t))return Rle(t);if(Ele(t))return UVe(t);if(Tle(t))return jVe(t)}throw Sle(t)}function PVe(t){return new nr(function(e){var n=t[h9]();if(An(n.subscribe))return n.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function DVe(t){return new nr(function(e){for(var n=0;n<t.length&&!e.closed;n++)e.next(t[n]);e.complete()})}function NVe(t){return new nr(function(e){t.then(function(n){e.closed||(e.next(n),e.complete())},function(n){return e.error(n)}).then(null,mle)})}function UVe(t){return new nr(function(e){var n,r;try{for(var i=Qf(t),s=i.next();!s.done;s=i.next()){var o=s.value;if(e.next(o),e.closed)return}}catch(a){n={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}e.complete()})}function Rle(t){return new nr(function(e){FVe(t,e).catch(function(n){return e.error(n)})})}function jVe(t){return Rle(Cle(t))}function FVe(t,e){var n,r,i,s;return H7(this,void 0,void 0,function(){var o,a;return cR(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),n=V7(t),c.label=1;case 1:return[4,n.next()];case 2:if(r=c.sent(),!!r.done)return[3,4];if(o=r.value,e.next(o),e.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),i={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),r&&!r.done&&(s=n.return)?[4,s.call(n)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function Uf(t,e,n,r,i){r===void 0&&(r=0),i===void 0&&(i=!1);var s=e.schedule(function(){n(),i?t.add(this.schedule(null,r)):this.unsubscribe()},r);if(t.add(s),!i)return s}function kle(t,e){return e===void 0&&(e=0),_r(function(n,r){n.subscribe(rr(r,function(i){return Uf(r,t,function(){return r.next(i)},e)},function(){return Uf(r,t,function(){return r.complete()},e)},function(i){return Uf(r,t,function(){return r.error(i)},e)}))})}function Ile(t,e){return e===void 0&&(e=0),_r(function(n,r){r.add(t.schedule(function(){return n.subscribe(r)},e))})}function $Ve(t,e){return Si(t).pipe(Ile(e),kle(e))}function BVe(t,e){return Si(t).pipe(Ile(e),kle(e))}function HVe(t,e){return new nr(function(n){var r=0;return e.schedule(function(){r===t.length?n.complete():(n.next(t[r++]),n.closed||this.schedule())})})}function qVe(t,e){return new nr(function(n){var r;return Uf(n,e,function(){r=t[wle](),Uf(n,e,function(){var i,s,o;try{i=r.next(),s=i.value,o=i.done}catch(a){n.error(a);return}o?n.complete():n.next(s)},0,!0)}),function(){return An(r?.return)&&r.return()}})}function xle(t,e){if(!t)throw new Error("Iterable cannot be null");return new nr(function(n){Uf(n,e,function(){var r=t[Symbol.asyncIterator]();Uf(n,e,function(){r.next().then(function(i){i.done?n.complete():n.next(i.value)})},0,!0)})})}function VVe(t,e){return xle(Cle(t),e)}function KVe(t,e){if(t!=null){if(ble(t))return $Ve(t,e);if(g9(t))return HVe(t,e);if(yle(t))return BVe(t,e);if(_le(t))return xle(t,e);if(Ele(t))return qVe(t,e);if(Tle(t))return VVe(t,e)}throw Sle(t)}function dd(t,e){return e?KVe(t,e):Si(t)}function mt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=fS(t);return dd(t,n)}var GVe=d9(function(t){return function(){t(this),this.name="EmptyError",this.message="no elements in sequence"}});function zVe(t,e){return new Promise(function(n,r){var i=new zv({next:function(s){n(s),i.unsubscribe()},error:r,complete:function(){r(new GVe)}});t.subscribe(i)})}function WVe(t){return t instanceof Date&&!isNaN(t)}function ve(t,e){return _r(function(n,r){var i=0;n.subscribe(rr(r,function(s){r.next(t.call(e,s,i++))}))})}var YVe=Array.isArray;function XVe(t,e){return YVe(e)?t.apply(void 0,ia([],ra(e))):t(e)}function Ale(t){return ve(function(e){return XVe(t,e)})}var JVe=Array.isArray,QVe=Object.getPrototypeOf,ZVe=Object.prototype,eKe=Object.keys;function tKe(t){if(t.length===1){var e=t[0];if(JVe(e))return{args:e,keys:null};if(nKe(e)){var n=eKe(e);return{args:n.map(function(r){return e[r]}),keys:n}}}return{args:t,keys:null}}function nKe(t){return t&&typeof t=="object"&&QVe(t)===ZVe}function rKe(t,e){return t.reduce(function(n,r,i){return n[r]=e[i],n},{})}function ot(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=fS(t),r=vle(t),i=tKe(t),s=i.args,o=i.keys;if(s.length===0)return dd([],n);var a=new nr(iKe(s,n,o?function(c){return rKe(o,c)}:mh));return r?a.pipe(Ale(r)):a}function iKe(t,e,n){return n===void 0&&(n=mh),function(r){yz(e,function(){for(var i=t.length,s=new Array(i),o=i,a=i,c=function(d){yz(e,function(){var h=dd(t[d],e),m=!1;h.subscribe(rr(r,function(g){s[d]=g,m||(m=!0,a--),a||r.next(n(s.slice()))},function(){--o||r.complete()}))},r)},l=0;l<i;l++)c(l)},r)}}function yz(t,e,n){t?Uf(n,t,e):e()}function sKe(t,e,n,r,i,s,o,a){var c=[],l=0,d=0,h=!1,m=function(){h&&!c.length&&!l&&e.complete()},g=function(v){return l<r?y(v):c.push(v)},y=function(v){l++;var E=!1;Si(n(v,d++)).subscribe(rr(e,function(w){e.next(w)},function(){E=!0},void 0,function(){if(E)try{l--;for(var w=function(){var R=c.shift();o||y(R)};c.length&&l<r;)w();m()}catch(R){e.error(R)}}))};return t.subscribe(rr(e,g,function(){h=!0,m()})),function(){}}function PR(t,e,n){return n===void 0&&(n=1/0),An(e)?PR(function(r,i){return ve(function(s,o){return e(r,s,i,o)})(Si(t(r,i)))},n):(typeof e=="number"&&(n=e),_r(function(r,i){return sKe(r,i,t,n)}))}function Lle(t){return t===void 0&&(t=1/0),PR(mh,t)}function oKe(){return Lle(1)}function Wv(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return oKe()(dd(t,fS(t)))}function aKe(t){return new nr(function(e){Si(t()).subscribe(e)})}var cKe=["addListener","removeListener"],lKe=["addEventListener","removeEventListener"],uKe=["on","off"];function ms(t,e,n,r){if(An(n)&&(r=n,n=void 0),r)return ms(t,e,n).pipe(Ale(r));var i=ra(hKe(t)?lKe.map(function(a){return function(c){return t[a](e,c,n)}}):dKe(t)?cKe.map(bz(t,e)):fKe(t)?uKe.map(bz(t,e)):[],2),s=i[0],o=i[1];if(!s&&g9(t))return PR(function(a){return ms(a,e,n)})(Si(t));if(!s)throw new TypeError("Invalid event target");return new nr(function(a){var c=function(){for(var l=[],d=0;d<arguments.length;d++)l[d]=arguments[d];return a.next(1<l.length?l:l[0])};return s(c),function(){return o(c)}})}function bz(t,e){return function(n){return function(r){return t[n](e,r)}}}function dKe(t){return An(t.addListener)&&An(t.removeListener)}function fKe(t){return An(t.on)&&An(t.off)}function hKe(t){return An(t.addEventListener)&&An(t.removeEventListener)}function jf(t,e,n){t===void 0&&(t=0),n===void 0&&(n=LVe);var r=-1;return e!=null&&(gle(e)?n=e:r=e),new nr(function(i){var s=WVe(t)?+t-n.now():t;s<0&&(s=0);var o=0;return n.schedule(function(){i.closed||(i.next(o++),0<=r?this.schedule(void 0,r):i.complete())},s)})}function pKe(t,e){return e===void 0&&(e=OR),jf(t,t,e)}function Xu(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=fS(t),r=MVe(t,1/0),i=t;return i.length?i.length===1?Si(i[0]):Lle(r)(dd(i,n)):p9}var hb=new nr(Gv),mKe=Array.isArray;function gKe(t){return t.length===1&&mKe(t[0])?t[0]:t}function ri(t,e){return _r(function(n,r){var i=0;n.subscribe(rr(r,function(s){return t.call(e,s,i++)&&r.next(s)}))})}function vKe(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t=gKe(t),t.length===1?Si(t[0]):new nr(yKe(t))}function yKe(t){return function(e){for(var n=[],r=function(s){n.push(Si(t[s]).subscribe(rr(e,function(o){if(n){for(var a=0;a<n.length;a++)a!==s&&n[a].unsubscribe();n=null}e.next(o)})))},i=0;n&&!e.closed&&i<t.length;i++)r(i)}}function Mle(t){return _r(function(e,n){var r=!1,i=null,s=null,o=!1,a=function(){if(s?.unsubscribe(),s=null,r){r=!1;var l=i;i=null,n.next(l)}o&&n.complete()},c=function(){s=null,o&&n.complete()};e.subscribe(rr(n,function(l){r=!0,i=l,s||Si(t(l)).subscribe(s=rr(n,a,c))},function(){o=!0,(!r||!s||s.closed)&&n.complete()}))})}function DR(t){return _r(function(e,n){var r=null,i=!1,s;r=e.subscribe(rr(n,void 0,void 0,function(o){s=Si(t(o,DR(t)(e))),r?(r.unsubscribe(),r=null,s.subscribe(n)):i=!0})),i&&(r.unsubscribe(),r=null,s.subscribe(n))})}function bKe(t,e,n,r,i){return function(s,o){var a=n,c=e,l=0;s.subscribe(rr(o,function(d){var h=l++;c=a?t(c,d,h):(a=!0,d),o.next(c)},i))}}function v9(t){return t<=0?function(){return p9}:_r(function(e,n){var r=0;e.subscribe(rr(n,function(i){++r<=t&&(n.next(i),t<=r&&n.complete())}))})}function _Ke(){return _r(function(t,e){t.subscribe(rr(e,Gv))})}function SKe(t){return ve(function(){return t})}function wKe(t,e){return PR(function(n,r){return Si(t(n,r)).pipe(v9(1),SKe(n))})}function EKe(t,e){e===void 0&&(e=OR);var n=jf(t,e);return wKe(function(){return n})}function fo(t,e){return e===void 0&&(e=mh),t=t??CKe,_r(function(n,r){var i,s=!0;n.subscribe(rr(r,function(o){var a=e(o);(s||!t(i,a))&&(s=!1,i=a,r.next(o))}))})}function CKe(t,e){return t===e}function Ole(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(n){return Wv(n,mt.apply(void 0,ia([],ra(t))))}}function TKe(t){return _r(function(e,n){try{e.subscribe(n)}finally{n.add(t)}})}function Yv(){return _r(function(t,e){var n,r=!1;t.subscribe(rr(e,function(i){var s=n;n=i,r&&e.next([s,i]),r=!0}))})}function Ru(t,e){return _r(bKe(t,e,arguments.length>=2,!0))}function RKe(t){t===void 0&&(t={});var e=t.connector,n=e===void 0?function(){return new Ar}:e,r=t.resetOnError,i=r===void 0?!0:r,s=t.resetOnComplete,o=s===void 0?!0:s,a=t.resetOnRefCountZero,c=a===void 0?!0:a;return function(l){var d,h,m,g=0,y=!1,v=!1,E=function(){h?.unsubscribe(),h=void 0},w=function(){E(),d=m=void 0,y=v=!1},R=function(){var x=d;w(),x?.unsubscribe()};return _r(function(x,C){g++,!v&&!y&&E();var k=m=m??n();C.add(function(){g--,g===0&&!v&&!y&&(h=Q6(R,c))}),k.subscribe(C),!d&&g>0&&(d=new zv({next:function(T){return k.next(T)},error:function(T){v=!0,E(),h=Q6(w,i,T),k.error(T)},complete:function(){y=!0,E(),h=Q6(w,o),k.complete()}}),Si(x).subscribe(d))})(l)}}function Q6(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(e===!0){t();return}if(e!==!1){var i=new zv({next:function(){i.unsubscribe(),t()}});return Si(e.apply(void 0,ia([],ra(n)))).subscribe(i)}}function Ple(t){return _r(function(e,n){var r=!1,i=0;e.subscribe(rr(n,function(s){return(r||(r=!t(s,i++)))&&n.next(s)}))})}function xn(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=fS(t);return _r(function(r,i){(n?Wv(t,r,n):Wv(t,r)).subscribe(i)})}function gt(t,e){return _r(function(n,r){var i=null,s=0,o=!1,a=function(){return o&&!i&&r.complete()};n.subscribe(rr(r,function(c){i?.unsubscribe();var l=0,d=s++;Si(t(c,d)).subscribe(i=rr(r,function(h){return r.next(e?e(c,h,d,l++):h)},function(){i=null,a()}))},function(){o=!0,a()}))})}function kKe(){return gt(mh)}function IKe(t,e){return _r(function(n,r){var i=e;return gt(function(s,o){return t(i,s,o)},function(s,o){return i=o,o})(n).subscribe(r),function(){i=null}})}function Dle(t){return _r(function(e,n){Si(t).subscribe(rr(n,function(){return n.complete()},Gv)),!n.closed&&e.subscribe(n)})}function xKe(t,e){return e===void 0&&(e=!1),_r(function(n,r){var i=0;n.subscribe(rr(r,function(s){var o=t(s,i++);(o||e)&&r.next(s),!o&&r.complete()}))})}function Tp(t,e,n){var r=An(t)||e||n?{next:t,error:e,complete:n}:t;return r?_r(function(i,s){var o;(o=r.subscribe)===null||o===void 0||o.call(r);var a=!0;i.subscribe(rr(s,function(c){var l;(l=r.next)===null||l===void 0||l.call(r,c),s.next(c)},function(){var c;a=!1,(c=r.complete)===null||c===void 0||c.call(r),s.complete()},function(c){var l;a=!1,(l=r.error)===null||l===void 0||l.call(r,c),s.error(c)},function(){var c,l;a&&((c=r.unsubscribe)===null||c===void 0||c.call(r)),(l=r.finalize)===null||l===void 0||l.call(r)}))}):mh}function AKe(t,e){return _r(function(n,r){var i=e??{},s=i.leading,o=s===void 0?!0:s,a=i.trailing,c=a===void 0?!1:a,l=!1,d=null,h=null,m=!1,g=function(){h?.unsubscribe(),h=null,c&&(E(),m&&r.complete())},y=function(){h=null,m&&r.complete()},v=function(w){return h=Si(t(w)).subscribe(rr(r,g,y))},E=function(){if(l){l=!1;var w=d;d=null,r.next(w),!m&&v(w)}};n.subscribe(rr(r,function(w){l=!0,d=w,!(h&&!h.closed)&&(o?E():v(w))},function(){m=!0,!(c&&l&&h&&!h.closed)&&r.complete()}))})}function eO(t,e,n){e===void 0&&(e=OR);var r=jf(t,e);return AKe(function(){return r},n)}function Nle(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=vle(t);return _r(function(r,i){for(var s=t.length,o=new Array(s),a=t.map(function(){return!1}),c=!1,l=function(h){Si(t[h]).subscribe(rr(i,function(m){o[h]=m,!c&&!a[h]&&(a[h]=!0,(c=a.every(mh))&&(a=null))},Gv))},d=0;d<s;d++)l(d);r.subscribe(rr(i,function(h){if(c){var m=ia([h],ra(o));i.next(n?n.apply(void 0,ia([],ra(m))):m)}}))})}class Bi{constructor(e,n){this.defaultValue=n,this.setValue=s=>{this._value$.next(s),localStorage.setItem(this.key,JSON.stringify(s))},this.getValue=()=>this._value$.getValue(),this.key=`matrix-setting-${e}`;const r=localStorage.getItem(this.key);let i=n;if(r!==null)try{i=JSON.parse(r)}catch(s){N.warn(`Invalid value stored for setting ${e}: ${r}.`,s)}this._value$=new mr(i),this.value$=this._value$}}function $r(t){return[Fe(t.value$),t.setValue]}const Ule=new Bi("opt-in-analytics",null),NR=()=>{const t=$r(Ule);return en.instance.isEnabled()?t:[!1,null]},jle=new Bi("developer-settings-tab",!1),Fle=new Bi("duplicate-tiles",0),y9=new Bi("debug-tile-layout",!1),Xv=new Bi("show-connection-stats",!1),_z=new Bi("audio-input",void 0),Sz=new Bi("audio-output",void 0),wz=new Bi("video-input",void 0),$le=new Bi("background-blur",!1),Ble=new Bi("hand-raised-show-timer",!1),Hle=new Bi("reactions-show",!0),b9=new Bi("reactions-play-sound",!0),qle=new Bi("sound-effect-volume",.5),Vle=new Bi("mute-all-audio",!1),Ez=new Bi("always-show-self",!0),Kle=new Bi("always-show-iphone-earpiece",!1);var so=(t=>(t.Legacy="legacy",t.Compatibility="compatibility",t.Matrix_2_0="matrix_2_0",t))(so||{});const Gle=new Bi("matrix-rtc-mode","legacy"),zle=new Bi("custom-livekit-url",null);var UR=(t=>(t[t.Guest=0]="Guest",t[t.Registered=1]="Registered",t))(UR||{});const ml=class ml{constructor(e){this.posthog=e,this.enabled=!1,this.anonymity=0,this.platformSuperProperties={},this.registrationType=0,this.optInListener=null,this.sanitizeProperties=(i,s)=>(this.anonymity==1&&(i.$referrer=null,i.$referring_domain=null,i.$initial_referrer=null,i.$initial_referring_domain=null,i.$device_id=null),i.$current_url=i.$current_url.split("/").slice(0,3).join(""),i),this.eventCallEnded=new oVe,this.eventSignup=new cVe,this.eventCallStarted=new aVe,this.eventLogin=new lVe,this.eventMuteMicrophone=new uVe,this.eventMuteCamera=new dVe,this.eventUndecryptableToDevice=new fVe,this.eventQualitySurvey=new hVe,this.eventCallDisconnected=new pVe,this.eventCallConnectDuration=new mVe;let n,r;n=ur().posthogApiKey??void 0,r=ur().posthogApiHost??void 0,n&&r?(this.posthog.init(n,{api_host:r,autocapture:!1,mask_all_text:!0,mask_all_element_attributes:!0,capture_pageview:!1,sanitize_properties:this.sanitizeProperties,respect_dnt:!0,advanced_disable_decide:!0}),this.enabled=!0):(N.info("Posthog is not enabled because there is no api key or no host given in the config"),this.enabled=!1)}static hasInstance(){return!!this.internalInstance}static get instance(){return this.internalInstance||(this.internalInstance=new ml(sVe)),this.internalInstance}static resetInstance(){this.internalInstance=null}registerSuperProperties(e){this.enabled&&this.posthog.register(e)}static getPlatformProperties(){return{appVersion:"dev",matrixBackend:Et?"embedded":"jssdk",callBackend:"livekit",cryptoVersion:Et?void 0:window.matrixclient?.getCrypto()?.getVersion()}}capture(e,n,r){this.enabled&&this.posthog.capture(e,{...n},r)}isEnabled(){return this.enabled}setAnonymity(e){this.enabled&&(e==0||e==1)&&(this.posthog.reset(),this.updateSuperProperties()),this.anonymity=e}static getRandomAnalyticsId(){return[...crypto.getRandomValues(new Uint8Array(16))].map(e=>e.toString(16)).join("")}async identifyUser(e){if(this.anonymity==2&&this.enabled){let n=await this.getAnalyticsId();try{!n&&!Et&&(n=e(),await this.setAccountAnalyticsId(n))}catch(r){N.log("Unable to identify user for tracking"+r?.toString())}n?this.posthog.identify(n):N.info("No analyticsID is available. Should not try to setup posthog")}}async getAnalyticsId(){const e=window.matrixclient;return Et?ur().posthogUserId:(await e.getAccountDataFromServer(ml.ANALYTICS_EVENT_TYPE))?.id??null}async setAccountAnalyticsId(e){if(!Et){const n=window.matrixclient,r=await n.getAccountDataFromServer(ml.ANALYTICS_EVENT_TYPE);await n.setAccountData(ml.ANALYTICS_EVENT_TYPE,Object.assign({id:e},r))}}getAnonymity(){return this.anonymity}logout(){this.enabled&&this.posthog.reset(),this.optInListener?.unsubscribe(),this.optInListener=null,this.setAnonymity(0)}onLoginStatusChanged(){this.maybeIdentifyUser().catch(()=>N.log("Could not identify user on login status change"))}updateSuperProperties(){this.platformSuperProperties=ml.getPlatformProperties(),this.registerSuperProperties({...this.platformSuperProperties,registrationType:this.registrationType==0?"Guest":"Registered"})}userRegisteredInThisSession(){return this.eventSignup.getSignupEndTime()>new Date(0)}async maybeIdentifyUser(){window.matrixclient&&(this.anonymity===2&&(this.setRegistrationType(window.matrixclient.isGuest()||window.passwordlessUser?0:1),this.identificationPromise=this.identifyUser(ml.getRandomAnalyticsId),await this.identificationPromise,this.userRegisteredInThisSession()&&this.eventSignup.track()),this.anonymity!==0&&this.updateSuperProperties())}trackEvent({eventName:e,...n},r){const i=()=>{this.anonymity==0||this.anonymity==1||this.capture(e,n,r)};this.identificationPromise?this.identificationPromise.then(i,s=>{N.error("Failed to identify user for tracking",s)}):i()}startListeningToSettingsChanges(){this.optInListener??=Ule.value$.subscribe(e=>{this.setAnonymity(e?2:0),this.maybeIdentifyUser().catch(()=>N.log("Could not identify user"))})}setRegistrationType(e){this.registrationType=e,!(this.anonymity==0||this.anonymity==1)&&this.updateSuperProperties()}};ml.ANALYTICS_EVENT_TYPE="im.vector.analytics",ml.internalInstance=null;let en=ml;const _9=_.createContext(void 0);_9.Provider;const My=()=>_.use(_9);function gm(){let t,e;const n=My();return n?.state==="valid"&&(t=n.authenticated?.client,e=n.setClient),{client:t,setClient:e}}function S9(){const t=My();let e,n,r=!1,i=!0,s,o=!1,a;return t?.state==="valid"?(e=t.authenticated?.client,n=t.setClient,r=t.authenticated?.isPasswordlessUser??!1,i=!1,o=e!==void 0,a=t.authenticated?.logout):t?.state==="error"&&(s=t.error,i=!1),{client:e,setClient:n,passwordlessUser:r,loading:i,authenticated:o,logout:a,error:s}}const Cz="BroadcastChannel"in window?new BroadcastChannel("load"):null,LKe=({children:t})=>{const e=Fl(),[n,r]=_.useState(void 0),i=_.useRef(!1);_.useEffect(()=>{i.current||(i.current=!0,MKe().then(R=>{r(R),en.instance.isEnabled()&&en.instance.startListeningToSettingsChanges()}).catch(R=>N.error(R)).finally(()=>i.current=!1))},[]);const s=_.useCallback(async R=>{const x=Yle();!n?.client||!x||(await n.client.setPassword({type:"m.login.password",identifier:{type:"m.id.user",user:x.user_id},user:x.user_id,password:x.tempPassword},R),Tz({...x,passwordlessUser:!1}),r({...n,passwordlessUser:!1}))},[n]),o=_.useCallback((R,x)=>{const C=n?.client;C&&C!==R&&C.stopClient(),Tz(x),r({widgetApi:null,client:R,passwordlessUser:x.passwordlessUser}),en.instance.isEnabled()&&en.instance.startListeningToSettingsChanges()},[n?.client]),a=_.useCallback(async()=>{const R=n?.client;R&&(await R.logout(!0),await R.clearStores(),Wle(),r(null),await e("/"),en.instance.logout(),en.instance.setRegistrationType(UR.Guest))},[e,n?.client]);_.useEffect(()=>{Et||Cz?.postMessage({})},[]);const[c,l]=_.useState(void 0);eC(Cz,"message",_.useCallback(()=>{n?.client.stopClient(),l(new IHe)},[n?.client,l]));const[d,h]=_.useState(!1),[m,g]=_.useState(!1),[y,v]=_.useState(!1),E=_.useMemo(()=>c?{state:"error",error:c}:n===void 0?void 0:{state:"valid",authenticated:n===null?void 0:{client:n.client,isPasswordlessUser:n.passwordlessUser,changePassword:s,logout:a},setClient:o,disconnected:d,supportedFeatures:{reactions:m,thumbnails:y}},[c,s,n,a,o,d,m,y]),w=_.useCallback((R,x,C)=>{h(OKe(R,C))},[]);return _.useEffect(()=>{if(n){if(window.matrixclient=n.client,window.passwordlessUser=n.passwordlessUser,en.hasInstance()&&en.instance.onLoginStatusChanged(),n.client&&n.client.on(Pe.Sync,w),n.widgetApi){v(!1);const R=n.widgetApi.hasCapability("org.matrix.msc2762.send.event:m.reaction"),x=n.widgetApi.hasCapability("org.matrix.msc2762.send.event:m.room.redaction"),C=n.widgetApi.hasCapability("org.matrix.msc2762.receive.event:m.reaction"),k=n.widgetApi.hasCapability("org.matrix.msc2762.receive.event:m.room.redaction");!R||!C||!x||!k?(N.warn("Widget does not support reactions"),g(!1)):g(!0)}else g(!0),v(!0);return()=>{n.client&&n.client.removeListener(Pe.Sync,w)}}},[n,w]),c?S.jsx(h_,{widget:Et,error:c}):S.jsx(_9,{value:E,children:t})};async function MKe(){if(Et){N.log("Using a matryoshka client");const t=await Et.client;return{widgetApi:Et.api,client:t,passwordlessUser:!1}}else{const{initSPA:t}=await Rb(async()=>{const{initSPA:e}=await import("./spa-DwDn83m2.js");return{initSPA:e}},[],import.meta.url);return t(Yle,Wle)}}const Wle=()=>localStorage.removeItem("matrix-auth-store"),Tz=t=>localStorage.setItem("matrix-auth-store",JSON.stringify(t)),Yle=()=>{const t=localStorage.getItem("matrix-auth-store");if(t)return JSON.parse(t)},OKe=(t,e)=>t==="ERROR"&&e?.error?.name==="ConnectionError";function hS(t){const[{success:e,loading:n,displayName:r,avatarUrl:i,error:s},o]=_.useState(()=>{let c;return t&&(c=t.getUser(t.getUserId())??void 0),{success:!1,loading:!1,displayName:c?.rawDisplayName,avatarUrl:c?.avatarUrl,error:void 0}});_.useEffect(()=>{const c=(d,{displayName:h,avatarUrl:m})=>{o({success:!1,loading:!1,displayName:h,avatarUrl:m,error:void 0})};let l;if(t){const d=t.getUserId();l=t.getUser(d),l?.on(Yi.DisplayName,c),l?.on(Yi.AvatarUrl,c)}return()=>{l&&(l.removeListener(Yi.DisplayName,c),l.removeListener(Yi.AvatarUrl,c))}},[t]);const a=_.useCallback(async({displayName:c,avatar:l,removeAvatar:d})=>{if(t){o(h=>({...h,loading:!0,error:void 0,success:!1}));try{await t.setDisplayName(c);let h;d?await t.setAvatarUrl(""):l&&({content_uri:h}=await t.uploadContent(l),await t.setAvatarUrl(h)),o(m=>({...m,displayName:c,avatarUrl:d?void 0:h??m.avatarUrl,loading:!1,success:!0}))}catch(h){o(m=>({...m,loading:!1,error:h instanceof Error?h:Error(h),success:!1}))}}else N.error("Client not initialized before calling saveProfile")},[t]);return{loading:n,error:s,displayName:r,avatarUrl:i,saveProfile:a,success:e}}const PKe="_settingsModal_1dkeq_8",DKe="_volumeSlider_1dkeq_20",Rz={settingsModal:PKe,volumeSlider:DKe},NKe="_tabContainer_1nnp9_8",UKe="_tabList_1nnp9_14",kz={tabContainer:NKe,tabList:UKe};function jKe({label:t,tab:e,onTabChange:n,tabs:r}){const i=_.useId();return S.jsxs("div",{className:kz.tabContainer,children:[S.jsx($9e,{role:"tablist","aria-label":t,className:kz.tabList,children:r.map(({key:s,name:o})=>S.jsx(V9e,{"aria-controls":`${i}[${s}]`,onClick:()=>n(s),active:s===e,children:o},s))}),r.map(({key:s,content:o})=>S.jsx("div",{id:`${i}[${s}]`,style:{display:s===e?void 0:"none"},children:o},s))]})}const FKe="_fieldRow_iwncy_8",$Ke="_field_iwncy_8",BKe="_rightAlign_iwncy_21",HKe="_inputField_iwncy_33",qKe="_disabled_iwncy_52",VKe="_prefix_iwncy_110",KKe="_checkboxField_iwncy_131",GKe="_checkbox_iwncy_131",zKe="_description_iwncy_168",WKe="_errorMessage_iwncy_197",YKe="_noLabel_iwncy_210",Ia={fieldRow:FKe,field:$Ke,rightAlign:BKe,inputField:HKe,disabled:qKe,prefix:VKe,checkboxField:KKe,checkbox:GKe,description:zKe,errorMessage:WKe,noLabel:YKe},XKe=(t,e)=>_.createElement("svg",{fill:"none",height:24,stroke:"#000",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,viewBox:"0 0 24 24",width:24,xmlns:"http://www.w3.org/2000/svg",ref:e,...t},_.createElement("path",{d:"m20 6-11 11-5-5"})),JKe=_.forwardRef(XKe);class Xle extends Error{constructor(e,n){super(n(e,{lng:"en"})),this.translatedMessage=n(e)}}class QKe extends Xle{}const Iz=(t,e)=>new QKe(t,e);function Nt({children:t,rightAlign:e,className:n}){return S.jsx("div",{className:Le(Ia.fieldRow,{[Ia.rightAlign]:e},n),children:t})}function ZKe({children:t,className:e}){return S.jsx("div",{className:Le(Ia.field,e),children:t})}const er=({ref:t,id:e,label:n,className:r,type:i,checked:s,prefix:o,suffix:a,description:c,disabled:l,min:d,...h})=>{const m=_.useId();return S.jsxs(ZKe,{className:Le(i==="checkbox"?Ia.checkboxField:Ia.inputField,{[Ia.prefix]:!!o,[Ia.disabled]:l},r),children:[o&&S.jsx("span",{children:o}),i==="textarea"?S.jsx("textarea",{id:e,ref:t,disabled:l,"aria-describedby":m,...h}):S.jsx("input",{id:e,ref:t,type:i,checked:s,disabled:l,"aria-describedby":m,min:d,...h}),S.jsxs("label",{htmlFor:e,children:[i==="checkbox"&&S.jsx("div",{className:Ia.checkbox,children:S.jsx(JKe,{})}),n]}),a&&S.jsx("span",{children:a}),c&&S.jsx("p",{id:m,className:n?Ia.description:Le(Ia.description,Ia.noLabel),children:c})]})};er.displayName="InputField";const gh=({error:t})=>S.jsx("p",{className:Ia.errorMessage,children:t instanceof Xle?t.translatedMessage:t.message}),eGe="_avatarInputField_1ep5q_8",tGe="_avatar_1ep5q_8",nGe="_fileInput_1ep5q_17",rGe="_edit_1ep5q_21",qw={avatarInputField:eGe,avatar:tGe,fileInput:nGe,edit:rGe},Jle=({id:t,label:e,className:n,avatarUrl:r,userId:i,displayName:s,onRemoveAvatar:o,...a})=>{const{t:c}=et(),[l,d]=_.useState(!1),[h,m]=_.useState(void 0),[g,y]=_.useState(!1),v=_.useRef(null);_.useEffect(()=>{const R=v.current,x=C=>{const k=C;k.target.files&&k.target.files.length>0?(m(URL.createObjectURL(k.target.files[0])),d(!1)):m(void 0)};return R.addEventListener("change",x),()=>{R?.removeEventListener("change",x)}});const E=_.useCallback(()=>{v.current.click()},[v]),w=_.useCallback(()=>{d(!0),o()},[o]);return S.jsxs("div",{className:Le(qw.avatarInputField,n),children:[S.jsx(dm,{id:i,className:qw.avatar,name:s,size:um.XL,src:l?void 0:h||r}),S.jsx("input",{id:t,accept:"image/*",ref:v,type:"file",className:qw.fileInput,role:"button","aria-label":e,...a}),S.jsx("div",{className:qw.edit,children:(r||h)&&!l?S.jsxs(C8,{title:c("action.edit"),showTitle:!1,open:g,onOpenChange:y,trigger:S.jsx(qt,{iconOnly:!0,Icon:qK,kind:"tertiary",size:"sm","aria-label":c("action.edit")}),children:[S.jsx($p,{Icon:ZDe,label:c("action.upload_file"),onSelect:E}),S.jsx($p,{Icon:BDe,label:c("action.remove"),kind:"critical",onSelect:w})]}):S.jsx(qt,{type:"button",iconOnly:!0,Icon:qK,kind:"tertiary",size:"sm","aria-label":c("action.edit"),onClick:E})})]})};Jle.displayName="AvatarInputField";const iGe="_content_gj715_8",sGe="_avatarFieldRow_gj715_15",xz={content:iGe,avatarFieldRow:sGe},oGe=({client:t})=>{const{t:e}=et(),{error:n,displayName:r,avatarUrl:i,saveProfile:s}=hS(t),o=_.useMemo(()=>t.getUserId(),[t]),a=_.useRef(null),c=_.useRef(!1),l=_.useCallback(()=>{c.current=!0},[]),d=_.useRef(!1),h=_.useCallback(()=>{d.current=!0,c.current=!0},[]);return _.useEffect(()=>{const m=a.current;return()=>{if(c.current){const g=new FormData(m),y=g.get("displayName"),v=g.get("avatar"),E=typeof v=="string"?v.length:v?.size??0,w=typeof y=="string"?y:y?.name??null;if(!w)return;s({displayName:w,avatar:v&&E>0?v:void 0,removeAvatar:d.current&&(!v||E===0)}).catch(R=>{N.error("Failed to save profile",R)})}}},[s]),S.jsxs("form",{onChange:l,ref:a,className:xz.content,children:[S.jsx(Nt,{className:xz.avatarFieldRow,children:o&&r&&S.jsx(Jle,{id:"avatar",name:"avatar",label:e("common.avatar"),avatarUrl:i,userId:o,displayName:r,onRemoveAvatar:h})}),S.jsx(Nt,{children:S.jsx(er,{id:"userId",name:"userId",label:e("common.username"),type:"text",disabled:!0,value:t.getUserId()})}),S.jsx(Nt,{children:S.jsx(er,{id:"displayName",name:"displayName",label:e("common.display_name"),type:"text",required:!0,autoComplete:"off",placeholder:e("common.display_name"),defaultValue:r,"data-testid":"profile_displayname"})}),n&&S.jsx(Nt,{children:S.jsx(gh,{error:n})})]})},aGe="_feedback_19yh9_8",Qle={feedback:aGe},Zle=()=>S.jsxs(mo,{i18nKey:"analytics_notice",children:["By participating in this beta, you consent to the collection of anonymous data, which we use to improve the product. You can find more information about which data we track in our"," ",S.jsx(Cp,{href:"https://element.io/privacy",children:"Privacy Policy"})," ","and our"," ",S.jsx(Cp,{href:"https://element.io/cookie-policy",children:"Cookie Policy"}),"."]}),cGe=({roomId:t})=>{const{t:e}=et(),{submitRageshake:n,sending:r,sent:i,error:s,available:o}=xR(),a=lBe(),c=_.useCallback(h=>{h.preventDefault();const m=new FormData(h.target),g=m.get("description"),y=typeof g=="string"?g:"",v=!!m.get("sendLogs"),E=Qo(16);n({description:y,sendLogs:v,rageshakeRequestId:E,roomId:t}).catch(w=>{N.error("Failed to send feedback rageshake",w)}),t&&v&&a(t,E)},[n,t,a]);NR();const l=null,d=o?S.jsxs(S.Fragment,{children:[S.jsx("h4",{children:e("settings.feedback_tab_h4")}),S.jsx(an,{children:e("settings.feedback_tab_body")}),S.jsxs("form",{onSubmit:c,children:[S.jsx(Nt,{children:S.jsx(er,{className:Qle.feedback,id:"description",name:"description",label:e("settings.feedback_tab_description_label"),placeholder:e("settings.feedback_tab_description_label"),type:"textarea",disabled:r||i})}),!i&&S.jsxs(Nt,{children:[S.jsx(er,{id:"sendLogs",name:"sendLogs",label:e("settings.feedback_tab_send_logs_label"),type:"checkbox",defaultChecked:!0}),S.jsx(qt,{type:"submit",disabled:r,children:e(r?"submitting":"action.submit")})]}),S.jsxs(Nt,{children:[s&&S.jsx(gh,{error:s}),i&&S.jsx(an,{children:e("settings.feedback_tab_thank_you")})]})]})]}):null;return S.jsxs("div",{children:[l,d]})};var sC={exports:{}},lGe=sC.exports,Az;function uGe(){return Az||(Az=1,(function(t){(function(e,n){t.exports?t.exports=n():e.log=n()})(lGe,function(){var e=function(){},n="undefined",r=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"],s={},o=null;function a(v,E){var w=v[E];if(typeof w.bind=="function")return w.bind(v);try{return Function.prototype.bind.call(w,v)}catch{return function(){return Function.prototype.apply.apply(w,[v,arguments])}}}function c(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(v){return v==="debug"&&(v="log"),typeof console===n?!1:v==="trace"&&r?c:console[v]!==void 0?a(console,v):console.log!==void 0?a(console,"log"):e}function d(){for(var v=this.getLevel(),E=0;E<i.length;E++){var w=i[E];this[w]=E<v?e:this.methodFactory(w,v,this.name)}if(this.log=this.debug,typeof console===n&&v<this.levels.SILENT)return"No console available for logging"}function h(v){return function(){typeof console!==n&&(d.call(this),this[v].apply(this,arguments))}}function m(v,E,w){return l(v)||h.apply(this,arguments)}function g(v,E){var w=this,R,x,C,k="loglevel";typeof v=="string"?k+=":"+v:typeof v=="symbol"&&(k=void 0);function T(j){var H=(i[j]||"silent").toUpperCase();if(!(typeof window===n||!k)){try{window.localStorage[k]=H;return}catch{}try{window.document.cookie=encodeURIComponent(k)+"="+H+";"}catch{}}}function L(){var j;if(!(typeof window===n||!k)){try{j=window.localStorage[k]}catch{}if(typeof j===n)try{var H=window.document.cookie,z=encodeURIComponent(k),Y=H.indexOf(z+"=");Y!==-1&&(j=/^([^;]+)/.exec(H.slice(Y+z.length+1))[1])}catch{}return w.levels[j]===void 0&&(j=void 0),j}}function O(){if(!(typeof window===n||!k)){try{window.localStorage.removeItem(k)}catch{}try{window.document.cookie=encodeURIComponent(k)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function P(j){var H=j;if(typeof H=="string"&&w.levels[H.toUpperCase()]!==void 0&&(H=w.levels[H.toUpperCase()]),typeof H=="number"&&H>=0&&H<=w.levels.SILENT)return H;throw new TypeError("log.setLevel() called with invalid level: "+j)}w.name=v,w.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},w.methodFactory=E||m,w.getLevel=function(){return C??x??R},w.setLevel=function(j,H){return C=P(j),H!==!1&&T(C),d.call(w)},w.setDefaultLevel=function(j){x=P(j),L()||w.setLevel(j,!1)},w.resetLevel=function(){C=null,O(),d.call(w)},w.enableAll=function(j){w.setLevel(w.levels.TRACE,j)},w.disableAll=function(j){w.setLevel(w.levels.SILENT,j)},w.rebuild=function(){if(o!==w&&(R=P(o.getLevel())),d.call(w),o===w)for(var j in s)s[j].rebuild()},R=P(o?o.getLevel():"WARN");var D=L();D!=null&&(C=P(D)),d.call(w)}o=new g,o.getLogger=function(E){if(typeof E!="symbol"&&typeof E!="string"||E==="")throw new TypeError("You must supply a name when creating a logger.");var w=s[E];return w||(w=s[E]=new g(E,o.methodFactory)),w};var y=typeof window!==n?window.log:void 0;return o.noConflict=function(){return typeof window!==n&&window.log===o&&(window.log=y),o},o.getLoggers=function(){return s},o.default=o,o})})(sC)),sC.exports}var dGe=uGe();const fGe=Dl(dGe);var hGe=(t,e,n)=>new Promise((r,i)=>{var s=c=>{try{a(n.next(c))}catch(l){i(l)}},o=c=>{try{a(n.throw(c))}catch(l){i(l)}},a=c=>c.done?r(c.value):Promise.resolve(c.value).then(s,o);a((n=n.apply(t,e)).next())});function pGe(t){return typeof t>"u"?!1:mGe(t)||gGe(t)}function mGe(t){var e;return t?t.hasOwnProperty("participant")&&t.hasOwnProperty("source")&&t.hasOwnProperty("track")&&typeof((e=t.publication)==null?void 0:e.track)<"u":!1}function gGe(t){return t?t.hasOwnProperty("participant")&&t.hasOwnProperty("source")&&t.hasOwnProperty("publication")&&typeof t.publication<"u":!1}function vGe(t){return t?t.hasOwnProperty("participant")&&t.hasOwnProperty("source")&&typeof t.publication>"u":!1}function yGe(t){if(typeof t=="string"||typeof t=="number")return`${t}`;if(vGe(t))return`${t.participant.identity}_${t.source}_placeholder`;if(pGe(t))return`${t.participant.identity}_${t.publication.source}_${t.publication.trackSid}`;throw new Error(`Can't generate a id for the given track reference: ${t}`)}var bGe=[he.ConnectionStateChanged,he.RoomMetadataChanged,he.ActiveSpeakersChanged,he.ConnectionQualityChanged,he.ParticipantConnected,he.ParticipantDisconnected,he.ParticipantPermissionsChanged,he.ParticipantMetadataChanged,he.ParticipantNameChanged,he.ParticipantAttributesChanged,he.TrackMuted,he.TrackUnmuted,he.TrackPublished,he.TrackUnpublished,he.TrackStreamStateChanged,he.TrackSubscriptionFailed,he.TrackSubscriptionPermissionChanged,he.TrackSubscriptionStatusChanged],_Ge=[...bGe,he.LocalTrackPublished,he.LocalTrackUnpublished];ae.TrackPublished,ae.TrackUnpublished,ae.TrackMuted,ae.TrackUnmuted,ae.TrackStreamStateChanged,ae.TrackSubscribed,ae.TrackUnsubscribed,ae.TrackSubscriptionPermissionChanged,ae.TrackSubscriptionFailed,ae.LocalTrackPublished,ae.LocalTrackUnpublished;var SGe=[ae.ConnectionQualityChanged,ae.IsSpeakingChanged,ae.ParticipantMetadataChanged,ae.ParticipantPermissionsChanged,ae.TrackMuted,ae.TrackUnmuted,ae.TrackPublished,ae.TrackUnpublished,ae.TrackStreamStateChanged,ae.TrackSubscriptionFailed,ae.TrackSubscriptionPermissionChanged,ae.TrackSubscriptionStatusChanged];[...SGe,ae.LocalTrackPublished,ae.LocalTrackUnpublished];var wGe=fGe.getLogger("lk-components-js");wGe.setDefaultLevel("WARN");function EGe(t,...e){return new nr(r=>{const i=()=>{r.next(t)};return e.forEach(o=>{t.on(o,i)}),()=>{e.forEach(o=>{t.off(o,i)})}}).pipe(xn(t))}function eue(t,e){return new nr(r=>{const i=(...o)=>{r.next(o)};return t.on(e,i),()=>{t.off(e,i)}})}function CGe(t){return eue(t,he.ConnectionStateChanged).pipe(ve(([e])=>e),xn(t.state))}function Lz(t,e,n=!0){const r=new nr(s=>{td.getLocalDevices(t,n).then(o=>{s.next(o),s.complete()}).catch(o=>{e?.(o),s.next([]),s.complete()})}),i=new nr(s=>{var o;const a=()=>hGe(this,null,function*(){try{const c=yield td.getLocalDevices(t,n);s.next(c)}catch(c){e?.(c)}});if(typeof window<"u"){if(!window.isSecureContext)throw new Error("Accessing media devices is available only in secure contexts (HTTPS and localhost), in some or all supporting browsers. See: https://developer.mozilla.org/en-US/docs/Web/API/Navigator/mediaDevices");(o=navigator?.mediaDevices)==null||o.addEventListener("devicechange",a)}return()=>{var c;(c=navigator?.mediaDevices)==null||c.removeEventListener("devicechange",a)}});return Wv(r,i)}function jR(t,...e){return new nr(r=>{const i=()=>{r.next(t)};return e.forEach(o=>{t.on(o,i)}),()=>{e.forEach(o=>{t.off(o,i)})}}).pipe(xn(t))}function tue(t){return jR(t,ae.TrackMuted,ae.TrackUnmuted,ae.ParticipantPermissionsChanged,ae.TrackPublished,ae.TrackUnpublished,ae.LocalTrackPublished,ae.LocalTrackUnpublished,ae.MediaDevicesError,ae.TrackSubscriptionStatusChanged).pipe(ve(n=>{const{isMicrophoneEnabled:r,isCameraEnabled:i,isScreenShareEnabled:s}=n,o=n.getTrackPublication(pe.Source.Microphone),a=n.getTrackPublication(pe.Source.Camera);return{isCameraEnabled:i,isMicrophoneEnabled:r,isScreenShareEnabled:s,cameraTrack:a,microphoneTrack:o,participant:n}}))}function TGe(t,e={}){var n;let r;const i=new nr(c=>(r=c,()=>a.unsubscribe())).pipe(xn(Array.from(t.remoteParticipants.values()))),s=(n=e.additionalRoomEvents)!=null?n:_Ge,o=Array.from(new Set([he.ParticipantConnected,he.ParticipantDisconnected,he.ConnectionStateChanged,...s])),a=EGe(t,...o).subscribe(c=>r?.next(Array.from(c.remoteParticipants.values())));return t.remoteParticipants.size>0&&r?.next(Array.from(t.remoteParticipants.values())),i}const Pg=new Ar,nue=new Ar,rue=new Ar,tO=new Ar;let Mz=!1;const iue=()=>{Mz||(Mz=!0,window.controls.onAudioPlaybackStarted?.())};window.controls={canEnterPip(){return Pg.observed},enablePip(){if(!Pg.observed)throw new Error("No call is running");Pg.next(!0)},disablePip(){if(!Pg.observed)throw new Error("No call is running");Pg.next(!1)},setAvailableAudioDevices(t){N.info("setAvailableAudioDevices called from native:",t),nue.next(t)},setAudioDevice(t){N.info("setAudioDevice called from native",t),rue.next(t)},setAudioEnabled(t){if(N.info("setAudioEnabled called from native:",t),!tO.observed)throw new Error("Output controls are disabled. No setAudioEnabled$ observer");tO.next(t)},setOutputEnabled(t){this.setAudioEnabled(t)},setAvailableOutputDevices(t){this.setAvailableAudioDevices(t)},setOutputDevice(t){this.setAudioDevice(t)}};const _g=Symbol("nothing");class pS{constructor(){this.ended$=new mr(!1),this.bindImpl=Dle(this.ended$.pipe(ri(e=>e))),this.shareImpl=RKe({resetOnError:!1,resetOnComplete:!1,resetOnRefCountZero:!1}),this.share=e=>e.pipe(this.bindImpl,this.shareImpl)}bind(){return this.bindImpl}behavior(e,n=_g){const r=new mr(n);if(e.pipe(this.bind(),fo()).subscribe({next(i){r.next(i)},error(i){r.error(i)}}),r.value===_g)throw new Error("Behavior failed to synchronously emit an initial value");return r}end(){this.ended$.next(!0)}onEnd(e){this.ended$.pipe(ri(n=>n),v9(1)).subscribe(e)}reconcile(e,n){let r=_g,i,s,o=_g;const a=async()=>{for(;r!==o;)await s?.(),o=r,r!==_g&&(s=await n(r))};e.pipe(DR(()=>p9),this.bind(),Ole(_g)).subscribe(c=>{r=c,!i&&(i=a().finally(()=>{i=void 0}))})}splitBehavior(e){return Object.fromEntries(Object.keys(e.value).map(n=>[`${n}$`,this.behavior(e.pipe(ve(r=>r[n])))]))}}const sue=new pS;class Lc{constructor(e,n){this.value=e,this.epoch=n??0}mapInner(e){return new Lc(e(this.value),this.epoch)}}function nO(t){return ve(e=>e.mapInner(t))}function RGe(){return ve((t,e)=>new Lc(t,e))}const H3=Symbol("nothing");function kGe(t){return e=>aKe(()=>{let n=H3;return e.pipe(Tp(r=>n=r),TKe(()=>{n!==H3&&t(n)}))})}function oue(t,e){return n=>n.pipe(Ru(e,t),xn(t))}const Oz=Symbol("switch");function IGe(t,e){return n=>Wv(n.pipe(ve((r,i)=>t(r,i)?Oz:r),xKe(r=>r!==Oz)),e)}function xGe(t){let e=H3;if(t.subscribe(n=>e=n).unsubscribe(),e===H3)throw new Error("Not a state Observable");return e}function aue(...t){return ot(t,(...e)=>e.every(n=>n))}function Pz(t){return e=>e.pipe(Nle(t),Mle(([,n])=>n?t.pipe(ri(r=>!r)):mt(null)),ve(([n])=>n))}function cue(t,e,n){return uue(t,e,n,r=>r)}function lue(t,e,n){return uue(t,function*(r){yield*e(r.value)},n,(r,i)=>new Lc(r,i.epoch))}function AGe(t){return e=>e.pipe(Ru((n,r)=>{if(t(r)){const i=n??new mr(r);return i.next(r),i}return null},null),fo())}function uue(t,e,n,r){return i=>i.pipe(Ru(({map:s,items:o},a)=>{const c=new Map,l=new Set;for(const{keys:d,data:h}of e(a)){let m=s;for(const E of d)m=m?.get(E);let g=m;if(g===void 0){const E=new pS,w=new mr(h);N.debug(`[${t}] Creating item with keys ${d.join(", ")}`),g={scope:E,keys:d,data$:w,item:n(E,w,...d)}}else g.data$.next(h);let y=c;for(let E=0;E<d.length-1;E++){let w=y.get(d[E]);w===void 0&&(w=new Map,y.set(d[E],w)),y=w}const v=d[d.length-1];if(y.has(v))throw new Error(`Keys must be unique (tried to generate multiple items for key ${d.join(", ")})`);y.set(d[d.length-1],g),l.add(g)}for(const d of o)l.has(d)||(N.debug(`[${t}] Destroying item with keys ${d.keys.join(", ")}`),d.scope.end());return{map:c,items:l,input:a}},{map:new Map,items:new Set}),kGe(({items:s})=>{N.debug(`[${t}] End of scope, destroying all ${s.size} items…`);for(const o of s)N.debug(`[${t}] Destroying item with keys ${o.keys.join(", ")}`),o.scope.end()}),ve(({items:s,input:o})=>r([...s].map(({item:a})=>a),o)))}function FR(t){return new mr(t)}const Dz="earpiece-id",due=Dc==="ios"?FR(!0):Kle.value$;function $R(t,e,n,r){const i=a=>r.error("Error creating MediaDeviceObserver",a),s=Lz(t,i,!1),o=Lz(t,i,!0);return n.behavior(e.pipe(gt(a=>a?s.pipe(IGe((c,l)=>l===0&&c.every(d=>!d.label),o)):s)),[])}function w9(t){return new Map(t.map((e,n)=>[e.deviceId,e.label?{type:"name",name:e.label}:{type:"number",number:n+1}]))}function E9(t,e){return ot([t,e],(n,r)=>{if(n.size)return r!==void 0&&n.has(r)||n.size===1&&n.has("")?r:n.keys().next().value})}class LGe{constructor(e,n){this.usingNames$=e,this.scope=n,this.logger=N.getChild("[MediaDevices AudioInput]"),this.availableRaw$=$R("audioinput",this.usingNames$,this.scope,this.logger),this.available$=this.scope.behavior(this.availableRaw$.pipe(ve(w9))),this.selected$=this.scope.behavior(E9(this.available$,_z.value$).pipe(ve(r=>r===void 0?void 0:{id:r,hardwareDeviceChange$:this.availableRaw$.pipe(ve(i=>i.find(s=>s.deviceId===r)?.groupId),Yv(),ri(([i,s])=>i!==s),ve(()=>{}))}))),this.available$.subscribe(r=>{this.logger.info("[audio-input] available devices:",r)})}select(e){_z.setValue(e)}}class MGe{constructor(e,n){this.usingNames$=e,this.scope=n,this.logger=N.getChild("[MediaDevices AudioOutput]"),this.available$=this.scope.behavior($R("audiooutput",this.usingNames$,this.scope,this.logger).pipe(ve(r=>{let i=w9(r);return i.size&&!i.has("")&&!i.has("default")&&i.set("",{type:"default",name:r[0]?.label||null}),window.GestureEvent&&(i=new Map),i}))),this.selected$=this.scope.behavior(E9(this.available$,Sz.value$).pipe(ve(r=>r===void 0?void 0:{id:r,virtualEarpiece:!1}))),this.available$.subscribe(r=>{this.logger.info("[audio-output] available devices:",r)})}select(e){Sz.setValue(e)}}class OGe{constructor(e,n){this.usingNames$=e,this.scope=n,this.logger=N.getChild("[MediaDevices ControlledAudioOutput]"),this.availableRaw$=$R("audiooutput",this.usingNames$,this.scope,this.logger),this.available$=this.scope.behavior(ot([nue.pipe(xn([])),due],(r,i)=>{const s=new Map(r.map(({id:o,name:a,isEarpiece:c,isSpeaker:l})=>{let d;return c?d={type:"earpiece"}:l?d={type:"speaker"}:d={type:"name",name:a},[o,d]}));return i&&r.some(o=>o.forEarpiece)&&s.set(Dz,{type:"earpiece"}),s})),this.deviceSelection$=new Ar,this.selected$=this.scope.behavior(ot([this.available$,Xu(rue.pipe(xn(void 0)),this.deviceSelection$)],(r,i)=>{const s=i??r.keys().next().value;return s===void 0?void 0:{id:s,virtualEarpiece:s===Dz}})),this.selected$.subscribe(r=>{r!==void 0&&(this.logger.info("[controlled-output] onAudioDeviceSelect called:",r),window.controls.onAudioDeviceSelect?.(r.id),window.controls.onOutputDeviceSelect?.(r.id))}),this.available$.subscribe(r=>{this.logger.info("[controlled-output] available devices:",r)}),this.availableRaw$.subscribe(r=>{this.logger.info("[controlled-output] available raw devices:",r)})}select(e){this.deviceSelection$.next(e)}}class PGe{constructor(e,n){this.usingNames$=e,this.scope=n,this.logger=N.getChild("[MediaDevices VideoInput]"),this.available$=this.scope.behavior($R("videoinput",this.usingNames$,this.scope,this.logger).pipe(ve(w9))),this.selected$=this.scope.behavior(E9(this.available$,wz.value$).pipe(ve(r=>r===void 0?void 0:{id:r}))),this.available$.subscribe(r=>{this.logger.info("[video-input] available devices:",r)})}select(e){wz.setValue(e)}}class DGe{constructor(e){this.scope=e,this.deviceNamesRequest$=new Ar,this.usingNames$=this.scope.behavior(this.deviceNamesRequest$.pipe(ve(()=>!0)),!1),this.audioInput=new LGe(this.usingNames$,this.scope),this.audioOutput=ur().controlledAudioDevices?new OGe(this.usingNames$,this.scope):new MGe(this.usingNames$,this.scope),this.videoInput=new PGe(this.usingNames$,this.scope)}requestDeviceNames(){this.deviceNamesRequest$.next()}}function NGe(t,e,n){if(!n)return _.useState(e)[0];const[r]=_.useState(()=>new mr(n)),[i]=_.useState(()=>e(r)),s=_.useRef(!0);return t(()=>{if(s.current){s.current=!1;return}r.next(n)},n),i}function fue(t,e){return NGe(_.useEffect,t,e)}var UGe=t=>t+1|0,jGe=()=>{const t=_.useState(0)[1];return _.useRef(()=>t(UGe)).current},FGe=typeof window>"u"?_.useEffect:_.useLayoutEffect;function vo(t){const e=jGe(),n=_.useRef(t),r=_.useRef(),i=_.useRef(!1),s=_.useRef(!1),[o,a]=_.useState(()=>{let c;return t.subscribe({next:l=>{s.current=!0,c=l},error:l=>{r.current=l}}).unsubscribe(),c});if(FGe(()=>{n.current=t}),_.useEffect(()=>{r.current=null;const c=n.current;let l=o;const d=c.subscribe({next:h=>{c===n.current&&(i.current?a(()=>h):l=h)},error:h=>{c===n.current&&(r.current=h,e())}});return i.current||l!==o&&a(()=>l),i.current=!0,()=>{d.unsubscribe()}},[t]),r.current)throw r.current;if(s.current)return _.useDebugValue(o),o;throw new Error("Observable did not synchronously emit a value.")}function $Ge(t){const[e]=_.useState(()=>new mr(t)),[n]=_.useState(()=>({get current(){return e.value},set current(r){e.next(r)}}));return[n,e]}const hue=_.createContext(void 0);function vm(){const t=_.use(hue);if(t===void 0)throw new Error("useMediaDevices must be used within a MediaDevices context provider");return t}const pue=()=>{const t=vm(),n=vo(t.audioOutput.selected$)?.virtualEarpiece??!1;return{pan:_.useMemo(()=>n?1:0,[n]),volume:_.useMemo(()=>n?.1:1,[n])}},BGe=()=>{const{t}=et(),[e,n]=$r(Ble),[r,i]=$r(Hle),[s,o]=$r(b9),a=(d,h)=>{h(d.target.checked)},[c,l]=$r(jle);return S.jsxs("div",{children:[S.jsx(an,{children:t("settings.preferences_tab.introduction")}),S.jsx(Nt,{children:S.jsx(er,{id:"showHandRaisedTimer",label:t("settings.preferences_tab.show_hand_raised_timer_label"),description:t("settings.preferences_tab.show_hand_raised_timer_description"),type:"checkbox",checked:e,onChange:d=>a(d,n)})}),S.jsx(Nt,{children:S.jsx(er,{id:"showReactions",label:t("settings.preferences_tab.reactions_show_label"),description:t("settings.preferences_tab.reactions_show_description"),type:"checkbox",checked:r,onChange:d=>a(d,i)})}),S.jsx(Nt,{children:S.jsx(er,{id:"playReactionSound",label:t("settings.preferences_tab.reactions_play_sound_label"),description:t("settings.preferences_tab.reactions_play_sound_description"),type:"checkbox",checked:s,onChange:d=>a(d,o)})}),S.jsx(Nt,{children:S.jsx(er,{id:"developerSettingsTab",type:"checkbox",checked:c,label:t("settings.preferences_tab.developer_mode_label"),description:t("settings.preferences_tab.developer_mode_label_description"),onChange:d=>l(d.target.checked)})})]})};function mue(t,[e,n]){return Math.min(n,Math.max(e,t))}function HGe(t){const e=_.useRef({value:t,previous:t});return _.useMemo(()=>(e.current.value!==t&&(e.current.previous=e.current.value,e.current.value=t),e.current.previous),[t])}var qGe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],mS=qGe.reduce((t,e)=>{const n=_o(`Primitive.${e}`),r=_.forwardRef((i,s)=>{const{asChild:o,...a}=i,c=o?n:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),S.jsx(c,{...a,ref:s})});return r.displayName=`Primitive.${e}`,{...t,[e]:r}},{}),gue=["PageUp","PageDown"],vue=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],yue={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},Oy="Slider",[rO,VGe,KGe]=O7(Oy),[bue,Qot]=sm(Oy,[KGe]),[GGe,BR]=bue(Oy),_ue=_.forwardRef((t,e)=>{const{name:n,min:r=0,max:i=100,step:s=1,orientation:o="horizontal",disabled:a=!1,minStepsBetweenThumbs:c=0,defaultValue:l=[r],value:d,onValueChange:h=()=>{},onValueCommit:m=()=>{},inverted:g=!1,form:y,...v}=t,E=_.useRef(new Set),w=_.useRef(0),x=o==="horizontal"?zGe:WGe,[C=[],k]=$7({prop:d,defaultProp:l,onChange:j=>{[...E.current][w.current]?.focus(),h(j)}}),T=_.useRef(C);function L(j){const H=ZGe(C,j);D(j,H)}function O(j){D(j,w.current)}function P(){const j=T.current[w.current];C[w.current]!==j&&m(C)}function D(j,H,{commit:z}={commit:!1}){const Y=rze(s),W=ize(Math.round((j-r)/s)*s+r,Y),F=mue(W,[r,i]);k(($=[])=>{const V=JGe($,F,H);if(nze(V,c*s)){w.current=V.indexOf(F);const G=String(V)!==String($);return G&&z&&m(V),G?V:$}else return $})}return S.jsx(GGe,{scope:t.__scopeSlider,name:n,disabled:a,min:r,max:i,valueIndexToChangeRef:w,thumbs:E.current,values:C,orientation:o,form:y,children:S.jsx(rO.Provider,{scope:t.__scopeSlider,children:S.jsx(rO.Slot,{scope:t.__scopeSlider,children:S.jsx(x,{"aria-disabled":a,"data-disabled":a?"":void 0,...v,ref:e,onPointerDown:bt(v.onPointerDown,()=>{a||(T.current=C)}),min:r,max:i,inverted:g,onSlideStart:a?void 0:L,onSlideMove:a?void 0:O,onSlideEnd:a?void 0:P,onHomeKeyDown:()=>!a&&D(r,0,{commit:!0}),onEndKeyDown:()=>!a&&D(i,C.length-1,{commit:!0}),onStepKeyDown:({event:j,direction:H})=>{if(!a){const W=gue.includes(j.key)||j.shiftKey&&vue.includes(j.key)?10:1,F=w.current,$=C[F],V=s*W*H;D($+V,F,{commit:!0})}}})})})})});_ue.displayName=Oy;var[Sue,wue]=bue(Oy,{startEdge:"left",endEdge:"right",size:"width",direction:1}),zGe=_.forwardRef((t,e)=>{const{min:n,max:r,dir:i,inverted:s,onSlideStart:o,onSlideMove:a,onSlideEnd:c,onStepKeyDown:l,...d}=t,[h,m]=_.useState(null),g=br(e,x=>m(x)),y=_.useRef(void 0),v=P7(i),E=v==="ltr",w=E&&!s||!E&&s;function R(x){const C=y.current||h.getBoundingClientRect(),k=[0,C.width],L=C9(k,w?[n,r]:[r,n]);return y.current=C,L(x-C.left)}return S.jsx(Sue,{scope:t.__scopeSlider,startEdge:w?"left":"right",endEdge:w?"right":"left",direction:w?1:-1,size:"width",children:S.jsx(Eue,{dir:v,"data-orientation":"horizontal",...d,ref:g,style:{...d.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:x=>{const C=R(x.clientX);o?.(C)},onSlideMove:x=>{const C=R(x.clientX);a?.(C)},onSlideEnd:()=>{y.current=void 0,c?.()},onStepKeyDown:x=>{const k=yue[w?"from-left":"from-right"].includes(x.key);l?.({event:x,direction:k?-1:1})}})})}),WGe=_.forwardRef((t,e)=>{const{min:n,max:r,inverted:i,onSlideStart:s,onSlideMove:o,onSlideEnd:a,onStepKeyDown:c,...l}=t,d=_.useRef(null),h=br(e,d),m=_.useRef(void 0),g=!i;function y(v){const E=m.current||d.current.getBoundingClientRect(),w=[0,E.height],x=C9(w,g?[r,n]:[n,r]);return m.current=E,x(v-E.top)}return S.jsx(Sue,{scope:t.__scopeSlider,startEdge:g?"bottom":"top",endEdge:g?"top":"bottom",size:"height",direction:g?1:-1,children:S.jsx(Eue,{"data-orientation":"vertical",...l,ref:h,style:{...l.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:v=>{const E=y(v.clientY);s?.(E)},onSlideMove:v=>{const E=y(v.clientY);o?.(E)},onSlideEnd:()=>{m.current=void 0,a?.()},onStepKeyDown:v=>{const w=yue[g?"from-bottom":"from-top"].includes(v.key);c?.({event:v,direction:w?-1:1})}})})}),Eue=_.forwardRef((t,e)=>{const{__scopeSlider:n,onSlideStart:r,onSlideMove:i,onSlideEnd:s,onHomeKeyDown:o,onEndKeyDown:a,onStepKeyDown:c,...l}=t,d=BR(Oy,n);return S.jsx(mS.span,{...l,ref:e,onKeyDown:bt(t.onKeyDown,h=>{h.key==="Home"?(o(h),h.preventDefault()):h.key==="End"?(a(h),h.preventDefault()):gue.concat(vue).includes(h.key)&&(c(h),h.preventDefault())}),onPointerDown:bt(t.onPointerDown,h=>{const m=h.target;m.setPointerCapture(h.pointerId),h.preventDefault(),d.thumbs.has(m)?m.focus():r(h)}),onPointerMove:bt(t.onPointerMove,h=>{h.target.hasPointerCapture(h.pointerId)&&i(h)}),onPointerUp:bt(t.onPointerUp,h=>{const m=h.target;m.hasPointerCapture(h.pointerId)&&(m.releasePointerCapture(h.pointerId),s(h))})})}),Cue="SliderTrack",Tue=_.forwardRef((t,e)=>{const{__scopeSlider:n,...r}=t,i=BR(Cue,n);return S.jsx(mS.span,{"data-disabled":i.disabled?"":void 0,"data-orientation":i.orientation,...r,ref:e})});Tue.displayName=Cue;var iO="SliderRange",Rue=_.forwardRef((t,e)=>{const{__scopeSlider:n,...r}=t,i=BR(iO,n),s=wue(iO,n),o=_.useRef(null),a=br(e,o),c=i.values.length,l=i.values.map(m=>xue(m,i.min,i.max)),d=c>1?Math.min(...l):0,h=100-Math.max(...l);return S.jsx(mS.span,{"data-orientation":i.orientation,"data-disabled":i.disabled?"":void 0,...r,ref:a,style:{...t.style,[s.startEdge]:d+"%",[s.endEdge]:h+"%"}})});Rue.displayName=iO;var sO="SliderThumb",kue=_.forwardRef((t,e)=>{const n=VGe(t.__scopeSlider),[r,i]=_.useState(null),s=br(e,a=>i(a)),o=_.useMemo(()=>r?n().findIndex(a=>a.ref.current===r):-1,[n,r]);return S.jsx(YGe,{...t,ref:s,index:o})}),YGe=_.forwardRef((t,e)=>{const{__scopeSlider:n,index:r,name:i,...s}=t,o=BR(sO,n),a=wue(sO,n),[c,l]=_.useState(null),d=br(e,R=>l(R)),h=c?o.form||!!c.closest("form"):!0,m=gre(c),g=o.values[r],y=g===void 0?0:xue(g,o.min,o.max),v=QGe(r,o.values.length),E=m?.[a.size],w=E?eze(E,y,a.direction):0;return _.useEffect(()=>{if(c)return o.thumbs.add(c),()=>{o.thumbs.delete(c)}},[c,o.thumbs]),S.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[a.startEdge]:`calc(${y}% + ${w}px)`},children:[S.jsx(rO.ItemSlot,{scope:t.__scopeSlider,children:S.jsx(mS.span,{role:"slider","aria-label":t["aria-label"]||v,"aria-valuemin":o.min,"aria-valuenow":g,"aria-valuemax":o.max,"aria-orientation":o.orientation,"data-orientation":o.orientation,"data-disabled":o.disabled?"":void 0,tabIndex:o.disabled?void 0:0,...s,ref:d,style:g===void 0?{display:"none"}:t.style,onFocus:bt(t.onFocus,()=>{o.valueIndexToChangeRef.current=r})})}),h&&S.jsx(Iue,{name:i??(o.name?o.name+(o.values.length>1?"[]":""):void 0),form:o.form,value:g},r)]})});kue.displayName=sO;var XGe="RadioBubbleInput",Iue=_.forwardRef(({__scopeSlider:t,value:e,...n},r)=>{const i=_.useRef(null),s=br(i,r),o=HGe(e);return _.useEffect(()=>{const a=i.current;if(!a)return;const c=window.HTMLInputElement.prototype,d=Object.getOwnPropertyDescriptor(c,"value").set;if(o!==e&&d){const h=new Event("input",{bubbles:!0});d.call(a,e),a.dispatchEvent(h)}},[o,e]),S.jsx(mS.input,{style:{display:"none"},...n,ref:s,defaultValue:e})});Iue.displayName=XGe;function JGe(t=[],e,n){const r=[...t];return r[n]=e,r.sort((i,s)=>i-s)}function xue(t,e,n){const s=100/(n-e)*(t-e);return mue(s,[0,100])}function QGe(t,e){return e>2?`Value ${t+1} of ${e}`:e===2?["Minimum","Maximum"][t]:void 0}function ZGe(t,e){if(t.length===1)return 0;const n=t.map(i=>Math.abs(i-e)),r=Math.min(...n);return n.indexOf(r)}function eze(t,e,n){const r=t/2,s=C9([0,50],[0,r]);return(r-s(e)*n)*n}function tze(t){return t.slice(0,-1).map((e,n)=>t[n+1]-e)}function nze(t,e){if(e>0){const n=tze(t);return Math.min(...n)>=e}return!0}function C9(t,e){return n=>{if(t[0]===t[1]||e[0]===e[1])return e[0];const r=(e[1]-e[0])/(t[1]-t[0]);return e[0]+r*(n-t[0])}}function rze(t){return(String(t).split(".")[1]||"").length}function ize(t,e){const n=Math.pow(10,e);return Math.round(t*n)/n}var sze=_ue,oze=Tue,aze=Rue,cze=kue;const lze="_slider_15go1_8",uze="_track_15go1_14",dze="_highlight_15go1_31",fze="_handle_15go1_43",Vw={slider:lze,track:uze,highlight:dze,handle:fze},Aue=({className:t,label:e,value:n,onValueChange:r,onValueCommit:i,min:s,max:o,step:a,disabled:c})=>{const l=_.useCallback(([h])=>r(h),[r]),d=_.useCallback(([h])=>i?.(h),[i]);return S.jsxs(sze,{className:Le(t,Vw.slider),value:[n],onValueChange:l,onValueCommit:d,min:s,max:o,step:a,disabled:c,children:[S.jsx(oze,{className:Vw.track,children:S.jsx(aze,{className:Vw.highlight})}),S.jsx(bi,{placement:"top",label:Math.round(n*100).toString()+"%",children:S.jsx(cze,{className:Vw.handle,"aria-label":e})})]})},hze="_selection_1akwb_1",pze="_title_1akwb_5",mze="_separator_1akwb_10",gze="_options_1akwb_14",vze="_secondary_1akwb_20",f1={selection:hze,title:pze,separator:mze,options:gze,secondary:vze},Z6=({device:t,title:e,numberedLabel:n})=>{const{t:r}=et(),i=_.useId(),s=vo(t.available$),o=vo(t.selected$)?.id,a=_.useCallback(c=>{t.select(c.target.value)},[t]);return s.size<=1?null:S.jsxs("div",{className:f1.selection,children:[S.jsx(Hc,{type:"body",weight:"semibold",size:"sm",as:"h4",className:f1.title,children:e}),S.jsx(O8,{className:f1.separator}),S.jsx("div",{className:f1.options,children:[...s].map(([c,l])=>{let d;switch(l.type){case"name":d=l.name;break;case"number":d=n(l.number);break;case"default":d=l.name===null?r("settings.devices.default"):S.jsxs(mo,{i18nKey:"settings.devices.default_named",name:l.name,children:["Default"," ",S.jsxs("span",{className:f1.secondary,children:["(",{name:l.name},")"]})]});break;case"speaker":d=r("settings.devices.loudspeaker");break;case"earpiece":d=r("settings.devices.handset");break}return S.jsx(JE,{name:i,control:S.jsx(XE,{checked:c===o,onChange:a,value:c}),children:S.jsx(ib,{children:d})},c)})})]})};var Vp=typeof self<"u"?self:{};function Xh(){throw Error("Invalid UTF8")}function Nz(t,e){return e=String.fromCharCode.apply(null,e),t==null?e:t+e}let Kw,e5;const yze=typeof TextDecoder<"u";let bze;const _ze=typeof TextEncoder<"u";function Lue(t){if(_ze)t=(bze||=new TextEncoder).encode(t);else{let n=0;const r=new Uint8Array(3*t.length);for(let i=0;i<t.length;i++){var e=t.charCodeAt(i);if(e<128)r[n++]=e;else{if(e<2048)r[n++]=e>>6|192;else{if(e>=55296&&e<=57343){if(e<=56319&&i<t.length){const s=t.charCodeAt(++i);if(s>=56320&&s<=57343){e=1024*(e-55296)+s-56320+65536,r[n++]=e>>18|240,r[n++]=e>>12&63|128,r[n++]=e>>6&63|128,r[n++]=63&e|128;continue}i--}e=65533}r[n++]=e>>12|224,r[n++]=e>>6&63|128}r[n++]=63&e|128}}t=n===r.length?r:r.subarray(0,n)}return t}var T9,q3;e:{for(var Uz=["CLOSURE_FLAGS"],t5=Vp,n5=0;n5<Uz.length;n5++)if((t5=t5[Uz[n5]])==null){q3=null;break e}q3=t5}var b_,jz=q3&&q3[610401301];T9=jz!=null&&jz;const Fz=Vp.navigator;function oO(t){return!!T9&&!!b_&&b_.brands.some((({brand:e})=>e&&e.indexOf(t)!=-1))}function Ma(t){var e;return(e=Vp.navigator)&&(e=e.userAgent)||(e=""),e.indexOf(t)!=-1}function vf(){return!!T9&&!!b_&&b_.brands.length>0}function r5(){return vf()?oO("Chromium"):(Ma("Chrome")||Ma("CriOS"))&&!(!vf()&&Ma("Edge"))||Ma("Silk")}function R9(t){return R9[" "](t),t}b_=Fz&&Fz.userAgentData||null,R9[" "]=function(){};var Sze=!vf()&&(Ma("Trident")||Ma("MSIE"));!Ma("Android")||r5(),r5(),Ma("Safari")&&(r5()||!vf()&&Ma("Coast")||!vf()&&Ma("Opera")||!vf()&&Ma("Edge")||(vf()?oO("Microsoft Edge"):Ma("Edg/"))||vf()&&oO("Opera"));var Mue={},N1=null;function wze(t){const e=t.length;let n=3*e/4;n%3?n=Math.floor(n):"=.".indexOf(t[e-1])!=-1&&(n="=.".indexOf(t[e-2])!=-1?n-2:n-1);const r=new Uint8Array(n);let i=0;return(function(s,o){function a(l){for(;c<s.length;){const d=s.charAt(c++),h=N1[d];if(h!=null)return h;if(!/^[\s\xa0]*$/.test(d))throw Error("Unknown base64 encoding at char: "+d)}return l}Oue();let c=0;for(;;){const l=a(-1),d=a(0),h=a(64),m=a(64);if(m===64&&l===-1)break;o(l<<2|d>>4),h!=64&&(o(d<<4&240|h>>2),m!=64&&o(h<<6&192|m))}})(t,(function(s){r[i++]=s})),i!==n?r.subarray(0,i):r}function Oue(){if(!N1){N1={};var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),e=["+/=","+/","-_=","-_.","-_"];for(let n=0;n<5;n++){const r=t.concat(e[n].split(""));Mue[n]=r;for(let i=0;i<r.length;i++){const s=r[i];N1[s]===void 0&&(N1[s]=i)}}}}var Pue=typeof Uint8Array<"u",Due=!Sze&&typeof btoa=="function";function $z(t){if(!Due){var e;e===void 0&&(e=0),Oue(),e=Mue[e];var n=Array(Math.floor(t.length/3)),r=e[64]||"";let c=0,l=0;for(;c<t.length-2;c+=3){var i=t[c],s=t[c+1],o=t[c+2],a=e[i>>2];i=e[(3&i)<<4|s>>4],s=e[(15&s)<<2|o>>6],o=e[63&o],n[l++]=a+i+s+o}switch(a=0,o=r,t.length-c){case 2:o=e[(15&(a=t[c+1]))<<2]||r;case 1:t=t[c],n[l]=e[t>>2]+e[(3&t)<<4|a>>4]+o+r}return n.join("")}for(e="",n=0,r=t.length-10240;n<r;)e+=String.fromCharCode.apply(null,t.subarray(n,n+=10240));return e+=String.fromCharCode.apply(null,n?t.subarray(n):t),btoa(e)}const Bz=/[-_.]/g,Eze={"-":"+",_:"/",".":"="};function Cze(t){return Eze[t]||""}function Nue(t){if(!Due)return wze(t);Bz.test(t)&&(t=t.replace(Bz,Cze)),t=atob(t);const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}function gS(t){return Pue&&t!=null&&t instanceof Uint8Array}var Jv={};function Kp(){return Tze||=new Ju(null,Jv)}function k9(t){Uue(Jv);var e=t.g;return(e=e==null||gS(e)?e:typeof e=="string"?Nue(e):null)==null?e:t.g=e}var Ju=class{h(){return new Uint8Array(k9(this)||0)}constructor(t,e){if(Uue(e),this.g=t,t!=null&&t.length===0)throw Error("ByteString should be constructed with non-empty values")}};let Tze,Rze;function Uue(t){if(t!==Jv)throw Error("illegal external caller")}function jue(t,e){t.__closure__error__context__984382||(t.__closure__error__context__984382={}),t.__closure__error__context__984382.severity=e}function aO(t){return jue(t=Error(t),"warning"),t}var HR=typeof Symbol=="function"&&typeof Symbol()=="symbol",kze=new Set;function vS(t,e,n=!1,r=!1){return t=typeof Symbol=="function"&&typeof Symbol()=="symbol"?r&&Symbol.for&&t?Symbol.for(t):t!=null?Symbol(t):Symbol():e,n&&kze.add(t),t}var Ize=vS("jas",void 0,!0,!0),Hz=vS(void 0,"0di"),i5=vS(void 0,"2ex"),h1=vS(void 0,"1oa",!0),Qv=vS(void 0,Symbol(),!0);const Ze=HR?Ize:"Ga",Fue={Ga:{value:0,configurable:!0,writable:!0,enumerable:!1}},$ue=Object.defineProperties;function qR(t,e){HR||Ze in t||$ue(t,Fue),t[Ze]|=e}function ii(t,e){HR||Ze in t||$ue(t,Fue),t[Ze]=e}function Py(t){return qR(t,34),t}function xze(t,e){ii(e,-30975&(0|t))}function cO(t,e){ii(e,-30941&(34|t))}function I9(){return typeof BigInt=="function"}function yo(t){return Array.prototype.slice.call(t)}var x9,yS={},Bue={};function qz(t){return!(!t||typeof t!="object"||t.Ia!==Bue)}function A9(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)&&t.constructor===Object}function L9(t,e){if(t!=null){if(typeof t=="string")t=t?new Ju(t,Jv):Kp();else if(t.constructor!==Ju)if(gS(t))t=t.length?new Ju(new Uint8Array(t),Jv):Kp();else{if(!e)throw Error();t=void 0}}return t}function V3(t){return!(!Array.isArray(t)||t.length)&&!!(1&(0|t[Ze]))}const Vz=[];function vh(t){if(2&t)throw Error()}ii(Vz,55),x9=Object.freeze(Vz);let Kz=class Hue{constructor(e,n,r){this.l=0,this.g=e,this.h=n,this.m=r}next(){if(this.l<this.g.length){const e=this.g[this.l++];return{done:!1,value:this.h?this.h.call(this.m,e):e}}return{done:!0,value:void 0}}[Symbol.iterator](){return new Hue(this.g,this.h,this.m)}};function M9(t){return Qv?t[Qv]:void 0}var Aze=Object.freeze({});function VR(t){return t.Qa=!0,t}var Lze=VR((t=>typeof t=="number")),Gz=VR((t=>typeof t=="string")),Mze=VR((t=>typeof t=="boolean")),KR=typeof Vp.BigInt=="function"&&typeof Vp.BigInt(0)=="bigint",lO=VR((t=>KR?t>=Pze&&t<=Nze:t[0]==="-"?zz(t,Oze):zz(t,Dze)));const Oze=Number.MIN_SAFE_INTEGER.toString(),Pze=KR?BigInt(Number.MIN_SAFE_INTEGER):void 0,Dze=Number.MAX_SAFE_INTEGER.toString(),Nze=KR?BigInt(Number.MAX_SAFE_INTEGER):void 0;function zz(t,e){if(t.length>e.length)return!1;if(t.length<e.length||t===e)return!0;for(let n=0;n<t.length;n++){const r=t[n],i=e[n];if(r>i)return!1;if(r<i)return!0}}const Uze=typeof Uint8Array.prototype.slice=="function";let que,Dn=0,Lr=0;function Wz(t){const e=t>>>0;Dn=e,Lr=(t-e)/4294967296>>>0}function Zv(t){if(t<0){Wz(-t);const[e,n]=N9(Dn,Lr);Dn=e>>>0,Lr=n>>>0}else Wz(t)}function O9(t){const e=que||=new DataView(new ArrayBuffer(8));e.setFloat32(0,+t,!0),Lr=0,Dn=e.getUint32(0,!0)}function P9(t,e){const n=4294967296*e+(t>>>0);return Number.isSafeInteger(n)?n:__(t,e)}function D9(t,e){const n=2147483648&e;return n&&(e=~e>>>0,(t=1+~t>>>0)==0&&(e=e+1>>>0)),typeof(t=P9(t,e))=="number"?n?-t:t:n?"-"+t:t}function __(t,e){if(t>>>=0,(e>>>=0)<=2097151)var n=""+(4294967296*e+t);else I9()?n=""+(BigInt(e)<<BigInt(32)|BigInt(t)):(t=(16777215&t)+6777216*(n=16777215&(t>>>24|e<<8))+6710656*(e=e>>16&65535),n+=8147497*e,e*=2,t>=1e7&&(n+=t/1e7>>>0,t%=1e7),n>=1e7&&(e+=n/1e7>>>0,n%=1e7),n=e+Yz(n)+Yz(t));return n}function Yz(t){return t=String(t),"0000000".slice(t.length)+t}function GR(t){if(t.length<16)Zv(Number(t));else if(I9())t=BigInt(t),Dn=Number(t&BigInt(4294967295))>>>0,Lr=Number(t>>BigInt(32)&BigInt(4294967295));else{const e=+(t[0]==="-");Lr=Dn=0;const n=t.length;for(let r=e,i=(n-e)%6+e;i<=n;r=i,i+=6){const s=Number(t.slice(r,i));Lr*=1e6,Dn=1e6*Dn+s,Dn>=4294967296&&(Lr+=Math.trunc(Dn/4294967296),Lr>>>=0,Dn>>>=0)}if(e){const[r,i]=N9(Dn,Lr);Dn=r,Lr=i}}}function N9(t,e){return e=~e,t?t=1+~t:e+=1,[t,e]}const U9=typeof BigInt=="function"?BigInt.asIntN:void 0,jze=typeof BigInt=="function"?BigInt.asUintN:void 0,gv=Number.isSafeInteger,zR=Number.isFinite,K3=Math.trunc;function yh(t){return t==null||typeof t=="number"?t:t==="NaN"||t==="Infinity"||t==="-Infinity"?Number(t):void 0}function Vue(t){return t==null||typeof t=="boolean"?t:typeof t=="number"?!!t:void 0}const Fze=/^-?([1-9][0-9]*|0)(\.[0-9]+)?$/;function WR(t){switch(typeof t){case"bigint":return!0;case"number":return zR(t);case"string":return Fze.test(t);default:return!1}}function Dy(t){if(t==null)return t;if(typeof t=="string"&&t)t=+t;else if(typeof t!="number")return;return zR(t)?0|t:void 0}function Kue(t){if(t==null)return t;if(typeof t=="string"&&t)t=+t;else if(typeof t!="number")return;return zR(t)?t>>>0:void 0}function Xz(t){if(t[0]==="-")return!1;const e=t.length;return e<20||e===20&&Number(t.substring(0,6))<184467}function j9(t){return t=K3(t),gv(t)||(Zv(t),t=D9(Dn,Lr)),t}function F9(t){var e=K3(Number(t));if(gv(e))return String(e);if((e=t.indexOf("."))!==-1&&(t=t.substring(0,e)),e=t.length,!(t[0]==="-"?e<20||e===20&&Number(t.substring(0,7))>-922337:e<19||e===19&&Number(t.substring(0,6))<922337))if(GR(t),t=Dn,2147483648&(e=Lr))if(I9())t=""+(BigInt(0|e)<<BigInt(32)|BigInt(t>>>0));else{const[n,r]=N9(t,e);t="-"+__(n,r)}else t=__(t,e);return t}function G3(t){return t==null?t:typeof t=="bigint"?(lO(t)?t=Number(t):(t=U9(64,t),t=lO(t)?Number(t):String(t)),t):WR(t)?typeof t=="number"?j9(t):F9(t):void 0}function $ze(t){if(t==null)return t;var e=typeof t;if(e==="bigint")return String(jze(64,t));if(WR(t)){if(e==="string")return e=K3(Number(t)),gv(e)&&e>=0?t=String(e):((e=t.indexOf("."))!==-1&&(t=t.substring(0,e)),Xz(t)||(GR(t),t=__(Dn,Lr))),t;if(e==="number")return(t=K3(t))>=0&&gv(t)?t:(function(n){if(n<0){Zv(n);var r=__(Dn,Lr);return n=Number(r),gv(n)?n:r}return Xz(r=String(n))?r:(Zv(n),P9(Dn,Lr))})(t)}}function Gue(t){if(typeof t!="string")throw Error();return t}function Ny(t){if(t!=null&&typeof t!="string")throw Error();return t}function ey(t){return t==null||typeof t=="string"?t:void 0}function $9(t,e,n,r){if(t!=null&&typeof t=="object"&&t.W===yS)return t;if(!Array.isArray(t))return n?2&r?((t=e[Hz])||(Py((t=new e).u),t=e[Hz]=t),e=t):e=new e:e=void 0,e;let i=n=0|t[Ze];return i===0&&(i|=32&r),i|=2&r,i!==n&&ii(t,i),new e(t)}function Bze(t,e,n){if(e)e:{if(!WR(e=t))throw aO("int64");switch(typeof e){case"string":e=F9(e);break e;case"bigint":if(t=e=U9(64,e),Gz(t)){if(!/^\s*(?:-?[1-9]\d*|0)?\s*$/.test(t))throw Error(String(t))}else if(Lze(t)&&!Number.isSafeInteger(t))throw Error(String(t));e=KR?BigInt(e):Mze(e)?e?"1":"0":Gz(e)?e.trim()||"0":String(e);break e;default:e=j9(e)}}else e=G3(t);return typeof(n=(t=e)==null?n?0:void 0:t)=="string"&&gv(e=+n)?e:n}const Hze={};let qze=(function(){try{return R9(new class extends Map{constructor(){super()}}),!1}catch{return!0}})();class s5{constructor(){this.g=new Map}get(e){return this.g.get(e)}set(e,n){return this.g.set(e,n),this.size=this.g.size,this}delete(e){return e=this.g.delete(e),this.size=this.g.size,e}clear(){this.g.clear(),this.size=this.g.size}has(e){return this.g.has(e)}entries(){return this.g.entries()}keys(){return this.g.keys()}values(){return this.g.values()}forEach(e,n){return this.g.forEach(e,n)}[Symbol.iterator](){return this.entries()}}const Vze=qze?(Object.setPrototypeOf(s5.prototype,Map.prototype),Object.defineProperties(s5.prototype,{size:{value:0,configurable:!0,enumerable:!0,writable:!0}}),s5):class extends Map{constructor(){super()}};function Jz(t){return t}function o5(t){if(2&t.L)throw Error("Cannot mutate an immutable Map")}var Ja=class extends Vze{constructor(t,e,n=Jz,r=Jz){super();let i=0|t[Ze];i|=64,ii(t,i),this.L=i,this.S=e,this.R=n,this.Y=this.S?Kze:r;for(let s=0;s<t.length;s++){const o=t[s],a=n(o[0],!1,!0);let c=o[1];e?c===void 0&&(c=null):c=r(o[1],!1,!0,void 0,void 0,i),super.set(a,c)}}na(t=Qz){if(this.size!==0)return this.X(t)}X(t=Qz){const e=[],n=super.entries();for(var r;!(r=n.next()).done;)(r=r.value)[0]=t(r[0]),r[1]=t(r[1]),e.push(r);return e}clear(){o5(this),super.clear()}delete(t){return o5(this),super.delete(this.R(t,!0,!1))}entries(){var t=this.ma();return new Kz(t,Gze,this)}keys(){return this.Ha()}values(){var t=this.ma();return new Kz(t,Ja.prototype.get,this)}forEach(t,e){super.forEach(((n,r)=>{t.call(e,this.get(r),r,this)}))}set(t,e){return o5(this),(t=this.R(t,!0,!1))==null?this:e==null?(super.delete(t),this):super.set(t,this.Y(e,!0,!0,this.S,!1,this.L))}Na(t){const e=this.R(t[0],!1,!0);t=t[1],t=this.S?t===void 0?null:t:this.Y(t,!1,!0,void 0,!1,this.L),super.set(e,t)}has(t){return super.has(this.R(t,!1,!1))}get(t){t=this.R(t,!1,!1);const e=super.get(t);if(e!==void 0){var n=this.S;return n?((n=this.Y(e,!1,!0,n,this.ra,this.L))!==e&&super.set(t,n),n):e}}ma(){return Array.from(super.keys())}Ha(){return super.keys()}[Symbol.iterator](){return this.entries()}};function Kze(t,e,n,r,i,s){return t=$9(t,r,n,s),i&&(t=XR(t)),t}function Qz(t){return t}function Gze(t){return[t,this.get(t)]}let zze,zue,Wze;function Zz(){return zze||=new Ja(Py([]),void 0,void 0,void 0,Hze)}function B9(t,e,n,r,i){if(t!=null){if(Array.isArray(t))t=V3(t)?void 0:i&&2&(0|t[Ze])?t:H9(t,e,n,r!==void 0,i);else if(A9(t)){const s={};for(let o in t)s[o]=B9(t[o],e,n,r,i);t=s}else t=e(t,r);return t}}function H9(t,e,n,r,i){const s=r||n?0|t[Ze]:0,o=r?!!(32&s):void 0;r=yo(t);for(let a=0;a<r.length;a++)r[a]=B9(r[a],e,n,o,i);return n&&((t=M9(t))&&(r[Qv]=yo(t)),n(s,r)),r}function Yze(t){return B9(t,Wue,void 0,void 0,!1)}function Wue(t){return t.W===yS?t.toJSON():t instanceof Ja?t.na(Yze):(function(e){switch(typeof e){case"number":return isFinite(e)?e:String(e);case"bigint":return lO(e)?Number(e):String(e);case"boolean":return e?1:0;case"object":if(e)if(Array.isArray(e)){if(V3(e))return}else{if(gS(e))return $z(e);if(e instanceof Ju){const n=e.g;return n==null?"":typeof n=="string"?n:e.g=$z(n)}if(e instanceof Ja)return e.na()}}return e})(t)}function Yue(t){return H9(t,Wue,void 0,void 0,!1)}function Ff(t,e,n){return t=Xue(t,e[0],e[1],n?1:2),e!==zue&&n&&qR(t,16384),t}function Xue(t,e,n,r){if(t==null){var i=96;n?(t=[n],i|=512):t=[],e&&(i=-33521665&i|(1023&e)<<15)}else{if(!Array.isArray(t))throw Error("narr");if(2048&(i=0|t[Ze]))throw Error("farr");if(64&i)return t;if(r===1||r===2||(i|=64),n&&(i|=512,n!==t[0]))throw Error("mid");e:{if(r=(n=t).length){const s=r-1;if(A9(n[s])){if((e=s-(512&(i|=256)?0:-1))>=1024)throw Error("pvtlmt");i=-33521665&i|(1023&e)<<15;break e}}if(e){if((e=Math.max(e,r-(512&i?0:-1)))>1024)throw Error("spvt");i=-33521665&i|(1023&e)<<15}}}return ii(t,i),t}function uO(t,e,n=cO){if(t!=null){if(Pue&&t instanceof Uint8Array)return e?t:new Uint8Array(t);if(Array.isArray(t)){var r=0|t[Ze];return 2&r?t:(e&&=r===0||!!(32&r)&&!(64&r||!(16&r)),e?(ii(t,-12293&(34|r)),t):H9(t,uO,4&r?cO:n,!0,!0))}return t.W===yS?t=2&(r=0|(n=t.u)[Ze])?t:new t.constructor(YR(n,r,!0)):t instanceof Ja&&!(2&t.L)&&(n=Py(t.X(uO)),t=new Ja(n,t.S,t.R,t.Y)),t}}function YR(t,e,n){const r=n||2&e?cO:xze,i=!!(32&e);return t=(function(s,o,a){const c=yo(s);var l=c.length;const d=256&o?c[l-1]:void 0;for(l+=d?-1:0,o=512&o?1:0;o<l;o++)c[o]=a(c[o]);if(d){o=c[o]={};for(const h in d)o[h]=a(d[h])}return(s=M9(s))&&(c[Qv]=yo(s)),c})(t,e,(s=>uO(s,i,r))),qR(t,32|(n?2:0)),t}function XR(t){const e=t.u,n=0|e[Ze];return 2&n?new t.constructor(YR(e,n,!1)):t}function ty(t,e){return _d(t=t.u,0|t[Ze],e)}function _d(t,e,n,r){if(n===-1)return null;var i=n+(512&e?0:-1);const s=t.length-1;return i>=s&&256&e?t[s][n]:r&&256&e&&(e=t[s][n])!=null?(t[i]!=null&&i5!=null&&((i=(t=Rze??={})[i5]||0)>=4||(t[i5]=i+1,jue(t=Error(),"incident"),(function(o){Vp.setTimeout((()=>{throw o}),0)})(t))),e):i<=s?t[i]:void 0}function Hn(t,e,n){const r=t.u;let i=0|r[Ze];return vh(i),yr(r,i,e,n),t}function yr(t,e,n,r){const i=512&e?0:-1,s=n+i;var o=t.length-1;return s>=o&&256&e?(t[o][n]=r,e):s<=o?(t[s]=r,256&e&&n in(t=t[o])&&delete t[n],e):(r!==void 0&&(n>=(o=e>>15&1023||536870912)?r!=null&&(t[o+i]={[n]:r},ii(t,e|=256)):t[s]=r),e)}function oC(t,e){let n=0|(t=t.u)[Ze];const r=_d(t,n,e),i=yh(r);return i!=null&&i!==r&&yr(t,n,e,i),i}function Jue(t){let e=0|(t=t.u)[Ze];const n=_d(t,e,1),r=L9(n,!0);return r!=null&&r!==n&&yr(t,e,1,r),r}function pp(){return Aze===void 0?2:4}function mp(t,e,n,r,i){const s=t.u,o=2&(t=0|s[Ze])?1:r;i=!!i;let a=0|(r=q9(s,t,e))[Ze];if(!(4&a)){4&a&&(r=yo(r),a=Qu(a,t),t=yr(s,t,e,r));let c=0,l=0;for(;c<r.length;c++){const d=n(r[c]);d!=null&&(r[l++]=d)}l<c&&(r.length=l),a=V9(a,t),n=-4097&(20|a),a=n&=-8193,ii(r,a),2&a&&Object.freeze(r)}return o===1||o===4&&32&a?Bu(a)||(i=a,a|=2,a!==i&&ii(r,a),Object.freeze(r)):(o===2&&Bu(a)&&(r=yo(r),a=Qu(a,t),a=$f(a,t,i),ii(r,a),t=yr(s,t,e,r)),Bu(a)||(e=a,a=$f(a,t,i),a!==e&&ii(r,a))),r}function q9(t,e,n,r){return t=_d(t,e,n,r),Array.isArray(t)?t:x9}function V9(t,e){return t===0&&(t=Qu(t,e)),1|t}function Bu(t){return!!(2&t)&&!!(4&t)||!!(2048&t)}function Que(t){t=yo(t);for(let e=0;e<t.length;e++){const n=t[e]=yo(t[e]);Array.isArray(n[1])&&(n[1]=Py(n[1]))}return t}function dO(t,e,n,r){let i=0|(t=t.u)[Ze];vh(i),yr(t,i,e,(r==="0"?Number(n)===0:n===r)?void 0:n)}function Uy(t,e,n,r,i){vh(e);var s=!(!(64&e)&&16384&e);const o=(i=q9(t,e,n,i))!==x9;if(s||!o){let a=s=o?0|i[Ze]:0;(!o||2&a||Bu(a)||4&a&&!(32&a))&&(i=yo(i),a=Qu(a,e),e=yr(t,e,n,i)),a=-13&V9(a,e),a=$f(r?-17&a:16|a,e,!0),a!==s&&ii(i,a)}return i}function a5(t,e){var n=Bde;return G9(K9(t=t.u),t,0|t[Ze],n)===e?e:-1}function K9(t){if(HR)return t[h1]??(t[h1]=new Map);if(h1 in t)return t[h1];const e=new Map;return Object.defineProperty(t,h1,{value:e}),e}function Zue(t,e,n,r){const i=K9(t),s=G9(i,t,e,n);return s!==r&&(s&&(e=yr(t,e,s)),i.set(n,r)),e}function G9(t,e,n,r){let i=t.get(r);if(i!=null)return i;i=0;for(let s=0;s<r.length;s++){const o=r[s];_d(e,n,o)!=null&&(i!==0&&(n=yr(e,n,i)),i=o)}return t.set(r,i),i}function z9(t,e,n,r){let i,s=0|t[Ze];if((r=_d(t,s,n,r))!=null&&r.W===yS)return(e=XR(r))!==r&&yr(t,s,n,e),e.u;if(Array.isArray(r)){const o=0|r[Ze];i=2&o?Ff(YR(r,o,!1),e,!0):64&o?r:Ff(i,e,!0)}else i=Ff(void 0,e,!0);return i!==r&&yr(t,s,n,i),i}function ede(t,e,n,r){let i=0|(t=t.u)[Ze];return(e=$9(r=_d(t,i,n,r),e,!1,i))!==r&&e!=null&&yr(t,i,n,e),e}function tn(t,e,n,r=!1){if((e=ede(t,e,n,r))==null)return e;if(!(2&(r=0|(t=t.u)[Ze]))){const i=XR(e);i!==e&&yr(t,r,n,e=i)}return e}function tde(t,e,n,r,i,s,o){t=t.u;var a=!!(2&e);const c=a?1:i;s=!!s,o&&=!a;var l=0|(i=q9(t,e,r))[Ze];if(!(a=!!(4&l))){var d=i,h=e;const m=!!(2&(l=V9(l,e)));m&&(h|=2);let g=!m,y=!0,v=0,E=0;for(;v<d.length;v++){const w=$9(d[v],n,!1,h);if(w instanceof n){if(!m){const R=!!(2&(0|w.u[Ze]));g&&=!R,y&&=R}d[E++]=w}}E<v&&(d.length=E),l|=4,l=y?16|l:-17&l,ii(d,l=g?8|l:-9&l),m&&Object.freeze(d)}if(o&&!(8&l||!i.length&&(c===1||c===4&&32&l))){for(Bu(l)&&(i=yo(i),l=Qu(l,e),e=yr(t,e,r,i)),n=i,o=l,d=0;d<n.length;d++)(l=n[d])!==(h=XR(l))&&(n[d]=h);o|=8,ii(n,o=n.length?-17&o:16|o),l=o}return c===1||c===4&&32&l?Bu(l)||(e=l,(l|=!i.length||16&l&&(!a||32&l)?2:2048)!==e&&ii(i,l),Object.freeze(i)):(c===2&&Bu(l)&&(ii(i=yo(i),l=$f(l=Qu(l,e),e,s)),e=yr(t,e,r,i)),Bu(l)||(r=l,(l=$f(l,e,s))!==r&&ii(i,l))),i}function fd(t,e,n){const r=0|t.u[Ze];return tde(t,r,e,n,pp(),!1,!(2&r))}function it(t,e,n,r){return r==null&&(r=void 0),Hn(t,n,r)}function pb(t,e,n,r){r==null&&(r=void 0);e:{let i=0|(t=t.u)[Ze];if(vh(i),r==null){const s=K9(t);if(G9(s,t,i,n)!==e)break e;s.set(n,0)}else i=Zue(t,i,n,e);yr(t,i,e,r)}}function Qu(t,e){return-2049&(t=32|(2&e?2|t:-3&t))}function $f(t,e,n){return 32&e&&n||(t&=-33),t}function z3(t,e,n,r){const i=0|t.u[Ze];vh(i),t=tde(t,i,n,e,2,!0),r=r??new n,t.push(r),t[Ze]=2&(0|r.u[Ze])?-9&t[Ze]:-17&t[Ze]}function $a(t,e){return Dy(ty(t,e))}function Qa(t,e){return ey(ty(t,e))}function Fr(t,e){return oC(t,e)??0}function S_(t,e,n){if(n!=null&&typeof n!="boolean")throw t=typeof n,Error(`Expected boolean but got ${t!="object"?t:n?Array.isArray(n)?"array":t:"null"}: ${n}`);Hn(t,e,n)}function Ml(t,e,n){if(n!=null){if(typeof n!="number"||!zR(n))throw aO("int32");n|=0}Hn(t,e,n)}function Xe(t,e,n){if(n!=null&&typeof n!="number")throw Error(`Value of float/double field must be a number, found ${typeof n}: ${n}`);Hn(t,e,n)}function W3(t,e,n){{const o=t.u;let a=0|o[Ze];if(vh(a),n==null)yr(o,a,e);else{var r=t=0|n[Ze],i=Bu(t),s=i||Object.isFrozen(n);for(i||(t=0),s||(n=yo(n),r=0,t=$f(t=Qu(t,a),a,!0),s=!1),t|=21,i=0;i<n.length;i++){const c=n[i],l=Gue(c);Object.is(c,l)||(s&&(n=yo(n),r=0,t=$f(t=Qu(t,a),a,!0),s=!1),n[i]=l)}t!==r&&(s&&(n=yo(n),t=$f(t=Qu(t,a),a,!0)),ii(n,t)),yr(o,a,e,n)}}}function JR(t,e,n){vh(0|t.u[Ze]),mp(t,e,ey,2,!0).push(Gue(n))}function nde(t,e){return Error(`Invalid wire type: ${t} (at position ${e})`)}function W9(){return Error("Failed to read varint, encoding is invalid.")}function rde(t,e){return Error(`Tried to read past the end of the data ${e} > ${t}`)}function Y9(t){if(typeof t=="string")return{buffer:Nue(t),N:!1};if(Array.isArray(t))return{buffer:new Uint8Array(t),N:!1};if(t.constructor===Uint8Array)return{buffer:t,N:!1};if(t.constructor===ArrayBuffer)return{buffer:new Uint8Array(t),N:!1};if(t.constructor===Ju)return{buffer:k9(t)||new Uint8Array(0),N:!0};if(t instanceof Uint8Array)return{buffer:new Uint8Array(t.buffer,t.byteOffset,t.byteLength),N:!1};throw Error("Type not convertible to a Uint8Array, expected a Uint8Array, an ArrayBuffer, a base64 encoded string, a ByteString or an Array of numbers")}function X9(t,e){let n,r=0,i=0,s=0;const o=t.h;let a=t.g;do n=o[a++],r|=(127&n)<<s,s+=7;while(s<32&&128&n);for(s>32&&(i|=(127&n)>>4),s=3;s<32&&128&n;s+=7)n=o[a++],i|=(127&n)<<s;if(Rp(t,a),n<128)return e(r>>>0,i>>>0);throw W9()}function J9(t){let e=0,n=t.g;const r=n+10,i=t.h;for(;n<r;){const s=i[n++];if(e|=s,(128&s)==0)return Rp(t,n),!!(127&e)}throw W9()}function nh(t){const e=t.h;let n=t.g,r=e[n++],i=127&r;if(128&r&&(r=e[n++],i|=(127&r)<<7,128&r&&(r=e[n++],i|=(127&r)<<14,128&r&&(r=e[n++],i|=(127&r)<<21,128&r&&(r=e[n++],i|=r<<28,128&r&&128&e[n++]&&128&e[n++]&&128&e[n++]&&128&e[n++]&&128&e[n++])))))throw W9();return Rp(t,n),i}function hd(t){return nh(t)>>>0}function fO(t){var e=t.h;const n=t.g,r=e[n],i=e[n+1],s=e[n+2];return e=e[n+3],Rp(t,t.g+4),(r<<0|i<<8|s<<16|e<<24)>>>0}function hO(t){var e=fO(t);t=2*(e>>31)+1;const n=e>>>23&255;return e&=8388607,n==255?e?NaN:t*(1/0):n==0?1401298464324817e-60*t*e:t*Math.pow(2,n-150)*(e+8388608)}function Xze(t){return nh(t)}function c5(t,e,{ba:n=!1}={}){t.ba=n,e&&(e=Y9(e),t.h=e.buffer,t.m=e.N,t.j=0,t.l=t.h.length,t.g=t.j)}function Rp(t,e){if(t.g=e,e>t.l)throw rde(t.l,e)}function ide(t,e){if(e<0)throw Error(`Tried to read a negative byte length: ${e}`);const n=t.g,r=n+e;if(r>t.l)throw rde(e,t.l-n);return t.g=r,n}function sde(t,e){if(e==0)return Kp();var n=ide(t,e);return t.ba&&t.m?n=t.h.subarray(n,n+e):(t=t.h,n=n===(e=n+e)?new Uint8Array(0):Uze?t.slice(n,e):new Uint8Array(t.subarray(n,e))),n.length==0?Kp():new Ju(n,Jv)}Ja.prototype.toJSON=void 0,Ja.prototype.Ia=Bue;var eW=[];function ode(t){var e=t.g;if(e.g==e.l)return!1;t.l=t.g.g;var n=hd(t.g);if(e=n>>>3,!((n&=7)>=0&&n<=5))throw nde(n,t.l);if(e<1)throw Error(`Invalid field number: ${e} (at position ${t.l})`);return t.m=e,t.h=n,!0}function aC(t){switch(t.h){case 0:t.h!=0?aC(t):J9(t.g);break;case 1:Rp(t=t.g,t.g+8);break;case 2:if(t.h!=2)aC(t);else{var e=hd(t.g);Rp(t=t.g,t.g+e)}break;case 5:Rp(t=t.g,t.g+4);break;case 3:for(e=t.m;;){if(!ode(t))throw Error("Unmatched start-group tag: stream EOF");if(t.h==4){if(t.m!=e)throw Error("Unmatched end-group tag");break}aC(t)}break;default:throw nde(t.h,t.l)}}function bS(t,e,n){const r=t.g.l,i=hd(t.g),s=t.g.g+i;let o=s-r;if(o<=0&&(t.g.l=s,n(e,t,void 0,void 0,void 0),o=s-t.g.g),o)throw Error(`Message parsing ended unexpectedly. Expected to read ${i} bytes, instead read ${i-o} bytes, either the data ended unexpectedly or the message misreported its own length`);return t.g.g=s,t.g.l=r,e}function Q9(t){var e=hd(t.g),n=ide(t=t.g,e);if(t=t.h,yze){var r,i=t;(r=e5)||(r=e5=new TextDecoder("utf-8",{fatal:!0})),e=n+e,i=n===0&&e===i.length?i:i.subarray(n,e);try{var s=r.decode(i)}catch(a){if(Kw===void 0){try{r.decode(new Uint8Array([128]))}catch{}try{r.decode(new Uint8Array([97])),Kw=!0}catch{Kw=!1}}throw!Kw&&(e5=void 0),a}}else{e=(s=n)+e,n=[];let a,c=null;for(;s<e;){var o=t[s++];o<128?n.push(o):o<224?s>=e?Xh():(a=t[s++],o<194||(192&a)!=128?(s--,Xh()):n.push((31&o)<<6|63&a)):o<240?s>=e-1?Xh():(a=t[s++],(192&a)!=128||o===224&&a<160||o===237&&a>=160||(192&(r=t[s++]))!=128?(s--,Xh()):n.push((15&o)<<12|(63&a)<<6|63&r)):o<=244?s>=e-2?Xh():(a=t[s++],(192&a)!=128||a-144+(o<<28)>>30!=0||(192&(r=t[s++]))!=128||(192&(i=t[s++]))!=128?(s--,Xh()):(o=(7&o)<<18|(63&a)<<12|(63&r)<<6|63&i,o-=65536,n.push(55296+(o>>10&1023),56320+(1023&o)))):Xh(),n.length>=8192&&(c=Nz(c,n),n.length=0)}s=Nz(c,n)}return s}function ade(t){const e=hd(t.g);return sde(t.g,e)}function QR(t,e,n){var r=hd(t.g);for(r=t.g.g+r;t.g.g<r;)n.push(e(t.g))}var Gw=[];function Jze(t){return t}let vv;function Vc(t,e,n){e.g?e.m(t,e.g,e.h,n):e.m(t,e.h,n)}var Ye=class{constructor(e,n){this.u=Xue(e,n)}toJSON(){const e=!vv;try{return e&&(vv=Yue),cde(this)}finally{e&&(vv=void 0)}}l(){var e=OWe;return e.g?e.l(this,e.g,e.h,!0):e.l(this,e.h,e.defaultValue,!0)}clone(){const e=this.u;return new this.constructor(YR(e,0|e[Ze],!1))}N(){return!!(2&(0|this.u[Ze]))}};function cde(t){var e=t.u;{e=(t=vv(e))!==e;let l=t.length;if(l){var n=t[l-1],r=A9(n);r?l--:n=void 0;var i=t;if(r){e:{var s,o=n,a=!1;if(o)for(let d in o)isNaN(+d)?(s??={})[d]=o[d]:(r=o[d],Array.isArray(r)&&(V3(r)||qz(r)&&r.size===0)&&(r=null),r==null&&(a=!0),r!=null&&((s??={})[d]=r));if(a||(s=o),s)for(let d in s){a=s;break e}a=null}o=a==null?n!=null:a!==n}for(;l>0&&((s=i[l-1])==null||V3(s)||qz(s)&&s.size===0);l--)var c=!0;(i!==t||o||c)&&(e?(c||o||a)&&(i.length=l):i=Array.prototype.slice.call(i,0,l),a&&i.push(a)),c=i}else c=t}return c}function tW(t){return t?/^\d+$/.test(t)?(GR(t),new pO(Dn,Lr)):null:Qze||=new pO(0,0)}Ye.prototype.W=yS,Ye.prototype.toString=function(){try{return vv=Jze,cde(this).toString()}finally{vv=void 0}};var pO=class{constructor(t,e){this.h=t>>>0,this.g=e>>>0}};let Qze;function nW(t){return t?/^-?\d+$/.test(t)?(GR(t),new mO(Dn,Lr)):null:Zze||=new mO(0,0)}var mO=class{constructor(t,e){this.h=t>>>0,this.g=e>>>0}};let Zze;function yv(t,e,n){for(;n>0||e>127;)t.g.push(127&e|128),e=(e>>>7|n<<25)>>>0,n>>>=7;t.g.push(e)}function jy(t,e){for(;e>127;)t.g.push(127&e|128),e>>>=7;t.g.push(e)}function ZR(t,e){if(e>=0)jy(t,e);else{for(let n=0;n<9;n++)t.g.push(127&e|128),e>>=7;t.g.push(1)}}function w_(t,e){t.g.push(e>>>0&255),t.g.push(e>>>8&255),t.g.push(e>>>16&255),t.g.push(e>>>24&255)}function ny(t,e){e.length!==0&&(t.l.push(e),t.h+=e.length)}function aa(t,e,n){jy(t.g,8*e+n)}function Z9(t,e){return aa(t,e,2),e=t.g.end(),ny(t,e),e.push(t.h),e}function eD(t,e){var n=e.pop();for(n=t.h+t.g.length()-n;n>127;)e.push(127&n|128),n>>>=7,t.h++;e.push(n),t.h++}function e4(t,e,n){aa(t,e,2),jy(t.g,n.length),ny(t,t.g.end()),ny(t,n)}function Y3(t,e,n,r){n!=null&&(e=Z9(t,e),r(n,t),eD(t,e))}function Kc(){const t=class{constructor(){throw Error()}};return Object.setPrototypeOf(t,t.prototype),t}var tD=Kc(),lde=Kc(),nD=Kc(),rD=Kc(),ude=Kc(),dde=Kc(),iD=Kc(),fde=Kc(),hde=Kc(),Fy=class{constructor(t,e,n){this.g=t,this.h=e,t=tD,this.l=!!t&&n===t||!1}};function t4(t,e){return new Fy(t,e,tD)}function pde(t,e,n,r,i){Y3(t,n,yde(e,r),i)}const eWe=t4((function(t,e,n,r,i){return t.h===2&&(bS(t,z9(e,r,n),i),!0)}),pde),tWe=t4((function(t,e,n,r,i){return t.h===2&&(bS(t,z9(e,r,n,!0),i),!0)}),pde);var n4=Symbol(),sD=Symbol(),rW=Symbol(),iW=Symbol();let mde,gde;function ym(t,e,n,r){var i=r[t];if(i)return i;(i={}).Pa=r,i.V=(function(h){switch(typeof h){case"boolean":return zue||=[0,void 0,!0];case"number":return h>0?void 0:h===0?Wze||=[0,void 0]:[-h,void 0];case"string":return[0,h];case"object":return h}})(r[0]);var s=r[1];let o=1;s&&s.constructor===Object&&(i.ga=s,typeof(s=r[++o])=="function"&&(i.la=!0,mde??=s,gde??=r[o+1],s=r[o+=2]));const a={};for(;s&&Array.isArray(s)&&s.length&&typeof s[0]=="number"&&s[0]>0;){for(var c=0;c<s.length;c++)a[s[c]]=s;s=r[++o]}for(c=1;s!==void 0;){let h;typeof s=="number"&&(c+=s,s=r[++o]);var l=void 0;if(s instanceof Fy?h=s:(h=eWe,o--),h?.l){s=r[++o],l=r;var d=o;typeof s=="function"&&(s=s(),l[d]=s),l=s}for(d=c+1,typeof(s=r[++o])=="number"&&s<0&&(d-=s,s=r[++o]);c<d;c++){const m=a[c];l?n(i,c,h,l,m):e(i,c,h,m)}}return r[t]=i}function vde(t){return Array.isArray(t)?t[0]instanceof Fy?t:[tWe,t]:[t,void 0]}function yde(t,e){return t instanceof Ye?t.u:Array.isArray(t)?Ff(t,e,!1):void 0}function oD(t,e,n,r){const i=n.g;t[e]=r?(s,o,a)=>i(s,o,a,r):i}function aD(t,e,n,r,i){const s=n.g;let o,a;t[e]=(c,l,d)=>s(c,l,d,a||=ym(sD,oD,aD,r).V,o||=cD(r),i)}function cD(t){let e=t[rW];if(e!=null)return e;const n=ym(sD,oD,aD,t);return e=n.la?(r,i)=>mde(r,i,n):(r,i)=>{const s=0|r[Ze];for(;ode(i)&&i.h!=4;){var o=i.m,a=n[o];if(a==null){var c=n.ga;c&&(c=c[o])&&(c=nWe(c))!=null&&(a=n[o]=c)}a!=null&&a(i,r,o)||(o=(a=i).l,aC(a),a.fa?a=void 0:(c=a.g.g-o,a.g.g=o,a=sde(a.g,c)),o=r,a&&((c=o[Qv])?c.push(a):o[Qv]=[a]))}return 16384&s&&Py(r),!0},t[rW]=e}function nWe(t){const e=(t=vde(t))[0].g;if(t=t[1]){const n=cD(t),r=ym(sD,oD,aD,t).V;return(i,s,o)=>e(i,s,o,r,n)}return e}function r4(t,e,n){t[e]=n.h}function i4(t,e,n,r){let i,s;const o=n.h;t[e]=(a,c,l)=>o(a,c,l,s||=ym(n4,r4,i4,r).V,i||=bde(r))}function bde(t){let e=t[iW];if(!e){const n=ym(n4,r4,i4,t);e=(r,i)=>_de(r,i,n),t[iW]=e}return e}function _de(t,e,n){for(var r=0|t[Ze],i=512&r?0:-1,s=t.length,o=512&r?1:0,a=s+(256&r?-1:0);o<a;o++){const c=t[o];if(c==null)continue;const l=o-i,d=sW(n,l);d&&d(e,c,l)}if(256&r){r=t[s-1];for(const c in r)i=+c,Number.isNaN(i)||(s=r[i])!=null&&(a=sW(n,i))&&a(e,s,i)}if(t=M9(t))for(ny(e,e.g.end()),n=0;n<t.length;n++)ny(e,k9(t[n])||new Uint8Array(0))}function sW(t,e){var n=t[e];if(n)return n;if((n=t.ga)&&(n=n[e])){var r=(n=vde(n))[0].h;if(n=n[1]){const i=bde(n),s=ym(n4,r4,i4,n).V;n=t.la?gde(s,i):(o,a,c)=>r(o,a,c,s,i)}else n=r;return t[e]=n}}function $y(t,e){if(Array.isArray(e)){var n=0|e[Ze];if(4&n)return e;for(var r=0,i=0;r<e.length;r++){const s=t(e[r]);s!=null&&(e[i++]=s)}return i<r&&(e.length=i),ii(e,-12289&(5|n)),2&n&&Object.freeze(e),e}}function Bs(t,e,n){return new Fy(t,e,n)}function By(t,e,n){return new Fy(t,e,n)}function Hs(t,e,n){yr(t,0|t[Ze],e,n)}var rWe=t4((function(t,e,n,r,i){return t.h===2&&(t=bS(t,Ff([void 0,void 0],r,!0),i),vh(r=0|e[Ze]),(i=_d(e,r,n))instanceof Ja?(2&i.L)!=0?((i=i.X()).push(t),yr(e,r,n,i)):i.Na(t):Array.isArray(i)?(2&(0|i[Ze])&&yr(e,r,n,i=Que(i)),i.push(t)):yr(e,r,n,[t]),!0)}),(function(t,e,n,r,i){if(e instanceof Ja)e.forEach(((s,o)=>{Y3(t,n,Ff([o,s],r,!1),i)}));else if(Array.isArray(e))for(let s=0;s<e.length;s++){const o=e[s];Array.isArray(o)&&Y3(t,n,Ff(o,r,!1),i)}}));function Sde(t,e,n){if(e=(function(r){if(r==null)return r;const i=typeof r;if(i==="bigint")return String(U9(64,r));if(WR(r)){if(i==="string")return F9(r);if(i==="number")return j9(r)}})(e),e!=null&&(typeof e=="string"&&nW(e),e!=null))switch(aa(t,n,0),typeof e){case"number":t=t.g,Zv(e),yv(t,Dn,Lr);break;case"bigint":n=BigInt.asUintN(64,e),n=new mO(Number(n&BigInt(4294967295)),Number(n>>BigInt(32))),yv(t.g,n.h,n.g);break;default:n=nW(e),yv(t.g,n.h,n.g)}}function wde(t,e,n){(e=Dy(e))!=null&&e!=null&&(aa(t,n,0),ZR(t.g,e))}function Ede(t,e,n){(e=Vue(e))!=null&&(aa(t,n,0),t.g.g.push(e?1:0))}function Cde(t,e,n){(e=ey(e))!=null&&e4(t,n,Lue(e))}function Tde(t,e,n,r,i){Y3(t,n,yde(e,r),i)}function Rde(t,e,n){(e=e==null||typeof e=="string"||gS(e)||e instanceof Ju?e:void 0)!=null&&e4(t,n,Y9(e).buffer)}function kde(t,e,n){return(t.h===5||t.h===2)&&(e=Uy(e,0|e[Ze],n,!1,!1),t.h==2?QR(t,hO,e):e.push(hO(t.g)),!0)}var ku=Bs((function(t,e,n){if(t.h!==1)return!1;var r=t.g;t=fO(r);const i=fO(r);r=2*(i>>31)+1;const s=i>>>20&2047;return t=4294967296*(1048575&i)+t,Hs(e,n,s==2047?t?NaN:r*(1/0):s==0?5e-324*r*t:r*Math.pow(2,s-1075)*(t+4503599627370496)),!0}),(function(t,e,n){(e=yh(e))!=null&&(aa(t,n,1),t=t.g,(n=que||=new DataView(new ArrayBuffer(8))).setFloat64(0,+e,!0),Dn=n.getUint32(0,!0),Lr=n.getUint32(4,!0),w_(t,Dn),w_(t,Lr))}),Kc()),si=Bs((function(t,e,n){return t.h===5&&(Hs(e,n,hO(t.g)),!0)}),(function(t,e,n){(e=yh(e))!=null&&(aa(t,n,5),t=t.g,O9(e),w_(t,Dn))}),iD),iWe=By(kde,(function(t,e,n){if((e=$y(yh,e))!=null)for(let o=0;o<e.length;o++){var r=t,i=n,s=e[o];s!=null&&(aa(r,i,5),r=r.g,O9(s),w_(r,Dn))}}),iD),lD=By(kde,(function(t,e,n){if((e=$y(yh,e))!=null&&e.length){aa(t,n,2),jy(t.g,4*e.length);for(let r=0;r<e.length;r++)n=t.g,O9(e[r]),w_(n,Dn)}}),iD),rh=Bs((function(t,e,n){return t.h===0&&(Hs(e,n,X9(t.g,D9)),!0)}),Sde,dde),l5=Bs((function(t,e,n){return t.h===0&&(Hs(e,n,(t=X9(t.g,D9))===0?void 0:t),!0)}),Sde,dde),sWe=Bs((function(t,e,n){return t.h===0&&(Hs(e,n,X9(t.g,P9)),!0)}),(function(t,e,n){if((e=$ze(e))!=null&&(typeof e=="string"&&tW(e),e!=null))switch(aa(t,n,0),typeof e){case"number":t=t.g,Zv(e),yv(t,Dn,Lr);break;case"bigint":n=BigInt.asUintN(64,e),n=new pO(Number(n&BigInt(4294967295)),Number(n>>BigInt(32))),yv(t.g,n.h,n.g);break;default:n=tW(e),yv(t.g,n.h,n.g)}}),Kc()),Pr=Bs((function(t,e,n){return t.h===0&&(Hs(e,n,nh(t.g)),!0)}),wde,rD),s4=By((function(t,e,n){return(t.h===0||t.h===2)&&(e=Uy(e,0|e[Ze],n,!1,!1),t.h==2?QR(t,nh,e):e.push(nh(t.g)),!0)}),(function(t,e,n){if((e=$y(Dy,e))!=null&&e.length){n=Z9(t,n);for(let r=0;r<e.length;r++)ZR(t.g,e[r]);eD(t,n)}}),rD),Kg=Bs((function(t,e,n){return t.h===0&&(Hs(e,n,(t=nh(t.g))===0?void 0:t),!0)}),wde,rD),cr=Bs((function(t,e,n){return t.h===0&&(Hs(e,n,J9(t.g)),!0)}),Ede,lde),bv=Bs((function(t,e,n){return t.h===0&&(Hs(e,n,(t=J9(t.g))===!1?void 0:t),!0)}),Ede,lde),us=By((function(t,e,n){return t.h===2&&(t=Q9(t),Uy(e,0|e[Ze],n,!1).push(t),!0)}),(function(t,e,n){if((e=$y(ey,e))!=null)for(let o=0;o<e.length;o++){var r=t,i=n,s=e[o];s!=null&&e4(r,i,Lue(s))}}),nD),yf=Bs((function(t,e,n){return t.h===2&&(Hs(e,n,(t=Q9(t))===""?void 0:t),!0)}),Cde,nD),bn=Bs((function(t,e,n){return t.h===2&&(Hs(e,n,Q9(t)),!0)}),Cde,nD),mi=(function(t,e,n=tD){return new Fy(t,e,n)})((function(t,e,n,r,i){return t.h===2&&(r=Ff(void 0,r,!0),Uy(e,0|e[Ze],n,!0).push(r),bS(t,r,i),!0)}),(function(t,e,n,r,i){if(Array.isArray(e))for(let s=0;s<e.length;s++)Tde(t,e[s],n,r,i)})),wn=t4((function(t,e,n,r,i,s){return t.h===2&&(Zue(e,0|e[Ze],s,n),bS(t,e=z9(e,r,n),i),!0)}),Tde),Ide=Bs((function(t,e,n){return t.h===2&&(Hs(e,n,ade(t)),!0)}),Rde,fde),oWe=By((function(t,e,n){return(t.h===0||t.h===2)&&(e=Uy(e,0|e[Ze],n,!1,!1),t.h==2?QR(t,hd,e):e.push(hd(t.g)),!0)}),(function(t,e,n){if((e=$y(Kue,e))!=null)for(let o=0;o<e.length;o++){var r=t,i=n,s=e[o];s!=null&&(aa(r,i,0),jy(r.g,s))}}),ude),aWe=Bs((function(t,e,n){return t.h===0&&(Hs(e,n,(t=hd(t.g))===0?void 0:t),!0)}),(function(t,e,n){(e=Kue(e))!=null&&e!=null&&(aa(t,n,0),jy(t.g,e))}),ude),Za=Bs((function(t,e,n){return t.h===0&&(Hs(e,n,nh(t.g)),!0)}),(function(t,e,n){(e=Dy(e))!=null&&(e=parseInt(e,10),aa(t,n,0),ZR(t.g,e))}),hde);let cWe=class{constructor(e,n){this.h=e,this.g=n,this.l=tn,this.m=it,this.defaultValue=void 0}};function Gc(t,e){return new cWe(t,e)}function bh(t,e){return(n,r)=>{if(Gw.length){const s=Gw.pop();s.o(r),c5(s.g,n,r),n=s}else n=new class{constructor(s,o){if(eW.length){const a=eW.pop();c5(a,s,o),s=a}else s=new class{constructor(a,c){this.h=null,this.m=!1,this.g=this.l=this.j=0,c5(this,a,c)}clear(){this.h=null,this.m=!1,this.g=this.l=this.j=0,this.ba=!1}}(s,o);this.g=s,this.l=this.g.g,this.h=this.m=-1,this.o(o)}o({fa:s=!1}={}){this.fa=s}}(n,r);try{const s=new t,o=s.u;cD(e)(o,n);var i=s}finally{n.g.clear(),n.m=-1,n.h=-1,Gw.length<100&&Gw.push(n)}return i}}function o4(t){return function(){const e=new class{constructor(){this.l=[],this.h=0,this.g=new class{constructor(){this.g=[]}length(){return this.g.length}end(){const o=this.g;return this.g=[],o}}}};_de(this.u,e,ym(n4,r4,i4,t)),ny(e,e.g.end());const n=new Uint8Array(e.h),r=e.l,i=r.length;let s=0;for(let o=0;o<i;o++){const a=r[o];n.set(a,s),s+=a.length}return e.l=[n],n}}var oW=class extends Ye{constructor(e){super(e)}},aW=[0,yf,Bs((function(t,e,n){return t.h===2&&(Hs(e,n,(t=ade(t))===Kp()?void 0:t),!0)}),(function(t,e,n){if(e!=null){if(e instanceof Ye){const r=e.Ra;return void(r&&(e=r(e),e!=null&&e4(t,n,Y9(e).buffer)))}if(Array.isArray(e))return}Rde(t,e,n)}),fde)];let u5,cW=globalThis.trustedTypes;function lW(t){u5===void 0&&(u5=(function(){let n=null;if(!cW)return n;try{const r=i=>i;n=cW.createPolicy("goog#html",{createHTML:r,createScript:r,createScriptURL:r})}catch{}return n})());var e=u5;return new class{constructor(n){this.g=n}toString(){return this.g+""}}(e?e.createScriptURL(t):t)}function lWe(t,...e){if(e.length===0)return lW(t[0]);let n=t[0];for(let r=0;r<e.length;r++)n+=encodeURIComponent(e[r])+t[r+1];return lW(n)}var xde=[0,Pr,Za,cr,-1,s4,Za,-1],uWe=class extends Ye{constructor(t){super(t)}},Ade=[0,cr,bn,cr,Za,-1,By((function(t,e,n){return(t.h===0||t.h===2)&&(e=Uy(e,0|e[Ze],n,!1,!1),t.h==2?QR(t,Xze,e):e.push(nh(t.g)),!0)}),(function(t,e,n){if((e=$y(Dy,e))!=null&&e.length){n=Z9(t,n);for(let r=0;r<e.length;r++)ZR(t.g,e[r]);eD(t,n)}}),hde),bn,-1,[0,cr,-1],Za,cr,-1],Lde=[0,bn,-2],uW=class extends Ye{constructor(e){super(e)}},Mde=[0],Ode=[0,Pr,cr,1,cr,-3],sa=class extends Ye{constructor(t){super(t,2)}},oi={};oi[336783863]=[0,bn,cr,-1,Pr,[0,[1,2,3,4,5,6,7,8],wn,Mde,wn,Ade,wn,Lde,wn,Ode,wn,xde,wn,[0,bn,-2],wn,[0,bn,Za],wn,[0,Za,bn]],[0,bn],cr,[0,[1,3],[2,4],wn,[0,s4],-1,wn,[0,us],-1,mi,[0,bn,-1]],bn];var dW=[0,l5,-1,bv,-3,l5,s4,yf,Kg,l5,-1,bv,Kg,bv,-2,yf];function ca(t,e){dO(t,2,Ny(e),"")}function Vn(t,e){JR(t,3,e)}function Yt(t,e){JR(t,4,e)}var Us=class extends Ye{constructor(t){super(t,500)}o(t){return it(this,0,7,t)}},mb=[-1,{}],fW=[0,bn,1,mb],hW=[0,bn,us,mb];function la(t,e){z3(t,1,Us,e)}function tr(t,e){JR(t,10,e)}function on(t,e){JR(t,15,e)}var Co=class extends Ye{constructor(t){super(t,500)}o(t){return it(this,0,1001,t)}},Pde=[-500,mi,[-500,yf,-1,us,-3,[-2,oi,cr],mi,aW,Kg,-1,fW,hW,mi,[0,yf,bv],yf,dW,Kg,us,987,us],4,mi,[-500,bn,-1,[-1,{}],998,bn],mi,[-500,bn,us,-1,[-2,{},cr],997,us,-1],Kg,mi,[-500,bn,us,mb,998,us],us,Kg,fW,hW,mi,[0,yf,-1,mb],us,-2,dW,yf,-1,bv,[0,bv,aWe],978,mb,mi,aW];Co.prototype.g=o4(Pde);var dWe=bh(Co,Pde),fWe=class extends Ye{constructor(t){super(t)}},Dde=class extends Ye{constructor(e){super(e)}g(){return fd(this,fWe,1)}},Nde=[0,mi,[0,Pr,si,bn,-1]],a4=bh(Dde,Nde),hWe=class extends Ye{constructor(t){super(t)}},pWe=class extends Ye{constructor(e){super(e)}},d5=class extends Ye{constructor(t){super(t)}h(){return tn(this,hWe,2)}g(){return fd(this,pWe,5)}},Ude=bh(class extends Ye{constructor(t){super(t)}},[0,us,s4,lD,[0,Za,[0,Pr,-3],[0,si,-3],[0,Pr,-1,[0,mi,[0,Pr,-2]]],mi,[0,si,-1,bn,si]],bn,-1,rh,mi,[0,Pr,si],us,rh]),jde=class extends Ye{constructor(t){super(t)}},_v=bh(class extends Ye{constructor(t){super(t)}},[0,mi,[0,si,-4]]),Fde=class extends Ye{constructor(t){super(t)}},_S=bh(class extends Ye{constructor(t){super(t)}},[0,mi,[0,si,-4]]),mWe=class extends Ye{constructor(t){super(t)}},gWe=[0,Pr,-1,lD,Za],$de=class extends Ye{constructor(t){super(t)}};$de.prototype.g=o4([0,si,-4,rh]);var vWe=class extends Ye{constructor(t){super(t)}},yWe=bh(class extends Ye{constructor(t){super(t)}},[0,mi,[0,1,Pr,bn,Nde],rh]),pW=class extends Ye{constructor(t){super(t)}},bWe=class extends Ye{constructor(e){super(e)}oa(){const e=Jue(this);return e??Kp()}},_We=class extends Ye{constructor(t){super(t)}},Bde=[1,2],SWe=bh(class extends Ye{constructor(t){super(t)}},[0,mi,[0,Bde,wn,[0,lD],wn,[0,Ide],Pr,bn],rh]),uD=class extends Ye{constructor(t){super(t)}},Hde=[0,bn,Pr,si,us,-1],mW=class extends Ye{constructor(t){super(t)}},wWe=[0,cr,-1],gW=class extends Ye{constructor(t){super(t)}},cC=[1,2,3,4,5],X3=class extends Ye{constructor(t){super(t)}g(){return Jue(this)!=null}h(){return Qa(this,2)!=null}},dr=class extends Ye{constructor(t){super(t)}g(){return Vue(ty(this,2))??!1}},qde=[0,Ide,bn,[0,Pr,rh,-1],[0,sWe,rh]],Vr=[0,qde,cr,[0,cC,wn,Ode,wn,Ade,wn,xde,wn,Mde,wn,Lde],Za],c4=class extends Ye{constructor(t){super(t)}},dD=[0,Vr,si,-1,Pr],EWe=Gc(502141897,c4);oi[502141897]=dD;var CWe=bh(class extends Ye{constructor(t){super(t)}},[0,[0,Za,-1,iWe,oWe],gWe]),Vde=class extends Ye{constructor(t){super(t)}},Kde=class extends Ye{constructor(t){super(t)}},fD=[0,Vr,si,[0,Vr],cr],Gde=[0,Vr,dD,fD,si,[0,[0,qde]]],TWe=Gc(508968150,Kde);oi[508968150]=Gde,oi[508968149]=fD;var zde=class extends Ye{constructor(t){super(t)}},RWe=Gc(513916220,zde);oi[513916220]=[0,Vr,Gde,Pr];var Sg=class extends Ye{constructor(t){super(t)}h(){return tn(this,uD,2)}g(){Hn(this,2)}},Wde=[0,Vr,Hde];oi[478825465]=Wde;var kWe=class extends Ye{constructor(t){super(t)}},Yde=class extends Ye{constructor(t){super(t)}},hD=class extends Ye{constructor(t){super(t)}},pD=class extends Ye{constructor(t){super(t)}},Xde=class extends Ye{constructor(t){super(t)}},vW=[0,Vr,[0,Vr],Wde,-1],Jde=[0,Vr,si,Pr],mD=[0,Vr,si],Qde=[0,Vr,Jde,mD,si],IWe=Gc(479097054,Xde);oi[479097054]=[0,Vr,Qde,vW],oi[463370452]=vW,oi[464864288]=Jde;var xWe=Gc(462713202,pD);oi[462713202]=Qde,oi[474472470]=mD;var AWe=class extends Ye{constructor(t){super(t)}},Zde=class extends Ye{constructor(e){super(e)}},efe=class extends Ye{constructor(e){super(e)}},tfe=class extends Ye{constructor(t){super(t)}},gD=[0,Vr,si,-1,Pr],gO=[0,Vr,si,cr];tfe.prototype.g=o4([0,Vr,mD,[0,Vr],dD,fD,gD,gO]);var nfe=class extends Ye{constructor(e){super(e)}},LWe=Gc(456383383,nfe);oi[456383383]=[0,Vr,Hde];var rfe=class extends Ye{constructor(e){super(e)}},MWe=Gc(476348187,rfe);oi[476348187]=[0,Vr,wWe];var ife=class extends Ye{constructor(t){super(t)}},yW=class extends Ye{constructor(t){super(t)}},sfe=[0,Za,-1],OWe=Gc(458105876,class extends Ye{constructor(t){super(t)}g(){var t=this.u;const e=0|t[Ze],n=2&e;return t=(function(r,i,s){var o=yW;const a=2&i;let c=!1;if(s==null){if(a)return Zz();s=[]}else if(s.constructor===Ja){if((2&s.L)==0||a)return s;s=s.X()}else Array.isArray(s)?c=!!(2&(0|s[Ze])):s=[];if(a){if(!s.length)return Zz();c||(c=!0,Py(s))}else c&&(c=!1,s=Que(s));return c||(64&(0|s[Ze])?s[Ze]&=-33:32&i&&qR(s,32)),yr(r,i,2,o=new Ja(s,o,Bze,void 0)),o})(t,e,_d(t,e,2)),!n&&yW&&(t.ra=!0),t}});oi[458105876]=[0,sfe,rWe,[!0,rh,[0,bn,-1,us]]];var vD=class extends Ye{constructor(t){super(t)}},ofe=Gc(458105758,vD);oi[458105758]=[0,Vr,bn,sfe];var afe=class extends Ye{constructor(t){super(t)}},PWe=Gc(443442058,afe);oi[443442058]=[0,Vr,bn,Pr,si,us,-1,cr,si],oi[514774813]=gD;var cfe=class extends Ye{constructor(t){super(t)}},DWe=Gc(516587230,cfe);function vO(t,e){return e=e?e.clone():new uD,t.displayNamesLocale!==void 0?Hn(e,1,Ny(t.displayNamesLocale)):t.displayNamesLocale===void 0&&Hn(e,1),t.maxResults!==void 0?Ml(e,2,t.maxResults):"maxResults"in t&&Hn(e,2),t.scoreThreshold!==void 0?Xe(e,3,t.scoreThreshold):"scoreThreshold"in t&&Hn(e,3),t.categoryAllowlist!==void 0?W3(e,4,t.categoryAllowlist):"categoryAllowlist"in t&&Hn(e,4),t.categoryDenylist!==void 0?W3(e,5,t.categoryDenylist):"categoryDenylist"in t&&Hn(e,5),e}function yD(t,e=-1,n=""){return{categories:t.map((r=>({index:$a(r,1)??0??-1,score:Fr(r,2)??0,categoryName:Qa(r,3)??""??"",displayName:Qa(r,4)??""??""}))),headIndex:e,headName:n}}function lfe(t){var e=mp(t,3,yh,pp()),n=mp(t,2,Dy,pp()),r=mp(t,1,ey,pp()),i=mp(t,9,ey,pp());const s={categories:[],keypoints:[]};for(let o=0;o<e.length;o++)s.categories.push({score:e[o],index:n[o]??-1,categoryName:r[o]??"",displayName:i[o]??""});if((e=tn(t,d5,4)?.h())&&(s.boundingBox={originX:$a(e,1)??0,originY:$a(e,2)??0,width:$a(e,3)??0,height:$a(e,4)??0,angle:0}),tn(t,d5,4)?.g().length)for(const o of tn(t,d5,4).g())s.keypoints.push({x:oC(o,1)??0,y:oC(o,2)??0,score:oC(o,4)??0,label:Qa(o,3)??""});return s}function l4(t){const e=[];for(const n of fd(t,Fde,1))e.push({x:Fr(n,1)??0,y:Fr(n,2)??0,z:Fr(n,3)??0,visibility:Fr(n,4)??0});return e}function gb(t){const e=[];for(const n of fd(t,jde,1))e.push({x:Fr(n,1)??0,y:Fr(n,2)??0,z:Fr(n,3)??0,visibility:Fr(n,4)??0});return e}function bW(t){return Array.from(t,(e=>e>127?e-256:e))}function _W(t,e){if(t.length!==e.length)throw Error(`Cannot compute cosine similarity between embeddings of different sizes (${t.length} vs. ${e.length}).`);let n=0,r=0,i=0;for(let s=0;s<t.length;s++)n+=t[s]*e[s],r+=t[s]*t[s],i+=e[s]*e[s];if(r<=0||i<=0)throw Error("Cannot compute cosine similarity on embedding with 0 norm.");return n/Math.sqrt(r*i)}let zw;oi[516587230]=[0,Vr,gD,gO,si],oi[518928384]=gO;const NWe=new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11]);async function ufe(){if(zw===void 0)try{await WebAssembly.instantiate(NWe),zw=!0}catch{zw=!1}return zw}async function p1(t,e=lWe``){const n=await ufe()?"wasm_internal":"wasm_nosimd_internal";return{wasmLoaderPath:`${e}/${t}_${n}.js`,wasmBinaryPath:`${e}/${t}_${n}.wasm`}}var op=class{};function dfe(){var t=navigator;return typeof OffscreenCanvas<"u"&&(!(function(e=navigator){return(e=e.userAgent).includes("Safari")&&!e.includes("Chrome")})(t)||!!((t=t.userAgent.match(/Version\/([\d]+).*Safari/))&&t.length>=1&&Number(t[1])>=17))}async function SW(t){if(typeof importScripts!="function"){const e=document.createElement("script");return e.src=t.toString(),e.crossOrigin="anonymous",new Promise(((n,r)=>{e.addEventListener("load",(()=>{n()}),!1),e.addEventListener("error",(i=>{r(i)}),!1),document.body.appendChild(e)}))}importScripts(t.toString())}function ffe(t){return t.videoWidth!==void 0?[t.videoWidth,t.videoHeight]:t.naturalWidth!==void 0?[t.naturalWidth,t.naturalHeight]:t.displayWidth!==void 0?[t.displayWidth,t.displayHeight]:[t.width,t.height]}function Qe(t,e,n){t.m||console.error("No wasm multistream support detected: ensure dependency inclusion of :gl_graph_runner_internal_multi_input target"),n(e=t.i.stringToNewUTF8(e)),t.i._free(e)}function wW(t,e,n){if(!t.i.canvas)throw Error("No OpenGL canvas configured.");if(n?t.i._bindTextureToStream(n):t.i._bindTextureToCanvas(),!(n=t.i.canvas.getContext("webgl2")||t.i.canvas.getContext("webgl")))throw Error("Failed to obtain WebGL context from the provided canvas. `getContext()` should only be invoked with `webgl` or `webgl2`.");t.i.gpuOriginForWebTexturesIsBottomLeft&&n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!0),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,e),t.i.gpuOriginForWebTexturesIsBottomLeft&&n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1);const[r,i]=ffe(e);return!t.l||r===t.i.canvas.width&&i===t.i.canvas.height||(t.i.canvas.width=r,t.i.canvas.height=i),[r,i]}function EW(t,e,n){t.m||console.error("No wasm multistream support detected: ensure dependency inclusion of :gl_graph_runner_internal_multi_input target");const r=new Uint32Array(e.length);for(let i=0;i<e.length;i++)r[i]=t.i.stringToNewUTF8(e[i]);e=t.i._malloc(4*r.length),t.i.HEAPU32.set(r,e>>2),n(e);for(const i of r)t.i._free(i);t.i._free(e)}function rl(t,e,n){t.i.simpleListeners=t.i.simpleListeners||{},t.i.simpleListeners[e]=n}function Qd(t,e,n){let r=[];t.i.simpleListeners=t.i.simpleListeners||{},t.i.simpleListeners[e]=(i,s,o)=>{s?(n(r,o),r=[]):r.push(i)}}op.forVisionTasks=function(t){return p1("vision",t)},op.forTextTasks=function(t){return p1("text",t)},op.forGenAiExperimentalTasks=function(t){return p1("genai_experimental",t)},op.forGenAiTasks=function(t){return p1("genai",t)},op.forAudioTasks=function(t){return p1("audio",t)},op.isSimdSupported=function(){return ufe()};async function UWe(t,e,n,r){return t=await(async(i,s,o,a,c)=>{if(s&&await SW(s),!self.ModuleFactory||o&&(await SW(o),!self.ModuleFactory))throw Error("ModuleFactory not set.");return self.Module&&c&&((s=self.Module).locateFile=c.locateFile,c.mainScriptUrlOrBlob&&(s.mainScriptUrlOrBlob=c.mainScriptUrlOrBlob)),c=await self.ModuleFactory(self.Module||c),self.ModuleFactory=self.Module=void 0,new i(c,a)})(t,n.wasmLoaderPath,n.assetLoaderPath,e,{locateFile:i=>i.endsWith(".wasm")?n.wasmBinaryPath.toString():n.assetBinaryPath&&i.endsWith(".data")?n.assetBinaryPath.toString():i}),await t.o(r),t}function f5(t,e){const n=tn(t.baseOptions,X3,1)||new X3;typeof e=="string"?(Hn(n,2,Ny(e)),Hn(n,1)):e instanceof Uint8Array&&(Hn(n,1,L9(e,!1)),Hn(n,2)),it(t.baseOptions,0,1,n)}function CW(t){try{const e=t.G.length;if(e===1)throw Error(t.G[0].message);if(e>1)throw Error("Encountered multiple errors: "+t.G.map((n=>n.message)).join(", "))}finally{t.G=[]}}function He(t,e){t.B=Math.max(t.B,e)}function u4(t,e){t.A=new Us,ca(t.A,"PassThroughCalculator"),Vn(t.A,"free_memory"),Yt(t.A,"free_memory_unused_out"),tr(e,"free_memory"),la(e,t.A)}function ry(t,e){Vn(t.A,e),Yt(t.A,e+"_unused_out")}function d4(t){t.g.addBoolToStream(!0,"free_memory",t.B)}var lC=class{constructor(t){this.g=t,this.G=[],this.B=0,this.g.setAutoRenderToScreen(!1)}l(t,e=!0){if(e){const n=t.baseOptions||{};if(t.baseOptions?.modelAssetBuffer&&t.baseOptions?.modelAssetPath)throw Error("Cannot set both baseOptions.modelAssetPath and baseOptions.modelAssetBuffer");if(!(tn(this.baseOptions,X3,1)?.g()||tn(this.baseOptions,X3,1)?.h()||t.baseOptions?.modelAssetBuffer||t.baseOptions?.modelAssetPath))throw Error("Either baseOptions.modelAssetPath or baseOptions.modelAssetBuffer must be set");if((function(r,i){let s=tn(r.baseOptions,gW,3);if(!s){var o=s=new gW,a=new uW;pb(o,4,cC,a)}"delegate"in i&&(i.delegate==="GPU"?(i=s,o=new uWe,pb(i,2,cC,o)):(i=s,o=new uW,pb(i,4,cC,o))),it(r.baseOptions,0,3,s)})(this,n),n.modelAssetPath)return fetch(n.modelAssetPath.toString()).then((r=>{if(r.ok)return r.arrayBuffer();throw Error(`Failed to fetch model: ${n.modelAssetPath} (${r.status})`)})).then((r=>{try{this.g.i.FS_unlink("/model.dat")}catch{}this.g.i.FS_createDataFile("/","model.dat",new Uint8Array(r),!0,!1,!1),f5(this,"/model.dat"),this.m(),this.I()}));if(n.modelAssetBuffer instanceof Uint8Array)f5(this,n.modelAssetBuffer);else if(n.modelAssetBuffer)return(async function(r){const i=[];for(var s=0;;){const{done:o,value:a}=await r.read();if(o)break;i.push(a),s+=a.length}if(i.length===0)return new Uint8Array(0);if(i.length===1)return i[0];r=new Uint8Array(s),s=0;for(const o of i)r.set(o,s),s+=o.length;return r})(n.modelAssetBuffer).then((r=>{f5(this,r),this.m(),this.I()}))}return this.m(),this.I(),Promise.resolve()}I(){}da(){let t;if(this.g.da((e=>{t=dWe(e)})),!t)throw Error("Failed to retrieve CalculatorGraphConfig");return t}setGraph(t,e){this.g.attachErrorListener(((n,r)=>{this.G.push(Error(r))})),this.g.La(),this.g.setGraph(t,e),this.A=void 0,CW(this)}finishProcessing(){this.g.finishProcessing(),CW(this)}close(){this.A=void 0,this.g.closeGraph()}};function Zu(t,e){if(!t)throw Error(`Unable to obtain required WebGL resource: ${e}`);return t}lC.prototype.close=lC.prototype.close,(function(t,e){t=t.split(".");var n,r=Vp;for((t[0]in r)||r.execScript===void 0||r.execScript("var "+t[0]);t.length&&(n=t.shift());)t.length||e===void 0?r=r[n]&&r[n]!==Object.prototype[n]?r[n]:r[n]={}:r[n]=e})("TaskRunner",lC);class jWe{constructor(e,n,r,i){this.g=e,this.h=n,this.m=r,this.l=i}bind(){this.g.bindVertexArray(this.h)}close(){this.g.deleteVertexArray(this.h),this.g.deleteBuffer(this.m),this.g.deleteBuffer(this.l)}}function TW(t,e,n){const r=t.g;if(n=Zu(r.createShader(n),"Failed to create WebGL shader"),r.shaderSource(n,e),r.compileShader(n),!r.getShaderParameter(n,r.COMPILE_STATUS))throw Error(`Could not compile WebGL shader: ${r.getShaderInfoLog(n)}`);return r.attachShader(t.h,n),n}function RW(t,e){const n=t.g,r=Zu(n.createVertexArray(),"Failed to create vertex array");n.bindVertexArray(r);const i=Zu(n.createBuffer(),"Failed to create buffer");n.bindBuffer(n.ARRAY_BUFFER,i),n.enableVertexAttribArray(t.O),n.vertexAttribPointer(t.O,2,n.FLOAT,!1,0,0),n.bufferData(n.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),n.STATIC_DRAW);const s=Zu(n.createBuffer(),"Failed to create buffer");return n.bindBuffer(n.ARRAY_BUFFER,s),n.enableVertexAttribArray(t.I),n.vertexAttribPointer(t.I,2,n.FLOAT,!1,0,0),n.bufferData(n.ARRAY_BUFFER,new Float32Array(e?[0,1,0,0,1,0,1,1]:[0,0,0,1,1,1,1,0]),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,null),n.bindVertexArray(null),new jWe(n,r,i,s)}function bD(t,e){if(t.g){if(e!==t.g)throw Error("Cannot change GL context once initialized")}else t.g=e}function _D(t,e,n,r){return bD(t,e),t.h||(t.m(),t.C()),n?(t.s||(t.s=RW(t,!0)),n=t.s):(t.v||(t.v=RW(t,!1)),n=t.v),e.useProgram(t.h),n.bind(),t.l(),t=r(),n.g.bindVertexArray(null),t}function f4(t,e,n){return bD(t,e),t=Zu(e.createTexture(),"Failed to create texture"),e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,n??e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,n??e.LINEAR),e.bindTexture(e.TEXTURE_2D,null),t}function h4(t,e,n){bD(t,e),t.A||(t.A=Zu(e.createFramebuffer(),"Failed to create framebuffe.")),e.bindFramebuffer(e.FRAMEBUFFER,t.A),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0)}function SD(t){t.g?.bindFramebuffer(t.g.FRAMEBUFFER,null)}var wD=class{G(){return`
  precision mediump float;
  varying vec2 vTex;
  uniform sampler2D inputTexture;
  void main() {
    gl_FragColor = texture2D(inputTexture, vTex);
  }
 `}m(){const e=this.g;if(this.h=Zu(e.createProgram(),"Failed to create WebGL program"),this.aa=TW(this,`
  attribute vec2 aVertex;
  attribute vec2 aTex;
  varying vec2 vTex;
  void main(void) {
    gl_Position = vec4(aVertex, 0.0, 1.0);
    vTex = aTex;
  }`,e.VERTEX_SHADER),this.Z=TW(this,this.G(),e.FRAGMENT_SHADER),e.linkProgram(this.h),!e.getProgramParameter(this.h,e.LINK_STATUS))throw Error(`Error during program linking: ${e.getProgramInfoLog(this.h)}`);this.O=e.getAttribLocation(this.h,"aVertex"),this.I=e.getAttribLocation(this.h,"aTex")}C(){}l(){}close(){if(this.h){const e=this.g;e.deleteProgram(this.h),e.deleteShader(this.aa),e.deleteShader(this.Z)}this.A&&this.g.deleteFramebuffer(this.A),this.v&&this.v.close(),this.s&&this.s.close()}};function Uu(t,e){switch(e){case 0:return t.g.find((n=>n instanceof Uint8Array));case 1:return t.g.find((n=>n instanceof Float32Array));case 2:return t.g.find((n=>typeof WebGLTexture<"u"&&n instanceof WebGLTexture));default:throw Error(`Type is not supported: ${e}`)}}function yO(t){var e=Uu(t,1);if(!e){if(e=Uu(t,0))e=new Float32Array(e).map((r=>r/255));else{e=new Float32Array(t.width*t.height);const r=iy(t);var n=ED(t);if(h4(n,r,hfe(t)),"iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"document"in self&&"ontouchend"in self.document){n=new Float32Array(t.width*t.height*4),r.readPixels(0,0,t.width,t.height,r.RGBA,r.FLOAT,n);for(let i=0,s=0;i<e.length;++i,s+=4)e[i]=n[s]}else r.readPixels(0,0,t.width,t.height,r.RED,r.FLOAT,e)}t.g.push(e)}return e}function hfe(t){let e=Uu(t,2);if(!e){const n=iy(t);e=mfe(t);const r=yO(t),i=pfe(t);n.texImage2D(n.TEXTURE_2D,0,i,t.width,t.height,0,n.RED,n.FLOAT,r),bO(t)}return e}function iy(t){if(!t.canvas)throw Error("Conversion to different image formats require that a canvas is passed when initializing the image.");return t.h||(t.h=Zu(t.canvas.getContext("webgl2"),"You cannot use a canvas that is already bound to a different type of rendering context.")),t.h}function pfe(t){if(t=iy(t),!Ww)if(t.getExtension("EXT_color_buffer_float")&&t.getExtension("OES_texture_float_linear")&&t.getExtension("EXT_float_blend"))Ww=t.R32F;else{if(!t.getExtension("EXT_color_buffer_half_float"))throw Error("GPU does not fully support 4-channel float32 or float16 formats");Ww=t.R16F}return Ww}function ED(t){return t.l||(t.l=new wD),t.l}function mfe(t){const e=iy(t);e.viewport(0,0,t.width,t.height),e.activeTexture(e.TEXTURE0);let n=Uu(t,2);return n||(n=f4(ED(t),e,t.m?e.LINEAR:e.NEAREST),t.g.push(n),t.j=!0),e.bindTexture(e.TEXTURE_2D,n),n}function bO(t){t.h.bindTexture(t.h.TEXTURE_2D,null)}var Ww,Ii=class{constructor(t,e,n,r,i,s,o){this.g=t,this.m=e,this.j=n,this.canvas=r,this.l=i,this.width=s,this.height=o,this.j&&--kW===0&&console.error("You seem to be creating MPMask instances without invoking .close(). This leaks resources.")}Fa(){return!!Uu(this,0)}ja(){return!!Uu(this,1)}P(){return!!Uu(this,2)}ia(){return(e=Uu(t=this,0))||(e=yO(t),e=new Uint8Array(e.map((n=>255*n))),t.g.push(e)),e;var t,e}ha(){return yO(this)}M(){return hfe(this)}clone(){const t=[];for(const e of this.g){let n;if(e instanceof Uint8Array)n=new Uint8Array(e);else if(e instanceof Float32Array)n=new Float32Array(e);else{if(!(e instanceof WebGLTexture))throw Error(`Type is not supported: ${e}`);{const r=iy(this),i=ED(this);r.activeTexture(r.TEXTURE1),n=f4(i,r,this.m?r.LINEAR:r.NEAREST),r.bindTexture(r.TEXTURE_2D,n);const s=pfe(this);r.texImage2D(r.TEXTURE_2D,0,s,this.width,this.height,0,r.RED,r.FLOAT,null),r.bindTexture(r.TEXTURE_2D,null),h4(i,r,n),_D(i,r,!1,(()=>{mfe(this),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT),r.drawArrays(r.TRIANGLE_FAN,0,4),bO(this)})),SD(i),bO(this)}}t.push(n)}return new Ii(t,this.m,this.P(),this.canvas,this.l,this.width,this.height)}close(){this.j&&iy(this).deleteTexture(Uu(this,2)),kW=-1}};Ii.prototype.close=Ii.prototype.close,Ii.prototype.clone=Ii.prototype.clone,Ii.prototype.getAsWebGLTexture=Ii.prototype.M,Ii.prototype.getAsFloat32Array=Ii.prototype.ha,Ii.prototype.getAsUint8Array=Ii.prototype.ia,Ii.prototype.hasWebGLTexture=Ii.prototype.P,Ii.prototype.hasFloat32Array=Ii.prototype.ja,Ii.prototype.hasUint8Array=Ii.prototype.Fa;var kW=250;function yl(t,e){switch(e){case 0:return t.g.find((n=>n instanceof ImageData));case 1:return t.g.find((n=>typeof ImageBitmap<"u"&&n instanceof ImageBitmap));case 2:return t.g.find((n=>typeof WebGLTexture<"u"&&n instanceof WebGLTexture));default:throw Error(`Type is not supported: ${e}`)}}function gfe(t){var e=yl(t,0);if(!e){e=sy(t);const n=p4(t),r=new Uint8Array(t.width*t.height*4);h4(n,e,uC(t)),e.readPixels(0,0,t.width,t.height,e.RGBA,e.UNSIGNED_BYTE,r),SD(n),e=new ImageData(new Uint8ClampedArray(r.buffer),t.width,t.height),t.g.push(e)}return e}function uC(t){let e=yl(t,2);if(!e){const n=sy(t);e=dC(t);const r=yl(t,1)||gfe(t);n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,r),U1(t)}return e}function sy(t){if(!t.canvas)throw Error("Conversion to different image formats require that a canvas is passed when initializing the image.");return t.h||(t.h=Zu(t.canvas.getContext("webgl2"),"You cannot use a canvas that is already bound to a different type of rendering context.")),t.h}function p4(t){return t.l||(t.l=new wD),t.l}function dC(t){const e=sy(t);e.viewport(0,0,t.width,t.height),e.activeTexture(e.TEXTURE0);let n=yl(t,2);return n||(n=f4(p4(t),e),t.g.push(n),t.m=!0),e.bindTexture(e.TEXTURE_2D,n),n}function U1(t){t.h.bindTexture(t.h.TEXTURE_2D,null)}function IW(t){const e=sy(t);return _D(p4(t),e,!0,(()=>(function(n,r){const i=n.canvas;if(i.width===n.width&&i.height===n.height)return r();const s=i.width,o=i.height;return i.width=n.width,i.height=n.height,n=r(),i.width=s,i.height=o,n})(t,(()=>{if(e.bindFramebuffer(e.FRAMEBUFFER,null),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),e.drawArrays(e.TRIANGLE_FAN,0,4),!(t.canvas instanceof OffscreenCanvas))throw Error("Conversion to ImageBitmap requires that the MediaPipe Tasks is initialized with an OffscreenCanvas");return t.canvas.transferToImageBitmap()}))))}var xi=class{constructor(t,e,n,r,i,s,o){this.g=t,this.j=e,this.m=n,this.canvas=r,this.l=i,this.width=s,this.height=o,(this.j||this.m)&&--xW===0&&console.error("You seem to be creating MPImage instances without invoking .close(). This leaks resources.")}Ea(){return!!yl(this,0)}ka(){return!!yl(this,1)}P(){return!!yl(this,2)}Ca(){return gfe(this)}Ba(){var t=yl(this,1);return t||(uC(this),dC(this),t=IW(this),U1(this),this.g.push(t),this.j=!0),t}M(){return uC(this)}clone(){const t=[];for(const e of this.g){let n;if(e instanceof ImageData)n=new ImageData(e.data,this.width,this.height);else if(e instanceof WebGLTexture){const r=sy(this),i=p4(this);r.activeTexture(r.TEXTURE1),n=f4(i,r),r.bindTexture(r.TEXTURE_2D,n),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,this.width,this.height,0,r.RGBA,r.UNSIGNED_BYTE,null),r.bindTexture(r.TEXTURE_2D,null),h4(i,r,n),_D(i,r,!1,(()=>{dC(this),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT),r.drawArrays(r.TRIANGLE_FAN,0,4),U1(this)})),SD(i),U1(this)}else{if(!(e instanceof ImageBitmap))throw Error(`Type is not supported: ${e}`);uC(this),dC(this),n=IW(this),U1(this)}t.push(n)}return new xi(t,this.ka(),this.P(),this.canvas,this.l,this.width,this.height)}close(){this.j&&yl(this,1).close(),this.m&&sy(this).deleteTexture(yl(this,2)),xW=-1}};xi.prototype.close=xi.prototype.close,xi.prototype.clone=xi.prototype.clone,xi.prototype.getAsWebGLTexture=xi.prototype.M,xi.prototype.getAsImageBitmap=xi.prototype.Ba,xi.prototype.getAsImageData=xi.prototype.Ca,xi.prototype.hasWebGLTexture=xi.prototype.P,xi.prototype.hasImageBitmap=xi.prototype.ka,xi.prototype.hasImageData=xi.prototype.Ea;var xW=250;function zc(...t){return t.map((([e,n])=>({start:e,end:n})))}const FWe=(function(t){return class extends t{La(){this.i._registerModelResourcesGraphService()}}})((AW=class{constructor(t,e){this.l=!0,this.i=t,this.g=null,this.h=0,this.m=typeof this.i._addIntToInputStream=="function",e!==void 0?this.i.canvas=e:dfe()?this.i.canvas=new OffscreenCanvas(1,1):(console.warn("OffscreenCanvas not supported and GraphRunner constructor glCanvas parameter is undefined. Creating backup canvas."),this.i.canvas=document.createElement("canvas"))}async initializeGraph(t){const e=await(await fetch(t)).arrayBuffer();t=!(t.endsWith(".pbtxt")||t.endsWith(".textproto")),this.setGraph(new Uint8Array(e),t)}setGraphFromString(t){this.setGraph(new TextEncoder().encode(t),!1)}setGraph(t,e){const n=t.length,r=this.i._malloc(n);this.i.HEAPU8.set(t,r),e?this.i._changeBinaryGraph(n,r):this.i._changeTextGraph(n,r),this.i._free(r)}configureAudio(t,e,n,r,i){this.i._configureAudio||console.warn('Attempting to use configureAudio without support for input audio. Is build dep ":gl_graph_runner_audio" missing?'),Qe(this,r||"input_audio",(s=>{Qe(this,i=i||"audio_header",(o=>{this.i._configureAudio(s,o,t,e??0,n)}))}))}setAutoResizeCanvas(t){this.l=t}setAutoRenderToScreen(t){this.i._setAutoRenderToScreen(t)}setGpuBufferVerticalFlip(t){this.i.gpuOriginForWebTexturesIsBottomLeft=t}da(t){rl(this,"__graph_config__",(e=>{t(e)})),Qe(this,"__graph_config__",(e=>{this.i._getGraphConfig(e,void 0)})),delete this.i.simpleListeners.__graph_config__}attachErrorListener(t){this.i.errorListener=t}attachEmptyPacketListener(t,e){this.i.emptyPacketListeners=this.i.emptyPacketListeners||{},this.i.emptyPacketListeners[t]=e}addAudioToStream(t,e,n){this.addAudioToStreamWithShape(t,0,0,e,n)}addAudioToStreamWithShape(t,e,n,r,i){const s=4*t.length;this.h!==s&&(this.g&&this.i._free(this.g),this.g=this.i._malloc(s),this.h=s),this.i.HEAPF32.set(t,this.g/4),Qe(this,r,(o=>{this.i._addAudioToInputStream(this.g,e,n,o,i)}))}addGpuBufferToStream(t,e,n){Qe(this,e,(r=>{const[i,s]=wW(this,t,r);this.i._addBoundTextureToStream(r,i,s,n)}))}addBoolToStream(t,e,n){Qe(this,e,(r=>{this.i._addBoolToInputStream(t,r,n)}))}addDoubleToStream(t,e,n){Qe(this,e,(r=>{this.i._addDoubleToInputStream(t,r,n)}))}addFloatToStream(t,e,n){Qe(this,e,(r=>{this.i._addFloatToInputStream(t,r,n)}))}addIntToStream(t,e,n){Qe(this,e,(r=>{this.i._addIntToInputStream(t,r,n)}))}addUintToStream(t,e,n){Qe(this,e,(r=>{this.i._addUintToInputStream(t,r,n)}))}addStringToStream(t,e,n){Qe(this,e,(r=>{Qe(this,t,(i=>{this.i._addStringToInputStream(i,r,n)}))}))}addStringRecordToStream(t,e,n){Qe(this,e,(r=>{EW(this,Object.keys(t),(i=>{EW(this,Object.values(t),(s=>{this.i._addFlatHashMapToInputStream(i,s,Object.keys(t).length,r,n)}))}))}))}addProtoToStream(t,e,n,r){Qe(this,n,(i=>{Qe(this,e,(s=>{const o=this.i._malloc(t.length);this.i.HEAPU8.set(t,o),this.i._addProtoToInputStream(o,t.length,s,i,r),this.i._free(o)}))}))}addEmptyPacketToStream(t,e){Qe(this,t,(n=>{this.i._addEmptyPacketToInputStream(n,e)}))}addBoolVectorToStream(t,e,n){Qe(this,e,(r=>{const i=this.i._allocateBoolVector(t.length);if(!i)throw Error("Unable to allocate new bool vector on heap.");for(const s of t)this.i._addBoolVectorEntry(i,s);this.i._addBoolVectorToInputStream(i,r,n)}))}addDoubleVectorToStream(t,e,n){Qe(this,e,(r=>{const i=this.i._allocateDoubleVector(t.length);if(!i)throw Error("Unable to allocate new double vector on heap.");for(const s of t)this.i._addDoubleVectorEntry(i,s);this.i._addDoubleVectorToInputStream(i,r,n)}))}addFloatVectorToStream(t,e,n){Qe(this,e,(r=>{const i=this.i._allocateFloatVector(t.length);if(!i)throw Error("Unable to allocate new float vector on heap.");for(const s of t)this.i._addFloatVectorEntry(i,s);this.i._addFloatVectorToInputStream(i,r,n)}))}addIntVectorToStream(t,e,n){Qe(this,e,(r=>{const i=this.i._allocateIntVector(t.length);if(!i)throw Error("Unable to allocate new int vector on heap.");for(const s of t)this.i._addIntVectorEntry(i,s);this.i._addIntVectorToInputStream(i,r,n)}))}addUintVectorToStream(t,e,n){Qe(this,e,(r=>{const i=this.i._allocateUintVector(t.length);if(!i)throw Error("Unable to allocate new unsigned int vector on heap.");for(const s of t)this.i._addUintVectorEntry(i,s);this.i._addUintVectorToInputStream(i,r,n)}))}addStringVectorToStream(t,e,n){Qe(this,e,(r=>{const i=this.i._allocateStringVector(t.length);if(!i)throw Error("Unable to allocate new string vector on heap.");for(const s of t)Qe(this,s,(o=>{this.i._addStringVectorEntry(i,o)}));this.i._addStringVectorToInputStream(i,r,n)}))}addBoolToInputSidePacket(t,e){Qe(this,e,(n=>{this.i._addBoolToInputSidePacket(t,n)}))}addDoubleToInputSidePacket(t,e){Qe(this,e,(n=>{this.i._addDoubleToInputSidePacket(t,n)}))}addFloatToInputSidePacket(t,e){Qe(this,e,(n=>{this.i._addFloatToInputSidePacket(t,n)}))}addIntToInputSidePacket(t,e){Qe(this,e,(n=>{this.i._addIntToInputSidePacket(t,n)}))}addUintToInputSidePacket(t,e){Qe(this,e,(n=>{this.i._addUintToInputSidePacket(t,n)}))}addStringToInputSidePacket(t,e){Qe(this,e,(n=>{Qe(this,t,(r=>{this.i._addStringToInputSidePacket(r,n)}))}))}addProtoToInputSidePacket(t,e,n){Qe(this,n,(r=>{Qe(this,e,(i=>{const s=this.i._malloc(t.length);this.i.HEAPU8.set(t,s),this.i._addProtoToInputSidePacket(s,t.length,i,r),this.i._free(s)}))}))}addBoolVectorToInputSidePacket(t,e){Qe(this,e,(n=>{const r=this.i._allocateBoolVector(t.length);if(!r)throw Error("Unable to allocate new bool vector on heap.");for(const i of t)this.i._addBoolVectorEntry(r,i);this.i._addBoolVectorToInputSidePacket(r,n)}))}addDoubleVectorToInputSidePacket(t,e){Qe(this,e,(n=>{const r=this.i._allocateDoubleVector(t.length);if(!r)throw Error("Unable to allocate new double vector on heap.");for(const i of t)this.i._addDoubleVectorEntry(r,i);this.i._addDoubleVectorToInputSidePacket(r,n)}))}addFloatVectorToInputSidePacket(t,e){Qe(this,e,(n=>{const r=this.i._allocateFloatVector(t.length);if(!r)throw Error("Unable to allocate new float vector on heap.");for(const i of t)this.i._addFloatVectorEntry(r,i);this.i._addFloatVectorToInputSidePacket(r,n)}))}addIntVectorToInputSidePacket(t,e){Qe(this,e,(n=>{const r=this.i._allocateIntVector(t.length);if(!r)throw Error("Unable to allocate new int vector on heap.");for(const i of t)this.i._addIntVectorEntry(r,i);this.i._addIntVectorToInputSidePacket(r,n)}))}addUintVectorToInputSidePacket(t,e){Qe(this,e,(n=>{const r=this.i._allocateUintVector(t.length);if(!r)throw Error("Unable to allocate new unsigned int vector on heap.");for(const i of t)this.i._addUintVectorEntry(r,i);this.i._addUintVectorToInputSidePacket(r,n)}))}addStringVectorToInputSidePacket(t,e){Qe(this,e,(n=>{const r=this.i._allocateStringVector(t.length);if(!r)throw Error("Unable to allocate new string vector on heap.");for(const i of t)Qe(this,i,(s=>{this.i._addStringVectorEntry(r,s)}));this.i._addStringVectorToInputSidePacket(r,n)}))}attachBoolListener(t,e){rl(this,t,e),Qe(this,t,(n=>{this.i._attachBoolListener(n)}))}attachBoolVectorListener(t,e){Qd(this,t,e),Qe(this,t,(n=>{this.i._attachBoolVectorListener(n)}))}attachIntListener(t,e){rl(this,t,e),Qe(this,t,(n=>{this.i._attachIntListener(n)}))}attachIntVectorListener(t,e){Qd(this,t,e),Qe(this,t,(n=>{this.i._attachIntVectorListener(n)}))}attachUintListener(t,e){rl(this,t,e),Qe(this,t,(n=>{this.i._attachUintListener(n)}))}attachUintVectorListener(t,e){Qd(this,t,e),Qe(this,t,(n=>{this.i._attachUintVectorListener(n)}))}attachDoubleListener(t,e){rl(this,t,e),Qe(this,t,(n=>{this.i._attachDoubleListener(n)}))}attachDoubleVectorListener(t,e){Qd(this,t,e),Qe(this,t,(n=>{this.i._attachDoubleVectorListener(n)}))}attachFloatListener(t,e){rl(this,t,e),Qe(this,t,(n=>{this.i._attachFloatListener(n)}))}attachFloatVectorListener(t,e){Qd(this,t,e),Qe(this,t,(n=>{this.i._attachFloatVectorListener(n)}))}attachStringListener(t,e){rl(this,t,e),Qe(this,t,(n=>{this.i._attachStringListener(n)}))}attachStringVectorListener(t,e){Qd(this,t,e),Qe(this,t,(n=>{this.i._attachStringVectorListener(n)}))}attachProtoListener(t,e,n){rl(this,t,e),Qe(this,t,(r=>{this.i._attachProtoListener(r,n||!1)}))}attachProtoVectorListener(t,e,n){Qd(this,t,e),Qe(this,t,(r=>{this.i._attachProtoVectorListener(r,n||!1)}))}attachAudioListener(t,e,n){this.i._attachAudioListener||console.warn('Attempting to use attachAudioListener without support for output audio. Is build dep ":gl_graph_runner_audio_out" missing?'),rl(this,t,((r,i)=>{r=new Float32Array(r.buffer,r.byteOffset,r.length/4),e(r,i)})),Qe(this,t,(r=>{this.i._attachAudioListener(r,n||!1)}))}finishProcessing(){this.i._waitUntilIdle()}closeGraph(){this.i._closeGraph(),this.i.simpleListeners=void 0,this.i.emptyPacketListeners=void 0}},class extends AW{get ea(){return this.i}qa(t,e,n){Qe(this,e,(r=>{const[i,s]=wW(this,t,r);this.ea._addBoundTextureAsImageToStream(r,i,s,n)}))}U(t,e){rl(this,t,e),Qe(this,t,(n=>{this.ea._attachImageListener(n)}))}ca(t,e){Qd(this,t,e),Qe(this,t,(n=>{this.ea._attachImageVectorListener(n)}))}}));var AW,rc=class extends FWe{};async function Gt(t,e,n){return(async function(r,i,s,o){return UWe(r,i,s,o)})(t,n.canvas??(dfe()?void 0:document.createElement("canvas")),e,n)}function vfe(t,e,n,r){if(t.T){const s=new $de;if(n?.regionOfInterest){if(!t.pa)throw Error("This task doesn't support region-of-interest.");var i=n.regionOfInterest;if(i.left>=i.right||i.top>=i.bottom)throw Error("Expected RectF with left < right and top < bottom.");if(i.left<0||i.top<0||i.right>1||i.bottom>1)throw Error("Expected RectF values to be in [0,1].");Xe(s,1,(i.left+i.right)/2),Xe(s,2,(i.top+i.bottom)/2),Xe(s,4,i.right-i.left),Xe(s,3,i.bottom-i.top)}else Xe(s,1,.5),Xe(s,2,.5),Xe(s,4,1),Xe(s,3,1);if(n?.rotationDegrees){if(n?.rotationDegrees%90!=0)throw Error("Expected rotation to be a multiple of 90°.");if(Xe(s,5,-Math.PI*n.rotationDegrees/180),n?.rotationDegrees%180!=0){const[o,a]=ffe(e);n=Fr(s,3)*a/o,i=Fr(s,4)*o/a,Xe(s,4,n),Xe(s,3,i)}}t.g.addProtoToStream(s.g(),"mediapipe.NormalizedRect",t.T,r)}t.g.qa(e,t.aa,r??performance.now()),t.finishProcessing()}function ic(t,e,n){if(t.baseOptions?.g())throw Error("Task is not initialized with image mode. 'runningMode' must be set to 'IMAGE'.");vfe(t,e,n,t.B+1)}function Hl(t,e,n,r){if(!t.baseOptions?.g())throw Error("Task is not initialized with video mode. 'runningMode' must be set to 'VIDEO'.");vfe(t,e,n,r)}function oy(t,e,n,r){var i=e.data;const s=e.width,o=s*(e=e.height);if((i instanceof Uint8Array||i instanceof Float32Array)&&i.length!==o)throw Error("Unsupported channel count: "+i.length/o);return t=new Ii([i],n,!1,t.g.i.canvas,t.O,s,e),r?t.clone():t}var wo=class extends lC{constructor(t,e,n,r){super(t),this.g=t,this.aa=e,this.T=n,this.pa=r,this.O=new wD}l(t,e=!0){if("runningMode"in t&&S_(this.baseOptions,2,!!t.runningMode&&t.runningMode!=="IMAGE"),t.canvas!==void 0&&this.g.i.canvas!==t.canvas)throw Error("You must create a new task to reset the canvas.");return super.l(t,e)}close(){this.O.close(),super.close()}};wo.prototype.close=wo.prototype.close;var Ea=class extends wo{constructor(t,e){super(new rc(t,e),"image_in","norm_rect_in",!1),this.j={detections:[]},it(t=this.h=new c4,0,1,e=new dr),Xe(this.h,2,.5),Xe(this.h,3,.3)}get baseOptions(){return tn(this.h,dr,1)}set baseOptions(t){it(this.h,0,1,t)}o(t){return"minDetectionConfidence"in t&&Xe(this.h,2,t.minDetectionConfidence??.5),"minSuppressionThreshold"in t&&Xe(this.h,3,t.minSuppressionThreshold??.3),this.l(t)}D(t,e){return this.j={detections:[]},ic(this,t,e),this.j}F(t,e,n){return this.j={detections:[]},Hl(this,t,n,e),this.j}m(){var t=new Co;tr(t,"image_in"),tr(t,"norm_rect_in"),on(t,"detections");const e=new sa;Vc(e,EWe,this.h);const n=new Us;ca(n,"mediapipe.tasks.vision.face_detector.FaceDetectorGraph"),Vn(n,"IMAGE:image_in"),Vn(n,"NORM_RECT:norm_rect_in"),Yt(n,"DETECTIONS:detections"),n.o(e),la(t,n),this.g.attachProtoVectorListener("detections",((r,i)=>{for(const s of r)r=Ude(s),this.j.detections.push(lfe(r));He(this,i)})),this.g.attachEmptyPacketListener("detections",(r=>{He(this,r)})),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};Ea.prototype.detectForVideo=Ea.prototype.F,Ea.prototype.detect=Ea.prototype.D,Ea.prototype.setOptions=Ea.prototype.o,Ea.createFromModelPath=async function(t,e){return Gt(Ea,t,{baseOptions:{modelAssetPath:e}})},Ea.createFromModelBuffer=function(t,e){return Gt(Ea,t,{baseOptions:{modelAssetBuffer:e}})},Ea.createFromOptions=function(t,e){return Gt(Ea,t,e)};var CD=zc([61,146],[146,91],[91,181],[181,84],[84,17],[17,314],[314,405],[405,321],[321,375],[375,291],[61,185],[185,40],[40,39],[39,37],[37,0],[0,267],[267,269],[269,270],[270,409],[409,291],[78,95],[95,88],[88,178],[178,87],[87,14],[14,317],[317,402],[402,318],[318,324],[324,308],[78,191],[191,80],[80,81],[81,82],[82,13],[13,312],[312,311],[311,310],[310,415],[415,308]),TD=zc([263,249],[249,390],[390,373],[373,374],[374,380],[380,381],[381,382],[382,362],[263,466],[466,388],[388,387],[387,386],[386,385],[385,384],[384,398],[398,362]),RD=zc([276,283],[283,282],[282,295],[295,285],[300,293],[293,334],[334,296],[296,336]),yfe=zc([474,475],[475,476],[476,477],[477,474]),kD=zc([33,7],[7,163],[163,144],[144,145],[145,153],[153,154],[154,155],[155,133],[33,246],[246,161],[161,160],[160,159],[159,158],[158,157],[157,173],[173,133]),ID=zc([46,53],[53,52],[52,65],[65,55],[70,63],[63,105],[105,66],[66,107]),bfe=zc([469,470],[470,471],[471,472],[472,469]),xD=zc([10,338],[338,297],[297,332],[332,284],[284,251],[251,389],[389,356],[356,454],[454,323],[323,361],[361,288],[288,397],[397,365],[365,379],[379,378],[378,400],[400,377],[377,152],[152,148],[148,176],[176,149],[149,150],[150,136],[136,172],[172,58],[58,132],[132,93],[93,234],[234,127],[127,162],[162,21],[21,54],[54,103],[103,67],[67,109],[109,10]),_fe=[...CD,...TD,...RD,...kD,...ID,...xD],Sfe=zc([127,34],[34,139],[139,127],[11,0],[0,37],[37,11],[232,231],[231,120],[120,232],[72,37],[37,39],[39,72],[128,121],[121,47],[47,128],[232,121],[121,128],[128,232],[104,69],[69,67],[67,104],[175,171],[171,148],[148,175],[118,50],[50,101],[101,118],[73,39],[39,40],[40,73],[9,151],[151,108],[108,9],[48,115],[115,131],[131,48],[194,204],[204,211],[211,194],[74,40],[40,185],[185,74],[80,42],[42,183],[183,80],[40,92],[92,186],[186,40],[230,229],[229,118],[118,230],[202,212],[212,214],[214,202],[83,18],[18,17],[17,83],[76,61],[61,146],[146,76],[160,29],[29,30],[30,160],[56,157],[157,173],[173,56],[106,204],[204,194],[194,106],[135,214],[214,192],[192,135],[203,165],[165,98],[98,203],[21,71],[71,68],[68,21],[51,45],[45,4],[4,51],[144,24],[24,23],[23,144],[77,146],[146,91],[91,77],[205,50],[50,187],[187,205],[201,200],[200,18],[18,201],[91,106],[106,182],[182,91],[90,91],[91,181],[181,90],[85,84],[84,17],[17,85],[206,203],[203,36],[36,206],[148,171],[171,140],[140,148],[92,40],[40,39],[39,92],[193,189],[189,244],[244,193],[159,158],[158,28],[28,159],[247,246],[246,161],[161,247],[236,3],[3,196],[196,236],[54,68],[68,104],[104,54],[193,168],[168,8],[8,193],[117,228],[228,31],[31,117],[189,193],[193,55],[55,189],[98,97],[97,99],[99,98],[126,47],[47,100],[100,126],[166,79],[79,218],[218,166],[155,154],[154,26],[26,155],[209,49],[49,131],[131,209],[135,136],[136,150],[150,135],[47,126],[126,217],[217,47],[223,52],[52,53],[53,223],[45,51],[51,134],[134,45],[211,170],[170,140],[140,211],[67,69],[69,108],[108,67],[43,106],[106,91],[91,43],[230,119],[119,120],[120,230],[226,130],[130,247],[247,226],[63,53],[53,52],[52,63],[238,20],[20,242],[242,238],[46,70],[70,156],[156,46],[78,62],[62,96],[96,78],[46,53],[53,63],[63,46],[143,34],[34,227],[227,143],[123,117],[117,111],[111,123],[44,125],[125,19],[19,44],[236,134],[134,51],[51,236],[216,206],[206,205],[205,216],[154,153],[153,22],[22,154],[39,37],[37,167],[167,39],[200,201],[201,208],[208,200],[36,142],[142,100],[100,36],[57,212],[212,202],[202,57],[20,60],[60,99],[99,20],[28,158],[158,157],[157,28],[35,226],[226,113],[113,35],[160,159],[159,27],[27,160],[204,202],[202,210],[210,204],[113,225],[225,46],[46,113],[43,202],[202,204],[204,43],[62,76],[76,77],[77,62],[137,123],[123,116],[116,137],[41,38],[38,72],[72,41],[203,129],[129,142],[142,203],[64,98],[98,240],[240,64],[49,102],[102,64],[64,49],[41,73],[73,74],[74,41],[212,216],[216,207],[207,212],[42,74],[74,184],[184,42],[169,170],[170,211],[211,169],[170,149],[149,176],[176,170],[105,66],[66,69],[69,105],[122,6],[6,168],[168,122],[123,147],[147,187],[187,123],[96,77],[77,90],[90,96],[65,55],[55,107],[107,65],[89,90],[90,180],[180,89],[101,100],[100,120],[120,101],[63,105],[105,104],[104,63],[93,137],[137,227],[227,93],[15,86],[86,85],[85,15],[129,102],[102,49],[49,129],[14,87],[87,86],[86,14],[55,8],[8,9],[9,55],[100,47],[47,121],[121,100],[145,23],[23,22],[22,145],[88,89],[89,179],[179,88],[6,122],[122,196],[196,6],[88,95],[95,96],[96,88],[138,172],[172,136],[136,138],[215,58],[58,172],[172,215],[115,48],[48,219],[219,115],[42,80],[80,81],[81,42],[195,3],[3,51],[51,195],[43,146],[146,61],[61,43],[171,175],[175,199],[199,171],[81,82],[82,38],[38,81],[53,46],[46,225],[225,53],[144,163],[163,110],[110,144],[52,65],[65,66],[66,52],[229,228],[228,117],[117,229],[34,127],[127,234],[234,34],[107,108],[108,69],[69,107],[109,108],[108,151],[151,109],[48,64],[64,235],[235,48],[62,78],[78,191],[191,62],[129,209],[209,126],[126,129],[111,35],[35,143],[143,111],[117,123],[123,50],[50,117],[222,65],[65,52],[52,222],[19,125],[125,141],[141,19],[221,55],[55,65],[65,221],[3,195],[195,197],[197,3],[25,7],[7,33],[33,25],[220,237],[237,44],[44,220],[70,71],[71,139],[139,70],[122,193],[193,245],[245,122],[247,130],[130,33],[33,247],[71,21],[21,162],[162,71],[170,169],[169,150],[150,170],[188,174],[174,196],[196,188],[216,186],[186,92],[92,216],[2,97],[97,167],[167,2],[141,125],[125,241],[241,141],[164,167],[167,37],[37,164],[72,38],[38,12],[12,72],[38,82],[82,13],[13,38],[63,68],[68,71],[71,63],[226,35],[35,111],[111,226],[101,50],[50,205],[205,101],[206,92],[92,165],[165,206],[209,198],[198,217],[217,209],[165,167],[167,97],[97,165],[220,115],[115,218],[218,220],[133,112],[112,243],[243,133],[239,238],[238,241],[241,239],[214,135],[135,169],[169,214],[190,173],[173,133],[133,190],[171,208],[208,32],[32,171],[125,44],[44,237],[237,125],[86,87],[87,178],[178,86],[85,86],[86,179],[179,85],[84,85],[85,180],[180,84],[83,84],[84,181],[181,83],[201,83],[83,182],[182,201],[137,93],[93,132],[132,137],[76,62],[62,183],[183,76],[61,76],[76,184],[184,61],[57,61],[61,185],[185,57],[212,57],[57,186],[186,212],[214,207],[207,187],[187,214],[34,143],[143,156],[156,34],[79,239],[239,237],[237,79],[123,137],[137,177],[177,123],[44,1],[1,4],[4,44],[201,194],[194,32],[32,201],[64,102],[102,129],[129,64],[213,215],[215,138],[138,213],[59,166],[166,219],[219,59],[242,99],[99,97],[97,242],[2,94],[94,141],[141,2],[75,59],[59,235],[235,75],[24,110],[110,228],[228,24],[25,130],[130,226],[226,25],[23,24],[24,229],[229,23],[22,23],[23,230],[230,22],[26,22],[22,231],[231,26],[112,26],[26,232],[232,112],[189,190],[190,243],[243,189],[221,56],[56,190],[190,221],[28,56],[56,221],[221,28],[27,28],[28,222],[222,27],[29,27],[27,223],[223,29],[30,29],[29,224],[224,30],[247,30],[30,225],[225,247],[238,79],[79,20],[20,238],[166,59],[59,75],[75,166],[60,75],[75,240],[240,60],[147,177],[177,215],[215,147],[20,79],[79,166],[166,20],[187,147],[147,213],[213,187],[112,233],[233,244],[244,112],[233,128],[128,245],[245,233],[128,114],[114,188],[188,128],[114,217],[217,174],[174,114],[131,115],[115,220],[220,131],[217,198],[198,236],[236,217],[198,131],[131,134],[134,198],[177,132],[132,58],[58,177],[143,35],[35,124],[124,143],[110,163],[163,7],[7,110],[228,110],[110,25],[25,228],[356,389],[389,368],[368,356],[11,302],[302,267],[267,11],[452,350],[350,349],[349,452],[302,303],[303,269],[269,302],[357,343],[343,277],[277,357],[452,453],[453,357],[357,452],[333,332],[332,297],[297,333],[175,152],[152,377],[377,175],[347,348],[348,330],[330,347],[303,304],[304,270],[270,303],[9,336],[336,337],[337,9],[278,279],[279,360],[360,278],[418,262],[262,431],[431,418],[304,408],[408,409],[409,304],[310,415],[415,407],[407,310],[270,409],[409,410],[410,270],[450,348],[348,347],[347,450],[422,430],[430,434],[434,422],[313,314],[314,17],[17,313],[306,307],[307,375],[375,306],[387,388],[388,260],[260,387],[286,414],[414,398],[398,286],[335,406],[406,418],[418,335],[364,367],[367,416],[416,364],[423,358],[358,327],[327,423],[251,284],[284,298],[298,251],[281,5],[5,4],[4,281],[373,374],[374,253],[253,373],[307,320],[320,321],[321,307],[425,427],[427,411],[411,425],[421,313],[313,18],[18,421],[321,405],[405,406],[406,321],[320,404],[404,405],[405,320],[315,16],[16,17],[17,315],[426,425],[425,266],[266,426],[377,400],[400,369],[369,377],[322,391],[391,269],[269,322],[417,465],[465,464],[464,417],[386,257],[257,258],[258,386],[466,260],[260,388],[388,466],[456,399],[399,419],[419,456],[284,332],[332,333],[333,284],[417,285],[285,8],[8,417],[346,340],[340,261],[261,346],[413,441],[441,285],[285,413],[327,460],[460,328],[328,327],[355,371],[371,329],[329,355],[392,439],[439,438],[438,392],[382,341],[341,256],[256,382],[429,420],[420,360],[360,429],[364,394],[394,379],[379,364],[277,343],[343,437],[437,277],[443,444],[444,283],[283,443],[275,440],[440,363],[363,275],[431,262],[262,369],[369,431],[297,338],[338,337],[337,297],[273,375],[375,321],[321,273],[450,451],[451,349],[349,450],[446,342],[342,467],[467,446],[293,334],[334,282],[282,293],[458,461],[461,462],[462,458],[276,353],[353,383],[383,276],[308,324],[324,325],[325,308],[276,300],[300,293],[293,276],[372,345],[345,447],[447,372],[352,345],[345,340],[340,352],[274,1],[1,19],[19,274],[456,248],[248,281],[281,456],[436,427],[427,425],[425,436],[381,256],[256,252],[252,381],[269,391],[391,393],[393,269],[200,199],[199,428],[428,200],[266,330],[330,329],[329,266],[287,273],[273,422],[422,287],[250,462],[462,328],[328,250],[258,286],[286,384],[384,258],[265,353],[353,342],[342,265],[387,259],[259,257],[257,387],[424,431],[431,430],[430,424],[342,353],[353,276],[276,342],[273,335],[335,424],[424,273],[292,325],[325,307],[307,292],[366,447],[447,345],[345,366],[271,303],[303,302],[302,271],[423,266],[266,371],[371,423],[294,455],[455,460],[460,294],[279,278],[278,294],[294,279],[271,272],[272,304],[304,271],[432,434],[434,427],[427,432],[272,407],[407,408],[408,272],[394,430],[430,431],[431,394],[395,369],[369,400],[400,395],[334,333],[333,299],[299,334],[351,417],[417,168],[168,351],[352,280],[280,411],[411,352],[325,319],[319,320],[320,325],[295,296],[296,336],[336,295],[319,403],[403,404],[404,319],[330,348],[348,349],[349,330],[293,298],[298,333],[333,293],[323,454],[454,447],[447,323],[15,16],[16,315],[315,15],[358,429],[429,279],[279,358],[14,15],[15,316],[316,14],[285,336],[336,9],[9,285],[329,349],[349,350],[350,329],[374,380],[380,252],[252,374],[318,402],[402,403],[403,318],[6,197],[197,419],[419,6],[318,319],[319,325],[325,318],[367,364],[364,365],[365,367],[435,367],[367,397],[397,435],[344,438],[438,439],[439,344],[272,271],[271,311],[311,272],[195,5],[5,281],[281,195],[273,287],[287,291],[291,273],[396,428],[428,199],[199,396],[311,271],[271,268],[268,311],[283,444],[444,445],[445,283],[373,254],[254,339],[339,373],[282,334],[334,296],[296,282],[449,347],[347,346],[346,449],[264,447],[447,454],[454,264],[336,296],[296,299],[299,336],[338,10],[10,151],[151,338],[278,439],[439,455],[455,278],[292,407],[407,415],[415,292],[358,371],[371,355],[355,358],[340,345],[345,372],[372,340],[346,347],[347,280],[280,346],[442,443],[443,282],[282,442],[19,94],[94,370],[370,19],[441,442],[442,295],[295,441],[248,419],[419,197],[197,248],[263,255],[255,359],[359,263],[440,275],[275,274],[274,440],[300,383],[383,368],[368,300],[351,412],[412,465],[465,351],[263,467],[467,466],[466,263],[301,368],[368,389],[389,301],[395,378],[378,379],[379,395],[412,351],[351,419],[419,412],[436,426],[426,322],[322,436],[2,164],[164,393],[393,2],[370,462],[462,461],[461,370],[164,0],[0,267],[267,164],[302,11],[11,12],[12,302],[268,12],[12,13],[13,268],[293,300],[300,301],[301,293],[446,261],[261,340],[340,446],[330,266],[266,425],[425,330],[426,423],[423,391],[391,426],[429,355],[355,437],[437,429],[391,327],[327,326],[326,391],[440,457],[457,438],[438,440],[341,382],[382,362],[362,341],[459,457],[457,461],[461,459],[434,430],[430,394],[394,434],[414,463],[463,362],[362,414],[396,369],[369,262],[262,396],[354,461],[461,457],[457,354],[316,403],[403,402],[402,316],[315,404],[404,403],[403,315],[314,405],[405,404],[404,314],[313,406],[406,405],[405,313],[421,418],[418,406],[406,421],[366,401],[401,361],[361,366],[306,408],[408,407],[407,306],[291,409],[409,408],[408,291],[287,410],[410,409],[409,287],[432,436],[436,410],[410,432],[434,416],[416,411],[411,434],[264,368],[368,383],[383,264],[309,438],[438,457],[457,309],[352,376],[376,401],[401,352],[274,275],[275,4],[4,274],[421,428],[428,262],[262,421],[294,327],[327,358],[358,294],[433,416],[416,367],[367,433],[289,455],[455,439],[439,289],[462,370],[370,326],[326,462],[2,326],[326,370],[370,2],[305,460],[460,455],[455,305],[254,449],[449,448],[448,254],[255,261],[261,446],[446,255],[253,450],[450,449],[449,253],[252,451],[451,450],[450,252],[256,452],[452,451],[451,256],[341,453],[453,452],[452,341],[413,464],[464,463],[463,413],[441,413],[413,414],[414,441],[258,442],[442,441],[441,258],[257,443],[443,442],[442,257],[259,444],[444,443],[443,259],[260,445],[445,444],[444,260],[467,342],[342,445],[445,467],[459,458],[458,250],[250,459],[289,392],[392,290],[290,289],[290,328],[328,460],[460,290],[376,433],[433,435],[435,376],[250,290],[290,392],[392,250],[411,416],[416,433],[433,411],[341,463],[463,464],[464,341],[453,464],[464,465],[465,453],[357,465],[465,412],[412,357],[343,412],[412,399],[399,343],[360,363],[363,440],[440,360],[437,399],[399,456],[456,437],[420,456],[456,363],[363,420],[401,435],[435,288],[288,401],[372,383],[383,353],[353,372],[339,255],[255,249],[249,339],[448,261],[261,255],[255,448],[133,243],[243,190],[190,133],[133,155],[155,112],[112,133],[33,246],[246,247],[247,33],[33,130],[130,25],[25,33],[398,384],[384,286],[286,398],[362,398],[398,414],[414,362],[362,463],[463,341],[341,362],[263,359],[359,467],[467,263],[263,249],[249,255],[255,263],[466,467],[467,260],[260,466],[75,60],[60,166],[166,75],[238,239],[239,79],[79,238],[162,127],[127,139],[139,162],[72,11],[11,37],[37,72],[121,232],[232,120],[120,121],[73,72],[72,39],[39,73],[114,128],[128,47],[47,114],[233,232],[232,128],[128,233],[103,104],[104,67],[67,103],[152,175],[175,148],[148,152],[119,118],[118,101],[101,119],[74,73],[73,40],[40,74],[107,9],[9,108],[108,107],[49,48],[48,131],[131,49],[32,194],[194,211],[211,32],[184,74],[74,185],[185,184],[191,80],[80,183],[183,191],[185,40],[40,186],[186,185],[119,230],[230,118],[118,119],[210,202],[202,214],[214,210],[84,83],[83,17],[17,84],[77,76],[76,146],[146,77],[161,160],[160,30],[30,161],[190,56],[56,173],[173,190],[182,106],[106,194],[194,182],[138,135],[135,192],[192,138],[129,203],[203,98],[98,129],[54,21],[21,68],[68,54],[5,51],[51,4],[4,5],[145,144],[144,23],[23,145],[90,77],[77,91],[91,90],[207,205],[205,187],[187,207],[83,201],[201,18],[18,83],[181,91],[91,182],[182,181],[180,90],[90,181],[181,180],[16,85],[85,17],[17,16],[205,206],[206,36],[36,205],[176,148],[148,140],[140,176],[165,92],[92,39],[39,165],[245,193],[193,244],[244,245],[27,159],[159,28],[28,27],[30,247],[247,161],[161,30],[174,236],[236,196],[196,174],[103,54],[54,104],[104,103],[55,193],[193,8],[8,55],[111,117],[117,31],[31,111],[221,189],[189,55],[55,221],[240,98],[98,99],[99,240],[142,126],[126,100],[100,142],[219,166],[166,218],[218,219],[112,155],[155,26],[26,112],[198,209],[209,131],[131,198],[169,135],[135,150],[150,169],[114,47],[47,217],[217,114],[224,223],[223,53],[53,224],[220,45],[45,134],[134,220],[32,211],[211,140],[140,32],[109,67],[67,108],[108,109],[146,43],[43,91],[91,146],[231,230],[230,120],[120,231],[113,226],[226,247],[247,113],[105,63],[63,52],[52,105],[241,238],[238,242],[242,241],[124,46],[46,156],[156,124],[95,78],[78,96],[96,95],[70,46],[46,63],[63,70],[116,143],[143,227],[227,116],[116,123],[123,111],[111,116],[1,44],[44,19],[19,1],[3,236],[236,51],[51,3],[207,216],[216,205],[205,207],[26,154],[154,22],[22,26],[165,39],[39,167],[167,165],[199,200],[200,208],[208,199],[101,36],[36,100],[100,101],[43,57],[57,202],[202,43],[242,20],[20,99],[99,242],[56,28],[28,157],[157,56],[124,35],[35,113],[113,124],[29,160],[160,27],[27,29],[211,204],[204,210],[210,211],[124,113],[113,46],[46,124],[106,43],[43,204],[204,106],[96,62],[62,77],[77,96],[227,137],[137,116],[116,227],[73,41],[41,72],[72,73],[36,203],[203,142],[142,36],[235,64],[64,240],[240,235],[48,49],[49,64],[64,48],[42,41],[41,74],[74,42],[214,212],[212,207],[207,214],[183,42],[42,184],[184,183],[210,169],[169,211],[211,210],[140,170],[170,176],[176,140],[104,105],[105,69],[69,104],[193,122],[122,168],[168,193],[50,123],[123,187],[187,50],[89,96],[96,90],[90,89],[66,65],[65,107],[107,66],[179,89],[89,180],[180,179],[119,101],[101,120],[120,119],[68,63],[63,104],[104,68],[234,93],[93,227],[227,234],[16,15],[15,85],[85,16],[209,129],[129,49],[49,209],[15,14],[14,86],[86,15],[107,55],[55,9],[9,107],[120,100],[100,121],[121,120],[153,145],[145,22],[22,153],[178,88],[88,179],[179,178],[197,6],[6,196],[196,197],[89,88],[88,96],[96,89],[135,138],[138,136],[136,135],[138,215],[215,172],[172,138],[218,115],[115,219],[219,218],[41,42],[42,81],[81,41],[5,195],[195,51],[51,5],[57,43],[43,61],[61,57],[208,171],[171,199],[199,208],[41,81],[81,38],[38,41],[224,53],[53,225],[225,224],[24,144],[144,110],[110,24],[105,52],[52,66],[66,105],[118,229],[229,117],[117,118],[227,34],[34,234],[234,227],[66,107],[107,69],[69,66],[10,109],[109,151],[151,10],[219,48],[48,235],[235,219],[183,62],[62,191],[191,183],[142,129],[129,126],[126,142],[116,111],[111,143],[143,116],[118,117],[117,50],[50,118],[223,222],[222,52],[52,223],[94,19],[19,141],[141,94],[222,221],[221,65],[65,222],[196,3],[3,197],[197,196],[45,220],[220,44],[44,45],[156,70],[70,139],[139,156],[188,122],[122,245],[245,188],[139,71],[71,162],[162,139],[149,170],[170,150],[150,149],[122,188],[188,196],[196,122],[206,216],[216,92],[92,206],[164,2],[2,167],[167,164],[242,141],[141,241],[241,242],[0,164],[164,37],[37,0],[11,72],[72,12],[12,11],[12,38],[38,13],[13,12],[70,63],[63,71],[71,70],[31,226],[226,111],[111,31],[36,101],[101,205],[205,36],[203,206],[206,165],[165,203],[126,209],[209,217],[217,126],[98,165],[165,97],[97,98],[237,220],[220,218],[218,237],[237,239],[239,241],[241,237],[210,214],[214,169],[169,210],[140,171],[171,32],[32,140],[241,125],[125,237],[237,241],[179,86],[86,178],[178,179],[180,85],[85,179],[179,180],[181,84],[84,180],[180,181],[182,83],[83,181],[181,182],[194,201],[201,182],[182,194],[177,137],[137,132],[132,177],[184,76],[76,183],[183,184],[185,61],[61,184],[184,185],[186,57],[57,185],[185,186],[216,212],[212,186],[186,216],[192,214],[214,187],[187,192],[139,34],[34,156],[156,139],[218,79],[79,237],[237,218],[147,123],[123,177],[177,147],[45,44],[44,4],[4,45],[208,201],[201,32],[32,208],[98,64],[64,129],[129,98],[192,213],[213,138],[138,192],[235,59],[59,219],[219,235],[141,242],[242,97],[97,141],[97,2],[2,141],[141,97],[240,75],[75,235],[235,240],[229,24],[24,228],[228,229],[31,25],[25,226],[226,31],[230,23],[23,229],[229,230],[231,22],[22,230],[230,231],[232,26],[26,231],[231,232],[233,112],[112,232],[232,233],[244,189],[189,243],[243,244],[189,221],[221,190],[190,189],[222,28],[28,221],[221,222],[223,27],[27,222],[222,223],[224,29],[29,223],[223,224],[225,30],[30,224],[224,225],[113,247],[247,225],[225,113],[99,60],[60,240],[240,99],[213,147],[147,215],[215,213],[60,20],[20,166],[166,60],[192,187],[187,213],[213,192],[243,112],[112,244],[244,243],[244,233],[233,245],[245,244],[245,128],[128,188],[188,245],[188,114],[114,174],[174,188],[134,131],[131,220],[220,134],[174,217],[217,236],[236,174],[236,198],[198,134],[134,236],[215,177],[177,58],[58,215],[156,143],[143,124],[124,156],[25,110],[110,7],[7,25],[31,228],[228,25],[25,31],[264,356],[356,368],[368,264],[0,11],[11,267],[267,0],[451,452],[452,349],[349,451],[267,302],[302,269],[269,267],[350,357],[357,277],[277,350],[350,452],[452,357],[357,350],[299,333],[333,297],[297,299],[396,175],[175,377],[377,396],[280,347],[347,330],[330,280],[269,303],[303,270],[270,269],[151,9],[9,337],[337,151],[344,278],[278,360],[360,344],[424,418],[418,431],[431,424],[270,304],[304,409],[409,270],[272,310],[310,407],[407,272],[322,270],[270,410],[410,322],[449,450],[450,347],[347,449],[432,422],[422,434],[434,432],[18,313],[313,17],[17,18],[291,306],[306,375],[375,291],[259,387],[387,260],[260,259],[424,335],[335,418],[418,424],[434,364],[364,416],[416,434],[391,423],[423,327],[327,391],[301,251],[251,298],[298,301],[275,281],[281,4],[4,275],[254,373],[373,253],[253,254],[375,307],[307,321],[321,375],[280,425],[425,411],[411,280],[200,421],[421,18],[18,200],[335,321],[321,406],[406,335],[321,320],[320,405],[405,321],[314,315],[315,17],[17,314],[423,426],[426,266],[266,423],[396,377],[377,369],[369,396],[270,322],[322,269],[269,270],[413,417],[417,464],[464,413],[385,386],[386,258],[258,385],[248,456],[456,419],[419,248],[298,284],[284,333],[333,298],[168,417],[417,8],[8,168],[448,346],[346,261],[261,448],[417,413],[413,285],[285,417],[326,327],[327,328],[328,326],[277,355],[355,329],[329,277],[309,392],[392,438],[438,309],[381,382],[382,256],[256,381],[279,429],[429,360],[360,279],[365,364],[364,379],[379,365],[355,277],[277,437],[437,355],[282,443],[443,283],[283,282],[281,275],[275,363],[363,281],[395,431],[431,369],[369,395],[299,297],[297,337],[337,299],[335,273],[273,321],[321,335],[348,450],[450,349],[349,348],[359,446],[446,467],[467,359],[283,293],[293,282],[282,283],[250,458],[458,462],[462,250],[300,276],[276,383],[383,300],[292,308],[308,325],[325,292],[283,276],[276,293],[293,283],[264,372],[372,447],[447,264],[346,352],[352,340],[340,346],[354,274],[274,19],[19,354],[363,456],[456,281],[281,363],[426,436],[436,425],[425,426],[380,381],[381,252],[252,380],[267,269],[269,393],[393,267],[421,200],[200,428],[428,421],[371,266],[266,329],[329,371],[432,287],[287,422],[422,432],[290,250],[250,328],[328,290],[385,258],[258,384],[384,385],[446,265],[265,342],[342,446],[386,387],[387,257],[257,386],[422,424],[424,430],[430,422],[445,342],[342,276],[276,445],[422,273],[273,424],[424,422],[306,292],[292,307],[307,306],[352,366],[366,345],[345,352],[268,271],[271,302],[302,268],[358,423],[423,371],[371,358],[327,294],[294,460],[460,327],[331,279],[279,294],[294,331],[303,271],[271,304],[304,303],[436,432],[432,427],[427,436],[304,272],[272,408],[408,304],[395,394],[394,431],[431,395],[378,395],[395,400],[400,378],[296,334],[334,299],[299,296],[6,351],[351,168],[168,6],[376,352],[352,411],[411,376],[307,325],[325,320],[320,307],[285,295],[295,336],[336,285],[320,319],[319,404],[404,320],[329,330],[330,349],[349,329],[334,293],[293,333],[333,334],[366,323],[323,447],[447,366],[316,15],[15,315],[315,316],[331,358],[358,279],[279,331],[317,14],[14,316],[316,317],[8,285],[285,9],[9,8],[277,329],[329,350],[350,277],[253,374],[374,252],[252,253],[319,318],[318,403],[403,319],[351,6],[6,419],[419,351],[324,318],[318,325],[325,324],[397,367],[367,365],[365,397],[288,435],[435,397],[397,288],[278,344],[344,439],[439,278],[310,272],[272,311],[311,310],[248,195],[195,281],[281,248],[375,273],[273,291],[291,375],[175,396],[396,199],[199,175],[312,311],[311,268],[268,312],[276,283],[283,445],[445,276],[390,373],[373,339],[339,390],[295,282],[282,296],[296,295],[448,449],[449,346],[346,448],[356,264],[264,454],[454,356],[337,336],[336,299],[299,337],[337,338],[338,151],[151,337],[294,278],[278,455],[455,294],[308,292],[292,415],[415,308],[429,358],[358,355],[355,429],[265,340],[340,372],[372,265],[352,346],[346,280],[280,352],[295,442],[442,282],[282,295],[354,19],[19,370],[370,354],[285,441],[441,295],[295,285],[195,248],[248,197],[197,195],[457,440],[440,274],[274,457],[301,300],[300,368],[368,301],[417,351],[351,465],[465,417],[251,301],[301,389],[389,251],[394,395],[395,379],[379,394],[399,412],[412,419],[419,399],[410,436],[436,322],[322,410],[326,2],[2,393],[393,326],[354,370],[370,461],[461,354],[393,164],[164,267],[267,393],[268,302],[302,12],[12,268],[312,268],[268,13],[13,312],[298,293],[293,301],[301,298],[265,446],[446,340],[340,265],[280,330],[330,425],[425,280],[322,426],[426,391],[391,322],[420,429],[429,437],[437,420],[393,391],[391,326],[326,393],[344,440],[440,438],[438,344],[458,459],[459,461],[461,458],[364,434],[434,394],[394,364],[428,396],[396,262],[262,428],[274,354],[354,457],[457,274],[317,316],[316,402],[402,317],[316,315],[315,403],[403,316],[315,314],[314,404],[404,315],[314,313],[313,405],[405,314],[313,421],[421,406],[406,313],[323,366],[366,361],[361,323],[292,306],[306,407],[407,292],[306,291],[291,408],[408,306],[291,287],[287,409],[409,291],[287,432],[432,410],[410,287],[427,434],[434,411],[411,427],[372,264],[264,383],[383,372],[459,309],[309,457],[457,459],[366,352],[352,401],[401,366],[1,274],[274,4],[4,1],[418,421],[421,262],[262,418],[331,294],[294,358],[358,331],[435,433],[433,367],[367,435],[392,289],[289,439],[439,392],[328,462],[462,326],[326,328],[94,2],[2,370],[370,94],[289,305],[305,455],[455,289],[339,254],[254,448],[448,339],[359,255],[255,446],[446,359],[254,253],[253,449],[449,254],[253,252],[252,450],[450,253],[252,256],[256,451],[451,252],[256,341],[341,452],[452,256],[414,413],[413,463],[463,414],[286,441],[441,414],[414,286],[286,258],[258,441],[441,286],[258,257],[257,442],[442,258],[257,259],[259,443],[443,257],[259,260],[260,444],[444,259],[260,467],[467,445],[445,260],[309,459],[459,250],[250,309],[305,289],[289,290],[290,305],[305,290],[290,460],[460,305],[401,376],[376,435],[435,401],[309,250],[250,392],[392,309],[376,411],[411,433],[433,376],[453,341],[341,464],[464,453],[357,453],[453,465],[465,357],[343,357],[357,412],[412,343],[437,343],[343,399],[399,437],[344,360],[360,440],[440,344],[420,437],[437,456],[456,420],[360,420],[420,363],[363,360],[361,401],[401,288],[288,361],[265,372],[372,353],[353,265],[390,339],[339,249],[249,390],[339,448],[448,255],[255,339]);function LW(t){t.j={faceLandmarks:[],faceBlendshapes:[],facialTransformationMatrixes:[]}}var Rr=class extends wo{constructor(t,e){super(new rc(t,e),"image_in","norm_rect",!1),this.j={faceLandmarks:[],faceBlendshapes:[],facialTransformationMatrixes:[]},this.outputFacialTransformationMatrixes=this.outputFaceBlendshapes=!1,it(t=this.h=new Kde,0,1,e=new dr),this.v=new Vde,it(this.h,0,3,this.v),this.s=new c4,it(this.h,0,2,this.s),Ml(this.s,4,1),Xe(this.s,2,.5),Xe(this.v,2,.5),Xe(this.h,4,.5)}get baseOptions(){return tn(this.h,dr,1)}set baseOptions(t){it(this.h,0,1,t)}o(t){return"numFaces"in t&&Ml(this.s,4,t.numFaces??1),"minFaceDetectionConfidence"in t&&Xe(this.s,2,t.minFaceDetectionConfidence??.5),"minTrackingConfidence"in t&&Xe(this.h,4,t.minTrackingConfidence??.5),"minFacePresenceConfidence"in t&&Xe(this.v,2,t.minFacePresenceConfidence??.5),"outputFaceBlendshapes"in t&&(this.outputFaceBlendshapes=!!t.outputFaceBlendshapes),"outputFacialTransformationMatrixes"in t&&(this.outputFacialTransformationMatrixes=!!t.outputFacialTransformationMatrixes),this.l(t)}D(t,e){return LW(this),ic(this,t,e),this.j}F(t,e,n){return LW(this),Hl(this,t,n,e),this.j}m(){var t=new Co;tr(t,"image_in"),tr(t,"norm_rect"),on(t,"face_landmarks");const e=new sa;Vc(e,TWe,this.h);const n=new Us;ca(n,"mediapipe.tasks.vision.face_landmarker.FaceLandmarkerGraph"),Vn(n,"IMAGE:image_in"),Vn(n,"NORM_RECT:norm_rect"),Yt(n,"NORM_LANDMARKS:face_landmarks"),n.o(e),la(t,n),this.g.attachProtoVectorListener("face_landmarks",((r,i)=>{for(const s of r)r=_S(s),this.j.faceLandmarks.push(l4(r));He(this,i)})),this.g.attachEmptyPacketListener("face_landmarks",(r=>{He(this,r)})),this.outputFaceBlendshapes&&(on(t,"blendshapes"),Yt(n,"BLENDSHAPES:blendshapes"),this.g.attachProtoVectorListener("blendshapes",((r,i)=>{if(this.outputFaceBlendshapes)for(const s of r)r=a4(s),this.j.faceBlendshapes.push(yD(r.g()??[]));He(this,i)})),this.g.attachEmptyPacketListener("blendshapes",(r=>{He(this,r)}))),this.outputFacialTransformationMatrixes&&(on(t,"face_geometry"),Yt(n,"FACE_GEOMETRY:face_geometry"),this.g.attachProtoVectorListener("face_geometry",((r,i)=>{if(this.outputFacialTransformationMatrixes)for(const s of r)(r=tn(CWe(s),mWe,2))&&this.j.facialTransformationMatrixes.push({rows:$a(r,1)??0??0,columns:$a(r,2)??0??0,data:mp(r,3,yh,pp()).slice()??[]});He(this,i)})),this.g.attachEmptyPacketListener("face_geometry",(r=>{He(this,r)}))),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};Rr.prototype.detectForVideo=Rr.prototype.F,Rr.prototype.detect=Rr.prototype.D,Rr.prototype.setOptions=Rr.prototype.o,Rr.createFromModelPath=function(t,e){return Gt(Rr,t,{baseOptions:{modelAssetPath:e}})},Rr.createFromModelBuffer=function(t,e){return Gt(Rr,t,{baseOptions:{modelAssetBuffer:e}})},Rr.createFromOptions=function(t,e){return Gt(Rr,t,e)},Rr.FACE_LANDMARKS_LIPS=CD,Rr.FACE_LANDMARKS_LEFT_EYE=TD,Rr.FACE_LANDMARKS_LEFT_EYEBROW=RD,Rr.FACE_LANDMARKS_LEFT_IRIS=yfe,Rr.FACE_LANDMARKS_RIGHT_EYE=kD,Rr.FACE_LANDMARKS_RIGHT_EYEBROW=ID,Rr.FACE_LANDMARKS_RIGHT_IRIS=bfe,Rr.FACE_LANDMARKS_FACE_OVAL=xD,Rr.FACE_LANDMARKS_CONTOURS=_fe,Rr.FACE_LANDMARKS_TESSELATION=Sfe;var il=class extends wo{constructor(t,e){super(new rc(t,e),"image_in","norm_rect",!0),it(t=this.j=new zde,0,1,e=new dr)}get baseOptions(){return tn(this.j,dr,1)}set baseOptions(t){it(this.j,0,1,t)}o(t){return super.l(t)}Oa(t,e,n){const r=typeof e!="function"?e:{};if(this.h=typeof e=="function"?e:n,ic(this,t,r??{}),!this.h)return this.s}m(){var t=new Co;tr(t,"image_in"),tr(t,"norm_rect"),on(t,"stylized_image");const e=new sa;Vc(e,RWe,this.j);const n=new Us;ca(n,"mediapipe.tasks.vision.face_stylizer.FaceStylizerGraph"),Vn(n,"IMAGE:image_in"),Vn(n,"NORM_RECT:norm_rect"),Yt(n,"STYLIZED_IMAGE:stylized_image"),n.o(e),la(t,n),this.g.U("stylized_image",((r,i)=>{var s=!this.h,o=r.data,a=r.width;const c=a*(r=r.height);if(o instanceof Uint8Array)if(o.length===3*c){const l=new Uint8ClampedArray(4*c);for(let d=0;d<c;++d)l[4*d]=o[3*d],l[4*d+1]=o[3*d+1],l[4*d+2]=o[3*d+2],l[4*d+3]=255;o=new ImageData(l,a,r)}else{if(o.length!==4*c)throw Error("Unsupported channel count: "+o.length/c);o=new ImageData(new Uint8ClampedArray(o.buffer,o.byteOffset,o.length),a,r)}else if(!(o instanceof WebGLTexture))throw Error(`Unsupported format: ${o.constructor.name}`);a=new xi([o],!1,!1,this.g.i.canvas,this.O,a,r),this.s=s=s?a.clone():a,this.h&&this.h(s),He(this,i)})),this.g.attachEmptyPacketListener("stylized_image",(r=>{this.s=null,this.h&&this.h(null),He(this,r)})),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};il.prototype.stylize=il.prototype.Oa,il.prototype.setOptions=il.prototype.o,il.createFromModelPath=function(t,e){return Gt(il,t,{baseOptions:{modelAssetPath:e}})},il.createFromModelBuffer=function(t,e){return Gt(il,t,{baseOptions:{modelAssetBuffer:e}})},il.createFromOptions=function(t,e){return Gt(il,t,e)};var AD=zc([0,1],[1,2],[2,3],[3,4],[0,5],[5,6],[6,7],[7,8],[5,9],[9,10],[10,11],[11,12],[9,13],[13,14],[14,15],[15,16],[13,17],[0,17],[17,18],[18,19],[19,20]);function MW(t){t.gestures=[],t.landmarks=[],t.worldLandmarks=[],t.handedness=[]}function OW(t){return t.gestures.length===0?{gestures:[],landmarks:[],worldLandmarks:[],handedness:[],handednesses:[]}:{gestures:t.gestures,landmarks:t.landmarks,worldLandmarks:t.worldLandmarks,handedness:t.handedness,handednesses:t.handedness}}function PW(t,e=!0){const n=[];for(const i of t){var r=a4(i);t=[];for(const s of r.g())r=e&&$a(s,1)!=null?$a(s,1)??0:-1,t.push({score:Fr(s,2)??0,index:r,categoryName:Qa(s,3)??""??"",displayName:Qa(s,4)??""??""});n.push(t)}return n}var Fo=class extends wo{constructor(t,e){super(new rc(t,e),"image_in","norm_rect",!1),this.gestures=[],this.landmarks=[],this.worldLandmarks=[],this.handedness=[],it(t=this.j=new Xde,0,1,e=new dr),this.s=new pD,it(this.j,0,2,this.s),this.C=new hD,it(this.s,0,3,this.C),this.v=new Yde,it(this.s,0,2,this.v),this.h=new kWe,it(this.j,0,3,this.h),Xe(this.v,2,.5),Xe(this.s,4,.5),Xe(this.C,2,.5)}get baseOptions(){return tn(this.j,dr,1)}set baseOptions(t){it(this.j,0,1,t)}o(t){if(Ml(this.v,3,t.numHands??1),"minHandDetectionConfidence"in t&&Xe(this.v,2,t.minHandDetectionConfidence??.5),"minTrackingConfidence"in t&&Xe(this.s,4,t.minTrackingConfidence??.5),"minHandPresenceConfidence"in t&&Xe(this.C,2,t.minHandPresenceConfidence??.5),t.cannedGesturesClassifierOptions){var e=new Sg,n=e,r=vO(t.cannedGesturesClassifierOptions,tn(this.h,Sg,3)?.h());it(n,0,2,r),it(this.h,0,3,e)}else t.cannedGesturesClassifierOptions===void 0&&tn(this.h,Sg,3)?.g();return t.customGesturesClassifierOptions?(it(n=e=new Sg,0,2,r=vO(t.customGesturesClassifierOptions,tn(this.h,Sg,4)?.h())),it(this.h,0,4,e)):t.customGesturesClassifierOptions===void 0&&tn(this.h,Sg,4)?.g(),this.l(t)}Ja(t,e){return MW(this),ic(this,t,e),OW(this)}Ka(t,e,n){return MW(this),Hl(this,t,n,e),OW(this)}m(){var t=new Co;tr(t,"image_in"),tr(t,"norm_rect"),on(t,"hand_gestures"),on(t,"hand_landmarks"),on(t,"world_hand_landmarks"),on(t,"handedness");const e=new sa;Vc(e,IWe,this.j);const n=new Us;ca(n,"mediapipe.tasks.vision.gesture_recognizer.GestureRecognizerGraph"),Vn(n,"IMAGE:image_in"),Vn(n,"NORM_RECT:norm_rect"),Yt(n,"HAND_GESTURES:hand_gestures"),Yt(n,"LANDMARKS:hand_landmarks"),Yt(n,"WORLD_LANDMARKS:world_hand_landmarks"),Yt(n,"HANDEDNESS:handedness"),n.o(e),la(t,n),this.g.attachProtoVectorListener("hand_landmarks",((r,i)=>{for(const s of r){r=_S(s);const o=[];for(const a of fd(r,Fde,1))o.push({x:Fr(a,1)??0,y:Fr(a,2)??0,z:Fr(a,3)??0,visibility:Fr(a,4)??0});this.landmarks.push(o)}He(this,i)})),this.g.attachEmptyPacketListener("hand_landmarks",(r=>{He(this,r)})),this.g.attachProtoVectorListener("world_hand_landmarks",((r,i)=>{for(const s of r){r=_v(s);const o=[];for(const a of fd(r,jde,1))o.push({x:Fr(a,1)??0,y:Fr(a,2)??0,z:Fr(a,3)??0,visibility:Fr(a,4)??0});this.worldLandmarks.push(o)}He(this,i)})),this.g.attachEmptyPacketListener("world_hand_landmarks",(r=>{He(this,r)})),this.g.attachProtoVectorListener("hand_gestures",((r,i)=>{this.gestures.push(...PW(r,!1)),He(this,i)})),this.g.attachEmptyPacketListener("hand_gestures",(r=>{He(this,r)})),this.g.attachProtoVectorListener("handedness",((r,i)=>{this.handedness.push(...PW(r)),He(this,i)})),this.g.attachEmptyPacketListener("handedness",(r=>{He(this,r)})),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};function DW(t){return{landmarks:t.landmarks,worldLandmarks:t.worldLandmarks,handednesses:t.handedness,handedness:t.handedness}}Fo.prototype.recognizeForVideo=Fo.prototype.Ka,Fo.prototype.recognize=Fo.prototype.Ja,Fo.prototype.setOptions=Fo.prototype.o,Fo.createFromModelPath=function(t,e){return Gt(Fo,t,{baseOptions:{modelAssetPath:e}})},Fo.createFromModelBuffer=function(t,e){return Gt(Fo,t,{baseOptions:{modelAssetBuffer:e}})},Fo.createFromOptions=function(t,e){return Gt(Fo,t,e)},Fo.HAND_CONNECTIONS=AD;var $o=class extends wo{constructor(t,e){super(new rc(t,e),"image_in","norm_rect",!1),this.landmarks=[],this.worldLandmarks=[],this.handedness=[],it(t=this.h=new pD,0,1,e=new dr),this.s=new hD,it(this.h,0,3,this.s),this.j=new Yde,it(this.h,0,2,this.j),Ml(this.j,3,1),Xe(this.j,2,.5),Xe(this.s,2,.5),Xe(this.h,4,.5)}get baseOptions(){return tn(this.h,dr,1)}set baseOptions(t){it(this.h,0,1,t)}o(t){return"numHands"in t&&Ml(this.j,3,t.numHands??1),"minHandDetectionConfidence"in t&&Xe(this.j,2,t.minHandDetectionConfidence??.5),"minTrackingConfidence"in t&&Xe(this.h,4,t.minTrackingConfidence??.5),"minHandPresenceConfidence"in t&&Xe(this.s,2,t.minHandPresenceConfidence??.5),this.l(t)}D(t,e){return this.landmarks=[],this.worldLandmarks=[],this.handedness=[],ic(this,t,e),DW(this)}F(t,e,n){return this.landmarks=[],this.worldLandmarks=[],this.handedness=[],Hl(this,t,n,e),DW(this)}m(){var t=new Co;tr(t,"image_in"),tr(t,"norm_rect"),on(t,"hand_landmarks"),on(t,"world_hand_landmarks"),on(t,"handedness");const e=new sa;Vc(e,xWe,this.h);const n=new Us;ca(n,"mediapipe.tasks.vision.hand_landmarker.HandLandmarkerGraph"),Vn(n,"IMAGE:image_in"),Vn(n,"NORM_RECT:norm_rect"),Yt(n,"LANDMARKS:hand_landmarks"),Yt(n,"WORLD_LANDMARKS:world_hand_landmarks"),Yt(n,"HANDEDNESS:handedness"),n.o(e),la(t,n),this.g.attachProtoVectorListener("hand_landmarks",((r,i)=>{for(const s of r)r=_S(s),this.landmarks.push(l4(r));He(this,i)})),this.g.attachEmptyPacketListener("hand_landmarks",(r=>{He(this,r)})),this.g.attachProtoVectorListener("world_hand_landmarks",((r,i)=>{for(const s of r)r=_v(s),this.worldLandmarks.push(gb(r));He(this,i)})),this.g.attachEmptyPacketListener("world_hand_landmarks",(r=>{He(this,r)})),this.g.attachProtoVectorListener("handedness",((r,i)=>{var s=this.handedness,o=s.push;const a=[];for(const c of r){r=a4(c);const l=[];for(const d of r.g())l.push({score:Fr(d,2)??0,index:$a(d,1)??0??-1,categoryName:Qa(d,3)??""??"",displayName:Qa(d,4)??""??""});a.push(l)}o.call(s,...a),He(this,i)})),this.g.attachEmptyPacketListener("handedness",(r=>{He(this,r)})),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};$o.prototype.detectForVideo=$o.prototype.F,$o.prototype.detect=$o.prototype.D,$o.prototype.setOptions=$o.prototype.o,$o.createFromModelPath=function(t,e){return Gt($o,t,{baseOptions:{modelAssetPath:e}})},$o.createFromModelBuffer=function(t,e){return Gt($o,t,{baseOptions:{modelAssetBuffer:e}})},$o.createFromOptions=function(t,e){return Gt($o,t,e)},$o.HAND_CONNECTIONS=AD;var wfe=zc([0,1],[1,2],[2,3],[3,7],[0,4],[4,5],[5,6],[6,8],[9,10],[11,12],[11,13],[13,15],[15,17],[15,19],[15,21],[17,19],[12,14],[14,16],[16,18],[16,20],[16,22],[18,20],[11,23],[12,24],[23,24],[23,25],[24,26],[25,27],[26,28],[27,29],[28,30],[29,31],[30,32],[27,31],[28,32]);function NW(t){t.h={faceLandmarks:[],faceBlendshapes:[],poseLandmarks:[],poseWorldLandmarks:[],poseSegmentationMasks:[],leftHandLandmarks:[],leftHandWorldLandmarks:[],rightHandLandmarks:[],rightHandWorldLandmarks:[]}}function UW(t){try{if(!t.C)return t.h;t.C(t.h)}finally{d4(t)}}function Yw(t,e){t=_S(t),e.push(l4(t))}var or=class extends wo{constructor(t,e){super(new rc(t,e),"input_frames_image",null,!1),this.h={faceLandmarks:[],faceBlendshapes:[],poseLandmarks:[],poseWorldLandmarks:[],poseSegmentationMasks:[],leftHandLandmarks:[],leftHandWorldLandmarks:[],rightHandLandmarks:[],rightHandWorldLandmarks:[]},this.outputPoseSegmentationMasks=this.outputFaceBlendshapes=!1,it(t=this.j=new tfe,0,1,e=new dr),this.J=new hD,it(this.j,0,2,this.J),this.Z=new AWe,it(this.j,0,3,this.Z),this.s=new c4,it(this.j,0,4,this.s),this.H=new Vde,it(this.j,0,5,this.H),this.v=new Zde,it(this.j,0,6,this.v),this.K=new efe,it(this.j,0,7,this.K),Xe(this.s,2,.5),Xe(this.s,3,.3),Xe(this.H,2,.5),Xe(this.v,2,.5),Xe(this.v,3,.3),Xe(this.K,2,.5),Xe(this.J,2,.5)}get baseOptions(){return tn(this.j,dr,1)}set baseOptions(t){it(this.j,0,1,t)}o(t){return"minFaceDetectionConfidence"in t&&Xe(this.s,2,t.minFaceDetectionConfidence??.5),"minFaceSuppressionThreshold"in t&&Xe(this.s,3,t.minFaceSuppressionThreshold??.3),"minFacePresenceConfidence"in t&&Xe(this.H,2,t.minFacePresenceConfidence??.5),"outputFaceBlendshapes"in t&&(this.outputFaceBlendshapes=!!t.outputFaceBlendshapes),"minPoseDetectionConfidence"in t&&Xe(this.v,2,t.minPoseDetectionConfidence??.5),"minPoseSuppressionThreshold"in t&&Xe(this.v,3,t.minPoseSuppressionThreshold??.3),"minPosePresenceConfidence"in t&&Xe(this.K,2,t.minPosePresenceConfidence??.5),"outputPoseSegmentationMasks"in t&&(this.outputPoseSegmentationMasks=!!t.outputPoseSegmentationMasks),"minHandLandmarksConfidence"in t&&Xe(this.J,2,t.minHandLandmarksConfidence??.5),this.l(t)}D(t,e,n){const r=typeof e!="function"?e:{};return this.C=typeof e=="function"?e:n,NW(this),ic(this,t,r),UW(this)}F(t,e,n,r){const i=typeof n!="function"?n:{};return this.C=typeof n=="function"?n:r,NW(this),Hl(this,t,i,e),UW(this)}m(){var t=new Co;tr(t,"input_frames_image"),on(t,"pose_landmarks"),on(t,"pose_world_landmarks"),on(t,"face_landmarks"),on(t,"left_hand_landmarks"),on(t,"left_hand_world_landmarks"),on(t,"right_hand_landmarks"),on(t,"right_hand_world_landmarks");const e=new sa,n=new oW;dO(n,1,Ny("type.googleapis.com/mediapipe.tasks.vision.holistic_landmarker.proto.HolisticLandmarkerGraphOptions"),""),(function(i,s){if(s!=null)if(Array.isArray(s))Hn(i,2,Yue(s));else{if(!(typeof s=="string"||s instanceof Ju||gS(s)))throw Error("invalid value in Any.value field: "+s+" expected a ByteString, a base64 encoded string, a Uint8Array or a jspb array");dO(i,2,L9(s,!1),Kp())}})(n,this.j.g());const r=new Us;ca(r,"mediapipe.tasks.vision.holistic_landmarker.HolisticLandmarkerGraph"),z3(r,8,oW,n),Vn(r,"IMAGE:input_frames_image"),Yt(r,"POSE_LANDMARKS:pose_landmarks"),Yt(r,"POSE_WORLD_LANDMARKS:pose_world_landmarks"),Yt(r,"FACE_LANDMARKS:face_landmarks"),Yt(r,"LEFT_HAND_LANDMARKS:left_hand_landmarks"),Yt(r,"LEFT_HAND_WORLD_LANDMARKS:left_hand_world_landmarks"),Yt(r,"RIGHT_HAND_LANDMARKS:right_hand_landmarks"),Yt(r,"RIGHT_HAND_WORLD_LANDMARKS:right_hand_world_landmarks"),r.o(e),la(t,r),u4(this,t),this.g.attachProtoListener("pose_landmarks",((i,s)=>{Yw(i,this.h.poseLandmarks),He(this,s)})),this.g.attachEmptyPacketListener("pose_landmarks",(i=>{He(this,i)})),this.g.attachProtoListener("pose_world_landmarks",((i,s)=>{var o=this.h.poseWorldLandmarks;i=_v(i),o.push(gb(i)),He(this,s)})),this.g.attachEmptyPacketListener("pose_world_landmarks",(i=>{He(this,i)})),this.outputPoseSegmentationMasks&&(Yt(r,"POSE_SEGMENTATION_MASK:pose_segmentation_mask"),ry(this,"pose_segmentation_mask"),this.g.U("pose_segmentation_mask",((i,s)=>{this.h.poseSegmentationMasks=[oy(this,i,!0,!this.C)],He(this,s)})),this.g.attachEmptyPacketListener("pose_segmentation_mask",(i=>{this.h.poseSegmentationMasks=[],He(this,i)}))),this.g.attachProtoListener("face_landmarks",((i,s)=>{Yw(i,this.h.faceLandmarks),He(this,s)})),this.g.attachEmptyPacketListener("face_landmarks",(i=>{He(this,i)})),this.outputFaceBlendshapes&&(on(t,"extra_blendshapes"),Yt(r,"FACE_BLENDSHAPES:extra_blendshapes"),this.g.attachProtoListener("extra_blendshapes",((i,s)=>{var o=this.h.faceBlendshapes;this.outputFaceBlendshapes&&(i=a4(i),o.push(yD(i.g()??[]))),He(this,s)})),this.g.attachEmptyPacketListener("extra_blendshapes",(i=>{He(this,i)}))),this.g.attachProtoListener("left_hand_landmarks",((i,s)=>{Yw(i,this.h.leftHandLandmarks),He(this,s)})),this.g.attachEmptyPacketListener("left_hand_landmarks",(i=>{He(this,i)})),this.g.attachProtoListener("left_hand_world_landmarks",((i,s)=>{var o=this.h.leftHandWorldLandmarks;i=_v(i),o.push(gb(i)),He(this,s)})),this.g.attachEmptyPacketListener("left_hand_world_landmarks",(i=>{He(this,i)})),this.g.attachProtoListener("right_hand_landmarks",((i,s)=>{Yw(i,this.h.rightHandLandmarks),He(this,s)})),this.g.attachEmptyPacketListener("right_hand_landmarks",(i=>{He(this,i)})),this.g.attachProtoListener("right_hand_world_landmarks",((i,s)=>{var o=this.h.rightHandWorldLandmarks;i=_v(i),o.push(gb(i)),He(this,s)})),this.g.attachEmptyPacketListener("right_hand_world_landmarks",(i=>{He(this,i)})),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};or.prototype.detectForVideo=or.prototype.F,or.prototype.detect=or.prototype.D,or.prototype.setOptions=or.prototype.o,or.createFromModelPath=function(t,e){return Gt(or,t,{baseOptions:{modelAssetPath:e}})},or.createFromModelBuffer=function(t,e){return Gt(or,t,{baseOptions:{modelAssetBuffer:e}})},or.createFromOptions=function(t,e){return Gt(or,t,e)},or.HAND_CONNECTIONS=AD,or.POSE_CONNECTIONS=wfe,or.FACE_LANDMARKS_LIPS=CD,or.FACE_LANDMARKS_LEFT_EYE=TD,or.FACE_LANDMARKS_LEFT_EYEBROW=RD,or.FACE_LANDMARKS_LEFT_IRIS=yfe,or.FACE_LANDMARKS_RIGHT_EYE=kD,or.FACE_LANDMARKS_RIGHT_EYEBROW=ID,or.FACE_LANDMARKS_RIGHT_IRIS=bfe,or.FACE_LANDMARKS_FACE_OVAL=xD,or.FACE_LANDMARKS_CONTOURS=_fe,or.FACE_LANDMARKS_TESSELATION=Sfe;var Ca=class extends wo{constructor(t,e){super(new rc(t,e),"input_image","norm_rect",!0),this.j={classifications:[]},it(t=this.h=new nfe,0,1,e=new dr)}get baseOptions(){return tn(this.h,dr,1)}set baseOptions(t){it(this.h,0,1,t)}o(t){return it(this.h,0,2,vO(t,tn(this.h,uD,2))),this.l(t)}sa(t,e){return this.j={classifications:[]},ic(this,t,e),this.j}ta(t,e,n){return this.j={classifications:[]},Hl(this,t,n,e),this.j}m(){var t=new Co;tr(t,"input_image"),tr(t,"norm_rect"),on(t,"classifications");const e=new sa;Vc(e,LWe,this.h);const n=new Us;ca(n,"mediapipe.tasks.vision.image_classifier.ImageClassifierGraph"),Vn(n,"IMAGE:input_image"),Vn(n,"NORM_RECT:norm_rect"),Yt(n,"CLASSIFICATIONS:classifications"),n.o(e),la(t,n),this.g.attachProtoListener("classifications",((r,i)=>{this.j=(function(s){const o={classifications:fd(s,vWe,1).map((a=>yD(tn(a,Dde,4)?.g()??[],$a(a,2)??0,Qa(a,3)??"")))};return G3(ty(s,2))!=null&&(o.timestampMs=G3(ty(s,2))??0),o})(yWe(r)),He(this,i)})),this.g.attachEmptyPacketListener("classifications",(r=>{He(this,r)})),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};Ca.prototype.classifyForVideo=Ca.prototype.ta,Ca.prototype.classify=Ca.prototype.sa,Ca.prototype.setOptions=Ca.prototype.o,Ca.createFromModelPath=function(t,e){return Gt(Ca,t,{baseOptions:{modelAssetPath:e}})},Ca.createFromModelBuffer=function(t,e){return Gt(Ca,t,{baseOptions:{modelAssetBuffer:e}})},Ca.createFromOptions=function(t,e){return Gt(Ca,t,e)};var Bo=class extends wo{constructor(t,e){super(new rc(t,e),"image_in","norm_rect",!0),this.h=new rfe,this.embeddings={embeddings:[]},it(t=this.h,0,1,e=new dr)}get baseOptions(){return tn(this.h,dr,1)}set baseOptions(t){it(this.h,0,1,t)}o(t){var e=this.h,n=tn(this.h,mW,2);return n=n?n.clone():new mW,t.l2Normalize!==void 0?S_(n,1,t.l2Normalize):"l2Normalize"in t&&Hn(n,1),t.quantize!==void 0?S_(n,2,t.quantize):"quantize"in t&&Hn(n,2),it(e,0,2,n),this.l(t)}za(t,e){return ic(this,t,e),this.embeddings}Aa(t,e,n){return Hl(this,t,n,e),this.embeddings}m(){var t=new Co;tr(t,"image_in"),tr(t,"norm_rect"),on(t,"embeddings_out");const e=new sa;Vc(e,MWe,this.h);const n=new Us;ca(n,"mediapipe.tasks.vision.image_embedder.ImageEmbedderGraph"),Vn(n,"IMAGE:image_in"),Vn(n,"NORM_RECT:norm_rect"),Yt(n,"EMBEDDINGS:embeddings_out"),n.o(e),la(t,n),this.g.attachProtoListener("embeddings_out",((r,i)=>{r=SWe(r),this.embeddings=(function(s){return{embeddings:fd(s,_We,1).map((o=>{const a={headIndex:$a(o,3)??0??-1,headName:Qa(o,4)??""??""};if(ede(o,pW,a5(o,1))!==void 0)o=mp(o=tn(o,pW,a5(o,1)),1,yh,pp()),a.floatEmbedding=o.slice();else{const c=new Uint8Array(0);a.quantizedEmbedding=tn(o,bWe,a5(o,2))?.oa()?.h()??c}return a})),timestampMs:G3(ty(s,2))??0}})(r),He(this,i)})),this.g.attachEmptyPacketListener("embeddings_out",(r=>{He(this,r)})),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};Bo.cosineSimilarity=function(t,e){if(t.floatEmbedding&&e.floatEmbedding)t=_W(t.floatEmbedding,e.floatEmbedding);else{if(!t.quantizedEmbedding||!e.quantizedEmbedding)throw Error("Cannot compute cosine similarity between quantized and float embeddings.");t=_W(bW(t.quantizedEmbedding),bW(e.quantizedEmbedding))}return t},Bo.prototype.embedForVideo=Bo.prototype.Aa,Bo.prototype.embed=Bo.prototype.za,Bo.prototype.setOptions=Bo.prototype.o,Bo.createFromModelPath=function(t,e){return Gt(Bo,t,{baseOptions:{modelAssetPath:e}})},Bo.createFromModelBuffer=function(t,e){return Gt(Bo,t,{baseOptions:{modelAssetBuffer:e}})},Bo.createFromOptions=function(t,e){return Gt(Bo,t,e)};var _O=class{constructor(t,e,n){this.confidenceMasks=t,this.categoryMask=e,this.qualityScores=n}close(){this.confidenceMasks?.forEach((t=>{t.close()})),this.categoryMask?.close()}};function jW(t){t.categoryMask=void 0,t.confidenceMasks=void 0,t.qualityScores=void 0}function FW(t){try{const e=new _O(t.confidenceMasks,t.categoryMask,t.qualityScores);if(!t.j)return e;t.j(e)}finally{d4(t)}}_O.prototype.close=_O.prototype.close;var cs=class extends wo{constructor(t,e){super(new rc(t,e),"image_in","norm_rect",!1),this.s=[],this.outputCategoryMask=!1,this.outputConfidenceMasks=!0,this.h=new vD,this.v=new ife,it(this.h,0,3,this.v),it(t=this.h,0,1,e=new dr)}get baseOptions(){return tn(this.h,dr,1)}set baseOptions(t){it(this.h,0,1,t)}o(t){return t.displayNamesLocale!==void 0?Hn(this.h,2,Ny(t.displayNamesLocale)):"displayNamesLocale"in t&&Hn(this.h,2),"outputCategoryMask"in t&&(this.outputCategoryMask=t.outputCategoryMask??!1),"outputConfidenceMasks"in t&&(this.outputConfidenceMasks=t.outputConfidenceMasks??!0),super.l(t)}I(){(function(t){const e=fd(t.da(),Us,1).filter((n=>(Qa(n,1)??"").includes("mediapipe.tasks.TensorsToSegmentationCalculator")));if(t.s=[],e.length>1)throw Error("The graph has more than one mediapipe.tasks.TensorsToSegmentationCalculator.");e.length===1&&(tn(e[0],sa,7)?.l()?.g()??new Map).forEach(((n,r)=>{t.s[Number(r)]=Qa(n,1)??""}))})(this)}segment(t,e,n){const r=typeof e!="function"?e:{};return this.j=typeof e=="function"?e:n,jW(this),ic(this,t,r),FW(this)}Ma(t,e,n,r){const i=typeof n!="function"?n:{};return this.j=typeof n=="function"?n:r,jW(this),Hl(this,t,i,e),FW(this)}Da(){return this.s}m(){var t=new Co;tr(t,"image_in"),tr(t,"norm_rect");const e=new sa;Vc(e,ofe,this.h);const n=new Us;ca(n,"mediapipe.tasks.vision.image_segmenter.ImageSegmenterGraph"),Vn(n,"IMAGE:image_in"),Vn(n,"NORM_RECT:norm_rect"),n.o(e),la(t,n),u4(this,t),this.outputConfidenceMasks&&(on(t,"confidence_masks"),Yt(n,"CONFIDENCE_MASKS:confidence_masks"),ry(this,"confidence_masks"),this.g.ca("confidence_masks",((r,i)=>{this.confidenceMasks=r.map((s=>oy(this,s,!0,!this.j))),He(this,i)})),this.g.attachEmptyPacketListener("confidence_masks",(r=>{this.confidenceMasks=[],He(this,r)}))),this.outputCategoryMask&&(on(t,"category_mask"),Yt(n,"CATEGORY_MASK:category_mask"),ry(this,"category_mask"),this.g.U("category_mask",((r,i)=>{this.categoryMask=oy(this,r,!1,!this.j),He(this,i)})),this.g.attachEmptyPacketListener("category_mask",(r=>{this.categoryMask=void 0,He(this,r)}))),on(t,"quality_scores"),Yt(n,"QUALITY_SCORES:quality_scores"),this.g.attachFloatVectorListener("quality_scores",((r,i)=>{this.qualityScores=r,He(this,i)})),this.g.attachEmptyPacketListener("quality_scores",(r=>{this.categoryMask=void 0,He(this,r)})),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};cs.prototype.getLabels=cs.prototype.Da,cs.prototype.segmentForVideo=cs.prototype.Ma,cs.prototype.segment=cs.prototype.segment,cs.prototype.setOptions=cs.prototype.o,cs.createFromModelPath=function(t,e){return Gt(cs,t,{baseOptions:{modelAssetPath:e}})},cs.createFromModelBuffer=function(t,e){return Gt(cs,t,{baseOptions:{modelAssetBuffer:e}})},cs.createFromOptions=function(t,e){return Gt(cs,t,e)};var SO=class{constructor(t,e,n){this.confidenceMasks=t,this.categoryMask=e,this.qualityScores=n}close(){this.confidenceMasks?.forEach((t=>{t.close()})),this.categoryMask?.close()}};SO.prototype.close=SO.prototype.close;var $We=class extends Ye{constructor(t){super(t)}},wg=[0,Pr,-2],J3=[0,ku,-3,cr,ku,-1],$W=[0,J3],BW=[0,J3,Pr,-1],h5=class extends Ye{constructor(t){super(t)}},HW=[0,ku,-1,cr],BWe=class extends Ye{constructor(t){super(t)}},qW=class extends Ye{constructor(t){super(t)}},wO=[1,2,3,4,5,6,7,8,9,10,14,15],Efe=class extends Ye{constructor(t){super(t)}};Efe.prototype.g=o4([0,mi,[0,wO,wn,J3,wn,[0,J3,wg],wn,$W,wn,[0,$W,wg],wn,HW,wn,[0,ku,-3,cr,Za],wn,[0,ku,-3,cr],wn,[0,bn,ku,-2,cr,Pr,cr,-1,2,ku,wg],wn,BW,wn,[0,BW,wg],ku,wg,bn,wn,[0,ku,-3,cr,wg,-1],wn,[0,mi,HW]],bn,[0,bn,Pr,-1,cr]]);var sl=class extends wo{constructor(t,e){super(new rc(t,e),"image_in","norm_rect_in",!1),this.outputCategoryMask=!1,this.outputConfidenceMasks=!0,this.h=new vD,this.s=new ife,it(this.h,0,3,this.s),it(t=this.h,0,1,e=new dr)}get baseOptions(){return tn(this.h,dr,1)}set baseOptions(t){it(this.h,0,1,t)}o(t){return"outputCategoryMask"in t&&(this.outputCategoryMask=t.outputCategoryMask??!1),"outputConfidenceMasks"in t&&(this.outputConfidenceMasks=t.outputConfidenceMasks??!0),super.l(t)}segment(t,e,n,r){const i=typeof n!="function"?n:{};this.j=typeof n=="function"?n:r,this.qualityScores=this.categoryMask=this.confidenceMasks=void 0,n=this.B+1,r=new Efe;const s=new qW;var o=new $We;if(Ml(o,1,255),it(s,0,12,o),e.keypoint&&e.scribble)throw Error("Cannot provide both keypoint and scribble.");if(e.keypoint){var a=new h5;S_(a,3,!0),Xe(a,1,e.keypoint.x),Xe(a,2,e.keypoint.y),pb(s,5,wO,a)}else{if(!e.scribble)throw Error("Must provide either a keypoint or a scribble.");for(a of(o=new BWe,e.scribble))S_(e=new h5,3,!0),Xe(e,1,a.x),Xe(e,2,a.y),z3(o,1,h5,e);pb(s,15,wO,o)}z3(r,1,qW,s),this.g.addProtoToStream(r.g(),"drishti.RenderData","roi_in",n),ic(this,t,i);e:{try{const l=new SO(this.confidenceMasks,this.categoryMask,this.qualityScores);if(!this.j){var c=l;break e}this.j(l)}finally{d4(this)}c=void 0}return c}m(){var t=new Co;tr(t,"image_in"),tr(t,"roi_in"),tr(t,"norm_rect_in");const e=new sa;Vc(e,ofe,this.h);const n=new Us;ca(n,"mediapipe.tasks.vision.interactive_segmenter.InteractiveSegmenterGraph"),Vn(n,"IMAGE:image_in"),Vn(n,"ROI:roi_in"),Vn(n,"NORM_RECT:norm_rect_in"),n.o(e),la(t,n),u4(this,t),this.outputConfidenceMasks&&(on(t,"confidence_masks"),Yt(n,"CONFIDENCE_MASKS:confidence_masks"),ry(this,"confidence_masks"),this.g.ca("confidence_masks",((r,i)=>{this.confidenceMasks=r.map((s=>oy(this,s,!0,!this.j))),He(this,i)})),this.g.attachEmptyPacketListener("confidence_masks",(r=>{this.confidenceMasks=[],He(this,r)}))),this.outputCategoryMask&&(on(t,"category_mask"),Yt(n,"CATEGORY_MASK:category_mask"),ry(this,"category_mask"),this.g.U("category_mask",((r,i)=>{this.categoryMask=oy(this,r,!1,!this.j),He(this,i)})),this.g.attachEmptyPacketListener("category_mask",(r=>{this.categoryMask=void 0,He(this,r)}))),on(t,"quality_scores"),Yt(n,"QUALITY_SCORES:quality_scores"),this.g.attachFloatVectorListener("quality_scores",((r,i)=>{this.qualityScores=r,He(this,i)})),this.g.attachEmptyPacketListener("quality_scores",(r=>{this.categoryMask=void 0,He(this,r)})),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};sl.prototype.segment=sl.prototype.segment,sl.prototype.setOptions=sl.prototype.o,sl.createFromModelPath=function(t,e){return Gt(sl,t,{baseOptions:{modelAssetPath:e}})},sl.createFromModelBuffer=function(t,e){return Gt(sl,t,{baseOptions:{modelAssetBuffer:e}})},sl.createFromOptions=function(t,e){return Gt(sl,t,e)};var Ta=class extends wo{constructor(t,e){super(new rc(t,e),"input_frame_gpu","norm_rect",!1),this.j={detections:[]},it(t=this.h=new afe,0,1,e=new dr)}get baseOptions(){return tn(this.h,dr,1)}set baseOptions(t){it(this.h,0,1,t)}o(t){return t.displayNamesLocale!==void 0?Hn(this.h,2,Ny(t.displayNamesLocale)):"displayNamesLocale"in t&&Hn(this.h,2),t.maxResults!==void 0?Ml(this.h,3,t.maxResults):"maxResults"in t&&Hn(this.h,3),t.scoreThreshold!==void 0?Xe(this.h,4,t.scoreThreshold):"scoreThreshold"in t&&Hn(this.h,4),t.categoryAllowlist!==void 0?W3(this.h,5,t.categoryAllowlist):"categoryAllowlist"in t&&Hn(this.h,5),t.categoryDenylist!==void 0?W3(this.h,6,t.categoryDenylist):"categoryDenylist"in t&&Hn(this.h,6),this.l(t)}D(t,e){return this.j={detections:[]},ic(this,t,e),this.j}F(t,e,n){return this.j={detections:[]},Hl(this,t,n,e),this.j}m(){var t=new Co;tr(t,"input_frame_gpu"),tr(t,"norm_rect"),on(t,"detections");const e=new sa;Vc(e,PWe,this.h);const n=new Us;ca(n,"mediapipe.tasks.vision.ObjectDetectorGraph"),Vn(n,"IMAGE:input_frame_gpu"),Vn(n,"NORM_RECT:norm_rect"),Yt(n,"DETECTIONS:detections"),n.o(e),la(t,n),this.g.attachProtoVectorListener("detections",((r,i)=>{for(const s of r)r=Ude(s),this.j.detections.push(lfe(r));He(this,i)})),this.g.attachEmptyPacketListener("detections",(r=>{He(this,r)})),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};Ta.prototype.detectForVideo=Ta.prototype.F,Ta.prototype.detect=Ta.prototype.D,Ta.prototype.setOptions=Ta.prototype.o,Ta.createFromModelPath=async function(t,e){return Gt(Ta,t,{baseOptions:{modelAssetPath:e}})},Ta.createFromModelBuffer=function(t,e){return Gt(Ta,t,{baseOptions:{modelAssetBuffer:e}})},Ta.createFromOptions=function(t,e){return Gt(Ta,t,e)};var EO=class{constructor(t,e,n){this.landmarks=t,this.worldLandmarks=e,this.segmentationMasks=n}close(){this.segmentationMasks?.forEach((t=>{t.close()}))}};function VW(t){t.landmarks=[],t.worldLandmarks=[],t.segmentationMasks=void 0}function KW(t){try{const e=new EO(t.landmarks,t.worldLandmarks,t.segmentationMasks);if(!t.s)return e;t.s(e)}finally{d4(t)}}EO.prototype.close=EO.prototype.close;var Ho=class extends wo{constructor(t,e){super(new rc(t,e),"image_in","norm_rect",!1),this.landmarks=[],this.worldLandmarks=[],this.outputSegmentationMasks=!1,it(t=this.h=new cfe,0,1,e=new dr),this.v=new efe,it(this.h,0,3,this.v),this.j=new Zde,it(this.h,0,2,this.j),Ml(this.j,4,1),Xe(this.j,2,.5),Xe(this.v,2,.5),Xe(this.h,4,.5)}get baseOptions(){return tn(this.h,dr,1)}set baseOptions(t){it(this.h,0,1,t)}o(t){return"numPoses"in t&&Ml(this.j,4,t.numPoses??1),"minPoseDetectionConfidence"in t&&Xe(this.j,2,t.minPoseDetectionConfidence??.5),"minTrackingConfidence"in t&&Xe(this.h,4,t.minTrackingConfidence??.5),"minPosePresenceConfidence"in t&&Xe(this.v,2,t.minPosePresenceConfidence??.5),"outputSegmentationMasks"in t&&(this.outputSegmentationMasks=t.outputSegmentationMasks??!1),this.l(t)}D(t,e,n){const r=typeof e!="function"?e:{};return this.s=typeof e=="function"?e:n,VW(this),ic(this,t,r),KW(this)}F(t,e,n,r){const i=typeof n!="function"?n:{};return this.s=typeof n=="function"?n:r,VW(this),Hl(this,t,i,e),KW(this)}m(){var t=new Co;tr(t,"image_in"),tr(t,"norm_rect"),on(t,"normalized_landmarks"),on(t,"world_landmarks"),on(t,"segmentation_masks");const e=new sa;Vc(e,DWe,this.h);const n=new Us;ca(n,"mediapipe.tasks.vision.pose_landmarker.PoseLandmarkerGraph"),Vn(n,"IMAGE:image_in"),Vn(n,"NORM_RECT:norm_rect"),Yt(n,"NORM_LANDMARKS:normalized_landmarks"),Yt(n,"WORLD_LANDMARKS:world_landmarks"),n.o(e),la(t,n),u4(this,t),this.g.attachProtoVectorListener("normalized_landmarks",((r,i)=>{this.landmarks=[];for(const s of r)r=_S(s),this.landmarks.push(l4(r));He(this,i)})),this.g.attachEmptyPacketListener("normalized_landmarks",(r=>{this.landmarks=[],He(this,r)})),this.g.attachProtoVectorListener("world_landmarks",((r,i)=>{this.worldLandmarks=[];for(const s of r)r=_v(s),this.worldLandmarks.push(gb(r));He(this,i)})),this.g.attachEmptyPacketListener("world_landmarks",(r=>{this.worldLandmarks=[],He(this,r)})),this.outputSegmentationMasks&&(Yt(n,"SEGMENTATION_MASK:segmentation_masks"),ry(this,"segmentation_masks"),this.g.ca("segmentation_masks",((r,i)=>{this.segmentationMasks=r.map((s=>oy(this,s,!0,!this.s))),He(this,i)})),this.g.attachEmptyPacketListener("segmentation_masks",(r=>{this.segmentationMasks=[],He(this,r)}))),t=t.g(),this.setGraph(new Uint8Array(t),!0)}};Ho.prototype.detectForVideo=Ho.prototype.F,Ho.prototype.detect=Ho.prototype.D,Ho.prototype.setOptions=Ho.prototype.o,Ho.createFromModelPath=function(t,e){return Gt(Ho,t,{baseOptions:{modelAssetPath:e}})},Ho.createFromModelBuffer=function(t,e){return Gt(Ho,t,{baseOptions:{modelAssetBuffer:e}})},Ho.createFromOptions=function(t,e){return Gt(Ho,t,e)},Ho.POSE_CONNECTIONS=wfe;var HWe=()=>typeof OffscreenCanvas<"u";async function GW(t){return new Promise(e=>setTimeout(e,t))}async function qWe(t){await GW(10);const n=Date.now();for(;Date.now()-n<500;){const{width:r,height:i}=t.getSettings();if(r&&i)return{width:r,height:i};await GW(50)}return{width:void 0,height:void 0}}function Q3(t,e){if(HWe())return new OffscreenCanvas(t,e);const n=document.createElement("canvas");return n.width=t,n.height=e,n}var Cfe=class Tfe{constructor(e,n,r={}){this.useStreamFallback=!1,this.processingEnabled=!1;var i;this.name=n,this.transformer=e,this.maxFps=(i=r.maxFps)!=null?i:30}static get isSupported(){const e=typeof MediaStreamTrackGenerator<"u"&&typeof MediaStreamTrackProcessor<"u",n=typeof HTMLCanvasElement<"u"&&typeof VideoFrame<"u"&&"captureStream"in HTMLCanvasElement.prototype;return e||n}static get hasModernApiSupport(){return typeof MediaStreamTrackGenerator<"u"&&typeof MediaStreamTrackProcessor<"u"}async setup(e){this.source=e.track;const{width:n,height:r}=await qWe(this.source);if(this.sourceDummy=e.element,!(this.sourceDummy instanceof HTMLVideoElement))throw TypeError("Currently only video transformers are supported");if(this.sourceDummy instanceof HTMLVideoElement&&(this.sourceDummy.height=r??300,this.sourceDummy.width=n??300),this.useStreamFallback=!Tfe.hasModernApiSupport,this.useStreamFallback){const i=document.querySelector('canvas[data-livekit-processor="'+this.name+'"]');i?(this.displayCanvas=i,this.displayCanvas.width=n??300,this.displayCanvas.height=r??300):(this.displayCanvas=document.createElement("canvas"),this.displayCanvas.width=n??300,this.displayCanvas.height=r??300,this.displayCanvas.style.display="none",this.displayCanvas.dataset.livekitProcessor=this.name,document.body.appendChild(this.displayCanvas)),this.renderContext=this.displayCanvas.getContext("2d"),this.capturedStream=this.displayCanvas.captureStream(),this.canvas=Q3(n??300,r??300)}else this.processor=new MediaStreamTrackProcessor({track:this.source}),this.trackGenerator=new MediaStreamTrackGenerator({kind:"video",signalTarget:this.source}),this.canvas=Q3(n??300,r??300)}async init(e){if(await this.setup(e),!this.canvas)throw new TypeError("Expected canvas to be defined after setup");await this.transformer.init({outputCanvas:this.canvas,inputElement:this.sourceDummy}),this.useStreamFallback?this.initFallbackPath():this.initStreamProcessorPath()}initStreamProcessorPath(){if(!this.processor||!this.trackGenerator)throw new TypeError("Expected processor and trackGenerator to be defined for stream processor path");const n=this.processor.readable.pipeThrough(this.transformer.transformer),r=Symbol("stream");this.symbol=r,n.pipeTo(this.trackGenerator.writable).then(()=>this.destroy(r)).catch(i=>{i instanceof DOMException&&i.name==="AbortError"?console.log("stream processor path aborted"):(console.error("error when trying to pipe",i),this.destroy(r))}),this.processedTrack=this.trackGenerator}initFallbackPath(){if(!this.capturedStream||!this.source||!this.canvas||!this.renderContext)throw new TypeError("Missing required components for fallback implementation");this.processedTrack=this.capturedStream.getVideoTracks()[0],this.processingEnabled=!0,this.frameCallback=e=>{if(!this.processingEnabled||!e){e.close();return}const n={enqueue:r=>{this.renderContext&&this.displayCanvas&&(this.renderContext.drawImage(r,0,0,this.displayCanvas.width,this.displayCanvas.height),r.close())}};try{this.transformer.transform(e,n)}catch(r){console.error("Error in transform:",r),e.close()}},this.startRenderLoop()}startRenderLoop(){if(!this.sourceDummy||!(this.sourceDummy instanceof HTMLVideoElement))return;let e=-1,n=0;const r=this.sourceDummy,i=1e3/this.maxFps;let s=this.maxFps,o=[],a=0,c=0,l=0;const d=()=>{if(!this.processingEnabled||!this.sourceDummy||!(this.sourceDummy instanceof HTMLVideoElement))return;if(this.sourceDummy.paused){console.warn("Video is paused, trying to play"),this.sourceDummy.play();return}const h=r.currentTime,m=performance.now(),g=m-n,y=h!==e;if(y){if(a>0){const E=m-a;o.push(E),o.length>10&&o.shift(),o.length>2&&(s=1e3/(o.reduce((x,C)=>x+C,0)/o.length),(typeof window<"u"&&window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")&&m-l>5e3&&(console.debug(`[${this.name}] Estimated video FPS: ${s.toFixed(1)}, Processing at: ${(c/5).toFixed(1)} FPS`),c=0,l=m))}a=m}const v=g>=i;if(y&&v){e=h,n=m,c++;try{if(r.readyState>=HTMLMediaElement.HAVE_CURRENT_DATA){const E=new VideoFrame(r);this.frameCallback?this.frameCallback(E):E.close()}}catch(E){console.error("Error in render loop:",E)}}this.animationFrameId=requestAnimationFrame(d)};this.animationFrameId=requestAnimationFrame(d)}async restart(e){await this.destroy(),await this.init(e)}async restartTransformer(...e){await this.transformer.restart(e[0])}async updateTransformerOptions(...e){await this.transformer.update(e[0])}async destroy(e){var n,r,i,s;e&&this.symbol!==e||(this.useStreamFallback?(this.processingEnabled=!1,this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=void 0),this.displayCanvas&&this.displayCanvas.parentNode&&this.displayCanvas.parentNode.removeChild(this.displayCanvas),(n=this.capturedStream)==null||n.getTracks().forEach(o=>o.stop())):(await((i=(r=this.processor)==null?void 0:r.writableControl)==null?void 0:i.close()),(s=this.trackGenerator)==null||s.stop()),await this.transformer.destroy())}},VWe={"@mediapipe/tasks-vision":"0.10.14"};function Jh(t,e){const n=t.TEXTURE0+e;t.activeTexture(n);const r=t.createTexture();return t.bindTexture(t.TEXTURE_2D,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.bindTexture(t.TEXTURE_2D,r),r}function ih(t,e,n){const r=t.createShader(e);if(t.shaderSource(r,n),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS))throw console.error("Shader compile failed:",t.getShaderInfoLog(r)),t.deleteShader(r),new Error("Shader compile failed");return r}function m4(t,e,n){const r=t.createProgram();if(t.attachShader(r,e),t.attachShader(r,n),t.linkProgram(r),!t.getProgramParameter(r,t.LINK_STATUS))throw console.error("Program link failed:",t.getProgramInfoLog(r)),new Error("Program link failed");return r}function m1(t,e,n,r){const i=t.createFramebuffer();if(t.bindFramebuffer(t.FRAMEBUFFER,i),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n,r,0,t.RGBA,t.UNSIGNED_BYTE,null),t.checkFramebufferStatus(t.FRAMEBUFFER)!==t.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer not complete");return t.bindFramebuffer(t.FRAMEBUFFER,null),i}function KWe(t){const e=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,e),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,-1,-1,1,1,1,-1]),t.STATIC_DRAW),e}async function GWe(t,e,n){const r=t.width/t.height,i=e/n;let s=0,o=0,a=t.width,c=t.height;return r>i?(a=Math.round(t.height*i),s=Math.round((t.width-a)/2)):r<i&&(c=Math.round(t.width/i),o=Math.round((t.height-c)/2)),createImageBitmap(t,s,o,a,c,{resizeWidth:e,resizeHeight:n,resizeQuality:"medium"})}var Qh;function p5(){return Qh||(Qh=new ImageData(2,2),Qh.data[0]=0,Qh.data[1]=0,Qh.data[2]=0,Qh.data[3]=0),Qh}var LD=t=>t,MD=(t=!0)=>`#version 300 es
  in vec2 position;
  out vec2 texCoords;

  void main() {
    texCoords = (position + 1.0) / 2.0;
    texCoords.y = ${t?"1.0 - texCoords.y":"texCoords.y"};
    gl_Position = vec4(position, 0, 1.0);
  }
`,zWe=LD`#version 300 es
  precision mediump float;
  in vec2 texCoords;
  uniform sampler2D u_texture;
  uniform vec2 u_texelSize;
  uniform vec2 u_direction;
  uniform float u_radius;
  out vec4 fragColor;

  void main() {
    float sigma = u_radius;
    float twoSigmaSq = 2.0 * sigma * sigma;
    float totalWeight = 0.0;
    vec3 result = vec3(0.0);
    const int MAX_SAMPLES = 16;
    int radius = int(min(float(MAX_SAMPLES), ceil(u_radius)));

    for (int i = -MAX_SAMPLES; i <= MAX_SAMPLES; ++i) {
      float offset = float(i);
      if (abs(offset) > float(radius)) continue;
      float weight = exp(-(offset * offset) / twoSigmaSq);
      vec2 sampleCoord = texCoords + u_direction * u_texelSize * offset;
      result += texture(u_texture, sampleCoord).rgb * weight;
      totalWeight += weight;
    }

    fragColor = vec4(result / totalWeight, 1.0);
  }
`;function WWe(t){const e=ih(t,t.VERTEX_SHADER,MD()),n=ih(t,t.FRAGMENT_SHADER,zWe),r=m4(t,e,n),i={position:t.getAttribLocation(r,"position"),texture:t.getUniformLocation(r,"u_texture"),texelSize:t.getUniformLocation(r,"u_texelSize"),direction:t.getUniformLocation(r,"u_direction"),radius:t.getUniformLocation(r,"u_radius")};return{program:r,shader:n,vertexShader:e,uniforms:i}}function zW(t,e,n,r,i,s,o,a,c,l){t.useProgram(s),t.bindBuffer(t.ARRAY_BUFFER,a),t.vertexAttribPointer(o.position,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(o.position);const d=1/n,h=1/r;return t.bindFramebuffer(t.FRAMEBUFFER,c[0]),t.viewport(0,0,n,r),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,e),t.uniform1i(o.texture,0),t.uniform2f(o.texelSize,d,h),t.uniform2f(o.direction,1,0),t.uniform1f(o.radius,i),t.drawArrays(t.TRIANGLES,0,6),t.bindFramebuffer(t.FRAMEBUFFER,c[1]),t.viewport(0,0,n,r),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,l[0]),t.uniform1i(o.texture,0),t.uniform2f(o.direction,0,1),t.drawArrays(t.TRIANGLES,0,6),t.bindFramebuffer(t.FRAMEBUFFER,null),l[1]}var YWe=LD`#version 300 es
precision mediump float;

in vec2 texCoords;

uniform sampler2D u_texture;
uniform vec2 u_texelSize;    // 1.0 / texture size
uniform vec2 u_direction;    // (1.0, 0.0) for horizontal, (0.0, 1.0) for vertical
uniform float u_radius;      // blur radius in texels

out vec4 fragColor;

void main() {
    vec3 sum = vec3(0.0);
    float count = 0.0;

    // Limit radius to avoid excessive loop cost
    const int MAX_RADIUS = 16;
    int radius = int(min(float(MAX_RADIUS), u_radius));

    for (int i = -MAX_RADIUS; i <= MAX_RADIUS; ++i) {
        if (abs(i) > radius) continue;

        vec2 offset = u_direction * u_texelSize * float(i);
        sum += texture(u_texture, texCoords + offset).rgb;
        count += 1.0;
  }

  fragColor = vec4(sum / count, 1.0);
}
`;function XWe(t){const e=ih(t,t.VERTEX_SHADER,MD()),n=ih(t,t.FRAGMENT_SHADER,YWe),r=m4(t,e,n),i={position:t.getAttribLocation(r,"position"),texture:t.getUniformLocation(r,"u_texture"),texelSize:t.getUniformLocation(r,"u_texelSize"),direction:t.getUniformLocation(r,"u_direction"),radius:t.getUniformLocation(r,"u_radius")};return{program:r,vertexShader:e,fragmentShader:n,uniforms:i}}var JWe=LD`#version 300 es
  precision mediump float;
  in vec2 texCoords;
  uniform sampler2D background;
  uniform sampler2D frame;
  uniform sampler2D mask;
  out vec4 fragColor;
  
  void main() {
      
    vec4 frameTex = texture(frame, texCoords);
    vec4 bgTex = texture(background, texCoords);

    float maskVal = texture(mask, texCoords).r;

    // Compute screen-space gradient to detect edge sharpness
    float grad = length(vec2(dFdx(maskVal), dFdy(maskVal)));

    float edgeSoftness = 2.0; // higher = softer
    
    // Create a smooth edge around binary transition
    float smoothAlpha = smoothstep(0.5 - grad * edgeSoftness, 0.5 + grad * edgeSoftness, maskVal);

    // Optional: preserve frame alpha, or override as fully opaque
    vec4 blended = mix(bgTex, vec4(frameTex.rgb, 1.0), 1.0 - smoothAlpha);
    
    fragColor = blended;
  
  }
`;function QWe(t){const e=ih(t,t.VERTEX_SHADER,MD()),n=ih(t,t.FRAGMENT_SHADER,JWe),r=m4(t,e,n),i={position:t.getAttribLocation(r,"position")},s={mask:t.getUniformLocation(r,"mask"),frame:t.getUniformLocation(r,"frame"),background:t.getUniformLocation(r,"background"),stepWidth:t.getUniformLocation(r,"u_stepWidth")};return{program:r,vertexShader:e,fragmentShader:n,attribLocations:i,uniformLocations:s}}function ZWe(t,e,n){const r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e,n,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);const i=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,i),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0);const s=`
      attribute vec2 position;
      varying vec2 v_uv;
      void main() {
        v_uv = (position + 1.0) * 0.5;
        gl_Position = vec4(position, 0.0, 1.0);
      }
    `,o=`
      precision mediump float;
      varying vec2 v_uv;
      uniform sampler2D u_texture;
      void main() {
        gl_FragColor = texture2D(u_texture, v_uv);
      }
    `,a=ih(t,t.VERTEX_SHADER,s),c=ih(t,t.FRAGMENT_SHADER,o),l=m4(t,a,c),d={texture:t.getUniformLocation(l,"u_texture"),position:t.getAttribLocation(l,"position")};return{framebuffer:i,texture:r,program:l,uniforms:d}}function eYe(t,e,n,r,i,s){return t.useProgram(n.program),t.bindFramebuffer(t.FRAMEBUFFER,n.framebuffer),t.viewport(0,0,i,s),t.bindBuffer(t.ARRAY_BUFFER,r),t.enableVertexAttribArray(n.uniforms.position),t.vertexAttribPointer(n.uniforms.position,2,t.FLOAT,!1,0,0),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,e),t.uniform1i(n.uniforms.texture,0),t.drawArrays(t.TRIANGLES,0,6),t.bindFramebuffer(t.FRAMEBUFFER,null),n.texture}var WW=t=>{const e=t.getContext("webgl2",{antialias:!0,premultipliedAlpha:!0});let n=null,r=8;const i=4;if(!e){console.error("Failed to create WebGL context");return}e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA);const s=QWe(e),o=s.program,a=s.attribLocations.position,{mask:c,frame:l,background:d}=s.uniformLocations,h=WWe(e),m=h.program,g=h.uniforms,y=XWe(e),v=y.program,E=y.uniforms,w=Jh(e,0),R=Jh(e,1),x=KWe(e);if(!x)throw new Error("Failed to create vertex buffer");let C=[],k=[],T=[],L=0,O=1;C.push(Jh(e,3)),C.push(Jh(e,4));const P=Math.floor(t.width/i),D=Math.floor(t.height/i),j=ZWe(e,P,D);k.push(m1(e,C[0],P,D)),k.push(m1(e,C[1],P,D));const H=Jh(e,5),z=m1(e,H,t.width,t.height);T.push(Jh(e,6)),T.push(Jh(e,7));const Y=[m1(e,T[0],t.width,t.height),m1(e,T[1],t.width,t.height)];e.useProgram(o),e.uniform1i(d,0),e.uniform1i(l,1),e.uniform1i(c,2);let W=p5();function F(q){if(q.codedWidth===0||T.length===0)return;const J=q.displayWidth,ue=q.displayHeight;e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,R),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,q);let ge=w;if(n){const Re=eYe(e,R,j,x,P,D);ge=zW(e,Re,P,D,n,m,g,x,k,C)}else e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,w),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,W),ge=w;e.viewport(0,0,J,ue),e.clearColor(1,1,1,1),e.clear(e.COLOR_BUFFER_BIT),e.useProgram(o),e.bindBuffer(e.ARRAY_BUFFER,x),e.vertexAttribPointer(a,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(a),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,ge),e.uniform1i(d,0),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,R),e.uniform1i(l,1),e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_2D,T[L]),e.uniform1i(c,2),e.drawArrays(e.TRIANGLES,0,6)}async function $(q){if(W=p5(),q)try{W=await GWe(q,t.width,t.height)}catch(J){console.error("Error processing background image, falling back to black background:",J)}e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,w),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,W)}function V(q){n=q?Math.max(1,Math.floor(q/i)):null,$(null)}function G(q){const J=[z,Y[O]],ue=[H,T[O]];zW(e,q,t.width,t.height,r,v,E,x,J,ue),L=O,O=1-O}function Z(){e.deleteProgram(o),e.deleteProgram(m),e.deleteProgram(v),e.deleteTexture(w),e.deleteTexture(R),e.deleteTexture(H),e.deleteFramebuffer(z);for(const q of C)e.deleteTexture(q);for(const q of k)e.deleteFramebuffer(q);for(const q of T)e.deleteTexture(q);for(const q of Y)e.deleteFramebuffer(q);e.deleteBuffer(x),j&&(e.deleteTexture(j.texture),e.deleteFramebuffer(j.framebuffer),e.deleteProgram(j.program)),W&&(W instanceof ImageBitmap&&W.close(),W=p5()),C=[],k=[],T=[]}return{renderFrame:F,updateMask:G,setBackgroundImage:$,setBlurRadius:V,cleanup:Z}},Rfe=class{constructor(){this.isDisabled=!1}async init({outputCanvas:t,inputElement:e}){if(!(e instanceof HTMLVideoElement))throw TypeError("Video transformer needs a HTMLVideoElement as input");this.transformer=new TransformStream({transform:(n,r)=>this.transform(n,r)}),this.canvas=t||null,t&&(this.gl=WW(this.canvas||Q3(e.videoWidth,e.videoHeight))),this.inputVideo=e,this.isDisabled=!1}async restart({outputCanvas:t,inputElement:e}){var n;this.canvas=t||null,(n=this.gl)==null||n.cleanup(),this.gl=WW(this.canvas||Q3(e.videoWidth,e.videoHeight)),this.inputVideo=e,this.isDisabled=!1}async destroy(){var t;this.isDisabled=!0,this.canvas=void 0,(t=this.gl)==null||t.cleanup(),this.gl=void 0}},kfe=class extends Rfe{constructor(t){super(),this.backgroundImageAndPath=null,this.segmentationTimeMs=0,this.isFirstFrame=!0,this.options=t,this.update(t)}static get isSupported(){return typeof OffscreenCanvas<"u"&&typeof VideoFrame<"u"&&typeof createImageBitmap<"u"&&!!document.createElement("canvas").getContext("webgl2")}async init({outputCanvas:t,inputElement:e}){var n,r,i,s,o,a;await super.init({outputCanvas:t,inputElement:e});const c=await op.forVisionTasks((r=(n=this.options.assetPaths)==null?void 0:n.tasksVisionFileSet)!=null?r:`https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@${VWe["@mediapipe/tasks-vision"]}/wasm`);this.imageSegmenter=await cs.createFromOptions(c,{baseOptions:{modelAssetPath:(s=(i=this.options.assetPaths)==null?void 0:i.modelAssetPath)!=null?s:"https://storage.googleapis.com/mediapipe-models/image_segmenter/selfie_segmenter/float16/latest/selfie_segmenter.tflite",delegate:"GPU",...this.options.segmenterOptions},canvas:this.canvas,runningMode:"VIDEO",outputCategoryMask:!0,outputConfidenceMasks:!1}),(o=this.options)!=null&&o.imagePath&&await this.loadAndSetBackground(this.options.imagePath).catch(l=>console.error("Error while loading processor background image: ",l)),this.options.blurRadius&&((a=this.gl)==null||a.setBlurRadius(this.options.blurRadius))}async destroy(){var t;await super.destroy(),await((t=this.imageSegmenter)==null?void 0:t.close()),this.backgroundImageAndPath=null,this.isFirstFrame=!0}async loadAndSetBackground(t){var e,n;if(!this.backgroundImageAndPath||((e=this.backgroundImageAndPath)==null?void 0:e.path)!==t){const r=new Image;await new Promise((s,o)=>{r.crossOrigin="Anonymous",r.onload=()=>s(r),r.onerror=a=>o(a),r.src=t});const i=await createImageBitmap(r);this.backgroundImageAndPath={imageData:i,path:t}}(n=this.gl)==null||n.setBackgroundImage(this.backgroundImageAndPath.imageData)}async transform(t,e){var n,r;let i=!1;try{if(!(t instanceof VideoFrame)||t.codedWidth===0||t.codedHeight===0){console.debug("empty frame detected, ignoring");return}if(this.isDisabled){e.enqueue(t),i=!0;return}const s=Date.now();if(!this.canvas)throw TypeError("Canvas needs to be initialized first");this.canvas.width=t.displayWidth,this.canvas.height=t.displayHeight,this.isFirstFrame&&(e.enqueue(t.clone()),this.inputVideo&&await new Promise(c=>{this.inputVideo.requestVideoFrameCallback((l,d)=>{const h=d.expectedDisplayTime-d.presentationTime;setTimeout(c,h)})})),this.isFirstFrame=!1;const o=performance.now(),a=new Promise((c,l)=>{var d;try{let h=performance.now();(d=this.imageSegmenter)==null||d.segmentForVideo(t,h,m=>{this.segmentationTimeMs=performance.now()-h,this.segmentationResults=m,this.updateMask(m.categoryMask),m.close(),c()})}catch(h){l(h)}});if(this.drawFrame(t),this.canvas&&this.canvas.width>0&&this.canvas.height>0){const c=new VideoFrame(this.canvas,{timestamp:t.timestamp||s});e.enqueue(c);const l=performance.now()-o,d={processingTimeMs:this.segmentationTimeMs+l,segmentationTimeMs:this.segmentationTimeMs,filterTimeMs:l};(r=(n=this.options).onFrameProcessed)==null||r.call(n,d)}else e.enqueue(t);await a}catch(s){console.error("Error while processing frame: ",s)}finally{i||t.close()}}async update(t){var e,n,r;this.options={...this.options,...t},(n=this.gl)==null||n.setBlurRadius((e=t.blurRadius)!=null?e:null),t.imagePath?await this.loadAndSetBackground(t.imagePath):(r=this.gl)==null||r.setBackgroundImage(null)}async drawFrame(t){var e;this.gl&&((e=this.gl)==null||e.renderFrame(t))}async updateMask(t){var e;t&&((e=this.gl)==null||e.updateMask(t.getAsWebGLTexture()))}},tYe=()=>kfe.isSupported&&Cfe.isSupported;const nYe=""+new URL("selfie_segmenter-DF05sdL4.tflite",import.meta.url).href,rYe={wasmLoaderPath:new URL(""+new URL("vision_wasm_internal-CEyeacG0.js",import.meta.url).href,import.meta.url).href,wasmBinaryPath:new URL(""+new URL("vision_wasm_internal-TmjHuG4I.wasm",import.meta.url).href,import.meta.url).href};class iYe extends kfe{async init({outputCanvas:e,inputElement:n}){await Rfe.prototype.init.call(this,{outputCanvas:e,inputElement:n}),this.imageSegmenter=await cs.createFromOptions(rYe,{baseOptions:{modelAssetPath:nYe,delegate:"GPU",...this.options.segmenterOptions},canvas:this.canvas,runningMode:"VIDEO",outputCategoryMask:!0,outputConfidenceMasks:!1}),this.options.blurRadius&&this.gl?.setBlurRadius(this.options.blurRadius)}}const OD=_.createContext(void 0);function PD(){const t=_.use(OD);if(t===void 0)throw new Error("useTrackProcessor must be used within a ProcessorProvider");return t}function sYe(){const t=_.use(OD);if(t===void 0)throw new Error("useTrackProcessor must be used within a ProcessorProvider");return fue(n=>n.pipe(ve(([r])=>r)),[t])}const oYe=(t,e,n)=>{ot([e,n]).pipe(t.bind()).subscribe(([r,i])=>{if(!i||!r)return;const{processor:s}=i;s&&!r.getProcessor()&&r.setProcessor(s),!s&&r.getProcessor()&&r.stopProcessor()})},aYe=t=>{const{processor:e}=PD();_.useEffect(()=>{t&&(e&&!t.getProcessor()&&t.setProcessor(e),!e&&t.getProcessor()&&t.stopProcessor())},[e,t])},cYe=({children:t})=>{const[e]=$r($le),n=_.useMemo(()=>tYe(),[]),r=_.useMemo(()=>new Cfe(new iYe({blurRadius:15}),"background-blur"),[]),i=_.useMemo(()=>({supported:n,processor:n&&e?r:void 0}),[n,e,r]);return S.jsx(OD,{value:i,children:t})},lYe="_livekit_room_box_pjiap_12",m5={livekit_room_box:lYe},uYe=({client:t,livekitRooms:e,env:n})=>{const{t:r}=et(),[i,s]=$r(Fle),[o,a]=$r(y9),[c,l]=_.useState(!1);_.useEffect(()=>{t.doesServerSupportUnstableFeature(NC).then(D=>{l(D)}).catch(D=>{N.warn("Failed to check if sticky events are supported",D)})},[t]);const[d,h]=$r(Gle),m=_.useId(),g=_.useCallback(D=>{h(D.target.value)},[h]),[y,v]=$r(Xv),[E,w]=$r(Kle),[R,x]=$r(zle),[C,k]=_.useState(R);_.useEffect(()=>{k(R)},[R]);const[T,L]=$r(Vle),O=nc(),P=_.useMemo(()=>{const D=e?.find(j=>j.isLocal)?.room;if(D?.engine.client.ws?.url){const j=new URL(D.engine.client.ws.url);return j.search="",j}return null},[e]);return S.jsxs(S.Fragment,{children:[S.jsx("p",{children:r("developer_mode.hostname",{hostname:window.location.hostname||"unknown"})}),S.jsx("p",{children:r("version",{productName:"Element Call",version:"dev"})}),S.jsx("p",{children:r("developer_mode.crypto_version",{version:t.getCrypto()?.getVersion()||"unknown"})}),S.jsx("p",{children:r("developer_mode.matrix_id",{id:t.getUserId()||"unknown"})}),S.jsx("p",{children:r("developer_mode.device_id",{id:t.getDeviceId()||"unknown"})}),S.jsx(Nt,{children:S.jsx(er,{id:"duplicateTiles",type:"number",label:r("developer_mode.duplicate_tiles_label"),value:i.toString(),min:0,onChange:_.useCallback(D=>{const j=D.target.valueAsNumber;j<0||s(Number.isNaN(j)?0:j)},[s])})}),S.jsx(Nt,{children:S.jsx(er,{id:"debugTileLayout",type:"checkbox",checked:o,label:r("developer_mode.debug_tile_layout_label"),onChange:D=>a(D.target.checked)})}),S.jsx(Nt,{children:S.jsx(er,{id:"showConnectionStats",type:"checkbox",label:r("developer_mode.show_connection_stats"),checked:!!y,onChange:_.useCallback(D=>{v(D.target.checked)},[v])})}),S.jsx(Nt,{children:S.jsx(er,{id:"muteAllAudio",type:"checkbox",label:r("developer_mode.mute_all_audio"),checked:T,onChange:_.useCallback(D=>{L(D.target.checked)},[L])})})," ",S.jsxs(Nt,{children:[S.jsx(er,{id:"alwaysShowIphoneEarpiece",type:"checkbox",label:r("developer_mode.always_show_iphone_earpiece"),checked:E,onChange:_.useCallback(D=>{w(D.target.checked)},[w])})," "]}),S.jsx(N9e,{onSubmit:D=>D.preventDefault(),helpLabel:R===null?r("developer_mode.custom_livekit_url.from_config"):r("developer_mode.custom_livekit_url.current_url")+R,label:r("developer_mode.custom_livekit_url.label"),saveButtonLabel:r("developer_mode.custom_livekit_url.save"),savingLabel:r("developer_mode.custom_livekit_url.saving"),cancelButtonLabel:r("developer_mode.custom_livekit_url.reset"),onSave:_.useCallback(D=>{x(C===""?null:C)},[x,C]),value:C??"",onChange:_.useCallback(D=>{k(D.target.value)},[k]),onCancel:_.useCallback(D=>{x(null)},[x])}),S.jsx(Hc,{as:"h3",type:"body",weight:"semibold",size:"lg",children:r("developer_mode.matrixRTCMode.title")}),S.jsxs(y3,{children:[S.jsxs(JE,{name:m,control:S.jsx(XE,{checked:d===so.Legacy,value:so.Legacy,onChange:g}),children:[S.jsx(ib,{children:r("developer_mode.matrixRTCMode.Legacy.label")}),S.jsx(QE,{children:r("developer_mode.matrixRTCMode.Legacy.description")})]}),S.jsxs(JE,{name:m,control:S.jsx(XE,{checked:d===so.Compatibility,value:so.Compatibility,onChange:g}),children:[S.jsx(ib,{children:r("developer_mode.matrixRTCMode.Comptibility.label")}),S.jsx(QE,{children:r("developer_mode.matrixRTCMode.Comptibility.description")})]}),S.jsxs(JE,{name:m,control:S.jsx(XE,{checked:d===so.Matrix_2_0,value:so.Matrix_2_0,disabled:!c,onChange:g}),children:[S.jsx(ib,{children:r("developer_mode.matrixRTCMode.Matrix_2_0.label")}),S.jsx(QE,{children:r("developer_mode.matrixRTCMode.Matrix_2_0.description")})]})]}),e?.map(D=>S.jsxs("div",{className:m5.livekit_room_box,children:[S.jsx("h4",{children:r("developer_mode.livekit_sfu",{url:D.url||"unknown"})}),S.jsxs("p",{children:["LivekitAlias: ",D.livekitAlias]}),S.jsxs("p",{children:["connectionState (wont hot reload): ",D.room.state]}),D.isLocal&&S.jsxs("p",{children:["ws-url: ",P?.href]}),S.jsxs("p",{children:[r("developer_mode.livekit_server_info"),"(",D.isLocal?"local":"remote",")"]}),S.jsxs("pre",{className:m5.pre,children:[D.room.serverInfo?JSON.stringify(D.room.serverInfo,null,2):"undefined",D.room.metadata]}),S.jsx("p",{children:"Local Participant"}),S.jsx("pre",{className:m5.pre,children:D.room.localParticipant.identity}),S.jsx("p",{children:"Remote Participants"}),S.jsx("ul",{children:Array.from(D.room.remoteParticipants.keys()).map(j=>S.jsx("li",{children:j},j))})]})),S.jsx("p",{children:r("developer_mode.environment_variables")}),S.jsx("pre",{children:JSON.stringify(n,null,2)}),S.jsx("p",{children:r("developer_mode.url_params")}),S.jsx("pre",{children:JSON.stringify(O,null,2)})]})},dYe={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_PACKAGE:"embedded"},DD="audio",ND=({open:t,onDismiss:e,tab:n,onTabChange:r,client:i,roomId:s,livekitRooms:o})=>{const{t:a}=et(),c=()=>{const{supported:P}=PD(),[D,j]=$r($le);return S.jsxs(S.Fragment,{children:[S.jsx("h4",{children:a("settings.background_blur_header")}),S.jsx(Nt,{children:S.jsx(er,{id:"activateBackgroundBlur",label:a("settings.background_blur_label"),description:P?"":a("settings.blur_not_supported_by_browser"),type:"checkbox",checked:!!D,onChange:H=>j(H.target.checked),disabled:!P})})]})},l=vm();_.useEffect(()=>{t&&l.requestDeviceNames()},[t,l]);const[d,h]=$r(qle),[m,g]=_.useState(d),[y]=$r(jle),{available:v}=xR(),{controlledAudioDevices:E}=nc(),w=Fe(due),R={key:"audio",name:a("common.audio"),content:S.jsx(S.Fragment,{children:S.jsxs(y3,{children:[!E&&S.jsx(Z6,{device:l.audioInput,title:a("settings.devices.microphone"),numberedLabel:P=>a("settings.devices.microphone_numbered",{n:P})}),w&&E&&S.jsx(qt,{onClick:P=>{P.preventDefault(),window.controls.showNativeAudioDevicePicker?.(),window.controls.showNativeOutputDevicePicker?.()},children:a("settings.devices.change_device_button")}),S.jsx(Z6,{device:l.audioOutput,title:a("settings.devices.speaker"),numberedLabel:P=>a("settings.devices.speaker_numbered",{n:P})}),S.jsxs("div",{className:Rz.volumeSlider,children:[S.jsx("label",{children:a("settings.audio_tab.effect_volume_label")}),S.jsx("p",{children:a("settings.audio_tab.effect_volume_description")}),S.jsx(Aue,{label:a("video_tile.volume"),value:m,onValueChange:g,onValueCommit:h,min:0,max:1,step:.01})]})]})})},x={key:"video",name:a("common.video"),content:S.jsxs(S.Fragment,{children:[S.jsx(y3,{children:S.jsx(Z6,{device:l.videoInput,title:a("settings.devices.camera"),numberedLabel:P=>a("settings.devices.camera_numbered",{n:P})})}),S.jsx(O8,{}),S.jsx(c,{})]})},C={key:"preferences",name:a("common.preferences"),content:S.jsx(BGe,{})},k={key:"profile",name:a("common.profile"),content:S.jsx(oGe,{client:i})},T={key:"feedback",name:a("settings.feedback_tab_title"),content:S.jsx(cGe,{roomId:s})},L={key:"developer",name:a("settings.developer_tab_title"),content:S.jsx(uYe,{env:dYe,client:i,livekitRooms:o})},O=[R,x];return Et===null&&O.push(k),O.push(C),v&&O.push(T),y&&O.push(L),S.jsx(mm,{title:a("common.settings"),className:Rz.settingsModal,open:t,onDismiss:e,tabbed:!0,children:S.jsx(jKe,{label:a("common.settings"),tab:n,onTabChange:r,tabs:O})})},fYe=(t,e)=>_.createElement("svg",{width:22,height:22,viewBox:"0 0 22 22",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:e,...t},_.createElement("mask",{id:"path-1-inside-1_898_2641",fill:"white"},_.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M17.1502 20.1214C15.3946 21.3074 13.2782 22 11 22C8.52367 22 6.23845 21.1817 4.4 19.8008C1.72821 17.794 0 14.5988 0 11C0 4.92487 4.92487 0 11 0C17.0751 0 22 4.92487 22 11C22 14.797 20.0762 18.1446 17.1502 20.1214ZM11 11.55C12.8225 11.55 14.3 9.94942 14.3 7.975C14.3 6.00058 12.8225 4.4 11 4.4C9.17746 4.4 7.7 6.00058 7.7 7.975C7.7 9.94942 9.17746 11.55 11 11.55ZM11 19.8C13.3782 19.8 15.536 18.8566 17.1197 17.3237C16.1403 14.9056 13.7693 13.2 11 13.2C8.23066 13.2 5.85969 14.9056 4.88028 17.3237C6.46399 18.8566 8.62183 19.8 11 19.8Z"})),_.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M17.1502 20.1214C15.3946 21.3074 13.2782 22 11 22C8.52367 22 6.23845 21.1817 4.4 19.8008C1.72821 17.794 0 14.5988 0 11C0 4.92487 4.92487 0 11 0C17.0751 0 22 4.92487 22 11C22 14.797 20.0762 18.1446 17.1502 20.1214ZM11 11.55C12.8225 11.55 14.3 9.94942 14.3 7.975C14.3 6.00058 12.8225 4.4 11 4.4C9.17746 4.4 7.7 6.00058 7.7 7.975C7.7 9.94942 9.17746 11.55 11 11.55ZM11 19.8C13.3782 19.8 15.536 18.8566 17.1197 17.3237C16.1403 14.9056 13.7693 13.2 11 13.2C8.23066 13.2 5.85969 14.9056 4.88028 17.3237C6.46399 18.8566 8.62183 19.8 11 19.8Z",fill:"white"}),_.createElement("path",{d:"M17.1502 20.1214L17.9339 21.2814L17.1502 20.1214ZM4.4 19.8008L3.55919 20.9202H3.55919L4.4 19.8008ZM17.1197 17.3237L18.0934 18.3296L18.7717 17.6731L18.4173 16.7981L17.1197 17.3237ZM4.88028 17.3237L3.58268 16.7981L3.22829 17.6731L3.90659 18.3296L4.88028 17.3237ZM11 23.4C13.5662 23.4 15.9541 22.619 17.9339 21.2814L16.3665 18.9613C14.835 19.9959 12.9902 20.6 11 20.6V23.4ZM3.55919 20.9202C5.63176 22.477 8.21011 23.4 11 23.4V20.6C8.83723 20.6 6.84514 19.8865 5.24081 18.6814L3.55919 20.9202ZM-1.4 11C-1.4 15.0577 0.55052 18.6603 3.55919 20.9202L5.24081 18.6814C2.90591 16.9276 1.4 14.1399 1.4 11H-1.4ZM11 -1.4C4.15167 -1.4 -1.4 4.15167 -1.4 11H1.4C1.4 5.69807 5.69807 1.4 11 1.4V-1.4ZM23.4 11C23.4 4.15167 17.8483 -1.4 11 -1.4V1.4C16.3019 1.4 20.6 5.69807 20.6 11H23.4ZM17.9339 21.2814C21.2288 19.0554 23.4 15.2815 23.4 11H20.6C20.6 14.3124 18.9236 17.2337 16.3665 18.9613L17.9339 21.2814ZM12.9 7.975C12.9 9.28384 11.9459 10.15 11 10.15V12.95C13.6991 12.95 15.7 10.615 15.7 7.975H12.9ZM11 5.8C11.9459 5.8 12.9 6.66616 12.9 7.975H15.7C15.7 5.335 13.6991 3 11 3V5.8ZM9.1 7.975C9.1 6.66616 10.0541 5.8 11 5.8V3C8.30086 3 6.3 5.335 6.3 7.975H9.1ZM11 10.15C10.0541 10.15 9.1 9.28384 9.1 7.975H6.3C6.3 10.615 8.30086 12.95 11 12.95V10.15ZM16.146 16.3178C14.8129 17.6081 13.0004 18.4 11 18.4V21.2C13.756 21.2 16.2591 20.1051 18.0934 18.3296L16.146 16.3178ZM11 14.6C13.1797 14.6 15.0494 15.9415 15.8221 17.8493L18.4173 16.7981C17.2312 13.8697 14.359 11.8 11 11.8V14.6ZM6.17788 17.8493C6.95058 15.9415 8.8203 14.6 11 14.6V11.8C7.64102 11.8 4.7688 13.8697 3.58268 16.7981L6.17788 17.8493ZM11 18.4C8.99963 18.4 7.18709 17.6081 5.85397 16.3178L3.90659 18.3296C5.74088 20.1051 8.24402 21.2 11 21.2V18.4Z",fill:"white",mask:"url(#path-1-inside-1_898_2641)"})),YW=_.forwardRef(fYe),hYe=(t,e)=>_.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:e,...t},_.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M20.0988 9.01625C20.3188 9.59375 20.8825 9.97875 21.5013 9.97875C22.3263 9.97875 23 10.6525 23 11.4775V12.5225C23 13.3475 22.3263 14.0213 21.5013 14.0213C20.8825 14.0213 20.3188 14.4062 20.0988 14.9838C20.0806 15.0292 20.0624 15.0753 20.0441 15.1218C19.9792 15.2863 19.9125 15.4555 19.8375 15.6163C19.5763 16.18 19.7 16.84 20.14 17.28C20.7313 17.8575 20.7313 18.8062 20.14 19.3975L19.3975 20.14C18.82 20.7313 17.8713 20.7313 17.28 20.14C16.8538 19.7 16.18 19.5763 15.6163 19.8375C15.41 19.9338 15.2037 20.0163 14.9838 20.0988C14.4062 20.3188 14.0213 20.8825 14.0213 21.5013C14.0213 22.3263 13.3475 23 12.5225 23H11.4775C10.6525 23 9.97875 22.3263 9.97875 21.5013C9.97875 20.8825 9.59375 20.3188 9.01625 20.0988C8.97079 20.0806 8.92466 20.0624 8.87815 20.044C8.71368 19.9792 8.54454 19.9125 8.38375 19.8375C7.82 19.5763 7.16 19.7 6.72 20.14C6.1425 20.7313 5.19375 20.7313 4.6025 20.14L3.86 19.3975C3.26875 18.82 3.26875 17.8713 3.86 17.28C4.3 16.8538 4.42375 16.18 4.1625 15.6163C4.06625 15.41 3.98375 15.2037 3.90125 14.9838C3.68125 14.4062 3.1175 14.0213 2.49875 14.0213C1.67375 14.0213 1 13.3475 1 12.5225V11.4775C1 10.6525 1.67375 9.97875 2.49875 9.97875C3.1175 9.97875 3.68125 9.59375 3.90125 9.01625C3.94464 8.87742 3.99897 8.74406 4.0539 8.60926C4.086 8.53046 4.11831 8.45117 4.14875 8.37C4.41 7.80625 4.28625 7.14625 3.84625 6.70625C3.255 6.12875 3.255 5.18 3.84625 4.58875L4.6025 3.86C5.18 3.26875 6.12875 3.26875 6.72 3.86C7.14625 4.3 7.82 4.42375 8.38375 4.1625C8.59 4.06625 8.79625 3.97 9.01625 3.90125C9.59375 3.68125 9.97875 3.1175 9.97875 2.49875C9.97875 1.67375 10.6525 1 11.4775 1H12.5225C13.3475 1 14.0213 1.67375 14.0213 2.49875C14.0213 3.13125 14.4062 3.68125 14.9838 3.90125C15.0292 3.91943 15.0753 3.93762 15.1218 3.95595C15.2863 4.02079 15.4555 4.08746 15.6163 4.1625C16.18 4.42375 16.84 4.3 17.28 3.86C17.8575 3.26875 18.8062 3.26875 19.3975 3.86L20.14 4.6025C20.7313 5.18 20.7313 6.12875 20.14 6.72C19.7 7.14625 19.5763 7.82 19.8375 8.38375C19.9338 8.59 20.0163 8.79625 20.0988 9.01625ZM12 17.5C8.96125 17.5 6.5 15.0387 6.5 12C6.5 8.96125 8.96125 6.5 12 6.5C15.0387 6.5 17.5 8.96125 17.5 12C17.5 15.0387 15.0387 17.5 12 17.5Z",fill:"#ffffff"})),pYe=_.forwardRef(hYe),mYe=(t,e)=>_.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:e,...t},_.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.49966 2.38889C7.49966 1.89797 7.89763 1.5 8.38855 1.5H20.1108C20.6017 1.5 20.9997 1.89797 20.9997 2.38889V21.6111C20.9997 22.102 20.6017 22.5 20.1108 22.5H8.38855C7.89763 22.5 7.49966 22.102 7.49966 21.6111V12.6667H7.49089H7.4821H7.47331H7.46452H7.45573H7.44694H7.43815H7.42936H7.42057H7.41178H7.403H7.39421H7.38542H7.37663H7.36784H7.35905H7.35026H7.34147H7.33268H7.32389H7.3151H7.30632H7.29753H7.28874H7.27995H7.27116H7.26237H7.25358H7.24479H7.236H7.22721H7.21842H7.20964H7.20085H7.19206H7.18327H7.17448H7.16569H7.1569H7.14811H7.13932H7.13053H7.12175H7.11296H7.10417H7.09538H7.08659H7.0778H7.06901H7.06022H7.05143H7.04264H7.03385H7.02507H7.01628H7.00749H6.9987H6.98991H6.98112H6.97233H6.96354H6.95475H6.94596H6.93717H6.92839H6.9196H6.91081H6.90202H6.89323H6.88444H6.87565H6.86686H6.85807H6.84928H6.8405H6.83171H6.82292H6.81413H6.80534H6.79655H6.78776H6.77897H6.77018H6.76139H6.7526H6.74382H6.73503H6.72624H6.71745H6.70866H6.69987H6.69108H6.68229H6.6735H6.66471H6.65592H6.64714H6.63835H6.62956H6.62077H6.61198H6.60319H6.5944H6.58561H6.57682H6.56803H6.55925H6.55046H6.54167H6.53288H6.52409H6.5153H6.50651H6.49772H6.48893H6.48014H6.47135H6.46257H6.45378H6.44499H6.4362H6.42741H6.41862H6.40983H6.40104H6.39225H6.38346H6.37467H6.36589H6.3571H6.34831H6.33952H6.33073H6.32194H6.31315H6.30436H6.29557H6.28678H6.27799H6.26921H6.26042H6.25163H6.24284H6.23405H6.22526H6.21647H6.20768H6.19889H6.1901H6.18132H6.17253H6.16374H6.15495H6.14616H6.13737H6.12858H6.11979H6.111H6.10221H6.09342H6.08464H6.07585H6.06706H6.05827H6.04948H6.04069H6.0319H6.02311H6.01432H6.00553H5.99674H5.98796H5.97917H5.97038H5.96159H5.9528H5.94401H5.93522H5.92643H5.91764H5.90885H5.90007H5.89128H5.88249H5.8737H5.86491H5.85612H5.84733H5.83854H5.82975H5.82096H5.81217H5.80339H5.7946H5.78581H5.77702H5.76823H5.75944H5.75065H5.74186H5.73307H5.72428H5.71549H5.70671H5.69792H5.68913H5.68034H5.67155H5.66276H5.65397H5.64518H5.63639H5.6276H5.61882H5.61003H5.60124H5.59245H5.58366H5.57487H5.56608H5.55729H5.5485H5.53971H5.53092H5.52214H5.51335H5.50456H5.49577H5.48698H5.47819H5.4694H5.46061H5.45182H5.44303H5.43424H5.42546H5.41667H5.40788H5.39909H5.3903H5.38151H5.37272H5.36393H5.35514H5.34635H5.33757H5.32878H5.31999H5.3112H5.30241H5.29362H5.28483H5.27604H5.26725H5.25846H5.24967H5.24089H5.2321H5.22331H5.21452H5.20573H5.19694H5.18815H5.17936H5.17057H5.16178H5.15299H5.14421H5.13542H5.12663H5.11784H5.10905H5.10026H5.09147H5.08268H5.07389H5.0651H5.05632H5.04753H5.03874H5.02995H5.02116H5.01237H5.00358H4.99479H4.986H4.97721H4.96842H4.95964H4.95085H4.94206H4.93327H4.92448H4.91569H4.9069H4.89811H4.88932H4.88053H4.87174H4.86296H4.85417H4.84538H4.83659H4.8278H4.81901H4.81022H4.80143H4.79264H4.78385H4.77507H4.76628H4.75749H4.7487H4.73991H4.73112H4.72233H4.71354H4.70475H4.69596H4.68717H4.67839H4.6696H4.66081H4.65202H4.64323H4.63444H4.62565H4.61686H4.60807H4.59928H4.59049H4.58171H4.57292H4.56413H4.55534H4.54655H4.53776H4.52897H4.52018H4.51139H4.5026H4.49382H4.48503H4.47624H4.46745H4.45866H4.44987H4.44108H4.43229H4.4235H4.41471H4.40592H4.39714H4.38835H4.37956H4.37077H4.36198H4.35319H4.3444H4.33561H4.32682H4.31803H4.30924H4.30046H4.29167H4.28288H4.27409H4.2653H4.25651H4.24772H4.23893H4.23014H4.22135H4.21257H4.20378H4.19499H4.1862H4.17741H4.16862H4.15983H4.15104H4.14225H4.13346H4.12467H4.11589H4.1071H4.09831H4.08952H4.08073H4.07194H4.06315H4.05436H4.04557H4.03678H4.02799H4.01921H4.01042H4.00163H3.99284H3.98405H3.97526H3.96647H3.95768H3.94889H3.9401H3.93132H3.92253H3.91374H3.90495H3.89616H3.88737H3.87858H3.86979H3.861H3.85221H3.84342H3.83464H3.82585H3.81706H3.80827H3.79948H3.79069H3.7819H3.77311H3.76432H3.75553H3.74674H3.73796H3.72917H3.72038H3.71159H3.7028H3.69401H3.68522H3.67643H3.66764H3.65885H3.65007H3.64128H3.63249H3.6237H3.61491H3.60612H3.59733H3.58854H3.57975H3.57096H3.56217H3.55339H3.5446H3.53581H3.52702H3.51823H3.50944H3.50065H3.49186H3.48307H3.47428H3.46549H3.45671H3.44792H3.43913H3.43034H3.42155H3.41276H3.40397H3.39518H3.38639H3.3776H3.36882H3.36003H3.35124H3.34245H3.33366H3.32487H3.31608H3.30729H3.2985H3.28971H3.28092H3.27214H3.26335H3.25456H3.24577H3.23698H3.22819H3.2194H3.21061H3.20182H3.19303H3.18424H3.17546H3.16667H3.15788H3.14909H3.1403H3.13151H3.12272H3.11393H3.10514H3.09635H3.08757H3.07878H3.06999H3.0612H3.05241H3.04362H3.03483H3.02604H3.01725H3.00846H2.99967C2.63148 12.6667 2.33301 12.3682 2.33301 12C2.33301 11.6318 2.63148 11.3333 2.99967 11.3333H3.00846H3.01725H3.02604H3.03483H3.04362H3.05241H3.0612H3.06999H3.07878H3.08757H3.09635H3.10514H3.11393H3.12272H3.13151H3.1403H3.14909H3.15788H3.16667H3.17546H3.18424H3.19303H3.20182H3.21061H3.2194H3.22819H3.23698H3.24577H3.25456H3.26335H3.27214H3.28092H3.28971H3.2985H3.30729H3.31608H3.32487H3.33366H3.34245H3.35124H3.36003H3.36882H3.3776H3.38639H3.39518H3.40397H3.41276H3.42155H3.43034H3.43913H3.44792H3.45671H3.46549H3.47428H3.48307H3.49186H3.50065H3.50944H3.51823H3.52702H3.53581H3.5446H3.55339H3.56217H3.57096H3.57975H3.58854H3.59733H3.60612H3.61491H3.6237H3.63249H3.64128H3.65007H3.65885H3.66764H3.67643H3.68522H3.69401H3.7028H3.71159H3.72038H3.72917H3.73796H3.74674H3.75553H3.76432H3.77311H3.7819H3.79069H3.79948H3.80827H3.81706H3.82585H3.83464H3.84342H3.85221H3.861H3.86979H3.87858H3.88737H3.89616H3.90495H3.91374H3.92253H3.93132H3.9401H3.94889H3.95768H3.96647H3.97526H3.98405H3.99284H4.00163H4.01042H4.01921H4.02799H4.03678H4.04557H4.05436H4.06315H4.07194H4.08073H4.08952H4.09831H4.1071H4.11589H4.12467H4.13346H4.14225H4.15104H4.15983H4.16862H4.17741H4.1862H4.19499H4.20378H4.21257H4.22135H4.23014H4.23893H4.24772H4.25651H4.2653H4.27409H4.28288H4.29167H4.30046H4.30924H4.31803H4.32682H4.33561H4.3444H4.35319H4.36198H4.37077H4.37956H4.38835H4.39714H4.40592H4.41471H4.4235H4.43229H4.44108H4.44987H4.45866H4.46745H4.47624H4.48503H4.49382H4.5026H4.51139H4.52018H4.52897H4.53776H4.54655H4.55534H4.56413H4.57292H4.58171H4.59049H4.59928H4.60807H4.61686H4.62565H4.63444H4.64323H4.65202H4.66081H4.6696H4.67839H4.68717H4.69596H4.70475H4.71354H4.72233H4.73112H4.73991H4.7487H4.75749H4.76628H4.77507H4.78385H4.79264H4.80143H4.81022H4.81901H4.8278H4.83659H4.84538H4.85417H4.86296H4.87174H4.88053H4.88932H4.89811H4.9069H4.91569H4.92448H4.93327H4.94206H4.95085H4.95964H4.96842H4.97721H4.986H4.99479H5.00358H5.01237H5.02116H5.02995H5.03874H5.04753H5.05631H5.0651H5.07389H5.08268H5.09147H5.10026H5.10905H5.11784H5.12663H5.13542H5.14421H5.15299H5.16178H5.17057H5.17936H5.18815H5.19694H5.20573H5.21452H5.22331H5.2321H5.24089H5.24967H5.25846H5.26725H5.27604H5.28483H5.29362H5.30241H5.3112H5.31999H5.32878H5.33757H5.34635H5.35514H5.36393H5.37272H5.38151H5.3903H5.39909H5.40788H5.41667H5.42546H5.43424H5.44303H5.45182H5.46061H5.4694H5.47819H5.48698H5.49577H5.50456H5.51335H5.52214H5.53092H5.53971H5.5485H5.55729H5.56608H5.57487H5.58366H5.59245H5.60124H5.61003H5.61882H5.6276H5.63639H5.64518H5.65397H5.66276H5.67155H5.68034H5.68913H5.69792H5.70671H5.71549H5.72428H5.73307H5.74186H5.75065H5.75944H5.76823H5.77702H5.78581H5.7946H5.80339H5.81217H5.82096H5.82975H5.83854H5.84733H5.85612H5.86491H5.8737H5.88249H5.89128H5.90007H5.90885H5.91764H5.92643H5.93522H5.94401H5.9528H5.96159H5.97038H5.97917H5.98796H5.99674H6.00553H6.01432H6.02311H6.0319H6.04069H6.04948H6.05827H6.06706H6.07585H6.08464H6.09342H6.10221H6.111H6.11979H6.12858H6.13737H6.14616H6.15495H6.16374H6.17253H6.18132H6.1901H6.19889H6.20768H6.21647H6.22526H6.23405H6.24284H6.25163H6.26042H6.26921H6.27799H6.28678H6.29557H6.30436H6.31315H6.32194H6.33073H6.33952H6.34831H6.3571H6.36589H6.37467H6.38346H6.39225H6.40104H6.40983H6.41862H6.42741H6.4362H6.44499H6.45378H6.46257H6.47135H6.48014H6.48893H6.49772H6.50651H6.5153H6.52409H6.53288H6.54167H6.55046H6.55925H6.56803H6.57682H6.58561H6.5944H6.60319H6.61198H6.62077H6.62956H6.63835H6.64714H6.65592H6.66471H6.6735H6.68229H6.69108H6.69987H6.70866H6.71745H6.72624H6.73503H6.74382H6.7526H6.76139H6.77018H6.77897H6.78776H6.79655H6.80534H6.81413H6.82292H6.83171H6.8405H6.84928H6.85807H6.86686H6.87565H6.88444H6.89323H6.90202H6.91081H6.9196H6.92839H6.93717H6.94596H6.95475H6.96354H6.97233H6.98112H6.98991H6.9987H7.00749H7.01628H7.02507H7.03385H7.04264H7.05143H7.06022H7.06901H7.0778H7.08659H7.09538H7.10417H7.11296H7.12175H7.13053H7.13932H7.14811H7.1569H7.16569H7.17448H7.18327H7.19206H7.20085H7.20964H7.21842H7.22721H7.236H7.24479H7.25358H7.26237H7.27116H7.27995H7.28874H7.29753H7.30632H7.3151H7.32389H7.33268H7.34147H7.35026H7.35905H7.36784H7.37663H7.38542H7.39421H7.403H7.41178H7.42057H7.42936H7.43815H7.44694H7.45573H7.46452H7.47331H7.4821H7.49089H7.49966V2.38889ZM13.3687 6.24853C13.1172 5.9796 12.7095 5.9796 12.458 6.24853C12.2065 6.51747 12.2065 6.9535 12.458 7.22243L16.3022 11.3336L16.2894 11.3336L16.2726 11.3336L16.2558 11.3336L16.239 11.3335L16.2223 11.3335L16.2055 11.3335L16.1887 11.3335L16.1719 11.3335L16.1552 11.3334L16.1384 11.3334L16.1216 11.3334L16.1048 11.3334L16.088 11.3334L16.0713 11.3333L16.0545 11.3333L16.0377 11.3333L16.0209 11.3333L16.0041 11.3333L15.9874 11.3332L15.9706 11.3332L15.9538 11.3332L15.937 11.3332L15.9202 11.3332L15.9035 11.3331L15.8867 11.3331L15.8699 11.3331L15.8531 11.3331L15.8364 11.3331L15.8196 11.333L15.8028 11.333L15.786 11.333L15.7692 11.333L15.7525 11.333L15.7357 11.3329L15.7189 11.3329L15.7021 11.3329L15.6853 11.3329L15.6686 11.3329L15.6518 11.3328L15.635 11.3328L15.6182 11.3328L15.6014 11.3328L15.5847 11.3328L15.5679 11.3327L15.5511 11.3327L15.5343 11.3327L15.5175 11.3327L15.5008 11.3327L15.484 11.3326L15.4672 11.3326L15.4504 11.3326L15.4337 11.3326L15.4169 11.3326L15.4001 11.3325L15.3833 11.3325L15.3665 11.3325L15.3498 11.3325L15.333 11.3324L15.3162 11.3324L15.2994 11.3324L15.2826 11.3324L15.2659 11.3324L15.2491 11.3323L15.2323 11.3323L15.2155 11.3323L15.1987 11.3323L15.182 11.3323L15.1652 11.3322L15.1484 11.3322L15.1316 11.3322L15.1148 11.3322L15.0981 11.3322L15.0813 11.3321L15.0645 11.3321L15.0477 11.3321L15.031 11.3321L15.0142 11.3321L14.9974 11.332L14.9806 11.332L14.9638 11.332L14.9471 11.332L14.9303 11.332L14.9135 11.3319L14.8967 11.3319L14.8799 11.3319L14.8632 11.3319L14.8464 11.3319L14.8296 11.3318L14.8128 11.3318L14.796 11.3318L14.7793 11.3318L14.7625 11.3318L14.7457 11.3317L14.7289 11.3317L14.7122 11.3317L14.6954 11.3317L14.6786 11.3317L14.6618 11.3316L14.645 11.3316L14.6283 11.3316L14.6115 11.3316L14.5947 11.3316L14.5779 11.3315L14.5611 11.3315L14.5444 11.3315L14.5276 11.3315L14.5108 11.3315L14.494 11.3314L14.4772 11.3314L14.4605 11.3314L14.4437 11.3314L14.4269 11.3314L14.4101 11.3313L14.3933 11.3313L14.3766 11.3313L14.3598 11.3313L14.343 11.3313L14.3262 11.3312L14.3095 11.3312L14.2927 11.3312L14.2759 11.3312L14.2591 11.3312L14.2423 11.3311L14.2256 11.3311L14.2088 11.3311L14.192 11.3311L14.1752 11.3311L14.1584 11.331L14.1417 11.331L14.1249 11.331L14.1081 11.331L14.0913 11.331L14.0745 11.3309L14.0578 11.3309L14.041 11.3309L14.0242 11.3309L14.0074 11.3309L13.9906 11.3308L13.9739 11.3308L13.9571 11.3308L13.9403 11.3308L13.9235 11.3308L13.9068 11.3307L13.89 11.3307L13.8732 11.3307L13.8564 11.3307L13.8396 11.3307L13.8229 11.3306L13.8061 11.3306L13.7893 11.3306L13.7725 11.3306L13.7557 11.3306L13.739 11.3305L13.7222 11.3305L13.7054 11.3305L13.6886 11.3305L13.6718 11.3305L13.6551 11.3304L13.6383 11.3304L13.6215 11.3304L13.6047 11.3304L13.5879 11.3304L13.5712 11.3303L13.5544 11.3303L13.5376 11.3303L13.5208 11.3303L13.5041 11.3303L13.4873 11.3302L13.4705 11.3302L13.4537 11.3302L13.4369 11.3302L13.4202 11.3302L13.4034 11.3301L13.3866 11.3301L13.3698 11.3301L13.353 11.3301L13.3363 11.33L13.3195 11.33L13.3027 11.33L13.2859 11.33L13.2691 11.33L13.2524 11.3299L13.2356 11.3299L13.2188 11.3299L13.202 11.3299L13.1853 11.3299L13.1685 11.3298L13.1517 11.3298L13.1349 11.3298L13.1181 11.3298L13.1014 11.3298L13.0846 11.3297L13.0678 11.3297L13.051 11.3297L13.0342 11.3297L13.0175 11.3297L13.0007 11.3296L12.9839 11.3296L12.9671 11.3296L12.9503 11.3296L12.9336 11.3296L12.9168 11.3295L12.9 11.3295L12.8832 11.3295L12.8664 11.3295L12.8497 11.3295L12.8329 11.3294L12.8161 11.3294L12.7993 11.3294L12.7826 11.3294L12.7658 11.3294L12.749 11.3293L12.7322 11.3293L12.7154 11.3293L12.6987 11.3293L12.6819 11.3293L12.6651 11.3292L12.6483 11.3292L12.6315 11.3292L12.6148 11.3292L12.598 11.3292L12.5812 11.3291L12.5644 11.3291L12.5476 11.3291L12.5309 11.3291L12.5141 11.3291L12.4973 11.329L12.4805 11.329L12.4637 11.329L12.447 11.329L12.4302 11.329L12.4134 11.3289L12.3966 11.3289L12.3799 11.3289L12.3631 11.3289L12.3463 11.3289L12.3295 11.3288L12.3127 11.3288L12.296 11.3288L12.2792 11.3288L12.2624 11.3288L12.2456 11.3287L12.2288 11.3287L12.2121 11.3287L12.1953 11.3287L12.1785 11.3287L12.1617 11.3286L12.1449 11.3286L12.1282 11.3286L12.1114 11.3286L12.0946 11.3286L12.0778 11.3285L12.0611 11.3285L12.0443 11.3285L12.0275 11.3285L12.0107 11.3285L11.9939 11.3284L11.9772 11.3284L11.9604 11.3284L11.9436 11.3284L11.9268 11.3284L11.91 11.3283L11.8933 11.3283L11.8765 11.3283L11.8597 11.3283L11.8429 11.3283L11.8261 11.3282L11.8094 11.3282L11.7926 11.3282L11.7758 11.3282L11.759 11.3282L11.7422 11.3281L11.7255 11.3281L11.7087 11.3281L11.6919 11.3281L11.6751 11.3281L11.6583 11.328L11.6416 11.328L11.6248 11.328L11.608 11.328L11.5912 11.328L11.5745 11.3279L11.5577 11.3279L11.5409 11.3279L11.5241 11.3279L11.5073 11.3279L11.4906 11.3278L11.4738 11.3278L11.457 11.3278L11.4402 11.3278L11.4234 11.3278L11.4067 11.3277L11.3899 11.3277L11.3731 11.3277L11.3563 11.3277L11.3395 11.3277L11.3228 11.3276L11.306 11.3276L11.2892 11.3276L11.2724 11.3276L11.2557 11.3275L11.2389 11.3275L11.2221 11.3275L11.2053 11.3275L11.1885 11.3275L11.1718 11.3274L11.155 11.3274L11.1382 11.3274L11.1214 11.3274L11.1046 11.3274L11.0879 11.3273L11.0711 11.3273L11.0543 11.3273L11.0375 11.3273L11.0207 11.3273L11.004 11.3272L10.9872 11.3272L10.9704 11.3272L10.9536 11.3272L10.9368 11.3272L10.9201 11.3271L10.9033 11.3271L10.8865 11.3271L10.8697 11.3271L10.853 11.3271L10.8362 11.327L10.8194 11.327L10.8026 11.327L10.7858 11.327L10.7691 11.327L10.7523 11.3269L10.7355 11.3269L10.7187 11.3269L10.7019 11.3269L10.6852 11.3269L10.6684 11.3268L10.6516 11.3268L10.6348 11.3268L10.618 11.3268L10.6013 11.3268L10.5845 11.3267L10.5677 11.3267L10.5509 11.3267L10.5341 11.3267L10.5174 11.3267L10.5006 11.3266L10.4838 11.3266L10.467 11.3266L10.4503 11.3266L10.4335 11.3266L10.4167 11.3265L10.3999 11.3265L10.3831 11.3265L10.3664 11.3265L10.3496 11.3265L10.3328 11.3264L10.316 11.3264L10.2992 11.3264L10.2825 11.3264L10.2657 11.3264L10.2489 11.3263L10.2321 11.3263L10.2153 11.3263L10.1986 11.3263L10.1818 11.3263L10.165 11.3262L10.1482 11.3262L10.1315 11.3262L10.1147 11.3262L10.0979 11.3262L10.0811 11.3261L10.0643 11.3261L10.0476 11.3261L10.0308 11.3261L10.014 11.3261L9.99722 11.326L9.98044 11.326L9.96366 11.326L9.94688 11.326L9.9301 11.326L9.91332 11.3259L9.89654 11.3259L9.87977 11.3259L9.86299 11.3259L9.84621 11.3259L9.82943 11.3258L9.81265 11.3258L9.79587 11.3258L9.77909 11.3258L9.76231 11.3258L9.74553 11.3257L9.72875 11.3257L9.71197 11.3257L9.69519 11.3257L9.67841 11.3257L9.66163 11.3256L9.64486 11.3256L9.62808 11.3256L9.6113 11.3256L9.59452 11.3256L9.57774 11.3255L9.56096 11.3255L9.54418 11.3255L9.5274 11.3255L9.51062 11.3255L9.49384 11.3254L9.47706 11.3254L9.46029 11.3254L9.44351 11.3254L9.42673 11.3254L9.40995 11.3253L9.39317 11.3253L9.37639 11.3253L9.35961 11.3253L9.34283 11.3253L9.32605 11.3252L9.30927 11.3252L9.29249 11.3252L9.27572 11.3252L9.25894 11.3252L9.24216 11.3251L9.22538 11.3251L9.2086 11.3251L9.19182 11.3251L9.17504 11.325L9.15826 11.325L9.14148 11.325L9.1247 11.325L9.10792 11.325L9.09115 11.3249L9.07437 11.3249L9.05759 11.3249L9.04081 11.3249L9.02403 11.3249L9.00725 11.3248L8.99047 11.3248L8.97369 11.3248L8.95691 11.3248L8.94013 11.3248L8.92335 11.3247L8.90658 11.3247L8.8898 11.3247L8.87302 11.3247L8.85624 11.3247L8.83946 11.3246L8.82268 11.3246L8.8059 11.3246L8.78912 11.3246L8.77234 11.3246L8.75556 11.3245L8.73878 11.3245L8.722 11.3245L8.70523 11.3245L8.68845 11.3245L8.67167 11.3244L8.65489 11.3244L8.63811 11.3244L8.62133 11.3244L8.60455 11.3244L8.58777 11.3243L8.57099 11.3243L8.55421 11.3243L8.53743 11.3243L8.52066 11.3243L8.50388 11.3242L8.4871 11.3242L8.47032 11.3242L8.45354 11.3242L8.43676 11.3242L8.41998 11.3241L8.4032 11.3241L8.38642 11.3241L8.36964 11.3241L8.35286 11.3241L8.33608 11.324L8.31931 11.324L8.30253 11.324L8.28575 11.324L8.26897 11.324L8.25219 11.3239L8.23541 11.3239L8.21863 11.3239L8.20185 11.3239L8.18507 11.3239L8.16829 11.3238L8.15151 11.3238L8.13474 11.3238L8.11796 11.3238L8.10118 11.3238L8.0844 11.3237L8.06762 11.3237L8.05084 11.3237L8.03406 11.3237L8.01728 11.3237L8.0005 11.3236L7.99885 12.657L8.01563 12.657L8.03241 12.657L8.04919 12.657L8.06597 12.6571L8.08274 12.6571L8.09952 12.6571L8.1163 12.6571L8.13308 12.6571L8.14986 12.6572L8.16664 12.6572L8.18342 12.6572L8.2002 12.6572L8.21698 12.6572L8.23376 12.6573L8.25054 12.6573L8.26731 12.6573L8.28409 12.6573L8.30087 12.6573L8.31765 12.6574L8.33443 12.6574L8.35121 12.6574L8.36799 12.6574L8.38477 12.6574L8.40155 12.6575L8.41833 12.6575L8.43511 12.6575L8.45189 12.6575L8.46866 12.6575L8.48544 12.6576L8.50222 12.6576L8.519 12.6576L8.53578 12.6576L8.55256 12.6576L8.56934 12.6577L8.58612 12.6577L8.6029 12.6577L8.61968 12.6577L8.63646 12.6577L8.65323 12.6578L8.67001 12.6578L8.68679 12.6578L8.70357 12.6578L8.72035 12.6578L8.73713 12.6579L8.75391 12.6579L8.77069 12.6579L8.78747 12.6579L8.80425 12.6579L8.82103 12.658L8.83781 12.658L8.85458 12.658L8.87136 12.658L8.88814 12.658L8.90492 12.6581L8.9217 12.6581L8.93848 12.6581L8.95526 12.6581L8.97204 12.6581L8.98882 12.6582L9.0056 12.6582L9.02238 12.6582L9.03915 12.6582L9.05593 12.6582L9.07271 12.6583L9.08949 12.6583L9.10627 12.6583L9.12305 12.6583L9.13983 12.6583L9.15661 12.6584L9.17339 12.6584L9.19017 12.6584L9.20695 12.6584L9.22373 12.6584L9.2405 12.6585L9.25728 12.6585L9.27406 12.6585L9.29084 12.6585L9.30762 12.6585L9.3244 12.6586L9.34118 12.6586L9.35796 12.6586L9.37474 12.6586L9.39152 12.6586L9.4083 12.6587L9.42507 12.6587L9.44185 12.6587L9.45863 12.6587L9.47541 12.6587L9.49219 12.6588L9.50897 12.6588L9.52575 12.6588L9.54253 12.6588L9.55931 12.6588L9.57609 12.6589L9.59287 12.6589L9.60964 12.6589L9.62642 12.6589L9.6432 12.6589L9.65998 12.659L9.67676 12.659L9.69354 12.659L9.71032 12.659L9.7271 12.659L9.74388 12.6591L9.76066 12.6591L9.77744 12.6591L9.79421 12.6591L9.81099 12.6591L9.82777 12.6592L9.84455 12.6592L9.86133 12.6592L9.87811 12.6592L9.89489 12.6592L9.91167 12.6593L9.92845 12.6593L9.94523 12.6593L9.96201 12.6593L9.97879 12.6594L9.99556 12.6594L10.0123 12.6594L10.0291 12.6594L10.0459 12.6594L10.0627 12.6595L10.0795 12.6595L10.0962 12.6595L10.113 12.6595L10.1298 12.6595L10.1466 12.6596L10.1634 12.6596L10.1801 12.6596L10.1969 12.6596L10.2137 12.6596L10.2305 12.6597L10.2473 12.6597L10.264 12.6597L10.2808 12.6597L10.2976 12.6597L10.3144 12.6598L10.3311 12.6598L10.3479 12.6598L10.3647 12.6598L10.3815 12.6598L10.3983 12.6599L10.415 12.6599L10.4318 12.6599L10.4486 12.6599L10.4654 12.6599L10.4822 12.66L10.4989 12.66L10.5157 12.66L10.5325 12.66L10.5493 12.66L10.5661 12.6601L10.5828 12.6601L10.5996 12.6601L10.6164 12.6601L10.6332 12.6601L10.65 12.6602L10.6667 12.6602L10.6835 12.6602L10.7003 12.6602L10.7171 12.6602L10.7338 12.6603L10.7506 12.6603L10.7674 12.6603L10.7842 12.6603L10.801 12.6603L10.8177 12.6604L10.8345 12.6604L10.8513 12.6604L10.8681 12.6604L10.8849 12.6604L10.9016 12.6605L10.9184 12.6605L10.9352 12.6605L10.952 12.6605L10.9688 12.6605L10.9855 12.6606L11.0023 12.6606L11.0191 12.6606L11.0359 12.6606L11.0526 12.6606L11.0694 12.6607L11.0862 12.6607L11.103 12.6607L11.1198 12.6607L11.1365 12.6607L11.1533 12.6608L11.1701 12.6608L11.1869 12.6608L11.2037 12.6608L11.2204 12.6608L11.2372 12.6609L11.254 12.6609L11.2708 12.6609L11.2876 12.6609L11.3043 12.6609L11.3211 12.661L11.3379 12.661L11.3547 12.661L11.3715 12.661L11.3882 12.661L11.405 12.6611L11.4218 12.6611L11.4386 12.6611L11.4553 12.6611L11.4721 12.6611L11.4889 12.6612L11.5057 12.6612L11.5225 12.6612L11.5392 12.6612L11.556 12.6612L11.5728 12.6613L11.5896 12.6613L11.6064 12.6613L11.6231 12.6613L11.6399 12.6613L11.6567 12.6614L11.6735 12.6614L11.6903 12.6614L11.707 12.6614L11.7238 12.6614L11.7406 12.6615L11.7574 12.6615L11.7742 12.6615L11.7909 12.6615L11.8077 12.6615L11.8245 12.6616L11.8413 12.6616L11.858 12.6616L11.8748 12.6616L11.8916 12.6616L11.9084 12.6617L11.9252 12.6617L11.9419 12.6617L11.9587 12.6617L11.9755 12.6617L11.9923 12.6618L12.0091 12.6618L12.0258 12.6618L12.0426 12.6618L12.0594 12.6618L12.0762 12.6619L12.093 12.6619L12.1097 12.6619L12.1265 12.6619L12.1433 12.662L12.1601 12.662L12.1768 12.662L12.1936 12.662L12.2104 12.662L12.2272 12.6621L12.244 12.6621L12.2607 12.6621L12.2775 12.6621L12.2943 12.6621L12.3111 12.6622L12.3279 12.6622L12.3446 12.6622L12.3614 12.6622L12.3782 12.6622L12.395 12.6623L12.4118 12.6623L12.4285 12.6623L12.4453 12.6623L12.4621 12.6623L12.4789 12.6624L12.4957 12.6624L12.5124 12.6624L12.5292 12.6624L12.546 12.6624L12.5628 12.6625L12.5795 12.6625L12.5963 12.6625L12.6131 12.6625L12.6299 12.6625L12.6467 12.6626L12.6634 12.6626L12.6802 12.6626L12.697 12.6626L12.7138 12.6626L12.7306 12.6627L12.7473 12.6627L12.7641 12.6627L12.7809 12.6627L12.7977 12.6627L12.8145 12.6628L12.8312 12.6628L12.848 12.6628L12.8648 12.6628L12.8816 12.6628L12.8984 12.6629L12.9151 12.6629L12.9319 12.6629L12.9487 12.6629L12.9655 12.6629L12.9822 12.663L12.999 12.663L13.0158 12.663L13.0326 12.663L13.0494 12.663L13.0661 12.6631L13.0829 12.6631L13.0997 12.6631L13.1165 12.6631L13.1333 12.6631L13.15 12.6632L13.1668 12.6632L13.1836 12.6632L13.2004 12.6632L13.2172 12.6632L13.2339 12.6633L13.2507 12.6633L13.2675 12.6633L13.2843 12.6633L13.3011 12.6633L13.3178 12.6634L13.3346 12.6634L13.3514 12.6634L13.3682 12.6634L13.3849 12.6634L13.4017 12.6635L13.4185 12.6635L13.4353 12.6635L13.4521 12.6635L13.4688 12.6635L13.4856 12.6636L13.5024 12.6636L13.5192 12.6636L13.536 12.6636L13.5527 12.6636L13.5695 12.6637L13.5863 12.6637L13.6031 12.6637L13.6199 12.6637L13.6366 12.6637L13.6534 12.6638L13.6702 12.6638L13.687 12.6638L13.7038 12.6638L13.7205 12.6638L13.7373 12.6639L13.7541 12.6639L13.7709 12.6639L13.7876 12.6639L13.8044 12.6639L13.8212 12.664L13.838 12.664L13.8548 12.664L13.8715 12.664L13.8883 12.664L13.9051 12.6641L13.9219 12.6641L13.9387 12.6641L13.9554 12.6641L13.9722 12.6641L13.989 12.6642L14.0058 12.6642L14.0226 12.6642L14.0393 12.6642L14.0561 12.6642L14.0729 12.6643L14.0897 12.6643L14.1064 12.6643L14.1232 12.6643L14.14 12.6644L14.1568 12.6644L14.1736 12.6644L14.1903 12.6644L14.2071 12.6644L14.2239 12.6645L14.2407 12.6645L14.2575 12.6645L14.2742 12.6645L14.291 12.6645L14.3078 12.6646L14.3246 12.6646L14.3414 12.6646L14.3581 12.6646L14.3749 12.6646L14.3917 12.6647L14.4085 12.6647L14.4253 12.6647L14.442 12.6647L14.4588 12.6647L14.4756 12.6648L14.4924 12.6648L14.5091 12.6648L14.5259 12.6648L14.5427 12.6648L14.5595 12.6649L14.5763 12.6649L14.593 12.6649L14.6098 12.6649L14.6266 12.6649L14.6434 12.665L14.6602 12.665L14.6769 12.665L14.6937 12.665L14.7105 12.665L14.7273 12.6651L14.7441 12.6651L14.7608 12.6651L14.7776 12.6651L14.7944 12.6651L14.8112 12.6652L14.828 12.6652L14.8447 12.6652L14.8615 12.6652L14.8783 12.6652L14.8951 12.6653L14.9118 12.6653L14.9286 12.6653L14.9454 12.6653L14.9622 12.6653L14.979 12.6654L14.9957 12.6654L15.0125 12.6654L15.0293 12.6654L15.0461 12.6654L15.0629 12.6655L15.0796 12.6655L15.0964 12.6655L15.1132 12.6655L15.13 12.6655L15.1468 12.6656L15.1635 12.6656L15.1803 12.6656L15.1971 12.6656L15.2139 12.6656L15.2306 12.6657L15.2474 12.6657L15.2642 12.6657L15.281 12.6657L15.2978 12.6657L15.3145 12.6658L15.3313 12.6658L15.3481 12.6658L15.3649 12.6658L15.3817 12.6658L15.3984 12.6659L15.4152 12.6659L15.432 12.6659L15.4488 12.6659L15.4656 12.6659L15.4823 12.666L15.4991 12.666L15.5159 12.666L15.5327 12.666L15.5495 12.666L15.5662 12.6661L15.583 12.6661L15.5998 12.6661L15.6166 12.6661L15.6333 12.6661L15.6501 12.6662L15.6669 12.6662L15.6837 12.6662L15.7005 12.6662L15.7172 12.6662L15.734 12.6663L15.7508 12.6663L15.7676 12.6663L15.7844 12.6663L15.8011 12.6663L15.8179 12.6664L15.8347 12.6664L15.8515 12.6664L15.8683 12.6664L15.885 12.6664L15.9018 12.6665L15.9186 12.6665L15.9354 12.6665L15.9522 12.6665L15.9689 12.6665L15.9857 12.6666L16.0025 12.6666L16.0193 12.6666L16.036 12.6666L16.0528 12.6666L16.0696 12.6667L16.0864 12.6667L16.1032 12.6667L16.1199 12.6667L16.1367 12.6667L16.1535 12.6668L16.1703 12.6668L16.1871 12.6668L16.2038 12.6668L16.2206 12.6669L16.2374 12.6669L16.2542 12.6669L16.271 12.6669L16.2836 12.6669L12.458 16.7581C12.2065 17.0271 12.2065 17.4631 12.458 17.732C12.7095 18.001 13.1172 18.001 13.3687 17.732L18.2822 12.4772C18.5337 12.2083 18.5337 11.7723 18.2822 11.5033L13.3687 6.24853Z",fill:"white"})),gYe=_.forwardRef(mYe),vYe=(t,e)=>_.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:e,...t},_.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M18.2139 2.44646L12 3.99992H5.4375C4.64359 3.99992 4 4.64352 4 5.43742V18.5624C4 19.3563 4.64359 19.9999 5.4375 19.9999H12L18.2139 21.5534C19.1211 21.7802 20 21.094 20 20.1588V3.84104C20 2.90584 19.1211 2.21964 18.2139 2.44646ZM12 17.9999V5.99992H6V17.9999H12Z",fill:"white"})),yYe=_.forwardRef(vYe),bYe="_userButton_t5z8t_15",_Ye={userButton:bYe},SYe=({preventNavigation:t,isAuthenticated:e,isPasswordlessUser:n,userId:r,displayName:i,avatarUrl:s,onAction:o})=>{const{t:a}=et(),c=vs(),l=_.useMemo(()=>{const m=[];return e&&(m.push({key:"user",icon:YW,label:i,dataTestid:"usermenu_user"}),m.push({key:"settings",icon:pYe,label:a("common.settings")}),n&&!t&&m.push({key:"login",label:a("action.sign_in"),icon:gYe,dataTestid:"usermenu_login"}),!n&&!t&&m.push({key:"logout",label:a("action.sign_out"),icon:yYe,dataTestid:"usermenu_logout"})),m},[e,n,i,t,a]),[d,h]=_.useState(!1);return e?S.jsx(C8,{title:a("a11y.user_menu"),showTitle:!1,align:"end",open:d,onOpenChange:h,trigger:S.jsx("button",{"aria-label":a("common.profile"),className:_Ye.userButton,"data-testid":"usermenu_open",children:e&&(!n||s)?S.jsx(dm,{id:r,name:i,size:um.SM,src:s}):S.jsx(YW,{})}),children:l.map(({key:m,icon:g,label:y,dataTestid:v})=>S.jsx($p,{Icon:g,label:y,"data-testid":v,onSelect:()=>o(m)},m))}):S.jsx(Z8,{to:{pathname:"/login"},state:{from:c},children:a("log_in")})},UD=({preventNavigation:t=!1})=>{const e=vs(),n=Fl(),{client:r,logout:i,authenticated:s,passwordlessUser:o}=S9(),{displayName:a,avatarUrl:c}=hS(r),[l,d]=_.useState(!1),h=_.useCallback(()=>d(!1),[d]),[m,g]=_.useState(DD),y=_.useCallback(E=>{switch(E){case"user":g("profile"),d(!0);break;case"settings":g("audio"),d(!0);break;case"logout":i?.();break;case"login":n("/login",{state:{from:e}})?.catch(w=>N.error("Failed to navigate to login",w));break}},[n,e,i,d]),v=r?.getUserIdLocalpart()??"";return S.jsxs(S.Fragment,{children:[S.jsx(SYe,{preventNavigation:t,isAuthenticated:s,isPasswordlessUser:o,avatarUrl:c,onAction:y,userId:r?.getUserId()??"",displayName:a||(v?v.replace("@",""):"")}),r&&S.jsx(ND,{client:r,open:l,onDismiss:h,tab:m,onTabChange:g})]})};function wYe(t){return new Worker(""+new URL("IndexedDBWorker-Dgn5IQFp.js",import.meta.url).href,{type:"module",name:t?.name})}const Ife=new Gn;function EYe(t){const e=u_(Ife,t,_.useCallback(()=>localStorage.getItem(t),[t])),n=_.useCallback(r=>xfe(t,r),[t]);return[e,n]}const xfe=(t,e)=>{localStorage.setItem(t,e),Ife.emit(t)};function Afe(t,e){localStorage.getItem(E_(t))!==e&&xfe(E_(t),e)}const E_=t=>`room-shared-key-${t}`,CYe=(t,e)=>{const[n,r]=EYe(E_(t));return _.useEffect(()=>{e&&r(e)},[e,r]),[e??n,r]};function Lfe(t){const{roomId:e,password:n}=ur();return t!==e&&N.warn("requested key for a roomId which is not the current call room id (from the URL)",t,e),n??localStorage.getItem(E_(t))}function g4(t){const{client:e}=gm(),[n]=CYe(E_(t),Lfe(t)??void 0),r=e?.getRoom(t);return _.useMemo(()=>r?n?{kind:qn.SHARED_KEY,secret:n}:r.hasEncryptionStateEvent()?{kind:qn.PER_PARTICIPANT}:{kind:qn.NONE}:{kind:qn.NONE},[r,n])}const XW=!1,TYe="element-call-sync";async function RYe(t){let e=!!await t.store.getSavedSyncToken();return new Promise((n,r)=>{const i=(s,o,a)=>{s==="PREPARED"?e?e=!1:(t.removeListener(Pe.Sync,i),n()):s==="ERROR"&&(t.removeListener(Pe.Sync,i),r(a?.error))};t.on(Pe.Sync,i)})}async function Mfe(t,e){let n;try{n=window.indexedDB}catch(a){N.warn("Could not get indexDB from window.",a)}const r={fallbackICEServerAllowed:XW,isVoipWithNoMediaAllowed:yn.get().features?.feature_group_calls_without_video_and_audio};n&&localStorage?r.store=new OQ({indexedDB:window.indexedDB,localStorage,dbName:TYe,workerFactory:()=>new wYe}):localStorage&&(r.store=new Fb({localStorage}));const{e2eEnabled:i}=ur();i||N.info("Disabling E2E: group call signalling will NOT be encrypted.");const s=LT({...r,...t,useAuthorizationHeader:!0,localTimeoutMs:5e3,useE2eForGroupCall:i,fallbackICEServerAllowed:XW});e||await s.clearStores();try{await s.store.startup()}catch(a){N.error("Error starting matrix client indexDB store. Falling back to memory store.",a),s.store=new Fb({localStorage}),await s.store.startup()}try{await s.initRustCrypto()}catch(a){N.warn(a,"Make sure to clear client stores before initializing the rust crypto.")}const o=RYe(s);return await s.startClient({clientWellKnownPollPeriod:600}),await o,s}function SS(t){return t.trim().replace(/\s/g,"-").replace(/[^\w-]/g,"").toLowerCase()}function kYe(t,e){return`#${SS(t)}:${e.getDomain()}`}function Ofe(t){const e=t.split(":",2);if(e.length===2&&e[0][0]==="#"){if(e[1]===yn.defaultServerName())return e[0];throw new Error("Unsupported remote room alias")}return t}async function Pfe(t,e,n){N.log("Creating room for group call");const r=t.createRoom({visibility:JJ.Private,preset:CT.PublicChat,name:e,room_alias_name:n?void 0:SS(e),power_level_content_override:{invite:100,kick:100,ban:100,redact:50,state_default:0,events_default:0,users_default:0,events:{"m.room.power_levels":100,"m.room.history_visibility":100,"m.room.tombstone":100,"m.room.encryption":100,"m.room.name":50,"m.room.message":0,"m.room.encrypted":50,"m.sticker":50,"org.matrix.msc3401.call.member":0},users:{[t.getUserId()]:100}}}),i=await new Promise((o,a)=>{r.catch(d=>{a(d),l()});const c=d=>{r.then(h=>{d.roomId===h.room_id&&(o(d.roomId),l())},h=>{N.error("Failed to wait for the room to arrive",h)})},l=()=>{t.off(Pe.Room,c)};t.on(Pe.Room,c)});let s;return n==qn.SHARED_KEY&&(s=zJ(16),Afe(i,s)),{roomId:i,alias:n?void 0:kYe(e,t),password:s}}function Dfe(t,e,n,r){return`${window.location.protocol}//${window.location.host}${v4(t,e,n)}`}function v4(t,e,n,r){return`/room/#${n?"/"+SS(n):""}?${z$e(t,e).toString()}`}async function IYe(t){let e=0;for(;;)try{return await t()}catch(n){e++;const r=nP(n,e,!0);if(r<0)throw n;await Yp(r)}}const jD=t=>{const[e,n]=_.useState(void 0),[r,i]=_.useState(void 0),s=_.useRef(void 0);s.current||(s.current=LT({baseUrl:yn.defaultHomeserverUrl()})),_.useEffect(()=>{Et||s.current.registerRequest({}).catch(a=>{n(a.data?.params["m.login.terms"]?.policies?.privacy_policy?.en?.url),i(a.data?.params["m.login.recaptcha"]?.public_key)})},[]);const o=_.useCallback(async(a,c,l,d,h)=>{const m=new wP({matrixClient:s.current,doRequest:async x=>s.current.registerRequest({username:a,password:c,auth:x||void 0}),stateUpdated:(x,C)=>{if(C.error)throw new Error(C.error);x==="m.login.terms"?m.submitAuthDict({type:"m.login.terms"}).catch(k=>{N.error(k)}):x==="m.login.recaptcha"&&m.submitAuthDict({type:"m.login.recaptcha",response:d}).catch(k=>{N.error(k)})},requestEmailToken:async()=>Promise.resolve({sid:"dummy"})}),{user_id:g,access_token:y,device_id:v}=await m.attemptAuth();await t?.logout(!0);const E=await Mfe({baseUrl:yn.defaultHomeserverUrl(),accessToken:y,userId:g,deviceId:v},!1);await E.setDisplayName(l);const w={user_id:g,device_id:v,access_token:y,passwordlessUser:h};h&&(w.tempPassword=c);const R=E.getUser(E.getUserId());return R.setRawDisplayName(l),R.setDisplayName(l),[E,w]},[t]);return{privacyPolicyUrl:e,recaptchaKey:r,register:o}},xYe="_buttons_1arp2_8",AYe={buttons:xYe},Nfe=({onJoin:t,open:e,onDismiss:n})=>{const{t:r}=et();return S.jsxs(mm,{title:r("join_existing_call_modal.title"),open:e,onDismiss:n,children:[S.jsx("p",{children:r("join_existing_call_modal.text")}),S.jsxs(Nt,{rightAlign:!0,className:AYe.buttons,children:[S.jsx(qt,{onClick:n,children:r("action.no")}),S.jsx(qt,{onClick:t,"data-testid":"home_joinExistingRoom",children:r("join_existing_call_modal.join_button")})]})]})},JW="https://www.recaptcha.net/recaptcha/api.js?onload=mxOnRecaptchaLoaded&render=explicit";function FD(t){const{t:e}=et(),[n]=_.useState(()=>Qo(16)),r=_.useRef(void 0);_.useEffect(()=>{if(!t)return;const o=()=>{document.getElementById(n)&&window.grecaptcha.render(n,{sitekey:t,size:"invisible",callback:a=>r.current?.resolve(a),"error-callback":()=>r.current?.reject(new Error)})};if(typeof window.grecaptcha?.render=="function")o();else if(window.mxOnRecaptchaLoaded=o,!document.querySelector(`script[src="${JW}"]`)){const a=document.createElement("script");a.src=JW,a.async=!0,document.body.appendChild(a)}},[n,t]);const i=_.useCallback(async()=>t?window.grecaptcha?new Promise((o,a)=>{const c=new MutationObserver(d=>{for(const h of d)if(h.target?.style?.visibility!=="visible"){a(Iz("recaptcha_dismissed",e)),c.disconnect();return}});r.current={resolve:d=>{o(d),c.disconnect()},reject:d=>{a(d),c.disconnect()}},window.grecaptcha.execute().then(()=>{},d=>{N.error("Recaptcha execution failed",d)});const l=document.querySelector('iframe[src*="recaptcha/api2/bframe"]');l?.parentNode?.parentNode&&c.observe(l?.parentNode?.parentNode,{attributes:!0})}):(N.log("Recaptcha not loaded"),Promise.reject(Iz("recaptcha_not_loaded",e))):Promise.resolve(""),[t,e]),s=_.useCallback(()=>{window.grecaptcha?.reset()},[]);return{execute:i,reset:s,recaptchaId:n}}const LYe="_form_jcuzc_8",MYe={form:LYe},y4=({ref:t,children:e,className:n,onSubmit:r})=>S.jsx("form",{onSubmit:r,className:Le(MYe.form,n),ref:t,children:e});y4.displayName="Form";const OYe="_footer_106jg_8",PYe="_mobileLoginLink_106jg_19",DYe="_form_106jg_24",NYe="_notice_106jg_40",g1={footer:OYe,mobileLoginLink:PYe,form:DYe,notice:NYe},UYe="_container_dwllg_8",jYe="_main_dwllg_15",FYe="_logo_dwllg_23",Sv={container:UYe,main:jYe,logo:FYe},QW=t=>{t=1831565813+(t|=0)|0;let e=Math.imul(t^t>>>15,1|t);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296};class $Ye{constructor(e){this.dictionaries=void 0,this.length=void 0,this.separator=void 0,this.style=void 0,this.seed=void 0;const{length:n,separator:r,dictionaries:i,style:s,seed:o}=e;this.dictionaries=i,this.separator=r,this.length=n,this.style=s,this.seed=o}generate(){if(!this.dictionaries)throw new Error('Cannot find any dictionary. Please provide at least one, or leave the "dictionary" field empty in the config object');if(this.length<=0)throw new Error("Invalid length provided");if(this.length>this.dictionaries.length)throw new Error(`The length cannot be bigger than the number of dictionaries.
Length provided: ${this.length}. Number of dictionaries provided: ${this.dictionaries.length}`);let e=this.seed;return this.dictionaries.slice(0,this.length).reduce((n,r)=>{let i;e?(i=(o=>{if(typeof o=="string"){const a=o.split("").map(l=>l.charCodeAt(0)).reduce((l,d)=>l+d,1),c=Math.floor(Number(a));return QW(c)}return QW(o)})(e),e=4294967296*i):i=Math.random();let s=r[Math.floor(i*r.length)]||"";if(this.style==="lowerCase")s=s.toLowerCase();else if(this.style==="capital"){const[o,...a]=s.split("");s=o.toUpperCase()+a.join("")}else this.style==="upperCase"&&(s=s.toUpperCase());return n?`${n}${this.separator}${s}`:`${s}`},"")}}const ZW={separator:"_",dictionaries:[]},BYe=t=>{const e=[...t&&t.dictionaries||ZW.dictionaries],n={...ZW,...t,length:t&&t.length||e.length,dictionaries:e};if(!t||!t.dictionaries||!t.dictionaries.length)throw new Error('A "dictionaries" array must be provided. This is a breaking change introduced starting from Unique Name Generator v4. Read more about the breaking change here: https://github.com/andreasonny83/unique-names-generator#migration-guide');return new $Ye(n).generate()};var HYe=["able","above","absent","absolute","abstract","abundant","academic","acceptable","accepted","accessible","accurate","accused","active","actual","acute","added","additional","adequate","adjacent","administrative","adorable","advanced","adverse","advisory","aesthetic","afraid","aggregate","aggressive","agreeable","agreed","agricultural","alert","alive","alleged","allied","alone","alright","alternative","amateur","amazing","ambitious","amused","ancient","angry","annoyed","annual","anonymous","anxious","appalling","apparent","applicable","appropriate","arbitrary","architectural","armed","arrogant","artificial","artistic","ashamed","asleep","assistant","associated","atomic","attractive","automatic","autonomous","available","average","awake","aware","awful","awkward","back","bad","balanced","bare","basic","beautiful","beneficial","better","bewildered","big","binding","biological","bitter","bizarre","blank","blind","blonde","bloody","blushing","boiling","bold","bored","boring","bottom","brainy","brave","breakable","breezy","brief","bright","brilliant","broad","broken","bumpy","burning","busy","calm","capable","capitalist","careful","casual","causal","cautious","central","certain","changing","characteristic","charming","cheap","cheerful","chemical","chief","chilly","chosen","christian","chronic","chubby","circular","civic","civil","civilian","classic","classical","clean","clear","clever","clinical","close","closed","cloudy","clumsy","coastal","cognitive","coherent","cold","collective","colonial","colorful","colossal","coloured","colourful","combative","combined","comfortable","coming","commercial","common","communist","compact","comparable","comparative","compatible","competent","competitive","complete","complex","complicated","comprehensive","compulsory","conceptual","concerned","concrete","condemned","confident","confidential","confused","conscious","conservation","conservative","considerable","consistent","constant","constitutional","contemporary","content","continental","continued","continuing","continuous","controlled","controversial","convenient","conventional","convinced","convincing","cooing","cool","cooperative","corporate","correct","corresponding","costly","courageous","crazy","creative","creepy","criminal","critical","crooked","crowded","crucial","crude","cruel","cuddly","cultural","curious","curly","current","curved","cute","daily","damaged","damp","dangerous","dark","dead","deaf","deafening","dear","decent","decisive","deep","defeated","defensive","defiant","definite","deliberate","delicate","delicious","delighted","delightful","democratic","dependent","depressed","desirable","desperate","detailed","determined","developed","developing","devoted","different","difficult","digital","diplomatic","direct","dirty","disabled","disappointed","disastrous","disciplinary","disgusted","distant","distinct","distinctive","distinguished","disturbed","disturbing","diverse","divine","dizzy","domestic","dominant","double","doubtful","drab","dramatic","dreadful","driving","drunk","dry","dual","due","dull","dusty","dutch","dying","dynamic","eager","early","eastern","easy","economic","educational","eerie","effective","efficient","elaborate","elated","elderly","eldest","electoral","electric","electrical","electronic","elegant","eligible","embarrassed","embarrassing","emotional","empirical","empty","enchanting","encouraging","endless","energetic","enormous","enthusiastic","entire","entitled","envious","environmental","equal","equivalent","essential","established","estimated","ethical","ethnic","eventual","everyday","evident","evil","evolutionary","exact","excellent","exceptional","excess","excessive","excited","exciting","exclusive","existing","exotic","expected","expensive","experienced","experimental","explicit","extended","extensive","external","extra","extraordinary","extreme","exuberant","faint","fair","faithful","familiar","famous","fancy","fantastic","far","fascinating","fashionable","fast","fat","fatal","favourable","favourite","federal","fellow","female","feminist","few","fierce","filthy","final","financial","fine","firm","fiscal","fit","fixed","flaky","flat","flexible","fluffy","fluttering","flying","following","fond","foolish","foreign","formal","formidable","forthcoming","fortunate","forward","fragile","frail","frantic","free","frequent","fresh","friendly","frightened","front","frozen","full","fun","functional","fundamental","funny","furious","future","fuzzy","gastric","gay","general","generous","genetic","gentle","genuine","geographical","giant","gigantic","given","glad","glamorous","gleaming","global","glorious","golden","good","gorgeous","gothic","governing","graceful","gradual","grand","grateful","greasy","great","grieving","grim","gross","grotesque","growing","grubby","grumpy","guilty","handicapped","handsome","happy","hard","harsh","head","healthy","heavy","helpful","helpless","hidden","high","hilarious","hissing","historic","historical","hollow","holy","homeless","homely","hon","honest","horizontal","horrible","hostile","hot","huge","human","hungry","hurt","hushed","husky","icy","ideal","identical","ideological","ill","illegal","imaginative","immediate","immense","imperial","implicit","important","impossible","impressed","impressive","improved","inadequate","inappropriate","inc","inclined","increased","increasing","incredible","independent","indirect","individual","industrial","inevitable","influential","informal","inherent","initial","injured","inland","inner","innocent","innovative","inquisitive","instant","institutional","insufficient","intact","integral","integrated","intellectual","intelligent","intense","intensive","interested","interesting","interim","interior","intermediate","internal","international","intimate","invisible","involved","irrelevant","isolated","itchy","jealous","jittery","joint","jolly","joyous","judicial","juicy","junior","just","keen","key","kind","known","labour","large","late","latin","lazy","leading","left","legal","legislative","legitimate","lengthy","lesser","level","lexical","liable","liberal","light","like","likely","limited","linear","linguistic","liquid","literary","little","live","lively","living","local","logical","lonely","long","loose","lost","loud","lovely","low","loyal","ltd","lucky","mad","magic","magnetic","magnificent","main","major","male","mammoth","managerial","managing","manual","many","marginal","marine","marked","married","marvellous","marxist","mass","massive","mathematical","mature","maximum","mean","meaningful","mechanical","medical","medieval","melodic","melted","mental","mere","metropolitan","mid","middle","mighty","mild","military","miniature","minimal","minimum","ministerial","minor","miserable","misleading","missing","misty","mixed","moaning","mobile","moderate","modern","modest","molecular","monetary","monthly","moral","motionless","muddy","multiple","mushy","musical","mute","mutual","mysterious","naked","narrow","nasty","national","native","natural","naughty","naval","near","nearby","neat","necessary","negative","neighbouring","nervous","net","neutral","new","nice","noble","noisy","normal","northern","nosy","notable","novel","nuclear","numerous","nursing","nutritious","nutty","obedient","objective","obliged","obnoxious","obvious","occasional","occupational","odd","official","ok","okay","old","olympic","only","open","operational","opposite","optimistic","oral","ordinary","organic","organisational","original","orthodox","other","outdoor","outer","outrageous","outside","outstanding","overall","overseas","overwhelming","painful","pale","panicky","parallel","parental","parliamentary","partial","particular","passing","passive","past","patient","payable","peaceful","peculiar","perfect","permanent","persistent","personal","petite","philosophical","physical","plain","planned","plastic","pleasant","pleased","poised","polite","political","poor","popular","positive","possible","potential","powerful","practical","precious","precise","preferred","pregnant","preliminary","premier","prepared","present","presidential","pretty","previous","prickly","primary","prime","primitive","principal","printed","prior","private","probable","productive","professional","profitable","profound","progressive","prominent","promising","proper","proposed","prospective","protective","protestant","proud","provincial","psychiatric","psychological","public","puny","pure","purring","puzzled","quaint","qualified","quarrelsome","querulous","quick","quickest","quiet","quintessential","quixotic","racial","radical","rainy","random","rapid","rare","raspy","rational","ratty","raw","ready","real","realistic","rear","reasonable","recent","reduced","redundant","regional","registered","regular","regulatory","related","relative","relaxed","relevant","reliable","relieved","religious","reluctant","remaining","remarkable","remote","renewed","representative","repulsive","required","resident","residential","resonant","respectable","respective","responsible","resulting","retail","retired","revolutionary","rich","ridiculous","right","rigid","ripe","rising","rival","roasted","robust","rolling","romantic","rotten","rough","round","royal","rubber","rude","ruling","running","rural","sacred","sad","safe","salty","satisfactory","satisfied","scared","scary","scattered","scientific","scornful","scrawny","screeching","secondary","secret","secure","select","selected","selective","selfish","semantic","senior","sensible","sensitive","separate","serious","severe","sexual","shaggy","shaky","shallow","shared","sharp","sheer","shiny","shivering","shocked","short","shrill","shy","sick","significant","silent","silky","silly","similar","simple","single","skilled","skinny","sleepy","slight","slim","slimy","slippery","slow","small","smart","smiling","smoggy","smooth","social","socialist","soft","solar","sole","solid","sophisticated","sore","sorry","sound","sour","southern","soviet","spare","sparkling","spatial","special","specific","specified","spectacular","spicy","spiritual","splendid","spontaneous","sporting","spotless","spotty","square","squealing","stable","stale","standard","static","statistical","statutory","steady","steep","sticky","stiff","still","stingy","stormy","straight","straightforward","strange","strategic","strict","striking","striped","strong","structural","stuck","stupid","subjective","subsequent","substantial","subtle","successful","successive","sudden","sufficient","suitable","sunny","super","superb","superior","supporting","supposed","supreme","sure","surprised","surprising","surrounding","surviving","suspicious","sweet","swift","symbolic","sympathetic","systematic","tall","tame","tart","tasteless","tasty","technical","technological","teenage","temporary","tender","tense","terrible","territorial","testy","then","theoretical","thick","thin","thirsty","thorough","thoughtful","thoughtless","thundering","tight","tiny","tired","top","tory","total","tough","toxic","traditional","tragic","tremendous","tricky","tropical","troubled","typical","ugliest","ugly","ultimate","unable","unacceptable","unaware","uncertain","unchanged","uncomfortable","unconscious","underground","underlying","unemployed","uneven","unexpected","unfair","unfortunate","unhappy","uniform","uninterested","unique","united","universal","unknown","unlikely","unnecessary","unpleasant","unsightly","unusual","unwilling","upper","upset","uptight","urban","urgent","used","useful","useless","usual","vague","valid","valuable","variable","varied","various","varying","vast","verbal","vertical","very","vicarious","vicious","victorious","violent","visible","visiting","visual","vital","vitreous","vivacious","vivid","vocal","vocational","voiceless","voluminous","voluntary","vulnerable","wandering","warm","wasteful","watery","weak","wealthy","weary","wee","weekly","weird","welcome","well","western","wet","whispering","whole","wicked","wide","widespread","wild","wilful","willing","willowy","wily","wise","wispy","wittering","witty","wonderful","wooden","working","worldwide","worried","worrying","worthwhile","worthy","written","wrong","xenacious","xenial","xenogeneic","xenophobic","xeric","xerothermic","yabbering","yammering","yappiest","yappy","yawning","yearling","yearning","yeasty","yelling","yelping","yielding","yodelling","young","youngest","youthful","ytterbic","yucky","yummy","zany","zealous","zeroth","zestful","zesty","zippy","zonal","zoophagous","zygomorphic","zygotic"],qYe=["aardvark","aardwolf","albatross","alligator","alpaca","amphibian","anaconda","angelfish","anglerfish","ant","anteater","antelope","antlion","ape","aphid","armadillo","asp","baboon","badger","bandicoot","barnacle","barracuda","basilisk","bass","bat","bear","beaver","bedbug","bee","beetle","bird","bison","blackbird","boa","boar","bobcat","bobolink","bonobo","booby","bovid","bug","butterfly","buzzard","camel","canid","canidae","capybara","cardinal","caribou","carp","cat","caterpillar","catfish","catshark","cattle","centipede","cephalopod","chameleon","cheetah","chickadee","chicken","chimpanzee","chinchilla","chipmunk","cicada","clam","clownfish","cobra","cockroach","cod","condor","constrictor","coral","cougar","cow","coyote","crab","crane","crawdad","crayfish","cricket","crocodile","crow","cuckoo","damselfly","deer","dingo","dinosaur","dog","dolphin","donkey","dormouse","dove","dragon","dragonfly","duck","eagle","earthworm","earwig","echidna","eel","egret","elephant","elk","emu","ermine","falcon","felidae","ferret","finch","firefly","fish","flamingo","flea","fly","flyingfish","fowl","fox","frog","galliform","gamefowl","gayal","gazelle","gecko","gerbil","gibbon","giraffe","goat","goldfish","goose","gopher","gorilla","grasshopper","grouse","guan","guanaco","guineafowl","gull","guppy","haddock","halibut","hamster","hare","harrier","hawk","hedgehog","heron","herring","hippopotamus","hookworm","hornet","horse","hoverfly","hummingbird","hyena","iguana","impala","jackal","jaguar","jay","jellyfish","junglefowl","kangaroo","kingfisher","kite","kiwi","koala","koi","krill","ladybug","lamprey","landfowl","lark","leech","lemming","lemur","leopard","leopon","limpet","lion","lizard","llama","lobster","locust","loon","louse","lungfish","lynx","macaw","mackerel","magpie","mammal","manatee","mandrill","marlin","marmoset","marmot","marsupial","marten","mastodon","meadowlark","meerkat","mink","minnow","mite","mockingbird","mole","mollusk","mongoose","monkey","moose","mosquito","moth","mouse","mule","muskox","narwhal","newt","nightingale","ocelot","octopus","opossum","orangutan","orca","ostrich","otter","owl","ox","panda","panther","parakeet","parrot","parrotfish","partridge","peacock","peafowl","pelican","penguin","perch","pheasant","pig","pigeon","pike","pinniped","piranha","planarian","platypus","pony","porcupine","porpoise","possum","prawn","primate","ptarmigan","puffin","puma","python","quail","quelea","quokka","rabbit","raccoon","rat","rattlesnake","raven","reindeer","reptile","rhinoceros","roadrunner","rodent","rook","rooster","roundworm","sailfish","salamander","salmon","sawfish","scallop","scorpion","seahorse","shark","sheep","shrew","shrimp","silkworm","silverfish","skink","skunk","sloth","slug","smelt","snail","snake","snipe","sole","sparrow","spider","spoonbill","squid","squirrel","starfish","stingray","stoat","stork","sturgeon","swallow","swan","swift","swordfish","swordtail","tahr","takin","tapir","tarantula","tarsier","termite","tern","thrush","tick","tiger","tiglon","toad","tortoise","toucan","trout","tuna","turkey","turtle","tyrannosaurus","unicorn","urial","vicuna","viper","vole","vulture","wallaby","walrus","warbler","wasp","weasel","whale","whippet","whitefish","wildcat","wildebeest","wildfowl","wolf","wolverine","wombat","woodpecker","worm","wren","xerinae","yak","zebra"],VYe=["amaranth","amber","amethyst","apricot","aqua","aquamarine","azure","beige","black","blue","blush","bronze","brown","chocolate","coffee","copper","coral","crimson","cyan","emerald","fuchsia","gold","gray","green","harlequin","indigo","ivory","jade","lavender","lime","magenta","maroon","moccasin","olive","orange","peach","pink","plum","purple","red","rose","salmon","sapphire","scarlet","silver","tan","teal","tomato","turquoise","violet","white","yellow"];const KYe=["hydrogen","helium","lithium","beryllium","boron","carbon","nitrogen","oxygen","fluorine","neon","sodium","magnesium","aluminum","silicon","phosphorus","sulfur","chlorine","argon","potassium","calcium","scandium","titanium","vanadium","chromium","manganese","iron","cobalt","nickel","copper","zinc","gallium","germanium","arsenic","selenium","bromine","krypton","rubidium","strontium","yttrium","zirconium","niobium","molybdenum","technetium","ruthenium","rhodium","palladium","silver","cadmium","indium","tin","antimony","tellurium","iodine","xenon","cesium","barium","lanthanum","cerium","praseodymium","neodymium","promethium","samarium","europium","gadolinium","terbium","dysprosium","holmium","erbium","thulium","ytterbium","lutetium","hafnium","tantalum","wolfram","rhenium","osmium","iridium","platinum","gold","mercury","thallium","lead","bismuth","polonium","astatine","radon","francium","radium","actinium","thorium","protactinium","uranium","neptunium","plutonium","americium","curium","berkelium","californium","einsteinium","fermium","mendelevium","nobelium","lawrencium","rutherfordium","dubnium","seaborgium","bohrium","hassium","meitnerium","darmstadtium","roentgenium","copernicium","nihonium","flerovium","moscovium","livermorium","tennessine","oganesson"];function Ufe(){return BYe({dictionaries:[VYe,HYe,qYe,KYe],style:"lowerCase",length:3,separator:"-"})}const GYe=()=>{const{setClient:t}=gm(),{header:e}=nc(),[n,r]=_.useState(!1),[i,s]=_.useState(),[o]=NR(),{recaptchaKey:a,register:c}=jD(),{execute:l,reset:d,recaptchaId:h}=FD(a),[m,g]=_.useState(!1),y=_.useCallback(()=>g(!1),[g]),[v,E]=_.useState(),w=Fl(),{t:R}=et(),x=_.useCallback(C=>{C.preventDefault();const k=new FormData(C.target),T=Ofe(k.get("callName")),L=k.get("displayName");async function O(){s(void 0),r(!0);const P=await l(),D=Ufe(),[j,H]=await c(D,Qo(16),L,P,!0);let z;try{z=await Pfe(j,T,qn.SHARED_KEY)}catch(Y){if(!t)throw Y;if(Y.errcode==="M_ROOM_IN_USE"){E(()=>{t(j,H);const W=SS(T);w(`/${W}`)?.catch(F=>{N.error("Failed to navigate to alias localpart",F)})}),r(!1),g(!0);return}else throw Y}if(!t)throw new Error("setClient is undefined");if(!z.password)throw new Error("Failed to create room with shared secret");t(j,H),await w(v4(z.roomId,{kind:qn.SHARED_KEY,secret:z.password},T))}O().catch(P=>{N.error(P),r(!1),s(P),d()})},[c,d,l,w,g,t]);return S.jsxs(S.Fragment,{children:[S.jsxs("div",{className:Sv.container,children:[e==="standard"&&S.jsxs(gd,{children:[S.jsx(hh,{children:S.jsx(Bp,{})}),S.jsx(ph,{hideMobile:!0,children:S.jsx(UD,{})})]}),S.jsxs("main",{className:Sv.main,children:[S.jsx(Bp,{className:Sv.logo}),S.jsx(Hc,{size:"lg",weight:"semibold",children:R("start_new_call")}),S.jsxs(y4,{className:g1.form,onSubmit:x,children:[S.jsx(Nt,{children:S.jsx(er,{id:"callName",name:"callName",label:R("call_name"),placeholder:R("call_name"),type:"text",required:!0,autoComplete:"off","data-testid":"home_callName"})}),S.jsx(Nt,{children:S.jsx(er,{id:"displayName",name:"displayName",label:R("common.display_name"),placeholder:R("common.display_name"),type:"text",required:!0,"data-testid":"home_displayName",autoComplete:"off"})}),o===null&&S.jsx(an,{size:"sm",className:g1.notice,children:S.jsx(Zle,{})}),S.jsx(an,{size:"sm",className:g1.notice,children:S.jsxs(mo,{i18nKey:"unauthenticated_view_ssla_caption",children:['By clicking "Go", you agree to our'," ",S.jsx(Cp,{href:yn.get().ssla,children:"Software and Services License Agreement (SSLA)"})]})}),i&&S.jsx(Nt,{children:S.jsx(gh,{error:i})}),S.jsx(qt,{type:"submit",size:"lg",disabled:n,"data-testid":"home_go",children:R(n?"common.loading":"action.go")}),S.jsx("div",{id:h})]})]}),S.jsxs("footer",{className:g1.footer,children:[S.jsx(an,{className:g1.mobileLoginLink,children:S.jsx(Ll,{to:"/login","data-testid":"home_login",children:R("unauthenticated_view_login_button")})}),S.jsx(an,{children:S.jsxs(mo,{i18nKey:"unauthenticated_view_body",children:["Not registered yet?"," ",S.jsx(Ll,{to:"/register","data-testid":"home_register",children:"Create an account"})]})})]})]}),v&&S.jsx(Nfe,{onJoin:v,open:m,onDismiss:y})]})},Eg={};function eY(t,e){if(Eg[e.roomId])return Eg[e.roomId];if(!e||!e.timeline){const i=Number.MAX_SAFE_INTEGER;return Eg[e.roomId]=i,i}const n=t.getUserId();if(e.getMyMembership()!==Ke.Join){const i=e.currentState.getStateEvents("m.room.member",n);if(i&&!Array.isArray(i)){const s=i.getTs();return Eg[e.roomId]=s,s}}for(let i=e.timeline.length-1;i>=0;--i){const o=e.timeline[i].getTs();if(o)return Eg[e.roomId]=o,o}const r=Number.MAX_SAFE_INTEGER;return Eg[e.roomId]=r,r}function zYe(t,e){return e.sort((n,r)=>eY(t,r)-eY(t,n))}const WYe=t=>{const e=Lfe(t.roomId);if(!t.hasEncryptionStateEvent()&&!e)return!1;switch(t.getJoinRule()){case xf.Public:return!0;case xf.Knock:switch(t.getMyMembership()){case Ke.Join:case Ke.Knock:return!0;case Ke.Invite:return t.getLiveTimeline().getState(Ue.FORWARDS)?.getStateEvents(ee.RoomMember,t.myUserId)?.getPrevContent().membership===xf.Knock;default:return!1}default:return t.getMyMembership()===Ke.Join}},YYe=t=>{const e=t.getMyMembership();if(e===Ke.Knock)return!0;if(e!==Ke.Join)return!1;const n=t.getLiveTimeline();if(n.getState(Ue.FORWARDS)?.events?.has(ee.GroupCallMemberPrefix))return!0;for(const r of t._unstable_getStickyEvents())if(r.getType()===ee.RTCMembership)return!0;return n.getEvents().some(r=>r.unstableStickyInfo&&r.getType()===ee.GroupCallMemberPrefix)};function XYe(t){const[e,n]=_.useState([]);return _.useEffect(()=>{function r(){const i=t.getRooms().filter(YYe).filter(WYe),o=zYe(t,i).map(a=>{const c=t.matrixRTC.getRoomSession(a);return{roomAlias:a.getCanonicalAlias()??void 0,roomName:a.name,avatarUrl:a.getMxcAvatarUrl(),room:a,session:c,participants:c.memberships.filter(l=>l.sender).map(l=>a.getMember(l.sender)).filter(l=>l)}});n(o)}return r(),t.matrixRTC.on(LC.SessionStarted,r),t.on(Me.MyMembership,r),()=>{t.matrixRTC.off(LC.SessionStarted,r),t.off(Me.MyMembership,r)}},[t]),e}const JYe="_form_1vjc2_8",QYe="_fieldRow_1vjc2_16",ZYe="_button_1vjc2_24",eXe="_notice_1vjc2_32",v1={form:JYe,fieldRow:QYe,button:ZYe,notice:eXe},tXe="_callTileSpacer_l4ywf_8",nXe="_callTile_l4ywf_8",rXe="_callTileLink_l4ywf_28",iXe="_callInfo_l4ywf_40",sXe="_callName_l4ywf_53",oXe="_callList_l4ywf_63",aXe="_disabled_l4ywf_74",Iu={callTileSpacer:tXe,callTile:nXe,callTileLink:rXe,callInfo:iXe,callName:sXe,callList:oXe,disabled:aXe},cXe=({rooms:t,client:e})=>S.jsx(S.Fragment,{children:S.jsxs("div",{className:Iu.callList,children:[t.map(({room:n,roomName:r,avatarUrl:i,participants:s})=>S.jsx(lXe,{client:e,name:r,avatarUrl:i,room:n,participants:s},n.roomId)),t.length>3&&S.jsxs(S.Fragment,{children:[S.jsx("div",{className:Iu.callTileSpacer}),S.jsx("div",{className:Iu.callTileSpacer})]})]})}),lXe=({name:t,avatarUrl:e,room:n,client:r})=>{const{t:i}=et(),s=g4(n.roomId),[o,a]=_.useState(!1),c=_.useCallback(d=>{d.stopPropagation(),d.preventDefault(),a(!0),r.leave(n.roomId).catch(()=>a(!1))},[n,r]),l=S.jsxs(S.Fragment,{children:[S.jsx(dm,{id:n.roomId,name:t,size:um.LG,src:e}),S.jsx("div",{className:Iu.callInfo,children:S.jsx(an,{weight:"semibold",className:Iu.callName,children:t})}),S.jsx(sR,{onClick:c,disabled:o,"aria-label":i("action.remove"),children:S.jsx(W_,{})})]});return S.jsx("div",{className:Iu.callTile,children:o?S.jsx("span",{className:Le(Iu.callTileLink,Iu.disabled),children:l}):S.jsx(HT,{to:v4(n.roomId,s,n.name),className:Iu.callTileLink,children:l})})},uXe=({client:t})=>{const{header:e}=nc(),[n,r]=_.useState(!1),[i,s]=_.useState(),[o]=NR(),a=Fl(),{t:c}=et(),[l,d]=_.useState(!1),h=_.useCallback(()=>d(!1),[d]),m=_.useCallback(w=>{w.preventDefault();const x=new FormData(w.target).get("callName"),C=typeof x=="string"?Ofe(x):"";async function k(){s(void 0),r(!0);const T=await Pfe(t,C,qn.SHARED_KEY);if(!T.password)throw new Error("Failed to create room with shared secret");await a(v4(T.roomId,{kind:qn.SHARED_KEY,secret:T.password},C))}k().catch(T=>{T.errcode==="M_ROOM_IN_USE"?(v(SS(C)),r(!1),s(void 0),d(!0)):(N.error(T),r(!1),s(T))})},[t,a,d]),g=XYe(t),[y,v]=_.useState(),E=_.useCallback(()=>{a(`/${y}`)?.catch(w=>{N.error("Failed to navigate to existing alias",w)})},[a,y]);return S.jsxs(S.Fragment,{children:[S.jsxs("div",{className:Sv.container,children:[e==="standard"&&S.jsxs(gd,{children:[S.jsx(hh,{children:S.jsx(Bp,{})}),S.jsx(ph,{children:S.jsx(UD,{})})]}),S.jsxs("main",{className:Sv.main,children:[S.jsx(Bp,{className:Sv.logo}),S.jsx(Hc,{size:"lg",weight:"semibold",children:c("start_new_call")}),S.jsxs(y4,{className:v1.form,onSubmit:m,children:[S.jsxs(Nt,{className:v1.fieldRow,children:[S.jsx(er,{id:"callName",name:"callName",label:c("call_name"),placeholder:c("call_name"),type:"text",required:!0,autoComplete:"off","data-testid":"home_callName"}),S.jsx(qt,{type:"submit",size:"lg",className:v1.button,disabled:n,"data-testid":"home_go",children:c(n?"common.loading":"action.go")})]}),o===null&&S.jsx(an,{size:"sm",className:v1.notice,children:S.jsx(Zle,{})}),i&&S.jsx(Nt,{className:v1.fieldRow,children:S.jsx(gh,{error:i})})]}),g.length>0&&S.jsx(cXe,{rooms:g,client:t})]})]}),S.jsx(Nfe,{onJoin:E,open:l,onDismiss:h})]})};function wS(t){_.useEffect(()=>{const e="Element Call";document.title=t?`${e} | ${t}`:e},[t])}const jfe=()=>{const{t}=et();wS(t("common.home"));const e=My();return e?e.state==="error"?S.jsx(h_,{widget:Et,error:e.error}):e.authenticated?S.jsx(uXe,{client:e.authenticated.client}):S.jsx(GYe,{}):S.jsx(AR,{})},dXe=(t,e)=>_.createElement("svg",{width:300,height:66,viewBox:"0 0 300 66",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:e,...t},_.createElement("circle",{cx:32.6901,cy:32.6904,r:23.496,fill:"white"}),_.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M32.6137 65.2274C50.6257 65.2274 65.2274 50.6257 65.2274 32.6137C65.2274 14.6016 50.6257 0 32.6137 0C14.6016 0 0 14.6016 0 32.6137C0 50.6257 14.6016 65.2274 32.6137 65.2274ZM26.6511 15.1961C26.6511 13.8796 27.7205 12.8124 29.0397 12.8124C37.9808 12.8124 45.2291 20.0456 45.2291 28.9681C45.2291 30.2846 44.1596 31.3518 42.8405 31.3518C41.5213 31.3518 40.4519 30.2846 40.4519 28.9681C40.4519 22.6785 35.3425 17.5797 29.0397 17.5797C27.7205 17.5797 26.6511 16.5125 26.6511 15.1961ZM52.4139 28.9683C52.4139 27.6518 51.3445 26.5846 50.0253 26.5846C48.7061 26.5846 47.6367 27.6518 47.6367 28.9683C47.6367 35.2579 42.5274 40.3567 36.2246 40.3567C34.9054 40.3567 33.836 41.4239 33.836 42.7404C33.836 44.0568 34.9054 45.124 36.2246 45.124C45.1657 45.124 52.4139 37.8909 52.4139 28.9683ZM38.6134 50.031C38.6134 51.3475 37.544 52.4146 36.2248 52.4146C27.2837 52.4146 20.0355 45.1815 20.0355 36.2589C20.0355 34.9425 21.1049 33.8753 22.4241 33.8753C23.7432 33.8753 24.8127 34.9425 24.8127 36.2589C24.8127 42.5486 29.922 47.6474 36.2248 47.6474C37.544 47.6474 38.6134 48.7146 38.6134 50.031ZM12.8113 36.2589C12.8113 37.5754 13.8808 38.6426 15.1999 38.6426C16.5191 38.6426 17.5885 37.5754 17.5885 36.2589C17.5885 29.9693 22.6979 24.8705 29.0007 24.8705C30.3198 24.8705 31.3893 23.8033 31.3893 22.4869C31.3893 21.1704 30.3198 20.1032 29.0007 20.1032C20.0595 20.1032 12.8113 27.3364 12.8113 36.2589Z",fill:"#0DBD8B"}),_.createElement("path",{d:"M114.73 36.9816H91.7256C91.9974 39.3888 92.871 41.3107 94.3464 42.7472C95.8217 44.1449 97.763 44.8438 100.17 44.8438C101.762 44.8438 103.199 44.4555 104.48 43.679C105.761 42.9025 106.674 41.8542 107.217 40.5341H114.206C113.274 43.6014 111.527 46.0862 108.964 47.9887C106.441 49.8523 103.451 50.7842 99.9955 50.7842C95.4917 50.7842 91.8421 49.2894 89.0466 46.2998C86.29 43.3102 84.9117 39.5247 84.9117 34.9432C84.9117 30.4783 86.3094 26.7316 89.1049 23.7032C91.9003 20.6747 95.5111 19.1605 99.9373 19.1605C104.363 19.1605 107.935 20.6553 110.653 23.6449C113.41 26.5957 114.788 30.323 114.788 34.8267L114.73 36.9816ZM99.9373 24.8097C97.763 24.8097 95.9576 25.4503 94.5211 26.7316C93.0845 28.0128 92.1915 29.7212 91.8421 31.8566H107.916C107.605 29.7212 106.751 28.0128 105.353 26.7316C103.956 25.4503 102.15 24.8097 99.9373 24.8097Z",fill:"white"}),_.createElement("path",{d:"M119.557 41.0583V6.40625H126.488V41.1748C126.488 42.7278 127.342 43.5043 129.05 43.5043L130.273 43.4461V50.0271C129.613 50.1435 128.914 50.2018 128.177 50.2018C125.187 50.2018 122.993 49.4447 121.596 47.9305C120.237 46.4163 119.557 44.1255 119.557 41.0583Z",fill:"white"}),_.createElement("path",{d:"M162.549 36.9816H139.545C139.817 39.3888 140.69 41.3107 142.166 42.7472C143.641 44.1449 145.582 44.8438 147.99 44.8438C149.582 44.8438 151.018 44.4555 152.299 43.679C153.581 42.9025 154.493 41.8542 155.037 40.5341H162.025C161.093 43.6014 159.346 46.0862 156.784 47.9887C154.26 49.8523 151.27 50.7842 147.815 50.7842C143.311 50.7842 139.662 49.2894 136.866 46.2998C134.109 43.3102 132.731 39.5247 132.731 34.9432C132.731 30.4783 134.129 26.7316 136.924 23.7032C139.72 20.6747 143.331 19.1605 147.757 19.1605C152.183 19.1605 155.755 20.6553 158.473 23.6449C161.229 26.5957 162.608 30.323 162.608 34.8267L162.549 36.9816ZM147.757 24.8097C145.582 24.8097 143.777 25.4503 142.341 26.7316C140.904 28.0128 140.011 29.7212 139.662 31.8566H155.735C155.425 29.7212 154.571 28.0128 153.173 26.7316C151.775 25.4503 149.97 24.8097 147.757 24.8097Z",fill:"white"}),_.createElement("path",{d:"M193.817 32.7302V50.0853H186.887V31.973C186.887 27.3916 184.984 25.1009 181.179 25.1009C179.122 25.1009 177.471 25.7609 176.229 27.081C175.025 28.4011 174.424 30.2065 174.424 32.4972V50.0853H167.493V19.8594H173.9V23.8779C174.637 22.519 175.763 21.393 177.277 20.5C178.792 19.607 180.675 19.1605 182.927 19.1605C187.12 19.1605 190.148 20.7524 192.012 23.9361C194.574 20.7524 197.991 19.1605 202.262 19.1605C205.795 19.1605 208.513 20.2671 210.415 22.4801C212.318 24.6544 213.269 27.5275 213.269 31.0995V50.0853H206.338V31.973C206.338 27.3916 204.436 25.1009 200.631 25.1009C198.535 25.1009 196.865 25.7803 195.623 27.1392C194.419 28.4593 193.817 30.323 193.817 32.7302Z",fill:"white"}),_.createElement("path",{d:"M247.735 36.9816H224.731C225.002 39.3888 225.876 41.3107 227.351 42.7472C228.827 44.1449 230.768 44.8438 233.175 44.8438C234.767 44.8438 236.204 44.4555 237.485 43.679C238.766 42.9025 239.678 41.8542 240.222 40.5341H247.211C246.279 43.6014 244.532 46.0862 241.969 47.9887C239.446 49.8523 236.456 50.7842 233 50.7842C228.497 50.7842 224.847 49.2894 222.052 46.2998C219.295 43.3102 217.917 39.5247 217.917 34.9432C217.917 30.4783 219.314 26.7316 222.11 23.7032C224.905 20.6747 228.516 19.1605 232.942 19.1605C237.368 19.1605 240.94 20.6553 243.658 23.6449C246.415 26.5957 247.793 30.323 247.793 34.8267L247.735 36.9816ZM232.942 24.8097C230.768 24.8097 228.963 25.4503 227.526 26.7316C226.089 28.0128 225.196 29.7212 224.847 31.8566H240.921C240.61 29.7212 239.756 28.0128 238.358 26.7316C236.961 25.4503 235.155 24.8097 232.942 24.8097Z",fill:"white"}),_.createElement("path",{d:"M259.085 19.8594V23.8779C259.784 22.5578 260.929 21.4513 262.521 20.5583C264.152 19.6264 266.113 19.1605 268.403 19.1605C271.975 19.1605 274.732 20.2477 276.673 22.4219C278.653 24.5961 279.643 27.4887 279.643 31.0995V50.0853H272.713V31.973C272.713 29.8376 272.208 28.1681 271.199 26.9645C270.228 25.7221 268.733 25.1009 266.714 25.1009C264.501 25.1009 262.754 25.7609 261.473 27.081C260.23 28.4011 259.609 30.2259 259.609 32.5554V50.0853H252.679V19.8594H259.085Z",fill:"white"}),_.createElement("path",{d:"M299.884 43.912V49.9106C299.029 50.1435 297.826 50.26 296.273 50.26C290.371 50.26 287.42 47.2898 287.42 41.3495V25.3921H282.82V19.8594H287.42V11.9972H294.351V19.8594H300V25.3921H294.351V40.6506C294.351 43.019 295.477 44.2032 297.729 44.2032L299.884 43.912Z",fill:"white"})),Ffe=_.forwardRef(dXe),fXe="_logo_1gx2r_8",hXe="_container_1gx2r_14",pXe="_content_1gx2r_22",mXe="_formContainer_1gx2r_30",gXe="_authLinks_1gx2r_62",bl={logo:fXe,container:hXe,content:pXe,formContainer:mXe,authLinks:gXe};function vXe(t){return _.useCallback(async(e,n,r)=>{const i=LT({baseUrl:e}),s=new wP({matrixClient:i,doRequest:async()=>i.login("m.login.password",{identifier:{type:"m.id.user",user:n},password:r}),stateUpdated:()=>{},requestEmailToken:async()=>Promise.resolve({sid:""})}),{user_id:o,access_token:a,device_id:c}=await s.attemptAuth(),l={user_id:o,access_token:a,device_id:c,passwordlessUser:!1};return await t?.logout(!0),[await Mfe({baseUrl:e,accessToken:a,userId:o,deviceId:c},!1),l]},[t])}const yXe=()=>{const{t}=et();wS(t("login_title"));const{client:e,setClient:n}=gm(),r=vXe(e),i=yn.defaultHomeserverUrl(),s=_.useRef(null),o=_.useRef(null),a=Fl(),c=vs(),[l,d]=_.useState(!1),[h,m]=_.useState(),g=_.useCallback(v=>{if(v.preventDefault(),d(!0),!i||!s.current||!o.current){m(Error("Login parameters are undefined")),d(!1);return}r(i,s.current.value,o.current.value).then(async([E,w])=>{if(!n)return;n(E,w);const R=c.state;R&&R.from?await a(R.from):await a("/"),en.instance.eventLogin.track()}).catch(E=>{m(E),d(!1)})},[r,c,a,i,n]);let y=yn.defaultServerName()?.slice(0,25);return y=y?.length!==yn.defaultServerName()?.length?y+"...":y,S.jsx(S.Fragment,{children:S.jsx("div",{className:bl.container,children:S.jsxs("div",{className:bl.content,children:[S.jsxs("div",{className:bl.formContainer,children:[S.jsx(Ffe,{width:"auto",height:"auto",className:bl.logo}),S.jsx("h2",{children:t("log_in")}),S.jsx("h4",{children:t("login_subheading")}),S.jsxs("form",{onSubmit:g,children:[S.jsx(Nt,{children:S.jsx(er,{type:"text",ref:s,placeholder:t("common.username"),label:t("common.username"),autoCorrect:"off",autoCapitalize:"none",prefix:"@",suffix:`:${y}`,"data-testid":"login_username"})}),S.jsx(Nt,{children:S.jsx(er,{type:"password",ref:o,placeholder:t("common.password"),label:t("common.password"),"data-testid":"login_password"})}),h&&S.jsx(Nt,{children:S.jsx(gh,{error:h})}),S.jsx(Nt,{children:S.jsx(qt,{type:"submit",disabled:l,"data-testid":"login_login",children:t(l?"logging_in":"login_title")})})]})]}),S.jsxs("div",{className:bl.authLinks,children:[S.jsx("p",{children:t("login_auth_links_prompt")}),S.jsx("p",{children:S.jsxs(mo,{i18nKey:"login_auth_links",children:[S.jsx(Ll,{to:"/register",children:"Create an account"})," Or ",S.jsx(Ll,{to:"/",children:"Access as a guest"})]})})]})]})})})},bXe=()=>{const{t}=et();wS(t("action.register"));const{loading:e,authenticated:n,passwordlessUser:r,client:i,setClient:s}=S9(),o=_.useRef(null),a=Fl(),c=vs(),[l,d]=_.useState(!1),[h,m]=_.useState(),[g,y]=_.useState(""),[v,E]=_.useState(""),{recaptchaKey:w,register:R}=jD(i),{execute:x,reset:C,recaptchaId:k}=FD(w),T=_.useCallback(L=>{L.preventDefault();const O=new FormData(L.target),P=O.get("userName"),D=O.get("password"),j=O.get("passwordConfirmation");if(D!==j)return;(async()=>{d(!0);const z=await x(),[Y,W]=await R(P,D,P,z,r);if(i&&i?.groupCallEventHandler&&r)for(const F of i.groupCallEventHandler.groupCalls.values()){const $=F.room.roomId;try{await Y.joinRoom($)}catch(V){V.errcode==="M_LIMIT_EXCEEDED"?(await Yp(V.data.retry_after_ms),await Y.joinRoom($)):(JT(V),N.error(`Couldn't join room ${$}`,V))}}s?.(Y,W),en.instance.eventSignup.cacheSignupEnd(new Date)})().then(async()=>{c.state?.from?await a(c.state?.from):await a("/")}).catch(z=>{m(z),d(!1),C()})},[R,c,a,r,C,x,i,s]);return _.useEffect(()=>{g&&v&&g!==v?o.current?.setCustomValidity(t("register.passwords_must_match")):o.current?.setCustomValidity("")},[g,v,t]),_.useEffect(()=>{!e&&n&&!r&&!l&&a("/")?.catch(L=>{N.error("Failed to navigate to /",L)})},[e,a,n,r,l]),e?S.jsx(AR,{}):(en.instance.eventSignup.cacheSignupStart(new Date),S.jsx(S.Fragment,{children:S.jsx("div",{className:bl.container,children:S.jsxs("div",{className:bl.content,children:[S.jsxs("div",{className:bl.formContainer,children:[S.jsx(Ffe,{width:"auto",height:"auto",className:bl.logo}),S.jsx("h2",{children:t("register_heading")}),S.jsxs("form",{onSubmit:T,children:[S.jsx(Nt,{children:S.jsx(er,{type:"text",name:"userName",placeholder:t("common.username"),label:t("common.username"),autoCorrect:"off",autoCapitalize:"none",prefix:"@",suffix:`:${yn.defaultServerName()}`,"data-testid":"register_username"})}),S.jsx(Nt,{children:S.jsx(er,{required:!0,name:"password",type:"password",onChange:L=>y(L.target.value),value:g,placeholder:t("common.password"),label:t("common.password"),"data-testid":"register_password"})}),S.jsx(Nt,{children:S.jsx(er,{required:!0,type:"password",name:"passwordConfirmation",onChange:L=>E(L.target.value),value:v,placeholder:t("register_confirm_password_label"),label:t("register_confirm_password_label"),ref:o,"data-testid":"register_confirm_password"})}),S.jsx(an,{size:"sm",children:S.jsxs(mo,{i18nKey:"recaptcha_ssla_caption",children:["This site is protected by ReCAPTCHA and the Google"," ",S.jsx(Cp,{href:"https://www.google.com/policies/privacy/",children:"Privacy Policy"})," ","and"," ",S.jsx(Cp,{href:"https://policies.google.com/terms",children:"Terms of Service"})," ","apply.",S.jsx("br",{}),'By clicking "Register", you agree to our'," ",S.jsx(Cp,{href:yn.get().ssla,children:"Software and Services License Agreement (SSLA)"})]})}),h&&S.jsx(Nt,{children:S.jsx(gh,{error:h})}),S.jsx(Nt,{children:S.jsx(qt,{type:"submit",disabled:l,"data-testid":"register_register",children:t(l?"register.registering":"action.register")})}),S.jsx("div",{id:k})]})]}),S.jsx("div",{className:bl.authLinks,children:S.jsxs(mo,{i18nKey:"register_auth_links",children:[S.jsx("p",{children:"Already have an account?"}),S.jsxs("p",{children:[S.jsx(Ll,{to:"/login",children:"Log in"})," Or ",S.jsx(Ll,{to:"/",children:"Access as a guest"})]})]})})]})})}))},_Xe="_form_1wfyo_8",SXe="_headline_1wfyo_18",wXe="_container_1wfyo_37",EXe="_main_1wfyo_45",CXe="_footer_1wfyo_62",y1={form:_Xe,headline:SXe,container:wXe,main:EXe,footer:CXe};function $fe(){const{setClient:t}=gm(),{privacyPolicyUrl:e,recaptchaKey:n,register:r}=jD(),{execute:i,reset:s,recaptchaId:o}=FD(n),a=_.useCallback(async c=>{if(!t)throw new Error("No client context");if(Et)throw new Error("Registration was skipped: We should never try to register password-less user in embedded mode.");try{const l=await i(),d=Ufe(),[h,m]=await r(d,Qo(16),c,l,!0);t(h,m)}catch(l){throw s(),l}},[i,s,r,t]);return{privacyPolicyUrl:e,registerPasswordlessUser:a,recaptchaId:o}}const TXe=()=>{const{header:t}=nc(),[e,n]=_.useState(!1),[r,i]=_.useState(),{registerPasswordlessUser:s,recaptchaId:o}=$fe(),a=_.useCallback(d=>{d.preventDefault(),n(!0);const m=new FormData(d.target).get("displayName");s(typeof m=="string"?m:"").catch(y=>{N.error("Failed to register passwordless user",d),n(!1),i(y)})},[s]),{t:c}=et(),l=vs();return S.jsxs(S.Fragment,{children:[t==="standard"&&S.jsxs(gd,{children:[S.jsx(hh,{children:S.jsx(Bp,{})}),S.jsx(ph,{children:S.jsx(UD,{preventNavigation:!0})})]}),S.jsxs("div",{className:y1.container,children:[S.jsxs("main",{className:y1.main,children:[S.jsx(Hc,{size:"xl",weight:"semibold",className:y1.headline,children:c("lobby.join_as_guest")}),S.jsxs(y4,{className:y1.form,onSubmit:a,children:[S.jsx(Nt,{children:S.jsx(er,{id:"displayName",name:"displayName",label:c("common.display_name"),placeholder:c("common.display_name"),"data-testid":"joincall_displayName",type:"text",required:!0,autoComplete:"off"})}),S.jsx(an,{size:"sm",children:S.jsxs(mo,{i18nKey:"room_auth_view_ssla_caption",children:['By clicking "Join call now", you agree to our'," ",S.jsx(Cp,{href:yn.get().ssla,children:"Software and Services License Agreement (SSLA)"})]})}),r&&S.jsx(Nt,{children:S.jsx(gh,{error:r})}),S.jsx(qt,{type:"submit",size:"lg",disabled:e,"data-testid":"joincall_joincall",children:c(e?"common.loading":"room_auth_view_continue_button")}),S.jsx("div",{id:o})]})]}),S.jsx(an,{className:y1.footer,children:S.jsxs(mo,{i18nKey:"unauthenticated_view_body",children:["Not registered yet?"," ",S.jsx(Ll,{to:"/register",state:{from:l},children:"Create an account"})]})})]})]})};var Xw=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Bfe(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var CO={exports:{}},RXe=CO.exports,tY;function kXe(){return tY||(tY=1,(function(t){(function(e,n){t.exports?t.exports=n():e.log=n()})(RXe,function(){var e=function(){},n="undefined",r=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"],s={},o=null;function a(v,E){var w=v[E];if(typeof w.bind=="function")return w.bind(v);try{return Function.prototype.bind.call(w,v)}catch{return function(){return Function.prototype.apply.apply(w,[v,arguments])}}}function c(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function l(v){return v==="debug"&&(v="log"),typeof console===n?!1:v==="trace"&&r?c:console[v]!==void 0?a(console,v):console.log!==void 0?a(console,"log"):e}function d(){for(var v=this.getLevel(),E=0;E<i.length;E++){var w=i[E];this[w]=E<v?e:this.methodFactory(w,v,this.name)}if(this.log=this.debug,typeof console===n&&v<this.levels.SILENT)return"No console available for logging"}function h(v){return function(){typeof console!==n&&(d.call(this),this[v].apply(this,arguments))}}function m(v,E,w){return l(v)||h.apply(this,arguments)}function g(v,E){var w=this,R,x,C,k="loglevel";typeof v=="string"?k+=":"+v:typeof v=="symbol"&&(k=void 0);function T(j){var H=(i[j]||"silent").toUpperCase();if(!(typeof window===n||!k)){try{window.localStorage[k]=H;return}catch{}try{window.document.cookie=encodeURIComponent(k)+"="+H+";"}catch{}}}function L(){var j;if(!(typeof window===n||!k)){try{j=window.localStorage[k]}catch{}if(typeof j===n)try{var H=window.document.cookie,z=encodeURIComponent(k),Y=H.indexOf(z+"=");Y!==-1&&(j=/^([^;]+)/.exec(H.slice(Y+z.length+1))[1])}catch{}return w.levels[j]===void 0&&(j=void 0),j}}function O(){if(!(typeof window===n||!k)){try{window.localStorage.removeItem(k)}catch{}try{window.document.cookie=encodeURIComponent(k)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function P(j){var H=j;if(typeof H=="string"&&w.levels[H.toUpperCase()]!==void 0&&(H=w.levels[H.toUpperCase()]),typeof H=="number"&&H>=0&&H<=w.levels.SILENT)return H;throw new TypeError("log.setLevel() called with invalid level: "+j)}w.name=v,w.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},w.methodFactory=E||m,w.getLevel=function(){return C??x??R},w.setLevel=function(j,H){return C=P(j),H!==!1&&T(C),d.call(w)},w.setDefaultLevel=function(j){x=P(j),L()||w.setLevel(j,!1)},w.resetLevel=function(){C=null,O(),d.call(w)},w.enableAll=function(j){w.setLevel(w.levels.TRACE,j)},w.disableAll=function(j){w.setLevel(w.levels.SILENT,j)},w.rebuild=function(){if(o!==w&&(R=P(o.getLevel())),d.call(w),o===w)for(var j in s)s[j].rebuild()},R=P(o?o.getLevel():"WARN");var D=L();D!=null&&(C=P(D)),d.call(w)}o=new g,o.getLogger=function(v){if(typeof v!="symbol"&&typeof v!="string"||v==="")throw new TypeError("You must supply a name when creating a logger.");var E=s[v];return E||(E=s[v]=new g(v,o.methodFactory)),E};var y=typeof window!==n?window.log:void 0;return o.noConflict=function(){return typeof window!==n&&window.log===o&&(window.log=y),o},o.getLoggers=function(){return s},o.default=o,o})})(CO)),CO.exports}var IXe=kXe();const xXe=Bfe(IXe);var TO=function(t,e){return TO=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},TO(t,e)};function Sd(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");TO(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}function AXe(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(d){try{l(r.next(d))}catch(h){o(h)}}function c(d){try{l(r.throw(d))}catch(h){o(h)}}function l(d){d.done?s(d.value):i(d.value).then(a,c)}l((r=r.apply(t,[])).next())})}function Hfe(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(d){return c([l,d])}}function c(l){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(n=0)),n;)try{if(r=1,i&&(s=l[0]&2?i.return:l[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,l[1])).done)return s;switch(i=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return n.label++,{value:l[1],done:!1};case 5:n.label++,i=l[1],l=[0];continue;case 7:l=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){n.label=l[1];break}if(l[0]===6&&n.label<s[1]){n.label=s[1],s=l;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(l);break}s[2]&&n.ops.pop(),n.trys.pop();continue}l=e.call(t,n)}catch(d){l=[6,d],i=0}finally{r=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function ay(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Z3(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s}function eT(t,e,n){if(arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))}function wv(t){return this instanceof wv?(this.v=t,this):new wv(t)}function LXe(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),i,s=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),i[Symbol.asyncIterator]=function(){return this},i;function o(g){return function(y){return Promise.resolve(y).then(g,h)}}function a(g,y){r[g]&&(i[g]=function(v){return new Promise(function(E,w){s.push([g,v,E,w])>1||c(g,v)})},y&&(i[g]=y(i[g])))}function c(g,y){try{l(r[g](y))}catch(v){m(s[0][3],v)}}function l(g){g.value instanceof wv?Promise.resolve(g.value.v).then(d,h):m(s[0][2],g)}function d(g){c("next",g)}function h(g){c("throw",g)}function m(g,y){g(y),s.shift(),s.length&&c(s[0][0],s[0][1])}}function MXe(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof ay=="function"?ay(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(s){n[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(l){s({value:l,done:a})},o)}}function _i(t){return typeof t=="function"}function $D(t){var e=function(r){Error.call(r),r.stack=new Error().stack},n=t(e);return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}var g5=$D(function(t){return function(e){t(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(n,r){return r+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e}});function tT(t,e){if(t){var n=t.indexOf(e);0<=n&&t.splice(n,1)}}var ES=(function(){function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var e,n,r,i,s;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var a=ay(o),c=a.next();!c.done;c=a.next()){var l=c.value;l.remove(this)}}catch(v){e={error:v}}finally{try{c&&!c.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}else o.remove(this);var d=this.initialTeardown;if(_i(d))try{d()}catch(v){s=v instanceof g5?v.errors:[v]}var h=this._finalizers;if(h){this._finalizers=null;try{for(var m=ay(h),g=m.next();!g.done;g=m.next()){var y=g.value;try{nY(y)}catch(v){s=s??[],v instanceof g5?s=eT(eT([],Z3(s)),Z3(v.errors)):s.push(v)}}}catch(v){r={error:v}}finally{try{g&&!g.done&&(i=m.return)&&i.call(m)}finally{if(r)throw r.error}}}if(s)throw new g5(s)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)nY(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(n=this._finalizers)!==null&&n!==void 0?n:[]).push(e)}},t.prototype._hasParent=function(e){var n=this._parentage;return n===e||Array.isArray(n)&&n.includes(e)},t.prototype._addParent=function(e){var n=this._parentage;this._parentage=Array.isArray(n)?(n.push(e),n):n?[n,e]:e},t.prototype._removeParent=function(e){var n=this._parentage;n===e?this._parentage=null:Array.isArray(n)&&tT(n,e)},t.prototype.remove=function(e){var n=this._finalizers;n&&tT(n,e),e instanceof t&&e._removeParent(this)},t.EMPTY=(function(){var e=new t;return e.closed=!0,e})(),t})(),qfe=ES.EMPTY;function Vfe(t){return t instanceof ES||t&&"closed"in t&&_i(t.remove)&&_i(t.add)&&_i(t.unsubscribe)}function nY(t){_i(t)?t():t.unsubscribe()}var OXe={Promise:void 0},PXe={setTimeout:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setTimeout.apply(void 0,eT([t,e],Z3(n)))},clearTimeout:function(t){return clearTimeout(t)},delegate:void 0};function Kfe(t){PXe.setTimeout(function(){throw t})}function rY(){}function fC(t){t()}var BD=(function(t){Sd(e,t);function e(n){var r=t.call(this)||this;return r.isStopped=!1,n?(r.destination=n,Vfe(n)&&n.add(r)):r.destination=UXe,r}return e.create=function(n,r,i){return new RO(n,r,i)},e.prototype.next=function(n){this.isStopped||this._next(n)},e.prototype.error=function(n){this.isStopped||(this.isStopped=!0,this._error(n))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(n){this.destination.next(n)},e.prototype._error=function(n){try{this.destination.error(n)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e})(ES),DXe=(function(){function t(e){this.partialObserver=e}return t.prototype.next=function(e){var n=this.partialObserver;if(n.next)try{n.next(e)}catch(r){Jw(r)}},t.prototype.error=function(e){var n=this.partialObserver;if(n.error)try{n.error(e)}catch(r){Jw(r)}else Jw(e)},t.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(n){Jw(n)}},t})(),RO=(function(t){Sd(e,t);function e(n,r,i){var s=t.call(this)||this,o;return _i(n)||!n?o={next:n??void 0,error:r??void 0,complete:i??void 0}:o=n,s.destination=new DXe(o),s}return e})(BD);function Jw(t){Kfe(t)}function NXe(t){throw t}var UXe={closed:!0,next:rY,error:NXe,complete:rY},HD=(function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"})();function Gfe(t){return t}function jXe(t){return t.length===0?Gfe:t.length===1?t[0]:function(e){return t.reduce(function(n,r){return r(n)},e)}}var oa=(function(){function t(e){e&&(this._subscribe=e)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(e,n,r){var i=this,s=$Xe(e)?e:new RO(e,n,r);return fC(function(){var o=i,a=o.operator,c=o.source;s.add(a?a.call(s,c):c?i._subscribe(s):i._trySubscribe(s))}),s},t.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(n){e.error(n)}},t.prototype.forEach=function(e,n){var r=this;return n=iY(n),new n(function(i,s){var o=new RO({next:function(a){try{e(a)}catch(c){s(c),o.unsubscribe()}},error:s,complete:i});r.subscribe(o)})},t.prototype._subscribe=function(e){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(e)},t.prototype[HD]=function(){return this},t.prototype.pipe=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return jXe(e)(this)},t.prototype.toPromise=function(e){var n=this;return e=iY(e),new e(function(r,i){var s;n.subscribe(function(o){return s=o},function(o){return i(o)},function(){return r(s)})})},t.create=function(e){return new t(e)},t})();function iY(t){var e;return(e=t??OXe.Promise)!==null&&e!==void 0?e:Promise}function FXe(t){return t&&_i(t.next)&&_i(t.error)&&_i(t.complete)}function $Xe(t){return t&&t instanceof BD||FXe(t)&&Vfe(t)}function BXe(t){return _i(t?.lift)}function CS(t){return function(e){if(BXe(e))return e.lift(function(n){try{return t(n,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function nT(t,e,n,r,i){return new HXe(t,e,n,r,i)}var HXe=(function(t){Sd(e,t);function e(n,r,i,s,o,a){var c=t.call(this,n)||this;return c.onFinalize=o,c.shouldUnsubscribe=a,c._next=r?function(l){try{r(l)}catch(d){n.error(d)}}:t.prototype._next,c._error=s?function(l){try{s(l)}catch(d){n.error(d)}finally{this.unsubscribe()}}:t.prototype._error,c._complete=i?function(){try{i()}catch(l){n.error(l)}finally{this.unsubscribe()}}:t.prototype._complete,c}return e.prototype.unsubscribe=function(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;t.prototype.unsubscribe.call(this),!r&&((n=this.onFinalize)===null||n===void 0||n.call(this))}},e})(BD),qXe=$D(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),zfe=(function(t){Sd(e,t);function e(){var n=t.call(this)||this;return n.closed=!1,n.currentObservers=null,n.observers=[],n.isStopped=!1,n.hasError=!1,n.thrownError=null,n}return e.prototype.lift=function(n){var r=new sY(this,this);return r.operator=n,r},e.prototype._throwIfClosed=function(){if(this.closed)throw new qXe},e.prototype.next=function(n){var r=this;fC(function(){var i,s;if(r._throwIfClosed(),!r.isStopped){r.currentObservers||(r.currentObservers=Array.from(r.observers));try{for(var o=ay(r.currentObservers),a=o.next();!a.done;a=o.next()){var c=a.value;c.next(n)}}catch(l){i={error:l}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}}})},e.prototype.error=function(n){var r=this;fC(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=n;for(var i=r.observers;i.length;)i.shift().error(n)}})},e.prototype.complete=function(){var n=this;fC(function(){if(n._throwIfClosed(),!n.isStopped){n.isStopped=!0;for(var r=n.observers;r.length;)r.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var n;return((n=this.observers)===null||n===void 0?void 0:n.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(n){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,n)},e.prototype._subscribe=function(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)},e.prototype._innerSubscribe=function(n){var r=this,i=this,s=i.hasError,o=i.isStopped,a=i.observers;return s||o?qfe:(this.currentObservers=null,a.push(n),new ES(function(){r.currentObservers=null,tT(a,n)}))},e.prototype._checkFinalizedStatuses=function(n){var r=this,i=r.hasError,s=r.thrownError,o=r.isStopped;i?n.error(s):o&&n.complete()},e.prototype.asObservable=function(){var n=new oa;return n.source=this,n},e.create=function(n,r){return new sY(n,r)},e})(oa),sY=(function(t){Sd(e,t);function e(n,r){var i=t.call(this)||this;return i.destination=n,i.source=r,i}return e.prototype.next=function(n){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.next)===null||i===void 0||i.call(r,n)},e.prototype.error=function(n){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.error)===null||i===void 0||i.call(r,n)},e.prototype.complete=function(){var n,r;(r=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||r===void 0||r.call(n)},e.prototype._subscribe=function(n){var r,i;return(i=(r=this.source)===null||r===void 0?void 0:r.subscribe(n))!==null&&i!==void 0?i:qfe},e})(zfe);(function(t){Sd(e,t);function e(n){var r=t.call(this)||this;return r._value=n,r}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(n){var r=t.prototype._subscribe.call(this,n);return!r.closed&&n.next(this._value),r},e.prototype.getValue=function(){var n=this,r=n.hasError,i=n.thrownError,s=n._value;if(r)throw i;return this._throwIfClosed(),s},e.prototype.next=function(n){t.prototype.next.call(this,this._value=n)},e})(zfe);var VXe={now:function(){return Date.now()}},KXe=(function(t){Sd(e,t);function e(n,r){return t.call(this)||this}return e.prototype.schedule=function(n,r){return this},e})(ES),oY={setInterval:function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return setInterval.apply(void 0,eT([t,e],Z3(n)))},clearInterval:function(t){return clearInterval(t)},delegate:void 0},GXe=(function(t){Sd(e,t);function e(n,r){var i=t.call(this,n,r)||this;return i.scheduler=n,i.work=r,i.pending=!1,i}return e.prototype.schedule=function(n,r){var i;if(r===void 0&&(r=0),this.closed)return this;this.state=n;var s=this.id,o=this.scheduler;return s!=null&&(this.id=this.recycleAsyncId(o,s,r)),this.pending=!0,this.delay=r,this.id=(i=this.id)!==null&&i!==void 0?i:this.requestAsyncId(o,this.id,r),this},e.prototype.requestAsyncId=function(n,r,i){return i===void 0&&(i=0),oY.setInterval(n.flush.bind(n,this),i)},e.prototype.recycleAsyncId=function(n,r,i){if(i===void 0&&(i=0),i!=null&&this.delay===i&&this.pending===!1)return r;r!=null&&oY.clearInterval(r)},e.prototype.execute=function(n,r){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(n,r);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(n,r){var i=!1,s;try{this.work(n)}catch(o){i=!0,s=o||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),s},e.prototype.unsubscribe=function(){if(!this.closed){var n=this,r=n.id,i=n.scheduler,s=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,tT(s,this),r!=null&&(this.id=this.recycleAsyncId(i,r,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e})(KXe),aY=(function(){function t(e,n){n===void 0&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(e,n,r){return n===void 0&&(n=0),new this.schedulerActionCtor(this,e).schedule(r,n)},t.now=VXe.now,t})(),zXe=(function(t){Sd(e,t);function e(n,r){r===void 0&&(r=aY.now);var i=t.call(this,n,r)||this;return i.actions=[],i._active=!1,i}return e.prototype.flush=function(n){var r=this.actions;if(this._active){r.push(n);return}var i;this._active=!0;do if(i=n.execute(n.state,n.delay))break;while(n=r.shift());if(this._active=!1,i){for(;n=r.shift();)n.unsubscribe();throw i}},e})(aY);new zXe(GXe);function WXe(t){return t&&_i(t.schedule)}function YXe(t){return t[t.length-1]}function Wfe(t){return WXe(YXe(t))?t.pop():void 0}var Yfe=(function(t){return t&&typeof t.length=="number"&&typeof t!="function"});function Xfe(t){return _i(t?.then)}function Jfe(t){return _i(t[HD])}function Qfe(t){return Symbol.asyncIterator&&_i(t?.[Symbol.asyncIterator])}function Zfe(t){return new TypeError("You provided "+(t!==null&&typeof t=="object"?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function XXe(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var ehe=XXe();function the(t){return _i(t?.[ehe])}function nhe(t){return LXe(this,arguments,function(){var e,n,r,i;return Hfe(this,function(s){switch(s.label){case 0:e=t.getReader(),s.label=1;case 1:s.trys.push([1,,9,10]),s.label=2;case 2:return[4,wv(e.read())];case 3:return n=s.sent(),r=n.value,i=n.done,i?[4,wv(void 0)]:[3,5];case 4:return[2,s.sent()];case 5:return[4,wv(r)];case 6:return[4,s.sent()];case 7:return s.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}})})}function rhe(t){return _i(t?.getReader)}function TS(t){if(t instanceof oa)return t;if(t!=null){if(Jfe(t))return JXe(t);if(Yfe(t))return QXe(t);if(Xfe(t))return ZXe(t);if(Qfe(t))return ihe(t);if(the(t))return eJe(t);if(rhe(t))return tJe(t)}throw Zfe(t)}function JXe(t){return new oa(function(e){var n=t[HD]();if(_i(n.subscribe))return n.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function QXe(t){return new oa(function(e){for(var n=0;n<t.length&&!e.closed;n++)e.next(t[n]);e.complete()})}function ZXe(t){return new oa(function(e){t.then(function(n){e.closed||(e.next(n),e.complete())},function(n){return e.error(n)}).then(null,Kfe)})}function eJe(t){return new oa(function(e){var n,r;try{for(var i=ay(t),s=i.next();!s.done;s=i.next()){var o=s.value;if(e.next(o),e.closed)return}}catch(a){n={error:a}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}e.complete()})}function ihe(t){return new oa(function(e){nJe(t,e).catch(function(n){return e.error(n)})})}function tJe(t){return ihe(nhe(t))}function nJe(t,e){var n,r,i,s;return AXe(this,void 0,void 0,function(){var o,a;return Hfe(this,function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),n=MXe(t),c.label=1;case 1:return[4,n.next()];case 2:if(r=c.sent(),!!r.done)return[3,4];if(o=r.value,e.next(o),e.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),i={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),r&&!r.done&&(s=n.return)?[4,s.call(n)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function kp(t,e,n,r,i){r===void 0&&(r=0),i===void 0&&(i=!1);var s=e.schedule(function(){n(),i?t.add(this.schedule(null,r)):this.unsubscribe()},r);if(t.add(s),!i)return s}function she(t,e){return e===void 0&&(e=0),CS(function(n,r){n.subscribe(nT(r,function(i){return kp(r,t,function(){return r.next(i)},e)},function(){return kp(r,t,function(){return r.complete()},e)},function(i){return kp(r,t,function(){return r.error(i)},e)}))})}function ohe(t,e){return e===void 0&&(e=0),CS(function(n,r){r.add(t.schedule(function(){return n.subscribe(r)},e))})}function rJe(t,e){return TS(t).pipe(ohe(e),she(e))}function iJe(t,e){return TS(t).pipe(ohe(e),she(e))}function sJe(t,e){return new oa(function(n){var r=0;return e.schedule(function(){r===t.length?n.complete():(n.next(t[r++]),n.closed||this.schedule())})})}function oJe(t,e){return new oa(function(n){var r;return kp(n,e,function(){r=t[ehe](),kp(n,e,function(){var i,s,o;try{i=r.next(),s=i.value,o=i.done}catch(a){n.error(a);return}o?n.complete():n.next(s)},0,!0)}),function(){return _i(r?.return)&&r.return()}})}function ahe(t,e){if(!t)throw new Error("Iterable cannot be null");return new oa(function(n){kp(n,e,function(){var r=t[Symbol.asyncIterator]();kp(n,e,function(){r.next().then(function(i){i.done?n.complete():n.next(i.value)})},0,!0)})})}function aJe(t,e){return ahe(nhe(t),e)}function cJe(t,e){if(t!=null){if(Jfe(t))return rJe(t,e);if(Yfe(t))return sJe(t,e);if(Xfe(t))return iJe(t,e);if(Qfe(t))return ahe(t,e);if(the(t))return oJe(t,e);if(rhe(t))return aJe(t,e)}throw Zfe(t)}function lJe(t,e){return e?cJe(t,e):TS(t)}$D(function(t){return function(e){e===void 0&&(e=null),t(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=e}});function b4(t,e){return CS(function(n,r){var i=0;n.subscribe(nT(r,function(s){r.next(t.call(e,s,i++))}))})}function uJe(t,e,n,r,i,s,o,a){var c=[],l=0,d=0,h=!1,m=function(){h&&!c.length&&!l&&e.complete()},g=function(v){return l<r?y(v):c.push(v)},y=function(v){l++;var E=!1;TS(n(v,d++)).subscribe(nT(e,function(w){e.next(w)},function(){E=!0},void 0,function(){if(E)try{l--;for(var w=function(){var R=c.shift();o||y(R)};c.length&&l<r;)w();m()}catch(R){e.error(R)}}))};return t.subscribe(nT(e,g,function(){h=!0,m()})),function(){}}function che(t,e,n){return n===void 0&&(n=1/0),_i(e)?che(function(r,i){return b4(function(s,o){return e(r,s,i,o)})(TS(t(r,i)))},n):(typeof e=="number"&&(n=e),CS(function(r,i){return uJe(r,i,t,n)}))}function dJe(t){return che(Gfe,t)}function fJe(){return dJe(1)}function cY(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return fJe()(lJe(t,Wfe(t)))}function _4(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Wfe(t);return CS(function(r,i){(n?cY(t,r,n):cY(t,r)).subscribe(i)})}var hJe="lk";function lhe(t){return typeof t>"u"?!1:pJe(t)||mJe(t)}function pJe(t){var e;return t?t.hasOwnProperty("participant")&&t.hasOwnProperty("source")&&t.hasOwnProperty("track")&&typeof((e=t.publication)==null?void 0:e.track)<"u":!1}function mJe(t){return t?t.hasOwnProperty("participant")&&t.hasOwnProperty("source")&&t.hasOwnProperty("publication")&&typeof t.publication<"u":!1}var gJe=[he.ConnectionStateChanged,he.RoomMetadataChanged,he.ActiveSpeakersChanged,he.ConnectionQualityChanged,he.ParticipantConnected,he.ParticipantDisconnected,he.ParticipantPermissionsChanged,he.ParticipantMetadataChanged,he.ParticipantNameChanged,he.ParticipantAttributesChanged,he.TrackMuted,he.TrackUnmuted,he.TrackPublished,he.TrackUnpublished,he.TrackStreamStateChanged,he.TrackSubscriptionFailed,he.TrackSubscriptionPermissionChanged,he.TrackSubscriptionStatusChanged],vJe=[...gJe,he.LocalTrackPublished,he.LocalTrackUnpublished];ae.TrackPublished,ae.TrackUnpublished,ae.TrackMuted,ae.TrackUnmuted,ae.TrackStreamStateChanged,ae.TrackSubscribed,ae.TrackUnsubscribed,ae.TrackSubscriptionPermissionChanged,ae.TrackSubscriptionFailed,ae.LocalTrackPublished,ae.LocalTrackUnpublished;var yJe=[ae.ConnectionQualityChanged,ae.IsSpeakingChanged,ae.ParticipantMetadataChanged,ae.ParticipantPermissionsChanged,ae.TrackMuted,ae.TrackUnmuted,ae.TrackPublished,ae.TrackUnpublished,ae.TrackStreamStateChanged,ae.TrackSubscriptionFailed,ae.TrackSubscriptionPermissionChanged,ae.TrackSubscriptionStatusChanged];[...yJe,ae.LocalTrackPublished,ae.LocalTrackUnpublished];var sh=xXe.getLogger("lk-components-js");sh.setDefaultLevel("WARN");var uhe=(t=>(t.AgentState="lk.agent.state",t.PublishOnBehalf="lk.publish_on_behalf",t.TranscriptionFinal="lk.transcription_final",t.TranscriptionSegmentId="lk.segment_id",t.TranscribedTrackId="lk.transcribed_track_id",t))(uhe||{});function dhe(t){return typeof t=="object"}function fhe(t){return Array.isArray(t)&&t.filter(dhe).length>0}function bJe(t){return`${hJe}-${t}`}function _Je(t){const e=kO(t),n=EJe(t.participant).pipe(b4(()=>kO(t)),_4(e));return{className:bJe(t.source===pe.Source.Camera||t.source===pe.Source.ScreenShare?"participant-media-video":"participant-media-audio"),trackObserver:n}}function kO(t){if(lhe(t))return t.publication;{const{source:e,name:n,participant:r}=t;if(e&&n)return r.getTrackPublications().find(i=>i.source===e&&i.trackName===n);if(n)return r.getTrackPublicationByName(n);if(e)return r.getTrackPublication(e);throw new Error("At least one of source and name needs to be defined")}}function SJe(t,...e){return new oa(n=>{const r=()=>{n.next(t)};return e.forEach(i=>{t.on(i,r)}),()=>{e.forEach(i=>{t.off(i,r)})}}).pipe(_4(t))}function wJe(t,...e){return new oa(n=>{const r=()=>{n.next(t)};return e.forEach(i=>{t.on(i,r)}),()=>{e.forEach(i=>{t.off(i,r)})}}).pipe(_4(t))}function EJe(t){return wJe(t,ae.TrackMuted,ae.TrackUnmuted,ae.ParticipantPermissionsChanged,ae.TrackPublished,ae.TrackUnpublished,ae.LocalTrackPublished,ae.LocalTrackUnpublished,ae.MediaDevicesError,ae.TrackSubscriptionStatusChanged).pipe(b4(e=>{const{isMicrophoneEnabled:n,isCameraEnabled:r,isScreenShareEnabled:i}=e,s=e.getTrackPublication(pe.Source.Microphone),o=e.getTrackPublication(pe.Source.Camera);return{isCameraEnabled:r,isMicrophoneEnabled:n,isScreenShareEnabled:i,cameraTrack:o,microphoneTrack:s,participant:e}}))}function lY(t,e,n=!0){const r=[t.localParticipant,...Array.from(t.remoteParticipants.values())],i=[];return r.forEach(s=>{e.forEach(o=>{const a=Array.from(s.trackPublications.values()).filter(c=>c.source===o&&(!n||c.track)).map(c=>({participant:s,publication:c,source:c.source}));i.push(...a)})}),{trackReferences:i,participants:r}}function CJe(t,e,n){var r,i;const s=(r=n.additionalRoomEvents)!=null?r:vJe,o=(i=n.onlySubscribed)!=null?i:!0,a=Array.from(new Set([he.ParticipantConnected,he.ParticipantDisconnected,he.ConnectionStateChanged,he.LocalTrackPublished,he.LocalTrackUnpublished,he.TrackPublished,he.TrackUnpublished,he.TrackSubscriptionStatusChanged,...s]).values());return SJe(t,...a).pipe(b4(c=>{const l=lY(c,e,o);return sh.debug(`TrackReference[] was updated. (length ${l.trackReferences.length})`,l),l}),_4(lY(t,e,o)))}_.createContext(void 0);const TJe=_.createContext(void 0);function RJe(){return _.useContext(TJe)}function hhe(t){const e=RJe(),n=t??e;if(!n)throw new Error("No TrackRef, make sure you are inside a TrackRefContext or pass the TrackRef explicitly");return n}_.createContext(void 0);const kJe=_.createContext(void 0);function IJe(){return _.useContext(kJe)}function xJe(t){const e=IJe(),n=t??e;if(!n)throw new Error("No room provided, make sure you are inside a Room context or pass the room explicitly");return n}_.createContext(void 0);_.createContext(void 0);function phe(t){var e,n,r="";if(typeof t=="string"||typeof t=="number")r+=t;else if(typeof t=="object")if(Array.isArray(t)){var i=t.length;for(e=0;e<i;e++)t[e]&&(n=phe(t[e]))&&(r&&(r+=" "),r+=n)}else for(n in t)t[n]&&(r&&(r+=" "),r+=n);return r}function AJe(){for(var t,e,n=0,r="",i=arguments.length;n<i;n++)(t=arguments[n])&&(e=phe(t))&&(r&&(r+=" "),r+=e);return r}function LJe(...t){return(...e)=>{for(const n of t)if(typeof n=="function")try{n(...e)}catch(r){console.error(r)}}}function MJe(...t){const e={...t[0]};for(let n=1;n<t.length;n++){const r=t[n];for(const i in r){const s=e[i],o=r[i];typeof s=="function"&&typeof o=="function"&&i[0]==="o"&&i[1]==="n"&&i.charCodeAt(2)>=65&&i.charCodeAt(2)<=90?e[i]=LJe(s,o):(i==="className"||i==="UNSAFE_className")&&typeof s=="string"&&typeof o=="string"?e[i]=AJe(s,o):e[i]=o!==void 0?o:s}}return e}function OJe(t){return t!==void 0}function PJe(...t){return MJe(...t.filter(OJe))}function DJe(t,e){return t==="processor"&&e&&typeof e=="object"&&"name"in e?e.name:t==="e2ee"&&e?"e2ee-enabled":e}function NJe(t=[pe.Source.Camera,pe.Source.Microphone,pe.Source.ScreenShare,pe.Source.ScreenShareAudio,pe.Source.Unknown],e={}){const n=xJe(e.room),[r,i]=_.useState([]),[s,o]=_.useState([]),a=_.useMemo(()=>t.map(c=>dhe(c)?c.source:c),[JSON.stringify(t)]);return _.useEffect(()=>{const c=CJe(n,a,{additionalRoomEvents:e.updateOnlyOn,onlySubscribed:e.onlySubscribed}).subscribe(({trackReferences:l,participants:d})=>{sh.debug("setting track bundles",l,d),i(l),o(d)});return()=>c.unsubscribe()},[n,JSON.stringify(e.onlySubscribed),JSON.stringify(e.updateOnlyOn),JSON.stringify(t)]),_.useMemo(()=>{if(fhe(t)){const c=jJe(t,s),l=Array.from(r);return s.forEach(d=>{c.has(d.identity)&&(c.get(d.identity)??[]).forEach(h=>{if(r.find(({participant:g,publication:y})=>d.identity===g.identity&&y.source===h))return;sh.debug(`Add ${h} placeholder for participant ${d.identity}.`);const m={participant:d,source:h};l.push(m)})}),l}else return r},[r,s,t])}function UJe(t,e){const n=new Set(t);for(const r of e)n.delete(r);return n}function jJe(t,e){const n=new Map;if(fhe(t)){const r=t.filter(i=>i.withPlaceholder).map(i=>i.source);e.forEach(i=>{const s=i.getTrackPublications().map(a=>{var c;return(c=a.track)==null?void 0:c.source}).filter(a=>a!==void 0),o=Array.from(UJe(new Set(r),new Set(s)));o.length>0&&n.set(i.identity,o)})}return n}uhe.AgentState;var Qw={exports:{}},uY;function FJe(){if(uY)return Qw.exports;uY=1;var t=typeof Reflect=="object"?Reflect:null,e=t&&typeof t.apply=="function"?t.apply:function(C,k,T){return Function.prototype.apply.call(C,k,T)},n;t&&typeof t.ownKeys=="function"?n=t.ownKeys:Object.getOwnPropertySymbols?n=function(C){return Object.getOwnPropertyNames(C).concat(Object.getOwnPropertySymbols(C))}:n=function(C){return Object.getOwnPropertyNames(C)};function r(C){console&&console.warn&&console.warn(C)}var i=Number.isNaN||function(C){return C!==C};function s(){s.init.call(this)}Qw.exports=s,Qw.exports.once=w,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function a(C){if(typeof C!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof C)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(C){if(typeof C!="number"||C<0||i(C))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+C+".");o=C}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(C){if(typeof C!="number"||C<0||i(C))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+C+".");return this._maxListeners=C,this};function c(C){return C._maxListeners===void 0?s.defaultMaxListeners:C._maxListeners}s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(C){for(var k=[],T=1;T<arguments.length;T++)k.push(arguments[T]);var L=C==="error",O=this._events;if(O!==void 0)L=L&&O.error===void 0;else if(!L)return!1;if(L){var P;if(k.length>0&&(P=k[0]),P instanceof Error)throw P;var D=new Error("Unhandled error."+(P?" ("+P.message+")":""));throw D.context=P,D}var j=O[C];if(j===void 0)return!1;if(typeof j=="function")e(j,this,k);else for(var H=j.length,z=y(j,H),T=0;T<H;++T)e(z[T],this,k);return!0};function l(C,k,T,L){var O,P,D;if(a(T),P=C._events,P===void 0?(P=C._events=Object.create(null),C._eventsCount=0):(P.newListener!==void 0&&(C.emit("newListener",k,T.listener?T.listener:T),P=C._events),D=P[k]),D===void 0)D=P[k]=T,++C._eventsCount;else if(typeof D=="function"?D=P[k]=L?[T,D]:[D,T]:L?D.unshift(T):D.push(T),O=c(C),O>0&&D.length>O&&!D.warned){D.warned=!0;var j=new Error("Possible EventEmitter memory leak detected. "+D.length+" "+String(k)+" listeners added. Use emitter.setMaxListeners() to increase limit");j.name="MaxListenersExceededWarning",j.emitter=C,j.type=k,j.count=D.length,r(j)}return C}s.prototype.addListener=function(C,k){return l(this,C,k,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(C,k){return l(this,C,k,!0)};function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(C,k,T){var L={fired:!1,wrapFn:void 0,target:C,type:k,listener:T},O=d.bind(L);return O.listener=T,L.wrapFn=O,O}s.prototype.once=function(C,k){return a(k),this.on(C,h(this,C,k)),this},s.prototype.prependOnceListener=function(C,k){return a(k),this.prependListener(C,h(this,C,k)),this},s.prototype.removeListener=function(C,k){var T,L,O,P,D;if(a(k),L=this._events,L===void 0)return this;if(T=L[C],T===void 0)return this;if(T===k||T.listener===k)--this._eventsCount===0?this._events=Object.create(null):(delete L[C],L.removeListener&&this.emit("removeListener",C,T.listener||k));else if(typeof T!="function"){for(O=-1,P=T.length-1;P>=0;P--)if(T[P]===k||T[P].listener===k){D=T[P].listener,O=P;break}if(O<0)return this;O===0?T.shift():v(T,O),T.length===1&&(L[C]=T[0]),L.removeListener!==void 0&&this.emit("removeListener",C,D||k)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(C){var k,T,L;if(T=this._events,T===void 0)return this;if(T.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):T[C]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete T[C]),this;if(arguments.length===0){var O=Object.keys(T),P;for(L=0;L<O.length;++L)P=O[L],P!=="removeListener"&&this.removeAllListeners(P);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(k=T[C],typeof k=="function")this.removeListener(C,k);else if(k!==void 0)for(L=k.length-1;L>=0;L--)this.removeListener(C,k[L]);return this};function m(C,k,T){var L=C._events;if(L===void 0)return[];var O=L[k];return O===void 0?[]:typeof O=="function"?T?[O.listener||O]:[O]:T?E(O):y(O,O.length)}s.prototype.listeners=function(C){return m(this,C,!0)},s.prototype.rawListeners=function(C){return m(this,C,!1)},s.listenerCount=function(C,k){return typeof C.listenerCount=="function"?C.listenerCount(k):g.call(C,k)},s.prototype.listenerCount=g;function g(C){var k=this._events;if(k!==void 0){var T=k[C];if(typeof T=="function")return 1;if(T!==void 0)return T.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function y(C,k){for(var T=new Array(k),L=0;L<k;++L)T[L]=C[L];return T}function v(C,k){for(;k+1<C.length;k++)C[k]=C[k+1];C.pop()}function E(C){for(var k=new Array(C.length),T=0;T<k.length;++T)k[T]=C[T].listener||C[T];return k}function w(C,k){return new Promise(function(T,L){function O(D){C.removeListener(k,P),L(D)}function P(){typeof C.removeListener=="function"&&C.removeListener("error",O),T([].slice.call(arguments))}x(C,k,P,{once:!0}),k!=="error"&&R(C,O,{once:!0})})}function R(C,k,T){typeof C.on=="function"&&x(C,"error",k,T)}function x(C,k,T,L){if(typeof C.on=="function")L.once?C.once(k,T):C.on(k,T);else if(typeof C.addEventListener=="function")C.addEventListener(k,function O(P){L.once&&C.removeEventListener(k,O),T(P)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof C)}return Qw.exports}FJe();function mhe(t,e={}){const[n,r]=_.useState(kO(t)),[i,s]=_.useState(n?.isMuted),[o,a]=_.useState(n?.isSubscribed),[c,l]=_.useState(n?.track),[d,h]=_.useState("landscape"),m=_.useRef(),{className:g,trackObserver:y}=_.useMemo(()=>_Je(t),[t.participant.sid??t.participant.identity,t.source,lhe(t)&&t.publication.trackSid]);return _.useEffect(()=>{const v=y.subscribe(E=>{sh.debug("update track",E),r(E),s(E?.isMuted),a(E?.isSubscribed),l(E?.track)});return()=>v?.unsubscribe()},[y]),_.useEffect(()=>{var v,E;return c&&(m.current&&c.detach(m.current),(v=e.element)!=null&&v.current&&!(t.participant.isLocal&&c?.kind==="audio")&&c.attach(e.element.current)),m.current=(E=e.element)==null?void 0:E.current,()=>{m.current&&c?.detach(m.current)}},[c,e.element]),_.useEffect(()=>{var v,E;if(typeof((v=n?.dimensions)==null?void 0:v.width)=="number"&&typeof((E=n?.dimensions)==null?void 0:E.height)=="number"){const w=n.dimensions.width>n.dimensions.height?"landscape":"portrait";h(w)}},[n]),{publication:n,isMuted:i,isSubscribed:o,track:c,elementProps:PJe(e.props,{className:g,"data-lk-local-participant":t.participant.isLocal,"data-lk-source":n?.source,...n?.kind==="video"&&{"data-lk-orientation":d}})}}var v5,dY;function $Je(){if(dY)return v5;dY=1;var t="Expected a function",e=NaN,n="[object Symbol]",r=/^\s+|\s+$/g,i=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,o=/^0o[0-7]+$/i,a=parseInt,c=typeof Xw=="object"&&Xw&&Xw.Object===Object&&Xw,l=typeof self=="object"&&self&&self.Object===Object&&self,d=c||l||Function("return this")(),h=Object.prototype,m=h.toString,g=Math.max,y=Math.min,v=function(){return d.Date.now()};function E(k,T,L){var O,P,D,j,H,z,Y=0,W=!1,F=!1,$=!0;if(typeof k!="function")throw new TypeError(t);T=C(T)||0,w(L)&&(W=!!L.leading,F="maxWait"in L,D=F?g(C(L.maxWait)||0,T):D,$="trailing"in L?!!L.trailing:$);function V(de){var ke=O,De=P;return O=P=void 0,Y=de,j=k.apply(De,ke),j}function G(de){return Y=de,H=setTimeout(J,T),W?V(de):j}function Z(de){var ke=de-z,De=de-Y,Je=T-ke;return F?y(Je,D-De):Je}function q(de){var ke=de-z,De=de-Y;return z===void 0||ke>=T||ke<0||F&&De>=D}function J(){var de=v();if(q(de))return ue(de);H=setTimeout(J,Z(de))}function ue(de){return H=void 0,$&&O?V(de):(O=P=void 0,j)}function ge(){H!==void 0&&clearTimeout(H),Y=0,O=z=P=H=void 0}function Re(){return H===void 0?j:ue(v())}function we(){var de=v(),ke=q(de);if(O=arguments,P=this,z=de,ke){if(H===void 0)return G(z);if(F)return H=setTimeout(J,T),V(z)}return H===void 0&&(H=setTimeout(J,T)),j}return we.cancel=ge,we.flush=Re,we}function w(k){var T=typeof k;return!!k&&(T=="object"||T=="function")}function R(k){return!!k&&typeof k=="object"}function x(k){return typeof k=="symbol"||R(k)&&m.call(k)==n}function C(k){if(typeof k=="number")return k;if(x(k))return e;if(w(k)){var T=typeof k.valueOf=="function"?k.valueOf():k;k=w(T)?T+"":T}if(typeof k!="string")return k===0?k:+k;k=k.replace(r,"");var L=s.test(k);return L||o.test(k)?a(k.slice(2),L?2:8):i.test(k)?e:+k}return v5=E,v5}var BJe=$Je();const fY=Bfe(BJe);function HJe(t){const e=_.useRef(t);e.current=t,_.useEffect(()=>()=>{e.current()},[])}function qJe(t,e=500,n){const r=_.useRef();HJe(()=>{r.current&&r.current.cancel()});const i=_.useMemo(()=>{const s=fY(t,e,n),o=(...a)=>s(...a);return o.cancel=()=>{s.cancel()},o.isPending=()=>!!r.current,o.flush=()=>s.flush(),o},[t,e,n]);return _.useEffect(()=>{r.current=fY(t,e,n)},[t,e,n]),i}function VJe(t,e,n){const r=((l,d)=>l===d),i=t instanceof Function?t():t,[s,o]=_.useState(i),a=_.useRef(i),c=qJe(o,e,n);return r(a.current,i)||(c(i),a.current=i),[s,c]}function KJe({threshold:t=0,root:e=null,rootMargin:n="0%",freezeOnceVisible:r=!1,initialIsIntersecting:i=!1,onChange:s}={}){var o;const[a,c]=_.useState(null),[l,d]=_.useState(()=>({isIntersecting:i,entry:void 0})),h=_.useRef();h.current=s;const m=((o=l.entry)==null?void 0:o.isIntersecting)&&r;_.useEffect(()=>{if(!a||!("IntersectionObserver"in window)||m)return;const v=new IntersectionObserver(E=>{const w=Array.isArray(v.thresholds)?v.thresholds:[v.thresholds];E.forEach(R=>{const x=R.isIntersecting&&w.some(C=>R.intersectionRatio>=C);d({isIntersecting:x,entry:R}),h.current&&h.current(x,R)})},{threshold:t,root:e,rootMargin:n});return v.observe(a),()=>{v.disconnect()}},[a,JSON.stringify(t),e,n,m,r]);const g=_.useRef(null);_.useEffect(()=>{var v;!a&&(v=l.entry)!=null&&v.target&&!r&&!m&&g.current!==l.entry.target&&(g.current=l.entry.target,d({isIntersecting:i,entry:void 0}))},[a,l.entry,r,m,i]);const y=[c,!!l.isIntersecting,l.entry];return y.ref=y[0],y.isIntersecting=y[1],y.entry=y[2],y}const GJe=_.forwardRef(function({onTrackClick:t,onClick:e,onSubscriptionStatusChanged:n,trackRef:r,manageSubscription:i,...s},o){const a=hhe(r),c=_.useRef(null);_.useImperativeHandle(o,()=>c.current);const l=KJe({root:c.current}),[d]=VJe(l,3e3);_.useEffect(()=>{i&&a.publication instanceof WC&&d?.isIntersecting===!1&&l?.isIntersecting===!1&&a.publication.setSubscribed(!1)},[d,a,i]),_.useEffect(()=>{i&&a.publication instanceof WC&&l?.isIntersecting===!0&&a.publication.setSubscribed(!0)},[l,a,i]);const{elementProps:h,publication:m,isSubscribed:g}=mhe(a,{element:c,props:s});_.useEffect(()=>{n?.(!!g)},[g,n]);const y=v=>{e?.(v),t?.({participant:a?.participant,track:m})};return _.createElement("video",{ref:c,...h,muted:!0,onClick:y})}),zJe=_.forwardRef(function({trackRef:t,onSubscriptionStatusChanged:e,volume:n,...r},i){const s=hhe(t),o=_.useRef(null);_.useImperativeHandle(i,()=>o.current);const{elementProps:a,isSubscribed:c,track:l,publication:d}=mhe(s,{element:o,props:r});return _.useEffect(()=>{e?.(!!c)},[c,e]),_.useEffect(()=>{l===void 0||n===void 0||(l instanceof Lee?l.setVolume(n):sh.warn("Volume can only be set on remote audio tracks."))},[n,l]),_.useEffect(()=>{d===void 0||r.muted===void 0||(d instanceof WC?d.setEnabled(!r.muted):sh.warn("Can only call setEnabled on remote track publications."))},[r.muted,d,l]),_.createElement("audio",{ref:o,...a})});function WJe(t,e){const[n,r]=_.useState(),i=_.useMemo(()=>new ps,[]);return _.useEffect(()=>{let s=!1,o=[];return i.lock().then(async a=>{try{(t.audio||t.video)&&(o=await j_(t),s?o.forEach(c=>c.stop()):r(o))}catch(c){e&&c instanceof Error?e(c):sh.error(c)}finally{a()}}),()=>{s=!0,o.forEach(a=>{a.stop()})}},[JSON.stringify(t,DJe),e,i]),n}const YJe="_inRoom_110p2_8",XJe="_header_110p2_17",JJe="_filler_110p2_29",QJe="_footer_110p2_34",ZJe="_hidden_110p2_53",eQe="_overlay_110p2_57",tQe="_logo_110p2_75",nQe="_buttons_110p2_84",rQe="_layout_110p2_91",iQe="_shareScreen_110p2_111",sQe="_invite_110p2_123",oQe="_raiseHand_110p2_124",aQe="_fixedGrid_110p2_147",cQe="_tile_110p2_172",lQe="_maximised_110p2_177",kr={inRoom:YJe,header:XJe,filler:JJe,footer:QJe,hidden:ZJe,overlay:eQe,logo:tQe,buttons:nQe,layout:rQe,shareScreen:iQe,invite:sQe,raiseHand:oQe,fixedGrid:aQe,tile:cQe,maximised:lQe},uQe="_content_1cy0f_8",dQe="_wait_1cy0f_19",fQe="_join_1cy0f_32",b1={content:uQe,wait:dQe,join:fQe};function hY(t,e){let n;return(...r)=>{window.clearTimeout(n),n=window.setTimeout(()=>t(...r),e)}}function vb({debounce:t,scroll:e,polyfill:n,offsetSize:r}={debounce:0,scroll:!1,offsetSize:!1}){const i=n||(typeof window>"u"?class{}:window.ResizeObserver);if(!i)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[s,o]=_.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),a=_.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:s,orientationHandler:null}),c=t?typeof t=="number"?t:t.scroll:null,l=t?typeof t=="number"?t:t.resize:null,d=_.useRef(!1);_.useEffect(()=>(d.current=!0,()=>{d.current=!1}));const[h,m,g]=_.useMemo(()=>{const w=()=>{if(!a.current.element)return;const{left:R,top:x,width:C,height:k,bottom:T,right:L,x:O,y:P}=a.current.element.getBoundingClientRect(),D={left:R,top:x,width:C,height:k,bottom:T,right:L,x:O,y:P};a.current.element instanceof HTMLElement&&r&&(D.height=a.current.element.offsetHeight,D.width=a.current.element.offsetWidth),Object.freeze(D),d.current&&!gQe(a.current.lastBounds,D)&&o(a.current.lastBounds=D)};return[w,l?hY(w,l):w,c?hY(w,c):w]},[o,r,c,l]);function y(){a.current.scrollContainers&&(a.current.scrollContainers.forEach(w=>w.removeEventListener("scroll",g,!0)),a.current.scrollContainers=null),a.current.resizeObserver&&(a.current.resizeObserver.disconnect(),a.current.resizeObserver=null),a.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",a.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",a.current.orientationHandler))}function v(){a.current.element&&(a.current.resizeObserver=new i(g),a.current.resizeObserver.observe(a.current.element),e&&a.current.scrollContainers&&a.current.scrollContainers.forEach(w=>w.addEventListener("scroll",g,{capture:!0,passive:!0})),a.current.orientationHandler=()=>{g()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",a.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",a.current.orientationHandler))}const E=w=>{!w||w===a.current.element||(y(),a.current.element=w,a.current.scrollContainers=ghe(w),v())};return pQe(g,!!e),hQe(m),_.useEffect(()=>{y(),v()},[e,g,m]),_.useEffect(()=>y,[]),[E,s,h]}function hQe(t){_.useEffect(()=>{const e=t;return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[t])}function pQe(t,e){_.useEffect(()=>{if(e){const n=t;return window.addEventListener("scroll",n,{capture:!0,passive:!0}),()=>{window.removeEventListener("scroll",n,!0)}}},[t,e])}function ghe(t){const e=[];if(!t||t===document.body)return e;const{overflow:n,overflowX:r,overflowY:i}=window.getComputedStyle(t);return[n,r,i].some(s=>s==="auto"||s==="scroll")&&e.push(t),[...e,...ghe(t.parentElement)]}const mQe=["x","y","top","bottom","left","right","width","height"],gQe=(t,e)=>mQe.every(n=>t[n]===e[n]),vQe="_loading_14w06_8",yQe={loading:vQe},bQe=({size:t,loading:e,...n})=>S.jsxs("div",{children:[e&&S.jsx("div",{className:yQe.loading,children:S.jsx(Boe,{size:t/3})}),S.jsx(dm,{size:t,...n})]}),_Qe="_preview_1jjvr_8",SQe="_mirror_1jjvr_24",wQe="_cameraStarting_1jjvr_28",EQe="_avatarContainer_1jjvr_39",CQe="_buttonBar_1jjvr_51",_1={preview:_Qe,mirror:SQe,cameraStarting:wQe,avatarContainer:EQe,buttonBar:CQe},TQe=({matrixInfo:t,videoEnabled:e,videoTrack:n,children:r})=>{const{t:i}=et(),[s,o]=vb(),a=_.useRef(null);_.useEffect(()=>(a.current&&n?.attach(a.current),()=>{n?.detach()}),[n]);const c=_.useMemo(()=>e&&!n,[e,n]);return S.jsxs("div",{className:Le(_1.preview),ref:s,children:[S.jsx("video",{className:n&&SL(n).facingMode==="user"?_1.mirror:void 0,ref:a,muted:!0,playsInline:!0,tabIndex:-1,disablePictureInPicture:!0}),(!e||c)&&S.jsx(S.Fragment,{children:S.jsxs("div",{className:_1.avatarContainer,children:[c&&S.jsx("div",{className:_1.cameraStarting,role:"status",children:i("video_tile.camera_starting")}),S.jsx(bQe,{id:t.userId,name:t.displayName,size:Math.min(o.width,o.height)/2,src:t.avatarUrl,loading:c})]})}),S.jsx("div",{className:_1.buttonBar,children:r})]})},vhe=t=>{const{t:e}=et();return S.jsx(qt,{kind:"secondary",size:"sm",Icon:rNe,...t,children:e("action.invite")})};function Bf(t){const e=_.useRef(void 0);return e.current??={value:t()},e.current.value}const yhe=({client:t,matrixInfo:e,muteStates:n,onEnter:r,enterLabel:i,confineToRoom:s,hideHeader:o,participantCount:a,onShareClick:c,waitingForInvite:l})=>{_.useEffect(()=>(N.info("[Lifecycle] LobbyView Component mounted"),()=>{N.info("[Lifecycle] LobbyView Component unmounted")}),[]);const{t:d}=et();wS(e.roomName);const h=Fe(n.audio.enabled$),m=Fe(n.video.enabled$),g=Fe(n.audio.toggle$),y=Fe(n.video.toggle$),[v,E]=_.useState(!1),[w,R]=_.useState(DD),x=_.useCallback(()=>E(!0),[E]),C=_.useCallback(()=>E(!1),[E]),k=Fl(),T=_.useCallback(()=>{k("/")?.catch(V=>{N.error("Failed to navigate to /",V)})},[k]),L=wR("(max-height: 500px)"),O=!s&&S.jsx(Ll,{className:b1.recents,to:"/",children:d("lobby.leave_button")}),P=vm(),D=vo(P.videoInput.selected$)?.id,j=Bf(()=>h&&{deviceId:xGe(P.audioInput.selected$)?.id}),{processor:H}=PD(),z=Bf(()=>H),Y=_.useMemo(()=>({audio:Object.assign({},j),video:m&&{deviceId:D,processor:z}}),[j,m,D,z]),W=_.useCallback(V=>{N.error("Error while creating preview Tracks:",V),n.audio.setEnabled$.value?.(!1),n.video.setEnabled$.value?.(!1)},[n]),F=WJe(Y,W),$=_.useMemo(()=>F?.find(V=>V.kind===pe.Kind.Video)??null,[F]);return _.useEffect(()=>{$&&D===void 0&&P.requestDeviceNames()},[P,D,$]),aYe($),S.jsxs(S.Fragment,{children:[S.jsxs("div",{className:Le(b1.room,kr.inRoom),children:[!o&&S.jsxs(gd,{children:[S.jsx(hh,{children:S.jsx(zae,{id:e.roomId,name:e.roomName,avatarUrl:e.roomAvatar,encrypted:e.e2eeSystem.kind!==qn.NONE,participantCount:a})}),S.jsx(ph,{children:c!==null&&S.jsx(vhe,{onClick:c})})]}),S.jsxs("div",{className:b1.content,children:[S.jsx(TQe,{matrixInfo:e,videoEnabled:m,videoTrack:$,children:S.jsx(qt,{className:Le(b1.join,{[b1.wait]:l}),size:l?"sm":"lg",disabled:l,onClick:()=>{l||r()},"data-testid":"lobby_joinCall",children:i??d("lobby.join_button")})}),!L&&O]}),S.jsxs("div",{className:kr.footer,children:[L&&O,S.jsxs("div",{className:kr.buttons,children:[S.jsx(vce,{muted:!h,onClick:g??void 0,disabled:g===null}),S.jsx(yce,{muted:!m,onClick:y??void 0,disabled:y===null}),S.jsx(_ce,{onClick:x}),!s&&S.jsx(bce,{onClick:T})]})]})]}),t&&S.jsx(ND,{client:t,open:v,onDismiss:C,tab:w,onTabChange:R})]})},RQe="_headline_1em2y_8",kQe="_callEndedContent_1em2y_15",IQe="_callEndedButton_1em2y_35",xQe="_submitButton_1em2y_40",AQe="_container_1em2y_47",LQe="_main_1em2y_55",MQe="_footer_1em2y_72",Zd={headline:RQe,callEndedContent:kQe,callEndedButton:IQe,submitButton:xQe,container:AQe,main:LQe,footer:MQe},OQe="_starIcon_1m09w_8",PQe="_starRating_1m09w_12",DQe="_inputContainer_1m09w_18",NQe="_hideElement_1m09w_22",S1={starIcon:OQe,starRating:PQe,inputContainer:DQe,hideElement:NQe},UQe=(t,e)=>_.createElement("svg",{width:28,height:26,viewBox:"0 0 28 26",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:e,...t},_.createElement("path",{d:"M14 21.0267L22.24 26.0001L20.0533 16.6267L27.3333 10.3201L17.7466 9.50675L14 0.666748L10.2533 9.50675L0.666626 10.3201L7.94663 16.6267L5.75996 26.0001L14 21.0267Z",fill:"white"})),jQe=_.forwardRef(UQe),FQe=(t,e)=>_.createElement("svg",{width:28,height:26,viewBox:"0 0 28 26",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:e,...t},_.createElement("path",{id:"Vector",d:"M14 7.50675L15.2933 10.5601L15.92 12.0401L17.52 12.1734L20.8133 12.4534L18.3066 14.6267L17.0933 15.6801L17.4533 17.2534L18.2 20.4667L15.3733 18.7601L14 17.9067L12.6266 18.7334L9.79996 20.4401L10.5466 17.2267L10.9066 15.6534L9.69329 14.6001L7.18663 12.4267L10.48 12.1467L12.08 12.0134L12.7066 10.5334L14 7.50675M14 0.666748L10.2533 9.50675L0.666626 10.3201L7.94663 16.6267L5.75996 26.0001L14 21.0267L22.24 26.0001L20.0533 16.6267L27.3333 10.3201L17.7466 9.50675L14 0.666748Z",fill:"white"})),$Qe=_.forwardRef(FQe);function BQe({starCount:t,onChange:e,required:n}){const[r,i]=_.useState(0),[s,o]=_.useState(0),{t:a}=et();return S.jsx("div",{className:S1.starRating,children:[...Array(t)].map((c,l)=>(l+=1,S.jsxs("div",{className:S1.inputContainer,onMouseEnter:()=>o(l),onMouseLeave:()=>o(r),children:[S.jsx("input",{className:S1.hideElement,type:"radio",id:"starInput"+String(l),value:String(l)+"Star",name:"star rating",onChange:d=>{i(l),e(l)},required:!0}),S.jsx("label",{className:S1.hideElement,id:"starInvisibleLabel"+String(l),htmlFor:"starInput"+String(l),children:a("star_rating_input_label",{count:l})}),S.jsx("label",{className:S1.starIcon,id:"starIcon"+String(l),htmlFor:"starInput"+String(l),children:l<=(s||r)?S.jsx(jQe,{}):S.jsx($Qe,{})})]},l)))})}const HQe=({client:t,isPasswordlessUser:e,hideHeader:n,confineToRoom:r,endedCallId:i})=>{const{t:s}=et(),o=Fl(),{displayName:a}=hS(t),[c,l]=_.useState(!1),[d,h]=_.useState(0),[m,g]=_.useState(!1),[y,v]=_.useState(!1),E=_.useCallback(x=>{x.preventDefault();const k=new FormData(x.target).get("feedbackText");en.instance.eventQualitySurvey.track(i,k,d),g(!0),setTimeout(()=>{v(!0),setTimeout(()=>{e?l(!0):r||o("/")?.catch(T=>{N.error("Failed to navigate to /",T)})},1e3)},1e3)},[i,o,e,r,d]),w=e&&S.jsxs("div",{className:Zd.callEndedContent,children:[S.jsxs(mo,{i18nKey:"call_ended_view.create_account_prompt",children:[S.jsx("p",{children:"Why not finish by setting up a password to keep your account?"}),S.jsx("p",{children:"You'll be able to keep your name and set an avatar for use on future calls"})]}),S.jsx(Z8,{className:Zd.callEndedButton,to:"/register",children:s("call_ended_view.create_account_button")})]}),R=S.jsxs("div",{className:Zd.callEndedContent,children:[S.jsx(mo,{i18nKey:"call_ended_view.feedback_prompt",children:S.jsx("p",{children:"We'd love to hear your feedback so we can improve your experience."})}),S.jsxs("form",{onSubmit:E,children:[S.jsx(Nt,{children:S.jsx(BQe,{starCount:5,onChange:h,required:!0})}),S.jsx(Nt,{children:S.jsx(er,{className:Qle.feedback,id:"feedbackText",name:"feedbackText",label:s("settings.feedback_tab_description_label"),placeholder:s("settings.feedback_tab_description_label"),type:"textarea"})})," ",S.jsx(Nt,{children:y?S.jsx(mo,{i18nKey:"call_ended_view.feedback_done",children:S.jsx("p",{children:"Thanks for your feedback!"})}):S.jsx(qt,{type:"submit",className:Zd.submitButton,"data-testid":"home_go",children:s(m?"submitting":"action.submit")})})]})]});return S.jsxs(S.Fragment,{children:[!n&&S.jsxs(gd,{children:[S.jsx(hh,{children:!r&&S.jsx(Bp,{})}),S.jsx(ph,{})]}),S.jsxs("div",{className:Zd.container,children:[S.jsxs("main",{className:Zd.main,children:[S.jsx(Hc,{size:"xl",weight:"semibold",className:Zd.headline,children:c?s("call_ended_view.headline",{displayName:a}):s("call_ended_view.headline",{displayName:a})+`
`+s("call_ended_view.survey_prompt")}),(!c||r)&&en.instance.isEnabled()?R:w]}),!r&&S.jsx(an,{className:Zd.footer,children:S.jsxs(Ll,{to:"/",children:[" ",s("call_ended_view.not_now_button")," "]})})]})]})};function pY(t,e,n){return n.find(i=>i.kind===e&&i.label===t)?.deviceId}const qQe=(t,e)=>_.createElement("svg",{width:48,height:48,viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:e,...t},_.createElement("g",{id:"Logo Mark"},_.createElement("rect",{width:47.86,height:48,rx:23.93,fill:"#0DBD8B"}),_.createElement("g",{id:"Union"},_.createElement("path",{d:"M21.3075 9.42871C20.3396 9.42871 19.5549 10.214 19.5549 11.1828C19.5549 12.1516 20.3396 12.9369 21.3075 12.9369C25.9321 12.9369 29.6811 16.689 29.6811 21.3175C29.6811 22.2863 30.4657 23.0716 31.4337 23.0716C32.4016 23.0716 33.1863 22.2863 33.1863 21.3175C33.1863 14.7515 27.868 9.42871 21.3075 9.42871Z",fill:"white"}),_.createElement("path",{d:"M38.4591 21.3174C38.4591 20.3486 37.6745 19.5633 36.7065 19.5633C35.7386 19.5633 34.9539 20.3486 34.9539 21.3174C34.9539 25.9459 31.2049 29.698 26.5804 29.698C25.6124 29.698 24.8277 30.4833 24.8277 31.4521C24.8277 32.4209 25.6124 33.2062 26.5804 33.2062C33.1408 33.2062 38.4591 27.8834 38.4591 21.3174Z",fill:"white"}),_.createElement("path",{d:"M28.3329 36.8173C28.3329 37.786 27.5482 38.5714 26.5803 38.5714C20.0198 38.5714 14.7015 33.2486 14.7015 26.6826C14.7015 25.7138 15.4862 24.9285 16.4541 24.9285C17.4221 24.9285 18.2067 25.7138 18.2067 26.6826C18.2067 31.3111 21.9557 35.0632 26.5803 35.0632C27.5482 35.0632 28.3329 35.8485 28.3329 36.8173Z",fill:"white"}),_.createElement("path",{d:"M9.40112 26.6827C9.40112 27.6514 10.1858 28.4368 11.1537 28.4368C12.1217 28.4368 12.9064 27.6514 12.9064 26.6827C12.9064 22.0542 16.6553 18.3021 21.2799 18.3021C22.2478 18.3021 23.0325 17.5167 23.0325 16.548C23.0325 15.5792 22.2478 14.7939 21.2799 14.7939C14.7194 14.7939 9.40112 20.1167 9.40112 26.6827Z",fill:"white"})))),VQe=_.forwardRef(qQe),KQe=(t,e)=>_.createElement("svg",{width:160,height:22,viewBox:"0 0 160 22",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:e,...t},_.createElement("g",{id:"Logo Type"},_.createElement("g",{id:"Vector"},_.createElement("path",{d:"M14.8673 15.1575H3.39742C3.53293 16.3508 3.96849 17.3036 4.70411 18.0157C5.43974 18.7087 6.40766 19.0551 7.60789 19.0551C8.40159 19.0551 9.11785 18.8626 9.75668 18.4777C10.3955 18.0927 10.8504 17.5731 11.1215 16.9186H14.606C14.1414 18.4392 13.2702 19.671 11.9926 20.6142C10.7343 21.5381 9.24368 22 7.52078 22C5.27519 22 3.45549 21.259 2.06168 19.7769C0.687227 18.2948 0 16.4182 0 14.147C0 11.9335 0.696906 10.0761 2.09072 8.5748C3.48453 7.07349 5.28487 6.32283 7.49174 6.32283C9.69861 6.32283 11.4796 7.06387 12.8347 8.54593C14.2091 10.0087 14.8964 11.8565 14.8964 14.0892L14.8673 15.1575ZM7.49174 9.12336C6.40766 9.12336 5.50749 9.44095 4.79123 10.0761C4.07496 10.7113 3.62972 11.5582 3.45549 12.6168H11.4699C11.315 11.5582 10.8892 10.7113 10.1922 10.0761C9.49534 9.44095 8.59517 9.12336 7.49174 9.12336Z",fill:"currentColor"}),_.createElement("path",{d:"M17.2743 17.1785V0H20.7298V17.2362C20.7298 18.0061 21.1557 18.3911 22.0074 18.3911L22.6172 18.3622V21.6247C22.2881 21.6824 21.9397 21.7113 21.5719 21.7113C20.0813 21.7113 18.9875 21.336 18.2906 20.5853C17.6131 19.8346 17.2743 18.699 17.2743 17.1785Z",fill:"currentColor"}),_.createElement("path",{d:"M38.71 15.1575H27.2401C27.3756 16.3508 27.8112 17.3036 28.5468 18.0157C29.2824 18.7087 30.2504 19.0551 31.4506 19.0551C32.2443 19.0551 32.9606 18.8626 33.5994 18.4777C34.2382 18.0927 34.6931 17.5731 34.9642 16.9186H38.4487C37.9841 18.4392 37.113 19.671 35.8353 20.6142C34.577 21.5381 33.0864 22 31.3635 22C29.1179 22 27.2982 21.259 25.9044 19.7769C24.5299 18.2948 23.8427 16.4182 23.8427 14.147C23.8427 11.9335 24.5396 10.0761 25.9334 8.5748C27.3272 7.07349 29.1276 6.32283 31.3344 6.32283C33.5413 6.32283 35.3223 7.06387 36.6774 8.54593C38.0518 10.0087 38.7391 11.8565 38.7391 14.0892L38.71 15.1575ZM31.3344 9.12336C30.2504 9.12336 29.3502 9.44095 28.6339 10.0761C27.9177 10.7113 27.4724 11.5582 27.2982 12.6168H35.3126C35.1577 11.5582 34.7319 10.7113 34.035 10.0761C33.3381 9.44095 32.4379 9.12336 31.3344 9.12336Z",fill:"currentColor"}),_.createElement("path",{d:"M54.3001 13.0499V21.6535H50.8446V12.6745C50.8446 10.4033 49.8961 9.26772 47.9989 9.26772C46.9729 9.26772 46.1502 9.59493 45.5307 10.2493C44.9306 10.9038 44.6306 11.7988 44.6306 12.9344V21.6535H41.1751V6.66929H44.3692V8.66142C44.737 7.98775 45.2984 7.42957 46.0534 6.98688C46.8084 6.54418 47.7473 6.32283 48.8701 6.32283C50.9608 6.32283 52.4707 7.11199 53.4 8.69029C54.6776 7.11199 56.3812 6.32283 58.5106 6.32283C60.2722 6.32283 61.6273 6.87139 62.5759 7.9685C63.5244 9.04637 63.9987 10.4707 63.9987 12.2415V21.6535H60.5432V12.6745C60.5432 10.4033 59.5947 9.26772 57.6975 9.26772C56.6522 9.26772 55.8198 9.60455 55.2003 10.2782C54.6002 10.9326 54.3001 11.8565 54.3001 13.0499Z",fill:"currentColor"}),_.createElement("path",{d:"M81.1834 15.1575H69.7135C69.849 16.3508 70.2846 17.3036 71.0202 18.0157C71.7558 18.7087 72.7237 19.0551 73.924 19.0551C74.7177 19.0551 75.4339 18.8626 76.0728 18.4777C76.7116 18.0927 77.1665 17.5731 77.4375 16.9186H80.9221C80.4575 18.4392 79.5863 19.671 78.3087 20.6142C77.0504 21.5381 75.5598 22 73.8369 22C71.5913 22 69.7716 21.259 68.3778 19.7769C67.0033 18.2948 66.3161 16.4182 66.3161 14.147C66.3161 11.9335 67.013 10.0761 68.4068 8.5748C69.8006 7.07349 71.601 6.32283 73.8078 6.32283C76.0147 6.32283 77.7957 7.06387 79.1508 8.54593C80.5252 10.0087 81.2124 11.8565 81.2124 14.0892L81.1834 15.1575ZM73.8078 9.12336C72.7237 9.12336 71.8236 9.44095 71.1073 10.0761C70.391 10.7113 69.9458 11.5582 69.7716 12.6168H77.786C77.6311 11.5582 77.2052 10.7113 76.5083 10.0761C75.8114 9.44095 74.9113 9.12336 73.8078 9.12336Z",fill:"currentColor"}),_.createElement("path",{d:"M86.8426 6.66929V8.66142C87.191 8.007 87.7621 7.45844 88.5558 7.01575C89.3689 6.55381 90.3465 6.32283 91.4886 6.32283C93.2696 6.32283 94.6441 6.86177 95.612 7.93963C96.5993 9.0175 97.0929 10.4514 97.0929 12.2415V21.6535H93.6374V12.6745C93.6374 11.6159 93.3858 10.7883 92.8824 10.1916C92.3985 9.57568 91.6532 9.26772 90.6465 9.26772C89.5431 9.26772 88.672 9.59493 88.0331 10.2493C87.4137 10.9038 87.1039 11.8084 87.1039 12.9633V21.6535H83.6484V6.66929H86.8426Z",fill:"currentColor"}),_.createElement("path",{d:"M107.185 18.5932V21.5669C106.759 21.6824 106.159 21.7402 105.384 21.7402C102.442 21.7402 100.971 20.2677 100.971 17.3228V9.41208H98.6766V6.66929H100.971V2.77165H104.426V6.66929H107.243V9.41208H104.426V16.9764C104.426 18.1505 104.987 18.7375 106.11 18.7375L107.185 18.5932Z",fill:"currentColor"}),_.createElement("path",{d:"M116.115 18.9881C114.474 17.2035 113.653 14.9429 113.653 12.2064C113.653 9.4699 114.474 7.21782 116.115 5.45015C117.773 3.66548 119.953 2.77314 122.654 2.77314C124.876 2.77314 126.756 3.38503 128.295 4.6088C129.833 5.83258 130.816 7.47277 131.244 9.52939H129.269C128.91 7.99967 128.132 6.7844 126.936 5.88357C125.739 4.98273 124.312 4.53232 122.654 4.53232C120.534 4.53232 118.824 5.23769 117.525 6.64842C116.243 8.05916 115.602 9.91182 115.602 12.2064C115.602 14.501 116.243 16.3536 117.525 17.7644C118.824 19.1751 120.534 19.8805 122.654 19.8805C124.312 19.8805 125.739 19.4301 126.936 18.5292C128.132 17.6284 128.91 16.4131 129.269 14.8834H131.244C130.816 16.94 129.833 18.5802 128.295 19.804C126.756 21.0278 124.876 21.6397 122.654 21.6397C119.953 21.6397 117.773 20.7558 116.115 18.9881Z",fill:"currentColor"}),_.createElement("path",{d:"M143.174 15.0874C140.832 15.0874 139.233 15.1384 138.379 15.2403C137.541 15.3253 136.926 15.4698 136.532 15.6738C135.831 16.0647 135.481 16.6936 135.481 17.5604C135.481 19.2261 136.473 20.0589 138.456 20.0589C139.977 20.0589 141.139 19.719 141.943 19.0391C142.763 18.3593 143.174 17.4499 143.174 16.3111V15.0874ZM138.25 21.5632C136.763 21.5632 135.626 21.2062 134.84 20.4924C134.071 19.7615 133.686 18.8012 133.686 17.6114C133.686 16.8295 133.891 16.1327 134.301 15.5208C134.729 14.9089 135.31 14.4585 136.045 14.1695C136.661 13.9316 137.455 13.7786 138.43 13.7106C139.404 13.6256 140.986 13.5831 143.174 13.5831V12.7418C143.174 10.6002 141.943 9.52939 139.481 9.52939C137.361 9.52939 136.131 10.3877 135.789 12.1044H134.019C134.207 10.8466 134.746 9.84383 135.635 9.09597C136.541 8.34811 137.849 7.97418 139.558 7.97418C141.387 7.97418 142.746 8.3991 143.635 9.24894C144.541 10.0988 144.994 11.2716 144.994 12.7673V21.2572H143.251V19.3706C142.345 20.8323 140.678 21.5632 138.25 21.5632Z",fill:"currentColor"}),_.createElement("path",{d:"M149.358 18.4018V2.13576H151.178V18.1978C151.178 18.7247 151.264 19.0901 151.435 19.2941C151.623 19.498 151.956 19.6 152.435 19.6L152.948 19.549V21.2062C152.657 21.2572 152.341 21.2827 151.999 21.2827C150.238 21.2827 149.358 20.3224 149.358 18.4018Z",fill:"currentColor"}),_.createElement("path",{d:"M155.944 18.4018V2.13576H157.764V18.1978C157.764 18.7247 157.85 19.0901 158.021 19.2941C158.209 19.498 158.542 19.6 159.021 19.6L159.534 19.549V21.2062C159.243 21.2572 158.927 21.2827 158.585 21.2827C156.824 21.2827 155.944 20.3224 155.944 18.4018Z",fill:"currentColor"})))),GQe=_.forwardRef(KQe),mY=t=>{const e=document.activeElement;return e!==null&&e.contains(t)},gY=Object.fromEntries(d_.slice(0,RM).map((t,e)=>[(e+1).toString(),t]));function zQe(t,e,n,r,i,s){const o=_.useRef(!1);eC(window,"keydown",_.useCallback(a=>{t.current!==null&&mY(t.current)&&(a.altKey||a.ctrlKey||a.metaKey||a.shiftKey||(a.key==="m"?(a.preventDefault(),e?.()):a.key==="v"?(a.preventDefault(),n?.()):a.key===" "?(a.preventDefault(),o.current||(o.current=!0,r?.(!0))):a.key==="h"?(a.preventDefault(),s()):gY[a.key]&&(a.preventDefault(),i(gY[a.key]))))},[t,n,e,r,i,s]),_.useMemo(()=>({capture:!0}),[])),eC(window,"keyup",_.useCallback(a=>{t.current!==null&&mY(t.current)&&a.key===" "&&(o.current=!1,r?.(!1))},[t,r])),eC(window,"blur",_.useCallback(()=>{o.current&&(o.current=!1,r?.(!0))},[r,o]))}const WQe="_tile_31vx3_8",YQe="_speaking_31vx3_28",XQe="_handRaised_31vx3_48",JQe="_muteIcon_31vx3_75",QQe="_volumeSlider_31vx3_83",ZQe="_switchCamera_31vx3_87",Gg={tile:WQe,speaking:YQe,handRaised:XQe,muteIcon:JQe,volumeSlider:QQe,switchCamera:ZQe};function qD(t,e){return tue(t).pipe(ve(()=>t.getTrackPublication(e)),fo(),ve(n=>n&&{participant:t,publication:n,source:e}))}function bhe(t,e,n){return ot([qD(t,e),pKe(1e3).pipe(xn(0))]).pipe(gt(async([r])=>{const i=r?.publication?.track;if(!i||!(i instanceof YP||i instanceof WP))return;const s=await i.getRTCStatsReport();if(s){for(const o of s.values())if(o.type===n)return o}}),xn(void 0))}function IO(t,e){return bhe(t,e,"inbound-rtp").pipe(ve(n=>n))}function vY(t,e){return bhe(t,e,"outbound-rtp").pipe(ve(n=>n))}function Zw(t,e){let n={framesDecoded:void 0,framesReceived:void 0};return IO(t,e).pipe(ve(r=>{if(!r)return;const{framesDecoded:i,framesDropped:s,framesReceived:o}=r;return{framesDecoded:i,framesDropped:s,framesReceived:o}}),ri(r=>!!r),ve(r=>{const i=n;if(n=r,typeof r.framesReceived=="number"&&typeof i.framesReceived=="number"&&typeof r.framesDecoded=="number"&&typeof i.framesDecoded=="number"){const s=r.framesReceived-i.framesReceived,o=r.framesDecoded-i.framesDecoded;if(s>0)return o>0}}),ri(r=>typeof r=="boolean"),xn(void 0))}function y5(t,e,n,r){return t.pipe(gt(i=>i===void 0?mt(!1):eue(i,he.EncryptionError).pipe(ve(s=>{const[o]=s;return n.kind===qn.PER_PARTICIPANT?(o?.message.includes(e.identity)&&o?.message.includes(r))??!1:n.kind===qn.SHARED_KEY?!!o?.message.includes(r):!1}))),fo(),eO(1e3),xn(!1))}class _he{constructor(e,n,r,i,s,o,a,c,l,d,h,m){this.scope=e,this.id=n,this.userId=r,this.rtcBackendIdentity=i,this.participant$=s,this.livekitRoom$=l,this.focusUrl$=d,this.displayName$=h,this.mxcAvatarUrl$=m;const g=this.observeTrackReference$(a);this.video$=this.observeTrackReference$(c),this.unencryptedWarning$=this.scope.behavior(ot([g,this.video$],(y,v)=>o.kind!==qn.NONE&&(y?.publication.isEncrypted===!1||v?.publication.isEncrypted===!1))),this.encryptionStatus$=this.scope.behavior(this.participant$.pipe(gt(y=>y?y.isLocal||o.kind===qn.NONE?mt(1):o.kind===qn.PER_PARTICIPANT?ot([y5(l,y,o,"MissingKey"),y5(l,y,o,"InvalidKey"),Zw(y,a),Zw(y,c)]).pipe(ve(([v,E,w,R])=>{if(v)return 2;if(E)return 3;if(w||R)return 1}),ri(v=>!!v),xn(0)):ot([y5(l,y,o,"InvalidKey"),Zw(y,a),Zw(y,c)]).pipe(ve(([v,E,w])=>{if(v)return 4;if(E||w)return 1}),ri(v=>!!v),xn(0)):mt(0))))}observeTrackReference$(e){return this.scope.behavior(this.participant$.pipe(gt(n=>n?qD(n,e):mt(void 0))))}}class She extends _he{constructor(e,n,r,i,s,o,a,c,l,d,h,m){super(e,n,r,i,s,o,pe.Source.Microphone,pe.Source.Camera,a,c,l,d),this.handRaised$=h,this.reaction$=m,this._speaking$=this.scope.behavior(this.participant$.pipe(gt(y=>y?jR(y,ae.IsSpeakingChanged).pipe(ve(v=>v.isSpeaking)):mt(!1)))),this._cropVideo$=new mr(!1),this.cropVideo$=this._cropVideo$;const g=this.scope.behavior(s.pipe(gt(y=>(y&&tue(y))??mt(void 0))));this.audioEnabled$=this.scope.behavior(g.pipe(ve(y=>y?.microphoneTrack?.isMuted===!1))),this._videoEnabled$=this.scope.behavior(g.pipe(ve(y=>y?.cameraTrack?.isMuted===!1)))}get speaking$(){return this._speaking$}get videoEnabled$(){return this._videoEnabled$}toggleFitContain(){this._cropVideo$.next(!this._cropVideo$.value)}get local(){return this instanceof cy}}class cy extends She{constructor(e,n,r,i,s,o,a,c,l,d,h,m,g){super(e,n,r,i,s,o,a,c,d,h,m,g),this.mediaDevices=l,this.videoTrack$=this.video$.pipe(gt(y=>{const v=y?.publication.track;return v instanceof Pv?Xu(ms(v,Ae.Restarted).pipe(xn(null),ve(()=>v)),ms(v,Ae.Muted).pipe(ve(()=>null))):mt(null)})),this.mirror$=this.scope.behavior(this.videoTrack$.pipe(ve(y=>y!==null&&SL(y).facingMode==="user"))),this.alwaysShow$=Ez.value$,this.setAlwaysShow=Ez.setValue,this.switchCamera$=this.scope.behavior(Dc==="desktop"?mt(null):this.videoTrack$.pipe(ve(y=>{if(y===null)return null;const v=SL(y).facingMode;return v!=="user"&&v!=="environment"?null:()=>{y.restartTrack({facingMode:v==="user"?"environment":"user"}).then(()=>{const E=y.mediaStreamTrack.getSettings().deviceId;E!==void 0&&this.mediaDevices.videoInput.select(E)}).catch(E=>N.error("Failed to switch camera",v,E))}}))),this.audioStreamStats$=ot([this.participant$,Xv.value$]).pipe(gt(([y,v])=>!y||!v?mt(void 0):vY(y,pe.Source.Microphone))),this.videoStreamStats$=ot([this.participant$,Xv.value$]).pipe(gt(([y,v])=>!y||!v?mt(void 0):vY(y,pe.Source.Camera)))}}class eZe extends She{constructor(e,n,r,i,s,o,a,c,l,d,h,m,g){super(e,n,r,i,s,o,a,c,d,h,m,g),this.pretendToBeDisconnected$=l,this.waitingForMedia$=this.scope.behavior(ot([this.livekitRoom$,this.participant$],(y,v)=>y!==void 0&&v===null)),this.locallyMutedToggle$=new Ar,this.localVolumeAdjustment$=new Ar,this.localVolumeCommit$=new Ar,this.localVolume$=this.scope.behavior(Xu(this.locallyMutedToggle$.pipe(ve(()=>"toggle mute")),this.localVolumeAdjustment$,this.localVolumeCommit$.pipe(ve(()=>"commit"))).pipe(oue({volume:1,committedVolume:1},(y,v)=>{switch(v){case"toggle mute":return{...y,volume:y.volume===0?y.committedVolume:0};case"commit":return{...y,committedVolume:y.volume===0?y.committedVolume:y.volume};default:return{...y,volume:v}}}),ve(({volume:y})=>y))),this.locallyMuted$=this.scope.behavior(this.localVolume$.pipe(ve(y=>y===0))),this.audioStreamStats$=ot([this.participant$,Xv.value$]).pipe(gt(([y,v])=>!y||!v?mt(void 0):IO(y,pe.Source.Microphone))),this.videoStreamStats$=ot([this.participant$,Xv.value$]).pipe(gt(([y,v])=>!y||!v?mt(void 0):IO(y,pe.Source.Camera))),this.__speaking$=this.scope.behavior(l.pipe(gt(y=>y?mt(!1):super.speaking$))),this.__videoEnabled$=this.scope.behavior(l.pipe(gt(y=>y?mt(!1):super.videoEnabled$))),ot([s,this.pretendToBeDisconnected$.pipe(gt(y=>y?mt(0):this.localVolume$),this.scope.bind())]).subscribe(([y,v])=>y?.setVolume(v))}get speaking$(){return this.__speaking$}get videoEnabled$(){return this.__videoEnabled$}toggleLocallyMuted(){this.locallyMutedToggle$.next()}setLocalVolume(e){this.localVolumeAdjustment$.next(e)}commitLocalVolume(){this.localVolumeCommit$.next()}}class zg extends _he{constructor(e,n,r,i,s,o,a,c,l,d,h,m){super(e,n,r,i,s,o,pe.Source.ScreenShareAudio,pe.Source.ScreenShare,a,c,d,h),this.pretendToBeDisconnected$=l,this.local=m,this.videoEnabled$=this.scope.behavior(this.pretendToBeDisconnected$.pipe(ve(g=>!g)))}}var VD=kS(),It=t=>RS(t,VD),KD=kS();It.write=t=>RS(t,KD);var S4=kS();It.onStart=t=>RS(t,S4);var GD=kS();It.onFrame=t=>RS(t,GD);var zD=kS();It.onFinish=t=>RS(t,zD);var Ev=[];It.setTimeout=(t,e)=>{const n=It.now()+e,r=()=>{const s=Ev.findIndex(o=>o.cancel==r);~s&&Ev.splice(s,1),Rf-=~s?1:0},i={time:n,handler:t,cancel:r};return Ev.splice(whe(n),0,i),Rf+=1,Ehe(),i};var whe=t=>~(~Ev.findIndex(e=>e.time>t)||~Ev.length);It.cancel=t=>{S4.delete(t),GD.delete(t),zD.delete(t),VD.delete(t),KD.delete(t)};It.sync=t=>{xO=!0,It.batchedUpdates(t),xO=!1};It.throttle=t=>{let e;function n(){try{t(...e)}finally{e=null}}function r(...i){e=i,It.onStart(n)}return r.handler=t,r.cancel=()=>{S4.delete(n),e=null},r};var WD=typeof window<"u"?window.requestAnimationFrame:(()=>{});It.use=t=>WD=t;It.now=typeof performance<"u"?()=>performance.now():Date.now;It.batchedUpdates=t=>t();It.catch=console.error;It.frameLoop="always";It.advance=()=>{It.frameLoop!=="demand"?console.warn("Cannot call the manual advancement of rafz whilst frameLoop is not set as demand"):The()};var Tf=-1,Rf=0,xO=!1;function RS(t,e){xO?(e.delete(t),t(0)):(e.add(t),Ehe())}function Ehe(){Tf<0&&(Tf=0,It.frameLoop!=="demand"&&WD(Che))}function tZe(){Tf=-1}function Che(){~Tf&&(WD(Che),It.batchedUpdates(The))}function The(){const t=Tf;Tf=It.now();const e=whe(Tf);if(e&&(Rhe(Ev.splice(0,e),n=>n.handler()),Rf-=e),!Rf){tZe();return}S4.flush(),VD.flush(t?Math.min(64,Tf-t):16.667),GD.flush(),KD.flush(),zD.flush()}function kS(){let t=new Set,e=t;return{add(n){Rf+=e==t&&!t.has(n)?1:0,t.add(n)},delete(n){return Rf-=e==t&&t.has(n)?1:0,t.delete(n)},flush(n){e.size&&(t=new Set,Rf-=e.size,Rhe(e,r=>r(n)&&t.add(r)),Rf+=t.size,e=t)}}}function Rhe(t,e){t.forEach(n=>{try{e(n)}catch(r){It.catch(r)}})}var nZe=Object.defineProperty,rZe=(t,e)=>{for(var n in e)nZe(t,n,{get:e[n],enumerable:!0})},Fc={};rZe(Fc,{assign:()=>sZe,colors:()=>Hf,createStringInterpolator:()=>XD,skipAnimation:()=>Ihe,to:()=>khe,willAdvance:()=>JD});function AO(){}var iZe=(t,e,n)=>Object.defineProperty(t,e,{value:n,writable:!0,configurable:!0}),Ie={arr:Array.isArray,obj:t=>!!t&&t.constructor.name==="Object",fun:t=>typeof t=="function",str:t=>typeof t=="string",num:t=>typeof t=="number",und:t=>t===void 0};function Cu(t,e){if(Ie.arr(t)){if(!Ie.arr(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}return t===e}var Pt=(t,e)=>t.forEach(e);function Ol(t,e,n){if(Ie.arr(t)){for(let r=0;r<t.length;r++)e.call(n,t[r],`${r}`);return}for(const r in t)t.hasOwnProperty(r)&&e.call(n,t[r],r)}var Ps=t=>Ie.und(t)?[]:Ie.arr(t)?t:[t];function yb(t,e){if(t.size){const n=Array.from(t);t.clear(),Pt(n,e)}}var j1=(t,...e)=>yb(t,n=>n(...e)),YD=()=>typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),XD,khe,Hf=null,Ihe=!1,JD=AO,sZe=t=>{t.to&&(khe=t.to),t.now&&(It.now=t.now),t.colors!==void 0&&(Hf=t.colors),t.skipAnimation!=null&&(Ihe=t.skipAnimation),t.createStringInterpolator&&(XD=t.createStringInterpolator),t.requestAnimationFrame&&It.use(t.requestAnimationFrame),t.batchedUpdates&&(It.batchedUpdates=t.batchedUpdates),t.willAdvance&&(JD=t.willAdvance),t.frameLoop&&(It.frameLoop=t.frameLoop)},bb=new Set,Da=[],b5=[],rT=0,w4={get idle(){return!bb.size&&!Da.length},start(t){rT>t.priority?(bb.add(t),It.onStart(oZe)):(xhe(t),It(LO))},advance:LO,sort(t){if(rT)It.onFrame(()=>w4.sort(t));else{const e=Da.indexOf(t);~e&&(Da.splice(e,1),Ahe(t))}},clear(){Da=[],bb.clear()}};function oZe(){bb.forEach(xhe),bb.clear(),It(LO)}function xhe(t){Da.includes(t)||Ahe(t)}function Ahe(t){Da.splice(aZe(Da,e=>e.priority>t.priority),0,t)}function LO(t){const e=b5;for(let n=0;n<Da.length;n++){const r=Da[n];rT=r.priority,r.idle||(JD(r),r.advance(t),r.idle||e.push(r))}return rT=0,b5=Da,b5.length=0,Da=e,Da.length>0}function aZe(t,e){const n=t.findIndex(e);return n<0?t.length:n}var cZe={transparent:0,aliceblue:4042850303,antiquewhite:4209760255,aqua:16777215,aquamarine:2147472639,azure:4043309055,beige:4126530815,bisque:4293182719,black:255,blanchedalmond:4293643775,blue:65535,blueviolet:2318131967,brown:2771004159,burlywood:3736635391,burntsienna:3934150143,cadetblue:1604231423,chartreuse:2147418367,chocolate:3530104575,coral:4286533887,cornflowerblue:1687547391,cornsilk:4294499583,crimson:3692313855,cyan:16777215,darkblue:35839,darkcyan:9145343,darkgoldenrod:3095792639,darkgray:2846468607,darkgreen:6553855,darkgrey:2846468607,darkkhaki:3182914559,darkmagenta:2332068863,darkolivegreen:1433087999,darkorange:4287365375,darkorchid:2570243327,darkred:2332033279,darksalmon:3918953215,darkseagreen:2411499519,darkslateblue:1211993087,darkslategray:793726975,darkslategrey:793726975,darkturquoise:13554175,darkviolet:2483082239,deeppink:4279538687,deepskyblue:12582911,dimgray:1768516095,dimgrey:1768516095,dodgerblue:512819199,firebrick:2988581631,floralwhite:4294635775,forestgreen:579543807,fuchsia:4278255615,gainsboro:3705462015,ghostwhite:4177068031,gold:4292280575,goldenrod:3668254975,gray:2155905279,green:8388863,greenyellow:2919182335,grey:2155905279,honeydew:4043305215,hotpink:4285117695,indianred:3445382399,indigo:1258324735,ivory:4294963455,khaki:4041641215,lavender:3873897215,lavenderblush:4293981695,lawngreen:2096890111,lemonchiffon:4294626815,lightblue:2916673279,lightcoral:4034953471,lightcyan:3774873599,lightgoldenrodyellow:4210742015,lightgray:3553874943,lightgreen:2431553791,lightgrey:3553874943,lightpink:4290167295,lightsalmon:4288707327,lightseagreen:548580095,lightskyblue:2278488831,lightslategray:2005441023,lightslategrey:2005441023,lightsteelblue:2965692159,lightyellow:4294959359,lime:16711935,limegreen:852308735,linen:4210091775,magenta:4278255615,maroon:2147483903,mediumaquamarine:1724754687,mediumblue:52735,mediumorchid:3126187007,mediumpurple:2473647103,mediumseagreen:1018393087,mediumslateblue:2070474495,mediumspringgreen:16423679,mediumturquoise:1221709055,mediumvioletred:3340076543,midnightblue:421097727,mintcream:4127193855,mistyrose:4293190143,moccasin:4293178879,navajowhite:4292783615,navy:33023,oldlace:4260751103,olive:2155872511,olivedrab:1804477439,orange:4289003775,orangered:4282712319,orchid:3664828159,palegoldenrod:4008225535,palegreen:2566625535,paleturquoise:2951671551,palevioletred:3681588223,papayawhip:4293907967,peachpuff:4292524543,peru:3448061951,pink:4290825215,plum:3718307327,powderblue:2967529215,purple:2147516671,rebeccapurple:1714657791,red:4278190335,rosybrown:3163525119,royalblue:1097458175,saddlebrown:2336560127,salmon:4202722047,sandybrown:4104413439,seagreen:780883967,seashell:4294307583,sienna:2689740287,silver:3233857791,skyblue:2278484991,slateblue:1784335871,slategray:1887473919,slategrey:1887473919,snow:4294638335,springgreen:16744447,steelblue:1182971135,tan:3535047935,teal:8421631,thistle:3636451583,tomato:4284696575,turquoise:1088475391,violet:4001558271,wheat:4125012991,white:4294967295,whitesmoke:4126537215,yellow:4294902015,yellowgreen:2597139199},Mc="[-+]?\\d*\\.?\\d+",iT=Mc+"%";function E4(...t){return"\\(\\s*("+t.join(")\\s*,\\s*(")+")\\s*\\)"}var lZe=new RegExp("rgb"+E4(Mc,Mc,Mc)),uZe=new RegExp("rgba"+E4(Mc,Mc,Mc,Mc)),dZe=new RegExp("hsl"+E4(Mc,iT,iT)),fZe=new RegExp("hsla"+E4(Mc,iT,iT,Mc)),hZe=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,pZe=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,mZe=/^#([0-9a-fA-F]{6})$/,gZe=/^#([0-9a-fA-F]{8})$/;function vZe(t){let e;return typeof t=="number"?t>>>0===t&&t>=0&&t<=4294967295?t:null:(e=mZe.exec(t))?parseInt(e[1]+"ff",16)>>>0:Hf&&Hf[t]!==void 0?Hf[t]:(e=lZe.exec(t))?(Cg(e[1])<<24|Cg(e[2])<<16|Cg(e[3])<<8|255)>>>0:(e=uZe.exec(t))?(Cg(e[1])<<24|Cg(e[2])<<16|Cg(e[3])<<8|_Y(e[4]))>>>0:(e=hZe.exec(t))?parseInt(e[1]+e[1]+e[2]+e[2]+e[3]+e[3]+"ff",16)>>>0:(e=gZe.exec(t))?parseInt(e[1],16)>>>0:(e=pZe.exec(t))?parseInt(e[1]+e[1]+e[2]+e[2]+e[3]+e[3]+e[4]+e[4],16)>>>0:(e=dZe.exec(t))?(yY(bY(e[1]),eE(e[2]),eE(e[3]))|255)>>>0:(e=fZe.exec(t))?(yY(bY(e[1]),eE(e[2]),eE(e[3]))|_Y(e[4]))>>>0:null}function _5(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*(2/3-n)*6:t}function yY(t,e,n){const r=n<.5?n*(1+e):n+e-n*e,i=2*n-r,s=_5(i,r,t+1/3),o=_5(i,r,t),a=_5(i,r,t-1/3);return Math.round(s*255)<<24|Math.round(o*255)<<16|Math.round(a*255)<<8}function Cg(t){const e=parseInt(t,10);return e<0?0:e>255?255:e}function bY(t){return(parseFloat(t)%360+360)%360/360}function _Y(t){const e=parseFloat(t);return e<0?0:e>1?255:Math.round(e*255)}function eE(t){const e=parseFloat(t);return e<0?0:e>100?1:e/100}function SY(t){let e=vZe(t);if(e===null)return t;e=e||0;const n=(e&4278190080)>>>24,r=(e&16711680)>>>16,i=(e&65280)>>>8,s=(e&255)/255;return`rgba(${n}, ${r}, ${i}, ${s})`}var C_=(t,e,n)=>{if(Ie.fun(t))return t;if(Ie.arr(t))return C_({range:t,output:e,extrapolate:n});if(Ie.str(t.output[0]))return XD(t);const r=t,i=r.output,s=r.range||[0,1],o=r.extrapolateLeft||r.extrapolate||"extend",a=r.extrapolateRight||r.extrapolate||"extend",c=r.easing||(l=>l);return l=>{const d=bZe(l,s);return yZe(l,s[d],s[d+1],i[d],i[d+1],c,o,a,r.map)}};function yZe(t,e,n,r,i,s,o,a,c){let l=c?c(t):t;if(l<e){if(o==="identity")return l;o==="clamp"&&(l=e)}if(l>n){if(a==="identity")return l;a==="clamp"&&(l=n)}return r===i?r:e===n?t<=e?r:i:(e===-1/0?l=-l:n===1/0?l=l-e:l=(l-e)/(n-e),l=s(l),r===-1/0?l=-l:i===1/0?l=l+r:l=l*(i-r)+r,l)}function bZe(t,e){for(var n=1;n<e.length-1&&!(e[n]>=t);++n);return n-1}var _Ze={linear:t=>t},T_=Symbol.for("FluidValue.get"),ly=Symbol.for("FluidValue.observers"),Oa=t=>!!(t&&t[T_]),to=t=>t&&t[T_]?t[T_]():t,wY=t=>t[ly]||null;function SZe(t,e){t.eventObserved?t.eventObserved(e):t(e)}function R_(t,e){const n=t[ly];n&&n.forEach(r=>{SZe(r,e)})}var Lhe=class{constructor(t){if(!t&&!(t=this.get))throw Error("Unknown getter");wZe(this,t)}},wZe=(t,e)=>Mhe(t,T_,e);function Hy(t,e){if(t[T_]){let n=t[ly];n||Mhe(t,ly,n=new Set),n.has(e)||(n.add(e),t.observerAdded&&t.observerAdded(n.size,e))}return e}function k_(t,e){const n=t[ly];if(n&&n.has(e)){const r=n.size-1;r?n.delete(e):t[ly]=null,t.observerRemoved&&t.observerRemoved(r,e)}}var Mhe=(t,e,n)=>Object.defineProperty(t,e,{value:n,writable:!0,configurable:!0}),hC=/[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,EZe=/(#(?:[0-9a-f]{2}){2,4}|(#[0-9a-f]{3})|(rgb|hsl)a?\((-?\d+%?[,\s]+){2,3}\s*[\d\.]+%?\))/gi,EY=new RegExp(`(${hC.source})(%|[a-z]+)`,"i"),CZe=/rgba\(([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+)\)/gi,C4=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/,Ohe=t=>{const[e,n]=TZe(t);if(!e||YD())return t;const r=window.getComputedStyle(document.documentElement).getPropertyValue(e);if(r)return r.trim();if(n&&n.startsWith("--")){const i=window.getComputedStyle(document.documentElement).getPropertyValue(n);return i||t}else{if(n&&C4.test(n))return Ohe(n);if(n)return n}return t},TZe=t=>{const e=C4.exec(t);if(!e)return[,];const[,n,r]=e;return[n,r]},S5,RZe=(t,e,n,r,i)=>`rgba(${Math.round(e)}, ${Math.round(n)}, ${Math.round(r)}, ${i})`,Phe=t=>{S5||(S5=Hf?new RegExp(`(${Object.keys(Hf).join("|")})(?!\\w)`,"g"):/^\b$/);const e=t.output.map(s=>to(s).replace(C4,Ohe).replace(EZe,SY).replace(S5,SY)),n=e.map(s=>s.match(hC).map(Number)),i=n[0].map((s,o)=>n.map(a=>{if(!(o in a))throw Error('The arity of each "output" value must be equal');return a[o]})).map(s=>C_({...t,output:s}));return s=>{const o=!EY.test(e[0])&&e.find(c=>EY.test(c))?.replace(hC,"");let a=0;return e[0].replace(hC,()=>`${i[a++](s)}${o||""}`).replace(CZe,RZe)}},QD="react-spring: ",Dhe=t=>{const e=t;let n=!1;if(typeof e!="function")throw new TypeError(`${QD}once requires a function parameter`);return(...r)=>{n||(e(...r),n=!0)}},kZe=Dhe(console.warn);function IZe(){kZe(`${QD}The "interpolate" function is deprecated in v9 (use "to" instead)`)}var xZe=Dhe(console.warn);function AZe(){xZe(`${QD}Directly calling start instead of using the api object is deprecated in v9 (use ".start" instead), this will be removed in later 0.X.0 versions`)}function T4(t){return Ie.str(t)&&(t[0]=="#"||/\d/.test(t)||!YD()&&C4.test(t)||t in(Hf||{}))}var Wg=YD()?_.useEffect:_.useLayoutEffect,LZe=()=>{const t=_.useRef(!1);return Wg(()=>(t.current=!0,()=>{t.current=!1}),[]),t};function Nhe(){const t=_.useState()[1],e=LZe();return()=>{e.current&&t(Math.random())}}var Uhe=t=>_.useEffect(t,MZe),MZe=[];function OZe(t){const e=_.useRef(void 0);return _.useEffect(()=>{e.current=t}),e.current}var I_=Symbol.for("Animated:node"),PZe=t=>!!t&&t[I_]===t,vl=t=>t&&t[I_],ZD=(t,e)=>iZe(t,I_,e),R4=t=>t&&t[I_]&&t[I_].getPayload(),jhe=class{constructor(){ZD(this,this)}getPayload(){return this.payload||[]}},k4=class Fhe extends jhe{constructor(e){super(),this._value=e,this.done=!0,this.durationProgress=0,Ie.num(this._value)&&(this.lastPosition=this._value)}static create(e){return new Fhe(e)}getPayload(){return[this]}getValue(){return this._value}setValue(e,n){return Ie.num(e)&&(this.lastPosition=e,n&&(e=Math.round(e/n)*n,this.done&&(this.lastPosition=e))),this._value===e?!1:(this._value=e,!0)}reset(){const{done:e}=this;this.done=!1,Ie.num(this._value)&&(this.elapsedTime=0,this.durationProgress=0,this.lastPosition=this._value,e&&(this.lastVelocity=null),this.v0=null)}},sT=class $he extends k4{constructor(e){super(0),this._string=null,this._toString=C_({output:[e,e]})}static create(e){return new $he(e)}getValue(){const e=this._string;return e??(this._string=this._toString(this._value))}setValue(e){if(Ie.str(e)){if(e==this._string)return!1;this._string=e,this._value=1}else if(super.setValue(e))this._string=null;else return!1;return!0}reset(e){e&&(this._toString=C_({output:[this.getValue(),e]})),this._value=0,super.reset()}},oT={dependencies:null},I4=class extends jhe{constructor(t){super(),this.source=t,this.setValue(t)}getValue(t){const e={};return Ol(this.source,(n,r)=>{PZe(n)?e[r]=n.getValue(t):Oa(n)?e[r]=to(n):t||(e[r]=n)}),e}setValue(t){this.source=t,this.payload=this._makePayload(t)}reset(){this.payload&&Pt(this.payload,t=>t.reset())}_makePayload(t){if(t){const e=new Set;return Ol(t,this._addToPayload,e),Array.from(e)}}_addToPayload(t){oT.dependencies&&Oa(t)&&oT.dependencies.add(t);const e=R4(t);e&&Pt(e,n=>this.add(n))}},DZe=class Bhe extends I4{constructor(e){super(e)}static create(e){return new Bhe(e)}getValue(){return this.source.map(e=>e.getValue())}setValue(e){const n=this.getPayload();return e.length==n.length?n.map((r,i)=>r.setValue(e[i])).some(Boolean):(super.setValue(e.map(NZe)),!0)}};function NZe(t){return(T4(t)?sT:k4).create(t)}function MO(t){const e=vl(t);return e?e.constructor:Ie.arr(t)?DZe:T4(t)?sT:k4}var CY=(t,e)=>{const n=!Ie.fun(t)||t.prototype&&t.prototype.isReactComponent;return _.forwardRef((r,i)=>{const s=_.useRef(null),o=n&&_.useCallback(y=>{s.current=FZe(i,y)},[i]),[a,c]=jZe(r,e),l=Nhe(),d=()=>{const y=s.current;if(n&&!y)return;(y?e.applyAnimatedValues(y,a.getValue(!0)):!1)===!1&&l()},h=new UZe(d,c),m=_.useRef(void 0);Wg(()=>(m.current=h,Pt(c,y=>Hy(y,h)),()=>{m.current&&(Pt(m.current.deps,y=>k_(y,m.current)),It.cancel(m.current.update))})),_.useEffect(d,[]),Uhe(()=>()=>{const y=m.current;Pt(y.deps,v=>k_(v,y))});const g=e.getComponentProps(a.getValue());return _.createElement(t,{...g,ref:o})})},UZe=class{constructor(t,e){this.update=t,this.deps=e}eventObserved(t){t.type=="change"&&It.write(this.update)}};function jZe(t,e){const n=new Set;return oT.dependencies=n,t.style&&(t={...t,style:e.createAnimatedStyle(t.style)}),t=new I4(t),oT.dependencies=null,[t,n]}function FZe(t,e){return t&&(Ie.fun(t)?t(e):t.current=e),e}var TY=Symbol.for("AnimatedComponent"),$Ze=(t,{applyAnimatedValues:e=()=>!1,createAnimatedStyle:n=i=>new I4(i),getComponentProps:r=i=>i}={})=>{const i={applyAnimatedValues:e,createAnimatedStyle:n,getComponentProps:r},s=o=>{const a=RY(o)||"Anonymous";return Ie.str(o)?o=s[o]||(s[o]=CY(o,i)):o=o[TY]||(o[TY]=CY(o,i)),o.displayName=`Animated(${a})`,o};return Ol(t,(o,a)=>{Ie.arr(t)&&(a=RY(o)),s[a]=s(o)}),{animated:s}},RY=t=>Ie.str(t)?t:t&&Ie.str(t.displayName)?t.displayName:Ie.fun(t)&&t.name||null;function no(t,...e){return Ie.fun(t)?t(...e):t}var _b=(t,e)=>t===!0||!!(e&&t&&(Ie.fun(t)?t(e):Ps(t).includes(e))),Hhe=(t,e)=>Ie.obj(t)?e&&t[e]:t,qhe=(t,e)=>t.default===!0?t[e]:t.default?t.default[e]:void 0,BZe=t=>t,eN=(t,e=BZe)=>{let n=HZe;t.default&&t.default!==!0&&(t=t.default,n=Object.keys(t));const r={};for(const i of n){const s=e(t[i],i);Ie.und(s)||(r[i]=s)}return r},HZe=["config","onProps","onStart","onChange","onPause","onResume","onRest"],qZe={config:1,from:1,to:1,ref:1,loop:1,reset:1,pause:1,cancel:1,reverse:1,immediate:1,default:1,delay:1,onProps:1,onStart:1,onChange:1,onPause:1,onResume:1,onRest:1,onResolve:1,items:1,trail:1,sort:1,expires:1,initial:1,enter:1,update:1,leave:1,children:1,onDestroyed:1,keys:1,callId:1,parentId:1};function VZe(t){const e={};let n=0;if(Ol(t,(r,i)=>{qZe[i]||(e[i]=r,n++)}),n)return e}function tN(t){const e=VZe(t);if(e){const n={to:e};return Ol(t,(r,i)=>i in e||(n[i]=r)),n}return{...t}}function x_(t){return t=to(t),Ie.arr(t)?t.map(x_):T4(t)?Fc.createStringInterpolator({range:[0,1],output:[t,t]})(1):t}function KZe(t){for(const e in t)return!0;return!1}function OO(t){return Ie.fun(t)||Ie.arr(t)&&Ie.obj(t[0])}function kY(t,e){t.ref?.delete(t),e?.delete(t)}function GZe(t,e){e&&t.ref!==e&&(t.ref?.delete(t),e.add(t),t.ref=e)}var zZe={default:{tension:170,friction:26}},PO={...zZe.default,mass:1,damping:1,easing:_Ze.linear,clamp:!1},WZe=class{constructor(){this.velocity=0,Object.assign(this,PO)}};function YZe(t,e,n){n&&(n={...n},IY(n,e),e={...n,...e}),IY(t,e),Object.assign(t,e);for(const o in PO)t[o]==null&&(t[o]=PO[o]);let{frequency:r,damping:i}=t;const{mass:s}=t;return Ie.und(r)||(r<.01&&(r=.01),i<0&&(i=0),t.tension=Math.pow(2*Math.PI/r,2)*s,t.friction=4*Math.PI*i*s/r),t}function IY(t,e){if(!Ie.und(e.decay))t.duration=void 0;else{const n=!Ie.und(e.tension)||!Ie.und(e.friction);(n||!Ie.und(e.frequency)||!Ie.und(e.damping)||!Ie.und(e.mass))&&(t.duration=void 0,t.decay=void 0),n&&(t.frequency=void 0)}}var xY=[],XZe=class{constructor(){this.changed=!1,this.values=xY,this.toValues=null,this.fromValues=xY,this.config=new WZe,this.immediate=!1}};function Vhe(t,{key:e,props:n,defaultProps:r,state:i,actions:s}){return new Promise((o,a)=>{let c,l,d=_b(n.cancel??r?.cancel,e);if(d)g();else{Ie.und(n.pause)||(i.paused=_b(n.pause,e));let y=r?.pause;y!==!0&&(y=i.paused||_b(y,e)),c=no(n.delay||0,e),y?(i.resumeQueue.add(m),s.pause()):(s.resume(),m())}function h(){i.resumeQueue.add(m),i.timeouts.delete(l),l.cancel(),c=l.time-It.now()}function m(){c>0&&!Fc.skipAnimation?(i.delayed=!0,l=It.setTimeout(g,c),i.pauseQueue.add(h),i.timeouts.add(l)):g()}function g(){i.delayed&&(i.delayed=!1),i.pauseQueue.delete(h),i.timeouts.delete(l),t<=(i.cancelId||0)&&(d=!0);try{s.start({...n,callId:t,cancel:d},o)}catch(y){a(y)}}})}var nN=(t,e)=>e.length==1?e[0]:e.some(n=>n.cancelled)?Cv(t.get()):e.every(n=>n.noop)?Khe(t.get()):Cc(t.get(),e.every(n=>n.finished)),Khe=t=>({value:t,noop:!0,finished:!0,cancelled:!1}),Cc=(t,e,n=!1)=>({value:t,finished:e,cancelled:n}),Cv=t=>({value:t,cancelled:!0,finished:!1});function Ghe(t,e,n,r){const{callId:i,parentId:s,onRest:o}=e,{asyncTo:a,promise:c}=n;return!s&&t===a&&!e.reset?c:n.promise=(async()=>{n.asyncId=i,n.asyncTo=t;const l=eN(e,(E,w)=>w==="onRest"?void 0:E);let d,h;const m=new Promise((E,w)=>(d=E,h=w)),g=E=>{const w=i<=(n.cancelId||0)&&Cv(r)||i!==n.asyncId&&Cc(r,!1);if(w)throw E.result=w,h(E),E},y=(E,w)=>{const R=new AY,x=new LY;return(async()=>{if(Fc.skipAnimation)throw A_(n),x.result=Cc(r,!1),h(x),x;g(R);const C=Ie.obj(E)?{...E}:{...w,to:E};C.parentId=i,Ol(l,(T,L)=>{Ie.und(C[L])&&(C[L]=T)});const k=await r.start(C);return g(R),n.paused&&await new Promise(T=>{n.resumeQueue.add(T)}),k})()};let v;if(Fc.skipAnimation)return A_(n),Cc(r,!1);try{let E;Ie.arr(t)?E=(async w=>{for(const R of w)await y(R)})(t):E=Promise.resolve(t(y,r.stop.bind(r))),await Promise.all([E.then(d),m]),v=Cc(r.get(),!0,!1)}catch(E){if(E instanceof AY)v=E.result;else if(E instanceof LY)v=E.result;else throw E}finally{i==n.asyncId&&(n.asyncId=s,n.asyncTo=s?a:void 0,n.promise=s?c:void 0)}return Ie.fun(o)&&It.batchedUpdates(()=>{o(v,r,r.item)}),v})()}function A_(t,e){yb(t.timeouts,n=>n.cancel()),t.pauseQueue.clear(),t.resumeQueue.clear(),t.asyncId=t.asyncTo=t.promise=void 0,e&&(t.cancelId=e)}var AY=class extends Error{constructor(){super("An async animation has been interrupted. You see this error because you forgot to use `await` or `.catch(...)` on its returned promise.")}},LY=class extends Error{constructor(){super("SkipAnimationSignal")}},DO=t=>t instanceof rN,JZe=1,rN=class extends Lhe{constructor(){super(...arguments),this.id=JZe++,this._priority=0}get priority(){return this._priority}set priority(t){this._priority!=t&&(this._priority=t,this._onPriorityChange(t))}get(){const t=vl(this);return t&&t.getValue()}to(...t){return Fc.to(this,t)}interpolate(...t){return IZe(),Fc.to(this,t)}toJSON(){return this.get()}observerAdded(t){t==1&&this._attach()}observerRemoved(t){t==0&&this._detach()}_attach(){}_detach(){}_onChange(t,e=!1){R_(this,{type:"change",parent:this,value:t,idle:e})}_onPriorityChange(t){this.idle||w4.sort(this),R_(this,{type:"priority",parent:this,priority:t})}},Gp=Symbol.for("SpringPhase"),zhe=1,NO=2,UO=4,w5=t=>(t[Gp]&zhe)>0,ef=t=>(t[Gp]&NO)>0,w1=t=>(t[Gp]&UO)>0,MY=(t,e)=>e?t[Gp]|=NO|zhe:t[Gp]&=~NO,OY=(t,e)=>e?t[Gp]|=UO:t[Gp]&=~UO,QZe=class extends rN{constructor(t,e){if(super(),this.animation=new XZe,this.defaultProps={},this._state={paused:!1,delayed:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._pendingCalls=new Set,this._lastCallId=0,this._lastToId=0,this._memoizedDuration=0,!Ie.und(t)||!Ie.und(e)){const n=Ie.obj(t)?{...t}:{...e,from:t};Ie.und(n.default)&&(n.default=!0),this.start(n)}}get idle(){return!(ef(this)||this._state.asyncTo)||w1(this)}get goal(){return to(this.animation.to)}get velocity(){const t=vl(this);return t instanceof k4?t.lastVelocity||0:t.getPayload().map(e=>e.lastVelocity||0)}get hasAnimated(){return w5(this)}get isAnimating(){return ef(this)}get isPaused(){return w1(this)}get isDelayed(){return this._state.delayed}advance(t){let e=!0,n=!1;const r=this.animation;let{toValues:i}=r;const{config:s}=r,o=R4(r.to);!o&&Oa(r.to)&&(i=Ps(to(r.to))),r.values.forEach((l,d)=>{if(l.done)return;const h=l.constructor==sT?1:o?o[d].lastPosition:i[d];let m=r.immediate,g=h;if(!m){if(g=l.lastPosition,s.tension<=0){l.done=!0;return}let y=l.elapsedTime+=t;const v=r.fromValues[d],E=l.v0!=null?l.v0:l.v0=Ie.arr(s.velocity)?s.velocity[d]:s.velocity;let w;const R=s.precision||(v==h?.005:Math.min(1,Math.abs(h-v)*.001));if(Ie.und(s.duration))if(s.decay){const x=s.decay===!0?.998:s.decay,C=Math.exp(-(1-x)*y);g=v+E/(1-x)*(1-C),m=Math.abs(l.lastPosition-g)<=R,w=E*C}else{w=l.lastVelocity==null?E:l.lastVelocity;const x=s.restVelocity||R/10,C=s.clamp?0:s.bounce,k=!Ie.und(C),T=v==h?l.v0>0:v<h;let L,O=!1;const P=1,D=Math.ceil(t/P);for(let j=0;j<D&&(L=Math.abs(w)>x,!(!L&&(m=Math.abs(h-g)<=R,m)));++j){k&&(O=g==h||g>h==T,O&&(w=-w*C,g=h));const H=-s.tension*1e-6*(g-h),z=-s.friction*.001*w,Y=(H+z)/s.mass;w=w+Y*P,g=g+w*P}}else{let x=1;s.duration>0&&(this._memoizedDuration!==s.duration&&(this._memoizedDuration=s.duration,l.durationProgress>0&&(l.elapsedTime=s.duration*l.durationProgress,y=l.elapsedTime+=t)),x=(s.progress||0)+y/this._memoizedDuration,x=x>1?1:x<0?0:x,l.durationProgress=x),g=v+s.easing(x)*(h-v),w=(g-l.lastPosition)/t,m=x==1}l.lastVelocity=w,Number.isNaN(g)&&(console.warn("Got NaN while animating:",this),m=!0)}o&&!o[d].done&&(m=!1),m?l.done=!0:e=!1,l.setValue(g,s.round)&&(n=!0)});const a=vl(this),c=a.getValue();if(e){const l=to(r.to);(c!==l||n)&&!s.decay?(a.setValue(l),this._onChange(l)):n&&s.decay&&this._onChange(c),this._stop()}else n&&this._onChange(c)}set(t){return It.batchedUpdates(()=>{this._stop(),this._focus(t),this._set(t)}),this}pause(){this._update({pause:!0})}resume(){this._update({pause:!1})}finish(){if(ef(this)){const{to:t,config:e}=this.animation;It.batchedUpdates(()=>{this._onStart(),e.decay||this._set(t,!1),this._stop()})}return this}update(t){return(this.queue||(this.queue=[])).push(t),this}start(t,e){let n;return Ie.und(t)?(n=this.queue||[],this.queue=[]):n=[Ie.obj(t)?t:{...e,to:t}],Promise.all(n.map(r=>this._update(r))).then(r=>nN(this,r))}stop(t){const{to:e}=this.animation;return this._focus(this.get()),A_(this._state,t&&this._lastCallId),It.batchedUpdates(()=>this._stop(e,t)),this}reset(){this._update({reset:!0})}eventObserved(t){t.type=="change"?this._start():t.type=="priority"&&(this.priority=t.priority+1)}_prepareNode(t){const e=this.key||"";let{to:n,from:r}=t;n=Ie.obj(n)?n[e]:n,(n==null||OO(n))&&(n=void 0),r=Ie.obj(r)?r[e]:r,r==null&&(r=void 0);const i={to:n,from:r};return w5(this)||(t.reverse&&([n,r]=[r,n]),r=to(r),Ie.und(r)?vl(this)||this._set(n):this._set(r)),i}_update({...t},e){const{key:n,defaultProps:r}=this;t.default&&Object.assign(r,eN(t,(o,a)=>/^on/.test(a)?Hhe(o,n):o)),DY(this,t,"onProps"),C1(this,"onProps",t,this);const i=this._prepareNode(t);if(Object.isFrozen(this))throw Error("Cannot animate a `SpringValue` object that is frozen. Did you forget to pass your component to `animated(...)` before animating its props?");const s=this._state;return Vhe(++this._lastCallId,{key:n,props:t,defaultProps:r,state:s,actions:{pause:()=>{w1(this)||(OY(this,!0),j1(s.pauseQueue),C1(this,"onPause",Cc(this,E1(this,this.animation.to)),this))},resume:()=>{w1(this)&&(OY(this,!1),ef(this)&&this._resume(),j1(s.resumeQueue),C1(this,"onResume",Cc(this,E1(this,this.animation.to)),this))},start:this._merge.bind(this,i)}}).then(o=>{if(t.loop&&o.finished&&!(e&&o.noop)){const a=Whe(t);if(a)return this._update(a,!0)}return o})}_merge(t,e,n){if(e.cancel)return this.stop(!0),n(Cv(this));const r=!Ie.und(t.to),i=!Ie.und(t.from);if(r||i)if(e.callId>this._lastToId)this._lastToId=e.callId;else return n(Cv(this));const{key:s,defaultProps:o,animation:a}=this,{to:c,from:l}=a;let{to:d=c,from:h=l}=t;i&&!r&&(!e.default||Ie.und(d))&&(d=h),e.reverse&&([d,h]=[h,d]);const m=!Cu(h,l);m&&(a.from=h),h=to(h);const g=!Cu(d,c);g&&this._focus(d);const y=OO(e.to),{config:v}=a,{decay:E,velocity:w}=v;(r||i)&&(v.velocity=0),e.config&&!y&&YZe(v,no(e.config,s),e.config!==o.config?no(o.config,s):void 0);let R=vl(this);if(!R||Ie.und(d))return n(Cc(this,!0));const x=Ie.und(e.reset)?i&&!e.default:!Ie.und(h)&&_b(e.reset,s),C=x?h:this.get(),k=x_(d),T=Ie.num(k)||Ie.arr(k)||T4(k),L=!y&&(!T||_b(o.immediate||e.immediate,s));if(g){const j=MO(d);if(j!==R.constructor)if(L)R=this._set(k);else throw Error(`Cannot animate between ${R.constructor.name} and ${j.name}, as the "to" prop suggests`)}const O=R.constructor;let P=Oa(d),D=!1;if(!P){const j=x||!w5(this)&&m;(g||j)&&(D=Cu(x_(C),k),P=!D),(!Cu(a.immediate,L)&&!L||!Cu(v.decay,E)||!Cu(v.velocity,w))&&(P=!0)}if(D&&ef(this)&&(a.changed&&!x?P=!0:P||this._stop(c)),!y&&((P||Oa(c))&&(a.values=R.getPayload(),a.toValues=Oa(d)?null:O==sT?[1]:Ps(k)),a.immediate!=L&&(a.immediate=L,!L&&!x&&this._set(c)),P)){const{onRest:j}=a;Pt(ZZe,z=>DY(this,e,z));const H=Cc(this,E1(this,c));j1(this._pendingCalls,H),this._pendingCalls.add(n),a.changed&&It.batchedUpdates(()=>{a.changed=!x,j?.(H,this),x?no(o.onRest,H):a.onStart?.(H,this)})}x&&this._set(C),y?n(Ghe(e.to,e,this._state,this)):P?this._start():ef(this)&&!g?this._pendingCalls.add(n):n(Khe(C))}_focus(t){const e=this.animation;t!==e.to&&(wY(this)&&this._detach(),e.to=t,wY(this)&&this._attach())}_attach(){let t=0;const{to:e}=this.animation;Oa(e)&&(Hy(e,this),DO(e)&&(t=e.priority+1)),this.priority=t}_detach(){const{to:t}=this.animation;Oa(t)&&k_(t,this)}_set(t,e=!0){const n=to(t);if(!Ie.und(n)){const r=vl(this);if(!r||!Cu(n,r.getValue())){const i=MO(n);!r||r.constructor!=i?ZD(this,i.create(n)):r.setValue(n),r&&It.batchedUpdates(()=>{this._onChange(n,e)})}}return vl(this)}_onStart(){const t=this.animation;t.changed||(t.changed=!0,C1(this,"onStart",Cc(this,E1(this,t.to)),this))}_onChange(t,e){e||(this._onStart(),no(this.animation.onChange,t,this)),no(this.defaultProps.onChange,t,this),super._onChange(t,e)}_start(){const t=this.animation;vl(this).reset(to(t.to)),t.immediate||(t.fromValues=t.values.map(e=>e.lastPosition)),ef(this)||(MY(this,!0),w1(this)||this._resume())}_resume(){Fc.skipAnimation?this.finish():w4.start(this)}_stop(t,e){if(ef(this)){MY(this,!1);const n=this.animation;Pt(n.values,i=>{i.done=!0}),n.toValues&&(n.onChange=n.onPause=n.onResume=void 0),R_(this,{type:"idle",parent:this});const r=e?Cv(this.get()):Cc(this.get(),E1(this,t??n.to));j1(this._pendingCalls,r),n.changed&&(n.changed=!1,C1(this,"onRest",r,this))}}};function E1(t,e){const n=x_(e),r=x_(t.get());return Cu(r,n)}function Whe(t,e=t.loop,n=t.to){const r=no(e);if(r){const i=r!==!0&&tN(r),s=(i||t).reverse,o=!i||i.reset;return aT({...t,loop:e,default:!1,pause:void 0,to:!s||OO(n)?n:void 0,from:o?t.from:void 0,reset:o,...i})}}function aT(t){const{to:e,from:n}=t=tN(t),r=new Set;return Ie.obj(e)&&PY(e,r),Ie.obj(n)&&PY(n,r),t.keys=r.size?Array.from(r):null,t}function PY(t,e){Ol(t,(n,r)=>n!=null&&e.add(r))}var ZZe=["onStart","onRest","onChange","onPause","onResume"];function DY(t,e,n){t.animation[n]=e[n]!==qhe(e,n)?Hhe(e[n],t.key):void 0}function C1(t,e,...n){t.animation[e]?.(...n),t.defaultProps[e]?.(...n)}var eet=["onStart","onChange","onRest"],tet=1,net=class{constructor(e,n){this.id=tet++,this.springs={},this.queue=[],this._lastAsyncId=0,this._active=new Set,this._changed=new Set,this._started=!1,this._state={paused:!1,pauseQueue:new Set,resumeQueue:new Set,timeouts:new Set},this._events={onStart:new Map,onChange:new Map,onRest:new Map},this._onFrame=this._onFrame.bind(this),n&&(this._flush=n),e&&this.start({default:!0,...e})}get idle(){return!this._state.asyncTo&&Object.values(this.springs).every(e=>e.idle&&!e.isDelayed&&!e.isPaused)}get item(){return this._item}set item(e){this._item=e}get(){const e={};return this.each((n,r)=>e[r]=n.get()),e}set(e){for(const n in e){const r=e[n];Ie.und(r)||this.springs[n].set(r)}}update(e){return e&&this.queue.push(aT(e)),this}start(e){let{queue:n}=this;return e?n=Ps(e).map(aT):this.queue=[],this._flush?this._flush(this,n):(Qhe(this,n),ret(this,n))}stop(e,n){if(e!==!!e&&(n=e),n){const r=this.springs;Pt(Ps(n),i=>r[i].stop(!!e))}else A_(this._state,this._lastAsyncId),this.each(r=>r.stop(!!e));return this}pause(e){if(Ie.und(e))this.start({pause:!0});else{const n=this.springs;Pt(Ps(e),r=>n[r].pause())}return this}resume(e){if(Ie.und(e))this.start({pause:!1});else{const n=this.springs;Pt(Ps(e),r=>n[r].resume())}return this}each(e){Ol(this.springs,e)}_onFrame(){const{onStart:e,onChange:n,onRest:r}=this._events,i=this._active.size>0,s=this._changed.size>0;(i&&!this._started||s&&!this._started)&&(this._started=!0,yb(e,([c,l])=>{l.value=this.get(),c(l,this,this._item)}));const o=!i&&this._started,a=s||o&&r.size?this.get():null;s&&n.size&&yb(n,([c,l])=>{l.value=a,c(l,this,this._item)}),o&&(this._started=!1,yb(r,([c,l])=>{l.value=a,c(l,this,this._item)}))}eventObserved(e){if(e.type=="change")this._changed.add(e.parent),e.idle||this._active.add(e.parent);else if(e.type=="idle")this._active.delete(e.parent);else return;It.onFrame(this._onFrame)}};function ret(t,e){return Promise.all(e.map(n=>Yhe(t,n))).then(n=>nN(t,n))}async function Yhe(t,e,n){const{keys:r,to:i,from:s,loop:o,onRest:a,onResolve:c}=e,l=Ie.obj(e.default)&&e.default;o&&(e.loop=!1),i===!1&&(e.to=null),s===!1&&(e.from=null);const d=Ie.arr(i)||Ie.fun(i)?i:void 0;d?(e.to=void 0,e.onRest=void 0,l&&(l.onRest=void 0)):Pt(eet,v=>{const E=e[v];if(Ie.fun(E)){const w=t._events[v];e[v]=({finished:R,cancelled:x})=>{const C=w.get(E);C?(R||(C.finished=!1),x&&(C.cancelled=!0)):w.set(E,{value:null,finished:R||!1,cancelled:x||!1})},l&&(l[v]=e[v])}});const h=t._state;e.pause===!h.paused?(h.paused=e.pause,j1(e.pause?h.pauseQueue:h.resumeQueue)):h.paused&&(e.pause=!0);const m=(r||Object.keys(t.springs)).map(v=>t.springs[v].start(e)),g=e.cancel===!0||qhe(e,"cancel")===!0;(d||g&&h.asyncId)&&m.push(Vhe(++t._lastAsyncId,{props:e,state:h,actions:{pause:AO,resume:AO,start(v,E){g?(A_(h,t._lastAsyncId),E(Cv(t))):(v.onRest=a,E(Ghe(d,v,h,t)))}}})),h.paused&&await new Promise(v=>{h.resumeQueue.add(v)});const y=nN(t,await Promise.all(m));if(o&&y.finished&&!(n&&y.noop)){const v=Whe(e,o,i);if(v)return Qhe(t,[v]),Yhe(t,v,!0)}return c&&It.batchedUpdates(()=>c(y,t,t.item)),y}function iet(t,e){const n={...t.springs};return e&&Pt(Ps(e),r=>{Ie.und(r.keys)&&(r=aT(r)),Ie.obj(r.to)||(r={...r,to:void 0}),Jhe(n,r,i=>Xhe(i))}),set(t,n),n}function set(t,e){Ol(e,(n,r)=>{t.springs[r]||(t.springs[r]=n,Hy(n,t))})}function Xhe(t,e){const n=new QZe;return n.key=t,e&&Hy(n,e),n}function Jhe(t,e,n){e.keys&&Pt(e.keys,r=>{(t[r]||(t[r]=n(r)))._prepareNode(e)})}function Qhe(t,e){Pt(e,n=>{Jhe(t.springs,n,r=>Xhe(r,t))})}var oet=_.createContext({pause:!1,immediate:!1}),aet=()=>{const t=[],e=function(r){AZe();const i=[];return Pt(t,(s,o)=>{if(Ie.und(r))i.push(s.start());else{const a=n(r,s,o);a&&i.push(s.start(a))}}),i};e.current=t,e.add=function(r){t.includes(r)||t.push(r)},e.delete=function(r){const i=t.indexOf(r);~i&&t.splice(i,1)},e.pause=function(){return Pt(t,r=>r.pause(...arguments)),this},e.resume=function(){return Pt(t,r=>r.resume(...arguments)),this},e.set=function(r){Pt(t,(i,s)=>{const o=Ie.fun(r)?r(s,i):r;o&&i.set(o)})},e.start=function(r){const i=[];return Pt(t,(s,o)=>{if(Ie.und(r))i.push(s.start());else{const a=this._getProps(r,s,o);a&&i.push(s.start(a))}}),i},e.stop=function(){return Pt(t,r=>r.stop(...arguments)),this},e.update=function(r){return Pt(t,(i,s)=>i.update(this._getProps(r,i,s))),this};const n=function(r,i,s){return Ie.fun(r)?r(s,i):r};return e._getProps=n,e};function cet(t,e,n){const r=Ie.fun(e)&&e,{reset:i,sort:s,trail:o=0,expires:a=!0,exitBeforeEnter:c=!1,onDestroyed:l,ref:d,config:h}=r?r():e,m=_.useMemo(()=>r||arguments.length==3?aet():void 0,[]),g=Ps(t),y=[],v=_.useRef(null),E=i?null:v.current;Wg(()=>{v.current=y}),Uhe(()=>(Pt(y,Y=>{m?.add(Y.ctrl),Y.ctrl.ref=m}),()=>{Pt(v.current,Y=>{Y.expired&&clearTimeout(Y.expirationId),kY(Y.ctrl,m),Y.ctrl.stop(!0)})}));const w=det(g,r?r():e,E),R=i&&v.current||[];Wg(()=>Pt(R,({ctrl:Y,item:W,key:F})=>{kY(Y,m),no(l,W,F)}));const x=[];if(E&&Pt(E,(Y,W)=>{Y.expired?(clearTimeout(Y.expirationId),R.push(Y)):(W=x[W]=w.indexOf(Y.key),~W&&(y[W]=Y))}),Pt(g,(Y,W)=>{y[W]||(y[W]={key:w[W],item:Y,phase:"mount",ctrl:new net},y[W].ctrl.item=Y)}),x.length){let Y=-1;const{leave:W}=r?r():e;Pt(x,(F,$)=>{const V=E[$];~F?(Y=y.indexOf(V),y[Y]={...V,item:g[F]}):W&&y.splice(++Y,0,V)})}Ie.fun(s)&&y.sort((Y,W)=>s(Y.item,W.item));let C=-o;const k=Nhe(),T=eN(e),L=new Map,O=_.useRef(new Map),P=_.useRef(!1);Pt(y,(Y,W)=>{const F=Y.key,$=Y.phase,V=r?r():e;let G,Z;const q=no(V.delay||0,F);if($=="mount")G=V.enter,Z="enter";else{const Re=w.indexOf(F)<0;if($!="leave")if(Re)G=V.leave,Z="leave";else if(G=V.update)Z="update";else return;else if(!Re)G=V.enter,Z="enter";else return}if(G=no(G,Y.item,W),G=Ie.obj(G)?tN(G):{to:G},!G.config){const Re=h||T.config;G.config=no(Re,Y.item,W,Z)}C+=o;const J={...T,delay:q+C,ref:d,immediate:V.immediate,reset:!1,...G};if(Z=="enter"&&Ie.und(J.from)){const Re=r?r():e,we=Ie.und(Re.initial)||E?Re.from:Re.initial;J.from=no(we,Y.item,W)}const{onResolve:ue}=J;J.onResolve=Re=>{no(ue,Re);const we=v.current,de=we.find(ke=>ke.key===F);if(de&&!(Re.cancelled&&de.phase!="update")&&de.ctrl.idle){const ke=we.every(De=>De.ctrl.idle);if(de.phase=="leave"){const De=no(a,de.item);if(De!==!1){const Je=De===!0?0:De;if(de.expired=!0,!ke&&Je>0){Je<=2147483647&&(de.expirationId=setTimeout(k,Je));return}}}ke&&we.some(De=>De.expired)&&(O.current.delete(de),c&&(P.current=!0),k())}};const ge=iet(Y.ctrl,J);Z==="leave"&&c?O.current.set(Y,{phase:Z,springs:ge,payload:J}):L.set(Y,{phase:Z,springs:ge,payload:J})});const D=_.useContext(oet),j=OZe(D),H=D!==j&&KZe(D);Wg(()=>{H&&Pt(y,Y=>{Y.ctrl.start({default:D})})},[D]),Pt(L,(Y,W)=>{if(O.current.size){const F=y.findIndex($=>$.key===W.key);y.splice(F,1)}}),Wg(()=>{Pt(O.current.size?O.current:L,({phase:Y,payload:W},F)=>{const{ctrl:$}=F;F.phase=Y,m?.add($),H&&Y=="enter"&&$.start({default:D}),W&&(GZe($,W.ref),($.ref||m)&&!P.current?$.update(W):($.start(W),P.current&&(P.current=!1)))})},i?void 0:n);const z=Y=>_.createElement(_.Fragment,null,y.map((W,F)=>{const{springs:$}=L.get(W)||W.ctrl,V=Y({...$},W.item,W,F),G=Ie.str(W.key)||Ie.num(W.key)?W.key:W.ctrl.id,Z=_.version<"19.0.0",q=V?.props??{},J=Z?V?.ref:q?.ref;return V&&V.type?_.createElement(V.type,{...q,key:G,ref:J}):V}));return m?[z,m]:z}var uet=1;function det(t,{key:e,keys:n=e},r){if(n===null){const i=new Set;return t.map(s=>{const o=r&&r.find(a=>a.item===s&&a.phase!=="leave"&&!i.has(a));return o?(i.add(o),o.key):uet++})}return Ie.und(n)?t:Ie.fun(n)?t.map(n):Ps(n)}var fet=class extends rN{constructor(t,e){super(),this.source=t,this.idle=!0,this._active=new Set,this.calc=C_(...e);const n=this._get(),r=MO(n);ZD(this,r.create(n))}advance(t){const e=this._get(),n=this.get();Cu(e,n)||(vl(this).setValue(e),this._onChange(e,this.idle)),!this.idle&&NY(this._active)&&E5(this)}_get(){const t=Ie.arr(this.source)?this.source.map(to):Ps(to(this.source));return this.calc(...t)}_start(){this.idle&&!NY(this._active)&&(this.idle=!1,Pt(R4(this),t=>{t.done=!1}),Fc.skipAnimation?(It.batchedUpdates(()=>this.advance()),E5(this)):w4.start(this))}_attach(){let t=1;Pt(Ps(this.source),e=>{Oa(e)&&Hy(e,this),DO(e)&&(e.idle||this._active.add(e),t=Math.max(t,e.priority+1))}),this.priority=t,this._start()}_detach(){Pt(Ps(this.source),t=>{Oa(t)&&k_(t,this)}),this._active.clear(),E5(this)}eventObserved(t){t.type=="change"?t.idle?this.advance():(this._active.add(t.parent),this._start()):t.type=="idle"?this._active.delete(t.parent):t.type=="priority"&&(this.priority=Ps(this.source).reduce((e,n)=>Math.max(e,(DO(n)?n.priority:0)+1),0))}};function het(t){return t.idle!==!1}function NY(t){return!t.size||Array.from(t).every(het)}function E5(t){t.idle||(t.idle=!0,Pt(R4(t),e=>{e.done=!0}),R_(t,{type:"idle",parent:t}))}Fc.assign({createStringInterpolator:Phe,to:(t,e)=>new fet(t,e)});var Zhe=/^--/;function pet(t,e){return e==null||typeof e=="boolean"||e===""?"":typeof e=="number"&&e!==0&&!Zhe.test(t)&&!(Sb.hasOwnProperty(t)&&Sb[t])?e+"px":(""+e).trim()}var UY={};function met(t,e){if(!t.nodeType||!t.setAttribute)return!1;const n=t.nodeName==="filter"||t.parentNode&&t.parentNode.nodeName==="filter",{className:r,style:i,children:s,scrollTop:o,scrollLeft:a,viewBox:c,...l}=e,d=Object.values(l),h=Object.keys(l).map(m=>n||t.hasAttribute(m)?m:UY[m]||(UY[m]=m.replace(/([A-Z])/g,g=>"-"+g.toLowerCase())));s!==void 0&&(t.textContent=s);for(const m in i)if(i.hasOwnProperty(m)){const g=pet(m,i[m]);Zhe.test(m)?t.style.setProperty(m,g):t.style[m]=g}h.forEach((m,g)=>{t.setAttribute(m,d[g])}),r!==void 0&&(t.className=r),o!==void 0&&(t.scrollTop=o),a!==void 0&&(t.scrollLeft=a),c!==void 0&&t.setAttribute("viewBox",c)}var Sb={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},get=(t,e)=>t+e.charAt(0).toUpperCase()+e.substring(1),vet=["Webkit","Ms","Moz","O"];Sb=Object.keys(Sb).reduce((t,e)=>(vet.forEach(n=>t[get(n,e)]=t[e]),t),Sb);var yet=/^(matrix|translate|scale|rotate|skew)/,bet=/^(translate)/,_et=/^(rotate|skew)/,C5=(t,e)=>Ie.num(t)&&t!==0?t+e:t,pC=(t,e)=>Ie.arr(t)?t.every(n=>pC(n,e)):Ie.num(t)?t===e:parseFloat(t)===e,wet=class extends I4{constructor({x:t,y:e,z:n,...r}){const i=[],s=[];(t||e||n)&&(i.push([t||0,e||0,n||0]),s.push(o=>[`translate3d(${o.map(a=>C5(a,"px")).join(",")})`,pC(o,0)])),Ol(r,(o,a)=>{if(a==="transform")i.push([o||""]),s.push(c=>[c,c===""]);else if(yet.test(a)){if(delete r[a],Ie.und(o))return;const c=bet.test(a)?"px":_et.test(a)?"deg":"";i.push(Ps(o)),s.push(a==="rotate3d"?([l,d,h,m])=>[`rotate3d(${l},${d},${h},${C5(m,c)})`,pC(m,0)]:l=>[`${a}(${l.map(d=>C5(d,c)).join(",")})`,pC(l,a.startsWith("scale")?1:0)])}}),i.length&&(r.transform=new Eet(i,s)),super(r)}},Eet=class extends Lhe{constructor(t,e){super(),this.inputs=t,this.transforms=e,this._value=null}get(){return this._value||(this._value=this._get())}_get(){let t="",e=!0;return Pt(this.inputs,(n,r)=>{const i=to(n[0]),[s,o]=this.transforms[r](Ie.arr(i)?i:n.map(to));t+=" "+s,e=e&&o}),e?"none":t}observerAdded(t){t==1&&Pt(this.inputs,e=>Pt(e,n=>Oa(n)&&Hy(n,this)))}observerRemoved(t){t==0&&Pt(this.inputs,e=>Pt(e,n=>Oa(n)&&k_(n,this)))}eventObserved(t){t.type=="change"&&(this._value=null),R_(this,t)}},Cet=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"];Fc.assign({batchedUpdates:em.unstable_batchedUpdates,createStringInterpolator:Phe,colors:cZe});var Tet=$Ze(Cet,{applyAnimatedValues:met,createAnimatedStyle:t=>new wet(t),getComponentProps:({scrollTop:t,scrollLeft:e,...n})=>n}),epe=Tet.animated;const Ret="_media_1yzvo_8",ket="_mirror_1yzvo_27",Iet="_bg_1yzvo_39",xet="_avatar_1yzvo_47",Aet="_fg_1yzvo_72",Let="_nameTag_1yzvo_86",Met="_status_1yzvo_103",Oet="_reactions_1yzvo_122",Pet="_name_1yzvo_86",Det="_errorIcon_1yzvo_141",pc={media:Ret,mirror:ket,bg:Iet,avatar:xet,fg:Aet,nameTag:Let,status:Met,reactions:Oet,name:Pet,errorIcon:Det},Net="_reactionIndicatorWidget_14f9a_1",Uet="_reactionIndicatorWidgetLarge_14f9a_21",jet="_reactionLarge_14f9a_28",Fet="_reaction_14f9a_1",tE={reactionIndicatorWidget:Net,reactionIndicatorWidgetLarge:Uet,reactionLarge:jet,reaction:Fet};function tpe({emoji:t,miniature:e,children:n}){const{t:r}=et();return S.jsxs("div",{className:Le(tE.reactionIndicatorWidget,{[tE.reactionIndicatorWidgetLarge]:!e}),children:[S.jsx("div",{className:Le(tE.reaction,{[tE.reactionLarge]:!e}),children:S.jsx("span",{role:"img","aria-label":r("common.reaction"),children:t})}),n]})}function $et({raisedHandTime:t,miniature:e,showTimer:n,onClick:r,tabIndex:i}){const{t:s}=et(),[o,a]=_.useState(""),c=_.useMemo(()=>new Intl.DurationFormat(void 0,{minutesDisplay:"always",secondsDisplay:"always",hoursDisplay:"auto",style:"digital"}),[]),l=_.useCallback(h=>{r&&(h.preventDefault(),r())},[r]);if(_.useEffect(()=>{if(!t||!n)return;const h=()=>{const g=Math.ceil((new Date().getTime()-t.getTime())/1e3);a(c.format({seconds:g%60,minutes:Math.floor(g/60)}))};h();const m=setInterval(h,1e3);return()=>clearInterval(m)},[a,t,n,c]),!t)return;const d=S.jsx(tpe,{emoji:"✋",miniature:e,children:n&&S.jsx("p",{children:o})});return r?S.jsx("button",{"aria-label":s("action.lower_hand"),style:{display:"contents",background:"none"},onClick:l,tabIndex:i,children:d}):d}const Bet="_modal_13thw_8",Het="_statsPill_13thw_12",jY={modal:Bet,statsPill:Het},qet=t=>{try{return new URL(t).hostname}catch(e){return console.error("Invalid URL:",e),t}},Vet=({audio:t,video:e,focusUrl:n,rtcBackendIdentity:r,...i})=>{const[s,o]=_.useState(!1),[a,c]=_.useState("none"),l=h=>{o(!0),c(h)},d=()=>{o(!1),c("none")};return S.jsxs("div",{className:Le(pc.nameTag,jY.statsPill),children:[S.jsx(mm,{title:"RTC Connection Stats",open:s,onDismiss:d,children:S.jsx("div",{className:jY.modal,children:S.jsx("pre",{children:a!=="none"&&JSON.stringify(a==="video"?e:t,null,2)})})}),S.jsxs(an,{as:"span",size:"xs",title:"rtcBackendIdentity",children:["rtcBackendIdentity:",r]}),n&&S.jsx("div",{children:S.jsxs(an,{as:"span",size:"xs",title:"focusURL",children:[" ",qet(n)]})}),t&&S.jsx("div",{children:S.jsx(qt,{onClick:()=>l("audio"),size:"sm",kind:"tertiary",Icon:U8,children:"jitter"in t&&typeof t.jitter=="number"&&S.jsxs(an,{as:"span",size:"xs",title:"jitter",children:[" ",(t.jitter*1e3).toFixed(0),"ms"]})})}),e&&S.jsx("div",{children:S.jsxs(qt,{onClick:()=>l("video"),size:"sm",kind:"tertiary",Icon:Fae,children:[!!e?.framesPerSecond&&S.jsxs(an,{as:"span",size:"xs",title:"frame rate",children:[" ",e.framesPerSecond.toFixed(0),"fps"]}),"jitter"in e&&typeof e.jitter=="number"&&S.jsxs(an,{as:"span",size:"xs",title:"jitter",children:[" ",(e.jitter*1e3).toFixed(0),"ms"]}),"frameHeight"in e&&typeof e.frameHeight=="number"&&"frameWidth"in e&&typeof e.frameWidth=="number"&&S.jsxs(an,{as:"span",size:"xs",title:"frame size",children:[" ",e.frameWidth,"x",e.frameHeight]}),"qualityLimitationReason"in e&&typeof e.qualityLimitationReason=="string"&&e.qualityLimitationReason!=="none"&&S.jsxs(an,{as:"span",size:"xs",title:"quality limitation reason",children:[" ",e.qualityLimitationReason]})]})})]})},IS=({ref:t,className:e,style:n,targetWidth:r,targetHeight:i,video:s,videoFit:o,mirror:a,userId:c,videoEnabled:l,unencryptedWarning:d,nameTagLeadingIcon:h,displayName:m,mxcAvatarUrl:g,focusable:y,primaryButton:v,encryptionStatus:E,raisedHandTime:w,currentReaction:R,raisedHandOnClick:x,waitingForMedia:C,audioStreamStats:k,videoStreamStats:T,rtcBackendIdentity:L,focusUrl:O,...P})=>{const{t:D}=et(),[j]=$r(Ble),[H]=$r(Xv),z=Math.round(Math.min(r,i)/2);return S.jsxs(epe.div,{className:Le(pc.media,e,{[pc.mirror]:a}),style:n,ref:t,"data-testid":"videoTile","data-video-fit":o,...P,children:[S.jsxs("div",{className:pc.bg,children:[S.jsx(dm,{id:c,name:m,size:z,src:g,className:pc.avatar,style:{display:s&&l?"none":"initial"}}),s?.publication!==void 0&&S.jsx(GJe,{trackRef:s,tabIndex:-1,style:{display:s&&l?"block":"none"},"data-testid":"video"})]}),S.jsxs("div",{className:pc.fg,children:[S.jsxs("div",{className:pc.reactions,children:[S.jsx($et,{raisedHandTime:w,miniature:z<96,showTimer:j,onClick:x,tabIndex:y?void 0:-1}),R&&S.jsx(tpe,{miniature:z<96,emoji:R.emoji})]}),C&&S.jsxs("div",{className:pc.status,children:[D("video_tile.waiting_for_media"),H?" "+L:""]}),(k||T)&&S.jsx(S.Fragment,{children:S.jsx(Vet,{audio:k,video:T,focusUrl:O,rtcBackendIdentity:L})}),S.jsxs("div",{className:pc.nameTag,children:[h,S.jsx(an,{as:"span",size:"sm",weight:"medium",className:pc.name,"data-testid":"name_tag",children:m}),d&&S.jsx(bi,{label:D("common.unencrypted"),placement:"bottom",isTriggerInteractive:!1,nonInteractiveTriggerTabIndex:y?void 0:-1,children:S.jsx(z_,{width:20,height:20,className:pc.errorIcon,role:"img","aria-label":D("common.unencrypted")})})]}),v]})]})};IS.displayName="MediaView";function zp(t){const e=_.useRef(t);return e.current=t,e}const xS=(...t)=>_.useCallback(e=>t.forEach(n=>{typeof n=="function"?n(e):n&&(n.current=e)}),t),iN=({ref:t,vm:e,showSpeakingIndicators:n,locallyMuted:r,waitingForMedia:i,primaryButton:s,menuStart:o,menuEnd:a,className:c,focusUrl:l,displayName:d,mxcAvatarUrl:h,focusable:m,...g})=>{const{toggleRaisedHand:y}=t9(),{t:v}=et(),E=Fe(e.video$),w=Fe(e.unencryptedWarning$),R=Fe(e.encryptionStatus$),x=vo(e.audioStreamStats$),C=vo(e.videoStreamStats$),k=Fe(e.audioEnabled$),T=Fe(e.videoEnabled$),L=Fe(e.speaking$),O=Fe(e.cropVideo$),P=_.useCallback(J=>{J.preventDefault(),e.toggleFitContain()},[e]),D=_.useCallback(J=>{console.log(e.video)},[e]),j=e.rtcBackendIdentity,H=Fe(e.handRaised$),z=Fe(e.reaction$),Y=r?aNe:k?U8:bae,W=v(r?"video_tile.muted_for_me":k?"microphone_on":"microphone_off"),[F,$]=_.useState(!1),V=S.jsxs(S.Fragment,{children:[o,S.jsx(P8,{Icon:fae,label:v("video_tile.change_fit_contain"),checked:O,onSelect:P}),S.jsx($p,{icon:j8,label:"pop-out",onSelect:D}),a]}),G=e.local?()=>{y()}:void 0,Z=n&&L,q=S.jsx(IS,{ref:t,video:E,userId:e.userId,unencryptedWarning:w,encryptionStatus:R,videoEnabled:T,videoFit:O?"cover":"contain",className:Le(c,Gg.tile,{[Gg.speaking]:Z,[Gg.handRaised]:!Z&&H}),nameTagLeadingIcon:S.jsx(Y,{width:20,height:20,"aria-label":W,"data-muted":r||!k,className:Gg.muteIcon}),displayName:d,mxcAvatarUrl:h,focusable:m,primaryButton:s??S.jsx(C8,{open:F,onOpenChange:$,title:d,trigger:S.jsx("button",{"aria-label":v("common.options"),tabIndex:m?void 0:-1,children:S.jsx(YDe,{"aria-hidden":!0,width:20,height:20})}),side:"left",align:"start",children:V}),raisedHandTime:H??void 0,currentReaction:z??void 0,raisedHandOnClick:G,waitingForMedia:i,focusUrl:l,audioStreamStats:x,videoStreamStats:C,rtcBackendIdentity:j,...g});return S.jsx(KOe,{title:d,trigger:q,hasAccessibleAlternative:!0,children:V})};iN.displayName="UserMediaTile";const npe=({ref:t,vm:e,onOpenProfile:n,focusable:r,...i})=>{const{t:s}=et(),o=Fe(e.mirror$),a=Fe(e.alwaysShow$),c=Fe(e.switchCamera$),l=zp(a),d=_.useCallback(h=>{h.preventDefault(),e.setAlwaysShow(!l.current)},[e,l]);return S.jsx(iN,{ref:t,vm:e,locallyMuted:!1,mirror:o,primaryButton:c===null?void 0:S.jsx("button",{className:Gg.switchCamera,"aria-label":s("switch_camera"),onClick:c,tabIndex:r?void 0:-1,children:S.jsx(tNe,{"aria-hidden":!0,width:20,height:20})}),menuStart:S.jsx(P8,{Icon:M9e,label:s("video_tile.always_show"),checked:a,onSelect:d}),menuEnd:n&&S.jsx($p,{Icon:Nae,label:s("common.profile"),onSelect:n}),focusable:r,...i})};npe.displayName="LocalUserMediaTile";const rpe=({ref:t,vm:e,...n})=>{const{t:r}=et(),i=Fe(e.waitingForMedia$),s=Fe(e.locallyMuted$),o=Fe(e.localVolume$),a=_.useCallback(h=>{h.preventDefault(),e.toggleLocallyMuted()},[e]),c=_.useCallback(h=>e.setLocalVolume(h),[e]),l=_.useCallback(()=>e.commitLocalVolume(),[e]),d=s?cNe:uNe;return S.jsx(iN,{ref:t,vm:e,waitingForMedia:i,locallyMuted:s,mirror:!1,menuStart:S.jsxs(S.Fragment,{children:[S.jsx(P8,{Icon:zDe,label:r("video_tile.mute_for_me"),checked:s,onSelect:a}),S.jsx($p,{as:"div",Icon:d,label:null,onSelect:null,children:S.jsx(Aue,{className:Gg.volumeSlider,label:r("video_tile.volume"),value:o,onValueChange:c,onValueCommit:l,min:0,max:1,step:.01})})]}),...n})};rpe.displayName="RemoteUserMediaTile";const ipe=({ref:t,vm:e,onOpenProfile:n,...r})=>{const i=_.useRef(null),s=xS(i,t),o=Fe(e.media$),a=Fe(o.focusUrl$),c=Fe(o.displayName$),l=Fe(o.mxcAvatarUrl$);return o instanceof cy?S.jsx(npe,{ref:s,vm:o,onOpenProfile:n,focusUrl:a,displayName:c,mxcAvatarUrl:l,...r}):S.jsx(rpe,{ref:s,vm:o,focusUrl:a,displayName:c,mxcAvatarUrl:l,...r})};ipe.displayName="GridTile";const Ket=({rageshakeRequestId:t,roomId:e,open:n,onDismiss:r})=>{const{t:i}=et(),{submitRageshake:s,sending:o,sent:a,error:c}=xR();return _.useEffect(()=>{a&&r()},[a,r]),S.jsxs(mm,{title:i("rageshake_request_modal.title"),open:n,onDismiss:r,children:[S.jsx(an,{children:i("rageshake_request_modal.body")}),S.jsx(Nt,{children:S.jsx(qt,{onClick:()=>{s({sendLogs:!0,rageshakeRequestId:t,roomId:e})},disabled:o,children:i(o?"rageshake_sending_logs":"rageshake_send_logs")})}),c&&S.jsx(Nt,{children:S.jsx(gh,{error:c})})]})};function Get(){_.useEffect(()=>{if("wakeLock"in navigator){let t=!0,e=null;const n=()=>{document.visibilityState==="visible"&&navigator.wakeLock.request("screen").then(r=>{e=r,t||e.release().catch(i=>N.warn("Can't release wake lock",i))},r=>{N.warn("Can't acquire wake lock",r)})};return n(),document.addEventListener("visibilitychange",n),()=>{t=!1,e!==null&&e.release().catch(r=>N.warn("Can't release wake lock",r)),document.removeEventListener("visibilitychange",n)}}},[])}const zet="_toggle_z1rxf_8",Wet={toggle:zet},Yet=({layout:t,setLayout:e,className:n,onTouchEnd:r})=>{const{t:i}=et(),s=_.useCallback(o=>e(o.target.value),[e]);return S.jsxs("div",{className:Le(Wet.toggle,n),children:[S.jsx(bi,{label:i("layout_spotlight_label"),children:S.jsx("input",{type:"radio",name:"layout",value:"spotlight",checked:t==="spotlight",onChange:s,onTouchEnd:r})}),S.jsx(eNe,{"aria-hidden":!0,width:24,height:24}),S.jsx(bi,{label:i("layout_grid_label"),children:S.jsx("input",{type:"radio",name:"layout",value:"grid",checked:t==="grid",onChange:s,onTouchEnd:r})}),S.jsx(HDe,{"aria-hidden":!0,width:24,height:24})]})};let Xet=0;function Jet(){return(Xet++).toString()}class spe{constructor(e){this.media$=e,this.id=Jet()}}class Qet{constructor(e,n){this.media$=e,this.maximised$=n}}function Zet(t,e){return{[Symbol.iterator](){const n=t[Symbol.iterator](),r=e[Symbol.iterator]();return{next(){let i;do{if(i=n.next(),!i.done&&i.value!==void 0)return i;const s=r.next();if(!s.done)return s}while(!i.done);return i}}}}}function nE(t){return t.map(e=>e.media.displayName$.value)}let F1=!1;y9.value$.subscribe(t=>F1=t);class ett{get media(){return this.media$.value}set media(e){this.media$.next(e)}get maximised(){return this.maximised$.value}set maximised(e){this.maximised$.next(e)}constructor(e,n){this.media$=new mr(e),this.maximised$=new mr(n),this.vm=new Qet(this.media$,this.maximised$)}}class T5{get media(){return this.media$.value}set media(e){this.media$.next(e)}constructor(e){this.media$=new mr(e),this.vm=new spe(this.media$)}}class cT{constructor(e,n,r){this.spotlight=e,this.grid=n,this.generation=r,this.spotlightTile=this.spotlight?.vm,this.gridTiles=this.grid.map(({vm:i})=>i),this.gridTilesByMedia=new Map(this.grid.map(({vm:i,media:s})=>[s,i]))}static empty(){return new cT(null,[],0)}from(e){return new ttt(this.spotlight,this.grid,(n,r)=>new cT(n,r,this.generation+1),e,this.generation)}}class ttt{constructor(e,n,r,i,s){this.prevSpotlight=e,this.prevGrid=n,this.construct=r,this.visibleTiles=i,this.generation=s,this.spotlight=null,this.prevSpotlightSpeaker=this.prevSpotlight?.media.length===1&&"speaking$"in this.prevSpotlight.media[0]?this.prevSpotlight.media[0]:null,this.prevGridByMedia=new Map(this.prevGrid.map((o,a)=>[o.media,[o,a]])),this.numGridEntries=0,this.stationaryGridEntries=new Array(this.prevGrid.length),this.visibleGridEntries=[],this.invisibleGridEntries=[]}registerSpotlight(e,n){if(F1&&N.debug(`[TileStore, ${this.generation}] register spotlight: ${e.map(r=>r.displayName$.value)}`),this.spotlight!==null)throw new Error("Spotlight already set");if(this.numGridEntries>0)throw new Error("Spotlight must be registered before grid tiles");this.prevSpotlight===null?this.spotlight=new ett(e,n):(this.spotlight=this.prevSpotlight,this.spotlight.media=e,this.spotlight.maximised=n)}registerGridTile(e){if(F1&&N.debug(`[TileStore, ${this.generation}] register grid tile: ${e.displayName$.value}`),this.spotlight!==null){if(!e.local&&this.spotlight.media.includes(e))return;if(e===this.prevSpotlightSpeaker&&this.spotlight.media.length===1&&"speaking$"in this.spotlight.media[0]&&this.prevSpotlightSpeaker!==this.spotlight.media[0]){const r=this.prevGridByMedia.get(this.spotlight.media[0]);if(r!==void 0){const[i,s]=r,o=s<this.visibleTiles,a=this.numGridEntries<this.visibleTiles;o===a?(this.stationaryGridEntries[s]=i,i.media=e,this.prevGridByMedia.delete(this.spotlight.media[0]),this.prevGridByMedia.set(e,r)):(a?this.visibleGridEntries:this.invisibleGridEntries).push(new T5(e)),this.numGridEntries++;return}}}const n=this.prevGridByMedia.get(e);if(n===void 0)(this.numGridEntries<this.visibleTiles?this.visibleGridEntries:this.invisibleGridEntries).push(new T5(e));else{const[r,i]=n,s=i<this.visibleTiles,o=this.numGridEntries<this.visibleTiles;s===o?this.stationaryGridEntries[i]=r:(o?this.visibleGridEntries:this.invisibleGridEntries).push(r)}this.numGridEntries++}registerPipTile(e){if(F1&&N.debug(`[TileStore, ${this.generation}] register PiP tile: ${e.displayName$.value}`),this.prevGrid.length===1){const n=this.prevGrid[0];this.stationaryGridEntries[0]=n,n.media=e,this.prevGridByMedia.delete(n.media),this.prevGridByMedia.set(e,[n,0])}else this.visibleGridEntries.push(new T5(e));this.numGridEntries++}build(){const e=[...Zet(this.stationaryGridEntries,[...this.visibleGridEntries,...this.invisibleGridEntries])];return F1&&(N.debug(`[TileStore, ${this.generation}] stationary: ${nE(this.stationaryGridEntries)}`),N.debug(`[TileStore, ${this.generation}] visible: ${nE(this.visibleGridEntries)}`),N.debug(`[TileStore, ${this.generation}] invisible: ${nE(this.invisibleGridEntries)}`),N.debug(`[TileStore, ${this.generation}] result: ${nE(e)}`)),this.construct(this.spotlight,e)}}function ntt(t,e,n,r){const i=r.from(e);t.spotlight!==void 0&&i.registerSpotlight(t.spotlight,t.type==="spotlight-portrait");for(const o of t.grid)i.registerGridTile(o);const s=i.build();return[{type:t.type,spotlight:s.spotlightTile,grid:s.gridTiles,setVisibleTiles:n},s]}function rtt(t,e){const n=e.from(1);n.registerSpotlight(t.spotlight,!0),t.pip!==void 0&&n.registerPipTile(t.pip);const r=n.build();return[{type:t.type,spotlight:r.spotlightTile,pip:r.gridTiles[0]},r]}function itt(t,e){const n=e.from(2);n.registerGridTile(t.local),n.registerGridTile(t.remote);const r=n.build();return[{type:t.type,local:r.gridTilesByMedia.get(t.local),remote:r.gridTilesByMedia.get(t.remote)},r]}function stt(t,e){const n=e.from(0);n.registerSpotlight(t.spotlight,!0);const r=n.build();return[{type:t.type,spotlight:r.spotlightTile},r]}function FY(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}const $Y=N.getChild("[MatrixKeyProvider]");class ott extends pee{constructor(){super({ratchetWindowSize:10,keyringSize:256}),this.onEncryptionKeyChanged=(e,n,r,i)=>{crypto.subtle.importKey("raw",e,"HKDF",!1,["deriveBits","deriveKey"]).then(s=>{this.onSetEncryptionKey(s,i,n),$Y.debug(`Sent new key to livekit room=${this.rtcSession?.room.roomId} participantId=${i} (before hash: ${r.userId}:${r.deviceId}) encryptionKeyIndex=${n}`)},s=>{$Y.error(`Failed to create key material from buffer for livekit room=${this.rtcSession?.room.roomId} participantId before hash=${r.userId}:${r.deviceId} encryptionKeyIndex=${n}`,s)})}}setRTCSession(e){this.rtcSession&&this.rtcSession.off(Ji.EncryptionKeyChanged,this.onEncryptionKeyChanged),this.rtcSession=e,this.rtcSession.on(Ji.EncryptionKeyChanged,this.onEncryptionKeyChanged),this.rtcSession.reemitEncryptionKeys()}}function att(t){const e=t.pipe(fo());return e.pipe(Mle(n=>Xu(jf(n?1e3:6e4),e.pipe(ri(r=>r!==n)))),xn(!1),fo())}class ope{constructor(e,n,r,i,s,o,a,c,l,d,h){this.scope=e,this.vm=new zg(this.scope,n,r,i,mt(s),o,a,c,l,d,h,s.isLocal)}}class ctt{constructor(e,n,r,i,s,o,a,c,l,d,h,m,g,y){this.scope=e,this.id=n,this.userId=r,this.rtcBackendIdentity=i,this.participant=s,this.encryptionSystem=o,this.livekitRoom$=a,this.focusUrl$=c,this.mediaDevices=l,this.pretendToBeDisconnected$=d,this.displayName$=h,this.mxcAvatarUrl$=m,this.handRaised$=g,this.reaction$=y,this.vm=this.participant.type==="local"?new cy(this.scope,this.id,this.userId,this.rtcBackendIdentity,this.participant.value$,this.encryptionSystem,this.livekitRoom$,this.focusUrl$,this.mediaDevices,this.displayName$,this.mxcAvatarUrl$,this.scope.behavior(this.handRaised$),this.scope.behavior(this.reaction$)):new eZe(this.scope,this.id,this.userId,this.rtcBackendIdentity,this.participant.value$,this.encryptionSystem,this.livekitRoom$,this.focusUrl$,this.pretendToBeDisconnected$,this.displayName$,this.mxcAvatarUrl$,this.scope.behavior(this.handRaised$),this.scope.behavior(this.reaction$)),this.speaker$=this.scope.behavior(att(this.vm.speaking$)),this.participant$=this.participant.value$,this.screenShares$=this.scope.behavior(this.participant$.pipe(gt(v=>v===null?mt([]):jR(v,ae.TrackPublished,ae.TrackUnpublished,ae.LocalTrackPublished,ae.LocalTrackUnpublished).pipe(cue(`${this.id} screenShares$`,function*(E){E.isScreenShareEnabled&&(yield{keys:["screen-share"],data:void 0})},(E,w,R)=>new ope(E,`${this.id}:${R}`,this.userId,this.rtcBackendIdentity,v,this.encryptionSystem,this.livekitRoom$,this.focusUrl$,this.pretendToBeDisconnected$,this.displayName$,this.mxcAvatarUrl$)))))),this.presenter$=this.scope.behavior(this.screenShares$.pipe(ve(v=>v.length>0))),this.bin$=ot([this.speaker$,this.presenter$,this.vm.videoEnabled$,this.vm.handRaised$,this.vm instanceof cy?this.vm.alwaysShow$:mt(!1)],(v,E,w,R,x)=>this.vm.local?x?0:6:E?1:v?2:R?3:w?4:5)}}var ape=(t=>(t.MISSING_MATRIX_RTC_TRANSPORT="MISSING_MATRIX_RTC_TRANSPORT",t.CONNECTION_LOST_ERROR="CONNECTION_LOST_ERROR",t.INTERNAL_MEMBERSHIP_MANAGER="INTERNAL_MEMBERSHIP_MANAGER",t.FAILED_TO_START_LIVEKIT="FAILED_TO_START_LIVEKIT",t.INSUFFICIENT_CAPACITY_ERROR="INSUFFICIENT_CAPACITY_ERROR",t.E2EE_NOT_SUPPORTED="E2EE_NOT_SUPPORTED",t.OPEN_ID_ERROR="OPEN_ID_ERROR",t.NO_MATRIX_2_AUTHORIZATION_SERVICE="NO_MATRIX_2_0_AUTHORIZATION_SERVICE",t.SFU_ERROR="SFU_ERROR",t.UNKNOWN_ERROR="UNKNOWN_ERROR",t))(ape||{}),mC=(t=>(t.CONFIGURATION_ISSUE="CONFIGURATION_ISSUE",t.NETWORK_CONNECTIVITY="NETWORK_CONNECTIVITY",t.CLIENT_CONFIGURATION="CLIENT_CONFIGURATION",t.UNKNOWN="UNKNOWN",t.SYSTEM_FAILURE="SYSTEM_FAILURE",t))(mC||{});class ji extends Error{constructor(e,n,r,i,s){super(e,{cause:s}),this.localisedTitle=e,this.localisedMessage=i,this.category=r,this.code=n}}class ltt extends ji{constructor(e){super($i("error.call_is_not_supported"),"MISSING_MATRIX_RTC_TRANSPORT","CONFIGURATION_ISSUE",$i("error.matrix_rtc_transport_missing",{domain:e,brand:"Element Call",errorCode:"MISSING_MATRIX_RTC_TRANSPORT"})),this.domain=e}}class cpe extends ji{constructor(){super($i("error.connection_lost"),"CONNECTION_LOST_ERROR","NETWORK_CONNECTIVITY",$i("error.connection_lost_description"))}}class utt extends ji{constructor(e){super($i("error.membership_manager"),"INTERNAL_MEMBERSHIP_MANAGER","SYSTEM_FAILURE",$i("error.membership_manager_description"),e)}}class dtt extends ji{constructor(){super($i("error.e2ee_unsupported"),"E2EE_NOT_SUPPORTED","CLIENT_CONFIGURATION",$i("error.e2ee_unsupported_description"))}}class Wp extends ji{constructor(e){super($i("error.generic"),"UNKNOWN_ERROR","UNKNOWN",void 0,e)}}class gC extends ji{constructor(e){super($i("error.generic"),"OPEN_ID_ERROR","CONFIGURATION_ISSUE",void 0,e)}}class lpe extends ji{constructor(e){super($i("error.generic"),"NO_MATRIX_2_0_AUTHORIZATION_SERVICE","CONFIGURATION_ISSUE",$i("error.no_matrix_2_authorization_service"),e)}}class ftt extends ji{constructor(e){super($i("error.failed_to_start_livekit"),"FAILED_TO_START_LIVEKIT","NETWORK_CONNECTIVITY",e)}}class htt extends ji{constructor(){super($i("error.insufficient_capacity"),"INSUFFICIENT_CAPACITY_ERROR","UNKNOWN",$i("error.insufficient_capacity_description"))}}class ptt extends ji{constructor(){super($i("error.room_creation_restricted"),"SFU_ERROR","CONFIGURATION_ISSUE",$i("error.room_creation_restricted_description"))}}const mtt=N.getChild("[HomeserverConnected]");function gtt(t,e,n){const r=ms(e,Pe.Sync).pipe(xn([e.getSyncState()]),ve(([c])=>c===Qt.Syncing)),i=t.behavior(ms(n,_l.StatusChanged).pipe(ve(()=>n.membershipStatus??_c.Unknown)),_c.Unknown),s=i.pipe(ve(c=>c===_c.Connected)),o=ms(n,_l.ProbablyLeft).pipe(xn(null),ve(()=>n.probablyLeft!==!0));return{combined$:t.behavior(aue(r,s,o).pipe(Tp(c=>{mtt.info(`Homeserver connected update: ${c}`)}))),rtsSession$:i}}function vtt({scope:t,membershipsWithTransport$:e,connectionManager:n}){return t.behavior(ot([e,n.connectionManagerData$]).pipe(ri(r=>r.every(i=>i.epoch===r[0].epoch)),ve(([r,i])=>new Lc([r.value,i.value],r.epoch)),lue("MatrixLivekitMembers",function*([r,i]){for(const{membership:s,transport:o}of r){const c=(o?i.getParticipantsForTransport(o):[]).find(d=>d.identity==s.rtcBackendIdentity)??null,l=o?i.getConnectionForTransport(o):null;yield{keys:[s.userId,s.deviceId,s.memberId,s.rtcBackendIdentity],data:{membership:s,participant:c,connection:l}}}},(r,i,s,o,a,c)=>{const{participant$:l,...d}=r.splitBehavior(i);return{userId:s,participant:{type:"remote",value$:l},...d}})),new Lc([],-1))}function sN(t,e){return t&&e?t.livekit_service_url===e.livekit_service_url:!t&&!e}const Ko=N.getChild("[LocalTransport]");var lT=(t=>(t.Legacy="legacy",t.Matrix_2_0="matrix_2_0",t))(lT||{});function ytt(t){return"transport"in t&&"sfuConfig"in t}const btt=({scope:t,memberships$:e,ownMembershipIdentity:n,client:r,roomId:i,useOldestMember$:s,forceJwtEndpoint$:o,delayId$:a})=>{const c=t.behavior(ot([e,s]).pipe(ve(([d,h])=>{if(!h)return null;const m=d.value[0],g=m?.getTransport(m);return g||null}),gt(d=>d!==null&&TT(d)?dd((async()=>({transport:d,sfuConfig:await oN(r,n,d.livekit_service_url,i,{forceJwtEndpoint:"legacy"},Ko)}))()):mt(null))),null),l=t.behavior(ot([zle.value$,a,o]).pipe(gt(([d,h,m])=>(Ko.info("Creating preferred transport based on: ","customUrl: ",d,"delayId: ",h,"forceEndpoint: ",m),dd(Stt(r,n,i,d,m,h??void 0))))),null);return t.behavior(ot([s,c,l]).pipe(ve(([d,h,m])=>d?h??m:m),fo((d,h)=>(Ko.info("Local Transport Update from:",d?.transport.livekit_service_url," to ",h?.transport.livekit_service_url),sN(d?.transport??null,h?.transport??null)))))},_tt="org.matrix.msc4143.rtc_foci";async function Stt(t,e,n,r,i,s){Ko.trace("Searching for a preferred transport");async function o(d){const h=await oN(t,e,d,n,{forceJwtEndpoint:i,delayEndpointBaseUrl:t.baseUrl,delayId:s},Ko);return{transport:{type:"livekit",livekit_service_url:d},sfuConfig:h}}if(r!==null)return Ko.info("Using LiveKit transport from dev tools: ",r),await o(r);async function a(d){for(const h of d)if(TT(h))try{return await o(h.livekit_service_url)}catch(m){if(m instanceof gC||m instanceof lpe)throw m;Ko.debug(`Could not use SFU service "${h.livekit_service_url}" as SFU`,m)}return null}if("_unstable_getRTCTransports"in t)try{const d=await t._unstable_getRTCTransports(),h=await a(d);if(h)return Ko.info("Using backend-configured (client.getRTCTransports) SFU",h),h}catch(d){if(d instanceof In&&d.httpStatus===404)Ko.debug("Matrix homeserver does not provide any RTC transports via `/rtc/transports` (will retry with well-known.)");else{if(d instanceof gC)throw d;Ko.error("Unexpected error fetching RTC transports from backend",d)}}const c=t.getDomain();if(c){const d=(await pt.getRawClientConfig(c))?.[_tt],h=Array.isArray(d)?await a(d):null;if(h)return Ko.info("Using .well-known SFU",h),h}const l=yn.get().livekit?.livekit_service_url;if(l)try{return Ko.info("Using config SFU",l),await o(l)}catch(d){if(d instanceof gC)throw d;Ko.error("Failed to validate config SFU",d)}throw new ltt(c??"")}async function oN(t,e,n,r,i,s){let o;try{o=await IYe(async()=>t.getOpenIdToken())}catch(m){throw new gC(m instanceof Error?m:new Error("Unknown error"))}s?.debug("Got openID token",o),s?.info(`Trying to get JWT for focus ${n}...`);let a;const c=i?.forceJwtEndpoint===void 0,l=i?.forceJwtEndpoint===lT.Matrix_2_0;if(c||l)try{a=await Ett(e,n,r,o,i?.delayEndpointBaseUrl,i?.delayId),s?.info("Got JWT from call's active focus URL.")}catch(m){if(m instanceof upe)s?.warn("Failed fetching jwt with matrix 2.0 endpoint (retry with legacy) Not supported",m),a=void 0;else if(s?.warn("Failed fetching jwt with matrix 2.0 endpoint other issues ->","(not going to try with legacy endpoint: forceOldJwtEndpoint is set to false, we did not get a not supported error from the sfu)",m),l)throw new lpe(m)}if(a===void 0&&(a=await wtt(e.deviceId,n,r,o),s?.info("Got JWT from call's active focus URL.")),!a)throw new Error("No `sfuConfig` after trying with old and new endpoints");const[,d]=a.jwt.split("."),h=JSON.parse(global.atob(d));return{jwt:a.jwt,url:a.url,livekitAlias:h.video.room,livekitIdentity:h.sub}}const uT=4;async function wtt(t,e,n,r){let i;if(await xb(uT,async()=>{i=await fetch(e+"/sfu/get",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({room:n,openid_token:r,device_id:t})})}),!i)throw new Error(`Network error while connecting to jwt service after ${uT} retries`);if(!i.ok)throw new Error("SFU Config fetch failed with status code "+i.status);return await i.json()}class upe extends Error{constructor(e){super(e),this.name="NotSupported"}}async function Ett(t,e,n,r,i,s){const{userId:o,deviceId:a,memberId:c}=t,l={room_id:n,slot_id:"m.call#ROOM",openid_token:r,member:{id:c,claimed_user_id:o,claimed_device_id:a}};let d={};if(s&&i){const m=yn.get().matrix_rtc_session?.delayed_leave_event_delay_ms??1e3;d={delay_id:s,delay_timeout:m,delay_cs_api_url:i}}let h;if(await xb(uT,async()=>{h=await fetch(e+"/get_token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...l,...d})})}),!h)throw new Error(`Network error while connecting to jwt service after ${uT} retries`);if(!h.ok){const m="SFU Config fetch failed with status code "+h.status;throw h.status===404?new upe(m):new Error(m)}return await h.json()}var jO=(t=>(t.Initialized="Initialized",t.FetchingConfig="FetchingConfig",t.Stopped="Stopped",t.LivekitDisconnected="disconnected",t.LivekitConnecting="connecting",t.LivekitConnected="connected",t.LivekitReconnecting="reconnecting",t.LivekitSignalReconnecting="signalReconnecting",t))(jO||{});class Ctt{constructor(e,n){this._state$=new mr("Initialized"),this.state$=this._state$,this.stopped=!1,this.ownMembershipIdentity=e.ownMembershipIdentity,this.existingSFUConfig=e.existingSFUConfig,this.roomId=e.roomId,this.logger=n.getChild("[Connection "+e.transport.livekit_service_url+"]"),this.logger.info(`constructor: ${e.transport.livekit_service_url} roomId: ${this.roomId} withSfuConfig?: ${e.existingSFUConfig?JSON.stringify(e.existingSFUConfig):"undefined"}`);const{transport:r,client:i,scope:s}=e;this.scope=s,this.livekitRoom=e.livekitRoomFactory(),this.transport=r,this.client=i,this.remoteParticipants$=s.behavior(TGe(this.livekitRoom)),s.onEnd(()=>{this.logger.info("Connection scope ended, stopping connection"),this.stop()})}get livekitAlias(){return this._livekitAlias}async start(){this.logger.debug("Starting Connection"),this.stopped=!1;try{this._state$.next("FetchingConfig");const{url:e,jwt:n,livekitAlias:r}=this.existingSFUConfig??await this.getSFUConfigForRemoteConnection();if(this.logger.debug("Starting Connection to: ",this.transport.livekit_service_url,"jwt: ",n,"wss: ",e,"livekitAlias: ",r),this._livekitAlias=r,this.stopped)return;CGe(this.livekitRoom).pipe(this.scope.bind(),ve(i=>i)).subscribe(i=>{this._state$.next(i)});try{this.logger.info(`livekitRoom.connect ${e}`),await this.livekitRoom.connect(e,n),this.logger.info(`livekitRoom.connect SUCCESS ${e}`)}catch(i){if(this.logger.info(`livekitRoom.connect FAILED ${e}`,i),i instanceof Bt){if(i.status===503||i.status===200||i.status===429)throw new htt;if(i.status===404)throw new ptt}throw i}if(this.stopped)return}catch(e){throw this.logger.debug(`Failed to connect to LiveKit room: ${e}`),this._state$.next(e instanceof ji?e:e instanceof Error?new Wp(e):new Wp(new Error(`${e}`))),e}}async getSFUConfigForRemoteConnection(){return await oN(this.client,this.ownMembershipIdentity,this.transport.livekit_service_url,this.roomId,{},this.logger)}async stop(){this.logger.debug(`stop: disconnecing from lk room ${this.transport.livekit_service_url}`),!this.stopped&&(await this.livekitRoom.disconnect(),this._state$.next("Stopped"),this.stopped=!0,this.logger.debug(`stop: DONE disconnecing from lk room ${this.transport.livekit_service_url}`))}}var dpe=(t=>(t.Waiting="transport_waiting",t))(dpe||{});const Ttt=({scope:t,connectionManager:e,localTransport$:n,homeserverConnected:r,createPublisherFactory:i,joinMatrixRTC:s,logger:o,muteStates:a,matrixRTCSession:c})=>{const l=o.getChild("[LocalMembership]");l.debug("Creating local membership..");const d=t.behavior(n.pipe(DR($=>{let V;return $ instanceof ji?V=$:V=new Wp($ instanceof Error?$:new Error("Unknown error from localTransport")),T(V),mt(null)}))),h=t.behavior(ot([e.connectionManagerData$,d]).pipe(ve(([{value:$},V])=>V===null?null:$.getConnectionForTransport(V.transport)),Tp($=>{l.info(`Local connection updated: ${$?.transport?.livekit_service_url}`)})));h.pipe(gt($=>$?ms($.livekitRoom,he.MediaDevicesError,V=>Vb.getFailure(V)??null):mt(null))).pipe(t.bind()).subscribe($=>{$&&l.error("Failed to create local tracks:",$)});const g=Promise.withResolvers(),y=new mr(!1),v=new mr(null),E=()=>{g.resolve()},w=()=>{g.resolve(),y.next(!0)},R=()=>{y.next(!1)};t.reconcile(h,async $=>{if(l.info("reconcile based on new localConnection:",$?.transport.livekit_service_url),$!==null){const V=i($);return v.next(V),Promise.resolve(async()=>{await V.destroy()})}}),t.reconcile(t.behavior(ot([v,dd(g.promise)]),null),async $=>{if(!$)return;const[V]=$;V&&await V.createAndSetupTracks().catch(G=>l.error(G))}),t.reconcile(t.behavior(ot([v,y])),async([$,V])=>{const G=$?.shouldPublish===!0;if(V&&!G)try{await $?.startPublishing()}catch(Z){const q=Z instanceof Error?Z.message:String(Z);C(new ftt(q))}else if(G)try{await $?.stopPublishing()}catch(Z){C(new Wp(Z))}});const x=new mr(null),C=$=>{x.value!==null?l.error("Multiple Media Errors:",$):x.next($)},k=new mr(null),T=$=>{k.value!==null?l.error("Multiple Transport Errors:",$):k.next($)},L=h.pipe(gt($=>$?$.state$:mt(null))),O=t.behavior(ot([L,d,y,dd(g.promise).pipe(ve(()=>!0),xn(!1))]).pipe(ve(([$,V,G,Z])=>{if(!V)return null;const q=Z?"tracks_ready":"tracks_waiting_for_user";return $!==jO.LivekitConnected||q!=="tracks_ready"?{connection:$,tracks:q}:G?"publish_publishing":"publish_waiting_for_user"}),fo(Ip))),P=new mr(null),D=$=>{P.value!==null?l.error("Multiple Matrix Errors:",$):P.next($)},j=t.behavior(ot([O,r.rtsSession$,P,k,x]).pipe(ve(([$,V,G,Z,q])=>Z!==null?Z:$&&V?{matrix:G??V,media:q??$}:"transport_waiting"))),H=t.behavior(aue(r.combined$,L.pipe(ve($=>$===jO.LivekitConnected))).pipe(Tp($=>l.debug("livekit+matrix: Connected state changed",$)))),z=t.behavior(H.pipe(Yv(),ve(([$,V])=>$===!0&&V===!1)),!1);t.behavior(y.pipe(Yv(),t.bind()),[void 0,y.value]).subscribe(([$,V])=>{Et&&(!$&&V&&Et.api.transport.send(kl.JoinCall,{}).catch(G=>{l.error("Failed to send join action",G)}),$&&!V&&Et.api.transport.send(kl.HangupCall,{}).catch(G=>{l.error("Failed to send hangup action",G)}))}),a.video.enabled$.pipe(t.bind()).subscribe($=>{c.updateCallIntent($?"video":"audio").catch(V=>{if(V instanceof Error&&V.message==="Not connected yet")l.debug("'not connected yet' while updating the call intent (this is expected on startup)");else throw V})}),t.reconcile(t.behavior(ot([d,y])),async([$,V])=>{if($&&V){try{s($.transport)}catch(G){l.error("Error entering RTC session",G),G instanceof Error&&D(new utt(G))}return Promise.resolve(async()=>{try{await c.leaveRoomSession(1e3)}catch(G){l.error("Error leaving RTC session",G)}})}});const Y=t.behavior(h.pipe(ve($=>$?.livekitRoom?.localParticipant??null),Tp($=>{l.debug("participant$ updated:",$?.identity)})));ot([Y,r.combined$]).pipe(t.bind()).subscribe(([$,V])=>{if(!$)return;const G=$.trackPublications.values();if(V){for(const Z of G)if(Z.track?.isUpstreamPaused===!0){const q=Z.track.kind;l.info(`Resuming ${q} track (MatrixRTC connection present)`),Z.track.resumeUpstream().catch(J=>l.error(`Failed to resume ${q} track after MatrixRTC reconnection`,J))}}else for(const Z of G)if(Z.track?.isUpstreamPaused===!1){const q=Z.track.kind;l.info(`Pausing ${q} track (uncertain MatrixRTC connection)`),Z.track.pauseUpstream().catch(J=>l.error(`Failed to pause ${q} track after entering uncertain MatrixRTC connection`,J))}});const W=t.behavior(Y.pipe(gt($=>$!==null?Rtt($):mt(!1))));let F=null;return"getDisplayMedia"in(navigator.mediaDevices??{})&&!ur().hideScreensharing&&(F=()=>{const $={audio:!0,selfBrowserSurface:"include",surfaceSwitching:"include",systemAudio:"include"},V=!W.value;l.info(`toggleScreenSharing called. Switching ${V?"On":"Off"}`),Y.value?.setScreenShareEnabled(V,$).catch(l.error)}),{startTracks:E,requestJoinAndPublish:w,requestDisconnect:R,localMemberState$:j,participant$:Y,reconnecting$:z,connected$:H,disconnected$:t.behavior(r.rtsSession$.pipe(ve($=>$===_c.Disconnected))),sharingScreen$:W,toggleScreenSharing:F,connection$:h,internalLoggerRef:l}};function Rtt(t){return jR(t,ae.TrackPublished,ae.TrackUnpublished,ae.LocalTrackPublished,ae.LocalTrackUnpublished).pipe(ve(e=>e.isScreenShareEnabled))}function ktt(t,e,n,r){const{encryptMedia:i,matrixRTCMode:s}=r;en.instance.eventCallEnded.cacheStartCall(new Date),en.instance.eventCallStarted.track(t.room.roomId);const{features:o,matrix_rtc_session:a}=yn.get(),c=o?.feature_use_device_session_member_events,{sendNotificationType:l,callIntent:d}=ur(),h=s===so.Compatibility||s===so.Matrix_2_0;let m;s===so.Matrix_2_0?m=n:m={livekit_alias:t.room.roomId,...n},t.joinRTCSession(e,h?[]:[m],h?m:void 0,{notificationType:l,callIntent:d,manageMediaKeys:i,...c!==void 0&&{useLegacyMemberEvents:!c},delayedLeaveEventRestartMs:a?.delayed_leave_event_restart_ms,delayedLeaveEventDelayMs:a?.delayed_leave_event_delay_ms,delayedLeaveEventRestartLocalTimeoutMs:a?.delayed_leave_event_restart_local_timeout_ms,networkErrorRetryMs:a?.network_error_retry_ms,makeKeyDelay:a?.wait_for_key_rotation_ms,membershipEventExpiryMs:a?.membership_event_expiry_ms,useExperimentalToDeviceTransport:!0,unstableSendStickyEvents:s===so.Matrix_2_0})}const Itt=(t,e)=>{const n=t.behavior(e.pipe(nO(i=>i.map(s=>{const o=i[0]??s,a=s.getTransport(o);return{membership:s,transport:TT(a)?a:void 0}})))),r=t.behavior(n.pipe(nO(i=>i.flatMap(({transport:s})=>s?[s]:[]))));return{membershipsWithTransport$:n,transports$:r}},xtt=(t,e)=>t.behavior(ms(e,Ji.MembershipsChanged,(n,r)=>r).pipe(RGe()),new Lc(e.memberships)),fpe=`function C(e,t,n,r){function o(i){return i instanceof n?i:new n(function(c){c(i)})}return new(n||(n=Promise))(function(i,c){function g(b){try{y(r.next(b))}catch(S){c(S)}}function v(b){try{y(r.throw(b))}catch(S){c(S)}}function y(b){b.done?i(b.value):o(b.value).then(g,v)}y((r=r.apply(e,t||[])).next())})}var X={exports:{}},ke=X.exports,ie;function Re(){return ie||(ie=1,(function(e){(function(t,n){e.exports?e.exports=n():t.log=n()})(ke,function(){var t=function(){},n="undefined",r=typeof window!==n&&typeof window.navigator!==n&&/Trident\\/|MSIE /.test(window.navigator.userAgent),o=["trace","debug","info","warn","error"],i={},c=null;function g(I,R){var h=I[R];if(typeof h.bind=="function")return h.bind(I);try{return Function.prototype.bind.call(h,I)}catch{return function(){return Function.prototype.apply.apply(h,[I,arguments])}}}function v(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function y(I){return I==="debug"&&(I="log"),typeof console===n?!1:I==="trace"&&r?v:console[I]!==void 0?g(console,I):console.log!==void 0?g(console,"log"):t}function b(){for(var I=this.getLevel(),R=0;R<o.length;R++){var h=o[R];this[h]=R<I?t:this.methodFactory(h,I,this.name)}if(this.log=this.debug,typeof console===n&&I<this.levels.SILENT)return"No console available for logging"}function S(I){return function(){typeof console!==n&&(b.call(this),this[I].apply(this,arguments))}}function m(I,R,h){return y(I)||S.apply(this,arguments)}function E(I,R){var h=this,O,A,a,s="loglevel";typeof I=="string"?s+=":"+I:typeof I=="symbol"&&(s=void 0);function u(w){var k=(o[w]||"silent").toUpperCase();if(!(typeof window===n||!s)){try{window.localStorage[s]=k;return}catch{}try{window.document.cookie=encodeURIComponent(s)+"="+k+";"}catch{}}}function d(){var w;if(!(typeof window===n||!s)){try{w=window.localStorage[s]}catch{}if(typeof w===n)try{var k=window.document.cookie,T=encodeURIComponent(s),j=k.indexOf(T+"=");j!==-1&&(w=/^([^;]+)/.exec(k.slice(j+T.length+1))[1])}catch{}return h.levels[w]===void 0&&(w=void 0),w}}function l(){if(!(typeof window===n||!s)){try{window.localStorage.removeItem(s)}catch{}try{window.document.cookie=encodeURIComponent(s)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function _(w){var k=w;if(typeof k=="string"&&h.levels[k.toUpperCase()]!==void 0&&(k=h.levels[k.toUpperCase()]),typeof k=="number"&&k>=0&&k<=h.levels.SILENT)return k;throw new TypeError("log.setLevel() called with invalid level: "+w)}h.name=I,h.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},h.methodFactory=R||m,h.getLevel=function(){return a??A??O},h.setLevel=function(w,k){return a=_(w),k!==!1&&u(a),b.call(h)},h.setDefaultLevel=function(w){A=_(w),d()||h.setLevel(w,!1)},h.resetLevel=function(){a=null,l(),b.call(h)},h.enableAll=function(w){h.setLevel(h.levels.TRACE,w)},h.disableAll=function(w){h.setLevel(h.levels.SILENT,w)},h.rebuild=function(){if(c!==h&&(O=_(c.getLevel())),b.call(h),c===h)for(var w in i)i[w].rebuild()},O=_(c?c.getLevel():"WARN");var p=d();p!=null&&(a=_(p)),b.call(h)}c=new E,c.getLogger=function(R){if(typeof R!="symbol"&&typeof R!="string"||R==="")throw new TypeError("You must supply a name when creating a logger.");var h=i[R];return h||(h=i[R]=new E(R,c.methodFactory)),h};var P=typeof window!==n?window.log:void 0;return c.noConflict=function(){return typeof window!==n&&window.log===c&&(window.log=P),c},c.getLoggers=function(){return i},c.default=c,c})})(X)),X.exports}var te=Re(),H;(function(e){e[e.trace=0]="trace",e[e.debug=1]="debug",e[e.info=2]="info",e[e.warn=3]="warn",e[e.error=4]="error",e[e.silent=5]="silent"})(H||(H={}));var ee;(function(e){e.Default="livekit",e.Room="livekit-room",e.TokenSource="livekit-token-source",e.Participant="livekit-participant",e.Track="livekit-track",e.Publication="livekit-track-publication",e.Engine="livekit-engine",e.Signal="livekit-signal",e.PCManager="livekit-pc-manager",e.PCTransport="livekit-pc-transport",e.E2EE="lk-e2ee"})(ee||(ee={}));let Ce=te.getLogger("livekit");Object.values(ee).map(e=>te.getLogger(e));Ce.setDefaultLevel(H.info);const f=te.getLogger("lk-e2ee");var Le=Object.defineProperty,Pe=(e,t,n)=>t in e?Le(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,se=(e,t,n)=>Pe(e,typeof t!="symbol"?t+"":t,n);class Ke{constructor(){se(this,"_locking"),se(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let t;const n=new Promise(o=>t=()=>{this._locks-=1,o()}),r=this._locking.then(()=>t);return this._locking=this._locking.then(()=>n),r}}var N;(function(e){e[e.WAITING=0]="WAITING",e[e.RUNNING=1]="RUNNING",e[e.COMPLETED=2]="COMPLETED"})(N||(N={}));class xe{constructor(){this.pendingTasks=new Map,this.taskMutex=new Ke,this.nextTaskIndex=0}run(t){return C(this,void 0,void 0,function*(){const n={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:N.WAITING};this.pendingTasks.set(n.id,n);const r=yield this.taskMutex.lock();try{return n.executedAt=Date.now(),n.status=N.RUNNING,yield t()}finally{n.status=N.COMPLETED,this.pendingTasks.delete(n.id),r()}})}flush(){return C(this,void 0,void 0,function*(){return this.run(()=>C(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}const F="AES-GCM",Oe=10,$={key:10,delta:3,audio:1,empty:0},oe=12,Ae="LKFrameEncryptionKey",Me={sharedKey:!1,ratchetSalt:Ae,ratchetWindowSize:8,failureTolerance:Oe,keyringSize:16};class Te extends Error{constructor(t,n){super(n||"an error has occured"),this.name="LiveKitError",this.code=t}}var ae;(function(e){e[e.NotAllowed=0]="NotAllowed",e[e.ServerUnreachable=1]="ServerUnreachable",e[e.InternalError=2]="InternalError",e[e.Cancelled=3]="Cancelled",e[e.LeaveRequest=4]="LeaveRequest",e[e.Timeout=5]="Timeout"})(ae||(ae={}));var ce;(function(e){e[e.AlreadyOpened=0]="AlreadyOpened",e[e.AbnormalEnd=1]="AbnormalEnd",e[e.DecodeFailed=2]="DecodeFailed",e[e.LengthExceeded=3]="LengthExceeded",e[e.Incomplete=4]="Incomplete",e[e.HandlerAlreadyRegistered=7]="HandlerAlreadyRegistered",e[e.EncryptionTypeMismatch=8]="EncryptionTypeMismatch"})(ce||(ce={}));var G;(function(e){e.PermissionDenied="PermissionDenied",e.NotFound="NotFound",e.DeviceInUse="DeviceInUse",e.Other="Other"})(G||(G={}));(function(e){function t(n){if(n&&"name"in n)return n.name==="NotFoundError"||n.name==="DevicesNotFoundError"?e.NotFound:n.name==="NotAllowedError"||n.name==="PermissionDeniedError"?e.PermissionDenied:n.name==="NotReadableError"||n.name==="TrackStartError"?e.DeviceInUse:e.Other}e.getFailure=t})(G||(G={}));var K;(function(e){e[e.InvalidKey=0]="InvalidKey",e[e.MissingKey=1]="MissingKey",e[e.InternalError=2]="InternalError"})(K||(K={}));class x extends Te{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:K.InternalError,r=arguments.length>2?arguments[2]:void 0;super(40,t),this.reason=n,this.participantIdentity=r}}var ue;(function(e){e.SetKey="setKey",e.RatchetRequest="ratchetRequest",e.KeyRatcheted="keyRatcheted"})(ue||(ue={}));var Y;(function(e){e.KeyRatcheted="keyRatcheted"})(Y||(Y={}));var de;(function(e){e.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",e.EncryptionError="encryptionError"})(de||(de={}));var U;(function(e){e.Error="cryptorError"})(U||(U={}));function De(e){return"type"in e}function Fe(e){return C(this,arguments,void 0,function(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{name:F},r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"encrypt";return(function*(){return crypto.subtle.importKey("raw",t,n,!1,r==="derive"?["deriveBits","deriveKey"]:["encrypt","decrypt"])})()})}function ye(e,t){const r=new TextEncoder().encode(t);switch(e){case"HKDF":return{name:"HKDF",salt:r,hash:"SHA-256",info:new ArrayBuffer(128)};case"PBKDF2":return{name:"PBKDF2",salt:r,hash:"SHA-256",iterations:1e5};default:throw new Error("algorithm ".concat(e," is currently unsupported"))}}function ne(e,t){return C(this,void 0,void 0,function*(){const n=ye(e.algorithm.name,t),r=yield crypto.subtle.deriveKey(n,e,{name:F,length:128},!1,["encrypt","decrypt"]);return{material:e,encryptionKey:r}})}function Be(e,t){return C(this,void 0,void 0,function*(){const n=ye(e.algorithm.name,t);return crypto.subtle.deriveBits(n,e,256)})}function Ne(e){for(var t=0;t<e.length-3;t++)if(e[t]==0&&e[t+1]==0&&e[t+2]==3)return!0;return!1}function Ue(e){const t=[];for(var n=e.length,r=0;r<e.length;)n-r>=3&&!e[r]&&!e[r+1]&&e[r+2]==3?(t.push(e[r++]),t.push(e[r++]),r++):t.push(e[r++]);return new Uint8Array(t)}const qe=2,le=3;function We(e){const t=[];for(var n=0,r=0;r<e.length;++r){var o=e[r];o<=le&&n>=qe&&(t.push(le),n=0),t.push(o),o==0?++n:n=0}return new Uint8Array(t)}class M{static makeIV(t){const n=new ArrayBuffer(12),r=new DataView(n),o=crypto.getRandomValues(new Uint32Array(1));return r.setUint32(0,o[0]),r.setUint32(4,t),r.setUint32(8,t-M.sendCount%65535),M.sendCount++,n}static encrypt(t,n){return C(this,void 0,void 0,function*(){const r=M.makeIV(performance.now()),o=yield n.getKeySet();if(!o)throw new Error("No key set found");const i=yield crypto.subtle.encrypt({name:F,iv:r},o.encryptionKey,new Uint8Array(t));return{payload:new Uint8Array(i),iv:new Uint8Array(r),keyIndex:n.getCurrentKeyIndex()}})}static decrypt(t,n,r){return C(this,arguments,void 0,function(o,i,c){let g=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,v=arguments.length>4?arguments[4]:void 0,y=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{ratchetCount:0};return(function*(){const b=yield c.getKeySet(g);if(!b)throw new Error("No key set found");try{const S=yield crypto.subtle.decrypt({name:F,iv:i},b.encryptionKey,new Uint8Array(o));return{payload:new Uint8Array(S)}}catch(S){if(c.keyProviderOptions.ratchetWindowSize>0)if(y.ratchetCount<c.keyProviderOptions.ratchetWindowSize){f.debug("DataCryptor: ratcheting key attempt ".concat(y.ratchetCount," of ").concat(c.keyProviderOptions.ratchetWindowSize,", for data packet"));let m,E;(v??b)===c.getKeySet(g)&&(E=yield c.ratchetKey(g,!1),m=yield ne(E.cryptoKey,c.keyProviderOptions.ratchetSalt));const P=yield M.decrypt(o,i,c,g,v,{ratchetCount:y.ratchetCount+1,encryptionKey:m?.encryptionKey});return P&&m&&(v??b)===c.getKeySet(g)&&(c.setKeySet(m,g,E),c.setCurrentKeyIndex(g)),P}else throw f.warn("DataCryptor: maximum ratchet attempts exceeded"),new x("DataCryptor: valid key missing for participant ".concat(c.participantIdentity),K.InvalidKey,c.participantIdentity);else throw new x("DataCryptor: Decryption failed: ".concat(S.message),K.InvalidKey,c.participantIdentity)}})()})}}M.sendCount=0;var V={exports:{}},fe;function je(){if(fe)return V.exports;fe=1;var e=typeof Reflect=="object"?Reflect:null,t=e&&typeof e.apply=="function"?e.apply:function(s,u,d){return Function.prototype.apply.call(s,u,d)},n;e&&typeof e.ownKeys=="function"?n=e.ownKeys:Object.getOwnPropertySymbols?n=function(s){return Object.getOwnPropertyNames(s).concat(Object.getOwnPropertySymbols(s))}:n=function(s){return Object.getOwnPropertyNames(s)};function r(a){console&&console.warn&&console.warn(a)}var o=Number.isNaN||function(s){return s!==s};function i(){i.init.call(this)}V.exports=i,V.exports.once=h,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._eventsCount=0,i.prototype._maxListeners=void 0;var c=10;function g(a){if(typeof a!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof a)}Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(a){if(typeof a!="number"||a<0||o(a))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+a+".");c=a}}),i.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},i.prototype.setMaxListeners=function(s){if(typeof s!="number"||s<0||o(s))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+s+".");return this._maxListeners=s,this};function v(a){return a._maxListeners===void 0?i.defaultMaxListeners:a._maxListeners}i.prototype.getMaxListeners=function(){return v(this)},i.prototype.emit=function(s){for(var u=[],d=1;d<arguments.length;d++)u.push(arguments[d]);var l=s==="error",_=this._events;if(_!==void 0)l=l&&_.error===void 0;else if(!l)return!1;if(l){var p;if(u.length>0&&(p=u[0]),p instanceof Error)throw p;var w=new Error("Unhandled error."+(p?" ("+p.message+")":""));throw w.context=p,w}var k=_[s];if(k===void 0)return!1;if(typeof k=="function")t(k,this,u);else for(var T=k.length,j=P(k,T),d=0;d<T;++d)t(j[d],this,u);return!0};function y(a,s,u,d){var l,_,p;if(g(u),_=a._events,_===void 0?(_=a._events=Object.create(null),a._eventsCount=0):(_.newListener!==void 0&&(a.emit("newListener",s,u.listener?u.listener:u),_=a._events),p=_[s]),p===void 0)p=_[s]=u,++a._eventsCount;else if(typeof p=="function"?p=_[s]=d?[u,p]:[p,u]:d?p.unshift(u):p.push(u),l=v(a),l>0&&p.length>l&&!p.warned){p.warned=!0;var w=new Error("Possible EventEmitter memory leak detected. "+p.length+" "+String(s)+" listeners added. Use emitter.setMaxListeners() to increase limit");w.name="MaxListenersExceededWarning",w.emitter=a,w.type=s,w.count=p.length,r(w)}return a}i.prototype.addListener=function(s,u){return y(this,s,u,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(s,u){return y(this,s,u,!0)};function b(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function S(a,s,u){var d={fired:!1,wrapFn:void 0,target:a,type:s,listener:u},l=b.bind(d);return l.listener=u,d.wrapFn=l,l}i.prototype.once=function(s,u){return g(u),this.on(s,S(this,s,u)),this},i.prototype.prependOnceListener=function(s,u){return g(u),this.prependListener(s,S(this,s,u)),this},i.prototype.removeListener=function(s,u){var d,l,_,p,w;if(g(u),l=this._events,l===void 0)return this;if(d=l[s],d===void 0)return this;if(d===u||d.listener===u)--this._eventsCount===0?this._events=Object.create(null):(delete l[s],l.removeListener&&this.emit("removeListener",s,d.listener||u));else if(typeof d!="function"){for(_=-1,p=d.length-1;p>=0;p--)if(d[p]===u||d[p].listener===u){w=d[p].listener,_=p;break}if(_<0)return this;_===0?d.shift():I(d,_),d.length===1&&(l[s]=d[0]),l.removeListener!==void 0&&this.emit("removeListener",s,w||u)}return this},i.prototype.off=i.prototype.removeListener,i.prototype.removeAllListeners=function(s){var u,d,l;if(d=this._events,d===void 0)return this;if(d.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):d[s]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete d[s]),this;if(arguments.length===0){var _=Object.keys(d),p;for(l=0;l<_.length;++l)p=_[l],p!=="removeListener"&&this.removeAllListeners(p);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(u=d[s],typeof u=="function")this.removeListener(s,u);else if(u!==void 0)for(l=u.length-1;l>=0;l--)this.removeListener(s,u[l]);return this};function m(a,s,u){var d=a._events;if(d===void 0)return[];var l=d[s];return l===void 0?[]:typeof l=="function"?u?[l.listener||l]:[l]:u?R(l):P(l,l.length)}i.prototype.listeners=function(s){return m(this,s,!0)},i.prototype.rawListeners=function(s){return m(this,s,!1)},i.listenerCount=function(a,s){return typeof a.listenerCount=="function"?a.listenerCount(s):E.call(a,s)},i.prototype.listenerCount=E;function E(a){var s=this._events;if(s!==void 0){var u=s[a];if(typeof u=="function")return 1;if(u!==void 0)return u.length}return 0}i.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function P(a,s){for(var u=new Array(s),d=0;d<s;++d)u[d]=a[d];return u}function I(a,s){for(;s+1<a.length;s++)a[s]=a[s+1];a.pop()}function R(a){for(var s=new Array(a.length),u=0;u<s.length;++u)s[u]=a[u].listener||a[u];return s}function h(a,s){return new Promise(function(u,d){function l(p){a.removeListener(s,_),d(p)}function _(){typeof a.removeListener=="function"&&a.removeListener("error",l),u([].slice.call(arguments))}A(a,s,_,{once:!0}),s!=="error"&&O(a,l,{once:!0})})}function O(a,s,u){typeof a.on=="function"&&A(a,"error",s,u)}function A(a,s,u,d){if(typeof a.on=="function")d.once?a.once(s,u):a.on(s,u);else if(typeof a.addEventListener=="function")a.addEventListener(s,function l(_){d.once&&a.removeEventListener(s,l),u(_)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof a)}return V.exports}var pe=je();const Ve=31;var Z;(function(e){e[e.SLICE_NON_IDR=1]="SLICE_NON_IDR",e[e.SLICE_PARTITION_A=2]="SLICE_PARTITION_A",e[e.SLICE_PARTITION_B=3]="SLICE_PARTITION_B",e[e.SLICE_PARTITION_C=4]="SLICE_PARTITION_C",e[e.SLICE_IDR=5]="SLICE_IDR",e[e.SEI=6]="SEI",e[e.SPS=7]="SPS",e[e.PPS=8]="PPS",e[e.AUD=9]="AUD",e[e.END_SEQ=10]="END_SEQ",e[e.END_STREAM=11]="END_STREAM",e[e.FILLER_DATA=12]="FILLER_DATA",e[e.SPS_EXT=13]="SPS_EXT",e[e.PREFIX_NALU=14]="PREFIX_NALU",e[e.SUBSET_SPS=15]="SUBSET_SPS",e[e.DPS=16]="DPS",e[e.SLICE_AUX=19]="SLICE_AUX",e[e.SLICE_EXT=20]="SLICE_EXT",e[e.SLICE_LAYER_EXT=21]="SLICE_LAYER_EXT"})(Z||(Z={}));var L;(function(e){e[e.TRAIL_N=0]="TRAIL_N",e[e.TRAIL_R=1]="TRAIL_R",e[e.TSA_N=2]="TSA_N",e[e.TSA_R=3]="TSA_R",e[e.STSA_N=4]="STSA_N",e[e.STSA_R=5]="STSA_R",e[e.RADL_N=6]="RADL_N",e[e.RADL_R=7]="RADL_R",e[e.RASL_N=8]="RASL_N",e[e.RASL_R=9]="RASL_R",e[e.BLA_W_LP=16]="BLA_W_LP",e[e.BLA_W_RADL=17]="BLA_W_RADL",e[e.BLA_N_LP=18]="BLA_N_LP",e[e.IDR_W_RADL=19]="IDR_W_RADL",e[e.IDR_N_LP=20]="IDR_N_LP",e[e.CRA_NUT=21]="CRA_NUT",e[e.VPS_NUT=32]="VPS_NUT",e[e.SPS_NUT=33]="SPS_NUT",e[e.PPS_NUT=34]="PPS_NUT",e[e.AUD_NUT=35]="AUD_NUT",e[e.EOS_NUT=36]="EOS_NUT",e[e.EOB_NUT=37]="EOB_NUT",e[e.FD_NUT=38]="FD_NUT",e[e.PREFIX_SEI_NUT=39]="PREFIX_SEI_NUT",e[e.SUFFIX_SEI_NUT=40]="SUFFIX_SEI_NUT"})(L||(L={}));function ge(e){return e&Ve}function ve(e){return e>>1&63}function we(e){return e===Z.SLICE_IDR||e===Z.SLICE_NON_IDR}function me(e){return e===L.TRAIL_N||e===L.TRAIL_R||e===L.TSA_N||e===L.TSA_R||e===L.STSA_N||e===L.STSA_R||e===L.RADL_N||e===L.RADL_R||e===L.RASL_N||e===L.RASL_R||e===L.BLA_W_LP||e===L.BLA_W_RADL||e===L.BLA_N_LP||e===L.IDR_W_RADL||e===L.IDR_N_LP||e===L.CRA_NUT}function Xe(e,t){for(const n of t){if(we(ge(e[n])))return"h264";if(me(ve(e[n])))return"h265"}return"unknown"}function ze(e,t,n){for(const r of t)if(n==="h265"){const o=ve(e[r]);if(me(o))return r+2}else{const o=ge(e[r]);if(we(o))return r+2}return null}function Ge(e){const t=[];let n=0,r=0,o=e.length-3;for(;r<o;){for(;r<o&&!(r<o-1&&e[r]===0&&e[r+1]===0&&e[r+2]===0&&e[r+3]===1||e[r]===0&&e[r+1]===0&&e[r+2]===1);)r++;r>=o&&(r=e.length);let i=r;for(;i>n&&e[i-1]===0;)i--;if(n===0){if(i!==n)throw TypeError("byte stream contains leading data")}else t.push(n);let c=3;r<e.length-3&&e[r]===0&&e[r+1]===0&&e[r+2]===0&&e[r+3]===1&&(c=4),n=r=r+c}return t}function Ye(e,t){const n=Ge(e),r=t??Xe(e,n);if(r==="unknown")return{unencryptedBytes:0,detectedCodec:r,requiresNALUProcessing:!1};const o=ze(e,n,r);if(o===null)throw new TypeError("Could not find NALU");return{unencryptedBytes:o,detectedCodec:r,requiresNALUProcessing:!0}}function Ze(e){return C(this,void 0,void 0,function*(){const t=yield crypto.subtle.digest("SHA-256",e),n=new Uint8Array(t);return Array.from(n).map(r=>r.toString(16).padStart(2,"0")).join("")})}const B={VP8KeyFrame8x8:"ef0161653d8b2b23aad46624b420af1d03ce48950e9fc85718028f91b50f9219",H264KeyFrame2x2SPS:"f0a0e09647d891d6d50aa898bce7108090375d0d55e50a2bb21147afee558e44",H264KeyFrame2x2PPS:"61d9665eed71b6d424ae9539330a3bdd5cb386d4d781c808219a6e36750493a7",H264KeyFrame2x2IDR:"faffc26b68a2fc09096fa20f3351e706398b6f838a7500c8063472c2e476e90d",OpusSilenceFrame:"aad8d31fc56b2802ca500e58c2fb9d0b29ad71bb7cb52cd6530251eade188988"};function Je(e){return C(this,void 0,void 0,function*(){switch(yield Ze(e)){case B.VP8KeyFrame8x8:return"vp8";case B.H264KeyFrame2x2SPS:return"h264";case B.H264KeyFrame2x2PPS:return"h264";case B.H264KeyFrame2x2IDR:return"h264";case B.OpusSilenceFrame:return"opus";default:return null}})}const Ie=new Map;class $e extends pe.EventEmitter{encodeFunction(t,n){throw Error("not implemented for subclass")}decodeFunction(t,n){throw Error("not implemented for subclass")}}class Qe extends $e{constructor(t){var n;super(),this.isTransformActive=!1,this.lastErrorTimestamp=new Map,this.errorCounts=new Map,this.ERROR_THROTTLE_MS=1e3,this.MAX_ERRORS_PER_MINUTE=5,this.ERROR_WINDOW_MS=6e4,this.sendCounts=new Map,this.keys=t.keys,this.participantIdentity=t.participantIdentity,this.rtpMap=new Map,this.keyProviderOptions=t.keyProviderOptions,this.sifTrailer=(n=t.sifTrailer)!==null&&n!==void 0?n:Uint8Array.from([])}get logContext(){return{participant:this.participantIdentity,mediaTrackId:this.trackId,fallbackCodec:this.videoCodec}}setParticipant(t,n){f.debug("setting new participant on cryptor",Object.assign(Object.assign({},this.logContext),{participant:t})),this.participantIdentity&&f.error("cryptor has already a participant set, participant should have been unset before",Object.assign({},this.logContext)),this.participantIdentity=t,this.keys=n}unsetParticipant(){f.debug("unsetting participant",this.logContext),this.participantIdentity=void 0,this.lastErrorTimestamp=new Map,this.errorCounts=new Map}isEnabled(){if(this.participantIdentity)return Ie.get(this.participantIdentity)}getParticipantIdentity(){return this.participantIdentity}getTrackId(){return this.trackId}setVideoCodec(t){this.videoCodec=t}setRtpMap(t){this.rtpMap=t}setupTransform(t,n,r,o,i,c){if(c&&(f.info("setting codec on cryptor to",{codec:c}),this.videoCodec=c),f.debug("Setting up frame cryptor transform",Object.assign({operation:t,passedTrackId:o,codec:c},this.logContext)),i&&this.isTransformActive){f.debug("reuse transform",Object.assign({},this.logContext));return}const g=t==="encode"?this.encodeFunction:this.decodeFunction,v=new TransformStream({transform:g.bind(this)});this.isTransformActive=!0,n.pipeThrough(v).pipeTo(r).catch(y=>{f.warn(y),this.emit(U.Error,y instanceof x?y:new x(y.message,void 0,this.participantIdentity))}).finally(()=>{this.isTransformActive=!1}),this.trackId=o}setSifTrailer(t){f.debug("setting SIF trailer",Object.assign(Object.assign({},this.logContext),{trailer:t})),this.sifTrailer=t}shouldEmitError(t){var n,r;const o=Date.now(),i=(n=this.lastErrorTimestamp.get(t))!==null&&n!==void 0?n:0,c=(r=this.errorCounts.get(t))!==null&&r!==void 0?r:0;return o-i>this.ERROR_WINDOW_MS?(this.errorCounts.set(t,0),this.lastErrorTimestamp.set(t,o),!0):o-i<this.ERROR_THROTTLE_MS?!1:c>=this.MAX_ERRORS_PER_MINUTE?(c===this.MAX_ERRORS_PER_MINUTE&&(f.warn("Suppressing further decryption errors for ".concat(this.participantIdentity),Object.assign(Object.assign({},this.logContext),{errorKey:t})),this.errorCounts.set(t,c+1)),!1):(this.lastErrorTimestamp.set(t,o),this.errorCounts.set(t,c+1),!0)}emitThrottledError(t){var n;const r="".concat(this.participantIdentity,"-").concat(t.reason,"-decrypt");if(this.shouldEmitError(r)){const o=(n=this.errorCounts.get(r))!==null&&n!==void 0?n:0;o>1&&f.debug("Decryption error (".concat(o," occurrences in window)"),Object.assign(Object.assign({},this.logContext),{reason:K[t.reason]})),this.emit(U.Error,t)}}encodeFunction(t,n){return C(this,void 0,void 0,function*(){var r;if(!this.isEnabled()||t.data.byteLength===0)return n.enqueue(t);const o=this.keys.getKeySet();if(!o){this.emitThrottledError(new x("key set not found for ".concat(this.participantIdentity," at index ").concat(this.keys.getCurrentKeyIndex()),K.MissingKey,this.participantIdentity));return}const{encryptionKey:i}=o,c=this.keys.getCurrentKeyIndex();if(i){const v=this.makeIV((r=t.getMetadata().synchronizationSource)!==null&&r!==void 0?r:-1,t.timestamp);let y=this.getUnencryptedBytes(t);const b=new Uint8Array(t.data,0,y.unencryptedBytes),S=new Uint8Array(2);S[0]=oe,S[1]=c;try{const m=yield crypto.subtle.encrypt({name:F,iv:v,additionalData:new Uint8Array(t.data,0,b.byteLength)},i,new Uint8Array(t.data,y.unencryptedBytes));let E=new Uint8Array(m.byteLength+v.byteLength+S.byteLength);E.set(new Uint8Array(m)),E.set(new Uint8Array(v),m.byteLength),E.set(S,m.byteLength+v.byteLength),y.requiresNALUProcessing&&(E=We(E));var g=new Uint8Array(b.byteLength+E.byteLength);return g.set(b),g.set(E,b.byteLength),t.data=g.buffer,n.enqueue(t)}catch(m){f.error(m)}}else f.debug("failed to encrypt, emitting error",this.logContext),this.emitThrottledError(new x("encryption key missing for encoding",K.MissingKey,this.participantIdentity))})}decodeFunction(t,n){return C(this,void 0,void 0,function*(){if(!this.isEnabled()||t.data.byteLength===0)return n.enqueue(t);if(He(t.data,this.sifTrailer)){if(t.data=t.data.slice(0,t.data.byteLength-this.sifTrailer.byteLength),yield Je(t.data))return f.debug("enqueue SIF",this.logContext),n.enqueue(t);f.warn("Unexpected SIF frame payload, dropping frame",this.logContext);return}const o=new Uint8Array(t.data)[t.data.byteLength-1];if(!this.keys.hasInvalidKeyAtIndex(o))if(this.keys.getKeySet(o))try{const i=yield this.decryptFrame(t,o);if(this.keys.decryptionSuccess(o),i)return n.enqueue(i)}catch(i){i instanceof x&&i.reason===K.InvalidKey?this.keys.hasValidKey&&(this.emitThrottledError(i),this.keys.decryptionFailure(o)):f.warn("decoding frame failed",{error:i})}else f.warn("skipping decryption due to missing key at index ".concat(o)),this.emitThrottledError(new x("missing key at index ".concat(o," for participant ").concat(this.participantIdentity),K.MissingKey,this.participantIdentity)),this.keys.decryptionFailure(o)})}decryptFrame(t,n){return C(this,arguments,void 0,function(r,o){var i=this;let c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0,g=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{ratchetCount:0};return(function*(){var v;const y=i.keys.getKeySet(o);if(!g.encryptionKey&&!y)throw new TypeError("no encryption key found for decryption of ".concat(i.participantIdentity));let b=i.getUnencryptedBytes(r);try{const m=new Uint8Array(r.data,0,b.unencryptedBytes);var S=new Uint8Array(r.data,m.length,r.data.byteLength-m.length);if(b.requiresNALUProcessing&&Ne(S)){S=Ue(S);const s=new Uint8Array(m.byteLength+S.byteLength);s.set(m),s.set(S,m.byteLength),r.data=s.buffer}const E=new Uint8Array(r.data,r.data.byteLength-2,2),P=E[0],I=new Uint8Array(r.data,r.data.byteLength-P-E.byteLength,P),R=m.byteLength,h=r.data.byteLength-(m.byteLength+P+E.byteLength),O=yield crypto.subtle.decrypt({name:F,iv:I,additionalData:new Uint8Array(r.data,0,m.byteLength)},(v=g.encryptionKey)!==null&&v!==void 0?v:y.encryptionKey,new Uint8Array(r.data,R,h)),A=new ArrayBuffer(m.byteLength+O.byteLength),a=new Uint8Array(A);return a.set(new Uint8Array(r.data,0,m.byteLength)),a.set(new Uint8Array(O),m.byteLength),r.data=A,r}catch(m){if(i.keyProviderOptions.ratchetWindowSize>0)if(g.ratchetCount<i.keyProviderOptions.ratchetWindowSize){f.debug("ratcheting key attempt ".concat(g.ratchetCount," of ").concat(i.keyProviderOptions.ratchetWindowSize,", for kind ").concat(r instanceof RTCEncodedAudioFrame?"audio":"video"));let E,P;(c??y)===i.keys.getKeySet(o)&&(P=yield i.keys.ratchetKey(o,!1),E=yield ne(P.cryptoKey,i.keyProviderOptions.ratchetSalt));const I=yield i.decryptFrame(r,o,c||y,{ratchetCount:g.ratchetCount+1,encryptionKey:E?.encryptionKey});return I&&E&&(c??y)===i.keys.getKeySet(o)&&(i.keys.setKeySet(E,o,P),i.keys.setCurrentKeyIndex(o)),I}else throw f.warn("maximum ratchet attempts exceeded"),new x("valid key missing for participant ".concat(i.participantIdentity),K.InvalidKey,i.participantIdentity);else throw new x("Decryption failed: ".concat(m.message),K.InvalidKey,i.participantIdentity)}})()})}makeIV(t,n){var r;const o=new ArrayBuffer(oe),i=new DataView(o);this.sendCounts.has(t)||this.sendCounts.set(t,Math.floor(Math.random()*65535));const c=(r=this.sendCounts.get(t))!==null&&r!==void 0?r:0;return i.setUint32(0,t),i.setUint32(4,n),i.setUint32(8,n-c%65535),this.sendCounts.set(t,c+1),o}getUnencryptedBytes(t){var n;if(!De(t))return{unencryptedBytes:$.audio,requiresNALUProcessing:!1};const r=(n=this.getVideoCodec(t))!==null&&n!==void 0?n:this.videoCodec;if(r!==this.detectedCodec&&(f.debug("detected different codec",Object.assign({detectedCodec:r,oldCodec:this.detectedCodec},this.logContext)),this.detectedCodec=r),r==="av1")throw new Error("".concat(r," is not yet supported for end to end encryption"));if(r==="vp8")return{unencryptedBytes:$[t.type],requiresNALUProcessing:!1};if(r==="vp9")return{unencryptedBytes:0,requiresNALUProcessing:!1};try{const o=r==="h264"||r==="h265"?r:void 0,i=Ye(new Uint8Array(t.data),o);if(i.requiresNALUProcessing)return{unencryptedBytes:i.unencryptedBytes,requiresNALUProcessing:!0}}catch(o){f.debug("NALU processing failed, falling back to VP8 handling",Object.assign({error:o},this.logContext))}return{unencryptedBytes:$[t.type],requiresNALUProcessing:!1}}getVideoCodec(t){if(this.rtpMap.size===0)return;const n=t.getMetadata().payloadType;return n?this.rtpMap.get(n):void 0}}function He(e,t){if(t.byteLength===0)return!1;const n=new Uint8Array(e.slice(e.byteLength-t.byteLength));return t.every((r,o)=>r===n[o])}class _e extends pe.EventEmitter{get hasValidKey(){return!this.hasInvalidKeyAtIndex(this.currentKeyIndex)}constructor(t,n){if(super(),this.currentKeyIndex=0,n.keyringSize<1||n.keyringSize>256)throw new TypeError("Keyring size needs to be between 1 and 256");this.cryptoKeyRing=new Array(n.keyringSize).fill(void 0),this.decryptionFailureCounts=new Array(n.keyringSize).fill(0),this.keyProviderOptions=n,this.ratchetPromiseMap=new Map,this.participantIdentity=t}hasInvalidKeyAtIndex(t){return this.keyProviderOptions.failureTolerance>=0&&this.decryptionFailureCounts[t]>this.keyProviderOptions.failureTolerance}decryptionFailure(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.currentKeyIndex;this.keyProviderOptions.failureTolerance<0||(this.decryptionFailureCounts[t]+=1,this.decryptionFailureCounts[t]>this.keyProviderOptions.failureTolerance&&f.warn("key for ".concat(this.participantIdentity," at index ").concat(t," is being marked as invalid")))}decryptionSuccess(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.currentKeyIndex;this.resetKeyStatus(t)}resetKeyStatus(t){t===void 0?this.decryptionFailureCounts.fill(0):this.decryptionFailureCounts[t]=0}ratchetKey(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;const r=t??this.getCurrentKeyIndex(),o=this.ratchetPromiseMap.get(r);if(typeof o<"u")return o;const i=new Promise((c,g)=>C(this,void 0,void 0,function*(){try{const v=this.getKeySet(r);if(!v)throw new TypeError("Cannot ratchet key without a valid keyset of participant ".concat(this.participantIdentity));const y=v.material,b=yield Be(y,this.keyProviderOptions.ratchetSalt),S=yield Fe(b,y.algorithm.name,"derive"),m={chainKey:b,cryptoKey:S};n&&(yield this.setKeyFromMaterial(S,r,m)),c(m)}catch(v){g(v)}finally{this.ratchetPromiseMap.delete(r)}}));return this.ratchetPromiseMap.set(r,i),i}setKey(t){return C(this,arguments,void 0,function(n){var r=this;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return(function*(){yield r.setKeyFromMaterial(n,o),r.resetKeyStatus(o)})()})}setKeyFromMaterial(t,n){return C(this,arguments,void 0,function(r,o){var i=this;let c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;return(function*(){const g=yield ne(r,i.keyProviderOptions.ratchetSalt),v=o>=0?o%i.cryptoKeyRing.length:i.currentKeyIndex;f.debug("setting new key with index ".concat(o),{usage:r.usages,algorithm:r.algorithm,ratchetSalt:i.keyProviderOptions.ratchetSalt}),i.setKeySet(g,v,c),v>=0&&(i.currentKeyIndex=v)})()})}setKeySet(t,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;this.cryptoKeyRing[n%this.cryptoKeyRing.length]=t,r&&this.emit(Y.KeyRatcheted,r,this.participantIdentity,n)}setCurrentKeyIndex(t){return C(this,void 0,void 0,function*(){this.currentKeyIndex=t%this.cryptoKeyRing.length,this.resetKeyStatus(t)})}getCurrentKeyIndex(){return this.currentKeyIndex}getKeySet(t){return this.cryptoKeyRing[t??this.currentKeyIndex]}}const q=[],he=new Map;let Q,et=new xe,tt=!1,J=!1,be,W=Me,Ee=new Map;f.setDefaultLevel("info");onmessage=e=>{et.run(()=>C(void 0,void 0,void 0,function*(){const{kind:t,data:n}=e.data;switch(t){case"init":f.setLevel(n.loglevel),f.info("worker initialized"),W=n.keyProviderOptions,J=!!n.keyProviderOptions.sharedKey,postMessage({kind:"initAck",data:{enabled:tt}});break;case"enable":it(n.enabled,n.participantIdentity),f.info("updated e2ee enabled status for ".concat(n.participantIdentity," to ").concat(n.enabled)),postMessage(e.data);break;case"decode":z(n.participantIdentity,n.trackId).setupTransform(t,n.readableStream,n.writableStream,n.trackId,n.isReuse,n.codec);break;case"encode":z(n.participantIdentity,n.trackId).setupTransform(t,n.readableStream,n.writableStream,n.trackId,n.isReuse,n.codec);break;case"encryptDataRequest":const{payload:c,iv:g,keyIndex:v}=yield M.encrypt(n.payload,D(n.participantIdentity));console.log("encrypted payload",{original:n.payload,encrypted:c,iv:g}),postMessage({kind:"encryptDataResponse",data:{payload:c,iv:g,keyIndex:v,uuid:n.uuid}});break;case"decryptDataRequest":try{const{payload:y}=yield M.decrypt(n.payload,n.iv,D(n.participantIdentity),n.keyIndex);postMessage({kind:"decryptDataResponse",data:{payload:y,uuid:n.uuid}})}catch(y){f.error("DataCryptor decryption failed",{error:y,participantIdentity:n.participantIdentity,uuid:n.uuid}),postMessage({kind:"error",data:{error:y instanceof Error?y:new Error(String(y)),uuid:n.uuid}})}break;case"setKey":J?yield st(n.key,n.keyIndex):n.participantIdentity?(f.info("set participant sender key ".concat(n.participantIdentity," index ").concat(n.keyIndex)),yield D(n.participantIdentity).setKey(n.key,n.keyIndex)):f.error("no participant Id was provided and shared key usage is disabled");break;case"removeTransform":rt(n.trackId,n.participantIdentity);break;case"updateCodec":z(n.participantIdentity,n.trackId).setVideoCodec(n.codec),f.info("updated codec",{participantIdentity:n.participantIdentity,trackId:n.trackId,codec:n.codec});break;case"setRTPMap":Ee=n.map,q.forEach(y=>{y.getParticipantIdentity()===n.participantIdentity&&y.setRtpMap(n.map)});break;case"ratchetRequest":nt(n);break;case"setSifTrailer":ct(n.trailer);break}}))};function nt(e){return C(this,void 0,void 0,function*(){if(J){const t=re();yield t.ratchetKey(e.keyIndex),t.resetKeyStatus()}else if(e.participantIdentity){const t=D(e.participantIdentity);yield t.ratchetKey(e.keyIndex),t.resetKeyStatus()}else f.error("no participant Id was provided for ratchet request and shared key usage is disabled")})}function z(e,t){let n=q.filter(o=>o.getTrackId()===t);if(n.length>1){const o=n.map(i=>({participant:i.getParticipantIdentity()})).join(",");f.error("Found multiple cryptors for the same trackID ".concat(t,". target participant: ").concat(e," "),{participants:o})}let r=n[0];if(r)e!==r.getParticipantIdentity()&&r.setParticipant(e,D(e));else{if(f.info("creating new cryptor for",{participantIdentity:e,trackId:t}),!W)throw Error("Missing keyProvider options");r=new Qe({participantIdentity:e,keys:D(e),keyProviderOptions:W,sifTrailer:be}),r.setRtpMap(Ee),ot(r),q.push(r)}return r}function D(e){if(J)return re();let t=he.get(e);return t||(t=new _e(e,W),t.on(Y.KeyRatcheted,at),he.set(e,t)),t}function re(){return Q||(f.debug("creating new shared key handler"),Q=new _e("shared-key",W)),Q}function rt(e,t){const n=q.filter(o=>o.getParticipantIdentity()===t&&o.getTrackId()===e);n.length>1&&f.error("Found multiple cryptors for the same participant and trackID combination",{trackId:e,participantIdentity:t});const r=n[0];r?r.unsetParticipant():f.warn("Could not unset participant on cryptor",{trackId:e,participantIdentity:t})}function it(e,t){f.debug("setting encryption enabled for all tracks of ".concat(t),{enable:e}),Ie.set(t,e)}function st(e,t){return C(this,void 0,void 0,function*(){f.info("set shared key",{index:t}),yield re().setKey(e,t)})}function ot(e){e.on(U.Error,t=>{const n={kind:"error",data:{error:new Error("".concat(K[t.reason],": ").concat(t.message)),participantIdentity:t.participantIdentity}};postMessage(n)})}function at(e,t,n){postMessage({kind:"ratchetKey",data:{participantIdentity:t,keyIndex:n,ratchetResult:e}})}function ct(e){be=e,q.forEach(t=>{t.setSifTrailer(e)})}self.RTCTransformEvent&&(f.debug("setup transform event"),self.onrtctransform=e=>{const t=e.transformer;f.debug("transformer",t);const{kind:n,participantIdentity:r,trackId:o,codec:i}=t.options,c=z(r,o);f.debug("transform",{codec:i}),c.setupTransform(n,t.readable,t.writable,o,!1,i)});
//# sourceMappingURL=livekit-client.e2ee.worker-Bmrtztct.js.map
`,BY=typeof self<"u"&&self.Blob&&new Blob(["URL.revokeObjectURL(import.meta.url);",fpe],{type:"text/javascript;charset=utf-8"});function Att(t){let e;try{if(e=BY&&(self.URL||self.webkitURL).createObjectURL(BY),!e)throw"";const n=new Worker(e,{type:"module",name:t?.name});return n.addEventListener("error",()=>{(self.URL||self.webkitURL).revokeObjectURL(e)}),n}catch{return new Worker("data:text/javascript;charset=utf-8,"+encodeURIComponent(fpe),{type:"module",name:t?.name})}}const Ltt={audioPreset:KC.music,dtx:!0,red:!1,forceStereo:!1,simulcast:!0,videoSimulcastLayers:[Sl.h180,Sl.h360],screenShareEncoding:jT.h1080fps30.encoding,stopMicTrackOnMute:!1,videoCodec:"vp8",videoEncoding:Sl.h720.encoding,backupCodec:{codec:"vp8",encoding:Sl.h720.encoding}},R5={adaptiveStream:!0,dynacast:!0,videoCaptureDefaults:{resolution:Sl.h720.resolution},publishDefaults:Ltt,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new PZ,disconnectOnPageLeave:!0,webAudioMix:!1};class Mtt{constructor(e,n,r,i,s,o,a,c=!0,l=!0){this.client=e,this.roomId=n,this.devices=r,this.processorState$=i,this.controlledAudioDevices=o;const d=()=>new td(Ott({devices:this.devices,processorState:this.processorState$.value,e2eeLivekitOptions:s&&{keyProvider:s,worker:new Att},controlledAudioDevices:this.controlledAudioDevices,echoCancellation:c,noiseSuppression:l}));this.livekitRoomFactory=a??d}createConnection(e,n,r,i,s){return new Ctt({existingSFUConfig:s,roomId:this.roomId,transport:n,client:this.client,scope:e,livekitRoomFactory:this.livekitRoomFactory,ownMembershipIdentity:r},i)}}function Ott({devices:t,processorState:e,e2eeLivekitOptions:n,controlledAudioDevices:r,echoCancellation:i,noiseSuppression:s}){return{...R5,videoCaptureDefaults:{...R5.videoCaptureDefaults,deviceId:t.videoInput.selected$.value?.id,processor:e.processor},audioCaptureDefaults:{...R5.audioCaptureDefaults,deviceId:t.audioInput.selected$.value?.id,echoCancellation:i,noiseSuppression:s},audioOutput:{deviceId:r?void 0:t.audioOutput.selected$.value?.id},e2ee:n}}class k5{constructor(){this.store=new Map}add(e,n){const r=this.getKey(e.transport),i=this.store.get(r);i?i.participants.push(...n):this.store.set(r,{connection:e,participants:n})}getKey(e){return e.livekit_service_url}getConnections(){return Array.from(this.store.values()).map(({connection:e})=>e)}getConnectionForTransport(e){return this.store.get(this.getKey(e))?.connection??null}getParticipantsForTransport(e){const n=this.getKey(e),r=this.store.get(n);return r?r.participants:[]}}function Ptt({scope:t,connectionFactory:e,localTransport$:n,remoteTransports$:r,logger:i,ownMembershipIdentity:s}){const o=i.getChild("[ConnectionManager]"),a=t.behavior(ot([r,n]).pipe(ve(([d,h])=>{let m=[];h&&(m=[h]);const y=Dtt(d.value).filter(v=>!m.find(E=>sN(E.transport,v)));return o.debug("remoteWithoutLocal",y,"localTransportAsArray",m),new Lc([...m,...y],d.epoch)}))),c=t.behavior(a.pipe(lue("ConnectionManager connections$",function*(d){for(const h of d)if(ytt(h)){const{transport:m,sfuConfig:g}=h;yield{keys:[m.livekit_service_url,g],data:void 0}}else yield{keys:[h.livekit_service_url,void 0],data:void 0}},(d,h,m,g)=>{const y=e.createConnection(d,{type:"livekit",livekit_service_url:m},s,o,g);return y.start(),y})));return{connectionManagerData$:t.behavior(c.pipe(gt(d=>{const h=d.epoch,m=d.value.map(g=>g.remoteParticipants$.pipe(ve(y=>({connection:g,participants:y}))));return m.length===0?mt(new Lc(new k5,h)):ot(m).pipe(ve(g=>new Lc(g.reduce((y,{connection:v,participants:E})=>(y.add(v,E),y),new k5),h)))})),new Lc(new k5,-1))}}function Dtt(t){return t.reduce((e,n)=>(e.some(r=>sN(r,n))||e.push(n),e),[])}function Ntt(t,e){return t.behavior(ms(e,Ji.DidSendCallNotification),null)}function Utt(t){return ms(t,Me.Timeline).pipe(ri(([e])=>e.getType()===ee.RTCDecline))}function jtt({scope:t,memberships$:e,sentCallNotification$:n,receivedDecline$:r,options:i,localUser:s}){const o=e.pipe(Yv(),ri(([{value:h},{value:m}])=>m.every(g=>g.userId===s.userId)&&h.some(g=>g.userId!==s.userId)),ve(()=>{})),a=e.pipe(nO(h=>h.some(m=>m.userId!==s.userId))),c=t.behavior(n.pipe(ri(h=>h?.notification_type==="ring"),ve(h=>h),gt(h=>{const m=h?.lifetime??0;return Wv(m===0?mt(null):jf(m).pipe(_Ke(),xn("ringing")),mt("timeout"),hb).pipe(Dle(r.pipe(ri(([g])=>g.getRelation()?.rel_type==="m.reference"&&g.getRelation()?.event_id===h.event_id&&g.getSender()!==s.userId&&l.value!=="timeout"))),Ole("decline"))})),null),l=t.behavior(i.waitForCallPickup===!0?ot([a,c],(h,m)=>h.value===!0?"success":m??"unknown"):hb,null);return{autoLeave$:Xu(i.autoLeaveWhenOthersLeft===!0?o.pipe(ve(()=>"allOthersLeft")):hb,l.pipe(ri(h=>h==="timeout"||h==="decline"))),callPickupState$:l}}const T1=new Map;function FO(t){if(T1.has(t))return T1.get(t);const e=kf(t);return T1.size>500&&T1.clear(),T1.set(t,e),e}function Ftt(t,e,n){const{rawDisplayName:r,userId:i}=t;if(!r||r===i)return!1;const s=FO(r);return s?/@.+:.+/.test(r)||/[\u200E\u200F\u202A-\u202F]/.test(r)?!0:e.map(o=>o.userId&&n.get(o.userId)).filter(o=>!!o).filter(o=>o.userId!==i).some(o=>FO(hpe(o,!1))===s):!1}function hpe(t,e){const{rawDisplayName:n,userId:r}=t;if(!n||n===r)return r;const i=_C(n);return e?i+" ("+r+")":FO(n)?i:r}const $tt=N.getChild("[MatrixMemberMetadata]");function HY(t){return t.getMembersWithMembership(Ke.Join).concat(t.getMembersWithMembership(Ke.Invite)).reduce((n,r)=>(n.set(r.userId,{userId:r.userId,getMxcAvatarUrl:r.getMxcAvatarUrl.bind(r),rawDisplayName:r.rawDisplayName}),n),new Map)}function Btt(t,e){return t.behavior(ms(e,Rt.Members).pipe(ve(()=>HY(e))),HY(e))}function Htt(t,e,n){return t.behavior(e.pipe(ve(r=>r.size===2?n.getMember(n.guessDMUserId()):null)))}const qtt=(t,e,n)=>{const r=new Set;return t.behavior(ot([e,n]).pipe(ve(([i,s])=>{const o=new Map;for(const a of i){const c=s.get(a.userId);if(!c){$tt.error(`Could not find member for user ${a.userId}`);continue}const l=Ftt(c,i,s),d=r.has(a.userId)||l;d&&r.add(a.userId),o.set(a.userId,hpe(c,d))}return o})))},Vtt=(t,e,n)=>{const r=qtt(t,e,n),i=t.behavior(n.pipe(ve(s=>Array.from(s.keys()).reduce((o,a)=>(o.set(a,s.get(a)?.getMxcAvatarUrl()),o),new Map))));return{createDisplayNameBehavior$:s=>t.behavior(r.pipe(ve(o=>o.get(s)))),createAvatarUrlBehavior$:s=>t.behavior(n.pipe(ve(o=>o.get(s)?.getMxcAvatarUrl()))),displaynameMap$:r,avatarMap$:i}};class Ktt{constructor(e,n,r,i,s){this.connection=e,this.muteStates=r,this.logger=s,this.shouldPublish=!1,this.scope=new pS;const{controlledAudioDevices:o}=ur(),a=e.livekitRoom;a.setE2EEEnabled(a.options.e2ee!==void 0)?.catch(c=>{this.logger.error("Failed to set E2EE enabled on room",c)}),this.observeTrackProcessors(this.scope,a,i),this.observeMediaDevices(this.scope,n,o),this.workaroundRestartAudioInputTrackChrome(n,this.scope),this.connection.livekitRoom.localParticipant.on(ae.LocalTrackPublished,this.onLocalTrackPublished.bind(this))}async destroy(){this.scope.end(),this.logger.info("Scope ended -> unset handler"),this.muteStates.audio.unsetHandler(),this.muteStates.video.unsetHandler(),this.logger.info("Start to stop tracks");try{await this.stopTracks(),this.logger.info("Done to stop tracks")}catch(e){this.logger.error(`Failed to stop tracks: ${e}`)}}onLocalTrackPublished(e){this.logger.info("Local track published",e);const n=this.connection.livekitRoom;if(this.shouldPublish||this.pauseUpstreams(n,[e.source]).catch(r=>{this.logger.error("Failed to pause upstreams",r)}),e.source===pe.Source.Microphone){const r=this.muteStates.audio.enabled$.value;n.localParticipant.setMicrophoneEnabled(r).catch(i=>{this.logger.error(`Failed to enable microphone track, enabled:${r}`,i)})}else if(e.source===pe.Source.Camera){const r=this.muteStates.video.enabled$.value;n.localParticipant.setCameraEnabled(r).catch(i=>{this.logger.error(`Failed to enable camera track, enabled:${r}`,i)})}}async createAndSetupTracks(){this.logger.debug("createAndSetupTracks called");const e=this.connection.livekitRoom;this.observeMuteStates();const n=this.muteStates.audio.enabled$.value,r=this.muteStates.video.enabled$.value;return n&&r?e.localParticipant.enableCameraAndMicrophone():n?e.localParticipant.setMicrophoneEnabled(!0):r&&e.localParticipant.setCameraEnabled(!0),Promise.resolve()}async pauseUpstreams(e,n){for(const r of n){const i=e.localParticipant.getTrackPublication(r)?.track;i?await i.pauseUpstream():this.logger.warn(`No track found for source ${r} to pause upstream`)}}async resumeUpstreams(e,n){for(const r of n){const i=e.localParticipant.getTrackPublication(r)?.track;i?await i.resumeUpstream():this.logger.warn(`No track found for source ${r} to resume upstream`)}}async startPublishing(){if(this.shouldPublish){this.logger.debug("Already publishing, ignoring startPublishing call");return}this.shouldPublish=!0,this.logger.debug("startPublishing called");const e=this.connection.livekitRoom;try{await this.resumeUpstreams(e,[pe.Source.Microphone,pe.Source.Camera])}catch(n){this.logger.error("Failed to resume upstreams",n)}}async stopPublishing(){this.logger.debug("stopPublishing called"),this.shouldPublish=!1,await this.pauseUpstreams(this.connection.livekitRoom,[pe.Source.Microphone,pe.Source.Camera,pe.Source.ScreenShare])}async stopTracks(){const e=this.connection.livekitRoom;for(const n of[pe.Source.Microphone,pe.Source.Camera,pe.Source.ScreenShare]){const r=e.localParticipant.getTrackPublication(n);r?.track&&await e.localParticipant.unpublishTrack(r.track,!0)}}workaroundRestartAudioInputTrackChrome(e,n){const r=this.connection.livekitRoom;e.audioInput.selected$.pipe(gt(i=>i?.hardwareDeviceChange$??hb),n.bind()).subscribe(()=>{if(r.state!=Xt.Connected)return;const i=Array.from(r.localParticipant.audioTrackPublications.values()).find(s=>s.source===pe.Source.Microphone)?.track;i&&i.mediaStreamTrack.readyState!=="ended"&&(this.logger?.info("Restarting audio device track due to active media device changed (workaroundRestartAudioInputTrackChrome)"),r.localParticipant.getTrackPublication(pe.Source.Microphone)?.audioTrack?.restartTrack().catch(s=>{this.logger.error("Failed to restart audio device track",s)}))})}observeMediaDevices(e,n,r){const i=this.connection.livekitRoom,s=(o,a)=>a.pipe(e.bind()).subscribe(c=>{i.state==Xt.Connected&&(this.logger.info("[LivekitRoom] syncDevice room.getActiveDevice(kind) !== d.id :",i.getActiveDevice(o)," !== ",c?.id),c!==void 0&&i.getActiveDevice(o)!==c.id&&i.switchActiveDevice(o,c.id).catch(l=>this.logger.error(`Failed to sync ${o} device with LiveKit`,l)))});s("audioinput",n.audioInput.selected$),r||s("audiooutput",n.audioOutput.selected$),s("videoinput",n.videoInput.selected$)}observeMuteStates(){const e=this.connection.livekitRoom;this.muteStates.audio.setHandler(async n=>{try{this.logger.debug(`handler: Setting LiveKit microphone enabled: ${n}`),await e.localParticipant.setMicrophoneEnabled(n),!this.shouldPublish&&n&&await this.pauseUpstreams(e,[pe.Source.Microphone])}catch(r){this.logger.error("Failed to update LiveKit audio input mute state",r)}return e.localParticipant.isMicrophoneEnabled}),this.muteStates.video.setHandler(async n=>{try{this.logger.debug(`handler: Setting LiveKit camera enabled: ${n}`),await e.localParticipant.setCameraEnabled(n),!this.shouldPublish&&n&&await this.pauseUpstreams(e,[pe.Source.Camera])}catch(r){this.logger.error("Failed to update LiveKit video input mute state",r)}return e.localParticipant.isCameraEnabled})}observeTrackProcessors(e,n,r){const i=e.behavior(qD(n.localParticipant,pe.Source.Camera).pipe(ve(s=>{const o=s?.publication.track;return o instanceof Pv?o:null})),null);oYe(e,i,r)}}function Gtt(t,e,n){const r=new Ar,i=a=>r.next(a),s=t.behavior(ot([n,e],(a,c)=>a||c==="flat"?"spotlight":"grid"));return{gridMode$:t.behavior(r.pipe(ve(a=>a==="grid"?s.pipe(Ple(c=>c!==a),xn(a)):a===s.value?s:FR(a)),xn(s),gt(a=>a))),setGridMode:i}}const ap=N.getChild("[CallViewModel]"),qY=8,VY=500,ztt=3,I5=4e3;function Wtt(t,e,n,r,i,s,o,a,c){const l=n.client,d=l.getUserId(),h=l.getDeviceId();if(!(d&&h))throw new Wp(new Error("userId and deviceId are required"));const m=Ytt(s.encryptionSystem,e),g=s.matrixRTCMode$??FR(so.Legacy),y=xtt(t,e),v=Itt(t,y),E={userId:d,deviceId:h,memberId:GJ()},w=btt({scope:t,memberships$:y,ownMembershipIdentity:E,client:l,delayId$:t.behavior(ms(e,_l.DelayIdChanged).pipe(ve(([ne])=>ne??null)),e.delayId??null),roomId:n.roomId,forceJwtEndpoint$:t.behavior(g.pipe(ve(ne=>ne===so.Matrix_2_0?lT.Matrix_2_0:lT.Legacy))),useOldestMember$:t.behavior(g.pipe(ve(ne=>ne===so.Legacy)))}),R=new Mtt(l,n.roomId,r,c,m,ur().controlledAudioDevices,s.livekitRoomFactory,ur().echoCancellation,ur().noiseSuppression),x=Ptt({scope:t,connectionFactory:R,localTransport$:t.behavior(w.pipe(DR(ne=>(ap.info("could not pass local transport to createConnectionManager$. localTransport$ threw an error",ne),mt(null))))),remoteTransports$:v.transports$,logger:ap,ownMembershipIdentity:E}),C=vtt({scope:t,membershipsWithTransport$:v.membershipsWithTransport$,connectionManager:x}),k=t.behavior(g.pipe(ve(ne=>({encryptMedia:m!==void 0,matrixRTCMode:ne})))),T=Ttt({scope:t,homeserverConnected:gtt(t,l,e),muteStates:i,joinMatrixRTC:ne=>ktt(e,E,ne,k.value),createPublisherFactory:ne=>new Ktt(ne,r,i,c,ap.getChild("[Publisher "+ne.transport.livekit_service_url+"]")),connectionManager:x,matrixRTCSession:e,localTransport$:w,logger:ap.getChild(`[${Date.now()}]`)}),L=t.behavior(y.pipe(ve(ne=>ne.value.find(Se=>Se.userId===d&&Se.deviceId===h)??null))),O=t.behavior(L.pipe(AGe(ne=>ne!==null),ve(ne=>ne===null?null:{membership$:ne,participant:{type:"local",value$:T.participant$},connection$:T.connection$,userId:d}))),{callPickupState$:P,autoLeave$:D}=jtt({scope:t,memberships$:y,sentCallNotification$:Ntt(t,e),receivedDecline$:Utt(n),options:s,localUser:{userId:d}}),j=Btt(t,n),H=Vtt(t,t.behavior(y.pipe(ve(ne=>ne.value))),j),z=Htt(t,j,n),Y=t.behavior(j.pipe(ve(ne=>ne.size===1&&ne.get(d)!==void 0))),W=t.behavior(ot([Y,z,P]).pipe(ve(([ne,Se,Ve])=>{if(Ve!=="ringing"||ne)return null;const ht=Se?Se.rawDisplayName:n.name,_t=Se?Se.userId:n.roomId,Wr=Se?`Waiting for ${ht} to join…`:"Waiting for other participants…",Dr=Se?Se.getMxcAvatarUrl?.()??void 0:n.getMxcAvatarUrl()??void 0;return{name:ht??_t,idForAvatar:_t,text:Wr,avatarMxc:Dr}}))),F=t.behavior(x.connectionManagerData$.pipe(ve(ne=>ne.value))),$=t.behavior(C.pipe(gt(ne=>ot(ne.value.map(Ve=>ot([Ve.connection$,Ve.participant.value$]).pipe(ve(([ht,_t])=>{if(!ht||!_t||_t.isLocal)return null;const Wr=ht.livekitRoom;return{url:ht.transport.livekit_service_url,livekitRoom:Wr,participant:_t.identity}}))))),ve(ne=>ne.reduce((Se,Ve)=>{if(!Ve)return Se;const ht=Se.find(_t=>_t.url===Ve.url);return ht?ht.participants.push(Ve.participant):Se.push({livekitRoom:Ve.livekitRoom,participants:[Ve.participant],url:Ve.url}),Se},[]))),[]),V=t.behavior(o.pipe(Pz(T.reconnecting$))),G=t.behavior(a.pipe(ve(ne=>Object.fromEntries(Object.entries(ne).map(([Se,{reactionOption:Ve}])=>[Se,Ve]))),Pz(T.reconnecting$))),Z=t.behavior(ot([O,C,Fle.value$]).pipe(cue("CallViewModel userMedia$",function*([ne,Se,Ve]){const ht=ir=>`${ir.userId}:${ir.membership$.value.deviceId}`,_t=ne?ht(ne):void 0,Wr=ne?[ne]:[],Dr=Se.value.filter(ir=>ht(ir)!==_t),Nr=[...Wr,...Dr];for(const ir of Nr){const{userId:Xc,participant:_h,connection$:Io,membership$:M4}=ir,LS=M4.value.rtcBackendIdentity,Sh=ht(ir);for(let wh=0;wh<1+Ve;wh++)yield{keys:[wh,Sh,Xc,_h,Io,LS],data:void 0}}},(ne,Se,Ve,ht,_t,Wr,Dr,Nr)=>{const ir=ne.behavior(Dr.pipe(ve(Io=>Io?.livekitRoom))),Xc=ne.behavior(Dr.pipe(ve(Io=>Io?.transport.livekit_service_url))),_h=ne.behavior(H.createDisplayNameBehavior$(_t).pipe(ve(Io=>Io??_t)));return new ctt(ne,`${ht}:${Ve}`,_t,Nr,Wr,s.encryptionSystem,ir,Xc,r,T.reconnecting$,_h,H.createAvatarUrlBehavior$(_t),V.pipe(ve(Io=>Io[ht]?.time??null)),G.pipe(ve(Io=>Io[ht]??void 0)))}))),q=t.behavior(Z.pipe(gt(ne=>ne.length===0?mt([]):ot(ne.map(Se=>Se.screenShares$),(...Se)=>[...ne,...Se.flat(1)])))),J=t.behavior(q.pipe(ve(ne=>ne.filter(Se=>Se instanceof ope)))),ue=Z.pipe(Yv(),ri(([ne,Se])=>Se.length<=qY&&Se.length>ne.length),ve(()=>{}),eO(VY)),ge=t.behavior(C.pipe(ve(ne=>ne.value.length))),Re=ot([P,Z]).pipe(Ple(([ne])=>ne!==null&&ne!=="success"),ve(([,ne])=>ne),Yv(),ri(([ne,Se])=>Se.length<=qY&&Se.length<ne.length),ve(()=>{}),eO(VY)),we=new Ar,de=Et===null?hb:ms(Et.lazyActions,kl.HangupCall).pipe(Tp(ne=>{Et.api.transport.reply(ne.detail,{})})),ke=Xu(D,Xu(we,de).pipe(ve(()=>"user"))).pipe(t.share),De=t.behavior(Z.pipe(gt(ne=>ne.length===0?mt([]):ot(ne.map(Se=>Se.vm.speaking$.pipe(ve(Ve=>[Se,Ve]))))),Ru((ne,Se)=>{const[Ve,ht]=!ne?.vm.local&&Se.find(([_t])=>_t===ne)||[];return ht?Ve:Se.find(([_t,Wr])=>!_t.vm.local&&Wr)?.[0]??Ve??Se.find(([_t])=>!_t.vm.local)?.[0]??Se.find(([_t])=>_t.vm.local)?.[0]},null),ve(ne=>ne?.vm??null))),Je=t.behavior(Z.pipe(gt(ne=>{const Se=ne.map(Ve=>Ve.bin$.pipe(ve(ht=>[Ve,ht])));return Se.length===0?mt([]):ot(Se,(...Ve)=>Ve.sort(([,ht],[,_t])=>ht-_t).map(([ht])=>ht.vm))}),fo(FY))),vt=t.behavior(J.pipe(gt(ne=>ne.length>0?mt(ne.map(Se=>Se.vm)):De.pipe(ve(Se=>Se?[Se]:[]))),fo(FY))),Sr=t.behavior(ot([J,De,q]).pipe(gt(([ne,Se,Ve])=>{if(ne.length>0)return De;if(!Se||Se.local)return mt(null);const _t=Ve.find(Wr=>Wr.vm instanceof cy)?.vm;return _t?_t.alwaysShow$.pipe(ve(Wr=>Wr?_t:null)):mt(null)}))),zn=t.behavior(vt.pipe(ve(ne=>ne.some(Se=>!Se.local&&Se instanceof zg)))),ze=t.behavior(Pg,!1),ys=s.windowSize$??t.behavior(ms(window,"resize").pipe(xn(null),ve(()=>({width:window.innerWidth,height:window.innerHeight})))),bs=t.behavior(ys.pipe(ve(({width:ne,height:Se})=>Se<=400&&ne<=340?"pip":Se<=600?"flat":ne<=600?"narrow":"normal"))),wi=t.behavior(ze.pipe(gt(ne=>ne?mt("pip"):bs))),ql=new Ar,sc=t.behavior(ql.pipe(oue(!1,ne=>!ne))),{setGridMode:_s,gridMode$:Ss}=Gtt(t,wi,zn),wd=ot([Je,vt],(ne,Se)=>({type:"grid",spotlight:Se.some(Ve=>Ve instanceof zg)?Se:void 0,grid:ne})),To=ot([Je,vt],(ne,Se)=>({type:"spotlight-landscape",spotlight:Se,grid:ne})),wr=ot([Je,vt],(ne,Se)=>({type:"spotlight-portrait",spotlight:Se,grid:ne})),oc=ot([vt,Sr],(ne,Se)=>({type:"spotlight-expanded",spotlight:ne,pip:Se??void 0})),Wc=q.pipe(ve(ne=>{if(ne.length!==2)return null;const Se=ne.find(ht=>ht.vm.local)?.vm,Ve=ne.find(ht=>!ht.vm.local)?.vm;return!Ve||!Se?null:{type:"one-on-one",local:Se,remote:Ve}})),Vl=vt.pipe(ve(ne=>({type:"pip",spotlight:ne}))),Ro=t.behavior(wi.pipe(gt(ne=>{switch(ne){case"normal":return Ss.pipe(gt(Se=>{switch(Se){case"grid":return Wc.pipe(gt(Ve=>Ve===null?wd:mt(Ve)));case"spotlight":return sc.pipe(gt(Ve=>Ve?oc:To))}}));case"narrow":return Wc.pipe(gt(Se=>Se===null?ot([Je,vt],(Ve,ht)=>Ve.length>ztt||ht.some(_t=>_t instanceof zg)?wr:wd).pipe(kKe()):oc));case"flat":return Ss.pipe(gt(Se=>{switch(Se){case"grid":return To;case"spotlight":return oc}}));case"pip":return Vl}}))),Yc=new Ar,Kl=ne=>Yc.next(ne),Ed=t.behavior(ot([Ro,Yc.pipe(xn(0),fo())]).pipe(Ru(({tiles:ne},[Se,Ve])=>{let ht,_t;switch(Se.type){case"grid":case"spotlight-landscape":case"spotlight-portrait":[ht,_t]=ntt(Se,Ve,Kl,ne);break;case"spotlight-expanded":[ht,_t]=rtt(Se,ne);break;case"one-on-one":[ht,_t]=itt(Se,ne);break;case"pip":[ht,_t]=stt(Se,ne);break}return{layout:ht,tiles:_t}},{layout:null,tiles:cT.empty()}))),qs=t.behavior(Ed.pipe(ve(({layout:ne})=>ne))),Ei=t.behavior(Ed.pipe(ve(({tiles:ne})=>ne.generation))),Gr=t.behavior(qs.pipe(ve(ne=>ne.type!=="grid"))),Vs=t.behavior(qs.pipe(gt(ne=>{switch(ne.type){case"spotlight-landscape":case"spotlight-portrait":return ne.spotlight.media$.pipe(ve(Se=>Se.some(Ve=>Ve instanceof zg)));case"spotlight-expanded":case"one-on-one":return mt(!1);default:return mt(!0)}}))),li=t.behavior(wi.pipe(gt(ne=>ne==="normal"?qs.pipe(ve(Se=>Se.type==="spotlight-landscape"||Se.type==="spotlight-expanded")):mt(!1)),fo(),ve(ne=>ne?()=>ql.next():null))),Cd=new Ar,ko=new Ar,nt=new Ar,Dt=new Ar,Be=t.behavior(wi.pipe(ve(ne=>ne!=="pip"&&ne!=="flat"))),rt=t.behavior(wi.pipe(gt(ne=>{switch(ne){case"pip":return mt(!1);case"normal":case"narrow":return mt(!0);case"flat":return H$e()?mt(!0):Xu(Cd.pipe(ve(()=>"tap screen")),ko.pipe(ve(()=>"tap controls")),nt.pipe(ve(()=>"hover"))).pipe(IKe((Se,Ve)=>{switch(Ve){case"tap screen":return Se?mt(!1):jf(I5).pipe(ve(()=>!1),xn(!0));case"tap controls":return jf(I5).pipe(ve(()=>!1),xn(!0));case"hover":return vKe(jf(I5),Dt.pipe(v9(1))).pipe(ve(()=>!1),xn(!0))}},!1),xn(!1))}}))),Mt=t.behavior(ot([r.audioOutput.available$,r.audioOutput.selected$],(ne,Se)=>Se!==void 0&&ne.get(Se.id)?.type==="earpiece")),Un=t.behavior(ot([r.audioOutput.available$,r.audioOutput.selected$],(ne,Se)=>{const ht=(Se&&ne.get(Se.id)?.type)==="speaker"?"earpiece":"speaker",_t=[...ne].find(([,Dr])=>Dr.type===ht);if(_t===void 0)return null;const[Wr]=_t;return{targetOutput:ht,switch:()=>r.audioOutput.select(Wr)}})),jn=t.behavior(Hle.value$.pipe(gt(ne=>ne?G:mt({})),Ru((ne,Se)=>{const Ve=[];for(const[ht,_t]of Object.entries(Se)){const Wr=ne.find(Dr=>Dr.sender===ht&&Dr.emoji)?.startX??Math.ceil(Math.random()*80)+10;Ve.push({sender:ht,emoji:_t.emoji,startX:Wr})}return Ve},[]))),ws=b9.value$.pipe(gt(ne=>ne?G:mt({})),ve(ne=>Object.values(ne).map(Se=>Se.name)),Ru((ne,Se)=>({playing:Se.filter(Ve=>ne.playing.includes(Ve)||ne.newSounds.includes(Ve)),newSounds:Se.filter(Ve=>!ne.playing.includes(Ve)&&!ne.newSounds.includes(Ve))}),{playing:[],newSounds:[]}),ve(ne=>ne.newSounds)),zr=V.pipe(ve(ne=>Object.keys(ne).length),Ru((ne,Se)=>({value:Se,playSounds:Se>ne.value}),{value:0,playSounds:!1}),ri(ne=>ne.playSounds)),Es=J.pipe(ve(ne=>ne.length),Ru((ne,Se)=>({value:Se,playSounds:Se>ne.value}),{value:0,playSounds:!1}),ri(ne=>ne.playSounds)),Ci=T.sharingScreen$,os=T.toggleScreenSharing,ac=t.behavior(T.localMemberState$.pipe(ve(ne=>{const Se={};return ne instanceof ji?{transportError:ne}:ne===dpe.Waiting?null:(ne.matrix instanceof ji&&(Se.matrixError=ne.matrix),ne.media instanceof ji?Se.publishError=ne.media:typeof ne.media=="object"&&ne.media.connection instanceof ji&&(Se.connectionError=ne.media.connection),Se)})),null);return{autoLeave$:D,callPickupState$:P,ringOverlay$:W,leave$:ke,hangup:()=>we.next(),join:T.requestJoinAndPublish,leave:T.requestDisconnect,toggleScreenSharing:os,sharingScreen$:Ci,tapScreen:()=>Cd.next(),tapControls:()=>ko.next(),hoverScreen:()=>nt.next(),unhoverScreen:()=>Dt.next(),fatalError$:t.behavior(ac.pipe(ve(ne=>(ap.debug("errors$ to compute any fatal errors:",ne),ne?.transportError??ne?.matrixError??ne?.connectionError??null)),ri(ne=>ne!==null)),null),allConnections$:F,participantCount$:ge,handsRaised$:V,reactions$:G,joinSoundEffect$:ue,leaveSoundEffect$:Re,newHandRaised$:zr,newScreenShare$:Es,audibleReactions$:ws,visibleReactions$:jn,windowMode$:wi,spotlightExpanded$:sc,toggleSpotlightExpanded$:li,gridMode$:Ss,setGridMode:_s,grid$:Je,spotlight$:vt,pip$:Sr,layout$:qs,userMedia$:Z,localMatrixLivekitMember$:O,matrixLivekitMembers$:t.behavior(C.pipe(ve(ne=>ne.value),Tp(ne=>{const Se=ne.map(Ve=>Ve.membership$.value.userId+"|"+Ve.membership$.value.deviceId).join(",");ap.debug(`matrixLivekitMembers$ updated (exported) [${Se}]`)}))),tileStoreGeneration$:Ei,showSpotlightIndicators$:Gr,showSpeakingIndicators$:Vs,showHeader$:Be,showFooter$:rt,earpieceMode$:Mt,audioOutputSwitcher$:Un,reconnecting$:T.reconnecting$,livekitRoomItems$:$,connected$:T.connected$}}function Ytt(t,e){if(t.kind!==qn.NONE){if(t.kind===qn.PER_PARTICIPANT){const n=new ott;return n.setRTCSession(e),n}else if(t.kind===qn.SHARED_KEY&&t.secret){const n=new JSe;return n.setKey(t.secret).catch(r=>ap.error("Failed to set shared key for E2EE",r)),n}}}function Xtt(t,e,n){return Math.max(e,Math.min(t,n))}const Fi={toVector(t,e){return t===void 0&&(t=e),Array.isArray(t)?t:[t,t]},add(t,e){return[t[0]+e[0],t[1]+e[1]]},sub(t,e){return[t[0]-e[0],t[1]-e[1]]},addTo(t,e){t[0]+=e[0],t[1]+=e[1]},subTo(t,e){t[0]-=e[0],t[1]-=e[1]}};function KY(t,e,n){return e===0||Math.abs(e)===1/0?Math.pow(t,n*5):t*e*n/(e+n*t)}function GY(t,e,n,r=.15){return r===0?Xtt(t,e,n):t<e?-KY(e-t,n-e,r)+e:t>n?+KY(t-n,n-e,r)+n:t}function Jtt(t,[e,n],[r,i]){const[[s,o],[a,c]]=t;return[GY(e,s,o,r),GY(n,a,c,i)]}function Qtt(t,e){if(typeof t!="object"||t===null)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Ztt(t){var e=Qtt(t,"string");return typeof e=="symbol"?e:String(e)}function Is(t,e,n){return e=Ztt(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function zY(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function gr(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?zY(Object(n),!0).forEach(function(r){Is(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):zY(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}const ppe={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function WY(t){return t?t[0].toUpperCase()+t.slice(1):""}const ent=["enter","leave"];function tnt(t=!1,e){return t&&!ent.includes(e)}function nnt(t,e="",n=!1){const r=ppe[t],i=r&&r[e]||e;return"on"+WY(t)+WY(i)+(tnt(n,i)?"Capture":"")}const rnt=["gotpointercapture","lostpointercapture"];function int(t){let e=t.substring(2).toLowerCase();const n=!!~e.indexOf("passive");n&&(e=e.replace("passive",""));const r=rnt.includes(e)?"capturecapture":"capture",i=!!~e.indexOf(r);return i&&(e=e.replace("capture","")),{device:e,capture:i,passive:n}}function snt(t,e=""){const n=ppe[t],r=n&&n[e]||e;return t+r}function x4(t){return"touches"in t}function mpe(t){return x4(t)?"touch":"pointerType"in t?t.pointerType:"mouse"}function ont(t){return Array.from(t.touches).filter(e=>{var n,r;return e.target===t.currentTarget||((n=t.currentTarget)===null||n===void 0||(r=n.contains)===null||r===void 0?void 0:r.call(n,e.target))})}function ant(t){return t.type==="touchend"||t.type==="touchcancel"?t.changedTouches:t.targetTouches}function gpe(t){return x4(t)?ant(t)[0]:t}function cnt(t){return ont(t).map(e=>e.identifier)}function x5(t){const e=gpe(t);return x4(t)?e.identifier:e.pointerId}function YY(t){const e=gpe(t);return[e.clientX,e.clientY]}function lnt(t){var e,n;const{scrollX:r,scrollY:i,scrollLeft:s,scrollTop:o}=t.currentTarget;return[(e=r??s)!==null&&e!==void 0?e:0,(n=i??o)!==null&&n!==void 0?n:0]}function unt(t){const e={};if("buttons"in t&&(e.buttons=t.buttons),"shiftKey"in t){const{shiftKey:n,altKey:r,metaKey:i,ctrlKey:s}=t;Object.assign(e,{shiftKey:n,altKey:r,metaKey:i,ctrlKey:s})}return e}function dT(t,...e){return typeof t=="function"?t(...e):t}function dnt(){}function fnt(...t){return t.length===0?dnt:t.length===1?t[0]:function(){let e;for(const n of t)e=n.apply(this,arguments)||e;return e}}function XY(t,e){return Object.assign({},e,t||{})}const hnt=32;class pnt{constructor(e,n,r){this.ctrl=e,this.args=n,this.key=r,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(e){this.ctrl.state[this.key]=e}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:e,shared:n,ingKey:r,args:i}=this;n[r]=e._active=e.active=e._blocked=e._force=!1,e._step=[!1,!1],e.intentional=!1,e._movement=[0,0],e._distance=[0,0],e._direction=[0,0],e._delta=[0,0],e._bounds=[[-1/0,1/0],[-1/0,1/0]],e.args=i,e.axis=void 0,e.memo=void 0,e.elapsedTime=e.timeDelta=0,e.direction=[0,0],e.distance=[0,0],e.overflow=[0,0],e._movementBound=[!1,!1],e.velocity=[0,0],e.movement=[0,0],e.delta=[0,0],e.timeStamp=0}start(e){const n=this.state,r=this.config;n._active||(this.reset(),this.computeInitial(),n._active=!0,n.target=e.target,n.currentTarget=e.currentTarget,n.lastOffset=r.from?dT(r.from,n):n.offset,n.offset=n.lastOffset,n.startTime=n.timeStamp=e.timeStamp)}computeValues(e){const n=this.state;n._values=e,n.values=this.config.transform(e)}computeInitial(){const e=this.state;e._initial=e._values,e.initial=e.values}compute(e){const{state:n,config:r,shared:i}=this;n.args=this.args;let s=0;if(e&&(n.event=e,r.preventDefault&&e.cancelable&&n.event.preventDefault(),n.type=e.type,i.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,i.locked=!!document.pointerLockElement,Object.assign(i,unt(e)),i.down=i.pressed=i.buttons%2===1||i.touches>0,s=e.timeStamp-n.timeStamp,n.timeStamp=e.timeStamp,n.elapsedTime=n.timeStamp-n.startTime),n._active){const T=n._delta.map(Math.abs);Fi.addTo(n._distance,T)}this.axisIntent&&this.axisIntent(e);const[o,a]=n._movement,[c,l]=r.threshold,{_step:d,values:h}=n;if(r.hasCustomTransform?(d[0]===!1&&(d[0]=Math.abs(o)>=c&&h[0]),d[1]===!1&&(d[1]=Math.abs(a)>=l&&h[1])):(d[0]===!1&&(d[0]=Math.abs(o)>=c&&Math.sign(o)*c),d[1]===!1&&(d[1]=Math.abs(a)>=l&&Math.sign(a)*l)),n.intentional=d[0]!==!1||d[1]!==!1,!n.intentional)return;const m=[0,0];if(r.hasCustomTransform){const[T,L]=h;m[0]=d[0]!==!1?T-d[0]:0,m[1]=d[1]!==!1?L-d[1]:0}else m[0]=d[0]!==!1?o-d[0]:0,m[1]=d[1]!==!1?a-d[1]:0;this.restrictToAxis&&!n._blocked&&this.restrictToAxis(m);const g=n.offset,y=n._active&&!n._blocked||n.active;y&&(n.first=n._active&&!n.active,n.last=!n._active&&n.active,n.active=i[this.ingKey]=n._active,e&&(n.first&&("bounds"in r&&(n._bounds=dT(r.bounds,n)),this.setup&&this.setup()),n.movement=m,this.computeOffset()));const[v,E]=n.offset,[[w,R],[x,C]]=n._bounds;n.overflow=[v<w?-1:v>R?1:0,E<x?-1:E>C?1:0],n._movementBound[0]=n.overflow[0]?n._movementBound[0]===!1?n._movement[0]:n._movementBound[0]:!1,n._movementBound[1]=n.overflow[1]?n._movementBound[1]===!1?n._movement[1]:n._movementBound[1]:!1;const k=n._active?r.rubberband||[0,0]:[0,0];if(n.offset=Jtt(n._bounds,n.offset,k),n.delta=Fi.sub(n.offset,g),this.computeMovement(),y&&(!n.last||s>hnt)){n.delta=Fi.sub(n.offset,g);const T=n.delta.map(Math.abs);Fi.addTo(n.distance,T),n.direction=n.delta.map(Math.sign),n._direction=n._delta.map(Math.sign),!n.first&&s>0&&(n.velocity=[T[0]/s,T[1]/s],n.timeDelta=s)}}emit(){const e=this.state,n=this.shared,r=this.config;if(e._active||this.clean(),(e._blocked||!e.intentional)&&!e._force&&!r.triggerAllEvents)return;const i=this.handler(gr(gr(gr({},n),e),{},{[this.aliasKey]:e.values}));i!==void 0&&(e.memo=i)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}function mnt([t,e],n){const r=Math.abs(t),i=Math.abs(e);if(r>i&&r>n)return"x";if(i>r&&i>n)return"y"}class vpe extends pnt{constructor(...e){super(...e),Is(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=Fi.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=Fi.sub(this.state.offset,this.state.lastOffset)}axisIntent(e){const n=this.state,r=this.config;if(!n.axis&&e){const i=typeof r.axisThreshold=="object"?r.axisThreshold[mpe(e)]:r.axisThreshold;n.axis=mnt(n._movement,i)}n._blocked=(r.lockDirection||!!r.axis)&&!n.axis||!!r.axis&&r.axis!==n.axis}restrictToAxis(e){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":e[1]=0;break;case"y":e[0]=0;break}}}const gnt=t=>t,JY=.15,ype={enabled(t=!0){return t},eventOptions(t,e,n){return gr(gr({},n.shared.eventOptions),t)},preventDefault(t=!1){return t},triggerAllEvents(t=!1){return t},rubberband(t=0){switch(t){case!0:return[JY,JY];case!1:return[0,0];default:return Fi.toVector(t)}},from(t){if(typeof t=="function")return t;if(t!=null)return Fi.toVector(t)},transform(t,e,n){const r=t||n.shared.transform;return this.hasCustomTransform=!!r,r||gnt},threshold(t){return Fi.toVector(t,0)}},vnt=0,qy=gr(gr({},ype),{},{axis(t,e,{axis:n}){if(this.lockDirection=n==="lock",!this.lockDirection)return n},axisThreshold(t=vnt){return t},bounds(t={}){if(typeof t=="function")return s=>qy.bounds(t(s));if("current"in t)return()=>t.current;if(typeof HTMLElement=="function"&&t instanceof HTMLElement)return t;const{left:e=-1/0,right:n=1/0,top:r=-1/0,bottom:i=1/0}=t;return[[e,n],[r,i]]}}),QY={ArrowRight:(t,e=1)=>[t*e,0],ArrowLeft:(t,e=1)=>[-1*t*e,0],ArrowUp:(t,e=1)=>[0,-1*t*e],ArrowDown:(t,e=1)=>[0,t*e]};class ynt extends vpe{constructor(...e){super(...e),Is(this,"ingKey","dragging")}reset(){super.reset();const e=this.state;e._pointerId=void 0,e._pointerActive=!1,e._keyboardActive=!1,e._preventScroll=!1,e._delayed=!1,e.swipe=[0,0],e.tap=!1,e.canceled=!1,e.cancel=this.cancel.bind(this)}setup(){const e=this.state;if(e._bounds instanceof HTMLElement){const n=e._bounds.getBoundingClientRect(),r=e.currentTarget.getBoundingClientRect(),i={left:n.left-r.left+e.offset[0],right:n.right-r.right+e.offset[0],top:n.top-r.top+e.offset[1],bottom:n.bottom-r.bottom+e.offset[1]};e._bounds=qy.bounds(i)}}cancel(){const e=this.state;e.canceled||(e.canceled=!0,e._active=!1,setTimeout(()=>{this.compute(),this.emit()},0))}setActive(){this.state._active=this.state._pointerActive||this.state._keyboardActive}clean(){this.pointerClean(),this.state._pointerActive=!1,this.state._keyboardActive=!1,super.clean()}pointerDown(e){const n=this.config,r=this.state;if(e.buttons!=null&&(Array.isArray(n.pointerButtons)?!n.pointerButtons.includes(e.buttons):n.pointerButtons!==-1&&n.pointerButtons!==e.buttons))return;const i=this.ctrl.setEventIds(e);n.pointerCapture&&e.target.setPointerCapture(e.pointerId),!(i&&i.size>1&&r._pointerActive)&&(this.start(e),this.setupPointer(e),r._pointerId=x5(e),r._pointerActive=!0,this.computeValues(YY(e)),this.computeInitial(),n.preventScrollAxis&&mpe(e)!=="mouse"?(r._active=!1,this.setupScrollPrevention(e)):n.delay>0?(this.setupDelayTrigger(e),n.triggerAllEvents&&(this.compute(e),this.emit())):this.startPointerDrag(e))}startPointerDrag(e){const n=this.state;n._active=!0,n._preventScroll=!0,n._delayed=!1,this.compute(e),this.emit()}pointerMove(e){const n=this.state,r=this.config;if(!n._pointerActive)return;const i=x5(e);if(n._pointerId!==void 0&&i!==n._pointerId)return;const s=YY(e);if(document.pointerLockElement===e.target?n._delta=[e.movementX,e.movementY]:(n._delta=Fi.sub(s,n._values),this.computeValues(s)),Fi.addTo(n._movement,n._delta),this.compute(e),n._delayed&&n.intentional){this.timeoutStore.remove("dragDelay"),n.active=!1,this.startPointerDrag(e);return}if(r.preventScrollAxis&&!n._preventScroll)if(n.axis)if(n.axis===r.preventScrollAxis||r.preventScrollAxis==="xy"){n._active=!1,this.clean();return}else{this.timeoutStore.remove("startPointerDrag"),this.startPointerDrag(e);return}else return;this.emit()}pointerUp(e){this.ctrl.setEventIds(e);try{this.config.pointerCapture&&e.target.hasPointerCapture(e.pointerId)&&e.target.releasePointerCapture(e.pointerId)}catch{}const n=this.state,r=this.config;if(!n._active||!n._pointerActive)return;const i=x5(e);if(n._pointerId!==void 0&&i!==n._pointerId)return;this.state._pointerActive=!1,this.setActive(),this.compute(e);const[s,o]=n._distance;if(n.tap=s<=r.tapsThreshold&&o<=r.tapsThreshold,n.tap&&r.filterTaps)n._force=!0;else{const[a,c]=n._delta,[l,d]=n._movement,[h,m]=r.swipe.velocity,[g,y]=r.swipe.distance,v=r.swipe.duration;if(n.elapsedTime<v){const E=Math.abs(a/n.timeDelta),w=Math.abs(c/n.timeDelta);E>h&&Math.abs(l)>g&&(n.swipe[0]=Math.sign(a)),w>m&&Math.abs(d)>y&&(n.swipe[1]=Math.sign(c))}}this.emit()}pointerClick(e){!this.state.tap&&e.detail>0&&(e.preventDefault(),e.stopPropagation())}setupPointer(e){const n=this.config,r=n.device;n.pointerLock&&e.currentTarget.requestPointerLock(),n.pointerCapture||(this.eventStore.add(this.sharedConfig.window,r,"change",this.pointerMove.bind(this)),this.eventStore.add(this.sharedConfig.window,r,"end",this.pointerUp.bind(this)),this.eventStore.add(this.sharedConfig.window,r,"cancel",this.pointerUp.bind(this)))}pointerClean(){this.config.pointerLock&&document.pointerLockElement===this.state.currentTarget&&document.exitPointerLock()}preventScroll(e){this.state._preventScroll&&e.cancelable&&e.preventDefault()}setupScrollPrevention(e){this.state._preventScroll=!1,bnt(e);const n=this.eventStore.add(this.sharedConfig.window,"touch","change",this.preventScroll.bind(this),{passive:!1});this.eventStore.add(this.sharedConfig.window,"touch","end",n),this.eventStore.add(this.sharedConfig.window,"touch","cancel",n),this.timeoutStore.add("startPointerDrag",this.startPointerDrag.bind(this),this.config.preventScrollDelay,e)}setupDelayTrigger(e){this.state._delayed=!0,this.timeoutStore.add("dragDelay",()=>{this.state._step=[0,0],this.startPointerDrag(e)},this.config.delay)}keyDown(e){const n=QY[e.key];if(n){const r=this.state,i=e.shiftKey?10:e.altKey?.1:1;this.start(e),r._delta=n(this.config.keyboardDisplacement,i),r._keyboardActive=!0,Fi.addTo(r._movement,r._delta),this.compute(e),this.emit()}}keyUp(e){e.key in QY&&(this.state._keyboardActive=!1,this.setActive(),this.compute(e),this.emit())}bind(e){const n=this.config.device;e(n,"start",this.pointerDown.bind(this)),this.config.pointerCapture&&(e(n,"change",this.pointerMove.bind(this)),e(n,"end",this.pointerUp.bind(this)),e(n,"cancel",this.pointerUp.bind(this)),e("lostPointerCapture","",this.pointerUp.bind(this))),this.config.keys&&(e("key","down",this.keyDown.bind(this)),e("key","up",this.keyUp.bind(this))),this.config.filterTaps&&e("click","",this.pointerClick.bind(this),{capture:!0,passive:!1})}}function bnt(t){"persist"in t&&typeof t.persist=="function"&&t.persist()}const AS=typeof window<"u"&&window.document&&window.document.createElement;function bpe(){return AS&&"ontouchstart"in window}function _nt(){return bpe()||AS&&window.navigator.maxTouchPoints>1}function Snt(){return AS&&"onpointerdown"in window}function wnt(){return AS&&"exitPointerLock"in window.document}function Ent(){try{return"constructor"in GestureEvent}catch{return!1}}const Pa={isBrowser:AS,gesture:Ent(),touch:bpe(),touchscreen:_nt(),pointer:Snt(),pointerLock:wnt()},Cnt=250,Tnt=180,Rnt=.5,knt=50,Int=250,xnt=10,ZY={mouse:0,touch:0,pen:8},Ant=gr(gr({},qy),{},{device(t,e,{pointer:{touch:n=!1,lock:r=!1,mouse:i=!1}={}}){return this.pointerLock=r&&Pa.pointerLock,Pa.touch&&n?"touch":this.pointerLock?"mouse":Pa.pointer&&!i?"pointer":Pa.touch?"touch":"mouse"},preventScrollAxis(t,e,{preventScroll:n}){if(this.preventScrollDelay=typeof n=="number"?n:n||n===void 0&&t?Cnt:void 0,!(!Pa.touchscreen||n===!1))return t||(n!==void 0?"y":void 0)},pointerCapture(t,e,{pointer:{capture:n=!0,buttons:r=1,keys:i=!0}={}}){return this.pointerButtons=r,this.keys=i,!this.pointerLock&&this.device==="pointer"&&n},threshold(t,e,{filterTaps:n=!1,tapsThreshold:r=3,axis:i=void 0}){const s=Fi.toVector(t,n?r:i?1:0);return this.filterTaps=n,this.tapsThreshold=r,s},swipe({velocity:t=Rnt,distance:e=knt,duration:n=Int}={}){return{velocity:this.transform(Fi.toVector(t)),distance:this.transform(Fi.toVector(e)),duration:n}},delay(t=0){switch(t){case!0:return Tnt;case!1:return 0;default:return t}},axisThreshold(t){return t?gr(gr({},ZY),t):ZY},keyboardDisplacement(t=xnt){return t}});gr(gr({},ype),{},{device(t,e,{shared:n,pointer:{touch:r=!1}={}}){if(n.target&&!Pa.touch&&Pa.gesture)return"gesture";if(Pa.touch&&r)return"touch";if(Pa.touchscreen){if(Pa.pointer)return"pointer";if(Pa.touch)return"touch"}},bounds(t,e,{scaleBounds:n={},angleBounds:r={}}){const i=o=>{const a=XY(dT(n,o),{min:-1/0,max:1/0});return[a.min,a.max]},s=o=>{const a=XY(dT(r,o),{min:-1/0,max:1/0});return[a.min,a.max]};return typeof n!="function"&&typeof r!="function"?[i(),s()]:o=>[i(o),s(o)]},threshold(t,e,n){return this.lockDirection=n.axis==="lock",Fi.toVector(t,this.lockDirection?[.1,3]:0)},modifierKey(t){return t===void 0?"ctrlKey":t},pinchOnWheel(t=!0){return t}});gr(gr({},qy),{},{mouseOnly:(t=!0)=>t});class Lnt extends vpe{constructor(...e){super(...e),Is(this,"ingKey","scrolling")}scroll(e){this.state._active||this.start(e),this.scrollChange(e),this.timeoutStore.add("scrollEnd",this.scrollEnd.bind(this))}scrollChange(e){e.cancelable&&e.preventDefault();const n=this.state,r=lnt(e);n._delta=Fi.sub(r,n._values),Fi.addTo(n._movement,n._delta),this.computeValues(r),this.compute(e),this.emit()}scrollEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("scroll","",this.scroll.bind(this))}}const Mnt=qy;gr(gr({},qy),{},{mouseOnly:(t=!0)=>t});const _pe=new Map,$O=new Map;function Spe(t){_pe.set(t.key,t.engine),$O.set(t.key,t.resolver)}const Ont={key:"drag",engine:ynt,resolver:Ant},Pnt={key:"scroll",engine:Lnt,resolver:Mnt};function Dnt(t,e){if(t==null)return{};var n={},r=Object.keys(t),i,s;for(s=0;s<r.length;s++)i=r[s],!(e.indexOf(i)>=0)&&(n[i]=t[i]);return n}function Nnt(t,e){if(t==null)return{};var n=Dnt(t,e),r,i;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(i=0;i<s.length;i++)r=s[i],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}const Unt={target(t){if(t)return()=>"current"in t?t.current:t},enabled(t=!0){return t},window(t=Pa.isBrowser?window:void 0){return t},eventOptions({passive:t=!0,capture:e=!1}={}){return{passive:t,capture:e}},transform(t){return t}},jnt=["target","eventOptions","window","enabled","transform"];function vC(t={},e){const n={};for(const[r,i]of Object.entries(e))switch(typeof i){case"function":n[r]=i.call(n,t[r],r,t);break;case"object":n[r]=vC(t[r],i);break;case"boolean":i&&(n[r]=t[r]);break}return n}function Fnt(t,e,n={}){const r=t,{target:i,eventOptions:s,window:o,enabled:a,transform:c}=r,l=Nnt(r,jnt);if(n.shared=vC({target:i,eventOptions:s,window:o,enabled:a,transform:c},Unt),e){const d=$O.get(e);n[e]=vC(gr({shared:n.shared},l),d)}else for(const d in l){const h=$O.get(d);h&&(n[d]=vC(gr({shared:n.shared},l[d]),h))}return n}class wpe{constructor(e,n){Is(this,"_listeners",new Set),this._ctrl=e,this._gestureKey=n}add(e,n,r,i,s){const o=this._listeners,a=snt(n,r),c=this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{},l=gr(gr({},c),s);e.addEventListener(a,i,l);const d=()=>{e.removeEventListener(a,i,l),o.delete(d)};return o.add(d),d}clean(){this._listeners.forEach(e=>e()),this._listeners.clear()}}class $nt{constructor(){Is(this,"_timeouts",new Map)}add(e,n,r=140,...i){this.remove(e),this._timeouts.set(e,window.setTimeout(n,r,...i))}remove(e){const n=this._timeouts.get(e);n&&window.clearTimeout(n)}clean(){this._timeouts.forEach(e=>{window.clearTimeout(e)}),this._timeouts.clear()}}class Bnt{constructor(e){Is(this,"gestures",new Set),Is(this,"_targetEventStore",new wpe(this)),Is(this,"gestureEventStores",{}),Is(this,"gestureTimeoutStores",{}),Is(this,"handlers",{}),Is(this,"config",{}),Is(this,"pointerIds",new Set),Is(this,"touchIds",new Set),Is(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),Hnt(this,e)}setEventIds(e){if(x4(e))return this.touchIds=new Set(cnt(e)),this.touchIds;if("pointerId"in e)return e.type==="pointerup"||e.type==="pointercancel"?this.pointerIds.delete(e.pointerId):e.type==="pointerdown"&&this.pointerIds.add(e.pointerId),this.pointerIds}applyHandlers(e,n){this.handlers=e,this.nativeHandlers=n}applyConfig(e,n){this.config=Fnt(e,n,this.config)}clean(){this._targetEventStore.clean();for(const e of this.gestures)this.gestureEventStores[e].clean(),this.gestureTimeoutStores[e].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...e){const n=this.config.shared,r={};let i;if(!(n.target&&(i=n.target(),!i))){if(n.enabled){for(const o of this.gestures){const a=this.config[o],c=eX(r,a.eventOptions,!!i);if(a.enabled){const l=_pe.get(o);new l(this,e,o).bind(c)}}const s=eX(r,n.eventOptions,!!i);for(const o in this.nativeHandlers)s(o,"",a=>this.nativeHandlers[o](gr(gr({},this.state.shared),{},{event:a,args:e})),void 0,!0)}for(const s in r)r[s]=fnt(...r[s]);if(!i)return r;for(const s in r){const{device:o,capture:a,passive:c}=int(s);this._targetEventStore.add(i,o,"",r[s],{capture:a,passive:c})}}}}function Tg(t,e){t.gestures.add(e),t.gestureEventStores[e]=new wpe(t,e),t.gestureTimeoutStores[e]=new $nt}function Hnt(t,e){e.drag&&Tg(t,"drag"),e.wheel&&Tg(t,"wheel"),e.scroll&&Tg(t,"scroll"),e.move&&Tg(t,"move"),e.pinch&&Tg(t,"pinch"),e.hover&&Tg(t,"hover")}const eX=(t,e,n)=>(r,i,s,o={},a=!1)=>{var c,l;const d=(c=o.capture)!==null&&c!==void 0?c:e.capture,h=(l=o.passive)!==null&&l!==void 0?l:e.passive;let m=a?r:nnt(r,i,d);n&&h&&(m+="Passive"),t[m]=t[m]||[],t[m].push(s)};function Epe(t,e={},n,r){const i=xe.useMemo(()=>new Bnt(t),[]);if(i.applyHandlers(t,r),i.applyConfig(e,n),xe.useEffect(i.effect.bind(i)),xe.useEffect(()=>i.clean.bind(i),[]),e.target===void 0)return i.bind.bind(i)}function qnt(t,e){return Spe(Ont),Epe({drag:t},e||{},"drag")}function Vnt(t,e){return Spe(Pnt),Epe({scroll:t},e||{},"scroll")}const Knt="_grid_19qx5_8",Gnt="_slot_19qx5_12",A5={grid:Knt,slot:Gnt},znt="_tile_lwkx2_8",Wnt="_draggable_lwkx2_8",tX={tile:znt,draggable:Wnt},Cpe=_.memo(({id:t,onDrag:e,targetWidth:n,targetHeight:r,model:i,Tile:s,opacity:o,scale:a,zIndex:c,x:l,y:d,width:h,height:m})=>{const g=_.useRef(null);return qnt(y=>e?.current(t,y),{target:g,filterTaps:!0}),S.jsx(s,{ref:g,className:Le(tX.tile,{[tX.draggable]:e}),style:{opacity:o,scale:a,zIndex:c,x:l,y:d,width:h,height:m},targetWidth:n,targetHeight:r,model:i})});Cpe.displayName="TileWrapper";const Ynt=Cpe,Xnt=()=>wR("(prefers-reduced-motion)");function Tpe(t,e){if(!(t.offsetParent instanceof HTMLElement)||t.offsetParent===e)return{x:t.offsetLeft,y:t.offsetTop};{const n=Tpe(t.offsetParent,e);return n.x+=t.offsetLeft,n.y+=t.offsetTop,n}}const Rpe=_.createContext(null);function kpe(){const t=_.use(Rpe);if(t===null)throw new Error("useUpdateLayout called outside a Grid layout context");return t}function Pl(){const{setGeneration:t}=kpe();_.useEffect(()=>t(e=>e===null?0:e+1))}function aN(t){const{setVisibleTilesCallback:e}=kpe();_.useEffect(()=>e(()=>t),[t,e]),_.useEffect(()=>()=>e(null),[e])}function nX({model:t,Layout:e,Tile:n,className:r,style:i}){const[s,o]=vb(),[a,c]=_.useState(null),l=xS(s,c),d=_.useSyncExternalStore(_.useCallback(W=>(window.addEventListener("resize",W),()=>window.removeEventListener("resize",W)),[]),_.useCallback(()=>window.innerHeight,[])),[h,m]=_.useState(null),[g,y]=_.useState(null),[v,E]=_.useState(null),w=Bf(()=>new Map),R=Xnt(),x=_.useMemo(()=>function({id:F,model:$,onDrag:V,style:G,className:Z,...q}){const J=_.useRef(null);return _.useEffect(()=>(w.set(F,{id:F,model:$,onDrag:V}),()=>{w.delete(F)}),[F,$,V]),S.jsx("div",{ref:J,className:Le(Z,A5.slot),"data-id":F,style:G,...q})},[w]),C=_.useMemo(()=>_.memo(function({ref:F,Layout:$,...V}){return S.jsx($,{...V,ref:F})}),[]),k=_.useMemo(()=>({setGeneration:y,setVisibleTilesCallback:E}),[E]),T=_.useMemo(()=>{const W=[];if(a!==null&&h!==null){const F=h.getElementsByClassName(A5.slot);for(const $ of F){const V=$.getAttribute("data-id");$.offsetWidth>0&&$.offsetHeight>0&&W.push({...w.get(V),...Tpe($,a),width:$.offsetWidth,height:$.offsetHeight})}}return W},[a,h,w,o,g]),L=_.useMemo(()=>Math.min(o.bottom,d)-o.top,[o,d]);_.useEffect(()=>{v?.(T.filter(W=>W.y+W.height<=L).length)},[T,v,L]);const O=_.useRef(null),[P,D]=cet(T,()=>({key:({id:W})=>W,from:({x:W,y:F,width:$,height:V})=>({opacity:0,scale:0,zIndex:1,x:W,y:F,width:$,height:V,immediate:R}),enter:{opacity:1,scale:1,immediate:R},update:({id:W,x:F,y:$,width:V,height:G})=>W===O.current?.tileId?null:{x:F,y:$,width:V,height:G,immediate:R},leave:{opacity:0,scale:0,immediate:R},config:{mass:.7,tension:252,friction:25}}));_.useEffect(()=>{D.start().forEach(W=>{W.catch(N.error)})},[T,D]);const j=(W,F)=>{const{tileId:$,tileX:V,tileY:G}=O.current,Z=T.find(q=>q.id===$);D.current.find(q=>q.item.id===$)?.start(W?{scale:1,zIndex:1,x:Z.x,y:Z.y,width:Z.width,height:Z.height,immediate:R||(q=>q==="zIndex"),delay:q=>q==="zIndex"?500:0}:{scale:1.1,zIndex:2,x:V,y:G,immediate:R||(q=>q==="zIndex"||q==="x"||q==="y")}).catch(N.error),W&&F({x:V,y:G,xRatio:V/(o.width-Z.width),yRatio:G/(o.height-Z.height)})},H=(W,{tap:F,initial:[$,V],delta:[G,Z],last:q})=>{if(!F){const J=D.current.find(ge=>ge.item.id===W),ue=w.get(J.item.id).onDrag;if(ue!=null){if(O.current===null){const ge=J.get();O.current={tileId:W,tileX:ge.x,tileY:ge.y,cursorX:$-o.x,cursorY:V-o.y+Y.current}}O.current.tileX+=G,O.current.tileY+=Z,O.current.cursorX+=G,O.current.cursorY+=Z,j(q,ue),q&&(O.current=null)}}},z=_.useRef(H);z.current=H;const Y=_.useRef(0);return Vnt(({xy:[,W],delta:[,F]})=>{Y.current=W,O.current!==null&&(O.current.tileY+=F,O.current.cursorY+=F,j(!1,w.get(O.current.tileId).onDrag))},{target:a??void 0}),S.jsxs("div",{ref:l,className:Le(r,A5.grid),style:i,children:[S.jsx(Rpe,{value:k,children:S.jsx(C,{ref:m,Layout:e,model:t,Slot:x})}),P((W,{id:F,model:$,onDrag:V,width:G,height:Z})=>S.jsx(Ynt,{id:F,onDrag:V?z:null,targetWidth:G,targetHeight:Z,model:$,Tile:n,...W},F))]})}const Jnt=(t,e)=>_.createElement("svg",{width:24,height:24,fill:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",ref:e,...t},_.createElement("path",{d:"M4 14C4.55228 14 5 14.4477 5 15V19H9C9.55228 19 10 19.4477 10 20C10 20.5523 9.55228 21 9 21H3V15C3 14.4477 3.44772 14 4 14Z"}),_.createElement("path",{d:"M20 14C20.5523 14 21 14.4477 21 15V21H15C14.4477 21 14 20.5523 14 20C14 19.4477 14.4477 19 15 19H19V15C19 14.4477 19.4477 14 20 14Z"}),_.createElement("path",{d:"M9 3C9.55228 3 10 3.44772 10 4C10 4.55228 9.55228 5 9 5H5V9C5 9.55228 4.55228 10 4 10C3.44772 10 3 9.55228 3 9V3H9Z"}),_.createElement("path",{d:"M21 9C21 9.55228 20.5523 10 20 10C19.4477 10 19 9.55228 19 9V5H15C14.4477 5 14 4.55228 14 4C14 3.44772 14.4477 3 15 3H21V9Z"})),Qnt=_.forwardRef(Jnt),Znt=(t,e)=>_.createElement("svg",{width:24,height:24,fill:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",ref:e,...t},_.createElement("path",{d:"M10 20C10 20.5523 9.55228 21 9 21C8.44772 21 8 20.5523 8 20V16H4C3.44772 16 3 15.5523 3 15C3 14.4477 3.44772 14 4 14H10V20Z"}),_.createElement("path",{d:"M20 14C20.5523 14 21 14.4477 21 15C21 15.5523 20.5523 16 20 16H16V20C16 20.5523 15.5523 21 15 21C14.4477 21 14 20.5523 14 20V14H20Z"}),_.createElement("path",{d:"M9 3C9.55228 3 10 3.44772 10 4V10H4C3.44772 10 3 9.55228 3 9C3 8.44772 3.44772 8 4 8H8V4C8 3.44772 8.44772 3 9 3Z"}),_.createElement("path",{d:"M15 3C15.5523 3 16 3.44772 16 4V8H20C20.5523 8 21 8.44772 21 9C21 9.55228 20.5523 10 20 10H14V4C14 3.44772 14.4477 3 15 3Z"})),ert=_.forwardRef(Znt),trt="_contents_18q5h_8",nrt="_tile_18q5h_25",rrt="_maximised_18q5h_25",irt="_item_18q5h_29",srt="_snap_18q5h_36",ort="_advance_18q5h_40",art="_back_18q5h_76",crt="_next_18q5h_80",lrt="_expand_18q5h_84",urt="_bottomRightButtons_18q5h_102",drt="_indicators_18q5h_136",frt="_show_18q5h_148",Rs={contents:trt,tile:nrt,maximised:rrt,item:irt,snap:srt,advance:ort,back:art,next:crt,expand:lrt,bottomRightButtons:urt,indicators:drt,show:frt},Ipe=(t,e)=>{const n=_.useRef(void 0);n.current===void 0&&(n.current=t());const r=_.useRef(void 0),[,i]=_.useState(0);return(r.current===void 0||e.length!==r.current.length||e.some((s,o)=>!Object.is(s,r.current[o])))&&(n.current=t(n.current)),r.current=e,[n.current,_.useCallback(s=>{typeof s=="function"?n.current=s(n.current):n.current=s,i(o=>o+1)},[i])]},xpe=({vm:t,...e})=>{const n=Fe(t.mirror$);return S.jsx(IS,{mirror:n,...e})};xpe.displayName="SpotlightLocalUserMediaItem";const hrt=({vm:t,...e})=>{const n=Fe(t.waitingForMedia$);return S.jsx(IS,{waitingForMedia:n,mirror:!1,...e})},Ape=({vm:t,...e})=>{const r={videoFit:Fe(t.cropVideo$)?"cover":"contain",...e};return t instanceof cy?S.jsx(xpe,{vm:t,...r}):S.jsx(hrt,{vm:t,...r})};Ape.displayName="SpotlightUserMediaItem";const Lpe=({ref:t,vm:e,targetWidth:n,targetHeight:r,focusable:i,intersectionObserver$:s,snap:o,"aria-hidden":a})=>{const c=_.useRef(null),l=xS(c,t),d=Fe(e.focusUrl$),h=Fe(e.displayName$),m=Fe(e.mxcAvatarUrl$),g=Fe(e.video$),y=Fe(e.videoEnabled$),v=Fe(e.unencryptedWarning$),E=Fe(e.encryptionStatus$);_.useEffect(()=>{const R=c.current;let x=null;const C=s.subscribe(k=>{x?.unobserve(R),k.observe(R),x=k});return()=>{C.unsubscribe(),x?.unobserve(R)}},[s]);const w={ref:l,"data-id":e.id,className:Le(Rs.item,{[Rs.snap]:o}),targetWidth:n,targetHeight:r,video:g??void 0,videoEnabled:y,userId:e.userId,unencryptedWarning:v,focusUrl:d,displayName:h,mxcAvatarUrl:m,focusable:i,encryptionStatus:E,"aria-hidden":a};return e instanceof zg?S.jsx(IS,{videoFit:"contain",mirror:!1,...w}):S.jsx(Ape,{vm:e,...w})};Lpe.displayName="SpotlightItem";const BO=({ref:t,vm:e,expanded:n,onToggleExpanded:r,targetWidth:i,targetHeight:s,showIndicators:o,focusable:a=!0,className:c,style:l})=>{const{t:d}=et(),[h,m]=$Ge(null),g=xS(h,t),y=Fe(e.maximised$),v=Fe(e.media$),[E,w]=_.useState(v[0]?.id),R=zp(v),x=zp(E),C=v.findIndex(F=>F.id===E),k=C>0,T=C!==-1&&C<v.length-1,L=_.useCallback(()=>!!(document.body&&document.fullscreenElement),[]),O=L()?ert:Qnt,P=_.useCallback(()=>{const F=document.body;F&&(L()?document?.exitFullscreen():F.requestFullscreen())},[L]),D=Bf(()=>m.pipe(ve(F=>new IntersectionObserver($=>{const V=$.find(G=>G.isIntersecting);V!==void 0&&w(V.target.getAttribute("data-id"))},{root:F,threshold:.5})))),[j,H]=Ipe(F=>F==null||F===E||v.every($=>$.id!==F)?null:F,[E]),z=_.useCallback(()=>{const F=R.current,$=F.findIndex(V=>V.id===x.current);$>0&&H(F[$-1].id)},[x,R,H]),Y=_.useCallback(()=>{const F=R.current,$=F.findIndex(V=>V.id===x.current);$!==-1&&$!==F.length-1&&H(F[$+1].id)},[x,R,H]),W=n?oae:fae;return S.jsxs(epe.div,{ref:g,className:Le(c,Rs.tile,{[Rs.maximised]:y}),style:l,children:[k&&S.jsx("button",{className:Le(Rs.advance,Rs.back),"aria-label":d("common.back"),onClick:z,tabIndex:a?void 0:-1,children:S.jsx(G9e,{"aria-hidden":!0,width:24,height:24})}),S.jsx("div",{className:Rs.contents,children:v.map(F=>S.jsx(Lpe,{vm:F,targetWidth:i,targetHeight:s,focusable:a,intersectionObserver$:D,snap:j===null||j===F.id,"aria-hidden":(j??E)!==F.id},F.id))}),S.jsxs("div",{className:Rs.bottomRightButtons,children:[S.jsx("button",{className:Le(Rs.expand),"aria-label":"maximise",onClick:P,tabIndex:a?void 0:-1,children:S.jsx(O,{"aria-hidden":!0,width:20,height:20})}),r&&S.jsx("button",{className:Le(Rs.expand),"aria-label":d(n?"video_tile.collapse":"video_tile.expand"),onClick:r,tabIndex:a?void 0:-1,children:S.jsx(W,{"aria-hidden":!0,width:20,height:20})})]}),T&&S.jsx("button",{className:Le(Rs.advance,Rs.next),"aria-label":d("common.next"),onClick:Y,tabIndex:a?void 0:-1,children:S.jsx(woe,{"aria-hidden":!0,width:24,height:24})}),!n&&S.jsx("div",{className:Le(Rs.indicators,{[Rs.show]:o&&v.length>1}),children:v.map(F=>S.jsx("div",{className:Rs.item,"data-visible":F.id===E},F.id))})]})};BO.displayName="SpotlightTile";const prt="_fixed_r39jt_8",mrt="_scrolling_r39jt_9",grt="_slot_r39jt_21",rE={fixed:prt,scrolling:mrt,slot:grt},vrt={inline:"end",block:"end"},yrt={inline:"end",block:"start"},rX=17/9,L5=4/3;function cN(t,e,n){const r=t<800?16:20,i=t*e,s=Math.pow(Math.sqrt(i)/8+125,2),o=Math.min(n,i/s);let a=Math.min(o,Math.round(Math.sqrt(t/e/L5*o))),c=o/a;o===n&&(c=Math.ceil(c),a=Math.ceil(n/c));let l=(t-(a+1)*r)/a,d=(e-(c-1)*r)/c;const h=l/d;return h>rX?l=d*rX:h<L5&&(d=l/L5),{tileWidth:l,tileHeight:d,gap:r,columns:a}}const brt=({minBounds$:t,spotlightAlignment$:e})=>({scrollingOnTop:!1,fixed:function({ref:r,model:i,Slot:s}){Pl();const o=vo(Bf(()=>e.pipe(fo((c,l)=>c.block===l.block&&c.inline===l.inline)))),a=_.useCallback(({xRatio:c,yRatio:l})=>e.next({block:l<.5?"start":"end",inline:c<.5?"start":"end"}),[]);return S.jsx("div",{ref:r,className:rE.fixed,children:i.spotlight&&S.jsx(s,{className:rE.slot,id:"spotlight",model:i.spotlight,onDrag:a,"data-block-alignment":o.block,"data-inline-alignment":o.inline})})},scrolling:function({ref:r,model:i,Slot:s}){Pl(),aN(i.setVisibleTiles);const{width:o,height:a}=vo(t),{gap:c,tileWidth:l,tileHeight:d}=_.useMemo(()=>cN(o,a,i.grid.length),[o,a,i.grid.length]);return S.jsx("div",{ref:r,className:rE.scrolling,style:{width:o,"--gap":`${c}px`,"--width":`${Math.floor(l)}px`,"--height":`${Math.floor(d)}px`},children:i.grid.map(h=>S.jsx(s,{className:rE.slot,id:h.id,model:h},h.id))})}}),_rt="_layer_mc5gk_8",Srt="_container_mc5gk_14",wrt="_local_mc5gk_18",Ert="_slot_mc5gk_31",iE={layer:_rt,container:Srt,local:wrt,slot:Ert},Crt=({minBounds$:t,pipAlignment$:e})=>({scrollingOnTop:!1,fixed:function({ref:r}){return Pl(),S.jsx("div",{ref:r})},scrolling:function({ref:r,model:i,Slot:s}){Pl();const{width:o,height:a}=vo(t),c=Fe(e),{tileWidth:l,tileHeight:d}=_.useMemo(()=>cN(o,a,1),[o,a]),h=_.useCallback(({xRatio:m,yRatio:g})=>e.next({block:g<.5?"start":"end",inline:m<.5?"start":"end"}),[]);return S.jsx("div",{ref:r,className:iE.layer,children:S.jsx(s,{id:i.remote.id,model:i.remote,className:iE.container,style:{width:l,height:d},children:S.jsx(s,{className:Le(iE.slot,iE.local),id:i.local.id,model:i.local,onDrag:h,"data-block-alignment":c.block,"data-inline-alignment":c.inline})})})}}),Trt="_layer_1swii_8",Rrt="_spotlight_1swii_12",krt="_pip_1swii_17",sE={layer:Trt,spotlight:Rrt,pip:krt},Irt=({pipAlignment$:t})=>({scrollingOnTop:!0,fixed:function({ref:n,model:r,Slot:i}){return Pl(),S.jsx("div",{ref:n,className:sE.layer,children:S.jsx(i,{className:sE.spotlight,id:"spotlight",model:r.spotlight})})},scrolling:function({ref:n,model:r,Slot:i}){Pl();const s=Fe(t),o=_.useCallback(({xRatio:a,yRatio:c})=>t.next({block:c<.5?"start":"end",inline:a<.5?"start":"end"}),[]);return S.jsx("div",{ref:n,className:sE.layer,children:r.pip&&S.jsx(i,{className:sE.pip,id:r.pip.id,model:r.pip,onDrag:o,"data-block-alignment":s.block,"data-inline-alignment":s.inline})})}}),xrt="_layer_jsvx2_8",Art="_spotlight_jsvx2_19",Lrt="_slot_jsvx2_28",Mrt="_grid_jsvx2_34",fu={layer:xrt,spotlight:Art,slot:Lrt,grid:Mrt},Ort=({minBounds$:t})=>({scrollingOnTop:!1,fixed:function({ref:n,model:r,Slot:i}){return Pl(),vo(t),S.jsxs("div",{ref:n,className:fu.layer,children:[S.jsx("div",{className:fu.spotlight,children:S.jsx(i,{className:fu.slot,id:"spotlight",model:r.spotlight})}),S.jsx("div",{className:fu.grid})]})},scrolling:function({ref:n,model:r,Slot:i}){Pl(),aN(r.setVisibleTiles),vo(t);const s=vo(r.spotlight.media$).length>1;return S.jsxs("div",{ref:n,className:fu.layer,children:[S.jsx("div",{className:Le(fu.spotlight,{[fu.withIndicators]:s})}),S.jsx("div",{className:fu.grid,children:r.grid.map(o=>S.jsx(i,{className:fu.slot,id:o.id,model:o},o.id))})]})}}),Prt="_layer_1q32d_8",Drt="_spotlight_1q32d_17",Nrt="_withIndicators_1q32d_26",Urt="_slot_1q32d_30",jrt="_grid_1q32d_35",tf={layer:Prt,spotlight:Drt,withIndicators:Nrt,slot:Urt,grid:jrt},Frt=({minBounds$:t})=>({scrollingOnTop:!1,fixed:function({ref:n,model:r,Slot:i}){return Pl(),S.jsx("div",{ref:n,className:tf.layer,children:S.jsx("div",{className:tf.spotlight,children:S.jsx(i,{className:tf.slot,id:"spotlight",model:r.spotlight})})})},scrolling:function({ref:n,model:r,Slot:i}){Pl(),aN(r.setVisibleTiles);const{width:s}=vo(t),{gap:o,tileWidth:a,tileHeight:c}=cN(s,s,r.grid.length),l=Fe(r.spotlight.media$).length>1;return S.jsxs("div",{ref:n,className:tf.layer,style:{"--grid-gap":`${o}px`,"--grid-tile-width":`${Math.floor(a)}px`,"--grid-tile-height":`${Math.floor(c)}px`},children:[S.jsx("div",{className:Le(tf.spotlight,{[tf.withIndicators]:l})}),S.jsx("div",{className:tf.grid,children:r.grid.map(d=>S.jsx(i,{className:tf.slot,id:d.id,model:d},d.id))})]})}});async function Mpe(t,e,n,r,i=0,s){const o=t.createGain();o.gain.setValueAtTime(n,0);const a=t.createStereoPanner();a.pan.setValueAtTime(r,0);const c=t.createBufferSource();c.buffer=e,s?.signal.addEventListener("abort",()=>{c.disconnect()});const l=new Promise(d=>c.addEventListener("ended",()=>d()));return c.connect(o).connect(a).connect(t.destination),iue(),c.start(t.currentTime+i),l}function $rt(t,e,n,r,i){if(i===0)throw Error("Looping sounds must have a delay");let s,o,a;return(async()=>{a=new AbortController,s=Promise.resolve();do o=Mpe(t,e,n,r,i,a),await s,s=o;while(!a.signal.aborted)})(),async()=>{a?.abort(),await s,await o}}function A4(t){const[e]=$r(qle),[n,r]=_.useState(),[i,s]=_.useState();_.useEffect(()=>{const d=t.sounds;if(!d)return;const h=new AudioContext({latencyHint:t.latencyHint});return(async()=>{const m={};for(const[g,y]of Object.entries(await d)){const v=await h.decodeAudioData(y.slice(0));m[g]=v}s(m)})().catch(m=>{N.debug("Failed to setup audio context",m)}),r(h),()=>{h.close().catch(m=>{N.debug("Failed to close audio engine",m)}),r(void 0)}},[t.sounds,t.latencyHint]);const o=vo(vm().audioOutput.selected$)?.id,{controlledAudioDevices:a}=nc();_.useEffect(()=>{n&&"setSinkId"in n&&!a&&n.setSinkId(o).catch(d=>{N.warn("Unable to change sink for audio context",d)})},[n,o,a]);const{pan:c,volume:l}=pue();return!n||!i||t.muted?null:{playSound:async d=>{if(!i[d]){N.debug(`Tried to play a sound that wasn't buffered (${d})`);return}return Mpe(n,i[d],e*l,c)},playSoundLooping:(d,h)=>{if(!i[d])throw Error(`Tried to play a sound that wasn't buffered (${d})`);return $rt(n,i[d],e*l,c,h)},soundDuration:Object.fromEntries(Object.entries(i).map(([d,h])=>[d,h.duration]))}}function Brt(){return document.createElement("audio").canPlayType("audio/ogg")==="maybe"?"ogg":"mp3"}const Hrt=Brt();async function lN(t){const e={};return await Promise.all(Object.entries(t).map(async([n,r])=>{const{mp3:i,ogg:s}=r,o=await fetch(Hrt==="ogg"?s:i??s);if(J8(o)){N.warn(`Could not load sound ${n}, response was not okay`);return}e[n]=await o.arrayBuffer()})),e}const iX=Object.fromEntries([...d_.filter(t=>t.sound!==void 0).map(t=>[t.name,t.sound]),[TM.name,TM.sound]]);function qrt({vm:t,muted:e}){const[n]=$r(b9),[r,i]=_.useState(null),s=A4({sounds:r,latencyHint:"interactive",muted:e}),o=zp(s);return _.useEffect(()=>{!n||r||i(lN(iX))},[r,n]),_.useEffect(()=>{const a=t.audibleReactions$.subscribe(c=>{for(const l of c)iX[l]?o.current?.playSound(l):o.current?.playSound("generic")});return()=>{a.unsubscribe()}},[t,o]),null}const Vrt="_container_1ux8r_1",Krt="_reaction_1ux8r_12",sX={container:Vrt,reaction:Krt};function Grt({vm:t}){const e=Fe(t.visibleReactions$);return S.jsx("div",{className:sX.container,children:e.map(({sender:n,emoji:r,startX:i})=>S.jsx("span",{role:"presentation",style:{left:`${i}vw`},className:sX.reaction,children:r},n))})}const zrt=""+new URL("join_call-dEJCP2wD.mp3",import.meta.url).href,Wrt=""+new URL("join_call-DlMV9nHk.ogg",import.meta.url).href,Yrt=""+new URL("left_call-BbqmRgnC.mp3",import.meta.url).href,Xrt=""+new URL("left_call-C7NMl6WI.ogg",import.meta.url).href,Jrt=""+new URL("raise_hand-CUbxEnt9.ogg",import.meta.url).href,Qrt=""+new URL("raise_hand-Bzqn65WB.mp3",import.meta.url).href,Zrt=""+new URL("screen_share_started-IZDL-kAw.ogg",import.meta.url).href,eit=""+new URL("screen_share_started-DH3qxml5.mp3",import.meta.url).href,tit=""+new URL("call_declined-1jWRbd4p.mp3",import.meta.url).href,nit=""+new URL("call_declined-C6gHsCGH.ogg",import.meta.url).href,rit=""+new URL("call_timeout-BCxXxRD8.mp3",import.meta.url).href,iit=""+new URL("call_timeout-DPKAj6sz.ogg",import.meta.url).href,Ope=lN({join:{mp3:zrt,ogg:Wrt},left:{mp3:Yrt,ogg:Xrt},raiseHand:{mp3:Qrt,ogg:Jrt},screenshareStarted:{mp3:eit,ogg:Zrt},decline:{mp3:tit,ogg:nit},timeout:{mp3:rit,ogg:iit}});function sit({vm:t,muted:e}){const n=A4({sounds:Ope,latencyHint:"interactive",muted:e}),r=zp(n);return _.useEffect(()=>{const i=t.joinSoundEffect$.subscribe(()=>{r.current?.playSound("join")}),s=t.leaveSoundEffect$.subscribe(()=>{r.current?.playSound("left")}),o=t.newHandRaised$.subscribe(()=>{r.current?.playSound("raiseHand")}),a=t.newScreenShare$.subscribe(()=>{r.current?.playSound("screenshareStarted")});return()=>{i.unsubscribe(),s.unsubscribe(),o.unsubscribe(),a.unsubscribe()}},[r,t]),S.jsx(S.Fragment,{})}const oX=3e3;class oit{constructor(e,n){this.scope=e,this.rtcSession=n,this.raisedHandsSubject$=new mr({}),this.reactionsSubject$=new mr({}),this.raisedHands$=this.raisedHandsSubject$.asObservable(),this.reactions$=this.reactionsSubject$.asObservable(),this.onMembershipsChanged=r=>{for(const i of Object.keys(this.raisedHandsSubject$.value).filter(s=>r.find(o=>o.userId==s)))this.removeRaisedHand(i);for(const i of this.rtcSession.memberships){if(!i.userId||!i.eventId)continue;const s=`${i.userId}:${i.deviceId}`;this.raisedHandsSubject$.value[s]&&this.raisedHandsSubject$.value[s].membershipEventId!==i.eventId&&this.removeRaisedHand(s);const o=this.getLastReactionEvent(i.eventId,i.userId);if(o){const a=o?.getId();if(!a)continue;this.addRaisedHand(`${i.userId}:${i.deviceId}`,{membershipEventId:i.eventId,reactionEventId:a,time:new Date(o.localTimestamp)})}}},this.handleReactionEvent=r=>{const i=this.rtcSession.room;if(r.getRoomId()!==i.roomId||r.isSending())return;const s=r.getSender(),o=r.getId();if(!(!s||!o)&&(i.client.decryptEventIfNeeded(r).catch(a=>N.warn(`Failed to decrypt ${r.getId()}`,a)),!(r.isBeingDecrypted()||r.isDecryptionFailure()))){if(r.getType()===e9){const a=r.getContent(),c=a?.["m.relates_to"]?.event_id,l=this.rtcSession.memberships.find(v=>v.eventId===c&&v.userId===s);if(!l){N.warn(`Reaction target was not a membership event for ${s}, ignoring`);return}const d=`${l.userId}:${l.deviceId}`;if(!a.emoji){N.warn(`Reaction had no emoji from ${o}`);return}const m=new Intl.Segmenter(void 0,{granularity:"grapheme"}).segment(a.emoji)[Symbol.iterator]().next().value?.segment;if(!m?.trim()){N.warn(`Reaction had no emoji from ${o} after splitting`);return}const g={...TM,emoji:m,...d_.find(v=>v.name===a.name)},y=this.reactionsSubject$.value;if(y[d]){N.warn(`Got reaction from ${d} but one is still playing`);return}this.reactionsSubject$.next({...y,[d]:{reactionOption:g,expireAfter:new Date(Date.now()+oX)}})}else if(r.getType()===ee.Reaction){const a=r.getContent(),c=a["m.relates_to"].event_id,l=this.rtcSession.memberships.find(d=>d.eventId===c&&d.userId===s);if(!l){N.warn(`Reaction target was not a membership event for ${s}, ignoring`);return}a?.["m.relates_to"].key==="🖐️"&&this.addRaisedHand(`${l.userId}:${l.deviceId}`,{reactionEventId:o,membershipEventId:c,time:new Date(r.localTimestamp)})}else if(r.getType()===ee.RoomRedaction){const a=r.event.redacts,c=Object.entries(this.raisedHandsSubject$.value).find(([l,d])=>d.reactionEventId===a)?.[0];if(!c)return;this.removeRaisedHand(c)}}},this.reactionsSubject$.pipe(EKe(oX),this.scope.bind()).subscribe(r=>{const i=new Date,s=Object.fromEntries(Object.entries(r).filter(([o,a])=>a.expireAfter>i));Object.keys(r).length!==Object.keys(s).length&&this.reactionsSubject$.next(s)}),this.rtcSession.room.on(Me.Timeline,this.handleReactionEvent),this.scope.onEnd(()=>this.rtcSession.room.off(Me.Timeline,this.handleReactionEvent)),this.rtcSession.room.on(Me.Redaction,this.handleReactionEvent),this.scope.onEnd(()=>this.rtcSession.room.off(Me.Redaction,this.handleReactionEvent)),this.rtcSession.room.client.on(Zt.Decrypted,this.handleReactionEvent),this.scope.onEnd(()=>this.rtcSession.room.client.off(Zt.Decrypted,this.handleReactionEvent)),this.rtcSession.room.on(Me.LocalEchoUpdated,this.handleReactionEvent),this.scope.onEnd(()=>this.rtcSession.room.off(Me.LocalEchoUpdated,this.handleReactionEvent)),this.rtcSession.on(Ji.MembershipsChanged,this.onMembershipsChanged),this.scope.onEnd(()=>this.rtcSession.off(Ji.MembershipsChanged,this.onMembershipsChanged)),this.onMembershipsChanged([])}getLastReactionEvent(e,n){return(this.rtcSession.room.relations.getChildEventsForEvent(e,vn.Annotation,ee.Reaction)?.getRelations()??[]).find(s=>s.event.sender===n&&s.getType()===ee.Reaction&&s.getContent()?.["m.relates_to"]?.key==="🖐️")}addRaisedHand(e,n){this.raisedHandsSubject$.next({...this.raisedHandsSubject$.value,[e]:n})}removeRaisedHand(e){this.raisedHandsSubject$.next(Object.fromEntries(Object.entries(this.raisedHandsSubject$.value).filter(([n])=>n!==e)))}}const ait=N.getChild("[MatrixAudioRenderer]");function cit({url:t,livekitRoom:e,validIdentities:n,muted:r}){const i=NJe([pe.Source.Microphone,pe.Source.ScreenShareAudio,pe.Source.Unknown],{updateOnlyOn:[],onlySubscribed:!0,room:e}).filter(h=>h.publication.kind===pe.Kind.Audio).filter(h=>n.includes(h.participant.identity)?!0:(ait.warn(`Audio track ${h.participant.identity} from ${t} has no matching matrix call member`,`current members: ${n.join()}`,"track will not get rendered"),!1)),{pan:s,volume:o}=pue(),a=s!==0,[c,l]=_.useState(void 0);_.useEffect(()=>{const h=new AudioContext;return l(h),()=>{h.close()}},[]);const d=_.useMemo(()=>({gain:c?.createGain(),pan:c?.createStereoPanner()}),[c]);return _.useEffect(()=>{d.pan&&(d.pan.pan.value=s)},[d.pan,s]),_.useEffect(()=>{d.gain&&(d.gain.gain.value=o)},[d.gain,o]),S.jsx("div",{style:{display:"none"},children:i.map(h=>S.jsx(lit,{trackRef:h,muted:r,audioContext:a?c:void 0,audioNodes:d},yGe(h)))})}function lit({trackRef:t,muted:e,audioContext:n,audioNodes:r,...i}){const[s,o]=Ipe(()=>!1,[n&&r]);return _.useEffect(()=>{if(!t||s)return;const a=t.publication.track,c=n&&r.gain&&r.pan;a.setAudioContext(c?n:void 0),a.setWebAudioPlugins(c?[r.gain,r.pan]:[]),o(!0),iue()},[n,r,o,s,t]),s&&S.jsx(zJe,{trackRef:t,muted:e,...i})}const Ppe=sue.behavior(ot([tO.pipe(xn(!0)),Vle.value$],(t,e)=>!t||e)),uit="_overlay_kh5c3_1",dit="_icon_kh5c3_32",fit="_spacer_kh5c3_47",M5={overlay:uit,icon:dit,spacer:fit},hit=({show:t,onBackToVideoPressed:e})=>{const{t:n}=et();return S.jsxs("div",{className:M5.overlay,"data-show":t,"aria-hidden":!t,children:[S.jsx(qoe,{className:M5.icon,children:S.jsx(oNe,{"aria-hidden":!0})}),S.jsx(Hc,{as:"h2",weight:"semibold",size:"md",children:n("handset.overlay_title")}),S.jsx(an,{children:n("handset.overlay_description")}),S.jsx(qt,{kind:"primary",size:"sm",onClick:()=>{e?.()},children:n("handset.overlay_back_button")}),S.jsx("div",{className:M5.spacer})]})},pit="_bar_32sbm_1",mit={bar:pit},L4=_.createContext(null),git=({children:t})=>{const{t:e}=et(),n=_.useCallback(d=>{d.preventDefault(),window.controls.onBackButtonPressed?.()},[]),[r,i]=_.useState(""),[s,o]=_.useState(!1),[a,c]=_.useState(null),l=_.useMemo(()=>({setTitle:i,setSecondaryButton:c,setHidden:o}),[i,o,c]);return S.jsxs(S.Fragment,{children:[S.jsx("div",{style:{display:s?"none":"block"},className:mit.bar,children:S.jsxs(gd,{disconnectedBanner:!1,children:[S.jsx(hh,{children:S.jsx(bi,{label:e("common.back"),children:S.jsx(sR,{onClick:n,children:S.jsx(oae,{})})})}),r&&S.jsx(Hc,{type:"body",size:"lg",weight:Dc==="android"?"medium":"semibold",children:r}),S.jsx(ph,{children:a})]})}),S.jsx(L4,{value:l,children:t})]})};function vit(t){const e=_.use(L4)?.setTitle;_.useEffect(()=>{if(e!==void 0)return e(t),()=>e("")},[t,e])}function yit(t){const e=_.use(L4)?.setHidden;_.useEffect(()=>{if(e!==void 0)return e(t),()=>e(!1)},[e,t])}function bit(t){const e=_.use(L4)?.setSecondaryButton;_.useEffect(()=>{if(e!==void 0)return e(t),()=>e("")},[t,e])}const _it="_toast_z5w27_8",Sit={toast:_it},Dpe=({open:t,onDismiss:e,autoDismiss:n,children:r,Icon:i,modal:s=!0})=>{const o=_.useCallback(c=>{c||e()},[e]);_.useEffect(()=>{if(t&&n!==void 0){const c=setTimeout(e,n);return()=>clearTimeout(c)}},[t,n,e]);const a=S.jsxs(S.Fragment,{children:[S.jsx(a8,{className:Le(io.bg,io.animate)}),S.jsx(c8,{"aria-describedby":void 0,asChild:!0,children:S.jsxs(nse,{className:Le(io.overlay,io.animate,Sit.toast),children:[S.jsx(l8,{asChild:!0,children:S.jsx(an,{as:"h3",size:"sm",weight:"semibold",children:r})}),i&&S.jsx(i,{width:20,height:20,"aria-hidden":!0})]})})]});return S.jsx(s8,{open:t,onOpenChange:o,modal:s,children:s?S.jsx(o8,{children:a}):a})},wit="_overlay_128zq_1",Eit="_content_128zq_10",Cit="_pulse_128zq_17",Tit="_text_128zq_33",oE={overlay:wit,content:Eit,pulse:Cit,text:Tit},Rit=""+new URL("ringtone-B2csBdU4.mp3",import.meta.url).href,kit=""+new URL("ringtone-B-nJXbbw.ogg",import.meta.url).href,fT=N.getChild("[InCallView]"),Iit=400,xit=t=>{const[e,n]=_.useState(null),r=nc(),i=vm(),s=sYe();return _.useEffect(()=>{fT.info("START CALL VIEW SCOPE");const o=new pS,a=new oit(o,t.rtcSession),{autoLeaveWhenOthersLeft:c,waitForCallPickup:l,sendNotificationType:d}=r,h=Wtt(o,t.rtcSession,t.matrixRoom,i,t.muteStates,{encryptionSystem:t.e2eeSystem,autoLeaveWhenOthersLeft:c,waitForCallPickup:l&&d==="ring",matrixRTCMode$:Gle.value$},a.raisedHands$,a.reactions$,o.behavior(s));return h.join(),n(h),h.leave$.pipe(o.bind()).subscribe(t.onLeft),()=>{fT.info("END CALL VIEW SCOPE"),o.end()}},[t.rtcSession,t.matrixRoom,t.muteStates,t.e2eeSystem,t.onLeft,r,i,s]),e===null?null:S.jsx(HBe,{vm:e,rtcSession:t.rtcSession,children:S.jsx(Ait,{...t,vm:e})})},Ait=({client:t,vm:e,matrixInfo:n,matrixRoom:r,muteStates:i,header:s,onShareClick:o})=>{const{t:a}=et(),{supportsReactions:c,sendReaction:l,toggleRaisedHand:d}=t9();Get();const h=_.useRef(null),[m,g]=vb(),y=xS(h,m),{showControls:v}=nc(),E=Fe(Ppe),w=Fe(e.callPickupState$),R=Bf(async()=>lN({waiting:{mp3:Rit,ogg:kit}})),x=A4({sounds:R,latencyHint:"interactive",muted:E}),C=Fe(i.audio.enabled$),k=Fe(i.video.enabled$),T=Fe(i.audio.toggle$),L=Fe(i.video.toggle$),O=Fe(i.audio.setEnabled$);zQe(h,T,L,O,Be=>{l(Be)},()=>{d()});const P=Fe(e.livekitRoomItems$),D=Fe(e.participantCount$),j=Fe(e.reconnecting$),H=Fe(e.windowMode$),z=Fe(e.layout$),Y=Fe(e.tileStoreGeneration$),[W]=$r(y9),F=Fe(e.gridMode$),$=Fe(e.showHeader$),V=Fe(e.showFooter$),G=Fe(e.earpieceMode$),Z=Fe(e.audioOutputSwitcher$),q=Fe(e.sharingScreen$),J=Fe(e.ringOverlay$),ue=Fe(e.fatalError$);if(ue)throw fT.debug("fatalCallError stop rendering",ue),ue;const ge=x?.soundDuration.waiting??1;_.useEffect(()=>(window.document.body.style.setProperty("--call-ring-duration-s",`${ge*2}s`),window.document.body.style.setProperty("--call-ring-delay-s",`${ge}s`),()=>{window.document.body.style.removeProperty("--call-ring-duration-s"),window.document.body.style.removeProperty("--call-ring-delay-s")}),[x?.soundDuration,ge]),_.useEffect(()=>{if(w!=="ringing"||!x)return;const Be=x.playSoundLooping("waiting",ge);return()=>{Be().catch(rt=>{fT.error("Failed to stop ringing sound",rt)})}},[w,x,ge]);const Re=_.useMemo(()=>J?S.jsx("div",{className:Le(io.bg,oE.overlay),children:S.jsxs("div",{className:Le(io.content,oE.content),children:[S.jsx("div",{className:oE.pulse,children:S.jsx(dm,{id:J.idForAvatar,name:J.name,src:J.avatarMxc,size:um.XL})}),S.jsx(an,{size:"md",className:oE.text,children:J.text})]})}):null,[J]),we=_.useRef(null),de=_.useCallback(()=>we.current=Date.now(),[]),ke=_.useCallback(()=>{const Be=we.current;Be!==null&&Date.now()-Be<=Iit&&e.tapScreen(),we.current=null},[e]),De=_.useCallback(()=>we.current=null,[]),Je=_.useCallback(Be=>{V?(Be.stopPropagation(),e.tapControls()):Be.preventDefault()},[e,V]),vt=_.useCallback(Be=>{Be.pointerType==="mouse"&&e.hoverScreen()},[e]),Sr=_.useCallback(()=>e.unhoverScreen(),[e]),[zn,ze]=_.useState(!1),[ys,bs]=_.useState(DD),wi=_.useCallback(()=>ze(!0),[ze]),ql=_.useCallback(()=>ze(!1),[ze]),sc=_.useMemo(()=>Et===null?()=>{bs("profile"),ze(!0)}:null,[bs,ze]),[_s,Ss]=vb(),[wd,To]=vb(),wr=_.useMemo(()=>({width:g.width,height:g.height-Ss.height-(H==="flat"?0:To.height)}),[g.width,g.height,Ss.height,To.height,H]),oc=fue(Be=>Be.pipe(ve(([rt])=>rt)),[wr]),Wc=Bf(()=>new mr(vrt)),Vl=Bf(()=>new mr(yrt)),Ro=_.useCallback(Be=>e.setGridMode(Be),[e]);bit(_.useMemo(()=>{if(Z===null)return null;const Be=Z.targetOutput==="earpiece",rt=Be?sNe:lNe,Mt=a(Be?"settings.devices.handset":"settings.devices.loudspeaker");return S.jsx(bi,{label:Mt,children:S.jsx(sR,{onClick:Un=>{Un.preventDefault(),Z.switch()},children:S.jsx(rt,{})})})},[a,Z])),yit(!$);let Yc=null;if($)switch(s){case"none":Yc=S.jsx("div",{className:Le(kr.header,kr.filler),ref:_s});break;case"standard":Yc=S.jsxs(gd,{className:kr.header,ref:_s,disconnectedBanner:!1,children:[S.jsx(hh,{children:S.jsx(zae,{id:n.roomId,name:n.roomName,avatarUrl:n.roomAvatar,encrypted:n.e2eeSystem.kind!==qn.NONE,participantCount:D})}),S.jsx(ph,{children:v&&o!==null&&S.jsx(vhe,{className:kr.invite,onClick:o})})]})}const Kl=_.useCallback(()=>{},[]),Ed=S.jsxs(S.Fragment,{children:[S.jsx("div",{className:Le(io.bg,io.animate),"data-state":j?"open":"closed"}),S.jsx(Dpe,{onDismiss:Kl,open:j,modal:!1,children:a("common.reconnecting")})]}),qs=S.jsx(hit,{show:G&&!j,onBackToVideoPressed:Z?.switch}),Ei=j||G,Gr=_.useMemo(()=>function({ref:rt,className:Mt,style:Un,targetWidth:jn,targetHeight:ws,model:zr}){const Es=Fe(e.spotlightExpanded$),Ci=Fe(e.toggleSpotlightExpanded$),os=Fe(e.showSpeakingIndicators$),ac=Fe(e.showSpotlightIndicators$);return zr instanceof spe?S.jsx(ipe,{ref:rt,vm:zr,onOpenProfile:sc,targetWidth:jn,targetHeight:ws,className:Le(Mt,kr.tile),style:Un,showSpeakingIndicators:os,focusable:!Ei}):S.jsx(BO,{ref:rt,vm:zr,expanded:Es,onToggleExpanded:Ci,targetWidth:jn,targetHeight:ws,showIndicators:ac,focusable:!Ei,className:Le(Mt,kr.tile),style:Un})},[e,sc,Ei]),Vs=_.useMemo(()=>{const Be={minBounds$:oc,spotlightAlignment$:Wc,pipAlignment$:Vl};return{grid:brt(Be),"spotlight-landscape":Ort(Be),"spotlight-portrait":Frt(Be),"spotlight-expanded":Irt(Be),"one-on-one":Crt(Be)}},[oc,Wc,Vl]),li=()=>{if(z.type==="pip")return S.jsx(BO,{className:Le(kr.tile,kr.maximised),vm:z.spotlight,expanded:!0,onToggleExpanded:null,targetWidth:wr.height,targetHeight:wr.width,showIndicators:!1,focusable:!Ei,"aria-hidden":Ei});const Be=Vs[z.type],rt=S.jsx(nX,{className:kr.fixedGrid,style:{insetBlockStart:Ss.height>0?Ss.bottom:g.top,height:wr.height},model:z,Layout:Be.fixed,Tile:Gr,"aria-hidden":Ei},"fixed"),Mt=S.jsx(nX,{className:kr.fixedGrid,model:z,Layout:Be.fixed,Tile:Gr,"aria-hidden":Ei},"scrolling");return z.type==="spotlight-expanded"?S.jsxs(S.Fragment,{children:[rt,Mt]}):S.jsxs(S.Fragment,{children:[Mt,rt]})},Cd=uBe(r.roomId),ko=[];ko.push(S.jsx(vce,{muted:!C,onClick:T??void 0,onTouchEnd:Je,disabled:T===null,"data-testid":"incall_mute"},"audio"),S.jsx(yce,{muted:!k,onClick:L??void 0,onTouchEnd:Je,disabled:L===null,"data-testid":"incall_videomute"},"video")),e.toggleScreenSharing!==null&&ko.push(S.jsx(gBe,{className:kr.shareScreen,enabled:q,onClick:e.toggleScreenSharing,onTouchEnd:Je,"data-testid":"incall_screenshare"},"share_screen")),c&&ko.push(S.jsx(CHe,{vm:e,className:kr.raiseHand,identifier:`${t.getUserId()}:${t.getDeviceId()}`,onTouchEnd:Je},"raise_hand")),z.type!=="pip"&&ko.push(S.jsx(_ce,{onClick:wi,onTouchEnd:Je},"settings")),ko.push(S.jsx(bce,{onClick:function(){e.hangup()},onTouchEnd:Je,"data-testid":"incall_leave"},"end_call"));const nt=S.jsxs("div",{ref:wd,className:Le(kr.footer,{[kr.overlay]:H==="flat",[kr.hidden]:!V||!v&&s==="none"}),children:[s!=="none"&&S.jsxs("div",{className:kr.logo,children:[S.jsx(VQe,{width:24,height:24,"aria-hidden":!0}),S.jsx(GQe,{width:80,height:11,"aria-label":"Element Call"}),W?`Tiles generation: ${Y}`:void 0]}),v&&S.jsx("div",{className:kr.buttons,children:ko}),v&&S.jsx(Yet,{className:kr.layout,layout:F,setLayout:Ro,onTouchEnd:Je})]}),Dt=Fe(e.allConnections$);return S.jsxs("div",{className:kr.inRoom,ref:y,onTouchStart:de,onTouchEnd:ke,onTouchCancel:De,onPointerMove:vt,onPointerOut:Sr,children:[Yc,P.map(({livekitRoom:Be,url:rt,participants:Mt})=>S.jsx(cit,{url:rt,livekitRoom:Be,validIdentities:Mt,muted:E},rt)),li(),S.jsx(sit,{vm:e,muted:E}),S.jsx(qrt,{vm:e,muted:E}),Ed,qs,S.jsx(Grt,{vm:e}),Re,nt,z.type!=="pip"&&S.jsxs(S.Fragment,{children:[S.jsx(Ket,{...Cd}),S.jsx(ND,{client:t,roomId:r.roomId,open:zn,onDismiss:ql,tab:ys,onTabChange:bs,livekitRooms:Dt.getConnections().map(Be=>({room:Be.livekitRoom,livekitAlias:Be.livekitAlias,isLocal:void 0,url:Be.transport.livekit_service_url}))})]})]})};function Npe(t,e){const n=u_(t,Me.CurrentStateUpdated,_.useCallback(()=>t.currentState,[t]));return u_(n,Rt.Update,_.useCallback(()=>e(n),[e,n]))}function Lit(t){return Npe(t,_.useCallback(()=>t.getMxcAvatarUrl(),[t]))}function Mit(t){return u_(t,Me.Name,_.useCallback(()=>t.name,[t]))}function Oit(t){return Npe(t,_.useCallback(e=>e.getJoinRule(),[]))}var O5,aX;function Pit(){return aX||(aX=1,O5=function(){var t=document.getSelection();if(!t.rangeCount)return function(){};for(var e=document.activeElement,n=[],r=0;r<t.rangeCount;r++)n.push(t.getRangeAt(r));switch(e.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":e.blur();break;default:e=null;break}return t.removeAllRanges(),function(){t.type==="Caret"&&t.removeAllRanges(),t.rangeCount||n.forEach(function(i){t.addRange(i)}),e&&e.focus()}}),O5}var P5,cX;function Dit(){if(cX)return P5;cX=1;var t=Pit(),e={"text/plain":"Text","text/html":"Url",default:"Text"},n="Copy to clipboard: #{key}, Enter";function r(s){var o=(/mac os x/i.test(navigator.userAgent)?"⌘":"Ctrl")+"+C";return s.replace(/#{\s*key\s*}/g,o)}function i(s,o){var a,c,l,d,h,m,g=!1;o||(o={}),a=o.debug||!1;try{l=t(),d=document.createRange(),h=document.getSelection(),m=document.createElement("span"),m.textContent=s,m.ariaHidden="true",m.style.all="unset",m.style.position="fixed",m.style.top=0,m.style.clip="rect(0, 0, 0, 0)",m.style.whiteSpace="pre",m.style.webkitUserSelect="text",m.style.MozUserSelect="text",m.style.msUserSelect="text",m.style.userSelect="text",m.addEventListener("copy",function(v){if(v.stopPropagation(),o.format)if(v.preventDefault(),typeof v.clipboardData>"u"){a&&console.warn("unable to use e.clipboardData"),a&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var E=e[o.format]||e.default;window.clipboardData.setData(E,s)}else v.clipboardData.clearData(),v.clipboardData.setData(o.format,s);o.onCopy&&(v.preventDefault(),o.onCopy(v.clipboardData))}),document.body.appendChild(m),d.selectNodeContents(m),h.addRange(d);var y=document.execCommand("copy");if(!y)throw new Error("copy command was unsuccessful");g=!0}catch(v){a&&console.error("unable to copy using execCommand: ",v),a&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(o.format||"text",s),o.onCopy&&o.onCopy(window.clipboardData),g=!0}catch(E){a&&console.error("unable to copy using clipboardData: ",E),a&&console.error("falling back to prompt"),c=r("message"in o?o.message:n),window.prompt(c,s)}}finally{h&&(typeof h.removeRange=="function"?h.removeRange(d):h.removeAllRanges()),m&&document.body.removeChild(m),l()}return g}return P5=i,P5}var Nit=Dit();const Uit=Dl(Nit),jit="_url_1ibuh_8",Fit="_button_1ibuh_15",$it="_qrCode_1ibuh_19",D5={url:jit,button:Fit,qrCode:$it};var Rg={},N5,lX;function Bit(){return lX||(lX=1,N5=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then}),N5}var U5={},nf={},uX;function bm(){if(uX)return nf;uX=1;let t;const e=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];return nf.getSymbolSize=function(r){if(!r)throw new Error('"version" cannot be null or undefined');if(r<1||r>40)throw new Error('"version" should be in range from 1 to 40');return r*4+17},nf.getSymbolTotalCodewords=function(r){return e[r]},nf.getBCHDigit=function(n){let r=0;for(;n!==0;)r++,n>>>=1;return r},nf.setToSJISFunction=function(r){if(typeof r!="function")throw new Error('"toSJISFunc" is not a valid function.');t=r},nf.isKanjiModeEnabled=function(){return typeof t<"u"},nf.toSJIS=function(r){return t(r)},nf}var j5={},dX;function uN(){return dX||(dX=1,(function(t){t.L={bit:1},t.M={bit:0},t.Q={bit:3},t.H={bit:2};function e(n){if(typeof n!="string")throw new Error("Param is not a string");switch(n.toLowerCase()){case"l":case"low":return t.L;case"m":case"medium":return t.M;case"q":case"quartile":return t.Q;case"h":case"high":return t.H;default:throw new Error("Unknown EC Level: "+n)}}t.isValid=function(r){return r&&typeof r.bit<"u"&&r.bit>=0&&r.bit<4},t.from=function(r,i){if(t.isValid(r))return r;try{return e(r)}catch{return i}}})(j5)),j5}var F5,fX;function Hit(){if(fX)return F5;fX=1;function t(){this.buffer=[],this.length=0}return t.prototype={get:function(e){const n=Math.floor(e/8);return(this.buffer[n]>>>7-e%8&1)===1},put:function(e,n){for(let r=0;r<n;r++)this.putBit((e>>>n-r-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(e){const n=Math.floor(this.length/8);this.buffer.length<=n&&this.buffer.push(0),e&&(this.buffer[n]|=128>>>this.length%8),this.length++}},F5=t,F5}var $5,hX;function qit(){if(hX)return $5;hX=1;function t(e){if(!e||e<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=e,this.data=new Uint8Array(e*e),this.reservedBit=new Uint8Array(e*e)}return t.prototype.set=function(e,n,r,i){const s=e*this.size+n;this.data[s]=r,i&&(this.reservedBit[s]=!0)},t.prototype.get=function(e,n){return this.data[e*this.size+n]},t.prototype.xor=function(e,n,r){this.data[e*this.size+n]^=r},t.prototype.isReserved=function(e,n){return this.reservedBit[e*this.size+n]},$5=t,$5}var B5={},pX;function Vit(){return pX||(pX=1,(function(t){const e=bm().getSymbolSize;t.getRowColCoords=function(r){if(r===1)return[];const i=Math.floor(r/7)+2,s=e(r),o=s===145?26:Math.ceil((s-13)/(2*i-2))*2,a=[s-7];for(let c=1;c<i-1;c++)a[c]=a[c-1]-o;return a.push(6),a.reverse()},t.getPositions=function(r){const i=[],s=t.getRowColCoords(r),o=s.length;for(let a=0;a<o;a++)for(let c=0;c<o;c++)a===0&&c===0||a===0&&c===o-1||a===o-1&&c===0||i.push([s[a],s[c]]);return i}})(B5)),B5}var H5={},mX;function Kit(){if(mX)return H5;mX=1;const t=bm().getSymbolSize,e=7;return H5.getPositions=function(r){const i=t(r);return[[0,0],[i-e,0],[0,i-e]]},H5}var q5={},gX;function Git(){return gX||(gX=1,(function(t){t.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const e={N1:3,N2:3,N3:40,N4:10};t.isValid=function(i){return i!=null&&i!==""&&!isNaN(i)&&i>=0&&i<=7},t.from=function(i){return t.isValid(i)?parseInt(i,10):void 0},t.getPenaltyN1=function(i){const s=i.size;let o=0,a=0,c=0,l=null,d=null;for(let h=0;h<s;h++){a=c=0,l=d=null;for(let m=0;m<s;m++){let g=i.get(h,m);g===l?a++:(a>=5&&(o+=e.N1+(a-5)),l=g,a=1),g=i.get(m,h),g===d?c++:(c>=5&&(o+=e.N1+(c-5)),d=g,c=1)}a>=5&&(o+=e.N1+(a-5)),c>=5&&(o+=e.N1+(c-5))}return o},t.getPenaltyN2=function(i){const s=i.size;let o=0;for(let a=0;a<s-1;a++)for(let c=0;c<s-1;c++){const l=i.get(a,c)+i.get(a,c+1)+i.get(a+1,c)+i.get(a+1,c+1);(l===4||l===0)&&o++}return o*e.N2},t.getPenaltyN3=function(i){const s=i.size;let o=0,a=0,c=0;for(let l=0;l<s;l++){a=c=0;for(let d=0;d<s;d++)a=a<<1&2047|i.get(l,d),d>=10&&(a===1488||a===93)&&o++,c=c<<1&2047|i.get(d,l),d>=10&&(c===1488||c===93)&&o++}return o*e.N3},t.getPenaltyN4=function(i){let s=0;const o=i.data.length;for(let c=0;c<o;c++)s+=i.data[c];return Math.abs(Math.ceil(s*100/o/5)-10)*e.N4};function n(r,i,s){switch(r){case t.Patterns.PATTERN000:return(i+s)%2===0;case t.Patterns.PATTERN001:return i%2===0;case t.Patterns.PATTERN010:return s%3===0;case t.Patterns.PATTERN011:return(i+s)%3===0;case t.Patterns.PATTERN100:return(Math.floor(i/2)+Math.floor(s/3))%2===0;case t.Patterns.PATTERN101:return i*s%2+i*s%3===0;case t.Patterns.PATTERN110:return(i*s%2+i*s%3)%2===0;case t.Patterns.PATTERN111:return(i*s%3+(i+s)%2)%2===0;default:throw new Error("bad maskPattern:"+r)}}t.applyMask=function(i,s){const o=s.size;for(let a=0;a<o;a++)for(let c=0;c<o;c++)s.isReserved(c,a)||s.xor(c,a,n(i,c,a))},t.getBestMask=function(i,s){const o=Object.keys(t.Patterns).length;let a=0,c=1/0;for(let l=0;l<o;l++){s(l),t.applyMask(l,i);const d=t.getPenaltyN1(i)+t.getPenaltyN2(i)+t.getPenaltyN3(i)+t.getPenaltyN4(i);t.applyMask(l,i),d<c&&(c=d,a=l)}return a}})(q5)),q5}var aE={},vX;function Upe(){if(vX)return aE;vX=1;const t=uN(),e=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],n=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];return aE.getBlocksCount=function(i,s){switch(s){case t.L:return e[(i-1)*4+0];case t.M:return e[(i-1)*4+1];case t.Q:return e[(i-1)*4+2];case t.H:return e[(i-1)*4+3];default:return}},aE.getTotalCodewordsCount=function(i,s){switch(s){case t.L:return n[(i-1)*4+0];case t.M:return n[(i-1)*4+1];case t.Q:return n[(i-1)*4+2];case t.H:return n[(i-1)*4+3];default:return}},aE}var V5={},R1={},yX;function zit(){if(yX)return R1;yX=1;const t=new Uint8Array(512),e=new Uint8Array(256);return(function(){let r=1;for(let i=0;i<255;i++)t[i]=r,e[r]=i,r<<=1,r&256&&(r^=285);for(let i=255;i<512;i++)t[i]=t[i-255]})(),R1.log=function(r){if(r<1)throw new Error("log("+r+")");return e[r]},R1.exp=function(r){return t[r]},R1.mul=function(r,i){return r===0||i===0?0:t[e[r]+e[i]]},R1}var bX;function Wit(){return bX||(bX=1,(function(t){const e=zit();t.mul=function(r,i){const s=new Uint8Array(r.length+i.length-1);for(let o=0;o<r.length;o++)for(let a=0;a<i.length;a++)s[o+a]^=e.mul(r[o],i[a]);return s},t.mod=function(r,i){let s=new Uint8Array(r);for(;s.length-i.length>=0;){const o=s[0];for(let c=0;c<i.length;c++)s[c]^=e.mul(i[c],o);let a=0;for(;a<s.length&&s[a]===0;)a++;s=s.slice(a)}return s},t.generateECPolynomial=function(r){let i=new Uint8Array([1]);for(let s=0;s<r;s++)i=t.mul(i,new Uint8Array([1,e.exp(s)]));return i}})(V5)),V5}var K5,_X;function Yit(){if(_X)return K5;_X=1;const t=Wit();function e(n){this.genPoly=void 0,this.degree=n,this.degree&&this.initialize(this.degree)}return e.prototype.initialize=function(r){this.degree=r,this.genPoly=t.generateECPolynomial(this.degree)},e.prototype.encode=function(r){if(!this.genPoly)throw new Error("Encoder not initialized");const i=new Uint8Array(r.length+this.degree);i.set(r);const s=t.mod(i,this.genPoly),o=this.degree-s.length;if(o>0){const a=new Uint8Array(this.degree);return a.set(s,o),a}return s},K5=e,K5}var G5={},z5={},W5={},SX;function jpe(){return SX||(SX=1,W5.isValid=function(e){return!isNaN(e)&&e>=1&&e<=40}),W5}var ol={},wX;function Fpe(){if(wX)return ol;wX=1;const t="[0-9]+",e="[A-Z $%*+\\-./:]+";let n="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";n=n.replace(/u/g,"\\u");const r="(?:(?![A-Z0-9 $%*+\\-./:]|"+n+`)(?:.|[\r
]))+`;ol.KANJI=new RegExp(n,"g"),ol.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g"),ol.BYTE=new RegExp(r,"g"),ol.NUMERIC=new RegExp(t,"g"),ol.ALPHANUMERIC=new RegExp(e,"g");const i=new RegExp("^"+n+"$"),s=new RegExp("^"+t+"$"),o=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");return ol.testKanji=function(c){return i.test(c)},ol.testNumeric=function(c){return s.test(c)},ol.testAlphanumeric=function(c){return o.test(c)},ol}var EX;function _m(){return EX||(EX=1,(function(t){const e=jpe(),n=Fpe();t.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},t.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},t.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},t.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},t.MIXED={bit:-1},t.getCharCountIndicator=function(s,o){if(!s.ccBits)throw new Error("Invalid mode: "+s);if(!e.isValid(o))throw new Error("Invalid version: "+o);return o>=1&&o<10?s.ccBits[0]:o<27?s.ccBits[1]:s.ccBits[2]},t.getBestModeForData=function(s){return n.testNumeric(s)?t.NUMERIC:n.testAlphanumeric(s)?t.ALPHANUMERIC:n.testKanji(s)?t.KANJI:t.BYTE},t.toString=function(s){if(s&&s.id)return s.id;throw new Error("Invalid mode")},t.isValid=function(s){return s&&s.bit&&s.ccBits};function r(i){if(typeof i!="string")throw new Error("Param is not a string");switch(i.toLowerCase()){case"numeric":return t.NUMERIC;case"alphanumeric":return t.ALPHANUMERIC;case"kanji":return t.KANJI;case"byte":return t.BYTE;default:throw new Error("Unknown mode: "+i)}}t.from=function(s,o){if(t.isValid(s))return s;try{return r(s)}catch{return o}}})(z5)),z5}var CX;function Xit(){return CX||(CX=1,(function(t){const e=bm(),n=Upe(),r=uN(),i=_m(),s=jpe(),o=7973,a=e.getBCHDigit(o);function c(m,g,y){for(let v=1;v<=40;v++)if(g<=t.getCapacity(v,y,m))return v}function l(m,g){return i.getCharCountIndicator(m,g)+4}function d(m,g){let y=0;return m.forEach(function(v){const E=l(v.mode,g);y+=E+v.getBitsLength()}),y}function h(m,g){for(let y=1;y<=40;y++)if(d(m,y)<=t.getCapacity(y,g,i.MIXED))return y}t.from=function(g,y){return s.isValid(g)?parseInt(g,10):y},t.getCapacity=function(g,y,v){if(!s.isValid(g))throw new Error("Invalid QR Code version");typeof v>"u"&&(v=i.BYTE);const E=e.getSymbolTotalCodewords(g),w=n.getTotalCodewordsCount(g,y),R=(E-w)*8;if(v===i.MIXED)return R;const x=R-l(v,g);switch(v){case i.NUMERIC:return Math.floor(x/10*3);case i.ALPHANUMERIC:return Math.floor(x/11*2);case i.KANJI:return Math.floor(x/13);case i.BYTE:default:return Math.floor(x/8)}},t.getBestVersionForData=function(g,y){let v;const E=r.from(y,r.M);if(Array.isArray(g)){if(g.length>1)return h(g,E);if(g.length===0)return 1;v=g[0]}else v=g;return c(v.mode,v.getLength(),E)},t.getEncodedBits=function(g){if(!s.isValid(g)||g<7)throw new Error("Invalid QR Code version");let y=g<<12;for(;e.getBCHDigit(y)-a>=0;)y^=o<<e.getBCHDigit(y)-a;return g<<12|y}})(G5)),G5}var Y5={},TX;function Jit(){if(TX)return Y5;TX=1;const t=bm(),e=1335,n=21522,r=t.getBCHDigit(e);return Y5.getEncodedBits=function(s,o){const a=s.bit<<3|o;let c=a<<10;for(;t.getBCHDigit(c)-r>=0;)c^=e<<t.getBCHDigit(c)-r;return(a<<10|c)^n},Y5}var X5={},J5,RX;function Qit(){if(RX)return J5;RX=1;const t=_m();function e(n){this.mode=t.NUMERIC,this.data=n.toString()}return e.getBitsLength=function(r){return 10*Math.floor(r/3)+(r%3?r%3*3+1:0)},e.prototype.getLength=function(){return this.data.length},e.prototype.getBitsLength=function(){return e.getBitsLength(this.data.length)},e.prototype.write=function(r){let i,s,o;for(i=0;i+3<=this.data.length;i+=3)s=this.data.substr(i,3),o=parseInt(s,10),r.put(o,10);const a=this.data.length-i;a>0&&(s=this.data.substr(i),o=parseInt(s,10),r.put(o,a*3+1))},J5=e,J5}var Q5,kX;function Zit(){if(kX)return Q5;kX=1;const t=_m(),e=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function n(r){this.mode=t.ALPHANUMERIC,this.data=r}return n.getBitsLength=function(i){return 11*Math.floor(i/2)+6*(i%2)},n.prototype.getLength=function(){return this.data.length},n.prototype.getBitsLength=function(){return n.getBitsLength(this.data.length)},n.prototype.write=function(i){let s;for(s=0;s+2<=this.data.length;s+=2){let o=e.indexOf(this.data[s])*45;o+=e.indexOf(this.data[s+1]),i.put(o,11)}this.data.length%2&&i.put(e.indexOf(this.data[s]),6)},Q5=n,Q5}var Z5,IX;function est(){if(IX)return Z5;IX=1;const t=_m();function e(n){this.mode=t.BYTE,typeof n=="string"?this.data=new TextEncoder().encode(n):this.data=new Uint8Array(n)}return e.getBitsLength=function(r){return r*8},e.prototype.getLength=function(){return this.data.length},e.prototype.getBitsLength=function(){return e.getBitsLength(this.data.length)},e.prototype.write=function(n){for(let r=0,i=this.data.length;r<i;r++)n.put(this.data[r],8)},Z5=e,Z5}var eA,xX;function tst(){if(xX)return eA;xX=1;const t=_m(),e=bm();function n(r){this.mode=t.KANJI,this.data=r}return n.getBitsLength=function(i){return i*13},n.prototype.getLength=function(){return this.data.length},n.prototype.getBitsLength=function(){return n.getBitsLength(this.data.length)},n.prototype.write=function(r){let i;for(i=0;i<this.data.length;i++){let s=e.toSJIS(this.data[i]);if(s>=33088&&s<=40956)s-=33088;else if(s>=57408&&s<=60351)s-=49472;else throw new Error("Invalid SJIS character: "+this.data[i]+`
Make sure your charset is UTF-8`);s=(s>>>8&255)*192+(s&255),r.put(s,13)}},eA=n,eA}var tA={exports:{}},AX;function nst(){return AX||(AX=1,(function(t){var e={single_source_shortest_paths:function(n,r,i){var s={},o={};o[r]=0;var a=e.PriorityQueue.make();a.push(r,0);for(var c,l,d,h,m,g,y,v,E;!a.empty();){c=a.pop(),l=c.value,h=c.cost,m=n[l]||{};for(d in m)m.hasOwnProperty(d)&&(g=m[d],y=h+g,v=o[d],E=typeof o[d]>"u",(E||v>y)&&(o[d]=y,a.push(d,y),s[d]=l))}if(typeof i<"u"&&typeof o[i]>"u"){var w=["Could not find a path from ",r," to ",i,"."].join("");throw new Error(w)}return s},extract_shortest_path_from_predecessor_list:function(n,r){for(var i=[],s=r;s;)i.push(s),n[s],s=n[s];return i.reverse(),i},find_path:function(n,r,i){var s=e.single_source_shortest_paths(n,r,i);return e.extract_shortest_path_from_predecessor_list(s,i)},PriorityQueue:{make:function(n){var r=e.PriorityQueue,i={},s;n=n||{};for(s in r)r.hasOwnProperty(s)&&(i[s]=r[s]);return i.queue=[],i.sorter=n.sorter||r.default_sorter,i},default_sorter:function(n,r){return n.cost-r.cost},push:function(n,r){var i={value:n,cost:r};this.queue.push(i),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};t.exports=e})(tA)),tA.exports}var LX;function rst(){return LX||(LX=1,(function(t){const e=_m(),n=Qit(),r=Zit(),i=est(),s=tst(),o=Fpe(),a=bm(),c=nst();function l(w){return unescape(encodeURIComponent(w)).length}function d(w,R,x){const C=[];let k;for(;(k=w.exec(x))!==null;)C.push({data:k[0],index:k.index,mode:R,length:k[0].length});return C}function h(w){const R=d(o.NUMERIC,e.NUMERIC,w),x=d(o.ALPHANUMERIC,e.ALPHANUMERIC,w);let C,k;return a.isKanjiModeEnabled()?(C=d(o.BYTE,e.BYTE,w),k=d(o.KANJI,e.KANJI,w)):(C=d(o.BYTE_KANJI,e.BYTE,w),k=[]),R.concat(x,C,k).sort(function(L,O){return L.index-O.index}).map(function(L){return{data:L.data,mode:L.mode,length:L.length}})}function m(w,R){switch(R){case e.NUMERIC:return n.getBitsLength(w);case e.ALPHANUMERIC:return r.getBitsLength(w);case e.KANJI:return s.getBitsLength(w);case e.BYTE:return i.getBitsLength(w)}}function g(w){return w.reduce(function(R,x){const C=R.length-1>=0?R[R.length-1]:null;return C&&C.mode===x.mode?(R[R.length-1].data+=x.data,R):(R.push(x),R)},[])}function y(w){const R=[];for(let x=0;x<w.length;x++){const C=w[x];switch(C.mode){case e.NUMERIC:R.push([C,{data:C.data,mode:e.ALPHANUMERIC,length:C.length},{data:C.data,mode:e.BYTE,length:C.length}]);break;case e.ALPHANUMERIC:R.push([C,{data:C.data,mode:e.BYTE,length:C.length}]);break;case e.KANJI:R.push([C,{data:C.data,mode:e.BYTE,length:l(C.data)}]);break;case e.BYTE:R.push([{data:C.data,mode:e.BYTE,length:l(C.data)}])}}return R}function v(w,R){const x={},C={start:{}};let k=["start"];for(let T=0;T<w.length;T++){const L=w[T],O=[];for(let P=0;P<L.length;P++){const D=L[P],j=""+T+P;O.push(j),x[j]={node:D,lastCount:0},C[j]={};for(let H=0;H<k.length;H++){const z=k[H];x[z]&&x[z].node.mode===D.mode?(C[z][j]=m(x[z].lastCount+D.length,D.mode)-m(x[z].lastCount,D.mode),x[z].lastCount+=D.length):(x[z]&&(x[z].lastCount=D.length),C[z][j]=m(D.length,D.mode)+4+e.getCharCountIndicator(D.mode,R))}}k=O}for(let T=0;T<k.length;T++)C[k[T]].end=0;return{map:C,table:x}}function E(w,R){let x;const C=e.getBestModeForData(w);if(x=e.from(R,C),x!==e.BYTE&&x.bit<C.bit)throw new Error('"'+w+'" cannot be encoded with mode '+e.toString(x)+`.
 Suggested mode is: `+e.toString(C));switch(x===e.KANJI&&!a.isKanjiModeEnabled()&&(x=e.BYTE),x){case e.NUMERIC:return new n(w);case e.ALPHANUMERIC:return new r(w);case e.KANJI:return new s(w);case e.BYTE:return new i(w)}}t.fromArray=function(R){return R.reduce(function(x,C){return typeof C=="string"?x.push(E(C,null)):C.data&&x.push(E(C.data,C.mode)),x},[])},t.fromString=function(R,x){const C=h(R,a.isKanjiModeEnabled()),k=y(C),T=v(k,x),L=c.find_path(T.map,"start","end"),O=[];for(let P=1;P<L.length-1;P++)O.push(T.table[L[P]].node);return t.fromArray(g(O))},t.rawSplit=function(R){return t.fromArray(h(R,a.isKanjiModeEnabled()))}})(X5)),X5}var MX;function ist(){if(MX)return U5;MX=1;const t=bm(),e=uN(),n=Hit(),r=qit(),i=Vit(),s=Kit(),o=Git(),a=Upe(),c=Yit(),l=Xit(),d=Jit(),h=_m(),m=rst();function g(T,L){const O=T.size,P=s.getPositions(L);for(let D=0;D<P.length;D++){const j=P[D][0],H=P[D][1];for(let z=-1;z<=7;z++)if(!(j+z<=-1||O<=j+z))for(let Y=-1;Y<=7;Y++)H+Y<=-1||O<=H+Y||(z>=0&&z<=6&&(Y===0||Y===6)||Y>=0&&Y<=6&&(z===0||z===6)||z>=2&&z<=4&&Y>=2&&Y<=4?T.set(j+z,H+Y,!0,!0):T.set(j+z,H+Y,!1,!0))}}function y(T){const L=T.size;for(let O=8;O<L-8;O++){const P=O%2===0;T.set(O,6,P,!0),T.set(6,O,P,!0)}}function v(T,L){const O=i.getPositions(L);for(let P=0;P<O.length;P++){const D=O[P][0],j=O[P][1];for(let H=-2;H<=2;H++)for(let z=-2;z<=2;z++)H===-2||H===2||z===-2||z===2||H===0&&z===0?T.set(D+H,j+z,!0,!0):T.set(D+H,j+z,!1,!0)}}function E(T,L){const O=T.size,P=l.getEncodedBits(L);let D,j,H;for(let z=0;z<18;z++)D=Math.floor(z/3),j=z%3+O-8-3,H=(P>>z&1)===1,T.set(D,j,H,!0),T.set(j,D,H,!0)}function w(T,L,O){const P=T.size,D=d.getEncodedBits(L,O);let j,H;for(j=0;j<15;j++)H=(D>>j&1)===1,j<6?T.set(j,8,H,!0):j<8?T.set(j+1,8,H,!0):T.set(P-15+j,8,H,!0),j<8?T.set(8,P-j-1,H,!0):j<9?T.set(8,15-j-1+1,H,!0):T.set(8,15-j-1,H,!0);T.set(P-8,8,1,!0)}function R(T,L){const O=T.size;let P=-1,D=O-1,j=7,H=0;for(let z=O-1;z>0;z-=2)for(z===6&&z--;;){for(let Y=0;Y<2;Y++)if(!T.isReserved(D,z-Y)){let W=!1;H<L.length&&(W=(L[H]>>>j&1)===1),T.set(D,z-Y,W),j--,j===-1&&(H++,j=7)}if(D+=P,D<0||O<=D){D-=P,P=-P;break}}}function x(T,L,O){const P=new n;O.forEach(function(Y){P.put(Y.mode.bit,4),P.put(Y.getLength(),h.getCharCountIndicator(Y.mode,T)),Y.write(P)});const D=t.getSymbolTotalCodewords(T),j=a.getTotalCodewordsCount(T,L),H=(D-j)*8;for(P.getLengthInBits()+4<=H&&P.put(0,4);P.getLengthInBits()%8!==0;)P.putBit(0);const z=(H-P.getLengthInBits())/8;for(let Y=0;Y<z;Y++)P.put(Y%2?17:236,8);return C(P,T,L)}function C(T,L,O){const P=t.getSymbolTotalCodewords(L),D=a.getTotalCodewordsCount(L,O),j=P-D,H=a.getBlocksCount(L,O),z=P%H,Y=H-z,W=Math.floor(P/H),F=Math.floor(j/H),$=F+1,V=W-F,G=new c(V);let Z=0;const q=new Array(H),J=new Array(H);let ue=0;const ge=new Uint8Array(T.buffer);for(let De=0;De<H;De++){const Je=De<Y?F:$;q[De]=ge.slice(Z,Z+Je),J[De]=G.encode(q[De]),Z+=Je,ue=Math.max(ue,Je)}const Re=new Uint8Array(P);let we=0,de,ke;for(de=0;de<ue;de++)for(ke=0;ke<H;ke++)de<q[ke].length&&(Re[we++]=q[ke][de]);for(de=0;de<V;de++)for(ke=0;ke<H;ke++)Re[we++]=J[ke][de];return Re}function k(T,L,O,P){let D;if(Array.isArray(T))D=m.fromArray(T);else if(typeof T=="string"){let W=L;if(!W){const F=m.rawSplit(T);W=l.getBestVersionForData(F,O)}D=m.fromString(T,W||40)}else throw new Error("Invalid data");const j=l.getBestVersionForData(D,O);if(!j)throw new Error("The amount of data is too big to be stored in a QR Code");if(!L)L=j;else if(L<j)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+j+`.
`);const H=x(L,O,D),z=t.getSymbolSize(L),Y=new r(z);return g(Y,L),y(Y),v(Y,L),w(Y,O,0),L>=7&&E(Y,L),R(Y,H),isNaN(P)&&(P=o.getBestMask(Y,w.bind(null,Y,O))),o.applyMask(P,Y),w(Y,O,P),{modules:Y,version:L,errorCorrectionLevel:O,maskPattern:P,segments:D}}return U5.create=function(L,O){if(typeof L>"u"||L==="")throw new Error("No input text");let P=e.M,D,j;return typeof O<"u"&&(P=e.from(O.errorCorrectionLevel,e.M),D=l.from(O.version),j=o.from(O.maskPattern),O.toSJISFunc&&t.setToSJISFunction(O.toSJISFunc)),k(L,D,P,j)},U5}var nA={},rA={},OX;function $pe(){return OX||(OX=1,(function(t){function e(n){if(typeof n=="number"&&(n=n.toString()),typeof n!="string")throw new Error("Color should be defined as hex string");let r=n.slice().replace("#","").split("");if(r.length<3||r.length===5||r.length>8)throw new Error("Invalid hex color: "+n);(r.length===3||r.length===4)&&(r=Array.prototype.concat.apply([],r.map(function(s){return[s,s]}))),r.length===6&&r.push("F","F");const i=parseInt(r.join(""),16);return{r:i>>24&255,g:i>>16&255,b:i>>8&255,a:i&255,hex:"#"+r.slice(0,6).join("")}}t.getOptions=function(r){r||(r={}),r.color||(r.color={});const i=typeof r.margin>"u"||r.margin===null||r.margin<0?4:r.margin,s=r.width&&r.width>=21?r.width:void 0,o=r.scale||4;return{width:s,scale:s?4:o,margin:i,color:{dark:e(r.color.dark||"#000000ff"),light:e(r.color.light||"#ffffffff")},type:r.type,rendererOpts:r.rendererOpts||{}}},t.getScale=function(r,i){return i.width&&i.width>=r+i.margin*2?i.width/(r+i.margin*2):i.scale},t.getImageWidth=function(r,i){const s=t.getScale(r,i);return Math.floor((r+i.margin*2)*s)},t.qrToImageData=function(r,i,s){const o=i.modules.size,a=i.modules.data,c=t.getScale(o,s),l=Math.floor((o+s.margin*2)*c),d=s.margin*c,h=[s.color.light,s.color.dark];for(let m=0;m<l;m++)for(let g=0;g<l;g++){let y=(m*l+g)*4,v=s.color.light;if(m>=d&&g>=d&&m<l-d&&g<l-d){const E=Math.floor((m-d)/c),w=Math.floor((g-d)/c);v=h[a[E*o+w]?1:0]}r[y++]=v.r,r[y++]=v.g,r[y++]=v.b,r[y]=v.a}}})(rA)),rA}var PX;function sst(){return PX||(PX=1,(function(t){const e=$pe();function n(i,s,o){i.clearRect(0,0,s.width,s.height),s.style||(s.style={}),s.height=o,s.width=o,s.style.height=o+"px",s.style.width=o+"px"}function r(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}t.render=function(s,o,a){let c=a,l=o;typeof c>"u"&&(!o||!o.getContext)&&(c=o,o=void 0),o||(l=r()),c=e.getOptions(c);const d=e.getImageWidth(s.modules.size,c),h=l.getContext("2d"),m=h.createImageData(d,d);return e.qrToImageData(m.data,s,c),n(h,l,d),h.putImageData(m,0,0),l},t.renderToDataURL=function(s,o,a){let c=a;typeof c>"u"&&(!o||!o.getContext)&&(c=o,o=void 0),c||(c={});const l=t.render(s,o,c),d=c.type||"image/png",h=c.rendererOpts||{};return l.toDataURL(d,h.quality)}})(nA)),nA}var iA={},DX;function ost(){if(DX)return iA;DX=1;const t=$pe();function e(i,s){const o=i.a/255,a=s+'="'+i.hex+'"';return o<1?a+" "+s+'-opacity="'+o.toFixed(2).slice(1)+'"':a}function n(i,s,o){let a=i+s;return typeof o<"u"&&(a+=" "+o),a}function r(i,s,o){let a="",c=0,l=!1,d=0;for(let h=0;h<i.length;h++){const m=Math.floor(h%s),g=Math.floor(h/s);!m&&!l&&(l=!0),i[h]?(d++,h>0&&m>0&&i[h-1]||(a+=l?n("M",m+o,.5+g+o):n("m",c,0),c=0,l=!1),m+1<s&&i[h+1]||(a+=n("h",d),d=0)):c++}return a}return iA.render=function(s,o,a){const c=t.getOptions(o),l=s.modules.size,d=s.modules.data,h=l+c.margin*2,m=c.color.light.a?"<path "+e(c.color.light,"fill")+' d="M0 0h'+h+"v"+h+'H0z"/>':"",g="<path "+e(c.color.dark,"stroke")+' d="'+r(d,l,c.margin)+'"/>',y='viewBox="0 0 '+h+" "+h+'"',E='<svg xmlns="http://www.w3.org/2000/svg" '+(c.width?'width="'+c.width+'" height="'+c.width+'" ':"")+y+' shape-rendering="crispEdges">'+m+g+`</svg>
`;return typeof a=="function"&&a(null,E),E},iA}var NX;function ast(){if(NX)return Rg;NX=1;const t=Bit(),e=ist(),n=sst(),r=ost();function i(s,o,a,c,l){const d=[].slice.call(arguments,1),h=d.length,m=typeof d[h-1]=="function";if(!m&&!t())throw new Error("Callback required as last argument");if(m){if(h<2)throw new Error("Too few arguments provided");h===2?(l=a,a=o,o=c=void 0):h===3&&(o.getContext&&typeof l>"u"?(l=c,c=void 0):(l=c,c=a,a=o,o=void 0))}else{if(h<1)throw new Error("Too few arguments provided");return h===1?(a=o,o=c=void 0):h===2&&!o.getContext&&(c=a,a=o,o=void 0),new Promise(function(g,y){try{const v=e.create(a,c);g(s(v,o,c))}catch(v){y(v)}})}try{const g=e.create(a,c);l(null,s(g,o,c))}catch(g){l(g)}}return Rg.create=e.create,Rg.toCanvas=i.bind(null,n.render),Rg.toDataURL=i.bind(null,n.renderToDataURL),Rg.toString=i.bind(null,function(s,o,a){return r.render(s,a)}),Rg}var cst=ast();const lst="_qrCode_h54ia_8",ust={qrCode:lst},dst=({data:t,className:e})=>{const[n,r]=_.useState(null);return _.useEffect(()=>{let i=!1;return cst.toDataURL(t,{errorCorrectionLevel:"L"}).then(s=>{i||r(s)}).catch(s=>{i||r(null)}),()=>{i=!0}},[t]),S.jsx("div",{className:Le(ust.qrCode,e),children:n&&S.jsx("img",{src:n,alt:$i("qr_code")})})},fst=({room:t,open:e,onDismiss:n})=>{const{t:r}=et(),i=g4(t.roomId),s=_.useMemo(()=>Dfe(t.roomId,i,t.name),[i,t.name,t.roomId]),[o,a]=_.useState(!1),c=_.useCallback(()=>a(!1),[a]),l=_.useCallback(d=>{d.stopPropagation(),Uit(s),n(),a(!0)},[s,n]);return S.jsxs(S.Fragment,{children:[S.jsxs(mm,{title:r("invite_modal.title"),open:e,onDismiss:n,children:[S.jsx(dst,{className:D5.qrCode,data:s}),S.jsx(an,{className:D5.url,size:"sm",weight:"semibold",children:s}),S.jsx(qt,{className:D5.button,Icon:VDe,onClick:l,"data-testid":"modal_inviteLink",children:r("action.copy_link")})]}),S.jsx(Dpe,{open:o,onDismiss:c,autoDismiss:2e3,Icon:D8,children:r("invite_modal.link_copied_toast")})]})},hst=({error:t,recoveryActionHandler:e,widget:n})=>{const{t:r}=et();N.error("Error boundary caught:",t);let i;switch(t.category){case mC.CONFIGURATION_ISSUE:i=qDe;break;case mC.NETWORK_CONNECTIVITY:i=WDe;break;case mC.CLIENT_CONFIGURATION:i=dNe;break;default:i=z_}const s=[];return t instanceof cpe&&s.push({label:r("call_ended_view.reconnect_button"),onClick:()=>{e("reconnect")}}),S.jsx(dv,{children:S.jsxs(f_,{Icon:i,title:t.localisedTitle,rageshake:t.code==ape.UNKNOWN_ERROR,widget:n,children:[S.jsx("p",{children:t.localisedMessage??S.jsx(mo,{i18nKey:"error.unexpected_ec_error",components:[S.jsx("b",{}),S.jsx("code",{})],values:{errorCode:t.code}})}),s&&s.map((o,a)=>S.jsx(qt,{kind:"secondary",onClick:o.onClick,children:o.label},`action${a}`))]})})},pst=({recoveryActionHandler:t,onError:e,children:n,widget:r})=>{const i=_.useCallback(({error:s,resetError:o})=>{const a=s instanceof ji?s:new Wp(s instanceof Error?s:new Error);return S.jsx(hst,{widget:r??null,error:a,resetError:o,recoveryActionHandler:async c=>{await t(c),o()}})},[t,r]);return S.jsx(eR,{fallback:i,onError:s=>e?.(s),children:n})},mst=8,gst=({client:t,isPasswordlessUser:e,confineToRoom:n,preload:r,skipLobby:i,header:s,rtcSession:o,joined:a,setJoined:c,muteStates:l,widget:d})=>{const[h,m]=_.useState(null),g=wce(o),y=Fe(Ppe),v=zp(A4({sounds:Ope,latencyHint:"interactive",muted:y}));_.useEffect(()=>{g.length>=mst&&l.audio.setEnabled$.value?.(!1)},[]),_.useEffect(()=>(N.info("[Lifecycle] GroupCallView Component mounted"),()=>{N.info("[Lifecycle] GroupCallView Component unmounted")}),[]),_.useEffect(()=>(document.body.classList.add("no-scroll-body"),()=>{document.body.classList.remove("no-scroll-body")}),[]),_.useEffect(()=>(window.rtcSession=o,()=>{delete window.rtcSession}),[o]),bBe(o,Ji.MembershipManagerError,de=>m(new cpe)),_.useEffect(()=>{t.getRoom(o.room.roomId)!==o.room&&N.warn(`We've ended up with multiple rooms for the same ID (${o.room.roomId}). This indicates a bug in the group call loading code, and may lead to incomplete room state.`)},[t,o.room]);const E=o.room,{displayName:w,avatarUrl:R}=hS(t),x=Mit(E),C=Lit(E),{perParticipantE2EE:k,returnToLobby:T,password:L}=nc(),O=g4(E.roomId);_.useEffect(()=>{L&&Afe(E.roomId,L)},[L,E.roomId]),wS(x),vit(x);const P=_.useMemo(()=>({userId:t.getUserId(),displayName:w,avatarUrl:R,roomId:E.roomId,roomName:x,roomAlias:E.getCanonicalAlias(),roomAvatar:C,e2eeSystem:O}),[t,w,R,x,E,C,O]),D=_.useMemo(()=>new Set(g.map(de=>de.userId)).size,[g]),j=vm(),H=zp(l),z=_.useCallback(async de=>{try{c(!0)}catch(ke){if(ke instanceof ji)m(ke);else{N.error("Unknown Error while entering RTC session",ke);const De=new Wp(ke instanceof Error?ke:new Error("Unknown error",{cause:ke}));m(De)}}return Promise.resolve()},[c]);_.useEffect(()=>{const de=async({audioInput:ke,videoInput:De})=>{const Je=await td.getLocalDevices(void 0,!0);if(ke){const vt=pY(ke,"audioinput",Je);vt?(N.debug(`Found audio input ID ${vt} for name ${ke}`),j.audioInput.select(vt)):(N.warn("Unknown audio input: "+ke),H.current.audio.setEnabled$.value?.(!1))}if(De){const vt=pY(De,"videoinput",Je);vt?(N.debug(`Found video input ID ${vt} for name ${De}`),j.videoInput.select(vt)):(N.warn("Unknown video input: "+De),H.current.video.setEnabled$.value?.(!1))}};if(i)if(d&&r){const ke=De=>{(async()=>{await de(De.detail.data),c(!0),d.api.transport.reply(De.detail,{})})().catch(Je=>{N.error("Error joining RTC session on preload",Je)})};return d.lazyActions.on(kl.JoinCall,ke),()=>{d.lazyActions.off(kl.JoinCall,ke)}}else c(!0)},[d,o,r,i,k,j,H,c]);const[Y,W]=_.useState(!1),F=Fl(),$=_.useCallback(de=>{let ke="left";(de==="timeout"||de==="decline")&&(ke=de),c(!1),W(!0);const De=v.current?.playSound(ke),Je=new Promise(vt=>{const Sr=d!==null;en.instance.eventCallEnded.track(E.roomId,o.memberships.length,Sr,o),window.setTimeout(vt,10)});Promise.all([De,Je]).catch(vt=>N.error("Failed to play leave audio and/or send PostHog leave event",vt)).then(async()=>{if(!e&&!n&&!en.instance.isEnabled()&&F("/"),d){try{await d.api.setAlwaysOnScreen(!1)}catch(vt){N.error("Failed to set call widget `alwaysOnScreen` to false",vt)}if(de!="error"&&!ur().returnToLobby){try{await d.api.transport.send(kl.Close,{})}catch(vt){N.error("Failed to send close action",vt)}d.api.transport.stop()}}})},[c,v,d,E.roomId,o,e,n,F]);_.useEffect(()=>{d&&a&&d.api.setAlwaysOnScreen(!0).catch(de=>{N.error("Error calling setAlwaysOnScreen(true)",de)})},[d,a,o]);const V=Oit(E),[G,Z]=_.useState(!1),q=_.useCallback(()=>Z(!1),[Z]),J=_.useCallback(()=>Z(!0),[Z]),ue=V===xf.Public?J:null;if(!hee()&&O.kind!==qn.NONE)throw new dtt;const ge=S.jsx(fst,{room:E,open:G,onDismiss:q}),Re=S.jsxs(S.Fragment,{children:[ge,S.jsx(yhe,{client:t,matrixInfo:P,muteStates:l,onEnter:()=>c(!0),confineToRoom:n,hideHeader:s===l_.None,participantCount:D,onShareClick:ue})]});let we;if(h){const de=()=>{throw h};we=S.jsx(de,{})}else a?we=S.jsxs(S.Fragment,{children:[ge,S.jsx(xit,{client:t,matrixInfo:P,rtcSession:o,matrixRoom:E,onLeft:$,header:s,muteStates:l,e2eeSystem:O,onShareClick:ue})]}):Y&&d===null?e||en.instance.isEnabled()&&d===null?we=S.jsx(HQe,{endedCallId:o.room.roomId,client:t,isPasswordlessUser:e,hideHeader:s===l_.None,confineToRoom:n}):we=null:Y&&d!==null?we=T?Re:null:r||i?we=null:we=Re;return S.jsx(pst,{widget:d,recoveryActionHandler:async de=>{m(null),de=="reconnect"&&(W(!1),await z(o).catch(ke=>{N.error("Error re-entering RTC session",ke)}))},onError:()=>{o.isJoined()&&$("error")},children:we})},vst="_modal_1tnec_8",yst={modal:vst},bst=({roomId:t})=>{const{t:e}=et(),[n,r]=_.useState(!0),i=_.useCallback(a=>{a.preventDefault(),a.stopPropagation(),r(!1)},[r]),s=g4(t);s.kind===qn.NONE&&N.error("Generating app redirect URL for encrypted room but don't have key available!");const o=_.useMemo(()=>{const a=new URL(t===null?window.location.href:Dfe(t,s));a.hash=q$e(a.hash,l=>(l.set("appPrompt","false"),l.set("confineToRoom","true"),l));const c=new URL("io.element.call:/");return c.searchParams.set("url",a.toString()),c.toString()},[s,t]);return S.jsxs(mm,{className:yst.modal,title:e("app_selection_modal.title"),open:n,children:[S.jsx(an,{size:"md",weight:"semibold",children:e("app_selection_modal.text")}),S.jsx(qt,{kind:"secondary",onClick:i,children:e("app_selection_modal.continue_in_browser")}),S.jsx(qt,{as:"a",href:o,Icon:j8,children:e("app_selection_modal.open_in_app")})]})},_st=3,Sst=3e3;async function Bpe(t,e=0,...n){try{return await t.joinRoom(...n)}catch(r){if(r instanceof In&&r.errcode==="M_FORBIDDEN"&&e<_st)return await new Promise(i=>setTimeout(i,Sst)),Bpe(t,e+1,...n);throw r}}class yC extends Error{constructor(e,n,r,i){super(n),this.icon=e,this.messageBody=r,this.reason=i}}const wst=(t,e,n)=>{const[r,i]=_.useState({kind:"loading"}),s=_.useRef(void 0),{t:o}=et(),a=_.useCallback(()=>new yC(FDe,o("group_call_loader.banned_heading"),o("group_call_loader.banned_body"),d()),[o]),c=_.useCallback(()=>new yC(W_,o("group_call_loader.knock_reject_heading"),o("group_call_loader.knock_reject_body"),d()),[o]),l=_.useCallback(()=>new yC(uae,o("group_call_loader.call_ended_heading"),o("group_call_loader.call_ended_body"),d()),[o]),d=()=>s.current?.currentState.getStateEvents(ee.RoomMember,s.current?.myUserId)?.getContent().reason;return _.useEffect(()=>{if(!t||!e)return;const h=async w=>{let R=null;const x=await t.getRoomIdForAlias(w.toLowerCase());return N.info(`${w} resolved to ${x.room_id}`),R=t.getRoom(x.room_id),R?N.info(`Already in room ${x.room_id}, not rejoining.`):(N.info(`Room ${x.room_id} not found, joining.`),R=await t.joinRoom(x.room_id,{viaServers:x.servers})),R},m=async(w,R,x)=>(await t.knockRoom(w,{viaServers:R}),x(),await new Promise((C,k)=>{t.on(Me.MyMembership,(T,L,O)=>{w===T.roomId&&(s.current=T,L===Ke.Invite&&O===Ke.Knock&&Bpe(t,0,T.roomId,{viaServers:R}).then(P=>{N.log("Auto-joined %s",P.roomId),C(P)},k),L===Ke.Ban&&k(a()),L===Ke.Leave&&k(c()))})})),g=async()=>{let w=null;if(e[0]==="#")w=await h(e),s.current=w;else{const R=e;w=t.getRoom(R),s.current=w??void 0;const x=w?.getMyMembership();if(x===Ke.Join)return w;if(Et)throw new Error("Room not found. The widget-api did not pass over the relevant room events/information.");if(x===Ke.Ban)throw a();if(x===Ke.Invite)w=await t.joinRoom(R,{viaServers:n});else{let C;try{C=await t.getRoomSummary(R,n)}catch(k){N.warn("Could not load room summary to decide whether we want to join or knock.\n              EC will fallback to join as if this would be a public room.\n              Reach out to your homeserver admin to ask them about supporting the `/summary` endpoint (im.nheko.summary):",k)}if(C===void 0||C.join_rule===xf.Public)w=await t.joinRoom(R,{viaServers:n});else if(C.join_rule===xf.Knock){const k=C;let T=()=>{};const L=new Promise(O=>{k.membership!==Ke.Knock?T=O:O()});i({kind:"canKnock",roomSummary:k,knock:T}),await L,w=await m(C.room_id,n,()=>i({kind:"waitForInvite",roomSummary:k}))}else throw new Error(`Room ${C.room_id} is not joinable. This likely means, that the conference owner has changed the room settings to private.`)}}return N.info(`Joined ${e}, waiting room to be ready for group calls`),await t.waitUntilRoomReadyForGroupCalls(w.roomId),N.info(`${e}, is ready for group calls`),w},y=async()=>{const w=await g();return s.current=w,N.debug(`Fetched / joined room ${e}`),t.matrixRTC.getRoomSession(w)},v=async()=>{t.getSyncState()!==Qt.Syncing&&(N.debug("useLoadGroupCall: waiting for client to start syncing..."),await new Promise(w=>{const R=()=>{if(t.getSyncState()===Qt.Syncing)return t.off(Pe.Sync,R),w()};t.on(Pe.Sync,R)}),N.debug("useLoadGroupCall: client is now syncing."))},E=async()=>{await new Promise((w,R)=>{t.on(Me.MyMembership,(x,C)=>{C===Ke.Leave&&R(l()),C===Ke.Ban&&R(a())})})};r.kind==="loading"&&(N.log("Start loading group call"),v().then(y).then(w=>i({kind:"loaded",rtcSession:w})).then(E).catch(w=>i({kind:"failed",error:w})))},[a,t,c,l,e,r,o,n]),r},sA=async t=>Promise.resolve(t);class UX{constructor(e,n,r,i){this.scope=e,this.device=n,this.enabledByDefault=r,this.forceMute$=i,this.handler$=new mr(sA),this.canControlDevices$=ot([this.device.available$,this.forceMute$]).pipe(ve(([s,o])=>!o&&s.size>0)),this.data$=this.scope.behavior(this.canControlDevices$.pipe(fo(),ve(s=>{if(N.info(`MuteState: canControlDevices: ${s}, enabled by default: ${this.enabledByDefault}`),!s)return N.info(`MuteState: devices connected: ${s}, disabling`),this.handler$.value(!1).catch(h=>{N.error("MuteState-disable: handler error",h)}),{enabled$:mt(!1),set:null,toggle:null};let o=this.enabledByDefault;const a=new Ar,c=new Ar,l=Xu(a,c.pipe(ve(()=>!o))),d=new nr(h=>{h.next(o);let m=this.enabledByDefault,g=!1;const y=async()=>{if(o===m)g=!1;else{const E=o;o=await zVe(this.handler$.pipe(gt(async w=>w(m)))),o===E?g=!1:(h.next(o),g=!0,y().catch(w=>{N.error("MuteState: handler error",w)}))}},v=l.subscribe(E=>{m=E,g===!1&&(g=!0,y().catch(w=>{N.error("MuteState: handler error",w)}))});return()=>v.unsubscribe()});return{set:h=>a.next(h),toggle:()=>c.next(),enabled$:d}}))),this.enabled$=this.scope.behavior(this.data$.pipe(gt(({enabled$:s})=>s))),this.setEnabled$=this.scope.behavior(this.data$.pipe(ve(({set:s})=>s))),this.toggle$=this.scope.behavior(this.data$.pipe(ve(({toggle:s})=>s)))}setHandler(e){if(this.handler$.value!==sA)throw new Error("Multiple mute state handlers are not supported");this.handler$.next(e)}unsetHandler(){this.handler$.next(sA)}}class Est{constructor(e,n,r){if(this.scope=e,this.mediaDevices=n,this.initialMuteState=r,this.isEarpiece$=ot([this.mediaDevices.audioOutput.available$,this.mediaDevices.audioOutput.selected$]).pipe(ve(([i,s])=>{if(!s?.id)return!1;const o=i.get(s.id);return N.info("MuteStates: selected audio output device:",o),o?.type==="earpiece"})),this.audio=new UX(this.scope,this.mediaDevices.audioInput,this.initialMuteState.audioEnabled,FR(!1)),this.video=new UX(this.scope,this.mediaDevices.videoInput,this.initialMuteState.videoEnabled,this.isEarpiece$),Et!==null){const i=ot([this.audio.enabled$,this.video.enabled$],(o,a)=>({audio_enabled:o,video_enabled:a}));i.pipe(this.scope.bind()).subscribe(o=>{Et.api.transport.send(kl.DeviceMute,o).catch(a=>N.warn("Could not send DeviceMute action to widget",a))}),ms(Et.lazyActions,kl.DeviceMute).pipe(Nle(i,this.audio.setEnabled$,this.video.setEnabled$),this.scope.bind()).subscribe(([o,a,c,l])=>{const d={...a};o.detail.data.audio_enabled!=null&&typeof o.detail.data.audio_enabled=="boolean"&&c!==null&&(d.audio_enabled=o.detail.data.audio_enabled,c(d.audio_enabled)),o.detail.data.video_enabled!=null&&typeof o.detail.data.video_enabled=="boolean"&&l!==null&&(d.video_enabled=o.detail.data.video_enabled,l(d.video_enabled)),Et.api.transport.reply(o.detail,d)})}}}function Cst(t,e,n){return N.debug(`calculateInitialMuteState: skipLobby=${t}, callIntent=${e} isWidgetMode=${n}`),t&&!n?{audioEnabled:!1,videoEnabled:!1}:{audioEnabled:!0,videoEnabled:e!="audio"}}const Tst=()=>{const t=nc(),{confineToRoom:e,appPrompt:n,preload:r,header:i,displayName:s,skipLobby:o}=t,{t:a}=et(),{roomAlias:c,roomId:l,viaServers:d}=G$e(),h=l??c;h||N.error("No room specified");const{registerPasswordlessUser:m}=$fe(),[g,y]=_.useState(!1),{loading:v,authenticated:E,client:w,error:R,passwordlessUser:x}=S9(),{avatarUrl:C,displayName:k}=hS(w),T=wst(w,h,d),[L,O]=_.useState(!1),P=vm(),[D,j]=_.useState(null);_.useEffect(()=>{const $=new pS;return j(new Est($,P,Cst(t.skipLobby,t.callIntent,Et!==null))),()=>$.end()},[P,t]),_.useEffect(()=>{!v&&!E&&s&&!Et&&(y(!0),m(s).catch($=>{N.error("Failed to register passwordless user",$)}).finally(()=>{y(!1)}))},[v,E,s,y,m]);const[H,z]=NR();_.useEffect(()=>{H===null&&z&&z(!0)},[H,z]);const Y=_.useRef(!1);_.useEffect(()=>{T.kind==="loaded"&&Y.current&&N.log("Play join sound 'Not yet implemented'")},[T.kind]);const W=()=>{switch(T.kind){case"loaded":return D&&S.jsx(gst,{widget:Et,client:w,rtcSession:T.rtcSession,joined:L,setJoined:O,isPasswordlessUser:x,confineToRoom:e,preload:r,skipLobby:o||Y.current,header:i,muteStates:D});case"waitForInvite":case"canKnock":{Y.current=Y.current||T.kind==="waitForInvite";const $=T.kind==="canKnock"?T.knock:null,V=T.kind==="canKnock"?a("lobby.ask_to_join"):S.jsxs(S.Fragment,{children:[a("lobby.waiting_for_invite"),S.jsx(D8,{})]});return D&&S.jsx(yhe,{client:w,matrixInfo:{userId:w.getUserId()??"",displayName:k??"",avatarUrl:C??"",roomAlias:null,roomId:T.roomSummary.room_id,roomName:T.roomSummary.name??"",roomAvatar:T.roomSummary.avatar_url??null,e2eeSystem:{kind:T.roomSummary["im.nheko.summary.encryption"]?qn.PER_PARTICIPANT:qn.NONE}},onEnter:()=>$?.(),enterLabel:V,waitingForInvite:T.kind==="waitForInvite",confineToRoom:e,hideHeader:i!=="standard",participantCount:null,muteStates:D,onShareClick:null})}case"loading":return S.jsx(dv,{children:S.jsx("h1",{children:a("common.loading")})});case"failed":return Y.current=!1,T.error.errcode==="M_NOT_FOUND"?S.jsx(dv,{children:S.jsx(f_,{Icon:nNe,title:a("error.call_not_found"),widget:Et,children:S.jsx(mo,{i18nKey:"error.call_not_found_description",children:S.jsxs("p",{children:["That link doesn't appear to belong to any existing call. Check that you have the right link, or"," ",S.jsx(Ll,{to:"/",children:"create a new one"}),"."]})})})}):T.error instanceof yC?S.jsx(dv,{children:S.jsxs(f_,{Icon:T.error.icon,title:T.error.message,widget:Et,children:[S.jsx("p",{children:T.error.messageBody}),T.error.reason&&S.jsx("p",{children:a("group_call_loader.reason",{reason:T.error.reason})})]})}):S.jsx(h_,{widget:Et,error:T.error});default:return S.jsx(S.Fragment,{children:" "})}};let F;return v||g?F=S.jsx(AR,{}):R?F=S.jsx(h_,{widget:Et,error:R}):w?h?F=W():F=S.jsx(jfe,{}):F=S.jsx(TXe,{}),S.jsxs(S.Fragment,{children:[F,n&&yn.get().app_prompt&&(Dc==="android"||Dc==="ios")&&l&&S.jsx(bst,{roomId:l})]})},Rst="data:application/json;base64,ewogICJhMTF5IjogewogICAgInVzZXJfbWVudSI6ICLQn9C+0YLRgNC10LHQuNGC0LXQu9GB0LrQviDQvNC10L3RjiIKICB9LAogICJhY3Rpb24iOiB7CiAgICAiY2xvc2UiOiAi0JfQsNGC0LLQvtGA0LgiLAogICAgImNvcHlfbGluayI6ICLQmtC+0L/QuNGA0LDQvdC1INC90LAg0LLRgNGK0LfQutCw0YLQsCIsCiAgICAiZ28iOiAi0J3QsNC/0YDQtdC0IiwKICAgICJpbnZpdGUiOiAi0J/QvtC60LDQvdCwIiwKICAgICJubyI6ICLQndC1IiwKICAgICJyZWdpc3RlciI6ICLQoNC10LPQuNGB0YLRgNCw0YbQuNGPIiwKICAgICJyZW1vdmUiOiAi0J/RgNC10LzQsNGF0L3QuCIsCiAgICAic2lnbl9pbiI6ICLQktC70LXQtyIsCiAgICAic2lnbl9vdXQiOiAi0JjQt9C70LXQtyIKICB9LAogICJjYWxsX2VuZGVkX3ZpZXciOiB7CiAgICAiY3JlYXRlX2FjY291bnRfYnV0dG9uIjogItCh0YrQt9C00LDQuSDQsNC60LDRg9C90YIiLAogICAgImNyZWF0ZV9hY2NvdW50X3Byb21wdCI6ICI8MD7Ql9Cw0YnQviDQvdC1INC90LDRgdGC0YDQvtC50YLQtSDQv9Cw0YDQvtC70LAg0LfQsCDQtNCwINC30LDQv9Cw0LfQuNGC0LUg0LDQutCw0YPQvdGC0LAg0YHQuD88LzA+PDE+0KnQtSDQvNC+0LbQtdGC0LUg0LTQsCDQt9Cw0L/QsNC30LjRgtC1INC40LzQtdGC0L4g0Lgg0LDQstCw0YLQsNGA0LAg0YHQuCDQt9CwINCx0YrQtNC10YnQuCDRgNCw0LfQs9C+0LLQvtGA0Lg8LzE+IiwKICAgICJub3Rfbm93X2J1dHRvbiI6ICLQndC1INGB0LXQs9CwLCDQstGK0YDQvdC4INGB0LUg0L3QsCDQvdCw0YfQsNC70L3QuNGPINC10LrRgNCw0L0iCiAgfSwKICAiY29tbW9uIjogewogICAgImF1ZGlvIjogItCX0LLRg9C6IiwKICAgICJhdmF0YXIiOiAi0JDQstCw0YLQsNGAIiwKICAgICJkaXNwbGF5X25hbWUiOiAi0JjQvNC1L9C/0YHQtdCy0LTQvtC90LjQvCIsCiAgICAiaG9tZSI6ICLQndCw0YfQsNC70L4iLAogICAgImxvYWRpbmciOiAi0JfQsNGA0LXQttC00LDQvdC14oCmIiwKICAgICJwYXNzd29yZCI6ICLQn9Cw0YDQvtC70LAiLAogICAgInByb2ZpbGUiOiAi0J/RgNC+0YTQuNC7IiwKICAgICJzZXR0aW5ncyI6ICLQndCw0YHRgtGA0L7QudC60LgiLAogICAgInVzZXJuYW1lIjogItCf0L7RgtGA0LXQsdC40YLQtdC70YHQutC+INC40LzQtSIsCiAgICAidmlkZW8iOiAi0JLQuNC00LXQviIKICB9LAogICJqb2luX2V4aXN0aW5nX2NhbGxfbW9kYWwiOiB7CiAgICAiam9pbl9idXR0b24iOiAi0JTQsCwg0L/RgNC40YHRitC10LTQuNC90Lgg0YHQtSIsCiAgICAidGV4dCI6ICLQotC+0LfQuCDRgNCw0LfQs9C+0LLQvtGAINCy0LXRh9C1INGB0YrRidC10YHRgtCy0YPQstCwLCDQuNGB0LrQsNGC0LUg0LvQuCDQtNCwINGB0LUg0L/RgNC40YHRitC10LTQuNC90LjRgtC1PyIsCiAgICAidGl0bGUiOiAi0J/RgNC40YHRitC10LTQuNC90Y/QstCw0L3QtSDQutGK0Lwg0YHRitGJ0LXRgdGC0LLRg9Cy0LDRiSDRgNCw0LfQs9C+0LLQvtGAPyIKICB9LAogICJsYXlvdXRfc3BvdGxpZ2h0X2xhYmVsIjogItCf0YDQvtC20LXQutGC0L7RgCIsCiAgImxvYmJ5IjogewogICAgImpvaW5fYnV0dG9uIjogItCS0LvQtdC3INCyINGA0LDQt9Cz0L7QstC+0YDQsCIKICB9LAogICJsb2dnaW5nX2luIjogItCS0LvQuNC30LDQvdC14oCmIiwKICAibG9naW5fYXV0aF9saW5rcyI6ICI8MD7QodGK0LfQtNCw0LnRgtC1INCw0LrQsNGD0L3RgjwvMD4g0LjQu9C4IDwyPtCS0LvQtdC30YLQtSDQutCw0YLQviDQs9C+0YHRgjwvMj4iLAogICJsb2dpbl90aXRsZSI6ICLQktC70LXQtyIsCiAgInJhZ2VzaGFrZV9yZXF1ZXN0X21vZGFsIjogewogICAgImJvZHkiOiAi0JTRgNGD0LMg0L/QvtGC0YDQtdCx0LjRgtC10Lsg0LIg0YLQvtC30Lgg0YDQsNC30LPQvtCy0L7RgCDQuNC80LAg0L/RgNC+0LHQu9C10LwuINCX0LAg0LTQsCDQtNC40LDQs9C90L7RgdGC0LjRhtC40YDQsNC80LUg0YLQvtC30Lgg0L/RgNC+0LHQu9C10Lwg0L/Qvi3QtNC+0LHRgNC1INC90Lgg0YHQtSDQuNGB0LrQsCDQtNCwINGB0YrQsdC10YDQtdC8IGRlYnVnINC70L7Qs9C+0LLQtS4iLAogICAgInRpdGxlIjogItCX0LDRj9Cy0LrQsCDQt9CwIGRlYnVnINC70L7Qs9C+0LLQtSIKICB9LAogICJyYWdlc2hha2Vfc2VuZF9sb2dzIjogItCY0LfQv9GA0LDRgtC10YLQtSBkZWJ1ZyDQu9C+0LPQvtCy0LUiLAogICJyYWdlc2hha2Vfc2VuZGluZyI6ICLQmNC30L/RgNCw0YnQsNC90LXigKYiLAogICJyZWNhcHRjaGFfZGlzbWlzc2VkIjogIlJlY2FwdGNoYSDQvtGC0YXQstGK0YDQu9C10L3QsCIsCiAgInJlY2FwdGNoYV9ub3RfbG9hZGVkIjogIlJlY2FwdGNoYSDQvdC1INC1INC30LDRgNC10LTQtdC90LAiLAogICJyZWdpc3RlciI6IHsKICAgICJwYXNzd29yZHNfbXVzdF9tYXRjaCI6ICLQn9Cw0YDQvtC70LjRgtC1INC90LUg0YHRitCy0L/QsNC00LDRgiIsCiAgICAicmVnaXN0ZXJpbmciOiAi0KDQtdCz0LjRgdGC0YDQuNGA0LDQvdC14oCmIgogIH0sCiAgInJlZ2lzdGVyX2F1dGhfbGlua3MiOiAiPDA+0JLQtdGH0LUg0LjQvNCw0YLQtSDQsNC60LDRg9C90YI/PC8wPjwxPjwwPtCS0LvQtdC30YLQtSDRgSDQvdC10LPQvjwvMD4g0LjQu9C4IDwyPtCS0LvQtdC30YLQtSDQutCw0YLQviDQs9C+0YHRgjwvMj48LzE+IiwKICAicmVnaXN0ZXJfY29uZmlybV9wYXNzd29yZF9sYWJlbCI6ICLQn9C+0YLQstGK0YDQtNC4INC/0LDRgNC+0LvQsNGC0LAiLAogICJyZXR1cm5faG9tZV9idXR0b24iOiAi0JLRgNGK0YnQsNC90LUg0L3QsCDQvdCw0YfQsNC70L3QuNGPINC10LrRgNCw0L0iLAogICJzY3JlZW5zaGFyZV9idXR0b25fbGFiZWwiOiAi0KHQv9C+0LTQtdC70Lgg0LXQutGA0LDQvdCwIiwKICAic2V0dGluZ3MiOiB7CiAgICAiZGV2ZWxvcGVyX3RhYl90aXRsZSI6ICLQoNCw0LfRgNCw0LHQvtGC0YfQuNC6IiwKICAgICJmZWVkYmFja190YWJfaDQiOiAi0JjQt9C/0YDQsNGC0Lgg0L7QsdGA0LDRgtC90LAg0LLRgNGK0LfQutCwIiwKICAgICJmZWVkYmFja190YWJfc2VuZF9sb2dzX2xhYmVsIjogItCS0LrQu9GO0YfQuCBkZWJ1ZyDQu9C+0LPQvtCy0LUiCiAgfSwKICAidW5hdXRoZW50aWNhdGVkX3ZpZXdfYm9keSI6ICLQktGB0LUg0L7RidC1INC90LUg0YHRgtC1INGA0LXQs9C40YHRgtGA0LjRgNCw0L3QuD8gPDI+0KHRitC30LTQsNC50YLQtSDQsNC60LDRg9C90YI8LzI+IiwKICAidW5hdXRoZW50aWNhdGVkX3ZpZXdfbG9naW5fYnV0dG9uIjogItCS0LvQtdC30YLQtSDQsiDQsNC60LDRg9C90YLQsCDRgdC4IiwKICAidmVyc2lvbiI6ICLQktC10YDRgdC40Y86IHt7dmVyc2lvbn19Igp9Cg==",kst=""+new URL("cs-app-Du_5mVg3.json",import.meta.url).href,Ist=""+new URL("da-app-BBz-lePm.json",import.meta.url).href,xst=""+new URL("de-app-DjOuqT-j.json",import.meta.url).href,Ast=""+new URL("el-app-BBr3LLTK.json",import.meta.url).href,Lst=""+new URL("en-app-B0mg0RDM.json",import.meta.url).href,Mst=""+new URL("es-app-Q3c7lmEj.json",import.meta.url).href,Ost=""+new URL("et-app-DLvuR7m2.json",import.meta.url).href,Pst="data:application/json;base64,ewogICJhMTF5IjogewogICAgInVzZXJfbWVudSI6ICLZgdmH2LHYs9iqINqp2KfYsdio2LEiCiAgfSwKICAiYWN0aW9uIjogewogICAgImNsb3NlIjogItio2LPYqtmGIiwKICAgICJnbyI6ICLYsdmB2KrZhiIsCiAgICAibm8iOiAi2K7bjNixIiwKICAgICJyZWdpc3RlciI6ICLYq9io2KrigIzZhtin2YUiLAogICAgInJlbW92ZSI6ICLYrdiw2YEiLAogICAgInNpZ25faW4iOiAi2YjYsdmI2K8iLAogICAgInNpZ25fb3V0IjogItiu2LHZiNisIgogIH0sCiAgImNhbGxfZW5kZWRfdmlldyI6IHsKICAgICJjcmVhdGVfYWNjb3VudF9idXR0b24iOiAi2LPYp9iu2Kog2K3Ys9in2Kgg2qnYp9ix2KjYsduMIiwKICAgICJjcmVhdGVfYWNjb3VudF9wcm9tcHQiOiAiPDA+2obYsdinINuM2qkg2LHZhdiyINi52KjZiNixINio2LHYp9uMINit2LPYp9ioINqp2KfYsdio2LHbjCDYrtmI2K8g2KrZhti424zZhSDZhtmF24zigIzaqdmG24zYr9ifPC8wPjwxPti02YXYpyDZhduM4oCM2KrZiNin2YbbjNivINmG2KfZhSDYrtmI2K8g2LHYpyDYrdmB2Lgg2qnZhtuM2K8g2Ygg24zaqSDYotmI2KfYqtin2LEg2KjYsdin24wg2KrZhdin2LPigIzZh9in24wg2KLbjNmG2K/ZhyDYqNiz2KfYstuM2K88LzE+IiwKICAgICJub3Rfbm93X2J1dHRvbiI6ICLYp9mE2KfZhiDZhtmH2Iwg2KjZhyDYtdmB2K3ZhyDYp9i12YTbjCDYqNix2q/Ysdiv24zYryIKICB9LAogICJjb21tb24iOiB7CiAgICAiYXVkaW8iOiAi2LXYr9inIiwKICAgICJhdmF0YXIiOiAi2KLZiNin2KrYp9ixIiwKICAgICJkaXNwbGF5X25hbWUiOiAi2YbYp9mFINmG2YXYp9uM2LTbjCIsCiAgICAiaG9tZSI6ICLYrtin2YbZhyIsCiAgICAibG9hZGluZyI6ICLYqNin2LHar9iy2KfYsduM4oCmIiwKICAgICJwYXNzd29yZCI6ICLYsdmF2LIg2LnYqNmI2LEiLAogICAgInByb2ZpbGUiOiAi2b7YsdmI2YHYp9uM2YQiLAogICAgInNldHRpbmdzIjogItiq2YbYuNuM2YXYp9iqIiwKICAgICJ1c2VybmFtZSI6ICLZhtin2YUg2qnYp9ix2KjYsduMIiwKICAgICJ2aWRlbyI6ICLZiNuM2K/bjNmIIgogIH0sCiAgImhlYWRlcl9sYWJlbCI6ICLYrtin2YbZh9mUINiq2YXYp9izINin2YTZhdmG2KoiLAogICJqb2luX2V4aXN0aW5nX2NhbGxfbW9kYWwiOiB7CiAgICAiam9pbl9idXR0b24iOiAi2KjZhNmH2Iwg2KjZhyDYqtmF2KfYsyDYqNm+24zZiNmG2K/bjNivIiwKICAgICJ0ZXh0IjogItin24zZhiDYqtmF2KfYsyDYp9iyINmC2KjZhCDZiNis2YjYryDYr9in2LHYr9iMINmF24zigIzYrtmI2KfZh9uM2K8g2KjZvtuM2YjZhtiv24zYr9ifIiwKICAgICJ0aXRsZSI6ICLZvtuM2YjYs9iqINio2Ycg2KrZhdin2LPYnyIKICB9LAogICJsYXlvdXRfc3BvdGxpZ2h0X2xhYmVsIjogItmG2YjYsSDYp9mB2qnZhiIsCiAgImxvYmJ5IjogewogICAgImpvaW5fYnV0dG9uIjogItm+24zZiNiz2KrZhiDYqNmHINiq2YXYp9izIgogIH0sCiAgImxvZ2dpbmdfaW4iOiAi2YjYsdmI2K/igKYiLAogICJsb2dpbl9hdXRoX2xpbmtzIjogIjwwPtiz2KfYrtiqINit2LPYp9ioINqp2KfYsdio2LHbjDwvMD4gT3IgPDI+2K/Ys9iq2LHYs9uMINio2Ycg2LnZhtmI2KfZhiDZhduM2YfZhdin2YY8LzI+IiwKICAibG9naW5fdGl0bGUiOiAi2YjYsdmI2K8iLAogICJyYWdlc2hha2VfcmVxdWVzdF9tb2RhbCI6IHsKICAgICJib2R5IjogItqp2KfYsdio2LEg2K/bjNqv2LHbjCDYr9ixINin24zZhiDYqtmF2KfYsyDZhdi02qnZhNuMINiv2KfYsdivLiDYqNix2KfbjCDYqti02K7bjNi1INio2YfYqtixINmF2LTaqdmE2Iwg2KjZh9iq2LEg2KfYs9iqINmF2Kcg2YTYp9qvINi524zYqOKAjNuM2KfYqNuMINix2Kcg2KzZhdi54oCM2KLZiNix24wg2qnZhtuM2YUuIiwKICAgICJ0aXRsZSI6ICLYr9ix2K7ZiNin2LPYqiDZhNin2q8g2LnbjNio4oCM24zYp9io24wiCiAgfSwKICAicmFnZXNoYWtlX3NlbmRfbG9ncyI6ICLYp9ix2LPYp9mEINmE2Kfar+KAjNmH2KfbjCDYuduM2KjigIzbjNin2KjbjCIsCiAgInJhZ2VzaGFrZV9zZW5kaW5nIjogItiv2LEg2K3Yp9mEINin2LHYs9in2YTigKYiLAogICJyYWdlc2hha2Vfc2VuZGluZ19sb2dzIjogItiv2LEg2K3Yp9mEINin2LHYs9in2YQg2KjYp9qv4oCM2YfYp9uMINi524zYqOKAjNuM2KfYqNuM4oCmIiwKICAicmVjYXB0Y2hhX2Rpc21pc3NlZCI6ICLYsduM2qnZvtqG2Kcg2LHYryDYtNivIiwKICAicmVjYXB0Y2hhX25vdF9sb2FkZWQiOiAi2qnZvtqG2Kcg2KjYp9ix2q/bjNix24wg2YbYtNivIiwKICAicmVnaXN0ZXIiOiB7CiAgICAicGFzc3dvcmRzX211c3RfbWF0Y2giOiAi2LHZhdiyINi52KjZiNixINio2KfbjNivINmH2YXYrtmI2KfZhtuMINiv2KfYtNiq2Ycg2KjYp9i02K8iLAogICAgInJlZ2lzdGVyaW5nIjogItir2KjYquKAjNmG2KfZheKApiIKICB9LAogICJyZWdpc3Rlcl9hdXRoX2xpbmtzIjogIjwwPtin2LIg2YLYqNmEINit2LPYp9ioINqp2KfYsdio2LHbjCDYr9in2LHbjNiv2J88LzA+PDE+PDA+2YjYsdmI2K88LzA+IE9yIDwyPtio2Ycg2LnZhtmI2KfZhiDbjNqpINmF24zZh9mF2KfZhiDZiNin2LHYryDYtNmI24zYrzwvMj48LzE+IiwKICAicmVnaXN0ZXJfY29uZmlybV9wYXNzd29yZF9sYWJlbCI6ICLYqtin24zbjNivINix2YXYsti52KjZiNixIiwKICAicmV0dXJuX2hvbWVfYnV0dG9uIjogItio2LHar9i02Kog2KjZhyDYtdmB2K3ZhyDYp9i12YTbjCIsCiAgInNjcmVlbnNoYXJlX2J1dHRvbl9sYWJlbCI6ICLYp9i02KrYsdin2qkg2q/YsNin2LHbjCDYtdmB2K3ZhyDZhtmF2KfbjNi0IiwKICAic2V0dGluZ3MiOiB7CiAgICAiZGV2ZWxvcGVyX3RhYl90aXRsZSI6ICLYqtmI2LPYudmHINiv2YfZhtiv2YciLAogICAgImZlZWRiYWNrX3RhYl9oNCI6ICLYqNin2LLYrtmI2LHYryDYp9ix2KfYptmHINiv2YfbjNivIiwKICAgICJmZWVkYmFja190YWJfc2VuZF9sb2dzX2xhYmVsIjogIti02KfZhdmEINmE2Kfar+KAjNmH2KfbjCDYuduM2KjigIzbjNin2KjbjCIKICB9LAogICJ1bmF1dGhlbnRpY2F0ZWRfdmlld19ib2R5IjogItmH2YbZiNiyINir2KjYquKAjNmG2KfZhSDZhtqp2LHYr9mH4oCM2KfbjNiv2J8gPDI+2LPYp9iu2Kog2K3Ys9in2Kgg2qnYp9ix2KjYsduMPC8yPiIsCiAgInVuYXV0aGVudGljYXRlZF92aWV3X2xvZ2luX2J1dHRvbiI6ICLYqNmHINit2LPYp9ioINqp2KfYsdio2LHbjCDYrtmI2K8g2YjYp9ix2K8g2LTZiNuM2K8iLAogICJ2ZXJzaW9uIjogItmG2LPYrtmHOiB7e9mG2LPYrtmHfX0iCn0K",Dst=""+new URL("fi-app-tnO3DMdi.json",import.meta.url).href,Nst=""+new URL("fr-app-BxTYbDfK.json",import.meta.url).href,Ust=""+new URL("id-app-BEz8ptLJ.json",import.meta.url).href,jst=""+new URL("it-app-Cik25Qgd.json",import.meta.url).href,Fst=""+new URL("ja-app-Cp_00ujI.json",import.meta.url).href,$st=""+new URL("lv-app-D-ZV3Ytk.json",import.meta.url).href,Bst=""+new URL("pl-app-CUkXVSZk.json",import.meta.url).href,Hst=""+new URL("ro-app-CdYgKCOW.json",import.meta.url).href,qst=""+new URL("ru-app-CIijOjFj.json",import.meta.url).href,Vst=""+new URL("sk-app-DaVEeQWZ.json",import.meta.url).href,Kst=""+new URL("sv-app-DHLBEOTp.json",import.meta.url).href,Gst=""+new URL("tr-app-Dk--6BpP.json",import.meta.url).href,zst=""+new URL("uk-app-DZD01h76.json",import.meta.url).href,Wst="data:application/json;base64,ewogICJhY3Rpb24iOiB7CiAgICAiY2xvc2UiOiAixJDDs25nIiwKICAgICJubyI6ICJLaMO0bmciLAogICAgInJlZ2lzdGVyIjogIsSQxINuZyBrw70iLAogICAgInNpZ25faW4iOiAixJDEg25nIG5o4bqtcCIsCiAgICAic2lnbl9vdXQiOiAixJDEg25nIHh14bqldCIsCiAgICAic3VibWl0IjogIkfhu61pIgogIH0sCiAgImNhbGxfZW5kZWRfdmlldyI6IHsKICAgICJjcmVhdGVfYWNjb3VudF9idXR0b24iOiAiVOG6oW8gdMOgaSBraG/huqNuIiwKICAgICJjcmVhdGVfYWNjb3VudF9wcm9tcHQiOiAiPDA+VOG6oWkgc2FvIGzhuqFpIGtow7RuZyBob8OgbiB0aGnhu4duIGLhurFuZyBjw6FjaCDEkeG6t3QgbeG6rXQga2jhuql1IMSR4buDIGdp4buvIHTDoGkga2hv4bqjbiBj4bunYSBi4bqhbj88LzA+PDE+QuG6oW4gc+G6vSBjw7MgdGjhu4MgZ2nhu68gdMOqbiB2w6AgxJHhurd0IOG6o25oIMSR4bqhaSBkaeG7h24gY2hvIG5o4buvbmcgY3Xhu5ljIGfhu41pIHRp4bq/cCB0aGVvLjwvMT4iLAogICAgImZlZWRiYWNrX2RvbmUiOiAiPDA+Q+G6o20gaMahbiB2w6wgxJHDoyBwaOG6o24gaOG7k2khPC8wPiIsCiAgICAiZmVlZGJhY2tfcHJvbXB0IjogIjwwPkNow7puZyB0w7RpIG114buRbiBuZ2hlIHBo4bqjbiBo4buTaSBj4bunYSBi4bqhbiDEkeG7gyBjw7JuIGPhuqNpIHRoaeG7h24gdHLhuqNpIG5naGnhu4dtIGNobyBi4bqhbi48LzA+IiwKICAgICJoZWFkbGluZSI6ICJ7e2Rpc3BsYXlOYW1lfX0sIGN14buZYyBn4buNaSDEkcOjIGvhur90IHRow7pjLiIKICB9LAogICJjb21tb24iOiB7CiAgICAiYXVkaW8iOiAiw4JtIHRoYW5oIiwKICAgICJhdmF0YXIiOiAi4bqibmggxJHhuqFpIGRp4buHbiIsCiAgICAiZGlzcGxheV9uYW1lIjogIlTDqm4gaGnhu4NuIHRo4buLIiwKICAgICJsb2FkaW5nIjogIsSQYW5nIHThuqNp4oCmIiwKICAgICJwYXNzd29yZCI6ICJN4bqtdCBraOG6qXUiLAogICAgInByb2ZpbGUiOiAiSOG7kyBzxqEiLAogICAgInNldHRpbmdzIjogIkPDoGkgxJHhurd0IiwKICAgICJ1c2VybmFtZSI6ICJUw6puIG5nxrDhu51pIGTDuW5nIiwKICAgICJ2aWRlbyI6ICJUcnV54buBbiBow6xuaCIKICB9LAogICJqb2luX2V4aXN0aW5nX2NhbGxfbW9kYWwiOiB7CiAgICAiam9pbl9idXR0b24iOiAiVsOibmcsIHRoYW0gZ2lhIGN14buZYyBn4buNaSIsCiAgICAidGV4dCI6ICJDdeG7mWMgZ+G7jWkgxJHDoyB04buTbiB04bqhaSwgYuG6oW4gY8OzIG114buRbiB0aGFtIGdpYSBraMO0bmc/IiwKICAgICJ0aXRsZSI6ICJUaGFtIGdpYSBjdeG7mWMgZ+G7jWk/IgogIH0sCiAgImxheW91dF9zcG90bGlnaHRfbGFiZWwiOiAiVGnDqnUgxJFp4buDbSIsCiAgImxvYmJ5IjogewogICAgImpvaW5fYnV0dG9uIjogIlRoYW0gZ2lhIGN14buZYyBn4buNaSIKICB9LAogICJsb2dnaW5nX2luIjogIsSQYW5nIMSRxINuZyBuaOG6rXDigKYiLAogICJsb2dpbl9hdXRoX2xpbmtzIjogIjwwPlThuqFvIHTDoGkga2hv4bqjbjwvMD4gSGF5IDwyPlRoYW0gZ2lhIGTGsOG7m2kgdMOqbiBraMOhYzwvMj4iLAogICJsb2dpbl90aXRsZSI6ICLEkMSDbmcgbmjhuq1wIiwKICAicmFnZXNoYWtlX3JlcXVlc3RfbW9kYWwiOiB7CiAgICAiYm9keSI6ICJN4buZdCBuZ8aw4budaSBkw7luZyBraMOhYyB0cm9uZyBjdeG7mWMgZ+G7jWkgxJFhbmcgZ+G6t3AgduG6pW4gxJHhu4EuIMSQ4buDIGPDsyB0aOG7gyBjaOG6qW4gxJFvw6FuIHThu5F0IGjGoW4gY2jDum5nIHTDtGkgbXXhu5FuIHRodSB0aOG6rXAgbmjhuq10IGvDvSBn4buhIGzhu5dpLiIsCiAgICAidGl0bGUiOiAiWcOqdSBj4bqndSBuaOG6rXQga8O9IGfhu6EgbOG7l2kiCiAgfSwKICAicmFnZXNoYWtlX3NlbmRpbmciOiAixJBhbmcgZ+G7rWnigKYiLAogICJyZWNhcHRjaGFfbm90X2xvYWRlZCI6ICJDaMawYSB04bqjaSDEkcaw4bujYyBSZWNhcHRjaGEiLAogICJyZWdpc3RlciI6IHsKICAgICJwYXNzd29yZHNfbXVzdF9tYXRjaCI6ICJN4bqtdCBraOG6qXUgcGjhuqNpIGto4bubcCIsCiAgICAicmVnaXN0ZXJpbmciOiAixJBhbmcgxJHEg25nIGvDveKApiIKICB9LAogICJyZWdpc3Rlcl9hdXRoX2xpbmtzIjogIjwwPsSQw6MgY8OzIHTDoGkga2hv4bqjbj88LzA+PDE+PDA+xJDEg25nIG5o4bqtcDwvMD4gSGF5IDwyPlRoYW0gZ2lhIGTGsOG7m2kgdMOqbiBLaMOhY2g8LzI+PC8xPiIsCiAgInJlZ2lzdGVyX2NvbmZpcm1fcGFzc3dvcmRfbGFiZWwiOiAiWMOhYyBuaOG6rW4gbeG6rXQga2jhuql1IiwKICAic2NyZWVuc2hhcmVfYnV0dG9uX2xhYmVsIjogIkNoaWEgc+G6uyBtw6BuIGjDrG5oIiwKICAic2V0dGluZ3MiOiB7CiAgICAiZGV2ZWxvcGVyX3RhYl90aXRsZSI6ICJOaMOgIHBow6F0IHRyaeG7g24iLAogICAgImZlZWRiYWNrX3RhYl9kZXNjcmlwdGlvbl9sYWJlbCI6ICJQaOG6o24gaOG7k2kgY+G7p2EgYuG6oW4iLAogICAgImZlZWRiYWNrX3RhYl9oNCI6ICJH4butaSBwaOG6o24gaOG7k2kiLAogICAgImZlZWRiYWNrX3RhYl9zZW5kX2xvZ3NfbGFiZWwiOiAiS8OobSB0aGVvIG5o4bqtdCBrw70gZ+G7oSBs4buXaSIsCiAgICAiZmVlZGJhY2tfdGFiX3RoYW5rX3lvdSI6ICJD4bqjbSDGoW4sIGNow7puZyB0w7RpIMSRw6Mgbmjhuq1uIMSRxrDhu6NjIHBo4bqjbiBo4buTaSEiLAogICAgImZlZWRiYWNrX3RhYl90aXRsZSI6ICJQaOG6o24gaOG7k2kiCiAgfSwKICAic3VibWl0dGluZyI6ICLEkGFuZyBn4butaeKApiIsCiAgInVuYXV0aGVudGljYXRlZF92aWV3X2JvZHkiOiAiQ2jGsGEgxJHEg25nIGvDvT8gPDI+VOG6oW8gdMOgaSBraG/huqNuPC8yPiIsCiAgInVuYXV0aGVudGljYXRlZF92aWV3X2xvZ2luX2J1dHRvbiI6ICLEkMSDbmcgbmjhuq1wIHbDoG8gdMOgaSBraG/huqNuIGPhu6dhIGLhuqFuIiwKICAidmVyc2lvbiI6ICJQaGnDqm4gYuG6o246IHt7dmVyc2lvbn19Igp9Cg==",Yst=""+new URL("zh-Hans-app-BY5jJGyr.json",import.meta.url).href,Xst=""+new URL("zh-Hant-app-BV1LKS_j.json",import.meta.url).href,{slice:Jst,forEach:Qst}=[];function Zst(t){return Qst.call(Jst.call(arguments,1),e=>{if(e)for(const n in e)t[n]===void 0&&(t[n]=e[n])}),t}function eot(t){return typeof t!="string"?!1:[/<\s*script.*?>/i,/<\s*\/\s*script\s*>/i,/<\s*img.*?on\w+\s*=/i,/<\s*\w+\s*on\w+\s*=.*?>/i,/javascript\s*:/i,/vbscript\s*:/i,/expression\s*\(/i,/eval\s*\(/i,/alert\s*\(/i,/document\.cookie/i,/document\.write\s*\(/i,/window\.location/i,/innerHTML/i].some(n=>n.test(t))}const jX=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,tot=function(t,e){const r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{path:"/"},i=encodeURIComponent(e);let s=`${t}=${i}`;if(r.maxAge>0){const o=r.maxAge-0;if(Number.isNaN(o))throw new Error("maxAge should be a Number");s+=`; Max-Age=${Math.floor(o)}`}if(r.domain){if(!jX.test(r.domain))throw new TypeError("option domain is invalid");s+=`; Domain=${r.domain}`}if(r.path){if(!jX.test(r.path))throw new TypeError("option path is invalid");s+=`; Path=${r.path}`}if(r.expires){if(typeof r.expires.toUTCString!="function")throw new TypeError("option expires is invalid");s+=`; Expires=${r.expires.toUTCString()}`}if(r.httpOnly&&(s+="; HttpOnly"),r.secure&&(s+="; Secure"),r.sameSite)switch(typeof r.sameSite=="string"?r.sameSite.toLowerCase():r.sameSite){case!0:s+="; SameSite=Strict";break;case"lax":s+="; SameSite=Lax";break;case"strict":s+="; SameSite=Strict";break;case"none":s+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return r.partitioned&&(s+="; Partitioned"),s},FX={create(t,e,n,r){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{path:"/",sameSite:"strict"};n&&(i.expires=new Date,i.expires.setTime(i.expires.getTime()+n*60*1e3)),r&&(i.domain=r),document.cookie=tot(t,e,i)},read(t){const e=`${t}=`,n=document.cookie.split(";");for(let r=0;r<n.length;r++){let i=n[r];for(;i.charAt(0)===" ";)i=i.substring(1,i.length);if(i.indexOf(e)===0)return i.substring(e.length,i.length)}return null},remove(t,e){this.create(t,"",-1,e)}};var not={name:"cookie",lookup(t){let{lookupCookie:e}=t;if(e&&typeof document<"u")return FX.read(e)||void 0},cacheUserLanguage(t,e){let{lookupCookie:n,cookieMinutes:r,cookieDomain:i,cookieOptions:s}=e;n&&typeof document<"u"&&FX.create(n,t,r,i,s)}},rot={name:"querystring",lookup(t){let{lookupQuerystring:e}=t,n;if(typeof window<"u"){let{search:r}=window.location;!window.location.search&&window.location.hash?.indexOf("?")>-1&&(r=window.location.hash.substring(window.location.hash.indexOf("?")));const s=r.substring(1).split("&");for(let o=0;o<s.length;o++){const a=s[o].indexOf("=");a>0&&s[o].substring(0,a)===e&&(n=s[o].substring(a+1))}}return n}},iot={name:"hash",lookup(t){let{lookupHash:e,lookupFromHashIndex:n}=t,r;if(typeof window<"u"){const{hash:i}=window.location;if(i&&i.length>2){const s=i.substring(1);if(e){const o=s.split("&");for(let a=0;a<o.length;a++){const c=o[a].indexOf("=");c>0&&o[a].substring(0,c)===e&&(r=o[a].substring(c+1))}}if(r)return r;if(!r&&n>-1){const o=i.match(/\/([a-zA-Z-]*)/g);return Array.isArray(o)?o[typeof n=="number"?n:0]?.replace("/",""):void 0}}}return r}};let kg=null;const $X=()=>{if(kg!==null)return kg;try{if(kg=typeof window<"u"&&window.localStorage!==null,!kg)return!1;const t="i18next.translate.boo";window.localStorage.setItem(t,"foo"),window.localStorage.removeItem(t)}catch{kg=!1}return kg};var sot={name:"localStorage",lookup(t){let{lookupLocalStorage:e}=t;if(e&&$X())return window.localStorage.getItem(e)||void 0},cacheUserLanguage(t,e){let{lookupLocalStorage:n}=e;n&&$X()&&window.localStorage.setItem(n,t)}};let Ig=null;const BX=()=>{if(Ig!==null)return Ig;try{if(Ig=typeof window<"u"&&window.sessionStorage!==null,!Ig)return!1;const t="i18next.translate.boo";window.sessionStorage.setItem(t,"foo"),window.sessionStorage.removeItem(t)}catch{Ig=!1}return Ig};var oot={name:"sessionStorage",lookup(t){let{lookupSessionStorage:e}=t;if(e&&BX())return window.sessionStorage.getItem(e)||void 0},cacheUserLanguage(t,e){let{lookupSessionStorage:n}=e;n&&BX()&&window.sessionStorage.setItem(n,t)}},aot={name:"navigator",lookup(t){const e=[];if(typeof navigator<"u"){const{languages:n,userLanguage:r,language:i}=navigator;if(n)for(let s=0;s<n.length;s++)e.push(n[s]);r&&e.push(r),i&&e.push(i)}return e.length>0?e:void 0}},cot={name:"htmlTag",lookup(t){let{htmlTag:e}=t,n;const r=e||(typeof document<"u"?document.documentElement:null);return r&&typeof r.getAttribute=="function"&&(n=r.getAttribute("lang")),n}},lot={name:"path",lookup(t){let{lookupFromPathIndex:e}=t;if(typeof window>"u")return;const n=window.location.pathname.match(/\/([a-zA-Z-]*)/g);return Array.isArray(n)?n[typeof e=="number"?e:0]?.replace("/",""):void 0}},uot={name:"subdomain",lookup(t){let{lookupFromSubdomainIndex:e}=t;const n=typeof e=="number"?e+1:1,r=typeof window<"u"&&window.location?.hostname?.match(/^(\w{2,5})\.(([a-z0-9-]{1,63}\.[a-z]{2,6})|localhost)/i);if(r)return r[n]}};let Hpe=!1;try{document.cookie,Hpe=!0}catch{}const qpe=["querystring","cookie","localStorage","sessionStorage","navigator","htmlTag"];Hpe||qpe.splice(1,1);const dot=()=>({order:qpe,lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",lookupSessionStorage:"i18nextLng",caches:["localStorage"],excludeCacheFor:["cimode"],convertDetectedLanguage:t=>t});class Vpe{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.type="languageDetector",this.detectors={},this.init(e,n)}init(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{languageUtils:{}},n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.services=e,this.options=Zst(n,this.options||{},dot()),typeof this.options.convertDetectedLanguage=="string"&&this.options.convertDetectedLanguage.indexOf("15897")>-1&&(this.options.convertDetectedLanguage=i=>i.replace("-","_")),this.options.lookupFromUrlIndex&&(this.options.lookupFromPathIndex=this.options.lookupFromUrlIndex),this.i18nOptions=r,this.addDetector(not),this.addDetector(rot),this.addDetector(sot),this.addDetector(oot),this.addDetector(aot),this.addDetector(cot),this.addDetector(lot),this.addDetector(uot),this.addDetector(iot)}addDetector(e){return this.detectors[e.name]=e,this}detect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.options.order,n=[];return e.forEach(r=>{if(this.detectors[r]){let i=this.detectors[r].lookup(this.options);i&&typeof i=="string"&&(i=[i]),i&&(n=n.concat(i))}}),n=n.filter(r=>r!=null&&!eot(r)).map(r=>this.options.convertDetectedLanguage(r)),this.services&&this.services.languageUtils&&this.services.languageUtils.getBestMatchFromCodes?n:n.length>0?n[0]:null}cacheUserLanguage(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.options.caches;n&&(this.options.excludeCacheFor&&this.options.excludeCacheFor.indexOf(e)>-1||n.forEach(r=>{this.detectors[r]&&this.detectors[r].cacheUserLanguage(e,this.options)}))}}Vpe.type="languageDetector";var cE={},HX;function fot(){if(HX)return cE;HX=1,Object.defineProperty(cE,"__esModule",{value:!0}),cE.shouldPolyfill=t;function t(){return!Intl.Segmenter}return cE}var hot=fot();function pot(){return typeof Intl>"u"||!("DurationFormat"in Intl)}const Kpe=Object.assign({"../locales/bg/app.json":Rst,"../locales/cs/app.json":kst,"../locales/da/app.json":Ist,"../locales/de/app.json":xst,"../locales/el/app.json":Ast,"../locales/en/app.json":Lst,"../locales/es/app.json":Mst,"../locales/et/app.json":Ost,"../locales/fa/app.json":Pst,"../locales/fi/app.json":Dst,"../locales/fr/app.json":Nst,"../locales/id/app.json":Ust,"../locales/it/app.json":jst,"../locales/ja/app.json":Fst,"../locales/lv/app.json":$st,"../locales/pl/app.json":Bst,"../locales/ro/app.json":Hst,"../locales/ru/app.json":qst,"../locales/sk/app.json":Vst,"../locales/sv/app.json":Kst,"../locales/tr/app.json":Gst,"../locales/uk/app.json":zst,"../locales/vi/app.json":Wst,"../locales/zh-Hans/app.json":Yst,"../locales/zh-Hant/app.json":Xst}),mot=(t,e)=>Kpe[`../locales/${t}/${e}.json`],got=[...new Set(Object.keys(Kpe).map(t=>{const e=t.match(/\/([^/]+)\/[^/]+\.json$/)?.[1];if(!e)throw new Error(`Could not parse locale URL ${t}`);return e}))],vot={type:"backend",init(){},read(t,e,n){(async()=>{const r=mot(t,e);if(!r)throw new Error(`Namespace ${e} for locale ${t} not found`);const i=await fetch(r,{credentials:"omit",headers:{Accept:"application/json"}});if(J8(i))throw Error(`Failed to fetch ${r}`);return await i.json()})().then(r=>n(null,r),r=>n(r,null))}};class yot{constructor(){this.config=0,this.sentry=0}allDepsAreLoaded(){return!Object.values(this).some(e=>e!==2)}}class yc{constructor(){this.isInitialized=!1,this.loadStates=new yot}static isInitialized(){return!!yc.internalInstance?.isInitialized}static async initBeforeReact(){RHe();const e=[];hot.shouldPolyfill()&&e.push(Rb(()=>import("./polyfill-force-CfSzzRWs.js").then(s=>s.p),__vite__mapDeps([2,3]),import.meta.url)),pot()&&e.push(Rb(()=>import("./polyfill-force-DAqvsE0e.js"),__vite__mapDeps([4,3]),import.meta.url)),await Promise.all(e);const n=new Vpe;n.addDetector({name:"urlFragment",lookup:()=>ur().lang??void 0}),gs.on("languageChanged",s=>{document.documentElement.lang=s}),await gs.use(vot).use(n).use(DDe).init({fallbackLng:"en",defaultNS:"app",keySeparator:".",nsSeparator:!1,pluralSeparator:"_",contextSeparator:"|",supportedLngs:got,interpolation:{escapeValue:!1},detection:{order:["urlFragment","navigator"],caches:[]}});const{fonts:r,fontScale:i}=ur();i!==null&&document.documentElement.style.setProperty("--font-scale",i.toString()),r.length>0&&document.documentElement.style.setProperty("--font-family",r.map(s=>`"${s}"`).join(", ")),document.body.setAttribute("data-platform",Dc)}static init(){return yc?.internalInstance?.initPromise?null:(yc.internalInstance=new yc,yc.internalInstance.initPromise=new Promise(e=>{yc.internalInstance?.initStep(e)}),yc.internalInstance.initPromise)}static reset(){yc.internalInstance=void 0}initStep(e){if(this.loadStates.config===0&&(this.loadStates.config=1,yn.init().then(()=>{this.loadStates.config=2,this.initStep(e)},n=>{N.error("Failed to load config",n)})),this.loadStates.sentry===0&&this.loadStates.config===2){let n,r;n=ur().sentryDsn??void 0,r=ur().sentryEnvironment??void 0,n&&qIe({dsn:n,environment:r,integrations:[cxe({useEffect:xe.useEffect,useLocation:vs,useNavigationType:QEe,createRoutesFromChildren:JC,matchRoutes:XP})],tracesSampleRate:1}),this.loadStates.sentry=2}this.loadStates.allDepsAreLoaded()&&(e(),this.isInitialized=!0)}}const bot=()=>{const[t,e]=_.useState(()=>ur().theme),n=_.useRef(document.body.classList.item(0));_.useEffect(()=>{if(Et){const r=i=>{i.preventDefault(),"name"in i.detail.data&&typeof i.detail.data.name=="string"&&e(i.detail.data.name),Et.api.transport.reply(i.detail,{})};return Et.lazyActions.on(Ir.ThemeChange,r),()=>{Et.lazyActions.off(Ir.ThemeChange,r)}}},[]),_.useLayoutEffect(()=>{const r=t?.includes("light")?"light":"dark",i=t?.includes("high-contrast")?"-hc":"",s="cpd-theme-"+r+i;s!==n.current&&(document.body.classList.remove("cpd-theme-light","cpd-theme-dark","cpd-theme-light-hc","cpd-theme-dark-hc"),document.body.classList.add(s),n.current=s),document.body.classList.remove("no-theme")},[n,t])},lE=lxe(Xee),_ot=({children:t})=>{const{pathname:e}=vs();return _.useEffect(()=>{let n="";!["/login","/register"].includes(e)&&!Et&&(n="var(--background-gradient)"),document.getElementsByTagName("body")[0].style.backgroundImage=n},[e]),S.jsx(S.Fragment,{children:t})},Sot=({children:t})=>(bot(),t),wot=({vm:t})=>{const[e,n]=_.useState(!1);_.useEffect(()=>{yc.init()?.then(async()=>{e||(n(!0),await Et?.api.sendContentLoaded())}).catch(N.error)});const{header:r}=_.useMemo(ur,[]),i=e?S.jsx(LKe,{children:S.jsx(hue,{value:t.mediaDevices,children:S.jsx(cYe,{children:S.jsx(eR,{fallback:s=>S.jsx(h_,{error:s,widget:Et}),children:S.jsxs(pCe,{children:[S.jsx(lE,{path:"/",element:S.jsx(jfe,{})}),S.jsx(lE,{path:"/login",element:S.jsx(yXe,{})}),S.jsx(lE,{path:"/register",element:S.jsx(bXe,{})}),S.jsx(lE,{path:"*",element:S.jsx(Tst,{})})]})})})})}):S.jsx(AR,{});return S.jsx(jCe,{children:S.jsx(_ot,{children:S.jsx(Sot,{children:S.jsx(lre,{children:S.jsx(_.Suspense,{fallback:null,children:r===l_.AppBar?S.jsx(git,{children:i}):i})})})})})};class Eot{constructor(e){this.scope=e,this.mediaDevices=new DGe(this.scope)}}window.setLKLogLevel=OZ;eBe().catch(t=>{N.error("Failed to initialize rageshake",t)});OZ("info");LSe((t,e,n)=>{global.mx_rage_logger.log(t,"livekit",e,n)});N.info("Element Call dev");const HO=Ybe.createRoot(document.getElementById("root"));let wb=null;window.isSecureContext?navigator.mediaDevices||(wb=new Error("Your browser does not support WebRTC.")):wb=new Error(`This app cannot run in an insecure context. To fix this, access the app via a local loopback address, or serve it over HTTPS.
https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts`);if(wb!==null)throw HO.render(wb.message),wb;yc.initBeforeReact().then(()=>{HO.render(S.jsx(_.StrictMode,{children:S.jsx(wot,{vm:new Eot(sue)})}))}).catch(t=>{N.error("Failed to initialize app",t),HO.render(t.message)});export{Lot as A,Oot as B,yn as C,Q0e as D,ee as E,Dot as F,Qo as G,uP as H,Pot as I,Zt as J,Ke as K,kot as L,In as M,Hu as N,BB as O,J0e as P,Not as Q,Uot as R,np as S,Gn as T,Mot as U,Jt as V,Rv as W,e1e as X,ia as _,$c as a,Dl as b,Aot as c,B as d,M as e,XW as f,Cot as g,Rot as h,Mfe as i,ki as j,fe as k,N as l,gp as m,Oe as n,yT as o,nP as p,IQ as q,gbe as r,Yp as s,Vot as t,py as u,Nl as v,fr as w,a1e as x,H1 as y,gT as z};
//# sourceMappingURL=index-BCBn0gEn.js.map
